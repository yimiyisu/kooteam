!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VTable={})}(this,(function(t){"use strict";class e{static GenAutoIncrementId(){return e.auto_increment_id++}}e.auto_increment_id=0;class i{constructor(t){this.id=e.GenAutoIncrementId(),this.registry=t}}const r="named",o="inject",n="multi_inject",s="inversify:tagged",a="inversify:paramtypes";class l{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===r?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}var h=function(t){var e;return function(t){const e="function"==typeof Symbol&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=Object.getPrototypeOf(Function),r=("object"==typeof process&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL,Map),o=new WeakMap;function n(t,e,i){let n=o.get(t);if(h(n)){if(!i)return;n=new r,o.set(t,n)}let s=n.get(e);if(h(s)){if(!i)return;s=new r,n.set(e,s)}return s}function s(t,e,i){if(a(t,e,i))return!0;const r=f(e);return!c(r)&&s(t,r,i)}function a(t,e,i){const r=n(e,i,!1);return!h(r)&&!!r.has(t)}function l(t,e,i){if(a(t,e,i))return function(t,e,i){const r=n(e,i,!1);if(!h(r))return r.get(t)}(t,e,i);const r=f(e);return c(r)?void 0:l(t,r,i)}function h(t){return void 0===t}function c(t){return null===t}function d(t){return"object"==typeof t?null!==t:"function"==typeof t}function u(t,i){switch(function(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}const r=3===i?"string":5===i?"number":"default",o=function(t,e){const i=t[e];if(null!=i){if(!p(i))throw new TypeError;return i}}(t,e);if(void 0!==o){const e=o.call(t,r);if(d(e))throw new TypeError;return e}return function(t,e){if("string"===e){const e=t.toString;if(p(e)){const i=e.call(t);if(!d(i))return i}const i=t.valueOf;if(p(i)){const e=i.call(t);if(!d(e))return e}}else{const e=t.valueOf;if(p(e)){const i=e.call(t);if(!d(i))return i}const i=t.toString;if(p(i)){const e=i.call(t);if(!d(e))return e}}throw new TypeError}(t,"default"===r?"number":r)}function g(t){const e=u(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function p(t){return"function"==typeof t}function f(t){const e=Object.getPrototypeOf(t);if("function"!=typeof t||t===i)return e;if(e!==i)return e;const r=t.prototype,o=r&&Object.getPrototypeOf(r);if(null==o||o===Object.prototype)return e;const n=o.constructor;return"function"!=typeof n||n===t?e:n}t("defineMetadata",(function(t,e,i,r){if(!d(i))throw new TypeError;return o=t,s=e,void n(i,r,!0).set(o,s);var o,s})),t("hasMetadata",(function(t,e,i){if(!d(e))throw new TypeError;return h(i)||(i=g(i)),s(t,e,i)})),t("hasOwnMetadata",(function(t,e,i){if(!d(e))throw new TypeError;return h(i)||(i=g(i)),a(t,e,i)})),t("getMetadata",(function(t,e,i){if(!d(e))throw new TypeError;return h(i)||(i=g(i)),l(t,e,i)}))}((e=t,function(t,i){"function"!=typeof e[t]&&Object.defineProperty(e,t,{configurable:!0,writable:!0,value:i})})),t}({});function c(t,e,i,r){!function(t,e,i,r){const o=[r];let n={};h.hasOwnMetadata(t,e)&&(n=h.getMetadata(t,e));let s=n[i];void 0===s&&(s=[]),s.push(...o),n[i]=s,h.defineMetadata(t,n,e)}(s,t,i.toString(),r)}function d(t){return(e,i,r)=>{c(e,0,r,t)}}function u(t){return e=>(i,r,o)=>d(new l(t,e))(i,r,o)}const g=u(o),p=u(n);function f(){return function(t){return h.defineMetadata(a,null,t),t}}function m(t){return d(new l(r,t))}const b="Singleton",y="Transient",C="ConstantValue",w="DynamicValue",v="Factory",x="Function",_="Instance",S="Invalid";class A{constructor(t,i){this.id=e.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=i,this.type=S,this.constraint=t=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new A(this.serviceIdentifier,this.scope);return t.activated=t.scope===b&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class T{getConstructorMetadata(t){return{compilerGeneratedMetadata:h.getMetadata(a,t),userGeneratedMetadata:h.getMetadata(s,t)||{}}}getPropertiesMetadata(t){throw new Error("暂未实现")}}const R=(B=r,t=>{const e=e=>{if(null==e)return!1;if(e.key===B&&e.value===t)return!0;if(null==e.constructorArgsMetadata)return!1;const i=e.constructorArgsMetadata;for(let e=0;e<i.length;e++)if(i[e].key===B&&i[e].value===t)return!0;return!1};return e.metaData=new l(B,t),e});var B;class M{constructor(t){this._binding=t}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=b,this}inTransientScope(){return this._binding.scope=y,this}whenTargetNamed(t){return this._binding.constraint=R(t),this}}class P{constructor(t){this._binding=t}to(t){return this._binding.type=_,this._binding.implementationType=t,new M(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=w,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new M(this._binding)}toConstantValue(t){return this._binding.type=C,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b,new M(this._binding)}toFactory(t){return this._binding.type=v,this._binding.factory=t,this._binding.scope=b,new M(this._binding)}toService(t){this.toDynamicValue((e=>e.container.get(t)))}}const H=Symbol("ContributionProvider");class k{constructor(t,e){this.serviceIdentifier=t,this.container=e,F.setStore(this.serviceIdentifier,this)}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}refresh(){this.caches&&(this.caches.length=0,this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier)))}}function E(t,e){t(H).toDynamicValue((({container:t})=>new k(e,t))).inSingletonScope().whenTargetNamed(e)}class F{static getStore(t){return this.store.get(t)}static setStore(t,e){this.store.set(t,e)}static refreshAllContributions(){this.store.forEach((t=>{t.refresh()}))}}F.store=new Map;class L{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i="string"==typeof t?t.trim():t.name;i&&(this.taps=this.taps.filter((t=>!(t.name===i&&(!e||t.fn===e)))))}_parseOptions(t,e,i){let r;if("string"==typeof e)r={name:e.trim()};else if("object"!=typeof e||null===e)throw new Error("Invalid tap options");if("string"!=typeof r.name||""===r.name)throw new Error("Missing name for tap");return r=Object.assign({type:t,fn:i},r),r}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;"string"==typeof t.before?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;"number"==typeof t.stage&&(i=t.stage);let r=this.taps.length;for(;r>0;){r--;const t=this.taps[r];this.taps[r+1]=t;const o=t.stage||0;if(e){if(e.has(t.name)){e.delete(t.name);continue}if(e.size>0)continue}if(!(o>i)){r++;break}}this.taps[r]=t}}class I extends L{call(...t){this.taps.map((t=>t.fn)).forEach((e=>e(...t)))}}const z=Symbol.for("EnvContribution"),O=Symbol.for("VGlobal");const D=new class{};let W=0;class N{constructor(){this.nextAnimationFrameCbs=new Map,this._rafHandle=null,this.runAnimationFrame=t=>{this._rafHandle=null;const e=this.nextAnimationFrameCbs;this.nextAnimationFrameCbs=new Map,e.forEach((e=>e(t)))},this.tryRunAnimationFrameNextFrame=()=>{null===this._rafHandle&&0!==this.nextAnimationFrameCbs.size&&(this._rafHandle=D.global.getRequestAnimationFrame()(this.runAnimationFrame))}}addAnimationFrameCb(t){return this.nextAnimationFrameCbs.set(++W,t),this.tryRunAnimationFrameNextFrame(),W}removeAnimationFrameCb(t){return!!this.nextAnimationFrameCbs.has(t)&&(this.nextAnimationFrameCbs.delete(t),!0)}}class G{constructor(){this._listenerMap=new Map,this._eventListenerTransformer=t=>t}setEventListenerTransformer(t){this._eventListenerTransformer=t||(t=>t)}addEventListener(t,e,i){if(!e)return;const r=t=>{const i=this._eventListenerTransformer(t);"function"==typeof e?e(i):e.handleEvent&&e.handleEvent(i)};this._listenerMap.has(t)||this._listenerMap.set(t,new Map),this._listenerMap.get(t).set(e,r),this._nativeAddEventListener(t,r,i)}removeEventListener(t,e,i){var r;if(!e)return;const o=null===(r=this._listenerMap.get(t))||void 0===r?void 0:r.get(e);o&&(this._nativeRemoveEventListener(t,o,i),this._listenerMap.get(t).delete(e),0===this._listenerMap.get(t).size&&this._listenerMap.delete(t))}dispatchEvent(t){return this._nativeDispatchEvent(t)}clearAllEventListeners(){this._listenerMap.forEach(((t,e)=>{t.forEach(((t,i)=>{this._nativeRemoveEventListener(e,t,void 0)}))})),this._listenerMap.clear()}_nativeAddEventListener(t,e,i){throw new Error("_nativeAddEventListener must be implemented by derived classes")}_nativeRemoveEventListener(t,e,i){throw new Error("_nativeRemoveEventListener must be implemented by derived classes")}_nativeDispatchEvent(t){throw new Error("_nativeDispatchEvent must be implemented by derived classes")}}var j=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},V=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},U=function(t,e){return function(i,r){e(i,r,t)}},K=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};let $=class extends G{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(t){this._isImageAnonymous=t}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(t){this._env||this.setEnv("browser"),this.envContribution.supportEvent=t}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=t}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=t}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=t}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(t){this._env||this.setEnv("browser"),this.envContribution.applyStyles=t}constructor(t){super(),this.contributions=t,this._isImageAnonymous=!0,this._performanceRAFList=[],this.eventListenerTransformer=t=>t,this.id=e.GenAutoIncrementId(),this.hooks={onSetEnv:new I(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}_nativeAddEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(t,e,i)}_nativeRemoveEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(t,e,i)}_nativeDispatchEvent(t){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(t)}bindContribution(t){const e=[];if(this.contributions.getContributions().forEach((i=>{const r=i.configure(this,t);r&&r.then&&e.push(r)})),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(t,e){if(e&&!0===e.force||this._env!==t)return this.deactiveCurrentEnv(),this.activeEnv(t,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(t,e){const i=this._env;this._env=t;const r=this.bindContribution(e);if(r&&r.then)return r.then((()=>{this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}));this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}setActiveEnvContribution(t){this.envContribution=t}createCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(t)}createOffscreenCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(t)}releaseCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(t)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getSpecifiedRequestAnimationFrame(t){this._env||this.setEnv("browser"),this._performanceRAFList[t]||(this._performanceRAFList[t]=new N);const e=this._performanceRAFList[t];return t=>e.addAnimationFrameCb(t)}getSpecifiedCancelAnimationFrame(t){if(this._env||this.setEnv("browser"),!this._performanceRAFList[t])return()=>!1;const e=this._performanceRAFList[t];return t=>e.removeAnimationFrameCb(t)}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(t){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(t):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(t,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(t,e):null}loadImage(t){return this._env||this.setEnv("browser"),this.envContribution.loadImage(t)}loadSvg(t){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(t)}loadJson(t){return this._env||this.setEnv("browser"),this.envContribution.loadJson(t)}loadArrayBuffer(t){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(t)}loadBlob(t){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(t)}loadFont(t,e,i){return K(this,void 0,void 0,(function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(t,e,i)}))}isChrome(){return null!=this._isChrome||(this._env||this.setEnv("browser"),this._isChrome="browser"===this._env&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return null!=this._isSafari||(this._env||this.setEnv("browser"),this._isSafari="browser"===this._env&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(t){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(t)}removeDom(t){return this._env||this.setEnv("browser"),this.envContribution.removeDom(t)}createDom(t){return this._env||this.setEnv("browser"),this.envContribution.createDom(t)}updateDom(t,e){return this._env||this.setEnv("browser"),this.envContribution.updateDom(t,e)}getElementTop(t,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(t,e)}getElementLeft(t,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(t,e)}getElementTopLeft(t,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(t,e)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(t){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(t)}};var X,Y,q,Z;$=j([f(),U(0,g(H)),U(0,m(z)),V("design:paramtypes",[Object])],$),function(t){t[t.estimate=0]="estimate",t[t.actualBounding=1]="actualBounding",t[t.fontBounding=2]="fontBounding"}(X||(X={})),function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSE=2]="PAUSE"}(Y||(Y={})),function(t){t.wait="wait",t.from="from",t.to="to",t.customAnimate="customAnimate"}(q||(q={})),function(t){t[t.INITIAL=0]="INITIAL",t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.END=3]="END"}(Z||(Z={}));var J="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tt={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}function o(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,r,n,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,n||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=i?i+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,n=r.length,s=new Array(n);o<n;o++)s[o]=r[o].fn;return s},a.prototype.listenerCount=function(t){var e=i?i+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,o,n,s){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,o),!0;case 5:return c.fn.call(c.context,e,r,o,n),!0;case 6:return c.fn.call(c.context,e,r,o,n,s),!0}for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var u,g=c.length;for(h=0;h<g;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,r);break;case 4:c[h].fn.call(c[h].context,e,r,o);break;default:if(!l)for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c[h].fn.apply(c[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,r,o){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return s(this,n),this;var a=this._events[n];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||s(this,n);else{for(var l=0,h=[],c=a.length;l<c;l++)(a[l].fn!==e||o&&!a[l].once||r&&a[l].context!==r)&&h.push(a[l]);h.length?this._events[n]=1===h.length?h[0]:h:s(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&s(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(tt);var et=Q(tt.exports);var it=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var rt=(t,e=!1)=>e?"boolean"==typeof t:!0===t||!1===t||it(t,"Boolean");var ot=t=>"function"==typeof t;var nt=t=>null==t;var st=t=>null!=t;var at=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var lt=t=>"object"==typeof t&&null!==t;var ht=function(t){if(!lt(t)||!it(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var ct=t=>void 0===t;var dt=(t,e=!1)=>{const i=typeof t;return e?"string"===i:"string"===i||it(t,"String")};var ut=t=>Array.isArray?Array.isArray(t):it(t,"Array");var gt=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var pt=t=>it(t,"Date");var ft=(t,e=!1)=>{const i=typeof t;return e?"number"===i:"number"===i||it(t,"Number")};var mt=t=>ft(t)&&Number.isFinite(t);var bt=t=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(t);var yt=t=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(t);var Ct=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const wt=Object.prototype;var vt=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||wt)};const xt=Object.prototype.hasOwnProperty;function _t(t){if(nt(t))return!0;if(gt(t))return!t.length;const e=Ct(t);if("Map"===e||"Set"===e)return!t.size;if(vt(t))return!Object.keys(t).length;for(const e in t)if(xt.call(t,e))return!1;return!0}var St=(t,e,i)=>{const r=dt(e)?e.split("."):e;for(let e=0;e<r.length;e++)t=t?t[r[e]]:void 0;return void 0===t?i:t};const At=Object.prototype.hasOwnProperty;var Tt=(t,e)=>null!=t&&At.call(t,e);function Rt(t,e,i){let r;if(!st(t)||"object"!=typeof t||e&&e(t))return t;const o=ut(t),n=t.length;r=o?new Array(n):"object"==typeof t?{}:rt(t)||ft(t)||dt(t)?t:pt(t)?new Date(+t):void 0;const s=o?void 0:Object.keys(Object(t));let a=-1;if(r)for(;++a<(s||t).length;){const o=s?s[a]:a,n=t[o];i&&i.includes(o.toString())?r[o]=n:r[o]=Rt(n,e,i)}return r}function Bt(t,e,i=!1,r=!1){if(e){if(t===e)return;if(st(e)&&"object"==typeof e){const o=Object(e),n=[];for(const t in o)n.push(t);let{length:s}=n,a=-1;for(;s--;){const s=n[++a];!st(o[s])||"object"!=typeof o[s]||r&&ut(t[s])?Pt(t,s,o[s]):Mt(t,e,s,i,r)}}}}function Mt(t,e,i,r=!1,o=!1){const n=t[i],s=e[i];let a=e[i],l=!0;if(ut(s)){if(r)a=[];else if(ut(n))a=n;else if(gt(n)){a=new Array(n.length);let t=-1;const e=n.length;for(;++t<e;)a[t]=n[t]}}else ht(s)?(a=null!=n?n:{},"function"!=typeof n&&"object"==typeof n||(a={})):l=!1;l&&Bt(a,s,r,o),Pt(t,i,a)}function Pt(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function Ht(t,...e){let i=-1;const r=e.length;for(;++i<r;)Bt(t,e[i],!0);return t}function kt(t){return Object.prototype.toString.call(t)}function Et(t){return Object.keys(t)}function Ft(t,e,i){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Number.isNaN(t)&&Number.isNaN(e))return!0;if(kt(t)!==kt(e))return!1;if(ot(t))return!!(null==i?void 0:i.skipFunction);if("object"!=typeof t)return!1;if(ut(t)){if(t.length!==e.length)return!1;for(let r=t.length-1;r>=0;r--)if(!Ft(t[r],e[r],i))return!1;return!0}if(!ht(t))return!1;const r=Et(t),o=Et(e);if(r.length!==o.length)return!1;r.sort(),o.sort();for(let t=r.length-1;t>=0;t--)if(r[t]!=o[t])return!1;for(let o=r.length-1;o>=0;o--){const n=r[o];if(!Ft(t[n],e[n],i))return!1}return!0}function Lt(t,e,i){const r=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let o=0;o<r.length;o++){const n=r[o];(i?null!=e[n]:null==t[n])&&(t[n]=e[n])}return t}function It(t,e,i=!0){if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const r=Object.getOwnPropertyNames(e);for(let o=0;o<r.length;o++){const n=r[o];"constructor"!==n&&(i?null!=e[n]:null==t[n])&&(t[n]=e[n])}}else Lt(t,e,i)}function zt(t){return st(t)?ut(t)?t:[t]:[]}function Ot(t){if(gt(t))return t[t.length-1]}const Dt=(t,e)=>{var i;if(0===t.length)return;let r=t[0];for(let o=1;o<t.length;o++){const n=t[o];(null!==(i=null==e?void 0:e(n,r))&&void 0!==i?i:n-r)>0&&(r=n)}return r},Wt=(t,e)=>{var i;if(0===t.length)return;let r=t[0];for(let o=1;o<t.length;o++){const n=t[o];(null!==(i=null==e?void 0:e(n,r))&&void 0!==i?i:n-r)<0&&(r=n)}return r};function Nt(t,e){if(!ut(t)||!ut(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Gt(t){if(!ut(t))return[t];const e=[];for(const i of t)e.push(...Gt(i));return e}function jt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Vt(t){return Number(t)}const Ut="undefined"!=typeof console;function Kt(t,e,i){const r=[e].concat([].slice.call(i));Ut&&console[t].apply(console,r)}var $t;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}($t||($t={}));let Xt=class t{static getInstance(e,i){return t._instance&&ft(e)?t._instance.level(e):t._instance||(t._instance=new t(e,i)),t._instance}static setInstance(e){return t._instance=e}static setInstanceLevel(e){t._instance?t._instance.level(e):t._instance=new t(e)}static clearInstance(){t._instance=null}constructor(t=$t.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach((e=>e(...t)))}canLogInfo(){return this._level>=$t.Info}canLogDebug(){return this._level>=$t.Debug}canLogError(){return this._level>=$t.Error}canLogWarn(){return this._level>=$t.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=$t.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):Kt(null!==(e=this._method)&&void 0!==e?e:"error","ERROR",t)),this}warn(...t){return this._level>=$t.Warn&&Kt(this._method||"warn","WARN",t),this}info(...t){return this._level>=$t.Info&&Kt(this._method||"log","INFO",t),this}debug(...t){return this._level>=$t.Debug&&Kt(this._method||"log","DEBUG",t),this}};Xt._instance=null;function Yt(t,e,i=1e-10,r=1e-10){const o=r,n=i*Math.max(t,e);return Math.abs(t-e)<=Math.max(o,n)}const qt=t=>{let e=null,i=null;return(...r)=>(e&&r.every(((t,i)=>t===e[i]))||(e=r,i=t(...r)),i)};var Zt=function(t,e,i){return t<e?e:t>i?i:t};var Jt=(t,e,i)=>{let[r,o]=t;o<r&&(r=t[1],o=t[0]);const n=o-r;return n>=i-e?[e,i]:(r=Math.min(Math.max(r,e),i-n),[r,r+n])};let Qt=!1;try{Qt="function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame}catch(t){Qt=!1}function te(t,e,i){let r,o,n,s,a,l,h=0,c=!1,d=!1,u=!0;const g=!e&&0!==e&&Qt;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=r,n=o;return r=o=void 0,h=e,s=t.apply(n,i),s}function f(t,e){return g?(cancelAnimationFrame(a),requestAnimationFrame(t)):setTimeout(t,e)}function m(t){const i=t-l;return void 0===l||i>=e||i<0||d&&t-h>=n}function b(){const t=Date.now();if(m(t))return y(t);a=f(b,function(t){const i=t-h,r=e-(t-l);return d?Math.min(r,n-i):r}(t))}function y(t){return a=void 0,u&&r?p(t):(r=o=void 0,s)}function C(...t){const i=Date.now(),n=m(i);if(r=t,o=this,l=i,n){if(void 0===a)return function(t){return h=t,a=f(b,e),c?p(t):s}(l);if(d)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}return e=+e||0,at(i)&&(c=!!i.leading,d="maxWait"in i,d&&(n=Math.max(mt(i.maxWait)?i.maxWait:0,e)),u="trailing"in i?!!i.trailing:u),C.cancel=function(){void 0!==a&&function(t){if(g)return cancelAnimationFrame(t);clearTimeout(t)}(a),h=0,r=l=o=a=void 0},C.flush=function(){return void 0===a?s:y(Date.now())},C.pending=function(){return void 0!==a},C}function ee(t,e,i){let r=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return at(i)&&(r="leading"in i?!!i.leading:r,o="trailing"in i?!!i.trailing:o),te(t,e,{leading:r,trailing:o,maxWait:e})}function ie(t,e){return i=>t*(1-i)+e*i}function re(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}Qt=!1;const oe=1e-12,ne=Math.PI,se=ne/2,ae=2*ne,le=2*Math.PI,he=Math.abs,ce=Math.atan2,de=Math.cos,ue=Math.max,ge=Math.min,pe=Math.sin,fe=Math.sqrt,me=Math.pow;function be(t){return t>=1?se:t<=-1?-se:Math.asin(t)}function ye(t,e,i,r,o){let n=i,s=r;return"number"==typeof t&&"number"==typeof i&&(n=(1-o)*t+o*i),"number"==typeof e&&"number"==typeof r&&(s=(1-o)*e+o*r),{x:n,y:s}}class Ce{constructor(t=0,e=0,i,r){this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=r}clone(){return new Ce(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return ft(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return ft(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class we{static distancePP(t,e){return fe(me(t.x-e.x,2)+me(t.y-e.y,2))}static distanceNN(t,e,i,r){return fe(me(t-i,2)+me(e-r,2))}static distancePN(t,e,i){return fe(me(e-t.x,2)+me(i-t.y,2))}static pointAtPP(t,e,i){return new Ce((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function ve(t){return t*(Math.PI/180)}const xe=(t=0)=>{if(t<0)for(;t<-ae;)t+=ae;else if(t>0)for(;t>ae;)t-=ae;return t};function _e(t){for(;t<0;)t+=2*Math.PI;for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function Se(t,e,i){if(null===t)return e;if(null===e)return t;const{x11:r,x12:o,y11:n,y12:s,x21:a,x22:l,y21:h,y22:c}=Te(t,e,i);return r>=l||o<=a||n>=c||s<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(r,a),y1:Math.max(n,h),x2:Math.min(o,l),y2:Math.min(s,c)}}var Ae;!function(t){t[t.NONE=0]="NONE",t[t.BBOX1=1]="BBOX1",t[t.BBOX2=2]="BBOX2"}(Ae||(Ae={}));const Te=(t,e,i)=>{let r=t.x1,o=t.x2,n=t.y1,s=t.y2,a=e.x1,l=e.x2,h=e.y1,c=e.y2;return i&&(r>o&&([r,o]=[o,r]),n>s&&([n,s]=[s,n]),a>l&&([a,l]=[l,a]),h>c&&([h,c]=[c,h])),{x11:r,x12:o,y11:n,y12:s,x21:a,x22:l,y21:h,y22:c}};function Re(t,e,i){if(!t||!e)return Ae.NONE;const{x11:r,x12:o,y11:n,y12:s,x21:a,x22:l,y21:h,y22:c}=Te(t,e,i);return r>a&&o<l&&n>h&&s<c?Ae.BBOX1:a>r&&l<o&&h>n&&c<s?Ae.BBOX2:Ae.NONE}function Be(t,e,i){if(t&&e){if(!i)return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1);const{x11:r,x12:o,y11:n,y12:s,x21:a,x22:l,y21:h,y22:c}=Te(t,e,!0);return!(r>l||o<a||n>c||s<h)}return!0}function Me(t,e){return Math.abs(e[0]*t[0]+e[1]*t[1])}function Pe({x:t,y:e},i,r={x:0,y:0}){return{x:(t-r.x)*Math.cos(i)-(e-r.y)*Math.sin(i)+r.x,y:(t-r.x)*Math.sin(i)+(e-r.y)*Math.cos(i)+r.y}}function He(t){return{x:(t.x1+t.x2)/2,y:(t.y1+t.y2)/2}}function ke(t,e){const i=e?ve(t.angle):t.angle,r=He(t);return[Pe({x:t.x1,y:t.y1},i,r),Pe({x:t.x2,y:t.y1},i,r),Pe({x:t.x2,y:t.y2},i,r),Pe({x:t.x1,y:t.y2},i,r)]}function Ee(t,e,i=!1){const r=ke(t,i),o=ke(e,i),n=(t,e)=>[e.x-t.x,e.y-t.y],s=n(He(t),He(e)),a=n(r[0],r[1]),l=n(r[1],r[2]),h=n(o[0],o[1]),c=n(o[1],o[2]),d=i?ve(t.angle):t.angle;let u=i?ve(90-t.angle):t.angle+se;const g=i?ve(e.angle):e.angle;let p=i?ve(90-e.angle):e.angle+se;u>le&&(u-=le),p>le&&(p-=le);const f=(t,e,i,r)=>{const o=[Math.cos(e),Math.sin(e)];return t+(Me(o,i)+Me(o,r))/2>Me(o,s)};return f((t.x2-t.x1)/2,d,h,c)&&f((t.y2-t.y1)/2,u,h,c)&&f((e.x2-e.x1)/2,g,a,l)&&f((e.y2-e.y1)/2,p,a,l)}function Fe(t,e,i,r,o,n){if(n>e&&n>r||n<e&&n<r)return 0;if(r===e)return 0;const s=(n-e)/(r-e);let a=r<e?1:-1;1!==s&&0!==s||(a=r<e?.5:-.5);const l=s*(i-t)+t;return l===o?1/0:l>o?a:0}const Le=t=>{let e=t.charCodeAt(0),i=2===t.length?t.charCodeAt(1):0,r=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,r=e<<10|i,r+=65536),12288===r||65281<=r&&r<=65376||65504<=r&&r<=65510?"F":8361===r||65377<=r&&r<=65470||65474<=r&&r<=65479||65482<=r&&r<=65487||65490<=r&&r<=65495||65498<=r&&r<=65500||65512<=r&&r<=65518?"H":4352<=r&&r<=4447||4515<=r&&r<=4519||4602<=r&&r<=4607||9001<=r&&r<=9002||11904<=r&&r<=11929||11931<=r&&r<=12019||12032<=r&&r<=12245||12272<=r&&r<=12283||12289<=r&&r<=12350||12353<=r&&r<=12438||12441<=r&&r<=12543||12549<=r&&r<=12589||12593<=r&&r<=12686||12688<=r&&r<=12730||12736<=r&&r<=12771||12784<=r&&r<=12830||12832<=r&&r<=12871||12880<=r&&r<=13054||13056<=r&&r<=19903||19968<=r&&r<=42124||42128<=r&&r<=42182||43360<=r&&r<=43388||44032<=r&&r<=55203||55216<=r&&r<=55238||55243<=r&&r<=55291||63744<=r&&r<=64255||65040<=r&&r<=65049||65072<=r&&r<=65106||65108<=r&&r<=65126||65128<=r&&r<=65131||110592<=r&&r<=110593||127488<=r&&r<=127490||127504<=r&&r<=127546||127552<=r&&r<=127560||127568<=r&&r<=127569||131072<=r&&r<=194367||177984<=r&&r<=196605||196608<=r&&r<=262141?"W":32<=r&&r<=126||162<=r&&r<=163||165<=r&&r<=166||172===r||175===r||10214<=r&&r<=10221||10629<=r&&r<=10630?"Na":161===r||164===r||167<=r&&r<=168||170===r||173<=r&&r<=174||176<=r&&r<=180||182<=r&&r<=186||188<=r&&r<=191||198===r||208===r||215<=r&&r<=216||222<=r&&r<=225||230===r||232<=r&&r<=234||236<=r&&r<=237||240===r||242<=r&&r<=243||247<=r&&r<=250||252===r||254===r||257===r||273===r||275===r||283===r||294<=r&&r<=295||299===r||305<=r&&r<=307||312===r||319<=r&&r<=322||324===r||328<=r&&r<=331||333===r||338<=r&&r<=339||358<=r&&r<=359||363===r||462===r||464===r||466===r||468===r||470===r||472===r||474===r||476===r||593===r||609===r||708===r||711===r||713<=r&&r<=715||717===r||720===r||728<=r&&r<=731||733===r||735===r||768<=r&&r<=879||913<=r&&r<=929||931<=r&&r<=937||945<=r&&r<=961||963<=r&&r<=969||1025===r||1040<=r&&r<=1103||1105===r||8208===r||8211<=r&&r<=8214||8216<=r&&r<=8217||8220<=r&&r<=8221||8224<=r&&r<=8226||8228<=r&&r<=8231||8240===r||8242<=r&&r<=8243||8245===r||8251===r||8254===r||8308===r||8319===r||8321<=r&&r<=8324||8364===r||8451===r||8453===r||8457===r||8467===r||8470===r||8481<=r&&r<=8482||8486===r||8491===r||8531<=r&&r<=8532||8539<=r&&r<=8542||8544<=r&&r<=8555||8560<=r&&r<=8569||8585===r||8592<=r&&r<=8601||8632<=r&&r<=8633||8658===r||8660===r||8679===r||8704===r||8706<=r&&r<=8707||8711<=r&&r<=8712||8715===r||8719===r||8721===r||8725===r||8730===r||8733<=r&&r<=8736||8739===r||8741===r||8743<=r&&r<=8748||8750===r||8756<=r&&r<=8759||8764<=r&&r<=8765||8776===r||8780===r||8786===r||8800<=r&&r<=8801||8804<=r&&r<=8807||8810<=r&&r<=8811||8814<=r&&r<=8815||8834<=r&&r<=8835||8838<=r&&r<=8839||8853===r||8857===r||8869===r||8895===r||8978===r||9312<=r&&r<=9449||9451<=r&&r<=9547||9552<=r&&r<=9587||9600<=r&&r<=9615||9618<=r&&r<=9621||9632<=r&&r<=9633||9635<=r&&r<=9641||9650<=r&&r<=9651||9654<=r&&r<=9655||9660<=r&&r<=9661||9664<=r&&r<=9665||9670<=r&&r<=9672||9675===r||9678<=r&&r<=9681||9698<=r&&r<=9701||9711===r||9733<=r&&r<=9734||9737===r||9742<=r&&r<=9743||9748<=r&&r<=9749||9756===r||9758===r||9792===r||9794===r||9824<=r&&r<=9825||9827<=r&&r<=9829||9831<=r&&r<=9834||9836<=r&&r<=9837||9839===r||9886<=r&&r<=9887||9918<=r&&r<=9919||9924<=r&&r<=9933||9935<=r&&r<=9953||9955===r||9960<=r&&r<=9983||10045===r||10071===r||10102<=r&&r<=10111||11093<=r&&r<=11097||12872<=r&&r<=12879||57344<=r&&r<=63743||65024<=r&&r<=65039||65533===r||127232<=r&&r<=127242||127248<=r&&r<=127277||127280<=r&&r<=127337||127344<=r&&r<=127386||917760<=r&&r<=917999||983040<=r&&r<=1048573||1048576<=r&&r<=1114109?"A":"N"};function Ie(t,e={},i){i||(i=1);const{fontStyle:r=e.fontStyle,fontVariant:o=e.fontVariant,fontWeight:n=e.fontWeight,fontSize:s=e.fontSize,fontFamily:a=e.fontFamily}=t;return(r?r+" ":"")+(o?o+" ":"")+(n?n+" ":"")+s*i+"px "+(a||"sans-serif")}let ze=class t{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet="-/: .,@%'\"~",this._option=t,this._userSpec=null!=e?e:{},this.textSpec=this._initSpec(),st(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=st(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(nt(this._canvas)&&(st(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),nt(this._canvas)&&"undefined"!=typeof window&&void 0!==window.document&&globalThis&&st(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),nt(this._context)&&st(this._canvas)){const t=this._canvas.getContext("2d");st(t)&&(t.save(),t.font=Ie(this.textSpec),this._contextSaved=!0,this._context=t)}return!nt(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:n=r.fontVariant,fontWeight:s=(null!==(t=r.fontWeight)&&void 0!==t?t:"normal"),fontSize:a=(null!==(e=r.fontSize)&&void 0!==e?e:12),fontFamily:l=(null!==(i=r.fontFamily)&&void 0!==i?i:"sans-serif"),align:h,textAlign:c=(null!=h?h:"center"),baseline:d,textBaseline:u=(null!=d?d:"middle"),ellipsis:g,limit:p}=this._userSpec;let{lineHeight:f=a}=this._userSpec;if(dt(f)&&"%"===f[f.length-1]){const t=Number.parseFloat(f.substring(0,f.length-1))/100;f=a*t}return{fontStyle:o,fontVariant:n,fontFamily:l,fontSize:a,fontWeight:s,textAlign:c,textBaseline:u,ellipsis:g,limit:p,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(nt(t))return{width:0,height:0};if(nt(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:n,ellipsis:s,limit:a,lineHeight:l}=this.textSpec;let h;try{const c=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:n,ellipsis:!!s,maxLineWidth:a||1/0,lineHeight:l});h={width:c.width(),height:c.height()}}catch(e){this._notSupportVRender=!0,h=this.measureWithNaiveCanvas(t)}return h}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:null!==(e=o)&&void 0!==e?e:r,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(e){const i={width:0,height:0};for(let r=0;r<e.length;r++){const o=e[r];let n=this._measureSpecialChar(o);nt(n)&&t.NUMBERS_CHAR_SET.includes(o)&&(n=this._measureNumberChar()),nt(n)&&["F","W"].includes(Le(o))&&(n=this._measureFullSizeChar()),nt(n)&&(n=this._measureLetterChar()),i.width+=n.width,i.height=Math.max(i.height,n.height),!nt(n.fontBoundingBoxAscent)&&(i.fontBoundingBoxAscent=n.fontBoundingBoxAscent),!nt(n.fontBoundingBoxDescent)&&(i.fontBoundingBoxDescent=n.fontBoundingBoxDescent)}return i}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let e=0;e<t.length;e++){const o=t[e],n=["F","W"].includes(Le(o))?1:.53;i.width+=n*r}return i.height=null!==(e=o)&&void 0!==e?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,n={width:0,height:0};if(nt(t))return n;if(ut(t)){const s=t.filter(st).map((t=>t.toString()));return 0===s.length?n:1===s.length?e(s[0]):{width:s.reduce(((t,i)=>Math.max(t,e(i).width)),0),height:s.length*((null!==(i=o)&&void 0!==i?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(nt(this._numberCharSize)){const e=this._standardMethod(t.NUMBERS_CHAR_SET);this._numberCharSize={width:e.width/t.NUMBERS_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return nt(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(t.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(nt(this._letterCharSize)){const e=this._standardMethod(t.ALPHABET_CHAR_SET);this._letterCharSize={width:e.width/t.ALPHABET_CHAR_SET.length,height:e.height,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return st(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){st(this._canvas)&&(this._canvas=null),st(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}};ze.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",ze.NUMBERS_CHAR_SET="0123456789",ze.FULL_SIZE_CHAR="字";const Oe=(t,e)=>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),De=(t,e)=>{const i=[{x:Math.cos(t.angle),y:Math.sin(t.angle)},{x:-Math.sin(t.angle),y:Math.cos(t.angle)},{x:Math.cos(e.angle),y:Math.sin(t.angle)},{x:-Math.sin(e.angle),y:Math.cos(t.angle)}];function r(t,e,i){const r=t.getRotatedCorners().map((t=>t.x*e+t.y*i));return{min:Math.min(...r),max:Math.max(...r)}}let o=0;for(const n of i){const i=r(t,n.x,n.y),s=r(e,n.x,n.y);let a;a=i.max<s.min?s.min-i.max:s.max<i.min?i.min-s.max:0,o=Math.max(o,a)}return o};function We(t,e,i){const{x1:r,y1:o,x2:n,y2:s}=e;return i.onlyTranslate()?(t!==e&&t.setValue(e.x1,e.y1,e.x2,e.y2),t.translate(i.e,i.f),e):(t.clear(),t.add(i.a*r+i.c*o+i.e,i.b*r+i.d*o+i.f),t.add(i.a*n+i.c*o+i.e,i.b*n+i.d*o+i.f),t.add(i.a*n+i.c*s+i.e,i.b*n+i.d*s+i.f),t.add(i.a*r+i.c*s+i.e,i.b*r+i.d*s+i.f),e)}let Ne=class t{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new t(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return ut(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return We(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:n,y2:s}=this,a=Math.cos(t),l=Math.sin(t),h=e-e*a+i*l,c=i-e*l-i*a;return[a*r-l*o+h,l*r+a*o+c,a*r-l*s+h,l*r+a*s+c,a*n-l*o+h,l*n+a*o+c,a*n-l*s+h,l*n+a*s+c]}scalePoints(t,e,i,r){const{x1:o,y1:n,x2:s,y2:a}=this;return[t*o+(1-t)*i,e*n+(1-e)*r,t*s+(1-t)*i,e*a+(1-e)*r]}},Ge=class extends Ne{};class je extends Ne{constructor(t,e=0){var i;super(t),t&&(this.angle=null!==(i=t.angle)&&void 0!==i?i:e)}intersects(t){return Ee(this,t)}setValue(t=0,e=0,i=0,r=0,o=0){return super.setValue(t,e,i,r),this.angle=o,this}clone(){return new je(this)}getRotatedCorners(){const t={x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2};return[Pe({x:this.x1,y:this.y1},this.angle,t),Pe({x:this.x2,y:this.y1},this.angle,t),Pe({x:this.x1,y:this.y2},this.angle,t),Pe({x:this.x2,y:this.y2},this.angle,t)]}}class Ve{constructor(t=1,e=0,i=0,r=1,o=0,n=0){this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=n}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,r,o,n){return!(this.e!==o||this.f!==n||this.a!==t||this.d!==r||this.b!==e||this.c!==i)}setValue(t,e,i,r,o,n){return this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=n,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,r=this.d,o=this.e,n=this.f,s=new Ve,a=t*r-e*i;return s.a=r/a,s.b=-e/a,s.c=-i/a,s.d=t/a,s.e=(i*n-r*o)/a,s.f=-(t*n-e*o)/a,s}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a*e+this.c*i,o=this.b*e+this.d*i,n=this.a*-i+this.c*e,s=this.b*-i+this.d*e;return this.a=r,this.b=o,this.c=n,this.d=s,this}rotateByCenter(t,e,i){const r=Math.cos(t),o=Math.sin(t),n=(1-r)*e+o*i,s=(1-r)*i-o*e,a=r*this.a-o*this.b,l=o*this.a+r*this.b,h=r*this.c-o*this.d,c=o*this.c+r*this.d,d=r*this.e-o*this.f+n,u=o*this.e+r*this.f+s;return this.a=a,this.b=l,this.c=h,this.d=c,this.e=d,this.f=u,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,r,o,n){return this.multiply(t,e,i,r,o,n),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:r,e:o,f:n}=this;return this.a=e,this.b=t,this.c=r,this.d=i,this.e=n,this.f=o,this}multiply(t,e,i,r,o,n){const s=this.a,a=this.b,l=this.c,h=this.d,c=s*t+l*e,d=a*t+h*e,u=s*i+l*r,g=a*i+h*r,p=s*o+l*n+this.e,f=a*o+h*n+this.f;return this.a=c,this.b=d,this.c=u,this.d=g,this.e=p,this.f=f,this}interpolate(t,e){const i=new Ve;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:r,c:o,d:n,e:s,f:a}=this,l=i*n-r*o,h=n/l,c=-r/l,d=-o/l,u=i/l,g=(o*a-n*s)/l,p=-(i*a-r*s)/l,{x:f,y:m}=t;e.x=f*h+m*d+g,e.y=f*c+m*u+p}onlyTranslate(t=1){return this.a===t&&0===this.b&&0===this.c&&this.d===t}clone(){return new Ve(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,r=this.d,o=t*r-e*i,n={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!==t||0!==e){const s=Math.sqrt(t*t+e*e);n.rotateDeg=e>0?Math.acos(t/s):-Math.acos(t/s),n.scaleX=s,n.scaleY=o/s,n.skewX=(t*i+e*r)/o,n.skewY=0}else if(0!==i||0!==r){const s=Math.sqrt(i*i+r*r);n.rotateDeg=Math.PI/2-(r>0?Math.acos(-i/s):-Math.acos(i/s)),n.scaleX=o/s,n.scaleY=s,n.skewX=0,n.skewY=(t*i+e*r)/o}return n.rotateDeg=180*n.rotateDeg/Math.PI,n}}class Ue{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:r=this.L_TIME,R_COUNT:o=this.R_COUNT}=e;if(t.size<i)return 0;let n=0;const s=e=>{n++,t.delete(e)},a=Date.now();return t.forEach(((t,e)=>{if(t.timestamp.length<o)return s(e);let i=0;for(;a-t.timestamp[t.timestamp.length-1-i]<r&&(i++,!(i>=o)););if(i<o)return s(e);for(;a-t.timestamp[0]>r;)t.timestamp.shift()})),n}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:r=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>r&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();t.forEach((t=>{for(;r-t.timestamp[0]>i;)t.timestamp.shift()}))}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();for(;r-t.timestamp[0]>i;)t.timestamp.shift()}}function Ke(t,e,i){e/=100,i/=100;const r=(1-Math.abs(2*i-1))*e,o=r*(1-Math.abs(t/60%2-1)),n=i-r/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=r,a=o,l=0):60<=t&&t<120?(s=o,a=r,l=0):120<=t&&t<180?(s=0,a=r,l=o):180<=t&&t<240?(s=0,a=o,l=r):240<=t&&t<300?(s=o,a=0,l=r):300<=t&&t<360&&(s=r,a=0,l=o),s=Math.round(255*(s+n)),a=Math.round(255*(a+n)),l=Math.round(255*(l+n)),{r:s,g:a,b:l}}function $e(t,e,i){t/=255,e/=255,i/=255;const r=Math.min(t,e,i),o=Math.max(t,e,i),n=o-r;let s=0,a=0,l=0;return s=0===n?0:o===t?(e-i)/n%6:o===e?(i-t)/n+2:(t-e)/n+4,s=Math.round(60*s),s<0&&(s+=360),l=(o+r)/2,a=0===n?0:n/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const Xe=/^#([0-9a-f]{3,8})$/,Ye={transparent:4294967040},qe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ze(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Je(t){return ft(t)?new ri(t>>16,t>>8&255,255&t,1):ut(t)?new ri(t[0],t[1],t[2]):new ri(255,255,255)}function Qe(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ti(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const ei=(t,e)=>{const i=Xe.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new ri((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?Je(t):8===e?new ri(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};let ii=class t{static Brighter(e,i=1){return 1===i?e:new t(e).brighter(i).toRGBA()}static SetOpacity(e,i=1){return 1===i?e:new t(e).setOpacity(i).toRGBA()}static getColorBrightness(e,i="hsl"){const r=e instanceof t?e:new t(e);switch(i){case"hsv":default:return r.getHSVBrightness();case"hsl":return r.getHSLBrightness();case"lum":return r.getLuminance();case"lum2":return r.getLuminance2();case"lum3":return r.getLuminance3();case"wcag":return r.getLuminanceWCAG()}}static parseColorString(t){if(st(Ye[t]))return function(t){return ft(t)?new ri(t>>>24,t>>>16&255,t>>>8&255,255&t):ut(t)?new ri(t[0],t[1],t[2],t[3]):new ri(255,255,255,1)}(Ye[t]);if(st(qe[t]))return Je(qe[t]);const e=`${t}`.trim().toLowerCase(),i=ei(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new ri(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=Ke(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new ri(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(e){const i=t.parseColorString(e);this.color=i||new ri(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=$e(this.color.r,this.color.g,this.color.b),n=Ke(nt(t)?o.h:Zt(t,0,360),nt(e)?o.s:e>=0&&e<=1?100*e:e,nt(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new ri(n.r,n.g,n.b,r),this}setRGB(t,e,i){return!nt(t)&&(this.color.r=t),!nt(e)&&(this.color.g=e),!nt(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=ei(e,!0);return null!=i?i:this}setColorName(t){const e=qe[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let r,o,n;return r=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),o=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),n=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*r+.7152*o+.0722*n}clone(){return new t(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=Qe(t.color.r),this.color.g=Qe(t.color.g),this.color.b=Qe(t.color.b),this}copyLinearToSRGB(t){return this.color.r=ti(t.color.r),this.color.g=ti(t.color.g),this.color.b=ti(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},ri=class{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),st(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${Ze(this.r)+Ze(this.g)+Ze(this.b)+(1===this.opacity?"":Ze(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=$e(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${r}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}};var oi=Object.freeze({__proto__:null,Color:ii,DEFAULT_COLORS:qe,RGB:ri,hexToRgb:function(t){let e="",i="",r="";const o="#"===t[0]?1:0;for(let n=o;n<t.length;n++)"#"!==t[n]&&(n<o+2?e+=t[n]:n<o+4?i+=t[n]:n<o+6&&(r+=t[n]));return[parseInt(e,16),parseInt(i,16),parseInt(r,16)]},hslToRgb:Ke,interpolateRgb:function(t,e){const i=t.r,r=e.r,o=t.g,n=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+r*t),c=Math.round(o*(1-t)+n*t),d=Math.round(s*(1-t)+a*t);return new ri(e,c,d,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:$e});function ni(t){if(mt(t))return[t,t,t,t];if(ut(t)){const e=t.length;if(1===e){const e=t[0];return[e,e,e,e]}if(2===e){const[e,i]=t;return[e,i,e,i]}if(3===e){const[e,i,r]=t;return[e,i,r,i]}if(4===e)return t}if(at(t)){const{top:e=0,right:i=0,bottom:r=0,left:o=0}=t;return[e,i,r,o]}return[0,0,0,0]}const si=ae-1e-8;class ai{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,r,o,n){if(Math.abs(o-r)>si)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let s,a,l,h,c=1/0,d=-1/0,u=1/0,g=-1/0;function p(t){l=i*Math.cos(t),h=i*Math.sin(t),l<c&&(c=l),l>d&&(d=l),h<u&&(u=h),h>g&&(g=h)}if(p(r),p(o),o!==r)if((r%=ae)<0&&(r+=ae),(o%=ae)<0&&(o+=ae),o<r&&(n=!n,s=r,r=o,o=s),n)for(o-=ae,s=r-r%se,a=0;a<4&&s>o;++a,s-=se)p(s);else for(s=r-r%se+se,a=0;a<4&&s<o;++a,s+=se)p(s);this.bounds.add(t+c,e+u),this.bounds.add(t+d,e+g)}arcTo(t,e,i,r,o){this.bounds.add(t,e)}bezierCurveTo(t,e,i,r,o,n){this.bounds.add(t,e),this.bounds.add(i,r),this.bounds.add(o,n)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,r){this.bounds.add(t,e),this.bounds.add(i,r)}rect(t,e,i,r){this.bounds.add(t,e),this.bounds.add(t+i,e+r)}clear(){this.bounds.clear()}release(...t){}}class li{constructor(){this._curves=[],this.bounds=new Ge}get curves(){return this._curves}getCurveLengths(){return this._curves.map((t=>t.getLength()))}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const hi=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,ci={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},di={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let ui,gi,pi,fi,mi,bi;var yi,Ci,wi,vi,xi,_i;function Si(t){const e=t[0],i=t[1],r=t[2],o=t[3],n=t[4],s=t[5],a=t[6],l=t[7],h=l*n,c=-a*s,d=a*n,u=l*s,g=Math.cos(r),p=Math.sin(r),f=Math.cos(o),m=Math.sin(o),b=.5*(o-r),y=Math.sin(.5*b),C=8/3*y*y/Math.sin(b),w=e+g-C*p,v=i+p+C*g,x=e+f,_=i+m,S=x+C*m,A=_-C*f;return[h*w+c*v,d*w+u*v,h*S+c*A,d*S+u*A,h*x+c*_,d*x+u*_]}function Ai(t,e,i,r){const o=function(t,e,i,r,o,n,s,a,l){const h=ve(s),c=Math.sin(h),d=Math.cos(h),u=d*(a-t)*.5+c*(l-e)*.5,g=d*(l-e)*.5-c*(a-t)*.5;let p=u*u/((i=Math.abs(i))*i)+g*g/((r=Math.abs(r))*r);p>1&&(p=Math.sqrt(p),i*=p,r*=p);const f=d/i,m=c/i,b=-c/r,y=d/r,C=f*a+m*l,w=b*a+y*l,v=f*t+m*e,x=b*t+y*e;let _=1/((v-C)*(v-C)+(x-w)*(x-w))-.25;_<0&&(_=0);let S=Math.sqrt(_);n===o&&(S=-S);const A=.5*(C+v)-S*(x-w),T=.5*(w+x)+S*(v-C),R=Math.atan2(w-T,C-A);let B=Math.atan2(x-T,v-A)-R;B<0&&1===n?B+=ae:B>0&&0===n&&(B-=ae);const M=Math.ceil(Math.abs(B/(se+.001))),P=[];for(let t=0;t<M;++t){const e=R+t*B/M,o=R+(t+1)*B/M;P[t]=[A,T,e,o,i,r,c,d]}return P}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,i);for(let e=0;e<o.length;++e){const i=Si(o[e]);t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}}!function(t){t[t.NONE=0]="NONE",t[t.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",t[t.UPDATE_SHAPE=2]="UPDATE_SHAPE",t[t.CLEAR_SHAPE=253]="CLEAR_SHAPE",t[t.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",t[t.INIT=179]="INIT",t[t.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",t[t.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",t[t.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",t[t.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",t[t.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",t[t.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",t[t.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",t[t.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"}(yi||(yi={})),function(t){t[t.GLOBAL=1]="GLOBAL",t[t.LOCAL=16]="LOCAL",t[t.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",t[t.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"}(Ci||(Ci={})),function(t){t[t.INIT=0]="INIT",t[t.DEFAULT=1]="DEFAULT",t[t.STATE=2]="STATE",t[t.ANIMATE_BIND=10]="ANIMATE_BIND",t[t.ANIMATE_PLAY=11]="ANIMATE_PLAY",t[t.ANIMATE_START=12]="ANIMATE_START",t[t.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",t[t.ANIMATE_END=14]="ANIMATE_END",t[t.TRANSLATE=20]="TRANSLATE",t[t.TRANSLATE_TO=21]="TRANSLATE_TO",t[t.SCALE=22]="SCALE",t[t.SCALE_TO=23]="SCALE_TO",t[t.ROTATE=24]="ROTATE",t[t.ROTATE_TO=25]="ROTATE_TO"}(wi||(wi={})),function(t){t[t.ROW=1]="ROW",t[t.COLUMN=2]="COLUMN"}(vi||(vi={})),function(t){t[t.CubicBezierCurve=0]="CubicBezierCurve",t[t.QuadraticBezierCurve=1]="QuadraticBezierCurve",t[t.ArcCurve=2]="ArcCurve",t[t.LineCurve=3]="LineCurve",t[t.EllipseCurve=4]="EllipseCurve",t[t.MoveCurve=5]="MoveCurve"}(xi||(xi={})),function(t){t[t.beforeFillStroke=0]="beforeFillStroke",t[t.afterFillStroke=1]="afterFillStroke"}(_i||(_i={}));const Ti=[(t,e,i,r,o,n,s)=>e.arc(t[1]*o+i,t[2]*n+r,t[3]*(o+n)/2,t[4],t[5],t[6],s),(t,e,i,r,o,n,s)=>e.arcTo(t[1]*o+i,t[2]*n+r,t[3]*o+i,t[4]*n+r,t[5]*(o+n)/2,s),(t,e,i,r,o,n,s)=>e.bezierCurveTo(t[1]*o+i,t[2]*n+r,t[3]*o+i,t[4]*n+r,t[5]*o+i,t[6]*n+r,s),(t,e,i,r)=>e.closePath(),(t,e,i,r,o,n)=>e.ellipse(t[1]*o+i,t[2]*n+r,t[3]*o,t[4]*n,t[5],t[6],t[7],t[8]),(t,e,i,r,o,n,s)=>e.lineTo(t[1]*o+i,t[2]*n+r,s),(t,e,i,r,o,n,s)=>e.moveTo(t[1]*o+i,t[2]*n+r,s),(t,e,i,r,o,n,s)=>e.quadraticCurveTo(t[1]*o+i,t[2]*n+r,t[3]*o+i,t[4]*n+r,s),(t,e,i,r,o,n,s)=>e.rect(t[1]*o+i,t[2]*n+r,t[3]*o,t[4]*n,s)];function Ri(t,e,i=0,r=0,o=1,n=1,s){for(let a=0;a<t.length;a++){const l=t[a];Ti[l[0]](l,e,i,r,o,n,s)}}class Bi{getLength(t){return null!=t?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function Mi(t,e){let i=0;const r=t.length;for(let o=0;o<r;o++){const n=t[o],s=e[o],a=t[(o+1)%r],l=e[(o+1)%r];i+=we.distanceNN(n,s,a,l)}return i/2}function Pi(t,e,i,r,o){const n=1-o;return n*n*n*t+3*e*o*n*n+3*i*o*o*n+r*o*o*o}function Hi(t,e,i,r,o){const n=Pi(t.x,e.x,i.x,r.x,o),s=Pi(t.y,e.y,i.y,r.y,o);return new Ce(n,s)}function ki(t,e,i,r){const o=1-r;return o*o*t+2*o*r*e+r*r*i}function Ei(t,e,i,r){const o=ki(t.x,e.x,i.x,r),n=ki(t.y,e.y,i.y,r);return new Ce(o,n)}function Fi(t,e){const{p0:i,p1:r,p2:o,p3:n}=t,s=Hi(i,r,o,n,e),a=we.pointAtPP(i,r,e),l=we.pointAtPP(r,o,e),h=we.pointAtPP(o,n,e),c=we.pointAtPP(a,l,e),d=we.pointAtPP(l,h,e);return[new Li(i,a,c,s),new Li(s,d,h,n)]}class Li extends Bi{constructor(t,e,i,r){super(),this.type=xi.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(!1!==this.defined)return Hi(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?(t=this.p0,e=this.p1,i=this.p2,r=this.p3,Mi([t.x,e.x,i.x,r.x],[t.y,e.y,i.y,r.y])):60;var t,e,i,r}calcProjLength(t){return t===vi.ROW?he(this.p0.x-this.p3.x):t===vi.COLUMN?he(this.p0.y-this.p3.y):0}getAngleAt(t){const e=ue(t-.01,0),i=ge(t+.01,1),r=this.getPointAt(e),o=this.getPointAt(i);return ce(o.y-r.y,o.x-r.x)}draw(t,e,i,r,o,n){if(t.moveTo(this.p0.x*r+e,this.p0.y*o+i),n>=1)t.bezierCurveTo(this.p1.x*r+e,this.p1.y*o+i,this.p2.x*r+e,this.p2.y*o+i,this.p3.x*r+e,this.p3.y*o+i);else if(n>0){const[s]=Fi(this,n);t.bezierCurveTo(s.p1.x*r+e,s.p1.y*o+i,s.p2.x*r+e,s.p2.y*o+i,s.p3.x*r+e,s.p3.y*o+i)}}includeX(t){const e=ge(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=ue(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){const e=ge(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(ue(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}}function Ii(t,e){const{p0:i,p1:r}=t,o=we.pointAtPP(i,r,e);return[new zi(i,o),new zi(o,r)]}class zi extends Bi{constructor(t,e){super(),this.type=xi.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(!1!==this.defined)return we.pointAtPP(this.p0,this.p1,t);throw new Error("defined为false的点不能getPointAt")}getAngleAt(t){return null==this.angle&&(this.angle=ce(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?we.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===vi.ROW?he(this.p0.x-this.p1.x):t===vi.COLUMN?he(this.p0.y-this.p1.y):0}draw(t,e,i,r,o,n){if(t.moveTo(this.p0.x*r+e,this.p0.y*o+i),n>=1)t.lineTo(this.p1.x*r+e,this.p1.y*o+i);else if(n>0){const s=this.getPointAt(n);t.lineTo(s.x*r+e,s.y*o+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);const r=(t-e.x)/(i.x-e.x);return e.y+r*(i.y-e.y)}return 1/0}}class Oi{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,r,o,n,s,a){const l=new Li(new Ce(this._lastX,this._lastY),new Ce(t,e),new Ce(i,r),new Ce(o,n));l.originP1=this._lastOriginP,l.originP2=a,l.defined=s,this.curves.push(l),this._lastX=o,this._lastY=n,this._lastOriginP=a}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(t,e,i,r){const o=this.addLinearCurve(t,e,i,this._lastOriginP,r);this.curves.push(o),this._lastX=t,this._lastY=e,this._lastOriginP=r}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,r){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,r,o){const n=new zi(new Ce(this._lastX,this._lastY),new Ce(t,e));return n.originP1=r,n.originP2=o,n.defined=i,n}getPointAt(t){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===vi.COLUMN){if(!this.curves.length)return 0;const t=this.curves[0],i=this.curves[this.curves.length-1],r=null!==(e=i.p3)&&void 0!==e?e:i.p1;return he(t.p0.y-r.y)}if(t===vi.ROW){if(!this.curves.length)return 0;const t=this.curves[0],e=this.curves[this.curves.length-1],r=null!==(i=e.p3)&&void 0!==i?i:e.p1;return he(t.p0.x-r.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce(((t,e)=>t+e.getLength()),0)),this.length}}class Di extends Oi{bezierCurveTo(t,e,i,r,o,n,s,a){return super.bezierCurveTo(e,t,r,i,n,o,s,a)}lineTo(t,e,i,r){return super.lineTo(e,t,i,r)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function Wi(t,e,i=1){let r=!1;for(let i=0,o=e.length;i<=o;i++)i>=o===r&&((r=!r)?t.lineStart():t.lineEnd()),r&&t.point(e[i])}function Ni(t,e,i){const r=null!=e?e:he(i[i.length-1].x-i[0].x)>he(i[i.length-1].y-i[0].y)?vi.ROW:vi.COLUMN;return"monotoneY"===t?new Di(t,r):new Oi(t,r)}class Gi{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function ji(t,e={}){const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;const o=Ni("linear",i,t);return function(t,e){Wi(t,e,1)}(new Gi(o,r),t),o}function Vi(t,e,i,r,o){t.context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6,r,t.lastPoint1)}class Ui{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){2===this._point&&Vi(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:Vi(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function Ki(t,e={}){const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;if(t.length<3-Number(!!r))return ji(t,e);const o=Ni("basis",i,t);return function(t,e){Wi(t,e,2)}(new Ui(o,r),t),o}function $i(t){return t<0?-1:1}function Xi(t,e,i){const r=t._x1-t._x0,o=e-t._x1,n=(t._y1-t._y0)/(r||Number(o<0&&-0)),s=(i-t._y1)/(o||Number(r<0&&-0)),a=(n*o+s*r)/(r+o);return($i(n)+$i(s))*Math.min(Math.abs(n),Math.abs(s),.5*Math.abs(a))||0}function Yi(t,e){const i=t._x1-t._x0;return i?(3*(t._y1-t._y0)/i-e)/2:e}function qi(t,e,i,r,o){const n=t._x0,s=t._y0,a=t._x1,l=t._y1,h=(a-n)/3;t.context.bezierCurveTo(n+h,s+h*e,a-h,l-h*i,a,l,r,t.lastPoint1)}class Zi{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:qi(this,this._t0,Yi(this,this._t0),!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1)}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,r=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,!1!==this._lastDefined1&&!1!==this._lastDefined2,t):this.context.moveTo(i,r,t);break;case 1:this._point=2;break;case 2:this._point=3,qi(this,Yi(this,e=Xi(this,i,r)),e,!1!==this._lastDefined1&&!1!==this._lastDefined2);break;default:qi(this,this._t0,e=Xi(this,i,r),!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=!1!==t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class Ji extends Zi{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function Qi(t,e={}){const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;if(t.length<3-Number(!!r))return ji(t,e);const o=Ni("monotoneX",i,t);return function(t,e){Wi(t,e,2)}(new Zi(o,r),t),o}function tr(t,e={}){const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;if(t.length<3-Number(!!r))return ji(t,e);const o=Ni("monotoneY",i,t);return function(t,e){Wi(t,e,2)}(new Ji(o,r),t),o}let er=class{constructor(t,e=.5,i){this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&2===this._point&&this.context.lineTo(this._x,this._y,!1!==this._lastDefined,this.lastPoint),(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(e,i,!1!==this._lastDefined&&!1!==t.defined,t);else{const r=this._x*(1-this._t)+e*this._t;.5===this._t?this.context.lineTo(r,this._y,!1!==this._lastDefined,this.lastPoint):this.context.lineTo(r,this._y,!1!==this._lastDefined&&!1!==t.defined,this.lastPoint),this.context.lineTo(r,i,!1!==this._lastDefined&&!1!==t.defined,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};class ir extends er{lineEnd(){this.context.closePath()}}function rr(t,e,i={}){const{direction:r,startPoint:o}=i;if(t.length<2-Number(!!o))return null;const n=new Oi("step",null!=r?r:he(t[t.length-1].x-t[0].x)>he(t[t.length-1].y-t[0].y)?vi.ROW:vi.COLUMN);return or(new er(n,e,o),t),n}function or(t,e){return Wi(t,e,1)}class nr extends Gi{lineEnd(){this.context.closePath()}}function sr(t,e={}){const{direction:i,startPoint:r}=e;if(t.length<2-Number(!!r))return null;const o=Ni("linear",i,t);return function(t,e){Wi(t,e,1)}(new nr(o,r),t),o}function ar(t,e,i,r,o){let n=t._x1,s=t._y1,a=t._x2,l=t._y2;if(t._l01_a>oe){const e=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,i=3*t._l01_a*(t._l01_a+t._l12_a);n=(n*e-t._x0*t._l12_2a+t._x2*t._l01_2a)/i,s=(s*e-t._y0*t._l12_2a+t._y2*t._l01_2a)/i}if(t._l23_a>oe){const r=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,o=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*r+t._x1*t._l23_2a-e*t._l12_2a)/o,l=(l*r+t._y1*t._l23_2a-i*t._l12_2a)/o}t.context.bezierCurveTo(n,s,a,l,t._x2,t._y2,r,t.lastPoint1)}function lr(t,e){return function(i,r,o={}){const{direction:n,startPoint:s}=o;if(i.length<2-Number(!!s))return null;if(i.length<3-Number(!!s))return ji(i,o);const a=Ni(t,n,i);return Wi(new e(a,r,s),i,2),a}}const hr=lr("catmullRom",class{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||0!==this._line&&1===this._point)&&this.context.closePath(),this._line=1-this._line}point(t){const{x:e,y:i}=t;if(this._point){const t=this._x2-e,r=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(t*t+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:ar(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}});const cr=lr("catmullRomClosed",class{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,!1!==this._lastDefined1&&!1!==this._lastDefined2,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){const{x:e,y:i}=t;if(this._point){const t=this._x2-e,r=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(t*t+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:ar(this,e,i,!1!==this._lastDefined1&&!1!==this._lastDefined2)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}});class dr extends Bi{constructor(t,e,i){super(),this.type=xi.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(!1!==this.defined)return Ei(this.p0,this.p1,this.p2,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?(t=this.p0,e=this.p1,i=this.p2,Mi([t.x,e.x,i.x],[t.y,e.y,i.y])):60;var t,e,i}calcProjLength(t){return t===vi.ROW?he(this.p0.x-this.p2.x):t===vi.COLUMN?he(this.p0.y-this.p2.y):0}getAngleAt(t){const e=ue(t-.01,0),i=ge(t+.01,1),r=this.getPointAt(e),o=this.getPointAt(i);return ce(o.y-r.y,o.x-r.x)}draw(t,e,i,r,o,n){if(t.moveTo(this.p0.x*r+e,this.p0.y*o+i),n>=1)t.quadraticCurveTo(this.p1.x*r+e,this.p1.y*o+i,this.p2.x*r+e,this.p2.y*o+i);else if(n>0){const[s]=function(t,e){const{p0:i,p1:r,p2:o}=t,n=Ei(i,r,o,e),s=we.pointAtPP(i,r,e),a=we.pointAtPP(r,o,e);return[new dr(i,s,n),new dr(n,a,o)]}(this,n);t.quadraticCurveTo(s.p1.x*r+e,s.p1.y*o+i,s.p2.x*r+e,s.p2.y*o+i)}}getYAt(t){throw new Error("QuadraticBezierCurve暂不支持getYAt")}includeX(t){throw new Error("QuadraticBezierCurve暂不支持includeX")}}class ur{constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){const i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new zi(new Ce(this._lastX,this._lastY),new Ce(t,e))}quadraticCurveTo(t,e,i,r){const o=new dr(new Ce(this._lastX,this._lastY),new Ce(t,e),new Ce(i,r));this.path.addCurve(o),this._lastX=i,this._lastY=r}bezierCurveTo(t,e,i,r,o,n){const s=new Li(new Ce(this._lastX,this._lastY),new Ce(t,e),new Ce(i,r),new Ce(o,n));this.path.addCurve(s),this._lastX=o,this._lastY=n}arcTo(t,e,i,r,o){throw new Error("CurveContext不支持调用arcTo")}ellipse(t,e,i,r,o,n,s,a){throw new Error("CurveContext不支持调用ellipse")}rect(t,e,i,r){throw new Error("CurveContext不支持调用rect")}arc(t,e,i,r,o,n){throw new Error("CurveContext不支持调用arc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}}function gr(t,e,i){var r,o;switch(e){case"linear":default:return ji(t,i);case"basis":return Ki(t,i);case"monotoneX":return Qi(t,i);case"monotoneY":return tr(t,i);case"step":return rr(t,.5,i);case"stepClosed":return function(t,e,i={}){const{direction:r,startPoint:o}=i;if(t.length<2-Number(!!o))return null;const n=new Oi("step",null!=r?r:he(t[t.length-1].x-t[0].x)>he(t[t.length-1].y-t[0].y)?vi.ROW:vi.COLUMN);return or(new ir(n,e,o),t),n}(t,.5,i);case"stepBefore":return rr(t,0,i);case"stepAfter":return rr(t,1,i);case"catmullRom":return hr(t,null!==(r=null==i?void 0:i.curveTension)&&void 0!==r?r:.5,i);case"catmullRomClosed":return cr(t,null!==(o=null==i?void 0:i.curveTension)&&void 0!==o?o:.5,i);case"linearClosed":return sr(t,i)}}class pr extends li{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new ai(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([di.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([di.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.commandList.push([di.Q,t,e,i,r]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,o,n){return this.commandList.push([di.C,t,e,i,r,o,n]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,r,o,n),this}arcTo(t,e,i,r,o){return this.commandList.push([di.AT,t,e,i,r,o]),this._ctx&&this._ctx.arcTo(t,e,i,r,o),this}ellipse(t,e,i,r,o,n,s,a){return this.commandList.push([di.E,t,e,i,r,o,n,s,a]),this._ctx&&this._ctx.ellipse(t,e,i,r,o,n,s,a),this}rect(t,e,i,r){return this.commandList.push([di.R,t,e,i,r]),this._ctx&&this._ctx.rect(t,e,i,r),this}arc(t,e,i,r,o,n){return this.commandList.push([di.A,t,e,i,r,o,n]),this._ctx&&this._ctx.arc(t,e,i,r,o,n),this}closePath(){return this.commandList.push([di.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){const t=new ur(this);Ri(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){const t=[];t[di.M]=t=>`M${t[1]} ${t[2]}`,t[di.L]=t=>`L${t[1]} ${t[2]}`,t[di.Q]=t=>`Q${t[1]} ${t[2]} ${t[3]} ${t[4]}`,t[di.C]=t=>`C${t[1]} ${t[2]} ${t[3]} ${t[4]} ${t[5]} ${t[6]}`,t[di.A]=t=>{const e=[],i=t[1],r=t[2],o=t[3];((t,e,i,r,o,n,s,a=!1)=>{const l=2*Math.PI,h=(e%l+l)%l;let c,d=(i%l+l)%l;a?(d>=h&&(d-=l),c=d-h):(d<=h&&(d+=l),c=d-h);const u=Math.ceil(Math.abs(c)/(.5*Math.PI)),g=c/u;for(let e=0;e<u;e++){const i=h+g*e,l=h+g*(e+1),c=4/3*Math.tan(Math.abs(g)/4),d=Math.cos(i),u=Math.sin(i),p=Math.cos(l),f=Math.sin(l),m=d*n+r,b=u*s+o,y=p*n+r,C=f*s+o,w=a?-1:1,v=n*c*w,x=s*c*w;t.push(m-v*u,b+x*d,y+v*f,C-x*p,y,C)}})(e,t[4],t[5],i,r,o,o,t[6]);let n="";for(let t=0;t<e.length;t+=6)n+=`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`;return n},t[di.R]=t=>`M${t[1]} ${t[2]} h${t[3]} v${t[4]} H${t[1]}Z`,t[di.Z]=t=>"Z",this.toStringCbList=t}const t=this.toStringCbList;let e="";return this.commandList.forEach((i=>{e+=t[i[0]](i)})),e}fromString(t,e,i,r,o){this.clear();const n=function(t){if(!t)return[];const e=t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(null===e)return[];let i,r;const o=[];for(let t=0,n=e.length;t<n;t++)if(ui=e[t],gi=ui.slice(1),pi=ui[0],i=[pi],r=gi.match(hi),null!==r){for(let t=0,e=r.length;t<e;t++)fi=r[t],mi=parseFloat(fi),Number.isNaN(mi)||i.push(mi);if(bi=ci[pi],i.length-1>bi){let t,e=pi;for(let r=1,n=i.length;r<n;r+=bi){t=[e];for(let e=r,o=r+bi;e<o;e++)t.push(i[e]);o.push(t),"m"===e?e="l":"M"===e&&(e="L")}}else o.push(i)}else o.push(i);return o}(t);return this._runCommandStrList(n,e,i,r,o),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:r}=t.attribute;if(!e)return;const o=gr(e,i);"x"===r?this.direction=vi.ROW:"y"===r?this.direction=vi.COLUMN:"auto"===r&&(this.direction=o.direction),this._curves=o.curves}fromCustomPath2D(t,e,i,r,o){return this.clear(),this._runCommandList(t.commandList,e,i,r,o),this._updateBounds(),this}transform(t,e,i,r){const o=this.commandList;if(!this.transformCbList){const t=[];t[di.M]=this.moveToTransform,t[di.L]=this.lineToTransform,t[di.Q]=this.quadraticCurveToTransform,t[di.C]=this.bezierCurveToTransform,t[di.AT]=this.arcToTransform,t[di.E]=this.ellipseTransform,t[di.R]=this.rectTransform,t[di.A]=this.arcTransform,t[di.Z]=this.closePathTransform,this.transformCbList=t}o.forEach((o=>{this.transformCbList[o[0]](o,t,e,i,r)})),this._updateBounds()}moveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}lineToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}quadraticCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i}bezierCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*r+e,t[6]=t[6]*o+i}arcToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*(r+o)/2}ellipseTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}rectTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}arcTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*(r+o)/2}closePathTransform(){}_runCommandStrList(t,e=0,i=0,r=1,o=1){let n,s,a,l,h,c=null,d=0,u=0,g=0,p=0;for(let f=0,m=t.length;f<m;++f){switch(n=t[f],1===r&&1===o||(n=mr(n,r,o)),n[0]){case"l":d+=n[1],u+=n[2],this.lineTo(d+e,u+i);break;case"L":d=n[1],u=n[2],this.lineTo(d+e,u+i);break;case"h":d+=n[1],this.lineTo(d+e,u+i);break;case"H":d=n[1],this.lineTo(d+e,u+i);break;case"v":u+=n[1],this.lineTo(d+e,u+i);break;case"V":u=n[1],this.lineTo(d+e,u+i);break;case"m":d+=n[1],u+=n[2],this.moveTo(d+e,u+i);break;case"M":d=n[1],u=n[2],this.moveTo(d+e,u+i);break;case"c":s=d+n[5],a=u+n[6],g=d+n[3],p=u+n[4],this.bezierCurveTo(d+n[1]+e,u+n[2]+i,g+e,p+i,s+e,a+i),d=s,u=a;break;case"C":d=n[5],u=n[6],g=n[3],p=n[4],this.bezierCurveTo(n[1]+e,n[2]+i,g+e,p+i,d+e,u+i);break;case"s":s=d+n[3],a=u+n[4],null===c[0].match(/[CcSs]/)?(g=d,p=u):(g=2*d-g,p=2*u-p),l=d+n[1],h=u+n[2],this.bezierCurveTo(g+e,p+i,l+e,h+i,s+e,a+i),g=l,p=h,d=s,u=a;break;case"S":s=n[3],a=n[4],null===c[0].match(/[CcSs]/)?(g=d,p=u):(g=2*d-g,p=2*u-p),l=n[1],h=n[2],this.bezierCurveTo(g+e,p+i,l+e,h+i,s+e,a+i),g=l,p=h,d=s,u=a;break;case"q":s=d+n[3],a=u+n[4],g=d+n[1],p=u+n[2],this.quadraticCurveTo(g+e,p+i,s+e,a+i),d=s,u=a;break;case"Q":s=n[3],a=n[4],this.quadraticCurveTo(n[1]+e,n[2]+i,s+e,a+i),d=s,u=a,g=n[1],p=n[2];break;case"t":s=d+n[1],a=u+n[2],null===c[0].match(/[QqTt]/)?(g=d,p=u):"t"===c[0]?(g=2*d-l,p=2*u-h):"q"===c[0]&&(g=2*d-g,p=2*u-p),l=g,h=p,this.quadraticCurveTo(g+e,p+i,s+e,a+i),d=s,u=a,g=d+n[1],p=u+n[2];break;case"T":s=n[1],a=n[2],g=2*d-g,p=2*u-p,this.quadraticCurveTo(g+e,p+i,s+e,a+i),d=s,u=a;break;case"a":Ai(this,d+e,u+i,[n[1],n[2],n[3],n[4],n[5],n[6]+d+e,n[7]+u+i]),d+=n[6],u+=n[7];break;case"A":Ai(this,d+e,u+i,[n[1],n[2],n[3],n[4],n[5],n[6]+e,n[7]+i]),d=n[6],u=n[7];break;case"z":case"Z":this.closePath()}c=n}}_runCommandList(t,e=0,i=0,r=1,o=1){if(0!==e||0!==i||1!==r||1!==o)for(let n=0,s=t.length;n<s;++n){const s=t[n].slice();switch(s[0]){case di.L:this.lineToTransform(s,e,i,r,o);break;case di.M:this.moveToTransform(s,e,i,r,o);break;case di.C:this.bezierCurveToTransform(s,e,i,r,o);break;case di.Q:this.quadraticCurveToTransform(s,e,i,r,o);break;case di.A:this.arcToTransform(s,e,i,r,o);break;case di.E:this.ellipseTransform(s,e,i,r,o);break;case di.R:this.rectTransform(s,e,i,r,o);break;case di.AT:this.arcToTransform(s,e,i,r,o);break;case di.Z:this.closePath()}}else this.commandList=t.map((t=>t.slice()))}_updateBounds(){this.bounds.clear(),Ri(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===vi.COLUMN){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return he(t.p0.y-e.p1.y)}if(this.direction===vi.ROW){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return he(t.p0.x-e.p1.x)}return this._curves.reduce(((t,e)=>t+e.getLength()),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){const i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let r=0;r<this._curves.length;r++){e=this._curves[r];const o=e.getLength(this.direction);if(i+o>=t)break;i+=o}const r=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(r),angle:e.getAngleAt(r)}}drawWithClipRange(t,e,i,r,o){this.tryBuildCurves();const n=this.getLength()*o;let s=0;for(let o=0;o<this._curves.length;o++){const a=this._curves[o],l=a.getLength(this.direction);if(!(s+l<=n)){const o=1-(s+l-n)/l;a.draw(t,i,r,e,e,o);break}a.draw(t,i,r,e,e,1),s+=l}}}const fr=["l",0,0,0,0,0,0,0];function mr(t,e,i){const r=fr[0]=t[0];if("a"===r||"A"===r)fr[1]=e*t[1],fr[2]=i*t[2],fr[3]=t[3],fr[4]=t[4],fr[5]=t[5],fr[6]=e*t[6],fr[7]=i*t[7];else if("h"===r||"H"===r)fr[1]=e*t[1];else if("v"===r||"V"===r)fr[1]=i*t[1];else for(let r=1,o=t.length;r<o;++r)fr[r]=(r%2==1?e:i)*t[r];return fr}const br={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Ve},yr={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},Cr={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},wr=Object.assign({outerBorder:Object.assign(Object.assign({},Cr),{distance:0}),innerBorder:Object.assign(Object.assign({},Cr),{distance:0})},Cr),vr={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:"PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,\n    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:X.fontBounding,keepCenterInLine:!1},xr=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null,vue:null},yr),wr),{alignSelf:"auto"}),{pickStrokeBuffer:0}),_r={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},Sr=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null,roughStyle:null},{_debug_bounds:!1}),xr),br),Ar=Object.assign(Object.assign({},Sr),{startAngle:0,endAngle:le,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),Tr=Object.assign(Object.assign(Object.assign({},Sr),_r),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),Rr=Object.assign(Object.assign({},Sr),{radius:1,startAngle:0,endAngle:le}),Br=Object.assign(Object.assign({},Sr),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),Mr=Object.assign(Object.assign({},Sr),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),Pr=Object.assign(Object.assign(Object.assign({},Sr),_r),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),Hr=Object.assign(Object.assign({},Sr),{path:new pr,fillStrokeOrder:1,clipRange:1,customPath:()=>{Xt.getInstance().warn("空函数")}}),kr=Object.assign(Object.assign({},Sr),{points:[],cornerRadius:0,closePath:!0}),Er=Object.assign(Object.assign({},Sr),{width:100,height:100,spikes:5,thickness:.5}),Fr=Object.assign(Object.assign({},Sr),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round"});Object.assign(Object.assign({},Sr),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round"});const Lr=Object.assign(Object.assign({},Sr),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),Ir=Object.assign(Object.assign(Object.assign({},Sr),vr),{strokeBoundsBuffer:0,keepDirIn3d:!0}),zr=Object.assign(Object.assign(Object.assign({},Sr),vr),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),Or=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},Sr),{fill:!0,cornerRadius:0,cornerType:"round"}),Dr=Object.assign(Object.assign({},Or),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1}),Wr=function(){const t={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/};let e="";function i(t){const i=new Error(e+": "+t);throw i.source=e,i}function r(){return o("linear",t.linearGradient,n)||o("radial",t.radialGradient,a)||o("conic",t.conicGradient,s)}function o(e,r,o){return function(r,n){const s=b(r);if(s){b(t.startCall)||i("Missing (");const r=function(r){const n=o();return n&&(b(t.comma)||i("Missing comma before color stops")),{type:e,orientation:n,colorStops:u(g)}}();return b(t.endCall)||i("Missing )"),r}}(r)}function n(){return m("directional",t.sideOrCorner,1)||m("angular",t.angleValue,1)}function s(){return m("angular",t.fromAngleValue,1)}function a(){let i,r,o=l();return o&&(i=[],i.push(o),r=e,b(t.comma)&&(o=l(),o?i.push(o):e=r)),i}function l(){let t=function(){const t=m("shape",/^(circle)/i,0);return t&&(t.style=f()||h()),t}()||function(){const t=m("shape",/^(ellipse)/i,0);return t&&(t.style=p()||h()),t}();if(t)t.at=c();else{const e=h();if(e){t=e;const i=c();i&&(t.at=i)}else{const e=d();e&&(t={type:"default-radial",at:e})}}return t}function h(){return m("extent-keyword",t.extentKeywords,1)}function c(){if(m("position",/^at/,0)){const t=d();return t||i("Missing positioning value"),t}}function d(){const t={x:p(),y:p()};if(t.x||t.y)return{type:"position",value:t}}function u(e){let r=e();const o=[];if(r)for(o.push(r);b(t.comma);)r=e(),r?o.push(r):i("One extra comma");return o}function g(){const e=m("hex",t.hexColor,1)||m("rgba",t.rgbaColor,1)||m("rgb",t.rgbColor,1)||m("literal",t.literalColor,0);return e||i("Expected color definition"),e.length=p(),e}function p(){return m("%",t.percentageValue,1)||m("position-keyword",t.positionKeywords,1)||f()}function f(){return m("px",t.pixelValue,1)||m("em",t.emValue,1)}function m(t,e,i){const r=b(e);if(r)return{type:t,value:r[i]}}function b(t){const i=/^[\n\r\t\s]+/.exec(e);i&&y(i[0].length);const r=t.exec(e);return r&&y(r[0].length),r}function y(t){e=e.substr(t)}return function(t){return e=t.toString(),function(){const t=u(r);return e.length>0&&i("Invalid input not EOF"),t}()}}();class Nr{static IsGradient(t){return!("string"==typeof t&&!t.includes("gradient"))}static IsGradientStr(t){return"string"==typeof t&&t.includes("gradient")}static Parse(t){if(Nr.IsGradientStr(t))try{const e=Wr(t)[0];if(e){if("linear"===e.type)return Nr.ParseLinear(e);if("radial"===e.type)return Nr.ParseRadial(e);if("conic"===e.type)return Nr.ParseConic(e)}}catch(e){return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,r=ne/2,o=parseFloat(e.value)/180*ne-r;return{gradient:"conical",x:.5,y:.5,startAngle:o,endAngle:o+le,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,r=ne/2;let o="angular"===e.type?parseFloat(e.value)/180*ne:0;for(;o<0;)o+=le;for(;o>=le;)o-=le;let n=0,s=0,a=0,l=0;return o<r?(n=0,s=1,a=Math.sin(o),l=s-Math.cos(o)):o<ne?(n=0,s=0,a=Math.cos(o-r),l=Math.sin(o-r)):o<ne+r?(n=1,s=0,a=n-Math.sin(o-ne),l=Math.cos(o-ne)):(n=1,a=n-Math.cos(o-r-ne),l-=Math.sin(o-r-ne)),{gradient:"linear",x0:n,y0:s,x1:a,y1:l,stops:i.map((t=>({color:t.value,offset:parseFloat(t.length.value)/100})))}}}function Gr(t,e,i){let r=e;const{a:o,b:n,c:s,d:a}=t.currentMatrix,l=Math.sign(o)*Math.sqrt(o*o+n*n),h=Math.sign(a)*Math.sqrt(s*s+a*a);return l+h===0?0:(r=r/Math.abs(l+h)*2*i,r)}function jr(t,e,i,r=0,o=0){var n,s,a,l;if(!e||!0===e)return"black";let h,c;if(ut(e))for(let t=0;t<e.length&&(c=e[t],!c);t++);else c=e;if(c=Nr.Parse(c),"string"==typeof c)return c;if(i.AABBBounds&&(!i.attribute||0!==i.attribute.scaleX||0!==i.attribute.scaleY)){const e=i.AABBBounds;let d=e.x2-e.x1,u=e.y2-e.y1,g=e.x1-r,p=e.y1-o;if(i.attribute){const{scaleX:t=1,scaleY:e=1,angle:r=0}=i.attribute;d/=t,u/=e,g/=t,p/=e,(r||1!==t||1!==e)&&(g=null!==(n=i.x1WithoutTransform)&&void 0!==n?n:0,p=null!==(s=i.y1WithoutTransform)&&void 0!==s?s:0,d=null!==(a=i.widthWithoutTransform)&&void 0!==a?a:d,u=null!==(l=i.heightWithoutTransform)&&void 0!==l?l:u)}"linear"===c.gradient?h=function(t,e,i,r,o,n){var s,a,l,h;const c=t.createLinearGradient(i+(null!==(s=e.x0)&&void 0!==s?s:0)*o,r+(null!==(a=e.y0)&&void 0!==a?a:0)*n,i+(null!==(l=e.x1)&&void 0!==l?l:1)*o,r+(null!==(h=e.y1)&&void 0!==h?h:0)*n);return e.stops.forEach((t=>{c.addColorStop(t.offset,t.color)})),c}(t,c,g,p,d,u):"conical"===c.gradient?h=function(t,e,i,r,o,n){var s,a;const l=t.createConicGradient(i+(null!==(s=e.x)&&void 0!==s?s:0)*o,r+(null!==(a=e.y)&&void 0!==a?a:0)*n,e.startAngle,e.endAngle);return e.stops.forEach((t=>{l.addColorStop(t.offset,t.color)})),l.GetPattern?l.GetPattern(o+i,n+r,void 0):l}(t,c,g,p,d,u):"radial"===c.gradient&&(h=function(t,e,i,r,o,n){var s,a,l,h,c,d;const u=t.createRadialGradient(i+(null!==(s=e.x0)&&void 0!==s?s:.5)*o,r+(null!==(a=e.y0)&&void 0!==a?a:.5)*n,Math.max(o,n)*(null!==(l=e.r0)&&void 0!==l?l:0),i+(null!==(h=e.x1)&&void 0!==h?h:.5)*o,r+(null!==(c=e.y1)&&void 0!==c?c:.5)*n,Math.max(o,n)*(null!==(d=e.r1)&&void 0!==d?d:.5));return e.stops.forEach((t=>{u.addColorStop(t.offset,t.color)})),u}(t,c,g,p,d,u))}return h||"orange"}const Vr={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},Ur=!0,Kr=!1,$r=/\w|\(|\)|-/,Xr=/[.?!,;:/，。？！、；：]/,Yr=/\S/,qr=(t,e)=>{let i=e.fontSize||16;switch(e.script){case"super":case"sub":i*=.8}t.setTextStyle({textAlign:"left",textBaseline:e.textBaseline||"alphabetic",fontStyle:e.fontStyle||"",fontWeight:e.fontWeight||"",fontSize:i,fontFamily:e.fontFamily})};function Zr(t,e,i,r,o){if(t.length<=1)return 0;if(!e||e<=0)return 0;const n=D.graphicUtil.textMeasure;let s=r,a=t.slice(0,s),l=Math.floor(n.measureText(a,i).width),h=t.slice(0,s+1),c=Math.floor(n.measureText(h,i).width);for(;l>e||c<=e;){if(l>e?s--:s++,s>t.length){s=t.length;break}if(s<0){s=0;break}a=t.slice(0,s),l=Math.floor(n.measureText(a,i).width),h=t.slice(0,s+1),c=Math.floor(n.measureText(h,i).width)}return o&&(s=Jr(t,s)),s}function Jr(t,e,i=!1){let r=e;for(;$r.test(t[r-1])&&$r.test(t[r])||Xr.test(t[r]);)if(r--,r<=0)return i?Qr(t,e):e;return r}function Qr(t,e){let i=e;for(;$r.test(t[i+1])&&$r.test(t[i])||Xr.test(t[i]);)if(i++,i>=t.length)return i;return i+1}function to(t,e,i="actual"){var r;if(""===t)return{ascent:0,height:0,descent:0,width:0};const o=D.graphicUtil.textMeasure.measureText(t,e),n={ascent:0,height:0,descent:0,width:0},s="actual"===i?o.actualBoundingBoxAscent:o.fontBoundingBoxAscent,a="actual"===i?o.actualBoundingBoxDescent:o.fontBoundingBoxDescent;"number"!=typeof s||"number"!=typeof a?(n.width=Math.floor(o.width),n.height=e.fontSize||0,n.ascent=n.height,n.descent=0):(n.width=Math.floor(o.width),n.height=Math.floor(s+a),n.ascent=Math.floor(s),n.descent=n.height-n.ascent);const l=null!==(r=e.space)&&void 0!==r?r:0;return n.width+=l,n}var eo=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let io=class{configure(t,e){this.canvas=t.canvas,this.context=t.context,t.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(t,e,i){this.context.setTextStyleWithoutAlignBaseline(e);const r=this.context.measureText(t);return i?this.compatibleMetrics(r,e):r}_measureTextWithAlignBaseline(t,e,i){this.context.setTextStyle(e);const r=this.context.measureText(t);return i?this.compatibleMetrics(r,e):r}compatibleMetrics(t,e){if(null==t.actualBoundingBoxAscent||null==t.actualBoundingBoxDescent||null==t.fontBoundingBoxAscent||null==t.fontBoundingBoxDescent){t={width:t.width};const{ascent:i,descent:r}=this.measureTextBoundADscentEstimate(e);t.actualBoundingBoxAscent=i,t.actualBoundingBoxDescent=r,t.fontBoundingBoxAscent=i,t.fontBoundingBoxDescent=r}if(null==t.actualBoundingBoxLeft||null==t.actualBoundingBoxRight){t={width:t.width,actualBoundingBoxAscent:t.actualBoundingBoxAscent,actualBoundingBoxDescent:t.actualBoundingBoxDescent,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent};const{left:i,right:r}=this.measureTextBoundLeftRightEstimate(e);t.actualBoundingBoxLeft=i,t.actualBoundingBoxRight=r}return t}estimate(t,{fontSize:e=Ir.fontSize}){let i=0,r=0;for(let e=0;e<t.length;e++)t.charCodeAt(e)<128?i++:r++;return{width:~~(.8*i*e+r*e),height:e}}measureTextWidth(t,e,i){return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsWidth(t,e,i){return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsLeftRight(t,e,i){return this.context?{left:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxLeft,right:i.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(e)}measureTextPixelHeight(t,e,i){var r;return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)):null!==(r=e.fontSize)&&void 0!==r?r:vr.fontSize}measureTextPixelADscent(t,e,i){return this.context?{ascent:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundHieght(t,e,i){var r;return this.context?(i=null!=i?i:this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.fontBoundingBoxAscent-i.fontBoundingBoxDescent)):null!==(r=e.fontSize)&&void 0!==r?r:vr.fontSize}measureTextBoundADscent(t,e,i){return this.context?{ascent:(i=null!=i?i:this._measureTextWithAlignBaseline(t,e,!0)).fontBoundingBoxAscent,descent:i.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundADscentEstimate(t){var e;const i=null!==(e=t.fontSize)&&void 0!==e?e:vr.fontSize;return{ascent:.79*i,descent:.21*i}}measureTextBoundLeftRightEstimate(t){var e;const i=null!==(e=t.fontSize)&&void 0!==e?e:vr.fontSize,{textAlign:r}=t;return"center"===r?{left:i/2,right:i/2}:"right"===r||"end"===r?{left:i,right:0}:{left:0,right:i}}measureTextPixelADscentAndWidth(t,e,i){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:this.estimate(t,e).width});const r=this._measureTextWithoutAlignBaseline(t,e,!0);if(i===X.actualBounding)return{ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,width:r.width};if(i===X.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:r.width});if(i===X.fontBounding){let t=r.fontBoundingBoxAscent,e=r.fontBoundingBoxDescent;if(r.actualBoundingBoxDescent&&e<r.actualBoundingBoxDescent){const i=r.actualBoundingBoxDescent-e;e+=i,t-=i}else if(r.actualBoundingBoxAscent&&t<r.actualBoundingBoxAscent){const i=r.actualBoundingBoxAscent-t;t+=i,e-=i}return{ascent:t,descent:e,width:r.width}}return{ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,width:r.width}}measureText(t,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(t)):this.estimate(t,e)}clipTextVertical(t,e,i,r){if(0===t.length)return{verticalList:t,width:0};const{fontSize:o=12}=e;t.forEach((t=>{t.width=0===t.direction?o:this.measureTextWidth(t.text,e)}));const n=[];let s=0,a=0;for(;a<t.length&&s+t[a].width<i;a++)s+=t[a].width,n.push(t[a]);if(t[a]&&t[a].text.length>1){const o=this._clipText(t[a].text,e,i-s,0,t[a].text.length-1,"end",!1);if(r&&o.str!==t[a].text){let i="",r=0;for(let e=0;e<a;e++){const o=t[e];i+=o.text,r+=o.text.length}i+=t[a].text;let n=Jr(i,r+o.str.length);n-=r,n!==o.str.length-1&&(o.str=o.str.substring(0,n),o.width=this.measureTextWidth(o.str,e))}n.push(Object.assign(Object.assign({},t[a]),{text:o.str,width:o.width})),s+=o.width}return{verticalList:n,width:s}}clipText(t,e,i,r,o){if(0===t.length)return{str:"",width:0};let n=this.measureTextWidth(t,e);if(n<=i)return{str:t,width:n};if(n=this.measureTextWidth(t[0],e),n>i)return{str:"",width:0};const s=this._clipText(t,e,i,0,t.length-1,"end",!1);if(r&&s.str!==t){let i=Jr(t,s.str.length,o);i!==s.str.length&&(i>s.str.length&&(s.wordBreaked=i,i=s.str.length),s.str=t.substring(0,i),s.width=this.measureTextWidth(s.str,e))}return s}_clipText(t,e,i,r,o,n,s){let a;if("start"===n)a=this._clipTextStart(t,e,i,r,o),s&&(a.result=s+a.str);else if("middle"===n){const r=this._clipTextMiddle(t,e,i,"","",0,0,1);a={str:"none",width:r.width,result:r.left+s+r.right}}else a=this._clipTextEnd(t,e,i,r,o),s&&(a.result=a.str+s);return a}_clipTextEnd(t,e,i,r,o){if(r===o){Xt.getInstance().warn(`【_clipTextEnd】不应该走到这里${t}, ${r}, ${o}`);const i=t.substring(0,o+1);return{str:i,width:this.measureTextWidth(i,e)}}const n=Math.floor((r+o)/2),s=t.substring(0,n+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(0,n);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipTextEnd(t,e,i,r,n)}if(a<i){if(n>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const r=t.substring(0,n+2);return l=this.measureTextWidth(r,e),l>=i?{str:s,width:a}:this._clipTextEnd(t,e,i,n,o)}return{str:s,width:a}}_clipTextStart(t,e,i,r,o){const n=Math.ceil((r+o)/2),s=t.substring(n-1,t.length),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const r=t.substring(n,t.length);return l=this.measureTextWidth(r,e),l<=i?{str:r,width:l}:this._clipTextStart(t,e,i,n,t.length)}if(a<i){if(n<=0)return{str:t,width:this.measureTextWidth(t,e)};const o=t.substring(n-2,t.length);return l=this.measureTextWidth(o,e),l>=i?{str:s,width:a}:this._clipTextStart(t,e,i,r,n)}return{str:s,width:a}}_clipTextMiddle(t,e,i,r,o,n,s,a){const l=t.substring(0,a),h=this.measureTextWidth(l,e);if(h+s>i)return{left:r,right:o,width:n+s};const c=t.substring(t.length-a,t.length),d=this.measureTextWidth(c,e);return h+d>i?{left:l,right:o,width:h+s}:this._clipTextMiddle(t,e,i,l,c,h,d,a+1)}clipTextWithSuffixVertical(t,e,i,r,o,n){if(""===r)return this.clipTextVertical(t,e,i,o);if(0===t.length)return{verticalList:t,width:0};const s=this.clipTextVertical(t,e,i,o);if(s.verticalList.length===t.length&&s.verticalList[s.verticalList.length-1].width===t[t.length-1].width)return s;const a=this.measureTextWidth(r,e);if(a>i)return s;let l;if(i-=a,"start"===n){const n=this.revertVerticalList(t);l=this.clipTextVertical(n,e,i,o);const s=this.revertVerticalList(l.verticalList);s.unshift({text:r,direction:1,width:a}),l.verticalList=s}else if("middle"===n){const n=this.clipTextVertical(t,e,i/2,o),s=this.revertVerticalList(t),h=this.clipTextVertical(s,e,i/2,o);n.verticalList.push({text:r,direction:1,width:a}),this.revertVerticalList(h.verticalList).forEach((t=>n.verticalList.push(t))),l={verticalList:n.verticalList,width:n.width+h.width}}else l=this.clipTextVertical(t,e,i,o),l.verticalList.push({text:r,direction:1,width:a});return l.width+=a,l}revertVerticalList(t){return t.reverse().map((t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})}))}clipTextWithSuffix(t,e,i,r,o,n,s=!1){if(""===r)return this.clipText(t,e,i,o);if(0===t.length)return{str:"",width:0};const a=this.measureTextWidth(t,e);if(!s&&a<=i)return{str:t,width:a};const l=this.measureTextWidth(r,e);if(l>i)return{str:"",width:0};if(s&&a+l<=i)return{str:t+r,width:a+l};i-=l;const h=this._clipText(t,e,i,0,t.length-1,n,r);if(o&&h.str!==t){const i=Jr(t,h.str.length);i!==h.str.length&&(h.result=t.substring(0,i),h.width=this.measureTextWidth(h.str,e))}else s&&h.str===t&&(h.result=t+r);return h.str=h.result,h.width+=l,h}};io=eo([f()],io);var ro=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};const oo=Symbol.for("TextMeasureContribution");let no=class extends io{};no=ro([f()],no);const so=new class{constructor(t){const i=t||{};i.defaultScope=i.defaultScope||y,this.options=i,this.id=e.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new T}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const r=this._getNotAllArgs(t,!1,e,i);return this._get(r)}getNamed(t,e){return this.getTagged(t,r,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new A(t,e),r=this._bindingDictionary.get(t)||[];return r.push(i),this._bindingDictionary.set(t,r),new P(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(t,e)=>{t._binding.moduleId=e},e=e=>i=>{const r=this.bind(i);return t(r,e),r},i=()=>t=>this.unbind(t),r=()=>t=>this.isBound(t),o=e=>i=>{const r=this.rebind(i);return t(r,e),r};return t=>({bindFunction:e(t),isboundFunction:r(),rebindFunction:o(t),unbindFunction:i(),unbindAsyncFunction:t=>null})}_getNotAllArgs(t,e,i,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:r}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter((e=>e.constraint(t))).forEach((t=>{e.push(this._resolveFromBinding(t))})),t.isMultiInject||1!==e.length?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),r=Object.keys(i),s=[];for(let t=0;t<r.length;t++){const e=i[t],r={};e.forEach((t=>{r[t.key]=t.value}));const a={inject:r[o],multiInject:r[n]},l=a.inject||a.multiInject,h={serviceIdentifier:l,constructorArgsMetadata:e},c=(this._bindingDictionary.get(l)||[]).filter((t=>t.constraint(h)));if(c.length){const t={injectIdentifier:l,metadata:e,bindings:c};s.push(t)}}return s}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case C:case x:e=t.cache;break;case _:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map((t=>t.bindings.length>1?t.bindings.map((t=>this._resolveFromBinding(t))):this._resolveFromBinding(t.bindings[0])))}_saveToScope(t,e){t.scope===b&&(t.cache=e,t.activated=!0)}},ao=Symbol.for("CanvasFactory"),lo=Symbol.for("Context2dFactory");function ho(t){return so.getNamed(ao,D.global.env)(t)}const co=1e-4,uo=Math.sqrt(3),go=1/3;function po(t){return t>-Ro&&t<Ro}function fo(t){return t>Ro||t<-Ro}const mo=[0,0],bo=[0,0],yo=[0,0];function Co(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function wo(t,e,i,r){const o=1-r;return o*(o*t+2*r*e)+r*r*i}function vo(t,e,i,r,o){const n=1-o;return n*n*(n*t+3*o*e)+o*o*(o*r+3*n*i)}function xo(t){return(t%=le)<0&&(t+=le),t}function _o(t,e,i,r,o,n,s,a,l){if(0===s)return!1;const h=s;return!(l>e+h&&l>r+h&&l>n+h||l<e-h&&l<r-h&&l<n-h||a>t+h&&a>i+h&&a>o+h||a<t-h&&a<i-h&&a<o-h)&&function(t,e,i,r,o,n,s,a,l){let h=0,c=.005,d=1/0;mo[0]=s,mo[1]=a;for(let s=0;s<1;s+=.05){bo[0]=wo(t,i,o,s),bo[1]=wo(e,r,n,s);const a=Co(mo,bo);a<d&&(h=s,d=a)}d=1/0;for(let s=0;s<32&&!(c<co);s++){const s=h-c,a=h+c;bo[0]=wo(t,i,o,s),bo[1]=wo(e,r,n,s);const l=Co(bo,mo);if(s>=0&&l<d)h=s,d=l;else{yo[0]=wo(t,i,o,a),yo[1]=wo(e,r,n,a);const s=Co(yo,mo);a<=1&&s<d?(h=a,d=s):c*=.5}}return l&&(l[0]=wo(t,i,o,h),l[1]=wo(e,r,n,h)),Math.sqrt(d)}(t,e,i,r,o,n,a,l,null)<=h/2}function So(t,e,i,r,o,n,s,a,l,h,c){if(0===l)return!1;const d=l;return!(c>e+d&&c>r+d&&c>n+d&&c>a+d||c<e-d&&c<r-d&&c<n-d&&c<a-d||h>t+d&&h>i+d&&h>o+d&&h>s+d||h<t-d&&h<i-d&&h<o-d&&h<s-d)&&function(t,e,i,r,o,n,s,a,l,h,c){let d,u,g,p,f=0,m=.005,b=1/0;mo[0]=l,mo[1]=h;for(let l=0;l<1;l+=.05)bo[0]=vo(t,i,o,s,l),bo[1]=vo(e,r,n,a,l),g=Co(mo,bo),g<b&&(f=l,b=g);b=1/0;for(let l=0;l<32&&!(m<co);l++)d=f-m,u=f+m,bo[0]=vo(t,i,o,s,d),bo[1]=vo(e,r,n,a,d),g=Co(bo,mo),d>=0&&g<b?(f=d,b=g):(yo[0]=vo(t,i,o,s,u),yo[1]=vo(e,r,n,a,u),p=Co(yo,mo),u<=1&&p<b?(f=u,b=p):m*=.5);return c&&(c[0]=vo(t,i,o,s,f),c[1]=vo(e,r,n,a,f)),Math.sqrt(b)}(t,e,i,r,o,n,s,a,h,c,null)<=d/2}function Ao(t,e,i,r,o,n,s,a,l){if(0===s)return!1;const h=s;a-=t,l-=e;const c=Math.sqrt(a*a+l*l);if(c-h>i||c+h<i)return!1;if(Math.abs(r-o)%le<1e-4)return!0;if(n){const t=r;r=xo(o),o=xo(t)}else r=xo(r),o=xo(o);r>o&&(o+=le);let d=Math.atan2(l,a);return d<0&&(d+=le),d>=r&&d<=o||d+le>=r&&d+le<=o}function To(t,e,i,r,o,n,s){if(0===o)return!1;const a=o,l=o/2;let h=0,c=t;if(s>e+l&&s>r+l||s<e-l&&s<r-l||n>t+l&&n>i+l||n<t-l&&n<i-l)return!1;if(t===i)return Math.abs(n-t)<=a/2;h=(e-r)/(t-i),c=(t*r-i*e)/(t-i);const d=h*n-s+c;return d*d/(h*h+1)<=a/2*a/2}const Ro=1e-4;function Bo(t,e,i,r,o){const n=6*i-12*e+6*t,s=9*e+3*r-3*t-9*i,a=3*e-3*t;let l=0;if(po(s)){if(fo(n)){const t=-a/n;t>=0&&t<=1&&(o[l++]=t)}}else{const t=n*n-4*s*a;if(po(t))o[0]=-n/(2*s);else if(t>0){const e=Math.sqrt(t),i=(-n+e)/(2*s),r=(-n-e)/(2*s);i>=0&&i<=1&&(o[l++]=i),r>=0&&r<=1&&(o[l++]=r)}}return l}const Mo=[-1,-1,-1],Po=[-1,-1];function Ho(){const t=Po[0];Po[0]=Po[1],Po[1]=t}function ko(t,e,i,r,o,n,s,a,l,h){if(h>e&&h>r&&h>n&&h>a||h<e&&h<r&&h<n&&h<a)return 0;const c=function(t,e,i,r,o,n){const s=r+3*(e-i)-t,a=3*(i-2*e+t),l=3*(e-t),h=t-o,c=a*a-3*s*l,d=a*l-9*s*h,u=l*l-3*a*h;let g=0;if(po(c)&&po(d))if(po(a))n[0]=0;else{const t=-l/a;t>=0&&t<=1&&(n[g++]=t)}else{const t=d*d-4*c*u;if(po(t)){const t=d/c,e=-a/s+t,i=-t/2;e>=0&&e<=1&&(n[g++]=e),i>=0&&i<=1&&(n[g++]=i)}else if(t>0){const e=Math.sqrt(t);let i=c*a+1.5*s*(-d+e),r=c*a+1.5*s*(-d-e);i=i<0?-Math.pow(-i,go):Math.pow(i,go),r=r<0?-Math.pow(-r,go):Math.pow(r,go);const o=(-a-(i+r))/(3*s);o>=0&&o<=1&&(n[g++]=o)}else{const t=(2*c*a-3*s*d)/(2*Math.sqrt(c*c*c)),e=Math.acos(t)/3,i=Math.sqrt(c),r=Math.cos(e),o=(-a-2*i*r)/(3*s),l=(-a+i*(r+uo*Math.sin(e)))/(3*s),h=(-a+i*(r-uo*Math.sin(e)))/(3*s);o>=0&&o<=1&&(n[g++]=o),l>=0&&l<=1&&(n[g++]=l),h>=0&&h<=1&&(n[g++]=h)}}return g}(e,r,n,a,h,Mo);if(0===c)return 0;let d=0,u=-1,g=0,p=0;for(let h=0;h<c;h++){const c=Mo[h],f=0===c||1===c?.5:1;vo(t,i,o,s,c)<l||(u<0&&(u=Bo(e,r,n,a,Po),Po[1]<Po[0]&&u>1&&Ho(),g=vo(e,r,n,a,Po[0]),u>1&&(p=vo(e,r,n,a,Po[1]))),2===u?c<Po[0]?d+=g<e?f:-f:c<Po[1]?d+=p<g?f:-f:d+=a<p?f:-f:c<Po[0]?d+=g<e?f:-f:d+=a<g?f:-f)}return d}function Eo(t,e,i,r,o,n,s,a){if(a>e&&a>r&&a>n||a<e&&a<r&&a<n)return 0;const l=function(t,e,i,r,o){const n=t-2*e+i,s=2*(e-t),a=t-r;let l=0;if(po(n)){if(fo(s)){const t=-a/s;t>=0&&t<=1&&(o[l++]=t)}}else{const t=s*s-4*n*a;if(po(t)){const t=-s/(2*n);t>=0&&t<=1&&(o[l++]=t)}else if(t>0){const e=Math.sqrt(t),i=(-s+e)/(2*n),r=(-s-e)/(2*n);i>=0&&i<=1&&(o[l++]=i),r>=0&&r<=1&&(o[l++]=r)}}return l}(e,r,n,a,Mo);if(0===l)return 0;const h=function(t,e,i){const r=t+i-2*e;return 0===r?.5:(t-e)/r}(e,r,n);if(h>=0&&h<=1){let a=0;const c=wo(e,r,n,h);for(let r=0;r<l;r++){const l=0===Mo[r]||1===Mo[r]?.5:1;wo(t,i,o,Mo[r])<s||(Mo[r]<h?a+=c<e?l:-l:a+=n<c?l:-l)}return a}const c=0===Mo[0]||1===Mo[0]?.5:1;return wo(t,i,o,Mo[0])<s?0:n<e?c:-c}function Fo(t,e,i,r,o,n,s,a){if((a-=e)>i||a<-i)return 0;const l=Math.sqrt(i*i-a*a);Mo[0]=-l,Mo[1]=l;const h=Math.abs(r-o);if(h<1e-4)return 0;if(h>=le-1e-4){r=0,o=le;const e=n?1:-1;return s>=Mo[0]+t&&s<=Mo[1]+t?e:0}if(r>o){const t=r;r=o,o=t}r<0&&(r+=le,o+=le);let c=0;for(let e=0;e<2;e++){const i=Mo[e];if(i+t>s){let t=Math.atan2(a,i),e=n?1:-1;t<0&&(t=le+t),(t>=r&&t<=o||t+le>=r&&t+le<=o)&&(t>ne/2&&t<1.5*ne&&(e=-e),c+=e)}}return c}function Lo(t){return Math.round(t/ne*1e8)/1e8%2*ne}function Io(t,e){let i=Lo(t[0]);i<0&&(i+=le);const r=i-t[0];let o=t[1];o+=r,!e&&o-i>=le?o=i+le:e&&i-o>=le?o=i-le:!e&&i>o?o=i+(le-Lo(i-o)):e&&i<o&&(o=i-(le-Lo(o-i))),t[0]=i,t[1]=o}const zo=[0,0];function Oo(t,e,i,r,o){const n=t,s=t.length;let a,l,h=0,c=0,d=0,u=0,g=0;for(let t=0;t<s;t++){const s=n[t],p=0===t;s[0]===di.M&&t>1&&(i||(h+=Fe(c,d,u,g,r,o))),p&&(c=s[1],d=s[2],u=c,g=d);const f=s[0],m=s[1],b=s[2],y=s[3],C=s[4],w=s[5],v=s[6];let x=C,_=w;zo[0]=x,zo[1]=_,Io(zo,Boolean(s[6])),x=zo[0],_=zo[1];const S=x,A=_-x,T=!!(1-(s[6]?0:1)),R=(r-m)*y/y+m;switch(f){case di.M:u=m,g=b,c=u,d=g;break;case di.L:if(i){if(To(c,d,m,b,e,r,o))return!0}else h+=Fe(c,d,m,b,r,o)||0;c=m,d=b;break;case di.C:if(i){if(So(c,d,m,b,y,C,w,v,e,r,o))return!0}else h+=ko(c,d,m,b,y,C,w,v,r,o)||0;c=w,d=v;break;case di.Q:if(i){if(_o(c,d,m,b,y,C,e,r,o))return!0}else h+=Eo(c,d,m,b,y,C,r,o)||0;c=y,d=C;break;case di.A:if(a=Math.cos(S)*y+m,l=Math.sin(S)*y+b,p?(u=a,g=l):h+=Fe(c,d,a,l,r,o),i){if(Ao(m,b,y,S,S+A,T,e,R,o))return!0}else h+=Fo(m,b,y,S,S+A,T,R,o);c=Math.cos(S+A)*y+m,d=Math.sin(S+A)*y+b;break;case di.R:if(u=c=m,g=d=b,a=u+y,l=g+C,i){if(To(u,g,a,g,e,r,o)||To(a,g,a,l,e,r,o)||To(a,l,u,l,e,r,o)||To(u,l,u,g,e,r,o))return!0}else h+=Fe(a,g,a,l,r,o),h+=Fe(u,l,u,g,r,o);break;case di.Z:if(i){if(To(c,d,u,g,e,r,o))return!0}else h+=Fe(c,d,u,g,r,o);c=u,d=g}}return i||(p=d,f=g,Math.abs(p-f)<Ro)||(h+=Fe(c,d,u,g,r,o)||0),0!==h;var p,f}const Do=new class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const e=ho(Object.assign({nativeCanvas:D.global.createCanvas(t)},t));return this.allocatedCanvas.push(e),e}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const e={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},i=ho(Object.assign({nativeCanvas:D.global.createCanvas(e)},e));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}};var Wo=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},No=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const Go=Symbol.for("VWindow"),jo=Symbol.for("WindowHandlerContribution");let Vo=class extends G{get width(){if(this._handler){const t=this._handler.getWH();return this._width=t.width}return this._width}get height(){if(this._handler){const t=this._handler.getWH();return this._height=t.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){super(),this.hooks={onChange:new I(["x","y","width","height"])},this.active=()=>{const t=this.global;t.env&&!this.actived&&(so.getNamed(jo,t.env).configure(this,t),this.actived=!0)},this._uid=e.GenAutoIncrementId(),this.global=D.global,this.postInit()}_nativeAddEventListener(t,e,i){return this._handler.addEventListener(t,e,i)}_nativeRemoveEventListener(t,e,i){return this._handler.removeEventListener(t,e,i)}_nativeDispatchEvent(t){return this._handler.dispatchEvent(t)}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var t;return null!==(t=this._handler.getStyle())&&void 0!==t?t:{}}set style(t){this._handler.setStyle(t)}create(t){var e,i;this._handler.createWindow(t);const r=this._handler.getWH();this._width=r.width,this._height=r.height,t.viewBox?this.setViewBox(t.viewBox):!1!==t.canvasControled?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:null!==(e=t.width)&&void 0!==e?e:this._width,y2:null!==(i=t.height)&&void 0!==i?i:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(t){this._handler=t}setDpr(t){return this._handler.setDpr(t)}resize(t,e){return this._handler.resizeWindow(t,e)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this.clearAllEventListeners(),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(t){return this._handler.getImageBuffer?this._handler.getImageBuffer(t):null}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(t){this._handler.clearViewBox(t)}setViewBox(t){this._handler.setViewBox(t)}setViewBoxTransform(t,e,i,r,o,n){this._handler.setViewBoxTransform(t,e,i,r,o,n)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(t,e){const i=this._handler.getViewBox(),r={x:t,y:e};return this._handler.getViewBoxTransform().transformPoint({x:t,y:e},r),r.x-=i.x1,r.y-=i.y1,r}hasSubView(){const t=this._handler.getViewBox();return!(0===t.x1&&0===t.y1&&Yt(this.width,t.width())&&Yt(this.height,t.height()))}isVisible(t){return this._handler.isVisible(t)}onVisibleChange(t){return this._handler.onVisibleChange(t)}getTopLeft(t){return this._handler.getTopLeft(t)}};Vo=Wo([f(),No("design:paramtypes",[])],Vo);var Uo=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ko=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$o=function(t,e){return function(i,r){e(i,r,t)}};let Xo=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(t){this.contributions=t,this.configured=!1,this.global=D.global,this.global.hooks.onSetEnv.tap("graphic-util",((t,e,i)=>{this.configured=!1,this.configure(i,e)}))}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(t,e){this.configured||(this.contributions.getContributions().forEach((t=>{t.configure(this,e)})),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const t=Do.shareCanvas();this._canvas=t,this._context=t.getContext("2d")}}bindTextMeasure(t){this._textMeasure=t}measureText(t,e,i="native"){var r;this.configure(this.global,this.global.env);const o=this.global.measureTextMethod;this.global.measureTextMethod=i;const n={width:this._textMeasure.measureTextWidth(t,e),height:null!==(r=e.fontSize)&&void 0!==r?r:vr.fontSize};return this.global.measureTextMethod=o,n}createTextMeasureInstance(t,e,i){return this.configure(this.global,this.global.env),new ze(Object.assign({defaultFontParams:{fontFamily:vr.fontFamily,fontSize:vr.fontSize},getCanvasForMeasure:i||(()=>this.canvas),getTextBounds:void 0,specialCharSet:"-/: .,@%'\"~"+ze.ALPHABET_CHAR_SET+ze.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t)}drawGraphicToCanvas(t,e,i){if(!e.defaultLayer)return null;const r=so.get(Go),o=t.AABBBounds,n=o.width(),s=o.height(),a=-o.x1,l=-o.y1;r.create({viewBox:{x1:a,y1:l,x2:o.x2,y2:o.y2},width:n,height:s,canvas:i,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(r,[t],{transMatrix:r.getViewBoxTransform(),viewBox:r.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=h;const c=r.getNativeHandler();return c.nativeCanvas?c.nativeCanvas:null}};var Yo;Xo=Uo([f(),$o(0,g(H)),$o(0,m(oo)),Ko("design:paramtypes",[Object])],Xo),function(t){t[t.transform=0]="transform",t[t.matrix=1]="matrix"}(Yo||(Yo={}));const qo=new Ve;let Zo=class{constructor(){this.matrix=new Ve}init(t){return this.mode=Yo.transform,this.originTransform=t,this.matrix.reset(),this}fromMatrix(t,e){return this.mode=Yo.matrix,this.outSourceMatrix=t,this.outTargetMatrix=e,this}scaleMatrix(t,e,i){const r=this.outSourceMatrix;if(qo.setValue(r.a,r.b,r.c,r.d,r.e,r.f),this.outTargetMatrix.reset(),i){const{x:r,y:o}=i;this.outTargetMatrix.translate(r,o),this.outTargetMatrix.scale(t,e),this.outTargetMatrix.translate(-r,-o)}else this.outTargetMatrix.scale(t,e);return this.outTargetMatrix.multiply(qo.a,qo.b,qo.c,qo.d,qo.e,qo.f),this}rotateMatrix(t,e){const i=this.outSourceMatrix;if(qo.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:i,y:r}=e;this.outTargetMatrix.translate(i,r),this.outTargetMatrix.rotate(t),this.outTargetMatrix.translate(-i,-r)}else this.outTargetMatrix.rotate(t);return this.outTargetMatrix.multiply(qo.a,qo.b,qo.c,qo.d,qo.e,qo.f),this}scale(t,e,i){return this.mode===Yo.matrix?this.scaleMatrix(t,e,i):this}rotate(t,e){return this.mode===Yo.matrix?this.rotateMatrix(t,e):this}translateMatrix(t,e){const i=this.outSourceMatrix;return qo.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(t,e),this.outTargetMatrix.multiply(qo.a,qo.b,qo.c,qo.d,qo.e,qo.f),this}translate(t,e){return this.mode===Yo.matrix?this.translateMatrix(t,e):this}simplify(t){return this.mode===Yo.matrix?this.simplifyMatrix(t):this}simplifyMatrix(t){return this}};Zo=Uo([f(),Ko("design:paramtypes",[])],Zo);const Jo={arc:Ar,area:Tr,circle:Rr,line:Pr,path:Hr,symbol:Lr,text:Ir,rect:Fr,polygon:kr,star:Er,richtext:zr,richtextIcon:Dr,image:Or,group:Br,glyph:Mr},Qo=Object.keys(Jo);function tn(t,e){Object.keys(e).forEach((i=>{t[i]=e[i]}))}const en={arc:Object.assign({},Jo.arc),area:Object.assign({},Jo.area),circle:Object.assign({},Jo.circle),line:Object.assign({},Jo.line),path:Object.assign({},Jo.path),symbol:Object.assign({},Jo.symbol),text:Object.assign({},Jo.text),rect:Object.assign({},Jo.rect),polygon:Object.assign({},Jo.polygon),star:Object.assign({},Jo.star),richtext:Object.assign({},Jo.richtext),richtextIcon:Object.assign({},Jo.richtextIcon),image:Object.assign({},Jo.image),group:Object.assign({},Jo.group),glyph:Object.assign({},Jo.glyph)};class rn{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Qo.forEach((t=>{this._defaultTheme[t]=Object.create(en[t])})),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e,i=!1){if(this.dirty){const r=this.getParentWithTheme(t);if(r){const t=r.theme;(t.dirty||i)&&t.applyTheme(r,e,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Xt.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;Qo.forEach((r=>{const o=Object.create(en[r]);t&&t[r]&&tn(o,t[r]),i[r]&&tn(o,i[r]),e[r]&&tn(o,e[r]),this.combinedTheme[r]=o})),e.common&&Qo.forEach((t=>{tn(this.combinedTheme[t],e.common)})),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach((e=>{i[e]?Object.assign(i[e],t[e]):i[e]=Object.assign({},t[e])})):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren((t=>{t.isContainer&&(t.theme&&(t.theme.dirty=!0),this.dirtyChildren(t))}))}}const on=new rn;function nn(t,e){return t.glyphHost?nn(t.glyphHost):e?(t.isContainer,e):function(t){let e;if(e=t.isContainer?t:t.parent,e){for(;e&&!e.theme;)e=e.parent;return e?(e.theme||e.createTheme(),e.theme.getTheme(e)):on.getTheme()}return null}(t)||t.attachedThemeGraphic&&nn(t.attachedThemeGraphic)||on.getTheme()}var sn=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};class an extends et{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=e.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t,e=!1){if(e){let e=this._lastChild,i=0;for(;e;){if(t(e,i++))return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){if(t(e,i++))return;e=e._next}}}forEachChildrenAsync(t,e=!1){return sn(this,void 0,void 0,(function*(){if(e){let e=this._lastChild,i=0;for(;e;){let r=t(e,i++);if(r.then&&(r=yield r),r)return;e=e._prev}}else{let e=this._firstChild,i=0;for(;e;){let r=t(e,i++);if(r.then&&(r=yield r),r)return;e=e._next}}}))}forEach(t){return this.forEachChildren(t)}appendChild(t,e=!0){if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t,e=!1){return t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&Xt.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(t.parent&&t.parent.removeChild(t),t.parent=this,0===e)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let t=0;t<e;t++){if(!i)return null;t>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const i=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,i)}let i;this._nodeList[e]=t;for(let t=e-1;t>=0&&(i=this._nodeList[t],!i);t--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const r=this.insertInto(t,0);return this._ignoreWarn=!1,r}removeChild(t){if(!this._idMap)return null;if(!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex((e=>e===t));e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const t=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=t}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("暂不支持")}find(t,e=!1){let i=null;return this.forEachChildren(((e,r)=>!(e===this||!t(e,r)||(i=e,0)))),e&&this.forEachChildren((e=>{if(e.isContainer){const r=e.find(t,!0);if(r)return i=r,!0}return!1})),i}findAll(t,e=!1){let i=[];return this.forEachChildren(((e,r)=>{e!==this&&t(e,r)&&i.push(e)})),e&&this.forEachChildren((e=>{if(e.isContainer){const r=e.findAll(t,!0);r.length&&(i=i.concat(r))}})),i}getElementById(t){return this.find((e=>e.id===t),!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll((e=>e.name===t),!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll((e=>e.type===t),!0)}getChildByName(t,e=!1){return this.find((e=>e.name===t),e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;null==t?void 0:t.parent;)t=t.parent;return t||this}hasChildNodes(){return null!==this._firstChild}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(null!==e);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("暂不支持")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do{e._count+=t,e=e.parent}while(null!==e)}clone(){throw new Error("暂不支持")}cloneTo(t){throw new Error("暂不支持")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const r=rt(i,!0)&&i||at(i)&&i.capture,o=at(i)&&i.once,n=ot(e)?void 0:e;return t=r?`${t}capture`:t,e=ot(e)?e:e.handleEvent,o?super.once(t,e,n):super.on(t,e,n),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const r=rt(i,!0)&&i||at(i)&&i.capture,o=ot(e)?void 0:e;t=r?`${t}capture`:t,e=ot(e)?e:e.handleEvent;const n=at(i)&&i.once;return super.off(t,e,o,n),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return at(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t,...e){return super.emit(t.type,t,...e),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class ln{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ln.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=t.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch(t){this.nativeEvent.preventDefault&&ot(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch(t){this.nativeEvent.stopPropagation&&ot(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class hn extends ln{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){throw new Error("Method not implemented.")}}class cn extends hn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const r=new cn(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyPointerData(this,r),null===(e=this.manager)||void 0===e||e.copyMouseData(this,r),null===(i=this.manager)||void 0===i||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const o=this.composedDetailPath();return r.detailPath=o&&o.slice(),r.type=this.type,r}}class dn extends hn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const r=new dn(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,null===(t=this.manager)||void 0===t||t.copyWheelData(this,r),null===(e=this.manager)||void 0===e||e.copyMouseData(this,r),null===(i=this.manager)||void 0===i||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const o=this.composedDetailPath();return r.detailPath=o&&o.slice(),r.type=this.type,r}}dn.DOM_DELTA_PIXEL=0,dn.DOM_DELTA_LINE=1,dn.DOM_DELTA_PAGE=2;class un extends ln{constructor(t,e){super(),this.type=t,this.detail=e}}const gn="object"==typeof performance&&performance.now?performance:Date;function pn(t){return"mouse"===t||"pen"===t}const fn={dispatchEvent(t){var e;if(!(t instanceof ln))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=[],t.detailPath&&(t.detailPath=[]),t.target=this,null===(e=null==t?void 0:t.manager)||void 0===e||e.dispatchEvent(t),!t.defaultPrevented},emit(t,e){return this.dispatchEvent(new un(t,e))}},mn={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class bn{constructor(t){this.resolution=1,this.onPointerDown=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],r=this.bootstrapEvent(this.rootPointerEvent,i);this.manager.mapEvent(r)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;if(this.isEventOutsideOfTargetElement(t))return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.isEventOutsideOfTargetViewPort(t)?"outside":"",i=this.normalizeToPointerData(t);for(let t=0,r=i.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,i[t]);r.type+=e,this.manager.mapEvent(r)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=t=>{if(this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.manager.mapEvent(i)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=t=>{const e=this.normalizeWheelEvent(t);this.manager.mapEvent(e)};const{targetElement:e,resolution:i,rootNode:r,global:o,autoPreventDefault:n=!1,clickInterval:s,supportsTouchEvents:a=o.supportsTouchEvents,supportsPointerEvents:l=o.supportsPointerEvents}=t;this.manager=new class{constructor(t,e){this.dispatch=new et,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(t,e)=>{if(!(t instanceof cn))return void Xt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(i,"pointerdown"),"touch"===i.pointerType)this.dispatchEvent(i,"touchstart");else if(pn(i.pointerType)){const t=2===i.button;this.dispatchEvent(i,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=i.composedPath(),this.freeEvent(i)},this.onPointerMove=(t,e)=>{var i,r;if(!(t instanceof cn))return void Xt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(t,t.type,e),n=pn(o.pointerType),s=this.trackingData(t.pointerId),a=this.findMountedTarget(s.overTargets);if(s.overTargets&&a&&a!==this.rootTarget&&a!==o.target){const e="mousemove"===t.type?"mouseout":"pointerout",i=this.createPointerEvent(t,e,a||void 0);if(this.dispatchEvent(i,"pointerout"),n&&this.dispatchEvent(i,"mouseout"),!o.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a||void 0);for(e.eventPhase=e.AT_TARGET;e.target&&!o.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(i)}if(a!==o.target){const e="mousemove"===t.type?"mouseover":"pointerover",i=this.clonePointerEvent(o,e);this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover");let r=null==a?void 0:a.parent;for(;r&&r!==this.rootTarget.parent&&r!==o.target;)r=r.parent;if(!r||r===this.rootTarget.parent){const t=this.clonePointerEvent(o,"pointerenter");t.eventPhase=t.AT_TARGET;let e=t.target;const i=new Set;let r=a;for(;r&&r!==this.rootTarget;)i.add(r),r=r.parent;for(;e&&e!==a&&e!==this.rootTarget.parent;)i.has(e)||(t.currentTarget=e,this.notifyTarget(t),n&&this.notifyTarget(t,"mouseenter")),e=e.parent;this.freeEvent(t)}this.freeEvent(i)}this.dispatchEvent(o,"pointermove"),"touch"===o.pointerType&&this.dispatchEvent(o,"touchmove"),n&&(this.dispatchEvent(o,"mousemove"),this.cursorTarget=o.target,this.cursor=(null===(r=null===(i=o.target)||void 0===i?void 0:i.attribute)||void 0===r?void 0:r.cursor)||this.rootTarget.getCursor()),s.overTargets=o.composedPath(),this.freeEvent(o)},this.onPointerOver=(t,e)=>{var i,r;if(!(t instanceof cn))return void Xt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(t.pointerId),n=this.createPointerEvent(t,t.type,e),s=pn(n.pointerType);this.dispatchEvent(n,"pointerover"),s&&this.dispatchEvent(n,"mouseover"),"mouse"===n.pointerType&&(this.cursorTarget=n.target,this.cursor=(null===(r=null===(i=n.target)||void 0===i?void 0:i.attribute)||void 0===r?void 0:r.cursor)||this.rootTarget.getCursor());const a=this.clonePointerEvent(n,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),s&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;o.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(a)},this.onPointerOut=(t,e)=>{if(!(t instanceof cn))return void Xt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId);if(i.overTargets){const e=pn(t.pointerType),r=this.findMountedTarget(i.overTargets),o=this.createPointerEvent(t,"pointerout",r||void 0);this.dispatchEvent(o),e&&this.dispatchEvent(o,"mouseout");const n=this.createPointerEvent(t,"pointerleave",r||void 0);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),e&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;i.overTargets=[],this.freeEvent(o),this.freeEvent(n)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(t,e)=>{var i;if(!(t instanceof cn))return void Xt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const r=gn.now(),o=this.createPointerEvent(t,t.type,e);if(this.dispatchEvent(o,"pointerup"),"touch"===o.pointerType)this.dispatchEvent(o,"touchend");else if(pn(o.pointerType)){const t=2===o.button;this.dispatchEvent(o,t?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let a=s;if(s&&!o.composedPath().includes(s)){let e=s;for(;e&&!o.composedPath().includes(e);){if(o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType)this.notifyTarget(o,"touchendoutside");else if(pn(o.pointerType)){const t=2===o.button;this.notifyTarget(o,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete n.pressTargetsByButton[t.button],a=e}if(a){const e=this.clonePointerEvent(o,"click");e.target=a,e.path=[],e.detailPath=[],n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:e.target,timeStamp:r});const s=n.clicksByButton[t.button];s.target===e.target&&r-s.timeStamp<(null!==(i=this._config.clickInterval)&&void 0!==i?i:200)?++s.clickCount:s.clickCount=1,s.target=e.target,s.timeStamp=r,e.detail=s.clickCount,pn(e.pointerType)?(this.dispatchEvent(e,"click"),2===s.clickCount&&this.dispatchEvent(e,"dblclick")):"touch"===e.pointerType&&this._config.supportsTouchEvents&&(this.dispatchEvent(e,"tap"),2===s.clickCount&&this.dispatchEvent(e,"dbltap")),this.dispatchEvent(e,"pointertap"),this.freeEvent(e)}this.freeEvent(o)},this.onPointerUpOutside=(t,e)=>{if(!(t instanceof cn))return void Xt.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const i=this.trackingData(t.pointerId),r=this.findMountedTarget(i.pressTargetsByButton[t.button]),o=this.createPointerEvent(t,t.type,e);if(r){let e=r;for(;e;)o.currentTarget=e,this.notifyTarget(o,"pointerupoutside"),"touch"===o.pointerType?this.notifyTarget(o,"touchendoutside"):pn(o.pointerType)&&this.notifyTarget(o,2===o.button?"rightupoutside":"mouseupoutside"),e=e.parent;delete i.pressTargetsByButton[t.button]}this.freeEvent(o)},this.onWheel=(t,e)=>{if(!(t instanceof dn))return void Xt.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const i=this.createWheelEvent(t,e);this.dispatchEvent(i),this.freeEvent(i)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,r,o,n,s,a;if(!this.rootTarget)return;const l=this.mappingTable[t.type];let h;const c=`${t.canvasX}-${t.canvasY}`;if((null===(e=this._prePointTargetCache)||void 0===e?void 0:e[c])&&(null===(r=null===(i=this._prePointTargetCache)||void 0===i?void 0:i[c])||void 0===r?void 0:r.stage)&&(null===(n=null===(o=this._prePointTargetCache)||void 0===o?void 0:o[c])||void 0===n?void 0:n.stage.renderCount)===(null===(s=this._prePointTargetCache)||void 0===s?void 0:s.stageRenderCount)?h=this._prePointTargetCache[c]:(h=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[c]:h,stageRenderCount:null!==(a=null==h?void 0:h.stage.renderCount)&&void 0!==a?a:-1})),l)for(let e=0,i=l.length;e<i;e++)l[e].fn(t,h);else Xt.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,o=i.length-1;r<o;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=null!=e?e:t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var r,o;const n=this.allocateEvent(cn);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i||this.pickTarget(null!==(r=n.viewX)&&void 0!==r?r:n.global.x,null!==(o=n.viewY)&&void 0!==o?o:n.global.y,n),"string"==typeof e&&(n.type=e),n}createWheelEvent(t,e){var i,r;const o=this.allocateEvent(dn);return this.copyWheelData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=e||this.pickTarget(null!==(i=o.viewX)&&void 0!==i?i:o.global.x,null!==(r=o.viewY)&&void 0!==r?r:o.global.y,o),o}clonePointerEvent(t,e){const i=this.allocateEvent(cn);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const r=t.composedDetailPath();return i.detailPath=r&&r.slice(),i.type=null!=e?e:i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof cn&&e instanceof cn&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof hn&&e instanceof hn&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach((i=>{e[i].x=t[i].x,e[i].y=t[i].y})))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=gn.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=(null===(e=this.eventPool.get(t))||void 0===e?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),null===(e=this.eventPool.get(i))||void 0===e||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeEventListener(e,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events["*"];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e)}pickTarget(t,e,i){let r;const o=this.rootTarget.pick(t,e);return r=o&&o.graphic?o.graphic:o&&o.group?o.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=o.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}(r,{clickInterval:s,supportsTouchEvents:a}),this.globalObj=o,this.supportsPointerEvents=l,this.supportsTouchEvents=a,this.supportsMouseEvents=o.supportsMouseEvents,this.applyStyles=o.applyStyles,this.autoPreventDefault=n,this.eventsAdded=!1,this.rootPointerEvent=new cn,this.rootWheelEvent=new dn,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===t)return;this.currentCursor=t;const o=this.cursorStyles[t];o?"string"==typeof o&&i?r.style.cursor=o:"function"==typeof o?o(t):"object"==typeof o&&i&&Object.assign(r.style,o):i&&dt(t)&&!Tt(this.cursorStyles,t)&&(r.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.addEventListener("pointermove",this.onPointerMove,!0),t.addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.addEventListener("mousemove",this.onPointerMove,!0),t.addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.removeEventListener("pointermove",this.onPointerMove,!0),t.removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.removeEventListener("mousemove",this.onPointerMove,!0),t.removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const r=null===(e=this.globalObj)||void 0===e?void 0:e.mapToCanvasPoint(t,this.domElement);if(r)return r;let o=0,n=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};o=e.clientX||0,n=e.clientY||0}else o=t.clientX||0,n=t.clientY||0;const s=this.domElement.getBoundingClientRect();return{x:o-s.left,y:n-s.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,r=t.changedTouches.length;i<r;i++){const r=t.changedTouches[i];ct(r.button)&&(r.button=0),ct(r.buttons)&&(r.buttons=1),ct(r.isPrimary)&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),ct(r.width)&&(r.width=r.radiusX||1),ct(r.height)&&(r.height=r.radiusY||1),ct(r.tiltX)&&(r.tiltX=0),ct(r.tiltY)&&(r.tiltY=0),ct(r.pointerType)&&(r.pointerType="touch"),ct(r.pointerId)&&(r.pointerId=r.identifier||0),ct(r.pressure)&&(r.pressure=r.force||.5),ct(r.twist)&&(r.twist=0),ct(r.tangentialPressure)&&(r.tangentialPressure=0),ct(r.layerX)&&(r.layerX=r.offsetX=r.clientX),ct(r.layerY)&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(!this.globalObj.supportsMouseEvents||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof PointerEvent)){const i=t;ct(i.isPrimary)&&(i.isPrimary=!0),ct(i.width)&&(i.width=1),ct(i.height)&&(i.height=1),ct(i.tiltX)&&(i.tiltX=0),ct(i.tiltY)&&(i.tiltY=0),ct(i.pointerType)&&(i.pointerType="mouse"),ct(i.pointerId)&&(i.pointerId=1),ct(i.pressure)&&(i.pressure=.5),ct(i.twist)&&(i.twist=0),ct(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:o,y:n}=this.mapToViewportPoint(e);return e.viewport.x=o,e.viewport.y=n,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:o,y:n}=this.mapToViewportPoint(t);return t.viewport.x=o,t.viewport.y=n,t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=mn[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=gn.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),r=i.width(),o=i.height();return!(e.x<r&&e.y<o&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}class yn{static GetImage(t,e){var i;const r=yn.cache.get(t);r?"fail"===r.loadState?D.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===r.loadState||"loading"===r.loadState?null===(i=r.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,r.data):yn.loadImage(t,e)}static GetSvg(t,e){var i;let r=yn.cache.get(t);r?"fail"===r.loadState?D.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):"init"===r.loadState||"loading"===r.loadState?null===(i=r.waitingMark)||void 0===i||i.push(e):e&&e.imageLoadSuccess(t,r.data):(r={type:"image",loadState:"init"},yn.cache.set(t,r),r.dataPromise=D.global.loadSvg(t),r.dataPromise?(r.waitingMark=[e],r.dataPromise.then((e=>{var i;r.loadState=(null==e?void 0:e.data)?"success":"fail",r.data=null==e?void 0:e.data,null===(i=r.waitingMark)||void 0===i||i.map(((i,o)=>{(null==e?void 0:e.data)?(r.loadState="success",r.data=e.data,i.imageLoadSuccess(t,e.data)):(r.loadState="fail",i.imageLoadFail(t))})),r.waitingMark&&(r.waitingMark=[])}))):(r.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=yn.cache.get(t);return i?"fail"===i.loadState?Promise.reject():"init"===i.loadState||"loading"===i.loadState?i.dataPromise.then((t=>t.data)):Promise.resolve(i.data):(i={type:e,loadState:"init"},yn.cache.set(t,i),"arrayBuffer"===e?i.dataPromise=D.global.loadArrayBuffer(t):"blob"===e?i.dataPromise=D.global.loadBlob(t):"json"===e&&(i.dataPromise=D.global.loadJson(t)),i.dataPromise.then((t=>t.data)))}static loading(){setTimeout((()=>{if(!yn.isLoading&&yn.toLoadAueue.length){yn.isLoading=!0;const t=yn.toLoadAueue.splice(0,10),e=[];t.forEach((t=>{const{url:i,marks:r}=t,o={type:"image",loadState:"init"};if(yn.cache.set(i,o),o.dataPromise=D.global.loadImage(i),o.dataPromise){o.waitingMark=r;const t=o.dataPromise.then((t=>{var e;o.loadState=(null==t?void 0:t.data)?"success":"fail",o.data=null==t?void 0:t.data,null===(e=o.waitingMark)||void 0===e||e.map(((e,r)=>{(null==t?void 0:t.data)?(o.loadState="success",o.data=t.data,e.imageLoadSuccess(i,t.data)):(o.loadState="fail",e.imageLoadFail(i))})),o.waitingMark&&(o.waitingMark=[])}));e.push(t)}else o.loadState="fail",r.forEach((t=>t.imageLoadFail(i)))})),Promise.all(e).then((()=>{yn.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),yn.loading()})).catch((t=>{yn.isLoading=!1,this.onLoadSuccessCb.forEach((t=>t())),yn.loading()}))}}),0)}static loadImage(t,e){const i=Cn(t,yn.toLoadAueue);if(-1!==i)return yn.toLoadAueue[i].marks.push(e),void yn.loading();yn.toLoadAueue.push({url:t,marks:[e]}),yn.loading()}static improveImageLoading(t){const e=Cn(t,yn.toLoadAueue);if(-1!==e){const t=yn.toLoadAueue.splice(e,1);yn.toLoadAueue.unshift(t[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function Cn(t,e){for(let i=0;i<e.length;i++)if(e[i].url===t)return i;return-1}var wn;yn.cache=new Map,yn.isLoading=!1,yn.toLoadAueue=[],yn.onLoadSuccessCb=[],function(t){t[t.Top=1]="Top",t[t.Right=2]="Right",t[t.Bottom=4]="Bottom",t[t.Left=8]="Left",t[t.ALL=15]="ALL"}(wn||(wn={}));const vn=[!1,!1,!1,!1],xn=[0,0,0,0],_n=t=>t?ut(t)?0===t.length?0:1===t.length?t[0]:2===t.length?(xn[0]=t[0],xn[2]=t[0],xn[1]=t[1],xn[3]=t[1],xn):t:t:0,Sn=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],An=[1,2,3,0,1,2,3,0];function Tn(t,e,i,r){for(;t>=le;)t-=le;for(;t<0;)t+=le;for(;t>e;)e+=le;Sn[0].x=i,Sn[1].y=i,Sn[2].x=-i,Sn[3].y=-i;const o=Math.ceil(t/se)%4,n=Math.ceil(e/se)%4;if(r.add(de(t)*i,pe(t)*i),r.add(de(e)*i,pe(e)*i),o!==n||e-t>ne){let t=!1;for(let e=0;e<An.length;e++)if(t||o!==An[e]){if(t&&n===An[e])break;if(t){const t=Sn[An[e]];r.add(t.x,t.y)}}else{t=!0;const e=Sn[o];r.add(e.x,e.y)}}}function Rn(t,e,i){const{x:r,y:o}=ye(t.x,t.y,e.x,e.y,i),{x:n,y:s}=ye(t.x1,t.y1,e.x1,e.y1,i),a=new Ce(r,o,n,s);return a.defined=e.defined,a}function Bn(t,e,i){if(!t||!e)return[];Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);let r=[];if(t.length>e.length){r=e.map((t=>{const e=new Ce(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let o=0;o<e.length;o++)r[o]=Rn(t[o],e[o],i)}else{r=e.map((t=>{const e=new Ce(t.x,t.y,t.x1,t.y1);return e.defined=t.defined,e}));for(let o=0;o<t.length;o++)r[o]=Rn(t[o],e[o],i)}return r}function Mn(t,e){if(ut(t)){let i;for(let r=0;r<t.length&&void 0===i;r++)i=t[r][e];return i}return t[e]}class Pn{constructor(t=Pn.TimeOut){this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout((()=>{this.appendDuration(Date.now()-this.lastDate),t(0)}),this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce(((t,e)=>t+e),0)/this.durations.length,1e3/60),1e3/30)}}Pn.TimeOut=1e3/60;const Hn=new Pn,kn=(t,e)=>{const i=((t,e)=>dt(t)&&"%"===t[t.length-1]?e*(Number.parseFloat(t.substring(0,t.length-1))/100):t)(t,e);return isNaN(i)?i:Math.max(e,i)};class En{bounds(t,e){if(ft(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return ft(t)?t:Math.min(t[0],t[1])}}function Fn(t,e,i,r,o){return o?t.arc(i,r,e,0,ae,!1,o):t.arc(i,r,e,0,ae),!1}var Ln=new class extends En{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,r,o){return Fn(t,this.parseSize(e)/2,i,r,o)}drawOffset(t,e,i,r,o,n){return Fn(t,this.parseSize(e)/2+o,i,r,n)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e-o}, ${i} a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0`}};var In=new class extends En{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,r,o){return function(t,e,i,r,o){return t.moveTo(-3*e+i,-e+r,o),t.lineTo(-e+i,-e+r,o),t.lineTo(-e+i,-3*e+r,o),t.lineTo(e+i,-3*e+r,o),t.lineTo(e+i,-e+r,o),t.lineTo(3*e+i,-e+r,o),t.lineTo(3*e+i,e+r,o),t.lineTo(e+i,e+r,o),t.lineTo(e+i,3*e+r,o),t.lineTo(-e+i,3*e+r,o),t.lineTo(-e+i,e+r,o),t.lineTo(-3*e+i,e+r,o),t.closePath(),!0}(t,this.parseSize(e)/6,i,r,o)}drawOffset(t,e,i,r,o,n){return function(t,e,i,r,o,n){return t.moveTo(-3*e+i-o,-e+r-o,n),t.lineTo(-e+i-o,-e+r-o,n),t.lineTo(-e+i-o,-3*e+r-o,n),t.lineTo(e+i+o,-3*e+r-o,n),t.lineTo(e+i+o,-e+r-o,n),t.lineTo(3*e+i+o,-e+r-o,n),t.lineTo(3*e+i+o,e+r+o,n),t.lineTo(e+i+o,e+r+o,n),t.lineTo(e+i+o,3*e+r+o,n),t.lineTo(-e+i-o,3*e+r+o,n),t.lineTo(-e+i-o,e+r+o,n),t.lineTo(-3*e+i-o,e+r+o,n),t.closePath(),!0}(t,this.parseSize(e)/6,i,r,o,n)}};function zn(t,e,i,r,o){return t.moveTo(i,r-e,o),t.lineTo(e+i,r,o),t.lineTo(i,r+e,o),t.lineTo(i-e,r,o),t.closePath(),!0}var On=new class extends En{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,r,o){return zn(t,this.parseSize(e)/2,i,r,o)}drawFitDir(t,e,i,r,o){return zn(t,this.parseSize(e)/2,i,r,o)}drawOffset(t,e,i,r,o,n){return zn(t,this.parseSize(e)/2+o,i,r,n)}};function Dn(t,e,i,r){const o=2*e;return t.rect(i-e,r-e,o,o),!1}var Wn=new class extends En{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,r){return Dn(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return Dn(t,this.parseSize(e)/2+o,i,r)}};function Nn(t,e,i,r,o=0){return t.moveTo(i+e+2*o,e+r+o),t.lineTo(i-e-2*o,e+r+o),t.lineTo(i,r-e-2*o),t.closePath(),!0}class Gn extends En{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,r){return Nn(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return Nn(t,this.parseSize(e)/2,i,r,o)}}var jn=new Gn;var Vn=new class extends Gn{constructor(){super(...arguments),this.type="triangle"}};const Un=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),Kn=Math.sin(ae/10)*Un,$n=-Math.cos(ae/10)*Un;function Xn(t,e,i,r){const o=Kn*e,n=$n*e;t.moveTo(i,-e+r),t.lineTo(o+i,n+r);for(let s=1;s<5;++s){const a=ae*s/5,l=Math.cos(a),h=Math.sin(a);t.lineTo(h*e+i,-l*e+r),t.lineTo(l*o-h*n+i,h*o+l*n+r)}return t.closePath(),!0}var Yn=new class extends En{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,r){return Xn(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return Xn(t,this.parseSize(e)/2+o,i,r)}};const qn=fe(3);function Zn(t,e,i,r){const o=e,n=o/qn,s=n/5,a=e;return t.moveTo(0+i,-o+r),t.lineTo(n/2+i,r),t.lineTo(s/2+i,r),t.lineTo(s/2+i,a+r),t.lineTo(-s/2+i,a+r),t.lineTo(-s/2+i,r),t.lineTo(-n/2+i,r),t.closePath(),!0}var Jn=new class extends En{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,r){return Zn(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return Zn(t,this.parseSize(e)/2+o,i,r)}};function Qn(t,e,i,r){const o=2*e;return t.moveTo(i,-e+r),t.lineTo(o/3/2+i,e+r),t.lineTo(-o/3/2+i,e+r),t.closePath(),!0}var ts=new class extends En{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,r){return Qn(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return Qn(t,this.parseSize(e)/2+o,i,r)}};function es(t,e,i,r){return t.moveTo(-e+i,r),t.lineTo(i,e+r),!1}var is=new class extends En{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,r){return es(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return es(t,this.parseSize(e)/2+o,i,r)}};const rs=-.5,os=fe(3)/2,ns=1/fe(12);function ss(t,e,i,r){const o=e/2,n=e*ns,s=o,a=e*ns+e,l=-s,h=a;return t.moveTo(o+i,n+r),t.lineTo(s+i,a+r),t.lineTo(l+i,h+r),t.lineTo(rs*o-os*n+i,os*o+rs*n+r),t.lineTo(rs*s-os*a+i,os*s+rs*a+r),t.lineTo(rs*l-os*h+i,os*l+rs*h+r),t.lineTo(rs*o+os*n+i,rs*n-os*o+r),t.lineTo(rs*s+os*a+i,rs*a-os*s+r),t.lineTo(rs*l+os*h+i,rs*h-os*l+r),t.closePath(),!1}var as=new class extends En{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,r){return ss(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return ss(t,this.parseSize(e)/2+o,i,r)}};function ls(t,e,i,r,o){return t.moveTo(-e+i-2*o,r),t.lineTo(e+i+o,e+r+2*o),t.lineTo(e+i+o,r-e-2*o),t.closePath(),!0}var hs=new class extends En{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,r){return ls(t,this.parseSize(e)/2,i,r,0)}drawOffset(t,e,i,r,o){return ls(t,this.parseSize(e)/2,i,r,o)}};function cs(t,e,i,r,o=0){return t.moveTo(i-e-o,e+r+2*o),t.lineTo(e+i+2*o,r),t.lineTo(i-e-o,r-e-2*o),t.closePath(),!0}var ds=new class extends En{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,r){return cs(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return cs(t,this.parseSize(e)/2,i,r,o)}};function us(t,e,i,r,o=0){return t.moveTo(i-e-2*o,r-e-o),t.lineTo(i+e+2*o,r-e-o),t.lineTo(i,r+e+2*o),t.closePath(),!0}var gs=new class extends En{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,r){return us(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return us(t,this.parseSize(e)/2,i,r,o)}};const ps=fe(3);function fs(t,e,i,r){const o=e*ps;return t.moveTo(i,r+-o/3*2),t.lineTo(e+i,r+o),t.lineTo(i-e,r+o),t.closePath(),!0}var ms=new class extends En{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,r){return fs(t,this.parseSize(e)/2/ps,i,r)}drawOffset(t,e,i,r,o){return fs(t,this.parseSize(e)/2/ps+o,i,r)}};function bs(t,e,i,r){const o=2*e;return t.moveTo(e+i,r-o),t.lineTo(i-e,r),t.lineTo(e+i,o+r),!0}var ys=new class extends En{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,r){return bs(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return bs(t,this.parseSize(e)/4+o,i,r)}};function Cs(t,e,i,r){const o=2*e;return t.moveTo(i-e,r-o),t.lineTo(i+e,r),t.lineTo(i-e,o+r),!0}var ws=new class extends En{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,r){return Cs(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return Cs(t,this.parseSize(e)/4+o,i,r)}};function vs(t,e,i,r){const o=2*e;return t.moveTo(i-o,r+e),t.lineTo(i,r-e),t.lineTo(i+o,r+e),!0}var xs=new class extends En{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,r){return vs(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return vs(t,this.parseSize(e)/4+o,i,r)}};function _s(t,e,i,r){const o=2*e;return t.moveTo(i-o,r-e),t.lineTo(i,r+e),t.lineTo(i+o,r-e),!0}var Ss=new class extends En{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,r){return _s(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return _s(t,this.parseSize(e)/4+o,i,r)}};function As(t,e,i,r,o){return t.moveTo(i,r-e),t.lineTo(i,r+e),!0}var Ts=new class extends En{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,r,o){return As(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o,n){return As(t,this.parseSize(e)/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e}, ${i-o} L ${e},${i+o}`}};function Rs(t,e,i,r,o){return t.moveTo(i-e,r),t.lineTo(i+e,r),!0}var Bs=new class extends En{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,r,o){return Rs(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o,n){return Rs(t,this.parseSize(e)/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e-o}, ${i} L ${e+o},${i}`}};function Ms(t,e,i,r,o){return t.moveTo(i-e,r-e),t.lineTo(i+e,r+e),t.moveTo(i+e,r-e),t.lineTo(i-e,r+e),!0}var Ps=new class extends En{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,r,o){return Ms(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o,n){return Ms(t,this.parseSize(e)/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e-o}, ${i-o} L ${e+o},${i+o} M ${e+o}, ${i-o} L ${e-o},${i+o}`}};function Hs(t,e,i,r){return t.rect(i-e[0]/2,r-e[1]/2,e[0],e[1]),!1}function ks(t,e,i,r){const o=e,n=e/2;return t.rect(i-o/2,r-n/2,o,n),!1}var Es=new class extends En{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,r){return ft(e)?ks(t,e,i,r):Hs(t,e,i,r)}drawWithClipRange(t,e,i,r,o,n,s){ft(e)&&(e=[e,e/2]);const a=2*(e[0]+e[1])*o,l=[{x:i+e[0]/2,y:r-e[1]/2},{x:i+e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r-e[1]/2}];let h=0,c=l[3];t.moveTo(c.x,c.y);for(let e=0;e<l.length;e++){const i=l[e],r=Math.sqrt((i.x-c.x)*(i.x-c.x)+(i.y-c.y)*(i.y-c.y));if(h+r>a){const e=(i.x-c.x)*(a-h)/r,o=(i.y-c.y)*(a-h)/r;t.lineTo(c.x+e,c.y+o);break}t.lineTo(i.x,i.y),c=i,h+=r}return!1}drawOffset(t,e,i,r,o){return ft(e)?ks(t,e+2*o,i,r):Hs(t,[e[0]+2*o,e[1]+2*o],i,r)}};const Fs=new Ge;class Ls{constructor(t,e,i=!1){this.pathStr="",this.type=t,ut(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,r,o,n,s){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((o=>{t.beginPath(),Ri(o.path.commandList,t,i,r,e,e),s&&s(o.path,o.attribute)})),!1):(Ri(this.path.commandList,t,i,r,e+o,e+o),!1)}draw(t,e,i,r,o,n){return e=this.parseSize(e),this.drawOffset(t,e,i,r,0,o,n)}parseSize(t){return ft(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,r,o,n,s){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((n=>{n.path.drawWithClipRange(t,e,i,r,o),s&&s(n.path,n.attribute)})),!1):(this.path.drawWithClipRange(t,e,i,r,o),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg){if(!this.svgCache)return;return e.clear(),void this.svgCache.forEach((({path:i})=>{Fs.x1=i.bounds.x1*t,Fs.y1=i.bounds.y1*t,Fs.x2=i.bounds.x2*t,Fs.y2=i.bounds.y2*t,e.union(Fs)}))}this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const Is={};[Ln,In,On,Wn,ms,Vn,Yn,Jn,ts,is,as,hs,ds,jn,gs,ys,ws,xs,Ss,Es,Ts,Bs,Ps].forEach((t=>{Is[t.type]=t}));const zs={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};class Os{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){"__proto__"===t&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){"__proto__"===t.tagname&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function Ds(t,e,i,r){const o=t.indexOf(e,i);if(-1===o)throw new Error(r);return o+e.length-1}function Ws(t,e,i,r=">"){const o=function(t,e,i=">"){let r,o="";for(let n=e;n<t.length;n++){let e=t[n];if(r)e===r&&(r="");else if('"'===e||"'"===e)r=e;else if(e===i[0]){if(!i[1])return{data:o,index:n};if(t[n+1]===i[1])return{data:o,index:n}}else"\t"===e&&(e=" ");o+=e}}(t,e+1,r);if(!o)return;let n=o.data;const s=o.index,a=n.search(/\s/);let l=n,h=!0;-1!==a&&(l=n.substr(0,a).replace(/\s\s*$/,""),n=n.substr(a+1));const c=l;if(i){const t=l.indexOf(":");-1!==t&&(l=l.substr(t+1),h=l!==o.data.substr(t+1))}return{tagName:l,tagExp:n,closeIndex:s,attrExpPresent:h,rawTagName:c}}const Ns=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");class Gs{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const r=e.tagname;"string"==typeof r?(e.tagname=r,t.addChild(e)):t.addChild(e)}buildAttributesMap(t,e,i){const r={};if(!t)return;const o=function(t,e){const i=[];let r=e.exec(t);for(;r;){const o=[];o.startIndex=e.lastIndex-r[0].length;const n=r.length;for(let t=0;t<n;t++)o.push(r[t]);i.push(o),r=e.exec(t)}return i}(t,Ns),n=o.length;for(let t=0;t<n;t++){const e=o[t][1],i=o[t][4];e&&(r[e]=void 0===i||(isNaN(i)?i:Number(i)))}return r}parseXml(t){t=t.replace(/\r\n?/g,"\n");const e=new Os("!xml");let i=e,r="",o="";for(let n=0;n<t.length;n++)if("<"===t[n])if("/"===t[n+1]){const e=Ds(t,">",n,"Closing Tag is not closed."),s=o.lastIndexOf(".");o=o.substring(0,s),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",n=e}else if("?"===t[n+1])n=Ws(t,n,!1,"?>").closeIndex+1;else if("!--"===t.substr(n+1,3))n=Ds(t,"--\x3e",n+4,"Comment is not closed.");else{const s=Ws(t,n,!1);let a=s.tagName,l=s.tagExp;const h=s.attrExpPresent,c=s.closeIndex;if(a!==e.tagname&&(o+=o?"."+a:a),l.length>0&&l.lastIndexOf("/")===l.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),o=o.substr(0,o.length-1),l=a):l=l.substr(0,l.length-1);const t=new Os(a);a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,o,a)),this.addChild(i,t,o),o=o.substr(0,o.lastIndexOf("."))}else{const t=new Os(a);this.tagsNodeStack.push(i),a!==l&&h&&(t[":@"]=this.buildAttributesMap(l,o,a)),this.addChild(i,t,o),i=t}r="",n=c}else r+=t[n];return e.child}}function js(t,e){return Vs(t)}function Vs(t,e){const i={};for(let e=0;e<t.length;e++){const r=t[e],o=Us(r);if(void 0!==o&&r[o]){const t=Vs(r[o]);$s(t),r[":@"]&&Ks(t,r[":@"]),void 0!==i[o]&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(t)):i[o]=t}}return i}function Us(t){const e=Object.keys(t);for(let t=0;t<e.length;t++){const i=e[t];if(":@"!==i)return i}}function Ks(t,e,i){if(e){const i=Object.keys(e),r=i.length;for(let o=0;o<r;o++){const r=i[o];t[r]=e[r]}}}function $s(t){return 0===Object.keys(t).length}class Xs{constructor(t){this.options=Object.assign({},Xs.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;return js(new Gs(this.options).parseXml(t),this.options)}}function Ys(t,e,i,r=0){return t.expand(e+(r/2+(i?function(t,e){return t?e:0}(i,e):0))),t}Xs.defaultOptions={};let qs=0;function Zs(){return qs++}var Js;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Js||(Js={}));const Qs=new Map;["…","（","）","—","【","】","「","」","《","》"].forEach((t=>Qs.set(t,!0)));const ta=new Map;function ea(t){if(Qs.has(t))return!0;if(ta.has(t))return!1;let e=!1;return t.codePointAt(0)<256&&(e=!0),e}[""].forEach((t=>ta.set(t,!0)));const ia=Zs(),ra=Zs(),oa=Zs(),na=Zs();Zs();const sa=Zs(),aa=Zs(),la=Zs(),ha=Zs(),ca=Zs();Zs();const da=Zs();Zs();const ua=Zs();Zs();const ga=Zs(),pa=Zs(),fa=Symbol.for("GraphicService"),ma=Symbol.for("GraphicCreator"),ba={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},ya=Object.keys(ba),Ca={duration:200,easing:"cubicOut"};function wa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function va(t,e,i){const r=i[0],o=i[1],n=i[2];let s,a,l,h,c,d,u,g,p,f,m,b;return e===t?(t[12]=e[0]*r+e[4]*o+e[8]*n+e[12],t[13]=e[1]*r+e[5]*o+e[9]*n+e[13],t[14]=e[2]*r+e[6]*o+e[10]*n+e[14],t[15]=e[3]*r+e[7]*o+e[11]*n+e[15]):(s=e[0],a=e[1],l=e[2],h=e[3],c=e[4],d=e[5],u=e[6],g=e[7],p=e[8],f=e[9],m=e[10],b=e[11],t[0]=s,t[1]=a,t[2]=l,t[3]=h,t[4]=c,t[5]=d,t[6]=u,t[7]=g,t[8]=p,t[9]=f,t[10]=m,t[11]=b,t[12]=s*r+c*o+p*n+e[12],t[13]=a*r+d*o+f*n+e[13],t[14]=l*r+u*o+m*n+e[14],t[15]=h*r+g*o+b*n+e[15]),t}function xa(t,e){t[0]=e.a,t[1]=e.b,t[2]=0,t[3]=0,t[4]=e.c,t[5]=e.d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e.e,t[13]=e.f,t[14]=0,t[15]=1}function _a(t,e,i){const r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],c=e[7],d=e[8],u=e[9],g=e[10],p=e[11],f=e[12],m=e[13],b=e[14],y=e[15];let C=i[0],w=i[1],v=i[2],x=i[3];return t[0]=C*r+w*a+v*d+x*f,t[1]=C*o+w*l+v*u+x*m,t[2]=C*n+w*h+v*g+x*b,t[3]=C*s+w*c+v*p+x*y,C=i[4],w=i[5],v=i[6],x=i[7],t[4]=C*r+w*a+v*d+x*f,t[5]=C*o+w*l+v*u+x*m,t[6]=C*n+w*h+v*g+x*b,t[7]=C*s+w*c+v*p+x*y,C=i[8],w=i[9],v=i[10],x=i[11],t[8]=C*r+w*a+v*d+x*f,t[9]=C*o+w*l+v*u+x*m,t[10]=C*n+w*h+v*g+x*b,t[11]=C*s+w*c+v*p+x*y,C=i[12],w=i[13],v=i[14],x=i[15],t[12]=C*r+w*a+v*d+x*f,t[13]=C*o+w*l+v*u+x*m,t[14]=C*n+w*h+v*g+x*b,t[15]=C*s+w*c+v*p+x*y,t}function Sa(t,e,i){const r=e[0],o=e[1],n=e[2];let s=i[3]*r+i[7]*o+i[11]*n+i[15];return s=s||1,t[0]=(i[0]*r+i[4]*o+i[8]*n+i[12])/s,t[1]=(i[1]*r+i[5]*o+i[9]*n+i[13])/s,t[2]=(i[2]*r+i[6]*o+i[10]*n+i[14])/s,t}class Aa{constructor(){this.pools=[]}static identity(t){return wa(t)}allocate(){if(!this.pools.length)return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const t=this.pools.pop();return Aa.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const Ta=new class{constructor(){this.pools=[]}allocate(t,e,i,r,o,n){if(!this.pools.length)return new Ve(t,e,i,r,o,n);const s=this.pools.pop();return s.a=t,s.b=e,s.c=i,s.d=r,s.e=o,s.f=n,s}allocateByObj(t){if(!this.pools.length)return new Ve(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},Ra=new Aa;var Ba=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ma=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const Pa=new Ve(1,0,0,1,0,0),Ha={x:0,y:0};let ka=class{get nativeContext(){return this.path}constructor(t,e){this.matrix=new Ve(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new Ve(1,0,0,1,0,0),this.path=new pr,this._clearMatrix=new Ve(1,0,0,1,0,0)}getCanvas(){throw new Error("不支持getCanvas")}getContext(){throw new Error("不支持getContext")}setTransformForCurrent(t=!1){!t&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix=this.cloneMatrix(this.matrix))}get currentMatrix(){return this.matrix}cloneMatrix(t){return Ta.allocateByObj(t)}clear(){this.save(),this.resetTransform(),this.restore()}reset(){this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Ve(1,0,0,1,0,0),this.stack.length=0}restore(){this.stack.length>0&&(Ta.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent())}highPerformanceRestore(){this.stack.length>0&&(Ta.free(this.matrix),this.matrix=this.stack.pop())}rotate(t,e=!0){this.matrix.rotate(t),e&&this.setTransformForCurrent()}save(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}highPerformanceSave(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}scale(t,e,i=!0){this.matrix.scale(t,e),i&&this.setTransformForCurrent()}setScale(t,e,i=!0){this.matrix.setScale(t,e),i&&this.setTransformForCurrent()}scalePoint(t,e,i,r,o=!0){this.translate(i,r,!1),this.scale(t,e,!1),this.translate(-i,-r,!1),o&&this.setTransformForCurrent()}setTransform(t,e,i,r,o,n,s=!0,a=this.dpr){this.matrix.setValue(a*t,a*e,a*i,a*r,a*o,a*n),s&&this.setTransformForCurrent()}setTransformFromMatrix(t,e=!0,i=this.dpr){this.matrix.setValue(t.a*i,t.b*i,t.c*i,t.d*i,t.e*i,t.f*i),e&&this.setTransformForCurrent()}resetTransform(t=!0,e=this.dpr){this.setTransform(e,0,0,e,0,0),t&&this.setTransformForCurrent()}transform(t,e,i,r,o,n,s=!0){this.matrix.multiply(t,e,i,r,o,n),s&&this.setTransformForCurrent()}transformFromMatrix(t,e){this.matrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f),e&&this.setTransformForCurrent()}translate(t,e,i=!0){this.matrix.translate(t,e),i&&this.setTransformForCurrent()}rotateDegrees(t,e=!0){const i=t*Math.PI/180;this.rotate(i,e)}rotateAbout(t,e,i,r=!0){this.translate(e,i,!1),this.rotate(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}rotateDegreesAbout(t,e,i,r=!0){this.translate(e,i,!1),this.rotateDegrees(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}beginPath(){this.path.clear()}clip(t,e){}arc(t,e,i,r,o,n){this.path.arc(t,e,i,r,o,n)}arcTo(t,e,i,r,o){this.path.arcTo(t,e,i,r,o)}bezierCurveTo(t,e,i,r,o,n){this.path.bezierCurveTo(t,e,i,r,o,n)}closePath(){this.path.closePath()}ellipse(t,e,i,r,o,n,s,a){}lineTo(t,e){this.path.lineTo(t,e)}moveTo(t,e){this.path.moveTo(t,e)}quadraticCurveTo(t,e,i,r){this.path.quadraticCurveTo(t,e,i,r)}rect(t,e,i,r){this.path.rect(t,e,i,r)}createImageData(t,e){return null}createLinearGradient(t,e,i,r){throw new Error("不支持createLinearGradient")}createPattern(t,e){throw new Error("不支持createPattern")}createRadialGradient(t,e,i,r,o,n){throw new Error("不支持createRadialGradient")}createConicGradient(t,e,i,r){return null}fill(t,e){}fillRect(t,e,i,r){this.path.rect(t,e,i,r)}clearRect(t,e,i,r){}fillText(t,e,i){}getImageData(t,e,i,r){return null}getLineDash(){return[]}isPointInPath(t,e){return this.matrix.transformPoint({x:t,y:e},Ha),function(t,e,i){return Oo(t,0,!1,e,i)}(this.path.commandList,Ha.x,Ha.y)}isPointInStroke(t,e){if(!this.lineWidth)return!1;this.matrix.transformPoint({x:t,y:e},Ha);const i=Gr(this,this.lineWidth,this.dpr);return function(t,e,i,r){return Oo(t,e,!0,i,r)}(this.path.commandList,i,Ha.x,Ha.y)}measureText(t){throw new Error("不支持measureText")}putImageData(t,e,i){throw new Error("不支持measureText")}setLineDash(t){}stroke(t){}strokeRect(t,e,i,r){this.path.rect(t,e,i,r)}strokeText(t,e,i){}drawImage(){}setCommonStyle(t,e,i,r,o){}_setCommonStyle(t,e,i,r){}setStrokeStyle(t,e,i,r,o){}_setStrokeStyle(t,e,i,r){}setTextStyleWithoutAlignBaseline(t,e){}setTextStyle(t,e){}draw(){}clearMatrix(t=!0,e=this.dpr){this.setTransformFromMatrix(Pa,t,e)}setClearMatrix(t,e,i,r,o,n){this._clearMatrix.setValue(t,e,i,r,o,n)}onlyTranslate(t=this.dpr){return this.matrix.a===t&&0===this.matrix.b&&0===this.matrix.c&&this.matrix.d===t}release(...t){this.stack.forEach((t=>Ta.free(t))),this.stack.length=0}};ka=Ba([f(),Ma("design:paramtypes",[Object,Number])],ka);const Ea={WIDTH:500,HEIGHT:500,DPR:1};class Fa{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:r=Ea.WIDTH,height:o=Ea.HEIGHT,dpr:n=Ea.DPR,x:s,y:a,id:l,canvasControled:h=!0}=t;this._x=null!=s?s:0,this._y=null!=a?a:0,this._pixelWidth=r*n,this._pixelHeight=o*n,this._visiable=!1!==t.visiable,this.controled=h,this._displayWidth=r,this._displayHeight=o,this._dpr=n,this._nativeCanvas=i,this._id=null!==(e=i.id)&&void 0!==e?e:l,l&&(i.id=l),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,r){return this._context.getImageData(t,e,i,r)}convertToBlob(t){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(...t){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}var La;Fa.env="browser",function(t){t[t.Color255=0]="Color255",t[t.Color1=1]="Color1"}(La||(La={}));class Ia{static Get(t,e=La.Color1,i=[0,0,0,1]){if(e===La.Color1){const e=Ia.store1[t];if(e)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i;const r=ii.parseColorString(t);if(r){const e=[r.r/255,r.g/255,r.b/255,r.opacity];Ia.store1[t]=e,Ia.store255[t]=[r.r,r.g,r.b,r.opacity],i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]}return i}const r=Ia.store255[t];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const o=ii.parseColorString(t);return o&&(Ia.store1[t]=[o.r/255,o.g/255,o.b/255,o.opacity],Ia.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=o.r,i[1]=o.g,i[2]=o.b,i[3]=o.opacity),i}static Set(t,e,i){if(e===La.Color1){if(Ia.store1[t])return;Ia.store1[t]=i,Ia.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(Ia.store255[t])return;Ia.store255[t]=i,Ia.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}function za(t,e=!1){return Array.isArray(t)&&ft(t[0])?e?`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])},${t[3].toFixed(2)})`:`rgb(${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])})`:t}function Oa(t,e,i,r,o){return Array.isArray(t)&&!ft(t[0])||Array.isArray(e)&&!ft(e[0])?new Array(4).fill(0).map(((o,n)=>{var s,a;return Da(ut(t)?null!==(s=t[n])&&void 0!==s?s:t[0]:t,ut(e)?null!==(a=e[n])&&void 0!==a?a:e[0]:e,i,r)})):Da(t,e,i,r,o)}function Da(t,e,i,r,o){if(!t||!e)return t&&za(t)||e&&za(e)||!1;let n,s,a=!1,l=!1;if(Array.isArray(t)?n=t:"string"==typeof t?n=Ia.Get(t,La.Color255):a=!0,Array.isArray(e)?s=e:"string"==typeof e?s=Ia.Get(e,La.Color255):l=!0,a!==l){const n=a?t:e,s=a?e:t,l=Object.assign(Object.assign({},n),{stops:n.stops.map((t=>Object.assign(Object.assign({},t),{color:za(s)})))});return a?Oa(n,l,i,r,o):Oa(l,n,i,r,o)}if(a){if(t.gradient===e.gradient){const r=t,o=e,n=r.stops,s=o.stops;if(n.length!==s.length)return!1;if("linear"===r.gradient)return function(t,e,i){const r=t.stops,o=e.stops;return{gradient:"linear",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,stops:new Array(r.length).fill(0).map(((t,e)=>({color:ja(r[e].color,o[e].color,i),offset:r[e].offset+(o[e].offset-r[e].offset)*i})))}}(r,o,i);if("radial"===r.gradient)return function(t,e,i){const r=t.stops,o=e.stops;return{gradient:"radial",x0:t.x0+(e.x0-t.x0)*i,x1:t.x1+(e.x1-t.x1)*i,y0:t.y0+(e.y0-t.y0)*i,y1:t.y1+(e.y1-t.y1)*i,r0:t.r0+(e.r0-t.r0)*i,r1:t.r1+(e.r1-t.r1)*i,stops:new Array(r.length).fill(0).map(((t,e)=>({color:ja(r[e].color,o[e].color,i),offset:r[e].offset+(o[e].offset-r[e].offset)*i})))}}(r,o,i);if("conical"===r.gradient)return function(t,e,i){const r=t.stops,o=e.stops;return{gradient:"conical",startAngle:t.startAngle+(e.startAngle-t.startAngle)*i,endAngle:t.endAngle+(e.endAngle-t.endAngle)*i,x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i,stops:new Array(r.length).fill(0).map(((t,e)=>({color:ja(r[e].color,o[e].color,i),offset:r[e].offset+(o[e].offset-r[e].offset)*i})))}}(r,o,i)}return!1}return o&&o(n,s),za(function(t,e,i){return[t[0]+(e[0]-t[0])*i,t[1]+(e[1]-t[1])*i,t[2]+(e[2]-t[2])*i,t[3]+(e[3]-t[3])*i]}(n,s,i),r)}function Wa(t,e,i){return`rgba(${t[0]+(e[0]-t[0])*i},${t[1]+(e[1]-t[1])*i},${t[2]+(e[2]-t[2])*i},${t[3]+(e[3]-t[3])*i})`}Ia.store255={},Ia.store1={};const Na=[0,0,0,0],Ga=[0,0,0,0];function ja(t,e,i){return Ia.Get(t,La.Color255,Na),Ia.Get(e,La.Color255,Ga),`rgba(${Math.round(Na[0]+(Ga[0]-Na[0])*i)},${Math.round(Na[1]+(Ga[1]-Na[1])*i)},${Math.round(Na[2]+(Ga[2]-Na[2])*i)},${Na[3]+(Ga[3]-Na[3])*i})`}class Va{static GetCanvas(){try{return Va.canvas||(Va.canvas=D.global.createCanvas({})),Va.canvas}catch(t){return null}}static GetCtx(){if(!Va.ctx){const t=Va.GetCanvas();Va.ctx=t.getContext("2d")}return Va.ctx}}class Ua extends Ue{static getInstance(){return Ua._instance||(Ua._instance=new Ua),Ua._instance}constructor(t=[],e=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=Va.GetCanvas(),r=Va.GetCtx();if(i.width=e,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("获取ctx发生错误");const o=r.createLinearGradient(0,0,e,0);t.forEach((t=>{o.addColorStop(t[0],t[1])})),r.fillStyle=o,r.fillRect(0,0,e,1),this.rgbaSet=r.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,r,o=[],n=100){let s=`${t}${e}${i}${r}`;o.forEach((t=>s+=t.join())),s+=n;let a=this.dataMap.get(s);return a||(a={data:new Ua(o,n),timestamp:[]},this.addLimitedTimestamp(a,Date.now(),{}),this.dataMap.set(s,a)),this.clearCache(this.dataMap,this.cacheParams),a.data}}class Ka{static GetSize(t){for(let e=0;e<Ka.ImageSize.length;e++)if(Ka.ImageSize[e]>=t)return Ka.ImageSize[e];return t}static Get(t,e,i,r,o,n,s){const a=Ka.GenKey(t,e,i,r,o),l=Ka.cache[a];if(!l||0===l.length)return null;for(let t=0;t<l.length;t++)if(l[t].width>=n&&l[t].height>=s)return l[t].pattern;return null}static Set(t,e,i,r,o,n,s,a){const l=Ka.GenKey(t,e,i,r,o);Ka.cache[l]?Ka.cache[l].push({width:s,height:a,pattern:n}):Ka.cache[l]=[{width:s,height:a,pattern:n}]}static GenKey(t,e,i,r,o){return`${e},${i},${r},${o},${t.join()}`}}Ka.cache={},Ka.ImageSize=[20,40,80,160,320,640,1280,2560];const $a=new Ge,Xa=new Ve;new Ge;const Ya=["lineWidth","scaleX","scaleY","angle","anchor","visible"],qa=["x","y"],Za=["scaleX","scaleY"],Ja=["angle"],Qa=new Ce,tl={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class el extends an{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(el.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(t={}){var e;super(),this._AABBBounds=new Ge,this._updateTag=yi.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage(null!==(e=t.background.background)&&void 0!==e?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}getGraphicService(){var t,e;return null!==(e=null===(t=this.stage)||void 0===t?void 0:t.graphicService)&&void 0!==e?e:D.graphicService}getAttributes(){return this.attribute}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t,e=!1){var i,r;const{dx:o=t.dx,dy:n=t.dy}=this.attribute;if(e&&this.parent){const t=this.parent.attribute;Qa.x=o+(null!==(i=t.scrollX)&&void 0!==i?i:0),Qa.y=n+(null!==(r=t.scrollY)&&void 0!==r?r:0)}else Qa.x=o,Qa.y=n;return Qa}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){const t="imprecise"===this.attribute.boundsMode;if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;this.getGraphicService().beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return this.getGraphicService().afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),"empty"===this.attribute.boundsMode&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new je),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){const{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);const{shape:e}=t;let i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=Is[t];if(e)return e;if(e=el.userSymbolMap[t],e)return e;if(!0===function(t){return t.startsWith("<svg")||t.startsWith("<?xml")}(t=zs[t]||t)){const e=new Xs,{svg:i}=e.parse(t);if(!i)return null;const r=ut(i.path)?i.path:[i.path];$a.clear();const o=[];r.forEach((t=>{const e=(new pr).fromString(t.d),i={};ya.forEach((e=>{t[e]&&(i[ba[e]]=t[e])})),o.push({path:e,attribute:i}),$a.union(e.bounds)}));const n=$a.width(),s=$a.height(),a=1/ue(n,s);o.forEach((t=>t.path.transform(0,0,a,a)));const l=new Ls(t,o,!0);return el.userSymbolMap[t]=l,l}const i=(new pr).fromString(t),r=i.bounds.width(),o=i.bounds.height(),n=1/ue(r,o);i.transform(0,0,n,n);const s=new Ls(t,i);return el.userSymbolMap[t]=s,s}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,r=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:o=e.boundsPadding}=i,n=_n(o);return n&&r.expand(n),this.clearUpdateBoundTag(),r}updatePathProxyAABBBounds(t){const e="function"==typeof this.pathProxy?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new ai(t);return Ri(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(t=!0){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(t=!0){return this._transMatrix||(this._transMatrix=new Ve),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&yi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&this.getGraphicService().validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&yi.UPDATE_BOUNDS)&&this.getGraphicService().validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&yi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&yi.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&yi.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite((null!==(t=i.x)&&void 0!==t?t:0)+(null!==(e=i.y)&&void 0!==e?e:0))}_validNumber(t){return null==t||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&yi.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=yi.CLEAR_SHAPE}containsPoint(t,e,i,r){if(!r)return!1;if(i===Ci.GLOBAL){const i=new Ce(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),t=i.x,e=i.y}return r.containsPoint(this,{x:t,y:e})}setWidthHeightWithoutTransform(t){this.widthWithoutTransform=t.x2-t.x1,this.heightWithoutTransform=t.y2-t.y1}setAttributesAndPreventAnimate(t,e=!1,i,r){this.setAttributes(t,e,i),this.animates&&this.animates.forEach((e=>{(e.priority!==1/0||r)&&Object.keys(t).forEach((t=>{e.preventAttr(t)}))}))}setAttributes(t,e=!1,i){(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t,e=!1,i){const r=Object.keys(t);for(let e=0;e<r.length;e++){const i=r[e];this.attribute[i]=t[i]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,r){var o;const n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);n?this._setAttributes(n,i,r):nt(null===(o=this.normalAttrs)||void 0===o?void 0:o[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[t]=e,"background"===t?this.loadImage(e,!0):"shadowGraphic"===t&&this.setShadowGraphic(e)}needUpdateTags(t,e=Ya){for(let i=0;i<e.length;i++){const r=e[i];if(-1!==t.indexOf(r))return!0}return!1}needUpdateTag(t,e=Ya){for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:wi.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=yi.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,r;if(0===t&&0===e)return this;const o={type:wi.TRANSLATE},n=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,qa,o);n&&(t=n.x,e=n.y,delete n.x,delete n.y,this._setAttributes(n));const s=this.attribute,a=s.postMatrix;return a?D.transformUtil.fromMatrix(a,a).translate(t,e):(s.x=(null!==(i=s.x)&&void 0!==i?i:br.x)+t,s.y=(null!==(r=s.y)&&void 0!==r?r:br.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const r={type:wi.TRANSLATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,qa,r);return o?(this._setAttributes(o,!1,r),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(t,e,i){var r,o;if(1===t&&1===e)return this;const n={type:wi.SCALE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,Za,n);s&&(t=s.scaleX,e=s.scaleY,delete s.scaleX,delete s.scaleY,this._setAttributes(s));const a=this.attribute;if(i){let{postMatrix:r}=this.attribute;r||(r=new Ve,a.postMatrix=r),D.transformUtil.fromMatrix(r,r).scale(t,e,i)}else a.scaleX=(null!==(r=a.scaleX)&&void 0!==r?r:br.scaleX)*t,a.scaleY=(null!==(o=a.scaleY)&&void 0!==o?o:br.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(n),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const r={type:wi.SCALE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,Za,r);return o?(this._setAttributes(o,!1,r),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(t,e){var i;if(0===t)return this;const r={type:wi.ROTATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,Ja,r);o&&(delete o.angle,this._setAttributes(o,!1,r));const n=this.attribute;if(e){let{postMatrix:i}=this.attribute;i||(i=new Ve,n.postMatrix=i),D.transformUtil.fromMatrix(i,i).rotate(t,e)}else n.angle=(null!==(i=n.angle)&&void 0!==i?i:br.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:wi.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,Ja,i);return r?(this._setAttributes(r,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}onAttributeUpdate(t){t&&t.skipUpdateCallback||(this.getGraphicService().onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!nt(t)||this.currentStates.includes(t))}getState(t){var e;return null===(e=this.states)||void 0===e?void 0:e[t]}applyStateAttrs(t,e,i,r){var o,n;if(i){const e=Object.keys(t),i=this.getNoWorkAnimateAttr(),s={};let a;e.forEach((e=>{i[e]?(a||(a={}),a[e]=t[e]):s[e]=r&&void 0===t[e]?this.getDefaultAttribute(e):t[e]}));const l=null!==(n=null!==(o=this.context&&this.context.stateAnimateConfig)&&void 0!==o?o:this.stateAnimateConfig)&&void 0!==n?n:Ca;this.applyAnimationState(["state"],[{name:"state",animation:{type:"state",to:s,duration:l.duration,easing:l.easing}}]),a&&this.setAttributesAndPreventAnimate(a,!1,{type:wi.STATE})}else this.stopStateAnimates(),this.setAttributesAndPreventAnimate(t,!1,{type:wi.STATE}),this.finalAttribute&&Object.assign(this.finalAttribute,t);this._emitCustomEvent("afterStateUpdate",{type:wi.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach((t=>{t in this.normalAttrs?(e[t]=this.normalAttrs[t],delete this.normalAttrs[t]):e[t]=this.getNormalAttribute(t)})),Object.keys(this.normalAttrs).forEach((e=>{t[e]=this.normalAttrs[e]}))):Object.keys(t).forEach((t=>{e[t]=this.getNormalAttribute(t)})),this.normalAttrs=e}stopStateAnimates(t="end"){this.animates&&this.animates.forEach((e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))}))}getNormalAttribute(t){var e,i;const r=this.attribute[t];return this.animates?null===(e=this.finalAttribute)||void 0===e?void 0:e[t]:null!=r?r:null===(i=this.finalAttribute)||void 0===i?void 0:i[t]}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){const i=ut(t)?e=>!t.includes(e):e=>e!==t,r=this.currentStates.filter(i);r.length!==this.currentStates.length&&this.useStates(r,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var r;if(this.currentStates&&this.currentStates.includes(t)&&(e||1===this.currentStates.length))return;const o=e&&(null===(r=this.currentStates)||void 0===r?void 0:r.length)?this.currentStates.concat([t]):[t];this.useStates(o,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if((null===(i=this.currentStates)||void 0===i?void 0:i.length)===t.length&&!t.some(((t,e)=>this.currentStates[e]!==t)))return;const r={};t.forEach((e=>{var i;const o=this.stateProxy?this.stateProxy(e,t):null===(i=this.states)||void 0===i?void 0:i[e];o&&Object.assign(r,o)})),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}addUpdateBoundTag(){this._updateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=yi.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=yi.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&yi.UPDATE_SHAPE_AND_BOUNDS)===yi.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=yi.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=yi.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=yi.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=yi.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=yi.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=yi.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=yi.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&yi.UPDATE_LAYOUT)}getAnchor(t,e,i){const r=[0,0],o=()=>{if(e.b)return e.b;const t=this.clone();return t.attribute.angle=0,t.attribute.scaleCenter=null,i&&(t.attribute.scaleX=1,t.attribute.scaleY=1),e.b=t.AABBBounds,e.b};if("string"==typeof t[0]){const e=parseFloat(t[0])/100,i=o();r[0]=i.x1+(i.x2-i.x1)*e}else r[0]=t[0];if("string"==typeof t[1]){const e=parseFloat(t[1])/100,i=o();r[1]=i.y1+(i.y2-i.y1)*e}else r[1]=t[1];return r}doUpdateLocalMatrix(){const{x:t=br.x,y:e=br.y,scaleX:i=br.scaleX,scaleY:r=br.scaleY,angle:o=br.angle,scaleCenter:n,anchor:s,postMatrix:a}=this.attribute;let l=[0,0];const h={};if(s&&o&&(l=this.getAnchor(s,h)),!n||1===i&&1===r)!function(t,e,i,r,o,n,s,a){const l=e.a,h=e.b,c=e.c,d=e.d,u=e.e,g=e.f,p=de(s),f=pe(s);let m,b;a?(m=a[0],b=a[1]):(m=i,b=r);const y=m-i,C=b-r,w=l*p+c*f,v=h*p+d*f,x=c*p-l*f,_=d*p-h*f;t.a=o*w,t.b=o*v,t.c=n*x,t.d=n*_,t.e=u+l*m+c*b-w*y-x*C,t.f=g+h*m+d*b-v*y-_*C}(this._transMatrix,this._transMatrix.reset(),t,e,i,r,o,s&&l);else{const s=this._transMatrix;s.reset(),s.translate(l[0],l[1]),s.rotate(o),s.translate(-l[0],-l[1]),s.translate(t,e),l=this.getAnchor(n,h,!0),D.transformUtil.fromMatrix(s,s).scale(i,r,{x:l[0],y:l[1]})}const c=this.getOffsetXY(br);if(this._transMatrix.e+=c.x,this._transMatrix.f+=c.y,a){const t=Xa.setValue(a.a,a.b,a.c,a.d,a.e,a.f),e=this._transMatrix;t.multiply(e.a,e.b,e.c,e.d,e.e,e.f),e.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const e=t.getTimeline();this.animates.forEach((t=>{t.timeline.isGlobal&&(t.setTimeline(e),e.addAnimate(t))}))}this._onSetStage&&this._onSetStage(this,t,e),this.getGraphicService().onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:wi.ANIMATE_END})}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return null!==(e=this.attribute[t])&&void 0!==e?e:this.getDefaultAttribute(t)}onSetStage(t,e=!1){this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=null!=t?t:D.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map((t=>t.toJson()))}}createPathProxy(t){return dt(t,!0)?this.pathProxy=(new pr).fromString(t):this.pathProxy=new pr,this.pathProxy}loadImage(t,e=!1){if(!t||e&&function(t){return!(!t.fill&&!t.stroke)}(t))return;const i=t;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),"string"==typeof t?(r.state="loading",t.startsWith("<svg")?(yn.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(bt(t)||t.includes("/")||yt(t))&&(yn.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):at(t)?(r.state="success",r.data=t,this.backgroundImg=this.backgroundImg||e):r.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const r=this.resources.get(t);r&&(r.state="success",r.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach((t=>{t.stop()}))}stopAnimates(t=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren((e=>{e.stopAnimates(t)}))}release(){this.releaseStatus="released",this.stopAnimates(),D.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,r;if(this._events&&t in this._events){const o=new un(t,e);o.bubbles=!1,o.manager=null===(r=null===(i=this.stage)||void 0===i?void 0:i.eventSystem)||void 0===r?void 0:r.manager,this.dispatchEvent(o)}}toCustomPath(){var t,e,i;const r=null===(i=null===(e=(null===(t=this.stage)||void 0===t?void 0:t.renderService)||D.renderService)||void 0===e?void 0:e.drawContribution)||void 0===i?void 0:i.getRenderContribution(this);if(r){const t=new ka(null,1);return r.drawShape(this,t,0,0,{},{}),t.path}return null}}var il;el.userSymbolMap={},el.mixin(fn),function(t){t[t.LESS_GROUP=0]="LESS_GROUP",t[t.MORE_GROUP=1]="MORE_GROUP"}(il||(il={}));let rl=class t extends el{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=sa,this._childUpdateTag=yi.UPDATE_BOUNDS}setMode(t){"3d"===t?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new rn),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new rn)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren((e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)}))}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===Ci.GLOBAL){const i=new Ce(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(i,i),this.AABBBounds.contains(i.x,i.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&yi.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.getGraphicService().beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),this.getGraphicService().afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),"empty"===this.attribute.boundsMode&&e.clear(),e}doUpdateLocalMatrix(){const{x:t=br.x,y:e=br.y,dx:i=br.dx,dy:r=br.dy,scaleX:o=br.scaleX,scaleY:n=br.scaleY,angle:s=br.angle,postMatrix:a}=this.attribute;if(0!==t||0!==e||0!==i||0!==r||1!==o||1!==n||0!==s||a)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return nn(this).group}updateAABBBounds(t,e,i){const r=i;i=i.clone();const{width:o,height:n,path:s,clip:a=e.clip}=t;if(s&&s.length?s.forEach((t=>{i.union(t.AABBBounds)})):null!=o&&null!=n&&i.set(0,0,Math.max(0,o),Math.max(0,n)),!a){this.forEachChildren((t=>{i.union(t.AABBBounds)}));const{scrollX:e=0,scrollY:r=0}=t;i.translate(e,r)}return D.graphicService.updateTempAABBBounds(i),D.graphicService.transformAABBBounds(t,i,e,!1,this),r.copy(i),r}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=yi.CLEAR_BOUNDS,this._childUpdateTag&=yi.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&yi.UPDATE_BOUNDS||(this._childUpdateTag|=yi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),this.getGraphicService().onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),this.getGraphicService().onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t,e=!0){const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return this.getGraphicService().onRemove(t),t.stage=null,this.addUpdateBoundTag(),e}removeAllChild(t=!1){this.forEachChildren((e=>{this.getGraphicService().onRemove(e),t&&e.isContainer&&e.removeAllChild(t)})),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),this.getGraphicService().onSetStage(this,t),this.forEachChildren((e=>{e.setStage(t,this.layer)})))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const t=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(t.a,t.b,t.c,t.d,t.e,t.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&yi.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find((e=>e.name===t),e)}createOrUpdateChild(t,e,i){let r=this._getChildByName(t);return r?r.setAttributes(e):(r=D.graphicService.creator[i](e),r.name=t,this.add(r)),r}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren((e=>{e.release(t)})),super.release()}};function ol(t){return new rl(t)}rl.NOWORK_ANIMATE_ATTR=tl;class nl extends rl{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(t,e,i,r){var o;super({}),this.stage=t,this.global=e,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:null!==(o=r.zIndex)&&void 0!==o?o:0}),this.layer=this,this.subLayers=new Map,this.theme=new rn,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(t=!0){const e=Array.from(this.subLayers.values()).sort(((t,e)=>t.zIndex-e.zIndex));this.layerHandler.merge(e.map((e=>(e.layer.subLayers.size&&e.layer.combineSubLayer(t),e.layer.getNativeHandler())))),t&&e.forEach((t=>{t.group&&(t.group.incremental=0)})),e.forEach((t=>{D.layerService.releaseLayer(this.stage,t.layer)})),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("暂不支持")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach((i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)}))}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:null!==(i=t.background)&&void 0!==i?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach((t=>t(this))),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach((t=>{D.layerService.releaseLayer(this.stage,t.layer)}))}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:null!==(i=e.background)&&void 0!==i?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach((t=>t(this)))}}const sl=Symbol.for("TransformUtil"),al=Symbol.for("GraphicUtil"),ll=Symbol.for("LayerService"),hl=Symbol.for("StaticLayerHandlerContribution"),cl=Symbol.for("DynamicLayerHandlerContribution"),dl=Symbol.for("VirtualLayerHandlerContribution");var ul,gl=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},pl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let fl=ul=class{static GenerateLayerId(){return`${ul.idprefix}_${ul.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=D.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(t){return this.layerMap.get(t)}getRecommendedLayerType(t){return t||(0!==this.staticLayerCountInEnv?"static":0!==this.dynamicLayerCountInEnv?"dynamic":"virtual")}getLayerHandler(t){let e;return e="static"===t?so.get(hl):"dynamic"===t?so.get(cl):so.get(dl),e}createLayer(t,e={main:!1}){var i;this.tryInit();let r=this.getRecommendedLayerType(e.layerMode);r=e.main||e.canvasId?"static":r;const o=this.getLayerHandler(r),n=new nl(t,this.global,t.window,Object.assign(Object.assign({main:!1},e),{layerMode:r,canvasId:null!==(i=e.canvasId)&&void 0!==i?i:ul.GenerateLayerId(),layerHandler:o})),s=this.layerMap.get(t)||[];return s.push(n),this.layerMap.set(t,s),this.staticLayerCountInEnv--,n}prepareStageLayer(t){let e;t.forEachChildren((t=>{const i=t.getNativeHandler();"virtual"===i.type?(i.mainHandler=e,e.secondaryHandlers.push(i)):(e=i,e.secondaryHandlers=[])}))}releaseLayer(t,e){e.release();const i=this.layerMap.get(t)||[];this.layerMap.set(t,i.filter((t=>t!==e)))}layerCount(t){return(this.layerMap.get(t)||[]).length}restLayerCount(t){return"browser"===this.global.env?10:0}releaseStage(t){this.layerMap.delete(t)}};fl.idprefix="visactor_layer",fl.prefix_count=0,fl=ul=gl([f(),pl("design:paramtypes",[])],fl);var ml=new i((t=>{t(O).to($).inSingletonScope(),t(Go).to(Vo),t(al).to(Xo).inSingletonScope(),t(sl).to(Zo).inSingletonScope(),t(ll).to(fl).inSingletonScope()}));function bl(t,e){return!(!t&&!e)}function yl(t,e){let i;return i=ut(t)?t.some((t=>t||void 0===t)):!!t,i&&e>0}function Cl(t,e,i){return i&&t*e>0}function wl(t,e,i,r,o){return o&&t*e>0&&0!==i&&0!==r}function vl(t,e){return t*e>0}function xl(t,e,i,r){return t*e>0&&0!==i&&0!==r}function _l(t,e,i,r,o,n,s){const a=t-i,l=e-r,h=(s?n:-n)/Math.sqrt(a*a+l*l),c=h*l,d=-h*a,u=t+c,g=e+d,p=i+c,f=r+d,m=(u+p)/2,b=(g+f)/2,y=p-u,C=f-g,w=y*y+C*C,v=o-n,x=u*f-p*g,_=(C<0?-1:1)*Math.sqrt(Math.max(0,v*v*w-x*x));let S=(x*C-y*_)/w,A=(-x*y-C*_)/w;const T=(x*C+y*_)/w,R=(-x*y+C*_)/w,B=S-m,M=A-b,P=T-m,H=R-b;return B*B+M*M>P*P+H*H&&(S=T,A=R),{cx:S,cy:A,x01:-c,y01:-d,x11:S*(o/v-1),y11:A*(o/v-1)}}function Sl(t,e,i,r,o){const n=he(i-e),s=t.getParsedCornerRadius(),a=ut(s),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:c,outerEndAngle:d,innerEndAngle:u,innerStartAngle:g}=t.getParsePadAngle(e,i),p=a?s[0]:s,f=a?s[1]:s,m=a?s[2]:s,b=a?s[3]:s,y=Math.max(f,p),C=Math.max(m,b);let w=y,v=C;const x=o*de(c),_=o*pe(c),S=r*de(u),A=r*pe(u);let T,R,B,M;if((C>oe||y>oe)&&(T=o*de(d),R=o*pe(d),B=r*de(g),M=r*pe(g),n<ne)){const t=function(t,e,i,r,o,n,s,a){const l=i-t,h=r-e,c=s-o,d=a-n;let u=d*l-c*h;return u*u<oe?[]:(u=(c*(e-n)-d*(t-o))/u,[t+u*l,e+u*h])}(x,_,B,M,T,R,S,A);if(t){const e=x-t[0],i=_-t[1],n=T-t[0],s=R-t[1],a=1/pe(((P=(e*n+i*s)/(fe(e*e+i*i)*fe(n*n+s*s)))>1?0:P<-1?ne:Math.acos(P))/2),l=fe(t[0]*t[0]+t[1]*t[1]);v=ge(C,(r-l)/(a-1)),w=ge(y,(o-l)/(a+1))}}var P;return{outerDeltaAngle:l,xors:x,yors:_,xirs:B,yirs:M,xore:T,yore:R,xire:S,yire:A,limitedOcr:w,limitedIcr:v,outerCornerRadiusStart:p,outerCornerRadiusEnd:f,maxOuterCornerRadius:y,maxInnerCornerRadius:C,outerStartAngle:c,outerEndAngle:d,innerDeltaAngle:h,innerEndAngle:u,innerStartAngle:g,innerCornerRadiusStart:b,innerCornerRadiusEnd:m}}function Al(t,e,i,r,o,n,s){const{startAngle:a,endAngle:l}=t.getParsedAngle(),h=he(l-a),c=l>a;let d=!1;if(o<n){const t=o;o=n,n=t}if(o<=oe)e.moveTo(i,r);else if(h>=le-oe)e.moveTo(i+o*de(a),r+o*pe(a)),e.arc(i,r,o,a,l,!c),n>oe&&(e.moveTo(i+n*de(l),r+n*pe(l)),e.arc(i,r,n,l,a,c));else{const{outerDeltaAngle:h,xors:u,yors:g,xirs:p,yirs:f,limitedOcr:m,outerCornerRadiusStart:b,outerCornerRadiusEnd:y,maxOuterCornerRadius:C,xore:w,yore:v,xire:x,yire:_,outerStartAngle:S,outerEndAngle:A,limitedIcr:T,innerDeltaAngle:R,innerEndAngle:B,innerStartAngle:M,innerCornerRadiusStart:P,innerCornerRadiusEnd:H,maxInnerCornerRadius:k}=Sl(t,a,l,n,o);if(h<.001)s&&(s[3]||s[1])&&e.moveTo(i+u,r+g),d=!0;else if(m>oe){const t=ge(b,m),n=ge(y,m),a=_l(p,f,u,g,o,t,Number(c)),l=_l(w,v,x,_,o,n,Number(c));m<C&&t===n?!s||s[0]?(e.moveTo(i+a.cx+a.x01,r+a.cy+a.y01),e.arc(i+a.cx,r+a.cy,m,ce(a.y01,a.x01),ce(l.y01,l.x01),!c)):e.moveTo(i+a.cx+m*de(ce(l.y01,l.x01)),r+a.cy+m*pe(ce(l.y01,l.x01))):!s||s[0]?(e.moveTo(i+a.cx+a.x01,r+a.cy+a.y01),t>0&&e.arc(i+a.cx,r+a.cy,t,ce(a.y01,a.x01),ce(a.y11,a.x11),!c),e.arc(i,r,o,ce(a.cy+a.y11,a.cx+a.x11),ce(l.cy+l.y11,l.cx+l.x11),!c),n>0&&e.arc(i+l.cx,r+l.cy,n,ce(l.y11,l.x11),ce(l.y01,l.x01),!c)):n>0?e.moveTo(i+l.cx+n*de(ce(l.y01,l.x01)),r+l.cy+n*pe(ce(l.y01,l.x01))):e.moveTo(i+w,r+o*pe(A))}else!s||s[0]?(e.moveTo(i+u,r+g),e.arc(i,r,o,S,A,!c)):e.moveTo(i+o*de(A),r+o*pe(A));if(!(n>oe)||R<.001)!s||s[1]?e.lineTo(i+x,r+_):e.moveTo(i+x,r+_),d=!0;else if(T>oe){const t=ge(P,T),o=ge(H,T),a=_l(x,_,w,v,n,-o,Number(c)),l=_l(u,g,p,f,n,-t,Number(c));if(!s||s[1]?e.lineTo(i+a.cx+a.x01,r+a.cy+a.y01):e.moveTo(i+a.cx+a.x01,r+a.cy+a.y01),T<k&&t===o){const t=ce(l.y01,l.x01);!s||s[2]?e.arc(i+a.cx,r+a.cy,T,ce(a.y01,a.x01),t,!c):e.moveTo(i+a.cx+de(t),r+a.cy+pe(t))}else!s||s[2]?(o>0&&e.arc(i+a.cx,r+a.cy,o,ce(a.y01,a.x01),ce(a.y11,a.x11),!c),e.arc(i,r,n,ce(a.cy+a.y11,a.cx+a.x11),ce(l.cy+l.y11,l.cx+l.x11),c),t>0&&e.arc(i+l.cx,r+l.cy,t,ce(l.y11,l.x11),ce(l.y01,l.x01),!c)):t>0?e.moveTo(i+l.cx+t*de(ce(l.y01,l.x01)),r+l.cy+t*pe(ce(l.y01,l.x01))):e.moveTo(i+p,r+f)}else!s||s[1]?e.lineTo(i+x,r+_):e.moveTo(i+x,r+_),!s||s[2]?e.arc(i,r,n,B,M,c):e.moveTo(i+n*de(M),r+n*pe(M))}return s?s[3]&&e.lineTo(i+o*de(a),r+o*pe(a)):e.closePath(),d}const Tl=Symbol.for("ArcRenderContribution"),Rl=Symbol.for("AreaRenderContribution"),Bl=Symbol.for("CircleRenderContribution"),Ml=Symbol.for("GroupRenderContribution"),Pl=Symbol.for("ImageRenderContribution"),Hl=Symbol.for("PathRenderContribution"),kl=Symbol.for("PolygonRenderContribution"),El=Symbol.for("RectRenderContribution"),Fl=Symbol.for("SymbolRenderContribution"),Ll=Symbol.for("TextRenderContribution"),Il=Symbol.for("InteractiveSubRenderContribution");function zl(t,e){return"end"===t||"right"===t?-e:"center"===t?-e/2:0}function Ol(t,e,i,r=0){return"middle"===t?-e/2:"top"===t?0:"bottom"===t?r-e:t&&"alphabetic"!==t?0:(i||(i=e),-(e-i)/2-.79*i)}var Dl=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Wl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Nl=function(t,e){return function(i,r){e(i,r,t)}};function Gl(t,e,i){var r;const{x:o=i.x,y:n=i.y,z:s=i.z,dx:a=i.dx,dy:l=i.dy,dz:h=i.dz,scaleX:c=i.scaleX,scaleY:d=i.scaleY,scaleZ:u=i.scaleZ,alpha:g=i.alpha,beta:p=i.beta,angle:f=i.angle,anchor3d:m=e.attribute.anchor,anchor:b}=e.attribute,y=[0,0,0];if(m){if("string"==typeof m[0]){const t=parseFloat(m[0])/100,i=e.AABBBounds;y[0]=i.x1+(i.x2-i.x1)*t}else y[0]=m[0];if("string"==typeof m[1]){const t=parseFloat(m[1])/100,i=e.AABBBounds;y[1]=i.x1+(i.x2-i.x1)*t}else y[1]=m[1];y[2]=null!==(r=m[2])&&void 0!==r?r:0}if(wa(t),va(t,t,[o+a,n+l,s+h]),va(t,t,[y[0],y[1],y[2]]),function(t,e,i){const r=Math.sin(i),o=Math.cos(i),n=e[4],s=e[5],a=e[6],l=e[7],h=e[8],c=e[9],d=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*o+h*r,t[5]=s*o+c*r,t[6]=a*o+d*r,t[7]=l*o+u*r,t[8]=h*o-n*r,t[9]=c*o-s*r,t[10]=d*o-a*r,t[11]=u*o-l*r}(t,t,p),function(t,e,i){const r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[8],c=e[9],d=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o-h*r,t[1]=s*o-c*r,t[2]=a*o-d*r,t[3]=l*o-u*r,t[8]=n*r+h*o,t[9]=s*r+c*o,t[10]=a*r+d*o,t[11]=l*r+u*o}(t,t,g),va(t,t,[-y[0],-y[1],y[2]]),function(t,e,i){const r=i[0],o=i[1],n=i[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(t,t,[c,d,u]),f){const i=Ra.allocate(),r=[0,0];if(b){if("string"==typeof m[0]){const t=parseFloat(m[0])/100,i=e.AABBBounds;r[0]=i.x1+(i.x2-i.x1)*t}else r[0]=m[0];if("string"==typeof m[1]){const t=parseFloat(m[1])/100,i=e.AABBBounds;r[1]=i.x1+(i.x2-i.x1)*t}else r[1]=m[1]}va(i,i,[r[0],r[1],0]),function(t,e,i){const r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[4],c=e[5],d=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o+h*r,t[1]=s*o+c*r,t[2]=a*o+d*r,t[3]=l*o+u*r,t[4]=h*o-n*r,t[5]=c*o-s*r,t[6]=d*o-a*r,t[7]=u*o-l*r}(i,i,f),va(i,i,[-r[0],-r[1],0]),_a(t,t,i)}}let jl=class{constructor(t){this.creator=t,this.hooks={onAttributeUpdate:new I(["graphic"]),onSetStage:new I(["graphic","stage"]),onRemove:new I(["graphic"]),onRelease:new I(["graphic"]),onAddIncremental:new I(["graphic","group","stage"]),onClearIncremental:new I(["graphic","group","stage"]),beforeUpdateAABBBounds:new I(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new I(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new I(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new Ge,this.tempAABBBounds2=new Ge}onAttributeUpdate(t){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(t)}onSetStage(t,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(t,e)}onRemove(t){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(t)}onRelease(t){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(t)}onAddIncremental(t,e,i){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(t,e,i)}onClearIncremental(t,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(t,e)}beforeUpdateAABBBounds(t,e,i,r){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(t,e,i,r)}afterUpdateAABBBounds(t,e,i,r,o){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(t,e,i,r,o)}clearAABBBounds(t,e,i){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(t,e,i)}updatePathProxyAABBBounds(t,e){const i="function"==typeof e.pathProxy?e.pathProxy(e.attribute):e.pathProxy;if(!i)return!1;const r=new ai(t);return Ri(i.commandList,r,0,0),!0}updateHTMLTextAABBBounds(t,e,i,r){const{textAlign:o,textBaseline:n}=t;if(null!=t.forceBoundsHeight){const e=ft(t.forceBoundsHeight)?t.forceBoundsHeight:t.forceBoundsHeight(),r=Ol(n,e,e);i.set(i.x1,r,i.x2,r+e)}if(null!=t.forceBoundsWidth){const e=ft(t.forceBoundsWidth)?t.forceBoundsWidth:t.forceBoundsWidth(),r=zl(o,e);i.set(r,i.y1,r+e,i.y2)}}combindShadowAABBBounds(t,e){if(e&&e.shadowRoot){const i=e.shadowRoot.AABBBounds;t.union(i)}}transformAABBBounds(t,e,i,r,o){if(!e.empty()){const{scaleX:o=i.scaleX,scaleY:n=i.scaleY,stroke:s=i.stroke,shadowBlur:a=i.shadowBlur,lineWidth:l=i.lineWidth,pickStrokeBuffer:h=i.pickStrokeBuffer,strokeBoundsBuffer:c=i.strokeBoundsBuffer}=t,d=this.tempAABBBounds1,u=this.tempAABBBounds2;if(s&&l){Ys(d,(l+h)/Math.abs(o+n),r,c),e.union(d),d.setValue(u.x1,u.y1,u.x2,u.y2)}if(a){const{shadowOffsetX:r=i.shadowOffsetX,shadowOffsetY:s=i.shadowOffsetY}=t;Ys(d,a/Math.abs(o+n)*2,!1,c+1),d.translate(r,s),e.union(d)}}if(this.combindShadowAABBBounds(e,o),e.empty())return;let n=!0;const s=o.transMatrix;o&&o.isContainer&&(n=!(1===s.a&&0===s.b&&0===s.c&&1===s.d&&0===s.e&&0===s.f)),n&&We(e,e,s)}validCheck(t,e,i,r){if(!r)return!0;if(null!=t.forceBoundsHeight||null!=t.forceBoundsWidth)return!0;if(r.shadowRoot||r.isContainer)return!0;const{visible:o=e.visible}=t;return!(!r.valid||!o)||(i.empty()||(r.parent&&i.transformWithMatrix(r.parent.globalTransMatrix),this.clearAABBBounds(r,r.stage,i),i.clear()),!1)}updateTempAABBBounds(t){const e=this.tempAABBBounds1,i=this.tempAABBBounds2;return e.setValue(t.x1,t.y1,t.x2,t.y2),i.setValue(t.x1,t.y1,t.x2,t.y2),{tb1:e,tb2:i}}};jl=Dl([f(),Nl(0,g(ma)),Wl("design:paramtypes",[Object])],jl);const Vl=(t,e,i)=>{const{outerBorder:r,shadowBlur:o=e.shadowBlur}=t;if(r){const t=e.outerBorder,{distance:n=t.distance,lineWidth:s=t.lineWidth}=r;i.expand(n+(o+s)/2)}return i},Ul=["radius","startAngle","endAngle",...Ya];let Kl=class t extends el{constructor(t={radius:1}){super(t),this.type="circle",this.numberType=na}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return nn(this).circle}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:n}=D.graphicService.updateTempAABBBounds(i);return Vl(t,e,o),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,D.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){const{radius:r=e.radius}=t;return i.set(-r,-r,r,r),i}updateCircleAABBBoundsAccurate(t,e,i){const{startAngle:r=e.startAngle,endAngle:o=e.endAngle,radius:n=e.radius}=t;return o-r>le-oe?i.set(-n,-n,n,n):Tn(r,o,n,i),i}needUpdateTags(t){return super.needUpdateTags(t,Ul)}needUpdateTag(t){return super.needUpdateTag(t,Ul)}toCustomPath(){var t,e,i;let r=super.toCustomPath();if(r)return r;const o=this.attribute,n=null!==(t=o.radius)&&void 0!==t?t:this.getDefaultAttribute("radius"),s=null!==(e=o.startAngle)&&void 0!==e?e:this.getDefaultAttribute("startAngle"),a=null!==(i=o.endAngle)&&void 0!==i?i:this.getDefaultAttribute("endAngle");return r=new pr,r.arc(0,0,n,s,a),r}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function $l(t){return new Kl(t)}Kl.NOWORK_ANIMATE_ATTR=tl;class Xl{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,r){if(t.xOffset="left"===e||"start"===e?0:"center"===e?t.width/-2:"right"===e||"end"===e?-t.width:0,"top"===i)t.yOffset=0;else if("middle"===i)t.yOffset=t.height/-2;else if("alphabetic"===i){let e=.79;if(1===r.length){const t=r[0];e=t.ascent/(t.ascent+t.descent)}t.yOffset=t.height*-e}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,r,o="",n,s){const{lineWidth:a,suffixPosition:l="end",measureMode:h=X.actualBounding,keepCenterInLine:c=!1}=null!=s?s:{};t=t.map((t=>t.toString()));const d=[],u=[0,0];if("number"==typeof a&&a!==1/0){let e;for(let i=0,r=t.length;i<r;i++){const r=this.textMeasure.measureTextPixelADscentAndWidth(t[i],this.textOptions,h);let s=t[i].toString();if(r.width>a){const r=this.textMeasure.clipTextWithSuffix(t[i],this.textOptions,a,o,n,l);s=r.str,e=r.width}else e=r.width;d.push({str:s,width:e,ascent:r.ascent,descent:r.descent,keepCenterInLine:c})}u[0]=a}else{let e,i,r=0;for(let o=0,n=t.length;o<n;o++){i=t[o];const n=this.textMeasure.measureTextPixelADscentAndWidth(t[o],this.textOptions,h);e=n.width,r=Math.max(r,e),d.push({str:i,width:e,ascent:n.ascent,descent:n.descent,keepCenterInLine:c})}u[0]=r}u[1]=d.length*r,u[0]=d.reduce(((t,e)=>Math.max(t,e.width)),0);const g={xOffset:0,yOffset:0,width:u[0],height:u[1]};return this.LayoutBBox(g,e,i,d),this.layoutWithBBox(g,d,e,i,r)}layoutWithBBox(t,e,i,r,o){const n=[0,0],s=e.length*o;"top"===r||("middle"===r?n[1]=(t.height-s)/2:"bottom"===r&&(n[1]=t.height-s));for(let s=0;s<e.length;s++)this.lineOffset(t,e[s],i,r,o,n);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:o,textAlign:i,textBaseline:r}}lineOffset(t,e,i,r,o,n){if("left"===i||"start"===i?e.leftOffset=0:"center"===i?e.leftOffset=(t.width-e.width)/2:"right"!==i&&"end"!==i||(e.leftOffset=t.width-e.width),e.topOffset=o/2+(e.ascent-e.descent)/2+n[1],!e.keepCenterInLine){const t=0,i=e.ascent+e.descent+t;if(i<o-t&&("bottom"===r?e.topOffset+=(o-i)/2:"top"===r&&(e.topOffset-=(o-i)/2)),"alphabetic"===r){const t=o/(e.ascent+e.descent);e.topOffset=o/2+(e.ascent-e.descent)/2*t+n[1]}}return n[1]+=o,e}}const Yl=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...Ya];let ql=class t extends el{get font(){const t=this.getGraphicTheme();return this._font||(this._font=Ie(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),r=this.getMaxWidth(i);return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):(null!==(t=e.text)&&void 0!==t?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),r=this.attribute,o=this.getMaxWidth(i);if(!Number.isFinite(o))return!1;const{text:n}=this.attribute;if(this.tryUpdateAABBBounds(),null===(e=null===(t=this.cache)||void 0===t?void 0:t.layoutData)||void 0===e?void 0:e.lines){let t="";return this.cache.layoutData.lines.forEach((e=>{t+=e.str})),(Array.isArray(n)?n.join(""):n)!==t}return"vertical"===r.direction&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map((t=>t.text)).join("")!==r.text.toString():null!=this.clipedText&&this.clipedText!==r.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||"normal"===this.attribute.whiteSpace}constructor(t={text:"",fontSize:16}){super(t),this.type="text",this.numberType=pa,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return ut(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}getGraphicTheme(){return nn(this).text}doUpdateOBBBounds(){const e=this.getGraphicTheme();this._OBBBounds.clear();const i=this.attribute,{angle:r=e.angle}=i;if(!r){const t=this.AABBBounds;return this._OBBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._OBBBounds}this.obbText||(this.obbText=new t({})),this.obbText.setAttributes(Object.assign(Object.assign({},i),{angle:0}));const o=this.obbText.AABBBounds,{x:n,y:s}=i,a={x:(o.x1+o.x2)/2,y:(o.y1+o.y2)/2},l=Pe(a,r,{x:n,y:s});return this._OBBBounds.copy(o),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=r,this._OBBBounds}updateAABBBounds(t,e,i){const{text:r=e.text}=this.attribute;Array.isArray(r)?this.updateMultilineAABBBounds(r):this.updateSingallineAABBBounds(r);const{tb1:o}=D.graphicService.updateTempAABBBounds(i),{scaleX:n=e.scaleX,scaleY:s=e.scaleY,shadowBlur:a=e.shadowBlur,strokeBoundsBuffer:l=e.strokeBoundsBuffer}=t;if(a){Ys(o,a/Math.abs(n+s),!0,l),i.union(o)}return D.graphicService.combindShadowAABBBounds(i,this),null==t.forceBoundsHeight&&null==t.forceBoundsWidth||D.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,We(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const t=e.lines[0];this.cache.clipedText=t.str,this.cache.clipedWidth=t.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,o="horizontal"===i?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return"horizontal"===i&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;const i=this.getGraphicTheme(),r=this.attribute,{fontFamily:o=i.fontFamily,textAlign:n=i.textAlign,textBaseline:s=i.textBaseline,fontSize:a=i.fontSize,fontWeight:l=i.fontWeight,ellipsis:h=i.ellipsis,maxLineWidth:c,stroke:d=i.stroke,wrap:u=i.wrap,measureMode:g=i.measureMode,lineWidth:p=i.lineWidth,whiteSpace:f=i.whiteSpace,suffixPosition:m=i.suffixPosition,ignoreBuf:b=i.ignoreBuf,keepCenterInLine:y=i.keepCenterInLine}=r,C=b?0:this.guessLineHeightBuf(a),w=this.getLineHeight(r,i,C);if("normal"===f||u)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(null===(e=this.cache)||void 0===e?void 0:e.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),d&&this._AABBBounds.expand(p/2),this._AABBBounds}const v=D.graphicUtil.textMeasure,x=new Xl(o,{fontSize:a,fontWeight:l,fontFamily:o,lineHeight:w},v).GetLayoutByLines(t,n,s,w,!0===h?i.ellipsis:h||void 0,!1,{lineWidth:c,suffixPosition:m,measureMode:g,keepCenterInLine:y}),{bbox:_}=x;return this.cache.layoutData=x,this.clearUpdateShapeTag(),this._AABBBounds.set(_.xOffset,_.yOffset,_.xOffset+_.width,_.yOffset+_.height),d&&this._AABBBounds.expand(p/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,r;const o=this.getGraphicTheme(),{fontFamily:n=o.fontFamily,textAlign:s=o.textAlign,textBaseline:a=o.textBaseline,fontSize:l=o.fontSize,ellipsis:h=o.ellipsis,maxLineWidth:c,stroke:d=o.stroke,lineWidth:u=o.lineWidth,wordBreak:g=o.wordBreak,fontWeight:p=o.fontWeight,ignoreBuf:f=o.ignoreBuf,measureMode:m=o.measureMode,suffixPosition:b=o.suffixPosition,heightLimit:y=0,lineClamp:C,keepCenterInLine:w=o.keepCenterInLine}=this.attribute,v=f?0:this.guessLineHeightBuf(l),x=this.getLineHeight(this.attribute,o,v);if(!this.shouldUpdateShape()&&(null===(e=this.cache)||void 0===e?void 0:e.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),d&&this._AABBBounds.expand(u/2),this._AABBBounds}const _=D.graphicUtil.textMeasure,S={fontSize:l,fontWeight:p,fontFamily:n,lineHeight:x},A=new Xl(n,S,_),T=ut(t)?t.map((t=>t.toString())):[t.toString()],R=[],B=[0,0];let M=1/0;if(y>0&&(M=Math.max(Math.floor(y/x),1)),C&&(M=Math.min(M,C)),"number"==typeof c&&c!==1/0){if(c>0)for(let t=0;t<T.length;t++){const e=T[t];let o=!0;if(t===M-1){const i=_.clipTextWithSuffix(e,S,c,h,!1,b,t!==T.length-1),r=_.measureTextPixelADscentAndWidth(i.str,S,m);R.push({str:i.str,width:i.width,ascent:r.ascent,descent:r.descent,keepCenterInLine:w});break}const n=_.clipText(e,S,c,"break-all"!==g,"keep-all"===g);if(""!==e&&""===n.str||n.wordBreaked){if(h){const t=_.clipTextWithSuffix(e,S,c,h,!1,b);n.str=null!==(i=t.str)&&void 0!==i?i:"",n.width=null!==(r=t.width)&&void 0!==r?r:0}else n.str="",n.width=0;o=!1}const s=_.measureTextPixelADscentAndWidth(n.str,S,m);R.push({str:n.str,width:n.width,ascent:s.ascent,descent:s.descent,keepCenterInLine:w});let a=n.str.length;if(!n.wordBreaked||""!==e&&""===n.str||(o=!0,a=n.wordBreaked),n.str.length===e.length);else if(o){let i=e.substring(a);"keep-all"===g&&(i=i.replace(/^\s+/g,"")),T.splice(t+1,0,i)}}let t=0;R.forEach((e=>{t=Math.max(t,e.width)})),B[0]=t}else{let t,e,i=0;for(let r=0,o=T.length;r<o;r++){if(r===M-1){const t=_.clipTextWithSuffix(T[r],S,c,h,!1,b),e=_.measureTextPixelADscentAndWidth(t.str,S,m);R.push({str:t.str,width:t.width,ascent:e.ascent,descent:e.descent,keepCenterInLine:w}),i=Math.max(i,t.width);break}e=T[r],t=_.measureTextWidth(e,S),i=Math.max(i,t);const o=_.measureTextPixelADscentAndWidth(e,S,m);R.push({str:e,width:t,ascent:o.ascent,descent:o.descent,keepCenterInLine:w})}B[0]=i}B[1]=R.length*x;const P={xOffset:0,yOffset:0,width:B[0],height:B[1]};A.LayoutBBox(P,s,a,R);const H=A.layoutWithBBox(P,R,s,a,x);return this.cache.layoutData=H,this.clearUpdateShapeTag(),this._AABBBounds.set(P.xOffset,P.yOffset,P.xOffset+P.width,P.yOffset+P.height),d&&this._AABBBounds.expand(u/2),this._AABBBounds}updateVerticalMultilineAABBBounds(e){var i,r;const o=this.getGraphicTheme(),n=D.graphicUtil.textMeasure;let s;const a=this.attribute,{maxLineWidth:l=o.maxLineWidth,ellipsis:h=o.ellipsis,fontFamily:c=o.fontFamily,fontSize:d=o.fontSize,fontWeight:u=o.fontWeight,stroke:g=o.stroke,lineWidth:p=o.lineWidth,verticalMode:f=o.verticalMode,suffixPosition:m=o.suffixPosition}=a,b=this.getLineHeight(a,o,0);let{textAlign:y=o.textAlign,textBaseline:C=o.textBaseline}=a;if(!f){const e=y;y=null!==(i=t.baselineMapAlign[C])&&void 0!==i?i:"left",C=null!==(r=t.alignMapBaseline[e])&&void 0!==r?r:"top"}if(s=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);s=ue(e,s)}));const t=zl(y,s),e=this.cache.verticalList.length*b,i=Ol(C,e,d);return this._AABBBounds.set(i,t,i+e,t+s),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const w=e.map((t=>function(t){const e=[];let i=0,r="";for(let o=0;o<t.length;o++)ea(t[o])?i?r+=t[o]:(i=1,r=t[o]):(i&&(e.push({text:r,direction:Js.VERTICAL}),r="",i=0),e.push({text:t[o],direction:Js.HORIZONTAL}));return r&&e.push({text:r,direction:Js.VERTICAL}),e}(t.toString())));w.forEach(((t,e)=>{if(Number.isFinite(l))if(h){const i=!0===h?o.ellipsis:h,r=n.clipTextWithSuffixVertical(t,{fontSize:d,fontWeight:u,fontFamily:c},l,i,!1,m);w[e]=r.verticalList,s=r.width}else{const i=n.clipTextVertical(t,{fontSize:d,fontWeight:u,fontFamily:c},l,!1);w[e]=i.verticalList,s=i.width}else s=0,t.forEach((t=>{const e=t.direction===Js.HORIZONTAL?d:n.measureTextWidth(t.text,{fontSize:d,fontWeight:u,fontFamily:c});s+=e,t.width=e}))})),this.cache.verticalList=w,this.clearUpdateShapeTag(),this.cache.verticalList.forEach((t=>{const e=t.reduce(((t,e)=>t+e.width),0);s=ue(e,s)}));const v=zl(y,s),x=this.cache.verticalList.length*b,_=Ol(C,x,d);return this._AABBBounds.set(_,v,_+x,v+s),g&&this._AABBBounds.expand(p/2),this._AABBBounds}getMaxWidth(t){var e,i;const r=this.attribute;return null!==(i=null!==(e=r.maxLineWidth)&&void 0!==e?e:r.maxWidth)&&void 0!==i?i:t.maxWidth}getLineHeight(t,e,i){var r;return null!==(r=kn(t.lineHeight,t.fontSize||e.fontSize))&&void 0!==r?r:(t.fontSize||e.fontSize)+i}needUpdateTags(t,e=Yl){return super.needUpdateTags(t,e)}needUpdateTag(t,e=Yl){return super.needUpdateTag(t,e)}_interpolate(t,e,i,r,o){"text"===t&&(o.text=r)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return t.baselineMapAlign}getAlignMapBaseline(){return t.alignMapBaseline}};function Zl(t){return new ql(t)}ql.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},tl),ql.baselineMapAlign={top:"left",bottom:"right",middle:"center"},ql.alignMapBaseline={left:"top",right:"bottom",center:"middle"};const Jl=["heightLimit","lineClamp"];class Ql extends ql{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return ut(t)?!t.every((t=>null==t||""===t)):null!=t&&""!==t}updateMultilineAABBBounds(t){var e,i,r,o;const n=this.getGraphicTheme(),{fontFamily:s=n.fontFamily,textAlign:a=n.textAlign,textBaseline:l=n.textBaseline,fontSize:h=n.fontSize,ellipsis:c=n.ellipsis,maxLineWidth:d,stroke:u=n.stroke,lineWidth:g=n.lineWidth,wordBreak:p=n.wordBreak,fontWeight:f=n.fontWeight,ignoreBuf:m=n.ignoreBuf,heightLimit:b=0,suffixPosition:y=n.suffixPosition,lineClamp:C}=this.attribute,w=null!==(e=kn(this.attribute.lineHeight,this.attribute.fontSize||n.fontSize))&&void 0!==e?e:this.attribute.fontSize||n.fontSize,v=m?0:2;if(!this.shouldUpdateShape()&&(null===(i=this.cache)||void 0===i?void 0:i.layoutData)){const t=this.cache.layoutData.bbox;return this._AABBBounds.set(t.xOffset,t.yOffset,t.xOffset+t.width,t.yOffset+t.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=D.graphicUtil.textMeasure,_=new Xl(s,{fontSize:h,fontWeight:f,fontFamily:s},x),S=t.map((t=>t.toString())),A=[],T=[0,0];let R=1/0;if(b>0&&(R=Math.max(Math.floor(b/w),1)),C&&(R=Math.min(R,C)),"number"==typeof d&&d!==1/0){if(d>0)for(let t=0;t<S.length;t++){const e=S[t];let i=!0;if(t===R-1){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,d,c,!1,y);A.push({str:t.str,width:t.width,ascent:0,descent:0,keepCenterInLine:!1});break}const n=_.textMeasure.clipText(e,_.textOptions,d,"break-word"===p);if(""!==e&&""===n.str){if(c){const t=_.textMeasure.clipTextWithSuffix(e,_.textOptions,d,c,!1,y);n.str=null!==(r=t.str)&&void 0!==r?r:"",n.width=null!==(o=t.width)&&void 0!==o?o:0}else n.str="",n.width=0;i=!1}if(A.push({str:n.str,width:n.width,ascent:0,descent:0,keepCenterInLine:!1}),n.str.length===e.length);else if(i){const i=e.substring(n.str.length);S.splice(t+1,0,i)}}let t=0;A.forEach((e=>{t=Math.max(t,e.width)})),T[0]=t}else{let t,e,i=0;for(let r=0,o=S.length;r<o;r++){if(r===R-1){const t=_.textMeasure.clipTextWithSuffix(S[r],_.textOptions,d,c,!1,y);A.push({str:t.str,width:t.width,ascent:0,descent:0,keepCenterInLine:!1}),i=Math.max(i,t.width);break}e=S[r],t=_.textMeasure.measureTextWidth(e,_.textOptions,"break-word"===p),i=Math.max(i,t),A.push({str:e,width:t,ascent:0,descent:0,keepCenterInLine:!1})}T[0]=i}T[1]=A.length*(w+v);const B={xOffset:0,yOffset:0,width:T[0],height:T[1]};_.LayoutBBox(B,a,l);const M=_.layoutWithBBox(B,A,a,l,w);return this.cache.layoutData=M,this.clearUpdateShapeTag(),this._AABBBounds.set(B.xOffset,B.yOffset,B.xOffset+B.width,B.yOffset+B.height),u&&this._AABBBounds.expand(g/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<Jl.length;e++){const i=Jl[e];if(-1!==t.indexOf(i))return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<Jl.length;e++)if(t===Jl[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return Ql.NOWORK_ANIMATE_ATTR}}function th(t){return new Ql(t)}const eh=["symbolType","size",...Ya];let ih=class t extends el{constructor(t={symbolType:"circle"}){super(t),this.type="symbol",this.numberType=ga}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(t=0,e=0,i=1){let r=null;try{r=new Path2D}catch(t){return null}const o=this.getParsedPath();if(!o)return null;o.draw(r,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return ut(t)?2===t.length&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return nn(this).symbol}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:n}=D.graphicService.updateTempAABBBounds(i);((t,e,i)=>{const{outerBorder:r,shadowBlur:o=e.shadowBlur,strokeBoundsBuffer:n=e.strokeBoundsBuffer}=t;if(r){const t=e.outerBorder,{distance:s=t.distance,lineWidth:a=t.lineWidth}=r;Ys(i,s+(o+a)/2,!0,n)}})(t,e,o),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,this.x1WithoutTransform=i.x1,this.y1WithoutTransform=i.y1;const{lineJoin:s=e.lineJoin}=t;return D.graphicService.transformAABBBounds(t,i,e,"miter"===s,this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:r=e.size}=t;if(ut(r))i.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{const t=r/2;i.set(-t,-t,t,t)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:r=e.size}=t;return this.getParsedPath().bounds(r,i),i}needUpdateTags(t){return super.needUpdateTags(t,eh)}needUpdateTag(t){return super.needUpdateTag(t,eh)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=ut(e)?e:[e,e];return t.path?(new pr).fromCustomPath2D(t.path,0,0,i[0],i[1]):(new pr).fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function rh(t){return new ih(t)}ih.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},tl);const oh=["segments","points","curveType","curveTension",...Ya];let nh=class t extends el{constructor(t={}){super(t),this.type="line",this.numberType=la}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?0!==e.length:!(!t||t.length<=1)}_interpolate(t,e,i,r,o){"points"===t&&(o.points=Bn(i,r,e))}getGraphicTheme(){return nn(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),D.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return D.graphicService.transformAABBBounds(t,i,e,"miter"===r,this),i}updateLineAABBBoundsByPoints(t,e,i,r){const{points:o=e.points,connectedType:n}=t,s=i;return o.forEach((t=>{!1===t.defined&&"connect"!==n||s.add(t.x,t.y)})),s}updateLineAABBBoundsBySegments(t,e,i,r){const{segments:o=e.segments,connectedType:n}=t,s=i;return o.forEach((t=>{t.points.forEach((t=>{!1===t.defined&&"connect"!==n||s.add(t.x,t.y)}))})),s}needUpdateTags(t){return super.needUpdateTags(t,oh)}needUpdateTag(t){return super.needUpdateTag(t,oh)}toCustomPath(){let t=super.toCustomPath();if(t)return t;const e=this.attribute;t=new pr;const i=e.segments,r=e=>{if(e&&e.length){let i=!0;e.forEach((e=>{!1!==e.defined&&(i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y),i=!1)}))}};return i&&i.length?i.forEach((t=>{r(t.points)})):e.points&&r(e.points),t}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function sh(t){return new nh(t)}nh.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},tl);const ah=["width","x1","y1","height","cornerRadius",...Ya];let lh=class t extends el{constructor(t){super(t),this.type="rect",this.numberType=da}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return nn(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:e,height:r}=t;const{x1:o,y1:n,x:s,y:a}=t;e=null!=e?e:o-s,r=null!=r?r:n-a,(isFinite(e)||isFinite(r)||isFinite(s)||isFinite(a))&&i.set(0,0,e||0,r||0)}const{tb1:r,tb2:o}=D.graphicService.updateTempAABBBounds(i);return Vl(t,e,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,D.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,ah)}needUpdateTag(t){return super.needUpdateTag(t,ah)}toCustomPath(){let t=super.toCustomPath();if(t)return t;const e=this.attribute,{x:i,y:r,width:o,height:n}=(t=>{if(!t)return{x:0,y:0,width:0,height:0};let e=nt(t.width)?t.x1-t.x:t.width,i=nt(t.height)?t.y1-t.y:t.height,r=0,o=0;return e<0?(r=e,e=-e):Number.isNaN(e)&&(e=0),i<0?(o=i,i=-i):Number.isNaN(i)&&(i=0),{x:r,y:o,width:e,height:i}})(e);return t=new pr,t.moveTo(i,r),t.rect(i,r,o,n),t}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function hh(t){return new lh(t)}lh.NOWORK_ANIMATE_ATTR=tl;class ch{constructor(t,e,i,r,o,n,s,a,l,h,c,d,u,g){this.left=t,this.top=e,this.width=i,this.height=r,this.actualHeight=0,this.bottom=e+r,this.right=t+i,this.ellipsis=o,this.wordBreak=n,this.verticalDirection=s,this.lines=[],this.globalAlign=a,this.globalBaseline=l,this.layoutDirection=h,this.directionKey=Vr[this.layoutDirection],this.isWidthMax=c,this.isHeightMax=d,this.singleLine=u,g?(g.clear(),this.icons=g):this.icons=new Map}draw(t,e){const{width:i,height:r}=this.getActualSize(),o=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let n=this.isHeightMax?Math.min(this.height,r):this.height||r||0;n=Math.min(n,r);let s=0;switch(this.globalBaseline){case"top":s=0;break;case"middle":s=-n/2;break;case"bottom":s=-n}let a=0;"right"===this.globalAlign||"end"===this.globalAlign?a=-o:"center"===this.globalAlign&&(a=-o/2);let l=this[this.directionKey.height];this.singleLine&&(l=this.lines[0].height+1);let h=!1;if("middle"===this.verticalDirection)if(this.actualHeight>=l&&0!==l)for(let i=0;i<this.lines.length;i++){const{top:r,height:o}=this.lines[i];if(r+o<this[this.directionKey.top]||r+o>this[this.directionKey.top]+l)return h;let n=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(n=!0,h=!0),this.lines[i].draw(t,n,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}else{const i=Math.floor((l-this.actualHeight)/2);"vertical"===this.layoutDirection?a+=i:s+=i;for(let i=0;i<this.lines.length;i++)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}else if("bottom"===this.verticalDirection&&"vertical"!==this.layoutDirection)for(let i=0;i<this.lines.length;i++){const{top:r,height:o}=this.lines[i],n=l-this.lines[i].top-this.lines[i].height;if(0===l)this.lines[i].draw(t,!1,a,n+s,this.ellipsis,e);else{if(n+o>this[this.directionKey.top]+l||n<this[this.directionKey.top])return h;{let r=!1;this.ellipsis&&this.lines[i+1]&&n-this.lines[i+1].height<this[this.directionKey.top]&&(r=!0,h=!0),this.lines[i].draw(t,r,a,n+s,this.ellipsis,e)}}}else{"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&this.singleLine&&this.isWidthMax&&(a+=this.lines[0].height+1);for(let i=0;i<this.lines.length;i++){"bottom"===this.verticalDirection&&"vertical"===this.layoutDirection&&(a-=this.lines[i].height+this.lines[i].top);const{top:r,height:o}=this.lines[i];if(0===l)this.lines[i].draw(t,!1,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e);else{if(r+o<this[this.directionKey.top]||r+o>this[this.directionKey.top]+l)return h;{let r=!1;this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+l&&(r=!0,h=!0),this.lines[i].draw(t,r,this.lines[i][this.directionKey.left]+a,this.lines[i][this.directionKey.top]+s,this.ellipsis,e)}}}}return h}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>t&&(t=r.actualWidth),e+=r.height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:r}=this.getRawActualSize();this.width,this.height;let o=this[this.directionKey.height];if(this.singleLine&&(o=this.lines[0].height+1),"middle"===this.verticalDirection)if(this.actualHeight>=o&&0!==o)for(let i=0;i<this.lines.length;i++){const{top:r,height:n}=this.lines[i];if(r+n<this[this.directionKey.top]||r+n>this[this.directionKey.top]+o);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+o){const r=!0===this.ellipsis?"...":this.ellipsis||"",o=this.lines[i].getWidthWithEllips(r);o>t&&(t=o),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else{Math.floor((o-this.actualHeight)/2);for(let i=0;i<this.lines.length;i++)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else if("bottom"===this.verticalDirection)for(let i=0;i<this.lines.length;i++){const{top:r,height:n}=this.lines[i],s=o-this.lines[i].top-this.lines[i].height;if(0===o)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(s+n>this[this.directionKey.top]+o||s<this[this.directionKey.top]);else if(this.ellipsis&&this.lines[i+1]&&s-this.lines[i+1].height<this[this.directionKey.top]){const r=!0===this.ellipsis?"...":this.ellipsis||"",o=this.lines[i].getWidthWithEllips(r);o>t&&(t=o),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}else for(let i=0;i<this.lines.length;i++){const{top:r,height:n}=this.lines[i];if(0===o)this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height;else if(r+n<this[this.directionKey.top]||r+n>this[this.directionKey.top]+o);else if(this.ellipsis&&this.lines[i+1]&&this.lines[i+1].top+this.lines[i+1].height>this[this.directionKey.top]+o){const r=!0===this.ellipsis?"...":this.ellipsis||"",o=this.lines[i].getWidthWithEllips(r);o>t&&(t=o),e+=this.lines[i].height}else this.lines[i].actualWidth>t&&(t=this.lines[i].actualWidth),e+=this.lines[i].height}return{width:"vertical"===this.layoutDirection?e:t,height:"vertical"===this.layoutDirection?t:e}}}function dh(t,e,i,r){const o=Math.round(t),n=Math.round(i),s=Math.round(e),a=Math.round(r);return{left:t>o?o:o-.5,top:i>n?n:n-.5,right:s>e?s:s+.5,bottom:a>r?a:a+.5}}class uh{constructor(t,e,i,r){var o,n;this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=r;const s=kn(i.lineHeight,this.fontSize);this.lineHeight="number"==typeof s?s>this.fontSize?s:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:a,height:l,descent:h,width:c}=to(t,i,this.ascentDescentMode);let d=0,u=0,g=0;this.height>l&&(d=(this.height-l)/2,u=Math.ceil(d),g=Math.floor(d)),"top"===this.textBaseline?(this.ascent=d,this.descent=l-d):"bottom"===this.textBaseline?(this.ascent=l-d,this.descent=d):"middle"===this.textBaseline?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=a+u,this.descent=h+g),this.length=t.length,this.width=c||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,this.space=i.space,this.dx=null!==(o=i.dx)&&void 0!==o?o:0,this.dy=null!==(n=i.dy)&&void 0!==n?n:0,"vertical"===i.direction&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=to(this.text,this.character,this.ascentDescentMode);this.width=t,"vertical"===this.direction&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,r,o,n,s){if(""===this.text||"\n"===this.text||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let a=e+i,l=this.text,h=this.left+r;a+=this.top;let c=this.direction;if(this.verticalEllipsis)l=this.ellipsisStr,c="vertical",a-=this.ellipsisWidth/2;else{if("hide"===this.ellipsis)return;if("add"===this.ellipsis)l+=this.ellipsisStr,"right"!==n&&"end"!==n||(h-=this.ellipsisWidth);else if("replace"===this.ellipsis){const t=Zr(l,("vertical"===c?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,l.length-1);if(l=l.slice(0,t),l+=this.ellipsisStr,"right"===n||"end"===n)if("vertical"===c);else{const{width:e}=to(this.text.slice(t),this.character,this.ascentDescentMode);h-=this.ellipsisWidth-e}}}const d=dh(h,h+(this.widthOrigin||this.width),e,e+s);return Object.assign(Object.assign({},d),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,r,o,n,s){var a;let l=e+i,h=this.text,c=this.left+r+(null!==(a=this.space)&&void 0!==a?a:0)/2;l+=this.top;let d=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,d="vertical",l-=this.ellipsisWidth/2;else{if("hide"===this.ellipsis)return;if("add"===this.ellipsis)h+=this.ellipsisStr,"right"!==n&&"end"!==n||(c-=this.ellipsisWidth);else if("replace"===this.ellipsis){const t=Zr(h,("vertical"===d?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,t),h+=this.ellipsisStr,"right"===n||"end"===n)if("vertical"===d);else{const{width:e}=to(this.text.slice(t),this.character,this.ascentDescentMode);c-=this.ellipsisWidth-e}}}switch(this.character.script){case"super":l-=this.ascent*(1/3);break;case"sub":l+=this.descent/2}"vertical"===d&&(t.save(),t.rotateAbout(Math.PI/2,c,l),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(c,l),c=0,l=0);const{lineWidth:u=1}=this.character;if(this.character.stroke&&u&&t.strokeText(h,c+this.dx,l+this.dy),this.character.fill&&t.fillText(h,c+this.dx,l+this.dy),this.character.fill)if(this.character.lineThrough||this.character.underline){if(this.character.underline){const e=1+l,i=dh(c,c+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){const e=1+l-this.ascent/2,i=dh(c,c+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l-this.ascent/2,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if("underline"===this.character.textDecoration){const e=1+l,i=dh(c,c+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if("line-through"===this.character.textDecoration){const e=1+l-this.ascent/2,i=dh(c,c+(this.widthOrigin||this.width),e,e+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(i.left,1+l-this.ascent/2,i.right-i.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}"vertical"===d&&t.restore()}getWidthWithEllips(t){let e=this.text;const i="vertical"===t?this.height:this.width;if("hide"===this.ellipsis)return i;if("add"===this.ellipsis)return i+this.ellipsisWidth;if("replace"===this.ellipsis){const t=Zr(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,t),e+=this.ellipsisStr;const{width:r}=to(this.text.slice(t),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-r}return i}}const gh=["width","height","image",...Ya];let ph=class t extends el{constructor(t){super(t),this.type="image",this.numberType=aa,this.loadImage(this.attribute.image)}getImageElement(){const{image:t}=this.attribute;if(!t||!this.resources)return null;const e=this.resources.get(t);return"success"!==e.state?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return null!==(t=this.attribute.repeatX)&&void 0!==t?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return null!==(t=this.attribute.repeatY)&&void 0!==t?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,(()=>{this.successCallback&&this.successCallback()})),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,(()=>{this.failCallback&&this.failCallback()}))}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,r){return"image"===t&&this.loadImage(e),super.setAttribute(t,e,i,r)}getGraphicTheme(){return nn(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{maxWidth:r=e.maxWidth,maxHeight:o=e.maxHeight}=t;let{width:n,height:s}=t;if(null==n||null==s){const t=this.getImageElement();if(t){const e=t.width,i=t.height;if(null!=n)s=n*(i/e);else if(null!=s)n=s*(e/i);else{const t=e/i;t>r/o?(n=r,s=r/t):(s=o,n=o*t)}}else n=r,s=o}this._actualWidth=n,this._actualHeight=s,i.set(0,0,n,s)}const{tb1:r,tb2:o}=D.graphicService.updateTempAABBBounds(i);return Vl(t,e,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,D.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return Or[t]}needUpdateTags(t){return super.needUpdateTags(t,gh)}needUpdateTag(t){return super.needUpdateTag(t,gh)}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function fh(t){return new ph(t)}ph.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},tl);class mh extends ph{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],"always"===t.backgroundShowMode&&(this._hovered=!0),t.margin){const e=_n(t.margin);this._marginArray="number"==typeof e?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(t,e,i)=>{if(ut(i)&&-1!==i.indexOf("margin")||"margin"===i)if(e.margin){const t=_n(e.margin);this._marginArray="number"==typeof t?[t,t,t,t]:t}else this._marginArray=[0,0,0,0]}}get width(){var t;return(null!==(t=this.attribute.width)&&void 0!==t?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return(null!==(t=this.attribute.height)&&void 0!==t?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=Or.width,height:e=Or.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:r=e}=this.attribute,o=(i-t)/2,n=(r-e)/2;return this._AABBBounds.expand([0,2*o,2*n,0]),this._AABBBounds}setHoverState(t){"hover"===this.attribute.backgroundShowMode&&this._hovered!==t&&(this._hovered=t)}}class bh{constructor(t,e,i,r,o,n,s,a){this.left=t,this.width=e,this.baseline=i,this.ascent=r,this.descent=o,this.top=i-r,this.paragraphs=n.map((t=>t)),this.textAlign=(this.paragraphs[0]instanceof mh?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=s,this.directionKey=Vr[this.direction],this.actualWidth=0;let l=0;this.paragraphs.forEach(((t,e)=>{if(0===e&&t instanceof uh){const e=Yr.exec(t.text);0!==(null==e?void 0:e.index)&&(t.text=t.text.slice(null==e?void 0:e.index),t.updateWidth())}this.actualWidth+=t[this.directionKey.width],l=Math.max(t[this.directionKey.height],l)})),this.height=l,this.blankWidth=a?0:this.width-this.actualWidth,this.calcOffset(e,a)}calcOffset(t,e){const i=this.directionKey,r=this.height;let o=this.left,n=0;this.actualWidth<t&&!e&&("right"===this.textAlign||"end"===this.textAlign?o=t-this.actualWidth:"center"===this.textAlign?o=(t-this.actualWidth)/2:"justify"===this.textAlign&&(this.paragraphs.length<2?o=(t-this.actualWidth)/2:n=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map((function(t){t instanceof mh?(t["_"+i.x]=o,o+=t[i.width]+n,t["_"+i.y]="top"===t.attribute.textBaseline?0:"bottom"===t.attribute.textBaseline?r-t.height:(r-t.height)/2):(t[i.left]=o,o+=t[i.width]+n)}))}draw(t,e,i,r,o,n){if(o&&(e||this.paragraphs.some((t=>t.overflow)))){let t=!0,i=!1;for(let e=this.paragraphs.length-1;e>=0;e--){const r=this.paragraphs[e];if(r.overflow)t=t&&""===r.text;else if(t){i=!0;break}}let r=0;if(!i)for(let t=this.paragraphs.length-1;t>=0;t--){const i=this.paragraphs[t];if(i.overflow){if(""===i.text)break;continue}if(i instanceof mh)break;if("vertical"===this.direction&&"vertical"!==i.direction){i.verticalEllipsis=!0;break}const n=!0===o?"...":o||"";i.ellipsisStr=n;const{width:s}=to(n,i.character,i.ascentDescentMode),a=s||0;if(a<=this.blankWidth+r){e&&(i.ellipsis="add");break}if(a<=this.blankWidth+r+i.width){i.ellipsis="replace",i.ellipsisWidth=a,i.ellipsisOtherParagraphWidth=this.blankWidth+r;break}i.ellipsis="hide",r+=i.width}}let s="",a=-1,l=[];const h=[l];this.paragraphs.forEach(((e,o)=>{if(e instanceof mh)return;const n=e.drawBackground(t,r,this.ascent,i,0===o,this.textAlign,this.height);n&&(s===n.fillStyle&&a===n.globalAlpha||(l=[],h.push(l),s=n.fillStyle,a=n.globalAlpha),l.push(n))})),h.forEach((e=>{if(0===e.length)return;const i=e[0],r=e[e.length-1];t.fillStyle=i.fillStyle,t.globalAlpha=i.globalAlpha,t.fillRect(i.left,i.top,r.right-i.left,r.bottom-i.top)})),this.paragraphs.forEach(((e,o)=>{if(e instanceof mh)return e.setAttributes({x:i+e._x,y:r+e._y}),void n(e,t,i+e._x,r+e._y,this.ascent);const s={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};(function(t,e){const i=e&&e.stroke||Kr;if(!i)return void(t.globalAlpha=0);const{strokeOpacity:r=1,opacity:o=1}=e;t.globalAlpha=r*o,t.lineWidth=e&&"number"==typeof e.lineWidth?e.lineWidth:1,t.strokeStyle=i,qr(t,e)})(t,e.character),function(t,e,i){const r=e&&e.fill||Ur;if(!r)return void(t.globalAlpha=0);const{fillOpacity:o=1,opacity:n=1}=e;t.globalAlpha=o*n,t.fillStyle=i?jr(t,r,{AABBBounds:i}):r,qr(t,e)}(t,e.character,s),e.draw(t,r,this.ascent,i,0===o,this.textAlign,this.height)}))}getWidthWithEllips(t){let e=0;for(let i=this.paragraphs.length-1;i>=0;i--){const r=this.paragraphs[i];if(r instanceof mh)break;const{width:o}=to(t,r.character,r.ascentDescentMode),n=o||0;if(n<=this.blankWidth+e){r.ellipsis="add",r.ellipsisWidth=n;break}if(n<=this.blankWidth+e+r.width){r.ellipsis="replace",r.ellipsisWidth=n,r.ellipsisOtherParagraphWidth=this.blankWidth+e;break}r.ellipsis="hide",e+=r.width}let i=0;return this.paragraphs.forEach(((t,e)=>{i+=t instanceof mh?t.width:t.getWidthWithEllips(this.direction)})),i}}class yh{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=Vr[this.direction]}store(t){if(t instanceof mh){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;"top"===t.attribute.textBaseline?(e=0,i=t.height):"bottom"===t.attribute.textBaseline?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),0!==t.text.length?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(0===this.lineBuffer.length)return;const t=0===this.maxAscent?this.maxAscentForBlank:this.maxAscent,e=0===this.maxDescent?this.maxDescentForBlank:this.maxDescent,i=new bh(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,"horizontal"===this.direction?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t,e=!1){t instanceof mh?"horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):0===this.lineBuffer.length?(this.store(t),this.send()):(this.send(),this.deal(t)):"number"!=typeof this.width||this.width<0||(t.newLine&&this.send(),(0!==t.text.length||this.newLine)&&("horizontal"===this.direction&&0===this.width||"vertical"===this.direction&&0===this.height||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,r=Math.ceil(i/t[this.directionKey.width]*t.length)||0,o=Zr(t.text,i,t.character,r,"break-word"===this.frame.wordBreak);if(0!==o){const[i,r]=function(t,e){const i=t.text.slice(0,e),r=t.text.slice(e);return[new uh(i,t.newLine,t.character,t.ascentDescentMode),new uh(r,!0,t.character,t.ascentDescentMode)]}(t,o);this.store(i),e?this.send():this.deal(r)}else 0!==this.lineBuffer.length&&(this.send(),this.deal(t))}}let Ch=!1;try{Ch=Intl&&"function"==typeof Intl.Segmenter}catch(t){Ch=!1}const wh=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...Ya];class vh extends el{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=ua,this.onBeforeAttributeUpdate=(t,e,i)=>{for(const i in t)if("hoverIconId"===i){if(t[i]===e[i])continue;const r=this._frameCache.icons.get(t[i]);this.updateHoverIconState(r)}}}get width(){var t;return null!==(t=this.attribute.width)&&void 0!==t?t:zr.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return null!==(t=this.attribute.height)&&void 0!==t?t:zr.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return null!==(t=this.attribute.ellipsis)&&void 0!==t?t:zr.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return null!==(t=this.attribute.wordBreak)&&void 0!==t?t:zr.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return null!==(t=this.attribute.verticalDirection)&&void 0!==t?t:zr.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return null!==(t=this.attribute.textAlign)&&void 0!==t?t:zr.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return null!==(t=this.attribute.textBaseline)&&void 0!==t?t:zr.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return null!==(t=this.attribute.textConfig)&&void 0!==t?t:zr.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return nn(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every((t=>t.paragraphs.every((t=>!(t.text&&dt(t.text)&&vh.splitText(t.text).length>1))))):t.every((t=>t.isComposing||!(t.text&&dt(t.text)&&vh.splitText(t.text).length>1)))}static splitText(t){if(Ch){const e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(const{segment:r}of e.segment(t))i.push(r);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){const e=[];return t.forEach((t=>{const i=vh.splitText(t.text.toString());if(dt(t.text)&&i.length>1)for(let r=0;r<i.length;r++){const o=i[r];e.push(Object.assign(Object.assign({},t),{text:o}))}else e.push(t)})),e}updateAABBBounds(t,e,i){var r,o,n,s;const{width:a=e.width,height:l=e.height,maxWidth:h=e.maxWidth,maxHeight:c=e.maxHeight,textAlign:d=e.textAlign,textBaseline:u=(null!==(o=null!==(r=t.textBaseline)&&void 0!==r?r:e.textBaseline)&&void 0!==o?o:"top"),editOptions:g}=t;if(a>0&&l>0)i.set(0,0,a,l);else{const t=this.getFrameCache(),{width:e,height:r}=t.getActualSize();let o=a||e||0,n=l||r||0;n="number"==typeof c&&n>c?c:n||0,o="number"==typeof h&&o>h?h:o||0,i.set(0,0,o,n)}g&&g.keepHeightWhileEmpty&&!i.height()&&!(null===(n=t.textConfig)||void 0===n?void 0:n.length)&&(i.y2=i.y1+(null!==(s=t.fontSize)&&void 0!==s?s:12),i.x2=i.x1+2);let p=0;switch(u){case"top":p=0;break;case"middle":p=-i.height()/2;break;case"bottom":p=-i.height()}let f=0;switch(d){case"left":f=0;break;case"center":f=-i.width()/2;break;case"right":f=-i.width()}return i.translate(f,p),D.graphicService.updateTempAABBBounds(i),null==t.forceBoundsHeight&&null==t.forceBoundsWidth||D.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,D.graphicService.transformAABBBounds(t,i,e,!1,this),0===i.width()&&0===i.height()&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,wh)}needUpdateTag(t){return super.needUpdateTag(t,wh)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let e=0;e<t.lines.length;e++){const i=t.lines[e];for(let t=0;t<i.paragraphs.length;t++){const e=i.paragraphs[t];if(e.overflow&&""!==e.text)return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:n,fontWeight:s,lineWidth:a,opacity:l,fillOpacity:h,lineHeight:c,strokeOpacity:d,upgradeAttrs:u}=this.attribute,g=Object.assign({fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:n,fontWeight:s,lineWidth:a,opacity:l,fillOpacity:h,strokeOpacity:d},t);return(null==u?void 0:u.lineHeight)&&(g.lineHeight=c),g}doUpdateFrameCache(t){var e;const{maxWidth:i,maxHeight:r,width:o,height:n,ellipsis:s,wordBreak:a,verticalDirection:l,textAlign:h,textBaseline:c,layoutDirection:d,singleLine:u,disableAutoWrapLine:g,editable:p,ascentDescentMode:f,upgradeAttrs:m}=this.attribute,b=m&&m.multiBreakLine;let{textConfig:y=[]}=this.attribute;p&&y.length>0&&!vh.AllSingleCharacter(y)&&(y=vh.TransformTextConfig2SingleCharacter(y),this.attribute.textConfig=y);const C=[],w=null!=t?t:y;for(let t=0;t<w.length;t++)if("image"in w[t]){const e=this.combinedStyleToCharacter(w[t]);e.lineWidth=void 0;const i=e.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(e.id);if(i)C.push(i);else{const t=new mh(e);t.successCallback=()=>{var t;this.addUpdateBoundTag(),null===(t=this.stage)||void 0===t||t.renderNextFrame()},t.richtextId=e.id,C.push(t)}}else{const e=this.combinedStyleToCharacter(w[t]);if(ft(e.text)&&(e.text=`${e.text}`),e.text&&e.text.includes("\n")){const i=e.text.split("\n");for(let r=0;r<i.length;r++)if(0===r)C.push(new uh(i[r],!1,e,f));else if(i[r]||t===w.length-1)C.push(new uh(i[r],!0,e,f));else{const e=this.combinedStyleToCharacter(w[t+1]);C.push(new uh(i[r],!0,e,f))}}else e.text&&C.push(new uh(e.text,!1,e,f))}const v="number"==typeof i&&Number.isFinite(i)&&i>0,x="number"==typeof r&&Number.isFinite(r)&&r>0,_="number"==typeof o&&Number.isFinite(o)&&o>0&&(!v||o<=i),S="number"==typeof n&&Number.isFinite(n)&&n>0&&(!x||n<=r),A=new ch(0,0,(_?o:v?i:0)||0,(S?n:x?r:0)||0,s,a,l,h,c,d||"horizontal",!_&&v,!S&&x,u||!1,null===(e=this._frameCache)||void 0===e?void 0:e.icons),T=new yh(A);if(T.newLine=b,g){let t=0,e=!1;for(let i=0;i<C.length;i++){const r=C[i];e?(r.overflow=!0,r.left=1/0,r.top=1/0,!r.newLine&&A.lines[A.lines.length-1].paragraphs.push(r)):T.deal(r,!0),A.lines.length!==t&&(t=A.lines.length,T.lineBuffer.length=0,r.overflow=!0,r.left=1e3,r.top=1e3,A.lines[A.lines.length-1].paragraphs.push(r),e=!0),r.newLine&&(e=!1,T.lineWidth=0),T.send()}}else for(let t=0;t<C.length;t++)T.deal(C[t]);if(T.send(),!("horizontal"===A.layoutDirection?_:S)){const t=A.getActualSizeWidthEllipsis();let e="horizontal"===A.layoutDirection?t.width:t.height;("horizontal"===A.layoutDirection?v:x)&&(e=Math.min(e,"horizontal"===A.layoutDirection?i:r)),A.lines.forEach((function(t){t.calcOffset(e,!1)}))}b&&A.lines.forEach((t=>{const e=t.paragraphs;t.paragraphs=t.paragraphs.filter((t=>""!==t.text)),0===t.paragraphs.length&&e.length&&(e[0].text="\n",t.paragraphs.push(e[0]))})),this._frameCache=A}clone(){return new vh(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach((i=>{i.setStage(t,e)}))}bindIconEvent(){this.addEventListener("pointermove",(t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))})),this.addEventListener("pointerleave",(t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)}))}updateHoverIconState(t){var e,i,r,o,n;t?(null===(e=this._currentHoverIcon)||void 0===e||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),null===(i=this.stage)||void 0===i||i.setCursor(t.attribute.cursor),null===(r=this.stage)||void 0===r||r.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,null===(o=this.stage)||void 0===o||o.setCursor(),null===(n=this.stage)||void 0===n||n.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let o;return e.icons.forEach(((e,n)=>{var s,a;const l=e.AABBBounds.clone();l.translate(e._marginArray[3],e._marginArray[0]),l.containsPoint({x:t.x-i,y:t.y-r})&&(o=e,o.globalX=(null!==(s=o.attribute.x)&&void 0!==s?s:0)+i+e._marginArray[3],o.globalY=(null!==(a=o.attribute.y)&&void 0!==a?a:0)+r+e._marginArray[0])})),o}getNoWorkAnimateAttr(){return vh.NOWORK_ANIMATE_ATTR}}function xh(t){return new vh(t)}vh.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},tl);const _h=["path","customPath",...Ya];class Sh extends el{constructor(t){super(t),this.type="path",this.numberType=ha}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return null!=t&&""!==t}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof pr?e.path:(nt(this.cache)&&this.doUpdatePathShape(),this.cache instanceof pr?this.cache:t.path)}getGraphicTheme(){return nn(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const t=this.getParsedPathShape();i.union(t.getBounds())}const{tb1:r,tb2:o}=D.graphicService.updateTempAABBBounds(i);Vl(t,e,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:n=e.lineJoin}=t;return D.graphicService.transformAABBBounds(t,i,e,"miter"===n,this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;dt(t.path,!0)?this.cache=(new pr).fromString(t.path):t.customPath&&(this.cache=new pr,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,_h)}needUpdateTag(t){return super.needUpdateTag(t,_h)}toCustomPath(){return(new pr).fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new Sh(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Sh.NOWORK_ANIMATE_ATTR}}function Ah(t){return new Sh(t)}Sh.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},tl);const Th=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...Ya];let Rh=class t extends el{constructor(t){super(t),this.type="arc",this.numberType=ia}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:r=t.outerPadding}=this.attribute;let{outerRadius:o=t.outerRadius,innerRadius:n=t.innerRadius}=this.attribute;if(o+=r,n-=i,0===e||"0%"===e)return 0;const s=Math.abs(o-n),a=t=>Math.min(ft(t,!0)?t:s*parseFloat(t)/100,s/2);if(ut(e)){const t=e.map((t=>a(t)||0));return 0===t.length?[t[0],t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[0],t[1]]:(3===t.length&&t.push(0),t)}return a(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:r=t.cap}=this.attribute,o=i-e>=0?1:-1,n=i-e;if(e=xe(e),i=e+n,r&&he(n)<le-oe){let n=1,s=1;r.length&&(n=Number(r[0]),s=Number(r[1]));let{outerRadius:a=t.outerRadius,innerRadius:l=t.innerRadius}=this.attribute;const{outerPadding:h=t.outerPadding,innerPadding:c=t.innerPadding}=this.attribute;a+=h,l-=c;const d=Math.abs(a-l)/2,u=d/a;if(d>oe&&a>oe)return{startAngle:e-o*u*n,endAngle:i+o*u*s,sc:o*u*n,ec:o*u*s}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:r=i.innerPadding,outerPadding:o=i.outerPadding,padAngle:n=i.padAngle}=this.attribute;let{outerRadius:s=i.outerRadius,innerRadius:a=i.innerRadius}=this.attribute;s+=o,a-=r;const{padRadius:l=fe(s*s+a*a)}=this.attribute,h=he(e-t);let c=t,d=e,u=t,g=e;const p=n/2;let f=h,m=h;if(p>oe&&l>oe){const i=e>t?1:-1;let r=be(Number(l)/a*pe(p)),o=be(Number(l)/s*pe(p));return(f-=2*r)>oe?(r*=i,u+=r,g-=r):(f=0,u=g=(t+e)/2),(m-=2*o)>oe?(o*=i,c+=o,d-=o):(m=0,c=d=(t+e)/2),{outerStartAngle:c,outerEndAngle:d,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:m}}return{outerStartAngle:c,outerEndAngle:d,innerStartAngle:u,innerEndAngle:g,innerDeltaAngle:f,outerDeltaAngle:m}}getGraphicTheme(){return nn(this).arc}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:n}=D.graphicService.updateTempAABBBounds(i);Vl(t,e,o),i.union(o),o.setValue(n.x1,n.y1,n.x2,n.y2),this.setWidthHeightWithoutTransform(i);const{lineJoin:s=e.lineJoin}=t;return D.graphicService.transformAABBBounds(t,i,e,"miter"===s,this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:o=e.innerRadius}=t;const{outerPadding:n=e.outerPadding,innerPadding:s=e.innerPadding}=t;return r+=n,o-=s,r<o&&(r=o),i.set(-r,-r,r,r),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:o=e.innerRadius}=t;const{outerPadding:n=e.outerPadding,innerPadding:s=e.innerPadding}=t;if(r+=n,o-=s,r<o){const t=r;r=o,o=t}let{endAngle:a=e.endAngle,startAngle:l=e.startAngle}=t;if(l>a){const t=l;l=a,a=t}return r<=oe?i.set(0,0,0,0):Math.abs(a-l)>le-oe?i.set(-r,-r,r,r):(Tn(l,a,r,i),Tn(l,a,o,i)),i}needUpdateTags(t){return super.needUpdateTags(t,Th)}needUpdateTag(t){return super.needUpdateTag(t,Th)}toCustomPath(){var t,e,i,r;let o=super.toCustomPath();if(o)return o;const n=this.attribute,{startAngle:s,endAngle:a}=this.getParsedAngle();let l=(null!==(t=n.innerRadius)&&void 0!==t?t:0)-(null!==(e=n.innerPadding)&&void 0!==e?e:0),h=(null!==(i=n.outerRadius)&&void 0!==i?i:0)-(null!==(r=n.outerPadding)&&void 0!==r?r:0);const c=he(a-s),d=a>s;if(h<l){const t=h;h=l,l=t}if(o=new pr,h<=oe)o.moveTo(0,0);else if(c>=le-oe)o.moveTo(0+h*de(s),0+h*pe(s)),o.arc(0,0,h,s,a,!d),l>oe&&(o.moveTo(0+l*de(a),0+l*pe(a)),o.arc(0,0,l,a,s,d));else{const t=h*de(s),e=h*pe(s),i=l*de(a),r=l*pe(a);o.moveTo(0+t,0+e),o.arc(0,0,h,s,a,!d),o.lineTo(0+i,0+r),o.arc(0,0,l,a,s,d),o.closePath()}return o}clone(){return new t(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return t.NOWORK_ANIMATE_ATTR}};function Bh(t){return new Rh(t)}Rh.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},tl);const Mh=["points","cornerRadius",...Ya];class Ph extends el{constructor(t){super(t),this.type="polygon",this.numberType=ca}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return nn(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),D.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return D.graphicService.transformAABBBounds(t,i,e,"miter"===r,this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:r=e.points}=t;return r.forEach((t=>{i.add(t.x,t.y)})),i}_interpolate(t,e,i,r,o){"points"===t&&(o.points=Bn(i,r,e))}needUpdateTags(t){return super.needUpdateTags(t,Mh)}needUpdateTag(t){return super.needUpdateTag(t,Mh)}toCustomPath(){let t=super.toCustomPath();if(t)return t;const e=this.attribute.points;return t=new pr,e.forEach(((e,i)=>{0===i?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)})),t.closePath(),t}clone(){return new Ph(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ph.NOWORK_ANIMATE_ATTR}}function Hh(t){return new Ph(t)}Ph.NOWORK_ANIMATE_ATTR=tl;class kh extends rl{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function Eh(t){return new kh(t)}const Fh=new class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}};let Lh;function Ih(t){return Lh||(Lh=Fh.CreateGraphic("text",{})),Lh.initAttributes(t),Lh.AABBBounds}var zh=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Oh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Dh=function(t,e){return function(i,r){e(i,r,t)}};class Wh{constructor(){this.time=_i.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){var g;const{background:p,backgroundOpacity:f=(null!==(g=t.attribute.fillOpacity)&&void 0!==g?g:l.backgroundOpacity),opacity:m=l.opacity,backgroundMode:b=l.backgroundMode,backgroundFit:y=l.backgroundFit,backgroundKeepAspectRatio:C=l.backgroundKeepAspectRatio,backgroundScale:w=l.backgroundScale,backgroundOffsetX:v=l.backgroundOffsetX,backgroundOffsetY:x=l.backgroundOffsetY,backgroundClip:_=l.backgroundClip}=t.attribute;if(p)if(t.backgroundImg&&t.resources){const o=t.resources.get(p);if("success"!==o.state||!o.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const i=nn(t.parent).group,{scrollX:r=i.scrollX,scrollY:o=i.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(r,o)}_&&e.clip();const n=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,r,l),e.globalAlpha=f*m,this.doDrawImage(e,o.data,n,{backgroundMode:b,backgroundFit:y,backgroundKeepAspectRatio:C,backgroundScale:w,backgroundOffsetX:v,backgroundOffsetY:x}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,l),e.globalAlpha=f*m,e.fillStyle=p,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,r){const{backgroundMode:o,backgroundFit:n,backgroundKeepAspectRatio:s,backgroundScale:a=1,backgroundOffsetX:l=0,backgroundOffsetY:h=0}=r,c=i.width(),d=i.height();let u=c,g=d;if("no-repeat"===o)if(n)if(s){const r=Math.max(c/e.width,d/e.height);t.drawImage(e,i.x1+l,i.y1+h,e.width*r*a,e.height*r*a)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const r=e.width*a,o=e.height*a;t.drawImage(e,i.x1+l,i.y1+h,r,o)}else{if(n&&"repeat"!==o&&(e.width||e.height)){const i=e.width,r=e.height;"repeat-x"===o?(u=i*(d/r),g=d):"repeat-y"===o&&(g=r*(c/i),u=c);const n=t.dpr,s=Do.allocate({width:u,height:g,dpr:n}),a=s.getContext("2d");a&&(a.inuse=!0,a.clearMatrix(),a.setTransformForCurrent(!0),a.clearRect(0,0,u,g),a.drawImage(e,0,0,u,g),e=s.nativeCanvas),Do.free(s)}const r=t.dpr,s=t.createPattern(e,o);s.setTransform&&s.setTransform(new DOMMatrix([1/r,0,0,1/r,0,0])),t.fillStyle=s,t.translate(i.x1,i.y1),t.fillRect(0,0,c,d),t.translate(-i.x1,-i.y1)}}}const Nh=new Wh;let Gh=class{constructor(t){this.subRenderContribitions=t,this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach((g=>{g.render(t,e,i,r,o,n,s,a,l,h,c,d,u)}))}};Gh=zh([f(),Dh(0,g(H)),Dh(0,m(Il)),Oh("design:paramtypes",[Object])],Gh);const jh=new class{constructor(){this.time=_i.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){var g,p;const{clipConfig:f}=t.attribute;if(!f)return;const m=t.getClipPath();if(!m)return;const b=!(c||d),y=t.AABBBounds,C=null!==(g=t.attribute.width)&&void 0!==g?g:y.width(),w=null!==(p=t.attribute.height)&&void 0!==p?p:y.height();b&&e.save(),e.beginPath(),!1===m.draw(e,[C,w],i+C/2,r+w/2,0)&&e.closePath(),c&&c(e,t.attribute,l,!0),b&&e.clip()}};const Vh=new class{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{clipConfig:g}=t.attribute;g&&t.getClipPath()&&(c||d||e.restore())}};class Uh{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,r,o){const n=(t-2*e)/2,s=r.dpr,a=Do.allocate({width:t,height:t,dpr:s}),l=a.getContext("2d");if(!l)return null;l.inuse=!0,l.clearMatrix(),l.setTransformForCurrent(!0),l.clearRect(0,0,t,t),o(n,l);const h=r.createPattern(a.nativeCanvas,"repeat");return h.setTransform&&h.setTransform(new DOMMatrix([1/s,0,0,1/s,0,0])),Do.free(a),h}createCirclePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((t,e)=>{e.fillStyle=i,e.arc(t,t,t,0,le),e.fill()}))}createDiamondPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((e,r)=>{const o=t/2,n=o;r.fillStyle=i,r.moveTo(o,n-e),r.lineTo(e+o,n),r.lineTo(o,n+e),r.lineTo(o-e,n),r.closePath(),r.fill()}))}createRectPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((t,r)=>{const o=e,n=o;r.fillStyle=i,r.fillRect(o,n,2*t,2*t)}))}createVerticalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((r,o)=>{const n=e;o.fillStyle=i,o.fillRect(n,0,2*r,t)}))}createHorizontalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((r,o)=>{const n=e;o.fillStyle=i,o.fillRect(0,n,t,2*r)}))}createBiasLRLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((e,r)=>{r.strokeStyle=i,r.lineWidth=e,r.moveTo(0,0),r.lineTo(t,t);const o=t/2,n=-o;r.moveTo(o,n),r.lineTo(o+t,n+t),r.moveTo(-o,-n),r.lineTo(-o+t,-n+t),r.stroke()}))}createBiasRLLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((e,r)=>{r.strokeStyle=i,r.lineWidth=e,r.moveTo(t,0),r.lineTo(0,t);const o=t/2,n=o;r.moveTo(t+o,n),r.lineTo(o,n+t),r.moveTo(t-o,-n),r.lineTo(-o,-n+t),r.stroke()}))}createGridPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((t,r)=>{const o=e,n=o;r.fillStyle=i,r.fillRect(o,n,t,t),r.fillRect(o+t,n+t,t,t)}))}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){this.textureMap||this.initTextureMap(e,t.stage);const{texture:g=l.texture,textureColor:p=l.textureColor,textureSize:f=l.textureSize,texturePadding:m=l.texturePadding}=t.attribute;g&&this.drawTexture(g,t,e,i,r,l,p,f,m)}drawTexture(t,e,i,r,o,n,s,a,l){var h;const{textureRatio:c=n.textureRatio,textureOptions:d=null}=e.attribute;let u=this.textureMap.get(t);if(!u)switch(t){case"circle":u=this.createCirclePattern(a,l,s,i);break;case"diamond":u=this.createDiamondPattern(a,l,s,i);break;case"rect":u=this.createRectPattern(a,l,s,i);break;case"vertical-line":u=this.createVerticalLinePattern(a,l,s,i);break;case"horizontal-line":u=this.createHorizontalLinePattern(a,l,s,i);break;case"bias-lr":u=this.createBiasLRLinePattern(a,l,s,i);break;case"bias-rl":u=this.createBiasRLLinePattern(a,l,s,i);break;case"grid":u=this.createGridPattern(a,l,s,i)}if(d&&d.dynamicTexture){const{gridConfig:u={},useNewCanvas:g}=d,p=e.AABBBounds;r=p.x1,o=p.y1;const f=i;let m;if(g){m=Do.allocate({width:p.width(),height:p.height(),dpr:i.dpr});const t=m.getContext("2d");t.clearRect(0,0,p.width(),p.height()),r=0,o=0,i=t}if(f.save(),e.parent&&!e.transMatrix.onlyTranslate()){const{scrollX:t=0,scrollY:i=0}=e.parent.attribute;f.setTransformFromMatrix(e.parent.globalTransMatrix),f.translate(t,i,!0)}f.setCommonStyle(e,e.attribute,r,o,n),f.clip();const b=p.width(),y=p.height(),C=l,w=a,v=u.columns?u.columns:Math.ceil(b/w),x=u.rows?u.rows:Math.ceil(y/w),_=u.gutterColumn?u.gutterColumn:2*C,S=u.gutterRow?u.gutterRow:2*C;this._tempSymbolGraphic||(this._tempSymbolGraphic=rh({}));const A=u.columns?b/u.columns:w,T=u.rows?y/u.rows:w;this._tempSymbolGraphic.setAttributes({size:[A-_,T-S],symbolType:t});const R=this._tempSymbolGraphic.getParsedPath();for(let t=0;t<x;t++)for(let n=0;n<v;n++){const a=r+w/2+n*w,l=o+w/2+t*w;null===(h=d.beforeDynamicTexture)||void 0===h||h.call(d,i,t,n,x,v,c,e,p.width(),p.height()),i.beginPath(),!1===R.draw(i,Math.min(A-_,T-S),a,l,0)&&i.closePath(),i.fillStyle=s,d.dynamicTexture(i,t,n,x,v,c,e,p.width(),p.height())}g&&(f.globalAlpha=1,f.drawImage(m.nativeCanvas,0,0,m.nativeCanvas.width,m.nativeCanvas.height,p.x1,p.y1,p.width()*f.dpr,p.height()*f.dpr)),f.restore()}else if(u)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,r,o,n),i.fillStyle=u,i.fill(),i.highPerformanceRestore();else if("wave"===t){i.save(),i.setCommonStyle(e,e.attribute,r,o,n),i.clip();const t=e.AABBBounds;(function(t,e,i,r,o,n,s){const{fill:a="orange",percent:l=.6,frequency:h=4,opacity:c,phi:d=0}=o;let{amplitude:u=10}=o;u*=function(t){return t<=.5?4*t-1:-4*t+3}(e);const g=r*(1-l),p=i,f=Math.max(Math.round(p/70),2);t.beginPath(),t.moveTo(0+n,r+s),t.lineTo(0+n,g+s);const m=p/h*e,b=p/Math.PI/(2*h);for(let e=0;e<p;e+=f){const i=u*Math.sin((e+m+d)/b+d);t.lineTo(e+n,g+i+s)}t.lineTo(p+n,r+s),t.closePath(),t.fillStyle=a,isFinite(c)&&(t.globalAlpha=c),t.fill()})(i,c,t.width(),t.height(),Object.assign(Object.assign({},d||{}),{fill:s}),r+t.x1-r,o+t.y1-o),i.restore()}}}const Kh=new Uh;const $h=new class{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{innerPadding:m=l.innerPadding,outerPadding:b=l.outerPadding,startAngle:y=l.startAngle,endAngle:C=l.endAngle,opacity:w=l.opacity,x:v=l.x,y:x=l.y,scaleX:_=l.scaleX,scaleY:S=l.scaleY,keepStrokeScale:A=l.keepStrokeScale}=t.attribute;let{innerRadius:T=l.innerRadius,outerRadius:R=l.outerRadius}=t.attribute;R+=b,T-=m;const B=(o,n)=>{const s=!(!o||!o.stroke),{distance:a=l[n].distance}=o,h=A?a:Gr(e,a,e.dpr),c=a/R,u="outerBorder"===n?1:-1;if(t.setAttributes({outerRadius:R+u*h,innerRadius:T-u*h,startAngle:y-u*c,endAngle:C+u*c}),e.beginPath(),Al(t,e,i,r,R+u*h,T-u*h),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,o,l[n]);else if(s){const s=l[n].opacity;l[n].opacity=w,e.setStrokeStyle(t,o,(v-i)/_,(x-r)/S,l[n]),l[n].opacity=s,e.stroke()}};p&&B(u,"outerBorder"),f&&B(g,"innerBorder"),t.setAttributes({outerRadius:R,innerRadius:T,startAngle:y,endAngle:C})}},Xh=Kh,Yh=Nh;const qh=new class{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{radius:m=l.radius,startAngle:b=l.startAngle,endAngle:y=l.endAngle,opacity:C=l.opacity,x:w=l.x,y:v=l.y,scaleX:x=l.scaleX,scaleY:_=l.scaleY,keepStrokeScale:S=l.keepStrokeScale}=t.attribute,A=(o,n)=>{const s=!(!o||!o.stroke),{distance:a=l[n].distance}=o,h=S?a:Gr(e,a,e.dpr),c="outerBorder"===n?1:-1;if(e.beginPath(),e.arc(i,r,m+c*h,b,y),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,o,l[n]);else if(s){const s=l[n].opacity;l[n].opacity=C,e.setStrokeStyle(t,o,(w-i)/x,(v-r)/_,l[n]),l[n].opacity=s,e.stroke()}};p&&A(u,"outerBorder"),f&&A(g,"innerBorder")}},Zh=Kh,Jh=Nh;const Qh=new class extends Wh{constructor(){super(...arguments),this.time=_i.beforeFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{background:u,backgroundMode:g=l.backgroundMode,backgroundFit:p=l.backgroundFit,backgroundKeepAspectRatio:f=l.backgroundKeepAspectRatio,backgroundScale:m=l.backgroundScale,backgroundOffsetX:b=l.backgroundOffsetX,backgroundOffsetY:y=l.backgroundOffsetY}=t.attribute;if(u)if(t.backgroundImg&&t.resources){const i=t.resources.get(u);if("success"!==i.state||!i.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const r=t.AABBBounds;this.doDrawImage(e,i.data,r,{backgroundMode:g,backgroundFit:p,backgroundKeepAspectRatio:f,backgroundScale:m,backgroundOffsetX:b,backgroundOffsetY:y}),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=u,e.fill(),e.highPerformanceRestore()}},tc=ne/2;function ec(t,e,i,r,o,n,s=!0,a){let l;if(Array.isArray(s)&&(a=s,s=!0),r<0&&(e+=r,r=-r),o<0&&(i+=o,o=-o),ft(n,!0))l=[n=he(n),n,n,n];else if(Array.isArray(n)){const t=n;let e,i;switch(t.length){case 0:l=[0,0,0,0];break;case 1:e=he(t[0]),l=[e,e,e,e];break;case 2:case 3:e=he(t[0]),i=he(t[1]),l=[e,i,e,i];break;default:l=t,l[0]=he(l[0]),l[1]=he(l[1]),l[2]=he(l[2]),l[3]=he(l[3])}}else l=[0,0,0,0];if(r<0||l[0]+l[1]+l[2]+l[3]<1e-12)return t.rect(e,i,r,o);const[h,c,d,u]=[[e,i],[e+r,i],[e+r,i+o],[e,i+o]],g=Math.min(r/2,o/2),p=[Math.min(g,l[0]),Math.min(g,l[1]),Math.min(g,l[2]),Math.min(g,l[3])],f=[h[0]+p[0],h[1]],m=[h[0],h[1]+p[0]],b=[c[0]-p[1],c[1]],y=[c[0],c[1]+p[1]],C=[d[0]-p[2],d[1]],w=[d[0],d[1]-p[2]],v=[u[0]+p[3],u[1]],x=[u[0],u[1]-p[3]];if(t.moveTo(f[0],f[1]),s){if(a&&a[0]?a[0](f[0],f[1],b[0],b[1]):t.lineTo(b[0],b[1]),!Nt(b,y)){a&&a[0]&&t.moveTo(b[0],b[1]);const e=b[0],i=b[1]+p[1];t.arc(e,i,p[1],-tc,0,!1)}if(a&&a[1]?a[1](y[0],y[1],w[0],w[1]):t.lineTo(w[0],w[1]),!Nt(C,w)){const e=w[0]-p[2],i=w[1];a&&a[1]&&t.moveTo(w[0],w[1]),t.arc(e,i,p[2],0,tc,!1)}if(a&&a[2]?a[2](C[0],C[1],v[0],v[1]):t.lineTo(v[0],v[1]),!Nt(v,x)){const e=v[0],i=v[1]-p[3];a&&a[2]&&t.moveTo(v[0],v[1]),t.arc(e,i,p[3],tc,ne,!1)}if(a&&a[3]?a[3](x[0],x[1],m[0],m[1]):t.lineTo(m[0],m[1]),!Nt(f,m)){const e=f[0],i=f[1]+p[0];a&&a[3]&&t.moveTo(m[0],m[1]),t.arc(e,i,p[0],ne,ne+tc,!1)}}else a&&a[0]?a[0](f[0],f[1],b[0],b[1]):t.lineTo(b[0],b[1]),a&&a[1]?a[1](b[0],b[1],C[0],C[1]):t.lineTo(C[0],C[1]),a&&a[2]?a[2](C[0],C[1],v[0],v[1]):t.lineTo(v[0],v[1]),a&&a[2]?a[2](v[0],v[1],f[0],f[1]):t.lineTo(f[0],f[1]);return!a&&t.closePath(),t}var ic=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};class rc{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{outerBorder:u,innerBorder:g}=t.attribute,p=u&&!1!==u.visible,f=g&&!1!==g.visible;if(!p&&!f)return;const{cornerRadius:m=l.cornerRadius,cornerType:b=l.cornerType,opacity:y=l.opacity,x:C=l.x,y:w=l.y,scaleX:v=l.scaleX,scaleY:x=l.scaleY,x1:_,y1:S,keepStrokeScale:A=l.keepStrokeScale}=t.attribute;let{width:T,height:R}=t.attribute;T=(null!=T?T:_-i)||0,R=(null!=R?R:S-r)||0;const B=(o,n)=>{const s=!(!o||!o.stroke),a="outerBorder"===n?-1:1,{distance:h=l[n].distance}=o,c=A?h:Gr(e,h,e.dpr),u=i+a*c,g=r+a*c,p=2*c;if(0===m||ut(m)&&m.every((t=>0===t))?(e.beginPath(),e.rect(u,g,T-a*p,R-a*p)):(e.beginPath(),ec(e,u,g,T-a*p,R-a*p,m,"bevel"!==b)),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,o,l[n]);else if(s){const s=l[n].opacity;l[n].opacity=y,e.setStrokeStyle(t,o,(C-i)/v,(w-r)/x,l[n]),l[n].opacity=s,e.stroke()}};p&&B(u,"outerBorder"),f&&B(g,"innerBorder")}}let oc=class{constructor(){this.time=_i.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{stroke:g=l.stroke}=t.attribute;Array.isArray(g)&&g.some((t=>!1===t))&&(u.doStroke=!1)}};oc=ic([f()],oc);let nc=class{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{x1:u,y1:g,x:p=l.x,y:f=l.y,stroke:m=l.stroke,cornerRadius:b=l.cornerRadius,cornerType:y=l.cornerType}=t.attribute;let{width:C,height:w}=t.attribute;if(C=(null!=C?C:u-p)||0,w=(null!=w?w:g-f)||0,Array.isArray(m)&&m.some((t=>!1===t))){if(e.setStrokeStyle(t,t.attribute,i,r,l),!(0===b||ut(b)&&b.every((t=>0===t)))){let o,n=0;return ec(e,i,r,C,w,b,"bevel"!==y,new Array(4).fill(0).map(((s,a)=>(s,h,c,d)=>{m[a]&&(n===a-1&&m[a]===o||(e.setStrokeStyle(t,Object.assign(Object.assign({},t.attribute),{stroke:m[a]}),i,r,l),e.beginPath(),e.moveTo(s,h),o=m[a]),n=a,e.lineTo(c,d),e.stroke(),3===a&&e.beginPath())}))),void e.stroke()}if(e.beginPath(),e.moveTo(i,r),m[0]?e.lineTo(i+C,r):e.moveTo(i+C,r),m[1]?e.lineTo(i+C,r+w):e.moveTo(i+C,r+w),m[2]?e.lineTo(i,r+w):e.moveTo(i,r+w),m[3]){const t=m[0]?r-e.lineWidth/2:r;e.lineTo(i,t)}else e.moveTo(i,r);e.stroke()}}};nc=ic([f()],nc);const sc=new rc,ac=Kh,lc=Nh;const hc=new class extends rc{constructor(){super(...arguments),this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){return super.drawShape(t,e,i,r,o,n,s,a,l,h,c,d)}},cc=Nh;const dc=new class{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const u=t.getParsedPath();if(!u)return;const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&!1!==g.visible,m=p&&!1!==p.visible;if(!f&&!m)return;const{size:b=l.size,opacity:y=l.opacity,x:C=l.x,y:w=l.y,scaleX:v=l.scaleX,scaleY:x=l.scaleY,keepStrokeScale:_=l.keepStrokeScale}=t.attribute,S=(o,n)=>{const s=!(!o||!o.stroke),{distance:a=l[n].distance}=o,h=_?a:Gr(e,a,e.dpr),c="outerBorder"===n?1:-1;if(e.beginPath(),!1===u.drawOffset(e,b,i,r,c*h)&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),d)d(e,o,l[n]);else if(s){const s=l[n].opacity;l[n].opacity=y,e.setStrokeStyle(t,o,(C-i)/v,(w-r)/x,l[n]),l[n].opacity=s,e.stroke()}};f&&S(g,"outerBorder"),m&&S(p,"innerBorder")}},uc=new class{constructor(){this.time=_i.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{clipRange:g=l.clipRange,x:p=l.x,y:f=l.y,z:m=l.z,size:b=l.size,scaleX:y=l.scaleX,scaleY:C=l.scaleY}=t.attribute,w=t.getParsedPath();w&&g<1&&g>0&&(e.beginPath(),w.drawWithClipRange&&w.drawWithClipRange(e,b,i,r,g,m,((o,n)=>{var s,h,c,u;if(t._parsedPath.svgCache){const e=Object.assign({},n);e.fill=null!==(s=n.fill)&&void 0!==s?s:t.attribute.fill,e.opacity=null!==(h=n.opacity)&&void 0!==h?h:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(c=n.stroke)&&void 0!==c?c:t.attribute.stroke,e.lineWidth=null!==(u=n.lineWidth)&&void 0!==u?u:t.attribute.lineWidth,n=e}n.stroke&&(d?d(e,t.attribute,l):a&&(e.setStrokeStyle(t,n,(p-i)/y,(f-r)/C,l),e.stroke()))})),n&&!w.isSvg&&(d?d(e,t.attribute,l):a&&(e.setStrokeStyle(t,t.attribute,(p-i)/y,(f-r)/C,l),e.stroke())))}},gc=Kh,pc=Nh;const fc={x:0,y:0,z:0,lastModelMatrix:null};class mc{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(jh),this.builtinContributions.push(Vh),this.builtinContributions.forEach((t=>this._renderContribitions.push(t))),this._renderContribitions.length&&(this._renderContribitions.sort(((t,e)=>e.order-t.order)),this._beforeRenderContribitions=this._renderContribitions.filter((t=>t.time===_i.beforeFillStroke)),this._afterRenderContribitions=this._renderContribitions.filter((t=>t.time===_i.afterFillStroke)))}reInit(){this.init(this.graphicRenderContributions)}beforeRenderStep(t,e,i,r,o,n,s,a,l,h,c,d,u){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach((g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u)}))}afterRenderStep(t,e,i,r,o,n,s,a,l,h,c,d,u){this._afterRenderContribitions&&this._afterRenderContribitions.forEach((g=>{g.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(g.supportedAppName)?g.supportedAppName:[g.supportedAppName]).includes(t.stage.params.context.appName)||g.drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u)}))}drawPathProxy(t,e,i,r,o,n,s,a){if(!t.pathProxy)return!1;const l=nn(t,null==n?void 0:n.theme)[t.type.replace("3d","")],{fill:h=l.fill,stroke:c=l.stroke,opacity:d=l.opacity,fillOpacity:u=l.fillOpacity,lineWidth:g=l.lineWidth,strokeOpacity:p=l.strokeOpacity,visible:f=l.visible,x:m=l.x,y:b=l.y}=t.attribute,y=Cl(d,u,h),C=vl(d,p),w=bl(h),v=yl(c,g);if(!f)return!0;if(!w&&!v)return!0;if(!(y||C||s||a))return!0;e.beginPath();return Ri(("function"==typeof t.pathProxy?t.pathProxy(t.attribute):t.pathProxy).commandList,e,i,r),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,w,v,y,C,l,o,s,a),v&&(a?a(e,t.attribute,l):C&&(e.setStrokeStyle(t,t.attribute,i-m,r-b,l),e.stroke())),w&&(s?s(e,t.attribute,l):y&&(e.setCommonStyle(t,t.attribute,i-m,r-b,l),e.fill())),this.afterRenderStep(t,e,i,r,w,v,y,C,l,o,s,a),!0}valid(t,e,i,r){const{fill:o=e.fill,background:n,stroke:s=e.stroke,opacity:a=e.opacity,fillOpacity:l=e.fillOpacity,lineWidth:h=e.lineWidth,strokeOpacity:c=e.strokeOpacity,visible:d=e.visible}=t.attribute,u=Cl(a,l,o),g=vl(a,c),p=bl(o,n),f=yl(s,h);return!(!t.valid||!d)&&!(!p&&!f)&&!!(u||g||i||r||n)&&{fVisible:u,sVisible:g,doFill:p,doStroke:f}}transform(t,e,i,r=!1){const{x:o=e.x,y:n=e.y,z:s=e.z,scaleX:a=e.scaleX,scaleY:l=e.scaleY,angle:h=e.angle,postMatrix:c}=t.attribute,d=i.modelMatrix,u=i.camera;fc.x=o,fc.y=n,fc.z=s,fc.lastModelMatrix=d;const g=u&&(r||function(t){const{alpha:e,beta:i}=t.attribute;return e||i}(t)),p=g?t.transMatrix.onlyTranslate()&&!c:1===a&&1===l&&0===h&&!c;if(g){const r=Ra.allocate(),o=Ra.allocate();Gl(o,t,e),_a(r,d||r,o),fc.x=0,fc.y=0,fc.z=0,i.modelMatrix=r,i.setTransform(1,0,0,1,0,0,!0),Ra.free(o)}if(p&&!d){const r=t.getOffsetXY(e);fc.x+=r.x,fc.y+=r.y,fc.z=s,i.setTransformForCurrent()}else if(g)fc.x=0,fc.y=0,fc.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(u&&i.project){const r=t.getOffsetXY(e);fc.x+=r.x,fc.y+=r.y,this.transformWithoutTranslate(i,fc.x,fc.y,fc.z,a,l,h)}else i.transformFromMatrix(t.transMatrix,!0),fc.x=0,fc.y=0,fc.z=0;return fc}transformUseContext2d(t,e,i,r){const o=r.camera;if(this.camera=o,o){const e=t.AABBBounds,o=e.x2-e.x1,n=e.y2-e.y1,s=r.project(0,0,i),a=r.project(o,0,i),l=r.project(o,n,i),h={x:0,y:0},c={x:o,y:0},d={x:o,y:n};r.camera=null;const u=1/(h.x*(d.y-c.y)-c.x*d.y+d.x*c.y+(c.x-d.x)*h.y),g=-(h.y*(l.x-a.x)-c.y*l.x+d.y*a.x+(c.y-d.y)*s.x)*u,p=(c.y*l.y+h.y*(a.y-l.y)-d.y*a.y+(d.y-c.y)*s.y)*u,f=(h.x*(l.x-a.x)-c.x*l.x+d.x*a.x+(c.x-d.x)*s.x)*u,m=-(c.x*l.y+h.x*(a.y-l.y)-d.x*a.y+(d.x-c.x)*s.y)*u,b=(h.x*(d.y*a.x-c.y*l.x)+h.y*(c.x*l.x-d.x*a.x)+(d.x*c.y-c.x*d.y)*s.x)*u,y=(h.x*(d.y*a.y-c.y*l.y)+h.y*(c.x*l.y-d.x*a.y)+(d.x*c.y-c.x*d.y)*s.y)*u;r.setTransform(g,p,f,m,b,y,!0)}}restoreTransformUseContext2d(t,e,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(t,e,i,r,o,n,s){const a=t.project(e,i,r);t.translate(a.x,a.y,!1),t.scale(o,n,!1),t.rotate(s,!1),t.translate(-a.x,-a.y,!1),t.setTransformForCurrent()}_draw(t,e,i,r,o,n){const{context:s}=r;if(!s)return;const{renderable:a}=t.attribute;if(!1===a)return;s.highPerformanceSave();const l=this.transform(t,e,s,i),{x:h,y:c,z:d,lastModelMatrix:u}=l;this.z=d,this.drawPathProxy(t,s,h,c,r,o)||(this.drawShape(t,s,h,c,r,o,null,null,n),this.z=0,s.modelMatrix!==u&&Ra.free(s.modelMatrix),s.modelMatrix=u),s.highPerformanceRestore()}}var bc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},yc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cc=function(t,e){return function(i,r){e(i,r,t)}};let wc=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ia,this.builtinContributions=[$h,Yh,Xh],this.init(t)}drawArcTailCapPath(t,e,i,r,o,n,s,a){const l=a-s,h=t.getParsedAngle(),c=h.startAngle;let d=h.endAngle;d=a;const u=d>c;let g=!1;if(o<n){const t=o;o=n,n=t}const{outerDeltaAngle:p,xors:f,yors:m,xirs:b,yirs:y,limitedOcr:C,outerCornerRadiusStart:w,outerCornerRadiusEnd:v,maxOuterCornerRadius:x,xore:_,yore:S,xire:A,yire:T,limitedIcr:R,innerDeltaAngle:B,innerStartAngle:M,innerCornerRadiusStart:P,innerCornerRadiusEnd:H,maxInnerCornerRadius:k}=Sl(t,c,d,n,o);if(C>oe){const t=ge(w,C),n=ge(v,C),s=_l(b,y,f,m,o,t,Number(u)),a=_l(_,S,A,T,o,n,Number(u));if(C<x&&t===n)e.moveTo(i+s.cx+s.x01,r+s.cy+s.y01),e.arc(i+s.cx,r+s.cy,C,ce(s.y01,s.x01),ce(a.y01,a.x01),!u);else{const t=d-l-.03,s=ce(a.y11,a.x11);e.arc(i,r,o,t,s,!u),n>0&&e.arc(i+a.cx,r+a.cy,n,ce(a.y11,a.x11),ce(a.y01,a.x01),!u)}}else e.moveTo(i+f,r+m);if(!(n>oe)||B<.001)e.lineTo(i+A,r+T),g=!0;else if(R>oe){const t=ge(P,R),o=ge(H,R),s=_l(A,T,_,S,n,-o,Number(u)),a=_l(f,m,b,y,n,-t,Number(u));if(e.lineTo(i+s.cx+s.x01,r+s.cy+s.y01),R<k&&t===o){const t=ce(a.y01,a.x01);e.arc(i+s.cx,r+s.cy,R,ce(s.y01,s.x01),t,!u)}else{o>0&&e.arc(i+s.cx,r+s.cy,o,ce(s.y01,s.x01),ce(s.y11,s.x11),!u);const t=ce(s.cy+s.y11,s.cx+s.x11),a=d-l-.03;e.arc(i,r,n,t,a,u)}}else e.lineTo(i+n*de(M),r+n*pe(M));return g}drawShape(t,e,i,r,o,n,s,a,l){l=null!=l?l:nn(t,null==n?void 0:n.theme).arc;const{fill:h=l.fill,stroke:c=l.stroke,x:d=l.x,y:u=l.y,fillStrokeOrder:g=l.fillStrokeOrder}=t.attribute,p=this.valid(t,l,s,a);if(!p)return;const{fVisible:f,sVisible:m,doFill:b,doStroke:y}=p,{outerPadding:C=l.outerPadding,innerPadding:w=l.innerPadding,cap:v=l.cap,forceShowCap:x=l.forceShowCap}=t.attribute;let{outerRadius:_=l.outerRadius,innerRadius:S=l.innerRadius}=t.attribute;_+=C,S-=w;let A=0;const T=(rt(v)&&v||v[0])&&"conical"===h.gradient;if(T){const{sc:e,startAngle:i,endAngle:r}=t.getParsedAngle();he(r-i)<le-oe&&(A=e||0,h.startAngle-=A,h.endAngle-=A)}let R=!1;const{isFullStroke:B,stroke:M}=(t=>{var e;let i=!0;if(rt(t,!0)){for(let r=0;r<4;r++)vn[r]=t,i&&(i=!(null!==(e=vn[r])&&void 0!==e&&!e));i=t}else if(Array.isArray(t))for(let e=0;e<4;e++)vn[e]=!!t[e],i&&(i=!!vn[e]);else vn[0]=!1,vn[1]=!1,vn[2]=!1,vn[3]=!1;return{isFullStroke:i,stroke:vn}})(c);if((b||B)&&(e.beginPath(),Al(t,e,i,r,_,S),R=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,b,y,f,m,l,o,s,a),g?(this._runStroke(t,e,i,r,l,y,B,m,a),this._runFill(t,e,i,r,l,b,f,d,u,s)):(this._runFill(t,e,i,r,l,b,f,d,u,s),this._runStroke(t,e,i,r,l,y,B,m,a))),!B&&y&&(e.beginPath(),Al(t,e,i,r,_,S,M),R||this.beforeRenderStep(t,e,i,r,b,y,f,m,l,o,s,a),a?a(e,t.attribute,l):m&&(e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke())),(rt(v)&&v||v[1])&&x){const{startAngle:n,endAngle:h}=t.getParsedAngle();if(he(h-n)>=le-oe){e.beginPath();const n=Math.abs(_-S)/2/_,{endAngle:h=l.endAngle,fill:c=l.fill}=t.attribute,d=h;this.drawArcTailCapPath(t,e,i,r,_,S,d,d+n),R||this.beforeRenderStep(t,e,i,r,b,y,f,m,l,o,s,a);const u=()=>{if(b){const o=c;if("conical"===o.gradient){const n=function(t,e,i,r){const{stops:o,startAngle:n,endAngle:s}=r;for(;i<0;)i+=le;for(;i>le;)i-=le;if(i<n)return o[0].color;if(i>s)return o[0].color;let a,l,h=(i-n)/(s-n);for(let t=0;t<o.length;t++)if(o[t].offset>=h){a=o[t-1],l=o[t];break}return h=(h-a.offset)/(l.offset-a.offset),Oa(a.color,l.color,h,!1)}(0,0,h,o);s||Cl&&(e.setCommonStyle(t,t.attribute,i,r,l),e.fillStyle=n,e.fill())}}},g=()=>{y&&(a||m&&(e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke()))};u(),g()}}this.afterRenderStep(t,e,i,r,b,y,f,m,l,o,s,a),T&&(h.startAngle+=A,h.endAngle+=A)}_runFill(t,e,i,r,o,n,s,a,l,h){n&&(h?h(e,t.attribute,o):s&&(e.setCommonStyle(t,t.attribute,a-i,l-r,o),e.fill()))}_runStroke(t,e,i,r,o,n,s,a,l){n&&s&&(l||a&&(e.setStrokeStyle(t,t.attribute,i,r,o),e.stroke()))}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).arc;this._draw(t,o,!1,i,r,o)}};wc=bc([f(),Cc(0,g(H)),Cc(0,m(Tl)),yc("design:paramtypes",[Object])],wc);var vc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},xc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_c=function(t,e){return function(i,r){e(i,r,t)}};let Sc=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=na,this.builtinContributions=[qh,Jh,Zh],this.init(t)}drawShape(t,e,i,r,o,n,s,a){const l=nn(t,null==n?void 0:n.theme).circle,{radius:h=l.radius,startAngle:c=l.startAngle,endAngle:d=l.endAngle,x:u=l.x,y:g=l.y,fillStrokeOrder:p=l.fillStrokeOrder}=t.attribute,f=this.valid(t,l,s,a);if(!f)return;const{fVisible:m,sVisible:b,doFill:y,doStroke:C}=f;e.beginPath(),e.arc(i,r,h,c,d),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,y,C,m,b,l,o,s,a);const w=()=>{y&&(s?s(e,t.attribute,l):m&&(e.setCommonStyle(t,t.attribute,u-i,g-r,l),e.fill()))},v=()=>{C&&(a?a(e,t.attribute,l):b&&(e.setStrokeStyle(t,t.attribute,u-i,g-r,l),e.stroke()))};p?(v(),w()):(w(),v()),this.afterRenderStep(t,e,i,r,y,C,m,b,l,o,s,a)}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).circle;this._draw(t,o,!1,i,r)}};function Ac(t,e,i,r){if(!e.p1)return;const{offsetX:o=0,offsetY:n=0,offsetZ:s=0}=r||{};if(1===i)e.p2&&e.p3?t.bezierCurveTo(o+e.p1.x,n+e.p1.y,o+e.p2.x,n+e.p2.y,o+e.p3.x,n+e.p3.y,s):t.lineTo(o+e.p1.x,n+e.p1.y,s);else if(e.p2&&e.p3){const[r]=Fi(e,i);t.bezierCurveTo(o+r.p1.x,n+r.p1.y,o+r.p2.x,n+r.p2.y,o+r.p3.x,n+r.p3.y,s)}else{const r=e.getPointAt(i);t.lineTo(o+r.x,n+r.y,s)}}function Tc(t,e,i,r,o,n,s){var a;let l=e.p0,h=r;if(i&&i.originP1===i.originP2&&(l=i.p0),e.defined)r||(t.lineTo(l.x+o,l.y+n,s),h=!r);else{const{originP1:c,originP2:d}=e;let u;if(c&&!1!==c.defined&&!i?u=l:c&&!1!==d.defined&&(u=null!==(a=e.p3)&&void 0!==a?a:e.p1),r){h=!r;const i=u?u.x:e.p0.x,a=u?u.y:e.p0.y;t.moveTo(i+o,a+n,s)}else u&&(h=!r,t.lineTo(u.x+o,u.y+n,s))}return h}function Rc(t,e,i,r,o){const{offsetX:n=0,offsetY:s=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=o||{};if(h&&"none"===l)return;if(!e)return;let c=!0;const{curves:d}=e;if(i>=1){if(h){let e,i=!0;d.forEach(((r,o)=>{r.originP1!==r.originP2?(i=Tc(t,r,e,i,n,s,a),e=r):e=r}))}else d.forEach((e=>{e.defined?(c&&t.moveTo(e.p0.x+n,e.p0.y+s,a),Ac(t,e,1,o),c=!1):c=!0}));return}if(i<=0)return;let u;"x"===r?u=vi.ROW:"y"===r?u=vi.COLUMN:"auto"===r&&(u=e.direction);const g=i*e.tryUpdateLength(u);let p=0,f=!0,m=null;for(let e=0,i=d.length;e<i;e++){const i=d[e],r=i.getLength(u),l=(g-p)/r;if(p+=r,l<0)break;if(h){if(i.originP1===i.originP2){m=i;continue}f=Tc(t,i,m,f,n,s,a),m=i}else{if(!i.defined){c=!0;continue}c&&t.moveTo(i.p0.x+n,i.p0.y+s,a),Ac(t,i,ge(l,1),o),c=!1}}}Sc=vc([f(),_c(0,g(H)),_c(0,m(Bl)),xc("design:paramtypes",[Object])],Sc);var Bc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Mc=class extends mc{constructor(){super(...arguments),this.numberType=la}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).line;this._draw(t,o,!1,i,r)}drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){var f;if(!e)return;t.beginPath();Rc(t,e,l,h,{offsetX:c,offsetY:d,offsetZ:null!==(f=this.z)&&void 0!==f?f:0}),u.cache&&!ut(u.cache)&&u.cache.curves.every((t=>t.defined))&&u.attribute.curveType&&u.attribute.curveType.includes("Closed")&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:m=0,x:b=0}=s;return!1!==i&&(g?g(t,s,a):o&&(t.setCommonStyle(u,s,m-c,b-d,a),t.fill())),!1!==r&&(p?p(t,s,a):n&&(t.setStrokeStyle(u,s,m-c,b-d,a),t.stroke())),!1}drawLinearLineHighPerformance(t,e,i,r,o,n,s,a,l,h,c,d,u){var g;e.beginPath();const p=null!==(g=this.z)&&void 0!==g?g:0,{points:f}=t.attribute,m=f[0];e.moveTo(m.x+s,m.y+a,p);for(let t=1;t<f.length;t++){const i=f[t];e.lineTo(i.x+s,i.y+a,p)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const{x:b=0,x:y=0}=t.attribute;!1!==i&&(d?d(e,t.attribute,l):o&&(e.setCommonStyle(t,t.attribute,b-s,y-a,l),e.fill())),!1!==r&&(u?u(e,t.attribute,l):n&&(e.setStrokeStyle(t,t.attribute,b-s,y-a,l),e.stroke()))}drawShape(t,e,i,r,o,n,s,a){const l=nn(t,null==n?void 0:n.theme).line,{fill:h=l.fill,stroke:c=l.stroke,fillOpacity:d=l.fillOpacity,strokeOpacity:u=l.strokeOpacity,segments:g,points:p,closePath:f,curveTension:m=l.curveTension,connectedType:b=l.connectedType}=t.attribute;if(!this.valid(t,l,s,a))return;let{curveType:y=l.curveType}=t.attribute;f&&"linear"===y&&(y="linearClosed");const{clipRange:C=l.clipRange,clipRangeByDimension:w=l.clipRangeByDimension}=t.attribute;if(1===C&&!g&&!p.some((t=>!1===t.defined))&&"linear"===y)return this.drawLinearLineHighPerformance(t,e,!!h,!!c,d,u,i,r,l,o,n,s,a);function v(t,e){return"none"===e?t:t.filter((t=>!1!==t.defined))}if(t.shouldUpdateShape()){const{points:e,segments:i}=t.attribute,r=e;if(i&&i.length){let e,r;if(t.cache=i.map(((t,i)=>{if(t.points.length<=1&&0===i)return t.points[0]&&(r={endX:t.points[0].x,endY:t.points[0].y,curves:[{defined:!1!==t.points[0].defined}]}),null;1===i?e={x:r.endX,y:r.endY,defined:r.curves[r.curves.length-1].defined}:i>1&&(e.x=r.endX,e.y=r.endY,e.defined=r.curves[r.curves.length-1].defined);const o=gr(v(t.points,b),y,{startPoint:e,curveTension:m});return r=o,o})).filter((t=>!!t)),"linearClosed"===y){let e;for(let i=0;i<t.cache.length;i++){const r=t.cache[i];for(let t=0;t<r.curves.length;t++)if(r.curves[t].defined){e=r.curves[t].p0;break}if(e)break}t.cache[t.cache.length-1]&&t.cache[t.cache.length-1].lineTo(e.x,e.y,!0)}}else{if(!e||!e.length)return t.cache=null,void t.clearUpdateShapeTag();t.cache=gr(v(r,b),y,{curveTension:m})}t.clearUpdateShapeTag()}if(Array.isArray(t.cache)){const o=t.attribute.segments.filter((t=>t.points.length));if(1===o[0].points.length&&o.shift(),1===C){let n=!1;t.cache.forEach(((g,p)=>{n||(n=this.drawSegmentItem(e,g,!!h,!!c,d,u,o[p],[l,t.attribute],C,w,i,r,t,s,a))}))}else{const n=t.cache.reduce(((t,e)=>t+e.getLength()),0),g=C*n;let p=0,f=!1;t.cache.forEach(((n,m)=>{if(f)return;const b=n.getLength(),y=(g-p)/b;p+=b,y>0&&(f=this.drawSegmentItem(e,n,!!h,!!c,d,u,o[m],[l,t.attribute],ge(y,1),w,i,r,t,s,a))}))}}else this.drawSegmentItem(e,t.cache,!!h,!!c,d,u,t.attribute,l,C,w,i,r,t,s,a)}};function Pc(t,e,i,r){const{offsetX:o=0,offsetY:n=0,offsetZ:s=0}=r||{};let a=!0;e.forEach((e=>{e.defined?(a&&t.moveTo(e.p0.x+o,e.p0.y+n,s),Ac(t,e,1,r),a=!1):a=!0})),a=!0;for(let e=i.length-1;e>=0;e--){const l=i[e];l.defined?(a&&t.lineTo(l.p0.x+o,l.p0.y+n,s),Ac(t,l,1,r),a=!1):a=!0}t.closePath()}Mc=Bc([f()],Mc);const Hc=new class extends Uh{constructor(){super(...arguments),this.time=_i.afterFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){var g,p,f,m;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:b=t.attribute}=u||{},{texture:y=(null!==(g=t.attribute.texture)&&void 0!==g?g:Mn(l,"texture")),textureColor:C=(null!==(p=t.attribute.textureColor)&&void 0!==p?p:Mn(l,"textureColor")),textureSize:w=(null!==(f=t.attribute.textureSize)&&void 0!==f?f:Mn(l,"textureSize")),texturePadding:v=(null!==(m=t.attribute.texturePadding)&&void 0!==m?m:Mn(l,"texturePadding"))}=b;y&&this.drawTexture(y,t,e,i,r,l,C,w,v)}},kc=Nh;var Ec=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Fc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lc=function(t,e){return function(i,r){e(i,r,t)}};let Ic=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=oa,this.builtinContributions=[Hc,kc],this.init(t)}drawLinearAreaHighPerformance(t,e,i,r,o,n,s,a,l,h,c,d,u){var g,p,f;const{points:m}=t.attribute;if(m.length<2)return;e.beginPath();const b=null!==(g=this.z)&&void 0!==g?g:0,y=m[0];e.moveTo(y.x+s,y.y+a,b);for(let t=1;t<m.length;t++){const i=m[t];e.lineTo(i.x+s,i.y+a,b)}for(let t=m.length-1;t>=0;t--){const i=m[t];e.lineTo((null!==(p=i.x1)&&void 0!==p?p:i.x)+s,(null!==(f=i.y1)&&void 0!==f?f:i.y)+a,b)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,s,a,!!o,!1,i,!1,l,h,d,null,{attribute:t.attribute});const{x:C=0,x:w=0}=t.attribute;!1!==i&&(d?d(e,t.attribute,l):o&&(e.setCommonStyle(t,t.attribute,C-s,w-a,l),e.fill())),this.afterRenderStep(t,e,s,a,!!o,!1,i,!1,l,h,d,null,{attribute:t.attribute}),(()=>{var i,o;if(r){const{stroke:r=l&&l.stroke}=t.attribute;if(ut(r)&&(r[0]||r[2])&&!1===r[1])if(e.beginPath(),r[0]){e.moveTo(y.x+s,y.y+a,b);for(let t=1;t<m.length;t++){const i=m[t];e.lineTo(i.x+s,i.y+a,b)}}else if(r[2]){const t=m[m.length-1];e.moveTo(t.x+s,t.y+a,b);for(let t=m.length-2;t>=0;t--){const r=m[t];e.lineTo((null!==(i=r.x1)&&void 0!==i?i:r.x)+s,(null!==(o=r.y1)&&void 0!==o?o:r.y)+a,b)}}u?u(e,t.attribute,l):(e.setStrokeStyle(t,t.attribute,C-s,w-a,l),e.stroke())}})()}drawShape(t,e,i,r,o,n,s,a){var l,h,c,d,u,g;const p=nn(t,null==n?void 0:n.theme).area,{fill:f=p.fill,stroke:m=p.stroke,fillOpacity:b=p.fillOpacity,z:y=p.z,strokeOpacity:C=p.strokeOpacity,curveTension:w=p.curveTension,connectedType:v=p.connectedType}=t.attribute,x=this.valid(t,p,s,a);if(!x)return;const{doFill:_}=x,S=x.doStroke&&x.sVisible,{clipRange:A=p.clipRange,closePath:T,points:R,segments:B}=t.attribute;let{curveType:M=p.curveType}=t.attribute;function P(t,e){return"connect"!==e?t:t.filter((t=>!1!==t.defined))}if(T&&"linear"===M&&(M="linearClosed"),1===A&&!B&&!R.some((t=>!1===t.defined))&&"linear"===M)return this.drawLinearAreaHighPerformance(t,e,!!f,S,b,C,i,r,p,o,n,s,a);if(t.shouldUpdateShape()){if(B&&B.length){let e,i;const r=B.map(((t,r)=>{if(t.points.length<=1&&0===r)return t.points[0]&&(i={endX:t.points[0].x,endY:t.points[0].y}),null;1===r?e={x:i.endX,y:i.endY}:r>1&&(e.x=i.endX,e.y=i.endY);const o=gr(P(t.points,v),M,{startPoint:e,curveTension:w});return i=o,o})).filter((t=>!!t));let o;const n=[];for(let t=B.length-1;t>=0;t--){const e=B[t].points,i=[];for(let t=e.length-1;t>=0;t--)i.push({x:null!==(l=e[t].x1)&&void 0!==l?l:e[t].x,y:null!==(h=e[t].y1)&&void 0!==h?h:e[t].y});if(0!==t){const e=B[t-1].points,r=e[e.length-1];r&&i.push({x:null!==(c=r.x1)&&void 0!==c?c:r.x,y:null!==(d=r.y1)&&void 0!==d?d:r.y})}i.length>1&&(o=gr(P(i,v),"stepBefore"===M?"stepAfter":"stepAfter"===M?"stepBefore":M,{curveTension:w}),n.unshift(o))}t.cacheArea=n.map(((t,e)=>({top:r[e],bottom:t})))}else{if(!R||!R.length)return t.cacheArea=null,void t.clearUpdateShapeTag();{const e=P(R,v),i=[];for(let t=e.length-1;t>=0;t--)i.push({x:null!==(u=e[t].x1)&&void 0!==u?u:e[t].x,y:null!==(g=e[t].y1)&&void 0!==g?g:e[t].y});const r=gr(e,M,{curveTension:w}),o=gr(i,"stepBefore"===M?"stepAfter":"stepAfter"===M?"stepBefore":M,{curveTension:w});t.cacheArea={top:r,bottom:o}}}t.clearUpdateShapeTag()}if(Array.isArray(t.cacheArea)){const n=t.attribute.segments.filter((t=>t.points.length));if(1===n[0].points.length&&n.shift(),1===A){let l=!1;t.cacheArea.forEach(((h,c)=>{l||(l=this.drawSegmentItem(e,h,_,b,S,C,n[c],[p,t.attribute],A,i,r,y,t,o,s,a))}))}else{const l=t.cacheArea.reduce(((t,e)=>t+e.top.getLength()),0),h=A*l;let c=0,d=!1;t.cacheArea.forEach(((l,u)=>{if(d)return;const g=l.top.getLength(),f=(h-c)/g;c+=g,f>0&&(d=this.drawSegmentItem(e,l,_,b,S,C,n[u],[p,t.attribute],ge(f,1),i,r,y,t,o,s,a))}))}}else this.drawSegmentItem(e,t.cacheArea,_,b,S,C,t.attribute,p,A,i,r,y,t,o,s,a)}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).area;this._draw(t,o,!1,i,r)}drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f){return this._drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f)}_drawSegmentItem(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f){if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;t.beginPath();const{points:m,segments:b}=u.attribute;let y,C,w=vi.ROW;if(b){const t=b[b.length-1];C=b[0].points[0],y=t.points[t.points.length-1]}else C=m[0],y=m[m.length-1];const v=he(y.x-C.x),x=he(y.y-C.y);w=null==y.x1?vi.ROW:null==y.y1?vi.COLUMN:Number.isFinite(v+x)?v>x?vi.ROW:vi.COLUMN:vi.ROW,function(t,e,i,r){var o;const{top:n,bottom:s}=e;if(n.curves.length!==s.curves.length)return;if(i>=1){const e=[],i=[];let o=!0;for(let a=0,l=n.curves.length;a<l;a++){const h=n.curves[a];o!==h.defined?(o?(Pc(t,e,i,r),e.length=0,i.length=0):(e.push(h),i.push(s.curves[l-a-1])),o=!o):o&&(e.push(h),i.push(s.curves[l-a-1]))}return void Pc(t,e,i,r)}if(i<=0)return;let{direction:a}=r||{};const{curves:l}=n,h=null!==(o=l[l.length-1].p3)&&void 0!==o?o:l[l.length-1].p1,c=he(h.x-l[0].p0.x),d=he(h.y-l[0].p0.y);a=null!=a?a:c>d?vi.ROW:vi.COLUMN,Number.isFinite(c)||(a=vi.COLUMN),Number.isFinite(d)||(a=vi.ROW);const u=i*(a===vi.ROW?c:d);let g=0,p=!0;const f=[],m=[];for(let e=0,i=n.curves.length;e<i;e++){const o=n.curves[e],l=o.getLength(a),h=(u-g)/l;if(h<0)break;g+=l;let c=null,d=null;p!==o.defined?(p?(Pc(t,f,m,r),f.length=0,m.length=0):(c=o,d=s.curves[i-e-1]),p=!p):p&&(c=o,d=s.curves[i-e-1]),c&&d&&(h<1&&(c=c.p2&&c.p3?Fi(c,h)[0]:Ii(c,h)[0],d=d.p2&&d.p3?Fi(d,1-h)[1]:Ii(d,1-h)[1]),c.defined=p,d.defined=p,f.push(c),m.push(d)),c=null,d=null}Pc(t,f,m,r)}(t,e,l,{offsetX:h,offsetY:c,offsetZ:d,direction:w}),this.beforeRenderStep(u,t,h,c,!!r,!1,i,!1,a,g,p,null,{attribute:s}),t.setShadowBlendStyle&&t.setShadowBlendStyle(u,s,a);const{x:_=0,x:S=0}=s;return!1!==i&&(p?p(t,s,a):r&&(t.setCommonStyle(u,s,_-h,S-c,a),t.fill())),this.afterRenderStep(u,t,h,c,!!r,!1,i,!1,a,g,p,null,{attribute:s}),(()=>{if(!1!==o)if(f)f(t,s,a);else{const{stroke:i=a&&a[1]&&a[1].stroke}=s;ut(i)&&(i[0]||i[2])&&!1===i[1]&&(t.beginPath(),Rc(t,i[0]?e.top:e.bottom,l,w===vi.ROW?"x":"y",{offsetX:h,offsetY:c,offsetZ:d})),t.setStrokeStyle(u,s,_-h,S-c,a),t.stroke()}})(),!1}};Ic=Ec([f(),Lc(0,g(H)),Lc(0,m(Rl)),Fc("design:paramtypes",[Object])],Ic);const zc=Kh,Oc=Nh;var Dc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Wc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Nc=function(t,e){return function(i,r){e(i,r,t)}};let Gc=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ha,this.builtinContributions=[Oc,zc],this.init(t)}drawShape(t,e,i,r,o,n,s,a){var l,h,c;const d=null!==(l=this.tempTheme)&&void 0!==l?l:nn(t,null==n?void 0:n.theme).path,{x:u=d.x,y:g=d.y,fillStrokeOrder:p=d.fillStrokeOrder}=t.attribute,f=null!==(h=this.z)&&void 0!==h?h:0,m=this.valid(t,d,s,a);if(!m)return;const{fVisible:b,sVisible:y,doFill:C,doStroke:w}=m;if(e.beginPath(),t.pathShape)Ri(t.pathShape.commandList,e,i,r,1,1,f);else{Ri((null!==(c=t.attribute.path)&&void 0!==c?c:d.path).commandList,e,i,r,1,1,f)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,d),this.beforeRenderStep(t,e,i,r,C,w,b,y,d,o,s,a);const v=()=>{w&&(a?a(e,t.attribute,d):y&&(e.setStrokeStyle(t,t.attribute,u-i,g-r,d),e.stroke()))},x=()=>{C&&(s?s(e,t.attribute,d):b&&(e.setCommonStyle(t,t.attribute,u-i,g-r,d),e.fill()))};p?(v(),x()):(x(),v()),this.afterRenderStep(t,e,i,r,C,w,b,y,d,o,s,a)}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).path;this.tempTheme=o,this._draw(t,o,!1,i,r),this.tempTheme=null}};Gc=Dc([f(),Nc(0,g(H)),Nc(0,m(Hl)),Wc("design:paramtypes",[Object])],Gc);var jc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Vc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Uc=function(t,e){return function(i,r){e(i,r,t)}};let Kc=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.type="rect",this.numberType=da,this.builtinContributions=[sc,lc,ac],this.init(t)}drawShape(t,e,i,r,o,n,s,a,l){l=null!=l?l:nn(t,null==n?void 0:n.theme).rect;const{fill:h=l.fill,background:c,stroke:d=l.stroke,cornerRadius:u=l.cornerRadius,cornerType:g=l.cornerType,opacity:p=l.opacity,fillOpacity:f=l.fillOpacity,lineWidth:m=l.lineWidth,strokeOpacity:b=l.strokeOpacity,visible:y=l.visible,x1:C,y1:w,x:v=l.x,y:x=l.y,fillStrokeOrder:_=l.fillStrokeOrder}=t.attribute;let{width:S,height:A}=t.attribute;S=(null!=S?S:C-v)||0,A=(null!=A?A:w-x)||0;const T=wl(p,f,S,A,h),R=xl(p,b,S,A),B=bl(h,c),M=yl(d,m);if(!t.valid||!y)return;if(!B&&!M)return;if(!(T||R||s||a||c))return;0===u||ut(u)&&u.every((t=>0===t))?(e.beginPath(),e.rect(i,r,S,A)):(e.beginPath(),ec(e,i,r,S,A,u,"bevel"!==g));const P={doFill:B,doStroke:M};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,B,M,T,R,l,o,s,a,P),_?(this._runStroke(t,e,i,r,l,P,R,v,x,a),this._runFill(t,e,i,r,l,P,T,v,x,s)):(this._runFill(t,e,i,r,l,P,T,v,x,s),this._runStroke(t,e,i,r,l,P,R,v,x,a)),this.afterRenderStep(t,e,i,r,B,M,T,R,l,o,s,a)}_runFill(t,e,i,r,o,n,s,a,l,h){n.doFill&&(h?h(e,t.attribute,o):s&&(e.setCommonStyle(t,t.attribute,a-i,l-r,o),e.fill()))}_runStroke(t,e,i,r,o,n,s,a,l,h){n.doStroke&&(h?h(e,t.attribute,o):s&&(e.setStrokeStyle(t,t.attribute,a-i,l-r,o),e.stroke()))}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).rect;this._draw(t,o,!1,i,r,o)}};Kc=jc([f(),Uc(0,g(H)),Uc(0,m(El)),Vc("design:paramtypes",[Object])],Kc);var $c=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Xc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yc=function(t,e){return function(i,r){e(i,r,t)}};let qc=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ga,this.builtinContributions=[dc,pc,gc,uc],this.init(t)}drawShape(t,e,i,r,o,n,s,a,l){var h;l=null!=l?l:nn(t,null==n?void 0:n.theme).symbol;const{size:c=l.size,x:d=l.x,y:u=l.y,scaleX:g=l.scaleX,scaleY:p=l.scaleY,fillStrokeOrder:f=l.fillStrokeOrder,clipRange:m=l.clipRange}=t.attribute,b=this.valid(t,l,s,a);if(!b)return;const{fVisible:y,sVisible:C,doFill:w,doStroke:v}=b,x=t.getParsedPath();if(!x)return;const{keepDirIn3d:_=l.keepDirIn3d}=t.attribute,S=null!==(h=this.z)&&void 0!==h?h:0;e.beginPath();let A=i,T=r,R=S;const B=e.camera;if(_&&B&&e.project){const t=e.project(i,r,S);e.camera=null,ut(c)&&(c[0],c[1]),A=t.x,T=t.y,R=void 0}!1===x.draw(e,c,A,T,R,((o,n)=>{var h,c,b,y;if(t._parsedPath.svgCache){const e=Object.assign({},n);e.fill=null!==(h=n.fill)&&void 0!==h?h:t.attribute.fill,e.opacity=null!==(c=n.opacity)&&void 0!==c?c:t.attribute.opacity,e.fillOpacity=t.attribute.fillOpacity,e.stroke=null!==(b=n.stroke)&&void 0!==b?b:t.attribute.stroke,e.lineWidth=null!==(y=n.lineWidth)&&void 0!==y?y:t.attribute.lineWidth,n=e}const w=()=>{n.fill&&(s?s(e,t.attribute,l):(e.setCommonStyle(t,n,d-i,u-r,l),e.fill()))},v=()=>{n.stroke&&(a?a(e,t.attribute,l):C&&m>=1&&(e.setStrokeStyle(t,n,(d-i)/g,(u-r)/p,l),e.stroke()))};f?(v(),w()):(w(),v())}))&&e.closePath(),e.camera=B,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,w,v,y,C,l,o,s,a),f?(this._runStroke(t,e,i,r,l,v,C,d,u,x,m,g,p,a),this._runFill(t,e,i,r,l,w,y,d,u,x,s)):(this._runFill(t,e,i,r,l,w,y,d,u,x,s),this._runStroke(t,e,i,r,l,v,C,d,u,x,m,g,p,a)),this.afterRenderStep(t,e,i,r,w,v,y,C,l,o,s,a)}_runFill(t,e,i,r,o,n,s,a,l,h,c){n&&!h.isSvg&&(c?c(e,t.attribute,o):s&&(e.setCommonStyle(t,t.attribute,a-i,l-r,o),e.fill()))}_runStroke(t,e,i,r,o,n,s,a,l,h,c,d,u,g){n&&!h.isSvg&&(g?g(e,t.attribute,o):s&&c>=1&&(e.setStrokeStyle(t,t.attribute,(a-i)/d,(l-r)/u,o),e.stroke()))}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).symbol;this._draw(t,o,!1,i,r)}};qc=$c([f(),Yc(0,g(H)),Yc(0,m(Fl)),Xc("design:paramtypes",[Object])],qc);const Zc=new class{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new Ge)}allocate(t,e,i,r){if(!this.pools.length)return(new Ge).setValue(t,e,i,r);const o=this.pools.pop();return o.x1=t,o.y1=e,o.x2=i,o.y2=r,o}allocateByObj(t){if(!this.pools.length)return new Ge(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}};const Jc=new class extends Wh{constructor(){super(...arguments),this.time=_i.beforeFillStroke}drawShape(t,e,i,r,o,n,s,a,l,h,c,d){var u,g,p,f,m,b,y,C,w,v;const{backgroundMode:x=l.backgroundMode,backgroundFit:_=l.backgroundFit,backgroundKeepAspectRatio:S=l.backgroundKeepAspectRatio}=t.attribute;let A,{background:T}=t.attribute;if(!T)return;const R=()=>{"richtext"===t.type&&(e.restore(),e.save(),A&&e.setTransformFromMatrix(A,!0,1))};let B;"richtext"===t.type&&(A=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const M=at(T)&&T.background,P=t.transMatrix.onlyTranslate();if(M){const e=t.AABBBounds,i=(null!==(u=T.x)&&void 0!==u?u:e.x1)+(null!==(g=T.dx)&&void 0!==g?g:0),r=(null!==(p=T.y)&&void 0!==p?p:e.y1)+(null!==(f=T.dy)&&void 0!==f?f:0),o=null!==(m=T.width)&&void 0!==m?m:e.width(),n=null!==(b=T.height)&&void 0!==b?b:e.height();if(B=Zc.allocate(i,r,i+o,r+n),T=T.background,!P){const t=B.width(),e=B.height();B.set((null!==(y=T.x)&&void 0!==y?y:0)+(null!==(C=T.dx)&&void 0!==C?C:0),(null!==(w=T.y)&&void 0!==w?w:0)+(null!==(v=T.dy)&&void 0!==v?v:0),t,e)}}else B=t.AABBBounds,P||(B=Ih(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const o=t.resources.get(T);if("success"!==o.state||!o.data)return void R();e.highPerformanceSave(),P&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,r,l),this.doDrawImage(e,o.data,B,{backgroundMode:x,backgroundFit:_,backgroundKeepAspectRatio:S}),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:o}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,l),e.fillStyle=T,o?(ec(e,B.x1,B.y1,B.width(),B.height(),o,!0),e.fill()):e.fillRect(B.x1,B.y1,B.width(),B.height()),e.highPerformanceRestore()}M&&Zc.free(B),R()}};var Qc=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},td=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ed=function(t,e){return function(i,r){e(i,r,t)}};let id=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=pa,this.builtinContributions=[Jc],this.init(t)}drawShape(t,e,i,r,o,n,s,a){var l,h,c;const d=nn(t,null==n?void 0:n.theme).text,{text:u,underline:g=d.underline,lineThrough:p=d.lineThrough,keepDirIn3d:f=d.keepDirIn3d,direction:m=d.direction,fontSize:b=d.fontSize,verticalMode:y=d.verticalMode,x:C=d.x,y:w=d.y}=t.attribute,v=null!==(l=kn(t.attribute.lineHeight,b))&&void 0!==l?l:b,x=this.valid(t,d,s,a);if(!x)return;const{fVisible:_,sVisible:S,doFill:A,doStroke:T}=x,R=!f,B=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,d),this.beforeRenderStep(t,e,i,r,A,T,_,S,d,o,s,a),R&&this.transformUseContext2d(t,d,B,e);const M=(o,n,l,h)=>{let c=i+n;const u=r+l;if(h){e.highPerformanceSave(),c+=b;const t=Ta.allocate(1,0,0,1,0,0);t.rotateByCenter(Math.PI/2,c,u),e.transformFromMatrix(t,!0),Ta.free(t)}T&&(a?a(e,t.attribute,d):S&&(e.setStrokeStyle(t,t.attribute,C-i,w-r,d),e.strokeText(o,c,u,B))),A&&(s?s(e,t.attribute,d):_&&(e.setCommonStyle(t,t.attribute,C-i,w-r,d),e.fillText(o,c,u,B))),h&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(e.setTextStyleWithoutAlignBaseline(t.attribute,d,B),"horizontal"===m){const{multilineLayout:o}=t;if(!o)return void e.highPerformanceRestore();const{xOffset:n,yOffset:l}=o.bbox;T&&(a?a(e,t.attribute,d):S&&(e.setStrokeStyle(t,t.attribute,C-i,w-r,d),o.lines.forEach((t=>{e.strokeText(t.str,(t.leftOffset||0)+n+i,(t.topOffset||0)+l+r,B)})))),A&&(s?s(e,t.attribute,d):_&&(e.setCommonStyle(t,t.attribute,C-i,w-r,d),o.lines.forEach((o=>{e.fillText(o.str,(o.leftOffset||0)+n+i,(o.topOffset||0)+l+r,B),this.drawUnderLine(g,p,t,(o.leftOffset||0)+n+i,(o.topOffset||0)+l+r,o.descent,(o.descent-o.ascent)/2,B,d,e,{width:o.width})}))))}else{let{textAlign:i=d.textAlign,textBaseline:r=d.textBaseline}=t.attribute;if(!y){const e=i;i=null!==(h=t.getBaselineMapAlign()[r])&&void 0!==h?h:"left",r=null!==(c=t.getAlignMapBaseline()[e])&&void 0!==c?c:"top"}t.tryUpdateAABBBounds();const o=t.cache,{verticalList:n}=o;e.textAlign="left",e.textBaseline="top";const s=v*n.length;let a=0;n.forEach((t=>{const e=t.reduce(((t,e)=>t+(e.width||0)),0);a=ue(e,a)}));let l=0,u=0;"bottom"===r?u=-s:"middle"===r&&(u=-s/2),"center"===i?l-=a/2:"right"===i&&(l-=a),n.forEach(((t,e)=>{const r=t.reduce(((t,e)=>t+(e.width||0)),0),o=a-r;let n=l;"center"===i?n+=o/2:"right"===i&&(n+=o),t.forEach((t=>{const{text:i,width:r,direction:o}=t;M(i,s-(e+1)*v+u,n,o),n+=r}))}))}R&&this.restoreTransformUseContext2d(t,d,B,e),this.afterRenderStep(t,e,i,r,A,T,_,S,d,o,s,a)}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).text,{keepDirIn3d:n=o.keepDirIn3d}=t.attribute,s=!n;this._draw(t,o,s,i,r)}drawUnderLine(t,e,i,r,o,n,s,a,l,h,c){if(e+t<=0)return;const{textAlign:d=l.textAlign,fill:u=l.fill,opacity:g=l.opacity,underlineOffset:p=l.underlineOffset,underlineDash:f=l.underlineDash,fillOpacity:m=l.fillOpacity}=i.attribute,b=!nt(c),y=b?c.width:i.clipedWidth,C=b?0:zl(d,y),w={lineWidth:0,stroke:u,opacity:g,strokeOpacity:m};if(t){w.lineWidth=t,h.setStrokeStyle(i,w,r,o,l),f&&h.setLineDash(f),h.beginPath();const e=o+n+p;h.moveTo(r+C,e,a),h.lineTo(r+C+y,e,a),h.stroke()}if(e){w.lineWidth=e,h.setStrokeStyle(i,w,r,o,l),h.beginPath();const t=o+s;h.moveTo(r+C,t,a),h.lineTo(r+C+y,t,a),h.stroke()}}};function rd(t,e,i,r){if(e&&e.length){t.moveTo(e[0].x+i,e[0].y+r);for(let o=1;o<e.length;o++)t.lineTo(e[o].x+i,e[o].y+r)}}function od(t,e){return Math.sqrt(t*t+e*e)}function nd(t,e,i,r,o){const n=e/i;return{x:t.x-r*n,y:t.y-o*n}}id=Qc([f(),ed(0,g(H)),ed(0,m(Ll)),td("design:paramtypes",[Object])],id);const sd=Kh,ad=Nh;var ld=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},hd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cd=function(t,e){return function(i,r){e(i,r,t)}};let dd=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=ca,this.builtinContributions=[ad,sd],this.init(t)}drawShape(t,e,i,r,o,n,s,a){const l=nn(t,null==n?void 0:n.theme).polygon,{points:h=l.points,cornerRadius:c=l.cornerRadius,x:d=l.x,y:u=l.y,closePath:g=l.closePath,fillStrokeOrder:p=l.fillStrokeOrder}=t.attribute,f=this.valid(t,l,s,a);if(!f)return;const{fVisible:m,sVisible:b,doFill:y,doStroke:C}=f;e.beginPath(),c<=0||ut(c)&&c.every((t=>0===t))?rd(e.camera?e:e.nativeContext,h,i,r):function(t,e,i,r,o,n=!0){var s;if(e.length<3)return void rd(t,e,i,r);let a=0,l=e.length-1;n||(a+=1,l-=1,t.moveTo(e[0].x+i,e[0].y+r));for(let n=a;n<=l;n++){const a=e[0===n?l:(n-1)%e.length],h=e[n%e.length],c=e[(n+1)%e.length],d=h.x-a.x,u=h.y-a.y,g=h.x-c.x,p=h.y-c.y,f=(Math.atan2(u,d)-Math.atan2(p,g))/2,m=Math.abs(Math.tan(f));let b=Array.isArray(o)?null!==(s=o[n%e.length])&&void 0!==s?s:0:o,y=b/m;const C=od(d,u),w=od(g,p),v=Math.min(C,w);y>v&&(y=v,b=v*m);const x=nd(h,y,C,d,u),_=nd(h,y,w,g,p),S=2*h.x-x.x-_.x,A=2*h.y-x.y-_.y,T=od(S,A),R=nd(h,od(y,b),T,S,A);let B=Math.atan2(x.y-R.y,x.x-R.x);const M=Math.atan2(_.y-R.y,_.x-R.x);let P=M-B;P<0&&(B=M,P=-P),P>Math.PI&&(P-=Math.PI),0===n?t.moveTo(x.x+i,x.y+r):t.lineTo(x.x+i,x.y+r),P&&t.arcTo(h.x+i,h.y+r,_.x+i,_.y+r,b),t.lineTo(_.x+i,_.y+r)}n||t.lineTo(e[l+1].x+i,e[l+1].y+r)}(e.camera?e:e.nativeContext,h,i,r,c,g),g&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this.beforeRenderStep(t,e,i,r,y,C,m,b,l,o,s,a);const w=()=>{y&&(s?s(e,t.attribute,l):m&&(e.setCommonStyle(t,t.attribute,d-i,u-r,l),e.fill()))},v=()=>{C&&(a?a(e,t.attribute,l):b&&(e.setStrokeStyle(t,t.attribute,d-i,u-r,l),e.stroke()))};p?(v(),w()):(w(),v()),this.afterRenderStep(t,e,i,r,y,C,m,b,l,o,s,a)}draw(t,e,i,r){const o=nn(t,null==r?void 0:r.theme).polygon;this._draw(t,o,!1,i,r)}};dd=ld([f(),cd(0,g(H)),cd(0,m(kl)),hd("design:paramtypes",[Object])],dd);var ud=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},gd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pd=function(t,e){return function(i,r){e(i,r,t)}};let fd=class{constructor(t){this.groupRenderContribitions=t,this.numberType=sa}reInit(){this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Qh)}drawShape(t,e,i,r,o,n,s,a,l){const{clip:h,fill:c,stroke:d,background:u}=t.attribute;if(!(h||c||d||u))return;l=null!=l?l:nn(t,null==n?void 0:n.theme).group;const{opacity:g=l.opacity,width:p=l.width,height:f=l.height,fillOpacity:m=l.fillOpacity,strokeOpacity:b=l.strokeOpacity,cornerRadius:y=l.cornerRadius,path:C=l.path,lineWidth:w=l.lineWidth,visible:v=l.visible,fillStrokeOrder:x=l.fillStrokeOrder,cornerType:_=l.cornerType,x:S=l.x,y:A=l.y}=t.attribute,T=wl(g,m,p,f,c),R=xl(g,b,p,f),B=bl(c,u),M=yl(d,w);if(!t.valid||!v)return;if(!h){if(!B&&!M)return;if(!(T||R||s||a||u))return}if(C&&C.length&&o.drawContribution){const t=e.disableFill,i=e.disableStroke,r=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,C.forEach((t=>{o.drawContribution.getRenderContribution(t).draw(t,o.renderService,o,n)})),e.disableFill=t,e.disableStroke=i,e.disableBeginPath=r}else 0===y||ut(y)&&y.every((t=>0===t))?(e.beginPath(),e.rect(i,r,p,f)):(e.beginPath(),ec(e,i,r,p,f,y,"bevel"!==_));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(Qh));const P={doFill:B,doStroke:M};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l),this._groupRenderContribitions.forEach((n=>{n.time===_i.beforeFillStroke&&n.drawShape(t,e,i,r,B,M,T,R,l,o,s,a,P)})),h&&e.clip();const H=()=>{P.doFill&&(s?s(e,t.attribute,l):T&&(e.setCommonStyle(t,t.attribute,S-i,A-r,l),e.fill()))},k=()=>{P.doStroke&&(a?a(e,t.attribute,l):R&&(e.setStrokeStyle(t,t.attribute,S-i,A-r,l),e.stroke()))};x?(k(),H()):(H(),k()),this._groupRenderContribitions.forEach((n=>{n.time===_i.afterFillStroke&&n.drawShape(t,e,i,r,B,M,T,R,l,o,s,a)}))}draw(t,e,i,r){var o,n;const{context:s}=i;if(!s)return;const{clip:a,baseOpacity:l=1,drawMode:h}=t.attribute,c=s.nativeContext,d=s.canvas.nativeCanvas;if(h>0){const{x:e,y:i,width:r,height:o}=t.attribute,n=s.canvas,a=D.global.createCanvas({width:n.width,height:n.height,dpr:1}),l=a.getContext("2d"),c=s.nativeContext.getTransform();l.setTransform(c.a,c.b,c.c,c.d,c.e,c.f),1===h&&(l.save(),l.clearRect(0,0,n.width,n.height),l.beginPath(),l.rect(e,i,r,o),l.clip(),l.drawImage(n.nativeCanvas,0,0,n.width,n.height,0,0,n.displayWidth,n.displayHeight),l.restore()),s.nativeContext=l,n.nativeCanvas=a}a?s.save():s.highPerformanceSave();const u=s.baseGlobalAlpha;s.baseGlobalAlpha*=l;const g=s.modelMatrix;if(s.camera){const e=nn(t,null==r?void 0:r.theme).group,i=Ra.allocate(),o=Ra.allocate();Gl(o,t,e),_a(i,g||i,o),s.modelMatrix=i,Ra.free(o),s.setTransform(1,0,0,1,0,0,!0)}else s.transformFromMatrix(t.transMatrix,!0);s.beginPath(),r.skipDraw?this.drawShape(t,s,0,0,i,r,(()=>!1),(()=>!1)):this.drawShape(t,s,0,0,i,null,null,null);const{scrollX:p,scrollY:f}=t.attribute;let m;if((p||f)&&s.translate(p,f),r&&r.renderInGroup&&(m=r.renderInGroup(null===(o=r.renderInGroupParams)||void 0===o?void 0:o.skipSort,t,i,null===(n=r.renderInGroupParams)||void 0===n?void 0:n.nextM)),s.modelMatrix!==g&&Ra.free(s.modelMatrix),s.modelMatrix=g,s.baseGlobalAlpha=u,h>0){const{x:e,y:i,width:r,height:o}=t.attribute,n=s.nativeContext,a=s.canvas.nativeCanvas;c.save(),c.setTransform(s.dpr,0,0,s.dpr,0,0,!0),1===h&&n.rect(e,i,r,o),c.drawImage(a,0,0,a.width,a.height,0,0,s.canvas.displayWidth,s.canvas.displayHeight);const l=n.getTransform();c.setTransform(l.a,l.b,l.c,l.d,l.e,l.f),s.nativeContext=c,s.canvas.nativeCanvas=d,c.restore()}m&&m.then?m.then((()=>{a?s.restore():s.highPerformanceRestore()})):a?s.restore():s.highPerformanceRestore()}};fd=ud([f(),pd(0,g(H)),pd(0,m(Ml)),gd("design:paramtypes",[Object])],fd);var md=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},bd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},yd=function(t,e){return function(i,r){e(i,r,t)}};const Cd=["","repeat-x","repeat-y","repeat"];let wd=class extends mc{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=aa,this.builtinContributions=[hc,cc],this.init(t)}drawShape(t,e,i,r,o,n,s,a){const l=nn(t).image,{repeatX:h=l.repeatX,repeatY:c=l.repeatY,x:d=l.x,y:u=l.y,cornerRadius:g=l.cornerRadius,fillStrokeOrder:p=l.fillStrokeOrder,cornerType:f=l.cornerType,image:m}=t.attribute,b=this.valid(t,l,s);if(!b)return;const{fVisible:y,sVisible:C,doFill:w,doStroke:v}=b;if(!m||!t.resources)return;const x=t.resources.get(m);if("success"!==x.state)return;const _=t.width,S=t.height;e.beginPath();let A=!1;0===g||ut(g)&&g.every((t=>0===t))?e.rect(i,r,_,S):(ec(e,i,r,_,S,g,"bevel"!==f),A=!0),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,l);const T=()=>{if(w)if(s)s(e,t.attribute,l);else if(y){e.setCommonStyle(t,t.attribute,i,r,l);let o=0;if("repeat"===h&&(o|=1),"repeat"===c&&(o|=2),o){const t=e.createPattern(x.data,Cd[o]);e.fillStyle=t,e.translate(i,r,!0),e.fillRect(0,0,_,S),e.translate(-i,-r,!0)}else e.drawImage(x.data,i,r,_,S)}},R=()=>{v&&(a?a(e,t.attribute,l):C&&(e.setStrokeStyle(t,t.attribute,d-i,u-r,l),e.stroke()))};p?(R(),A&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,r,w,!1,y,!1,l,o,s),T(),A&&e.restore()):(A&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,r,w,!1,y,!1,l,o,s),T(),A&&e.restore(),R()),this.afterRenderStep(t,e,i,r,w,!1,y,!1,l,o,s)}draw(t,e,i){const{image:r}=t.attribute;if(!r||!t.resources)return;const o=t.resources.get(r);if("loading"===o.state&&dt(r))return void yn.improveImageLoading(r);if("success"!==o.state)return;const{context:n}=e.drawParams;if(!n)return;const s=nn(t).image;this._draw(t,s,!1,i)}};wd=md([f(),yd(0,g(H)),yd(0,m(Pl)),bd("design:paramtypes",[Object])],wd);const vd=Symbol.for("IncrementalDrawContribution"),xd=Symbol.for("ArcRender"),_d=Symbol.for("CircleRender"),Sd=Symbol.for("GraphicRender"),Ad=Symbol.for("GroupRender"),Td=Symbol.for("LineRender"),Rd=Symbol.for("PathRender"),Bd=Symbol.for("PolygonRender"),Md=Symbol.for("RectRender"),Pd=Symbol.for("SymbolRender"),Hd=Symbol.for("TextRender"),kd=Symbol.for("RichTextRender"),Ed=Symbol.for("ImageRender"),Fd=Symbol.for("DrawContribution"),Ld=(t,e,i,r)=>{let o,n=!1,s=!1;if(e.forEachChildren((t=>(n=t.numberType===ra,!n))),e.forEachChildren((t=>(s=!!t.findFace,!s))),n){const t=e.getChildren(),a=[...t];a.sort(((t,e)=>{var i,r,o,n;let s=(null!==(r=null!==(i=t.attribute.startAngle)&&void 0!==i?i:0+t.attribute.endAngle)&&void 0!==r?r:0)/2,a=(null!==(n=null!==(o=e.attribute.startAngle)&&void 0!==o?o:0+e.attribute.endAngle)&&void 0!==n?n:0)/2;for(;s<0;)s+=le;for(;a<0;)a+=le;return a-s})),a.forEach((t=>{t._next=null,t._prev=null})),e.removeAllChild(),e.update(),a.forEach((t=>{e.appendChild(t)})),r.hack_pieFace="outside",o=i(n,s),o&&o.graphic||(r.hack_pieFace="inside",o=i(n,s)),o&&o.graphic||(r.hack_pieFace="top",o=i(n,s)),e.removeAllChild(),t.forEach((t=>{t._next=null,t._prev=null})),t.forEach((t=>{e.appendChild(t)}))}else if(s){const r=e.getChildren(),a=r.map((e=>({ave_z:e.findFace().vertices.map((i=>{var r;return t.view(i[0],i[1],null!==(r=i[2]+e.attribute.z)&&void 0!==r?r:0)[2]})).reduce(((t,e)=>t+e),0),g:e})));a.sort(((t,e)=>e.ave_z-t.ave_z)),e.removeAllChild(),a.forEach((t=>{t.g._next=null,t.g._prev=null})),e.update(),a.forEach((t=>{e.add(t.g)})),o=i(n,s),e.removeAllChild(),r.forEach((t=>{t._next=null,t._prev=null})),e.update(),r.forEach((t=>{e.add(t)}))}else o=i(n,s);return o};var Id=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},zd=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const Od=Symbol.for("DrawItemInterceptor"),Dd=new Ge,Wd=new Ge;class Nd{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return null==t.attribute.shadowRootIdx&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,r,o),!1}beforeDrawItem(t,e,i,r,o){return null==t.attribute.shadowRootIdx&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.shadowRoot)return!1;const{context:n}=i;if(n.highPerformanceSave(),n.transformFromMatrix(t.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){Dd.copy(r.dirtyBounds),Wd.copy(r.backupDirtyBounds);const e=t.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(e),r.backupDirtyBounds.copy(r.dirtyBounds)}return r.renderGroup(t.shadowRoot,i,Ta.allocate(1,0,0,1,0,0)),n.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&(r.dirtyBounds.copy(Dd),r.backupDirtyBounds.copy(Wd)),!0}}class Gd{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.attribute._debug_bounds&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.attribute._debug_bounds)return!1;const{context:n}=i;n.highPerformanceSave(),t.parent&&n.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&n.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const s=t.AABBBounds;return!0!==t.attribute._debug_bounds&&t.attribute._debug_bounds(n,t),n.strokeRect(s.x1,s.y1,s.width(),s.height()),n.highPerformanceRestore(),!0}}let jd=class{constructor(){this.order=1,this.interceptors=[new Nd,new Ud,new Vd,new Gd]}afterDrawItem(t,e,i,r,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!t.attribute._debug_bounds&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].afterDrawItem&&this.interceptors[n].afterDrawItem(t,e,i,r,o))return!0;return!1}beforeDrawItem(t,e,i,r,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!t.attribute._debug_bounds&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].beforeDrawItem&&this.interceptors[n].beforeDrawItem(t,e,i,r,o))return!0;return!1}};jd=Id([f(),zd("design:paramtypes",[])],jd);class Vd{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,r,o):this.beforeSetInteractive(t,e,i,r,o))}beforeSetInteractive(t,e,i,r,o){let n=t.interactiveGraphic;if(t.attribute.globalZIndex){n||(n=t.clone(),t.interactiveGraphic=n,n.baseGraphic=t),n.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).add(n),!0}if(n){i.stage.tryInitInteractiveLayer();const e=i.stage.getLayer("_builtin_interactive");e&&this.getShadowRoot(e).removeChild(n),t.interactiveGraphic=null,n.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,r,o){const n=t.baseGraphic;let s=!!n.stage,a=n.parent;for(;s&&a&&a.stage!==a;)s=!!a.stage,a=a.parent;if(!s){const e=i.stage.getLayer("_builtin_interactive");return e&&this.getShadowRoot(e).removeChild(t),!0}if(n){this.processing=!0;const{context:t}=i;return t.highPerformanceSave(),t.setTransformFromMatrix(n.parent.globalTransMatrix,!0),n.isContainer?r.renderGroup(n,i,n.parent.globalTransMatrix):r.renderItem(n,i),t.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=Fh.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),null!==(e=i.shadowRoot)&&void 0!==e?e:i.attachShadow()}}class Ud{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:n,stage:s}=e.drawParams;n.canvas,n.save(),this.initCanvasCtx(n),n.camera=s.camera;const a=n.currentMatrix;a.a/=n.dpr,a.b/=n.dpr,a.c/=n.dpr,a.d/=n.dpr,a.e/=n.dpr,a.f/=n.dpr;const l=Ra.allocate();xa(l,a);const h=n.modelMatrix;if(h){if(l){const t=Ra.allocate();n.modelMatrix=_a(t,h,l)}}else n.modelMatrix=l;return n.setTransform(1,0,0,1,0,0,!0),t.isContainer?Ld(n,t,((e,o)=>r.renderGroup(t,i,t.parent.globalTransMatrix,!e&&o)),i):r.renderItem(t,i),n.camera=null,n.restore(),n.modelMatrix!==h&&Ra.free(n.modelMatrix),n.modelMatrix=h,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var Kd=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},$d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xd=function(t,e){return function(i,r){e(i,r,t)}};const Yd=Symbol.for("RenderService");let qd=class{constructor(t){this.drawContribution=t}prepare(t){t&&this.renderTreeRoots.forEach((e=>{this._prepare(e,t)}))}_prepare(t,e){t.forEachChildren((t=>{this._prepare(t,e)})),t.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(t){}draw(t){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(t){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}reInit(){this.drawContribution.reInit()}render(t,e){this.renderTreeRoots=t,this.drawParams=e;const i=e.updateBounds;this.prepare(i),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};qd=Kd([f(),Xd(0,g(Fd)),$d("design:paramtypes",[Object])],qd);var Zd=new i((t=>{t(Yd).to(qd)}));const Jd=Symbol.for("PickerService"),Qd=Symbol.for("GlobalPickerService"),tu=Symbol.for("PickItemInterceptor"),eu=Symbol.for("PickServiceInterceptor");var iu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let ru=class{constructor(){this.order=1}afterPickItem(t,e,i,r,o){if(t.graphic){let e=t.graphic;for(;e.parent;)e=e.parent;e.shadowHost&&(t.params={shadowTarget:t.graphic},t.graphic=e.shadowHost)}return t}};ru=iu([f()],ru);let ou=class{constructor(){this.order=1}afterPickItem(t,e,i,r,o){return t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx?this._pickItem(t,e,i,r,o):null}beforePickItem(t,e,i,r,o){return t.attribute.shadowRootIdx<0?this._pickItem(t,e,i,r,o):null}_pickItem(t,e,i,r,o){var n;if(!t.shadowRoot)return null;const{parentMatrix:s}=o||{};if(!s)return null;const a=e.pickContext;a.highPerformanceSave();const l=null===(n=nn(t))||void 0===n?void 0:n[t.type],{shadowPickMode:h=(null==l?void 0:l.shadowPickMode)}=t.attribute,c=t.shadowRoot,d=Ta.allocateByObj(s),u=new Ce(d.a*i.x+d.c*i.y+d.e,d.b*i.x+d.d*i.y+d.f),g=e.pickGroup(c,u,d,r);return a.highPerformanceRestore(),!g.graphic&&g.group&&"full"===h&&(g.graphic=g.group),g}};ou=iu([f()],ou);let nu=class{constructor(){this.order=1}beforePickItem(t,e,i,r,o){const n=t.baseGraphic;if(n&&n.parent){const t=new Ce(i.x,i.y),o=e.pickContext;o.highPerformanceSave();const s=n.parent.globalTransMatrix;s.transformPoint(t,t);const a=n.isContainer?e.pickGroup(n,t.clone(),s,r):e.pickItem(n,t.clone(),s,r);return o.highPerformanceRestore(),a}return null}};nu=iu([f()],nu);let su=class{constructor(){this.order=1}beforePickItem(t,e,i,r,o){if(!t.in3dMode||r.in3dInterceptor)return null;const n=e.pickContext,s=t.stage;if(!n||!s)return null;if(r.in3dInterceptor=!0,n.save(),this.initCanvasCtx(n),n.camera=s.camera,t.isContainer){const s=Ld(n,t,(()=>e.pickGroup(t,i,o.parentMatrix,r)),r);return n.camera=null,r.in3dInterceptor=!1,n.restore(),s}return n.restore(),null}initCanvasCtx(t){t.setTransformForCurrent()}};su=iu([f()],su);var au=new i(((t,e,i)=>{i(Jd)||(t(Qd).toSelf(),t(Jd).toService(Qd)),t(su).toSelf().inSingletonScope(),t(tu).toService(su),t(ou).toSelf().inSingletonScope(),t(tu).toService(ou),t(nu).toSelf().inSingletonScope(),t(tu).toService(nu),E(t,tu),t(ru).toSelf().inSingletonScope(),t(eu).toService(ru),E(t,eu)})),lu=new i((t=>{t(fa).to(jl),t(ma).toConstantValue(Fh)}));const hu=Symbol.for("AutoEnablePlugins"),cu=Symbol.for("PluginService");var du=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},uu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},gu=function(t,e){return function(i,r){e(i,r,t)}};let pu=class{constructor(t){this.autoEnablePlugins=t,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(t,e){this.stage=t,this.actived=!0;const{pluginList:i}=e;i&&so.isBound(hu)&&this.autoEnablePlugins.getContributions().forEach((t=>{i.includes(t.name)&&this.register(t)}))}findPluginsByName(t){const e=[];return this.onStartupFinishedPlugin.forEach((i=>{i.name===t&&e.push(i)})),this.onRegisterPlugin.forEach((i=>{i.name===t&&e.push(i)})),e}register(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.push(t):"onRegister"===t.activeEvent&&(this.onRegisterPlugin.push(t),t.activate(this))}unRegister(t){"onStartupFinished"===t.activeEvent?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1):"onRegister"===t.activeEvent&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1),t.deactivate(this)}release(...t){this.onStartupFinishedPlugin.forEach((t=>{t.deactivate(this)})),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach((t=>{t.deactivate(this)})),this.onRegisterPlugin=[]}};pu=du([f(),gu(0,g(H)),gu(0,m(hu)),uu("design:paramtypes",[Object])],pu);var fu=new i((t=>{t(cu).to(pu),function(t,e){t(H).toDynamicValue((({container:t})=>new k(e,t))).whenTargetNamed(e)}(t,hu)})),mu=new i((t=>{E(t,z)})),bu=new i((t=>{t(oo).to(no).inSingletonScope(),E(t,oo)})),yu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Cu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let wu=class{constructor(){this.type="static",this.offscreen=!1,this.global=D.global}setDpr(t){this.canvas.dpr=t}init(t,e,i){if(this.layer=t,this.window=e,i.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let t;this.main=!1,i.canvasId&&(t=this.global.getElementById(i.canvasId)),t||(t=this.global.createCanvas({width:e.width,height:e.height})),t.style&&(t.style["pointer-events"]="none");const r=e.getContext().getCanvas().nativeCanvas,o=ho({nativeCanvas:t,width:e.width,height:e.height,dpr:e.dpr,id:i.canvasId,canvasControled:!0,container:e.getContainer(),x:r.offsetLeft,y:r.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(t,e){this.canvas.resize(t,e)}resizeView(t,e){}render(t,e,i){var r;if(!this.main){const t=this.window.getContext().getCanvas().nativeCanvas;!t||this.canvas.x===t.offsetLeft&&this.canvas.y===t.offsetTop||(this.canvas.x=t.offsetLeft,this.canvas.y=t.offsetTop,this.canvas.applyPosition())}e.renderService.render(t,Object.assign(Object.assign({context:this.context,clear:null!==(r=e.background)&&void 0!==r?r:"#ffffff"},e),i))}merge(t){t.forEach((t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)}))}prepare(t,e){}drawTo(t,e,i){var r;const o=t.getContext();i.renderService.render(e,Object.assign(Object.assign({context:o},i),{clear:i.clear?null!==(r=i.background)&&void 0!==r?r:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};wu=yu([f(),Cu("design:paramtypes",[])],wu);var vu=new i((t=>{t(wu).toSelf(),t(hl).toService(wu)}));var xu=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};function _u(t,e,i){const r={},o=[];return t.forEachChildren((t=>{const{zIndex:i=e}=t.attribute;r[i]?r[i].push(t):(r[i]=[t],o.push(i))}),i),o.sort(((t,e)=>i?e-t:t-e)),{childMap:r,zIdxArray:o}}function Su(t,e,i,r=!1,o=!1){let n=!1;if(o)n=!0;else{let i;t.forEachChildren(((t,r)=>{const{zIndex:o=e}=t.attribute;if(0===r)i=o;else if(i!==o)return n=!0,!0;return!1}),r)}if(n){const{childMap:n,zIdxArray:s}=_u(t,e,r);let a=!1;for(let t=0;t<s.length&&!a;t++){const e=n[s[t]];o&&e.sort(((t,e)=>{var i,o;return(r?-1:1)*((null!==(i=e.attribute.z)&&void 0!==i?i:0)-(null!==(o=t.attribute.z)&&void 0!==o?o:0))}));for(let t=0;t<e.length;t++)if(i(e[t],t)){a=!0;break}}}else t.forEachChildren(i,r)}function Au(t,e,i,r=!1){return xu(this,void 0,void 0,(function*(){yield t.forEachChildrenAsync(i,r)}))}function Tu(t,e,i,r=!1){let o=!1;t.forEachChildren(((t,e)=>{const{zIndex:r=i}=t.attribute;if(0===e);else if(void 0!==r)return o=!0,!0;return!1}),r);let n=null,s=!1;if(o){const{childMap:o,zIdxArray:a}=_u(t,i,r);let l=!1;for(let t=0;t<a.length&&!l;t++){const i=o[a[t]];for(let t=0;t<i.length;t++){if(s){l=!0,n=i[t];break}i[t]._uid!==e||(s=!0)}}}else t.forEachChildren((t=>s?(n=t,!0):(t._uid===e&&(s=!0),!1)),r);return n}var Ru=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Bu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mu=function(t,e){return function(i,r){e(i,r,t)}};let Pu=class{constructor(t,e){this.contributions=t,this.drawItemInterceptorContributions=e,this._renderInGroup=(t,e,i,r)=>{var o;t?e.forEachChildren((t=>{i.break||(t.isContainer?this.renderGroup(t,i,r):this.renderItem(t,i))})):Su(e,Sr.zIndex,(t=>{i.break||(t.isContainer?this.renderGroup(t,i,r):this.renderItem(t,i))}),!1,!!(null===(o=i.context)||void 0===o?void 0:o.camera))},this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Ne,this.backupDirtyBounds=new Ne,this.global=D.global,this.layerService=D.layerService,ut(this.contributions)||(this.contributions=[this.contributions]),this.init()}reInit(){this.init(),this.contributions.forEach((t=>{t.reInit()}))}init(){this.contributions.forEach((t=>{if(t.style){const e=this.styleRenderMap.get(t.style)||new Map;e.set(t.numberType,t),this.styleRenderMap.set(t.style,e)}else this.defaultRenderMap.set(t.numberType,t)})),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}prepareForDraw(t,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(t,e){var i;this.prepareForDraw(t,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=t;const{context:r,stage:o,viewBox:n,transMatrix:s}=e;if(!r)return;const a=this.dirtyBounds.setValue(0,0,n.width(),n.height());if(o.dirtyBounds&&!o.dirtyBounds.empty()){const t=Se(a,o.dirtyBounds,!1);a.x1=Math.floor(t.x1),a.y1=Math.floor(t.y1),a.x2=Math.ceil(t.x2),a.y2=Math.ceil(t.y2)}const l=r.dpr%1;(l||.5!==l)&&(a.x1=Math.floor(a.x1*r.dpr)/r.dpr,a.y1=Math.floor(a.y1*r.dpr)/r.dpr,a.x2=Math.ceil(a.x2*r.dpr)/r.dpr,a.y2=Math.ceil(a.y2*r.dpr)/r.dpr),this.backupDirtyBounds.copy(a),r.reset(!1),r.save(),r.setClearMatrix(s.a,s.b,s.c,s.d,s.e,s.f),r.clearMatrix(!1),r.translate(n.x1,n.y1,!0),r.beginPath(),r.rect(a.x1,a.y1,a.width(),a.height()),r.clip(),o.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(t,r,e),(null===(i=t.drawParams)||void 0===i?void 0:i.stage)&&t.drawParams.stage.hooks.afterClearScreen.call(t.drawParams),t.renderTreeRoots.sort(((t,e)=>{var i,r;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:Sr.zIndex)-(null!==(r=e.attribute.zIndex)&&void 0!==r?r:Sr.zIndex)})).forEach((t=>{t.isContainer?this.renderGroup(t,e,Ta.allocate(1,0,0,1,0,0)):this.renderItem(t,e)})),r.restore(),r.draw()}doRegister(){throw new Error("暂不支持")}_findNextGraphic(t){let e=t.parent,i=t._uid;for(;e;){const t=Tu(e,i,Sr.zIndex);if(t)return t;i=e._uid,e=e.parent}return null}renderGroup(t,e,i,r){if(e.break||!1===t.attribute.visibleAll)return;if(t.incremental&&(null==e.startAtId||e.startAtId===t._uid))return e.break=!0,void this._increaseRender(t,e);if(this.useDirtyBounds&&!Be(t.AABBBounds,this.dirtyBounds,!1)&&"empty"!==t.attribute.boundsMode)return;let o,n=i;if(this.useDirtyBounds){o=Zc.allocateByObj(this.dirtyBounds);const e=t.transMatrix;n=Ta.allocateByObj(i).multiply(e.a,e.b,e.c,e.d,e.e,e.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(n.getInverse())}e.isGroupScroll=!(!t.attribute.scrollX&&!t.attribute.scrollY),this.renderItem(t,e,{renderInGroupParams:{skipSort:r,nextM:n},renderInGroup:this._renderInGroup}),this.useDirtyBounds&&(this.dirtyBounds.copy(o),Zc.free(o),Ta.free(n))}_increaseRender(t,e){const{layer:i,stage:r}=e,{subLayers:o}=i;let n=o.get(t._uid);n||(n={layer:this.layerService.createLayer(r),zIndex:o.size,group:t},o.set(t._uid,n));const s=n.layer.getNativeHandler().getContext(),a=n.drawContribution||so.get(vd);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:n.layer,context:s,startAtId:t._uid,break:!1})),n.drawContribution=a;const l=this._findNextGraphic(t);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,e);else{let t=o.get(l._uid);t||(t={layer:this.layerService.createLayer(r),zIndex:o.size},o.set(l._uid,t));const i=t.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:a,clear:"transparent",layer:t.layer,context:i,startAtId:l._uid,break:!1}))}}getRenderContribution(t){let e;return e||(e=this.selectRenderByNumberType(t.numberType,t)),e||(e=this.selectRenderByType(t.type)),e}renderItem(t,e,i){if(this.InterceptorContributions.length)for(let r=0;r<this.InterceptorContributions.length;r++){const o=this.InterceptorContributions[r];if(o.beforeDrawItem&&o.beforeDrawItem(t,this.currentRenderService,e,this,i))return}const r=this.getRenderContribution(t);if(!r)return;let o,n=!1;if(e.isGroupScroll){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;n=!0,this.scrollMatrix||(this.scrollMatrix=Ta.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-e,-i)}if(n&&(o=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!t.isContainer&&"empty"!==t.attribute.boundsMode&&!Be(t.AABBBounds,null!=o?o:this.dirtyBounds,!1)){if(n&&t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(e,i)}return}const s=null!=e.startAtId&&t._uid!==e.startAtId;if(t._uid===e.startAtId&&(e.startAtId=null),i&&(i.skipDraw=s),s?t.isContainer&&r.draw(t,this.currentRenderService,e,i):r.draw(t,this.currentRenderService,e,i),n&&t.parent){const{scrollX:e=0,scrollY:i=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(e,i)}if(this.InterceptorContributions.length)for(let i=0;i<this.InterceptorContributions.length;i++){const r=this.InterceptorContributions[i];if(r.afterDrawItem&&r.afterDrawItem(t,this.currentRenderService,e,this))return}}selectRenderByType(t){return Xt.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(t,e){let i;if(e.attribute.renderStyle){const r=this.styleRenderMap.get(e.attribute.renderStyle);i=r&&r.get(t)}return i||this.currentRenderMap.get(t)||this.defaultRenderMap.get(t)}clearScreen(t,e,i){var r,o,n;const{clear:s,viewBox:a}=i,l=a.width(),h=a.height();if(s){e.clearRect(0,0,l,h),(null===(r=t.drawParams)||void 0===r?void 0:r.stage)&&t.drawParams.stage.hooks.afterClearRect.call(t.drawParams);const i=null===(o=t.drawParams)||void 0===o?void 0:o.stage;if(i&&(e.globalAlpha=null!==(n=i.attribute.opacity)&&void 0!==n?n:1),i&&i.backgroundImg&&i.resources){const t=i.resources.get(s);t&&"success"===t.state&&t.data&&e.drawImage(t.data,0,0,l,h)}else e.fillStyle=jr(e,s,{AABBBounds:{x1:0,y1:0,x2:0+l,y2:0+h}},0,0),e.fillRect(0,0,l,h)}}afterDraw(t,e){}};Pu=Ru([f(),Mu(0,p(Sd)),Mu(1,g(H)),Mu(1,m(Od)),Bu("design:paramtypes",[Array,Object])],Pu);var Hu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let ku=class extends Mc{constructor(){super(...arguments),this.numberType=la}drawShape(t,e,i,r,o,n,s,a){if(t.incremental&&o.multiGraphicOptions){const{startAtIdx:e,length:n}=o.multiGraphicOptions,{segments:l=[]}=t.attribute;if(e>l.length)return;const h=nn(t).line,{fill:c=h.fill,stroke:d=h.stroke,opacity:u=h.opacity,fillOpacity:g=h.fillOpacity,strokeOpacity:p=h.strokeOpacity,lineWidth:f=h.lineWidth,visible:m=h.visible}=t.attribute,b=Cl(u,g,c),y=vl(u,p),C=bl(c),w=yl(d,f);if(!t.valid||!m)return;if(!C&&!w)return;if(!(b||y||s||a))return;const{context:v}=o;for(let o=e;o<e+n;o++)this.drawIncreaseSegment(t,v,l[o-1],l[o],t.attribute.segments[o],[h,t.attribute],i,r)}else super.drawShape(t,e,i,r,o,n,s,a)}drawIncreaseSegment(t,e,i,r,o,n,s,a){r&&(e.beginPath(),function(t,e,i,r){const{offsetX:o=0,offsetY:n=0}=r||{},s=e?e.points[e.points.length-1]:i.points[0];t.moveTo(s.x+o,s.y+n),i.points.forEach((e=>{!1!==e.defined?t.lineTo(e.x+o,e.y+n):t.moveTo(e.x+o,e.y+n)}))}(e.nativeContext,i,r,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,o,n),e.setStrokeStyle(t,o,s,a,n),e.stroke())}};ku=Hu([f()],ku);var Eu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Fu=class extends Ic{constructor(){super(...arguments),this.numberType=oa}drawShape(t,e,i,r,o,n,s){if(t.incremental&&o.multiGraphicOptions){const{startAtIdx:n,length:a}=o.multiGraphicOptions,{segments:l=[]}=t.attribute;if(n>l.length)return;const h=nn(t).area,{fill:c=h.fill,fillOpacity:d=h.fillOpacity,opacity:u=h.opacity,visible:g=h.visible}=t.attribute,p=Cl(u,d,c),f=bl(c);if(!t.valid||!g)return;if(!f)return;if(!p&&!s)return;for(let o=n;o<n+a;o++)this.drawIncreaseSegment(t,e,l[o-1],l[o],t.attribute.segments[o],[h,t.attribute],i,r)}else super.drawShape(t,e,i,r,o,n,s)}drawIncreaseSegment(t,e,i,r,o,n,s,a){r&&(e.beginPath(),function(t,e,i,r){const{offsetX:o=0,offsetY:n=0}=r||{},{points:s}=i,a=[];for(let t=0;t<s.length;t++)s[t].defined;a.push(s),a.forEach(((i,r)=>{var s,a,l,h;const c=e&&0===r?e.points[e.points.length-1]:i[0];t.moveTo(c.x+o,c.y+n),i.forEach((e=>{!1!==e.defined?t.lineTo(e.x+o,e.y+n):t.moveTo(e.x+o,e.y+n)}));for(let e=i.length-1;e>=0;e--){const r=i[e];t.lineTo(null!==(s=r.x1)&&void 0!==s?s:r.x,null!==(a=r.y1)&&void 0!==a?a:r.y)}t.lineTo(null!==(l=c.x1)&&void 0!==l?l:c.x,null!==(h=c.y1)&&void 0!==h?h:c.y),t.closePath()}))}(e.camera?e:e.nativeContext,i,r,{offsetX:s,offsetY:a}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,o,n),e.setCommonStyle(t,o,s,a,n),e.fill())}};Fu=Eu([f()],Fu);var Lu,Iu=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},zu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ou=function(t,e){return function(i,r){e(i,r,t)}},Du=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};!function(t){t[t.NORMAL=0]="NORMAL",t[t.STOP=1]="STOP"}(Lu||(Lu={}));let Wu=class extends Pu{constructor(t,e,i,r){super(t,r),this.contributions=t,this.lineRender=e,this.areaRender=i,this.drawItemInterceptorContributions=r,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=Lu.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new I([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(t,e){return Du(this,void 0,void 0,(function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=t,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const i=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,i)return;this.currentRenderService=t;const{context:r,viewBox:o}=e;r&&(r.inuse=!0,r.clearMatrix(),r.setTransformForCurrent(!0),r.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,r,e),r.translate(o.x1,o.y1,!0),r.save(),t.renderTreeRoots.sort(((t,e)=>{var i,r;return(null!==(i=t.attribute.zIndex)&&void 0!==i?i:Sr.zIndex)-(null!==(r=e.attribute.zIndex)&&void 0!==r?r:Sr.zIndex)})).forEach((t=>{this.renderGroup(t,e)})),this.hooks.completeDraw.tap("top-draw",(()=>{r.restore(),r.restore(),r.draw(),r.inuse=!1,this.rendering=!1})))}))}_increaseRender(t,e){return Du(this,void 0,void 0,(function*(){this.rendering=!0,yield this._renderIncrementalGroup(t,e)}))}_renderIncrementalGroup(t,e){return Du(this,void 0,void 0,(function*(){this.count=t.count,yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>Du(this,void 0,void 0,(function*(){if(2!==t.count)yield Au(t,Sr.zIndex,((i,r)=>{if(this.status===Lu.STOP)return!0;if(i.isContainer)return!1;if(r<this.currentIdx)return!1;const o=this.currFrameStartAt+t.incremental;return r<o&&(this.currentIdx=r+1,this.renderItem(i,e)),r===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())})),i(!1);else{const r=t.getChildAt(0);if(r.incremental&&r.attribute.segments)for(r.incrementalAt||(r.incrementalAt=0);r.incrementalAt<r.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:r.incrementalAt,length:r.incremental},this.renderItem(r,e),r.incrementalAt+=r.incremental,yield this.waitToNextFrame();else this.renderItem(r,e);i(!1)}}))})})),this.hooks.completeDraw.call()}))}waitToNextFrame(){return Du(this,void 0,void 0,(function*(){return new Promise((t=>{this.global.getRequestAnimationFrame()((()=>{t(!1)}))}))}))}checkForDraw(t){return Du(this,void 0,void 0,(function*(){let e=this.rendering;return t.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e}))}forceStop(){return Du(this,void 0,void 0,(function*(){this.rendering&&(this.status=Lu.STOP,yield new Promise((t=>{this.hooks.completeDraw.tap("stopCb",(()=>{this.status=Lu.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter((t=>"stopCb"!==t.name)),t(!1)}))})))}))}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(t,e){return Du(this,void 0,void 0,(function*(){if(!e.break&&!1!==t.attribute.visibleAll)return t.incremental&&e.startAtId===t._uid?(yield this._increaseRender(t,e),void(e.break=!0)):void(yield new Promise((i=>{this.renderItem(t,e,{drawingCb:()=>Du(this,void 0,void 0,(function*(){yield Au(t,Sr.zIndex,(t=>Du(this,void 0,void 0,(function*(){e.break||t.isContainer&&(yield this.renderGroup(t,e))})))),i(!1)}))})})))}))}};Wu=Iu([f(),Ou(0,p(Sd)),Ou(1,g(ku)),Ou(2,g(Fu)),Ou(3,g(H)),Ou(3,m(Od)),zu("design:paramtypes",[Array,Object,Object,Object])],Wu);var Nu=new i((t=>{t(Wh).toSelf().inSingletonScope(),t(Uh).toSelf().inSingletonScope(),t(Fd).to(Pu),t(vd).to(Wu),t(Ad).to(fd).inSingletonScope(),t(Sd).toService(Ad),E(t,Ml),t(Gh).toSelf().inSingletonScope(),E(t,Il),E(t,Sd),t(jd).toSelf().inSingletonScope(),t(Od).toService(jd),E(t,Od)}));function Gu(){Gu.__loaded||(Gu.__loaded=!0,so.load(ml),so.load(lu),so.load(Zd),so.load(au),so.load(fu),function(t){t.load(mu),t.load(bu),t.load(vu)}(so),function(t){t.load(Nu)}(so))}Gu.__loaded=!1,Gu();const ju=so.get(O);D.global=ju;const Vu=so.get(al);D.graphicUtil=Vu;const Uu=so.get(sl);D.transformUtil=Uu;const Ku=so.get(fa);D.graphicService=Ku;const $u=so.get(Yd);D.renderService=$u;const Xu=so.get(ll);D.layerService=Xu;class Yu{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&null!=t.stage&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t;const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),e.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),e.graphicService.hooks.onRemove.tap(this.key,this.handleChange))}deactivate(t){const e=t=>t.filter((t=>t.name!==this.key)),i=this.pluginService.stage;i&&(i.graphicService.hooks.onAttributeUpdate.taps=e(i.graphicService.hooks.onAttributeUpdate.taps),i.graphicService.hooks.onSetStage.taps=e(i.graphicService.hooks.onSetStage.taps),i.graphicService.hooks.onRemove.taps=e(i.graphicService.hooks.onRemove.taps))}}class qu{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&null!=t.stage&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=D.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=D.global.getRequestAnimationFrame();this.rafId=t((()=>{D.global.devicePixelRatio!==this.dpr&&(this.dpr=D.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()}))}_refreshByMediaQuery(){try{const t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push((()=>{i&&i.removeEventListener("change",e)}))}catch(t){return!1}return!0}deactivate(t){var e;const i=D.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),null===(e=this.autoRefreshCbs)||void 0===e||e.forEach((t=>{t()})),this.autoRefreshCbs=void 0}}class Zu{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t;const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAddIncremental.tap(this.key,((e,i,r)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))})),e.graphicService.hooks.onClearIncremental.tap(this.key,((e,i)=>{e.stage===t.stage&&null!=e.stage&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))})))}deactivate(t){const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAddIncremental.taps=e.graphicService.hooks.onAddIncremental.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.onClearIncremental.taps=e.graphicService.hooks.onClearIncremental.taps.filter((t=>t.name!==this.key)))}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,D.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach((e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const r=e.layer.subLayers.get(e._uid);r&&r.drawContribution&&r.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))})),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const Ju=new Ge;class Qu{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,(t=>{t&&t===this.pluginService.stage&&t.dirtyBounds.clear()}));const e=this.pluginService.stage;e&&(e.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,r)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!t.shouldSelfChangeUpdateAABBBounds()||i&&(Ju.setValue(r.x1,r.y1,r.x2,r.y2),e.dirty(Ju,t.parent&&t.parent.globalTransMatrix)))})),e.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,r,o)=>{e&&e===this.pluginService.stage&&e.renderCount&&(t.isContainer&&!o||e.dirty(r.globalAABBBounds))})),e.graphicService.hooks.clearAABBBounds.tap(this.key,((t,e,i)=>{e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(i)})),e.graphicService.hooks.onRemove.tap(this.key,(t=>{const e=t.stage;e&&e===this.pluginService.stage&&e.renderCount&&e&&e.dirty(t.globalAABBBounds)})))}deactivate(t){const e=this.pluginService.stage;e&&(e.graphicService.hooks.beforeUpdateAABBBounds.taps=e.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.afterUpdateAABBBounds.taps=e.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.clearAABBBounds.taps=e.graphicService.hooks.clearAABBBounds.taps.filter((t=>t.name!==this.key)),e.hooks.afterRender.taps=e.hooks.afterRender.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.onRemove.taps=e.graphicService.hooks.onRemove.taps.filter((t=>t.name!==this.key)))}}let tg;function eg(){if(null==tg)try{const t=document.createElement("canvas"),e=t.getContext("2d");tg=!!(window&&t.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&e&&e.isPointInPath&&e.isPointInStroke),tg&&(tg=!!document.createElement)}catch(t){tg=!1}}function ig(){eg();const t=D.global&&D.global.env;return t?"browser"===t:tg}let rg=class t{static registerPlugin(e,i){t._pluginClasses[e]=i}static getPlugin(e){return t._pluginClasses[e]}};rg._pluginClasses={};const og="white";class ng extends rl{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return null!==(t=this._background)&&void 0!==t?t:og}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}get ticker(){return this._ticker}set ticker(t){t.bindStage(this),this._ticker&&this._ticker.removeListener("tick",this.afterTickCb),t.addTimeline(this.timeline),this._ticker=t,this._ticker.on("tick",this.afterTickCb)}constructor(t={}){var e,i;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=t=>{if(!(this._skipRender<0))if(t){if(this.dirtyBounds){const t=this.window.getViewBox();this.dirtyBounds.setValue(t.x1,t.y1,t.width(),t.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=t=>{this._beforeRender&&this._beforeRender(t)},this.afterClearScreen=t=>{this._afterClearScreen&&this._afterClearScreen(t)},this.afterClearRect=t=>{this._afterClearRect&&this._afterClearRect(t)},this.afterRender=t=>{this.renderCount++,this._afterRender&&this._afterRender(t),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach((e=>e(t))),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{this.tickedBeforeRender=!0,"rendering"!==this.state&&this.renderNextFrame()},this.params=t,this.theme=new rn,this.hooks={beforeRender:new I(["stage"]),afterRender:new I(["stage"]),afterClearScreen:new I(["stage"]),afterClearRect:new I(["stage"])},this.global=D.global,!this.global.env&&ig()&&this.global.setEnv("browser"),this.window=so.get(Go),this.renderService=so.get(Yd),this.pluginService=so.get(cu),this.layerService=so.get(ll),this.graphicService=so.get(fa),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:!1!==t.canvasControled,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=null!==(e=t.background)&&void 0!==e?e:og,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),!1===t.disableDirtyBounds&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this.hooks.afterClearScreen.tap("constructor",this.afterClearScreen),this.hooks.afterClearRect.tap("constructor",this.afterClearRect),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this._afterClearScreen=t.afterClearScreen,this._afterClearRect=t.afterClearRect,this.supportInteractiveLayer=!1!==t.interactiveLayer,t.optimize||(t.optimize={tickRenderMode:"effect"}),this.optmize(t.optimize),t.background&&dt(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.initAnimate(t),this.rafId=null!==(i=t.rafId)&&void 0!==i?i:Math.floor(6*Math.random())}initAnimate(t){var e;this.createTicker&&this.createTimeline&&(this._ticker=t.ticker||this.createTicker(this),this._ticker.bindStage(this),"performance"===(null===(e=this.params.optimize)||void 0===e?void 0:e.tickRenderMode)&&this._ticker.setFPS(30),this.timeline=this.createTimeline(),this._ticker.addTimeline(this.timeline),this._ticker.on("tick",this.afterTickCb))}startAnimate(){this._ticker&&this.timeline&&(this._ticker.start(),this.timeline.resume())}pauseRender(t=-1){this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new bn(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:!1!==this.params.optimize.skipRenderWithOutRange?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(t=!1){t&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:o=0,camera:n,fieldRatio:s=1,fieldDepth:a}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:r,beta:o,camera:n,fieldRatio:s,fieldDepth:a})}set3dOptions(t){var e,i,r,o,n,s;this.option3d=t;const a=this.get3dOptions(t),{light:l,center:h,camera:c,alpha:d,beta:u,fieldRatio:g,fieldDepth:p}=a,{dir:f=[1,1,-1],color:m="white",ambient:b}=l,y=(null!==(e=h.x)&&void 0!==e?e:this.width/2)+(null!==(i=h.dx)&&void 0!==i?i:0),C=(null!==(r=h.y)&&void 0!==r?r:this.height/2)+(null!==(o=h.dy)&&void 0!==o?o:0),w=[y,C,(null!==(n=h.z)&&void 0!==n?n:0)+(null!==(s=h.dz)&&void 0!==s?s:0)];let v=0,x=0,_=0;c||(v=Math.sin(d)+y,x=Math.sin(u)+C,_=Math.cos(d)*Math.cos(u)*1);const S=rg.getPlugin("DirectionalLight");S&&(this.light=new S(f,m,b));const A={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:g,fieldDepth:p,viewParams:{pos:[v,x,_],center:w,up:[0,1,0]}};if(this.camera)this.camera.params=A;else{const t=rg.getPlugin("OrthoCamera");t&&(this.camera=new t(A))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=rg.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new Yu))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new qu))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new Zu))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Ne;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new Qu,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=rg.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=rg.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableReactAttribute(t){if(this.reactAttribute)return;const e=rg.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("暂不支持")}createLayer(t,e){if("released"===this.releaseStatus)return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach((t=>{this.appendChild(t)}))}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){"released"!==this.releaseStatus&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if("released"===this.releaseStatus)return;this.startAnimate();const i=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if("harmony"===this.global.env){const t=this.window.getContext().nativeContext;this.forEachChildren(((e,i)=>{if(i>0){const i=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(i)}}))}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach((t=>{this.nextFrameRenderLayerSet.add(t)})),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getSpecifiedRequestAnimationFrame(this.rafId)((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){if("released"===this.releaseStatus)return;this.startAnimate();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let e=0;e<t.length;e++){let r=t[e];"virtual"===r.layerMode&&(r=r.getNativeHandler().mainHandler.layer),i.includes(r)||i.push(r)}i.forEach((t=>{t.renderCount>this.renderCount||(t.renderCount=this.renderCount+1,t===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),t.render({renderService:this.renderService,background:t===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))})),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e,i=!0){this.window.resize(t,e),i&&this.render()}resize(t,e,i=!0){"released"!==this.releaseStatus&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren((i=>{i.resize(t,e)})),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e,i=!0){"released"!==this.releaseStatus&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren((i=>{i.resizeView(t,e)})),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,r,o){let n=!0;"object"==typeof t?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),!1===e&&(n=!1)):(this.viewBox.setValue(t,e,t+i,e+r),!1===o&&(n=!1)),this.forEachChildren((t=>{t.resizeView(this.viewBox.width(),this.viewBox.height())})),n&&this.render()}setDpr(t,e=!0){this.forEachChildren((e=>{e.setDpr(t)})),e&&this.render()}setOrigin(t,e){throw new Error("暂不支持")}export(t){throw new Error("暂不支持")}pick(t,e){if("released"===this.releaseStatus)return;const i=this.getPickerService().pick(this.children,new Ce(t,e),{bounds:this.AABBBounds});return!(!(null==i?void 0:i.graphic)&&!(null==i?void 0:i.group))&&i}setToFrame(t){throw new Error("暂不支持")}release(){var t,e;super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach((t=>{t.release()})),this.interactiveLayer&&(this.interactiveLayer.forEachChildren((t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)})),this.interactiveLayer.release()),this.window.release(),null===(t=this._ticker)||void 0===t||t.remTimeline(null==this?void 0:this.timeline),null===(e=this._ticker)||void 0===e||e.removeListener("tick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){"released"!==this.releaseStatus&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter((e=>e.name===t))[0]}renderTo(t){"released"!==this.releaseStatus&&this.forEachChildren(((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:0===i,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})}))}renderToNewWindow(t=!0,e){if("released"===this.releaseStatus)return;const i=so.get(Go),r=e?-e.x1:0,o=e?-e.y1:0,n=e?e.x2:this.viewWidth,s=e?e.y2:this.viewHeight,a=e?e.width():this.viewWidth,l=e?e.height():this.viewHeight;return i.create({viewBox:{x1:r,y1:o,x2:n,y2:s},width:a,height:l,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(i),i}toCanvas(t=!0,e){if("released"===this.releaseStatus)return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=so.get(Jd)),this.pickerService}reInit(){this.renderService.reInit(),this.pickerService.reInit()}}var sg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ag=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};let lg=class{configure(t,...e){t.env===this.type&&t.setActiveEnvContribution(this)}getNativeAABBBounds(t){return new Ge}removeDom(t){return!1}createDom(t){return null}updateDom(t,e){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadBlob(t){return fetch(t).then((t=>t.blob())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}getElementTop(t,e){return 0}getElementLeft(t,e){return 0}getElementTopLeft(t,e){return{top:0,left:0}}loadFont(t,e,i){return ag(this,void 0,void 0,(function*(){return{loadState:"fail"}}))}isMacOS(){return!1}copyToClipBoard(t){return Promise.resolve(null)}};lg=sg([f()],lg);var hg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},cg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let dg=class{constructor(){this._uid=e.GenAutoIncrementId(),this.viewBox=new Ge,this.modelMatrix=new Ve(1,0,0,1,0,0)}onChange(t){this._onChangeCb=t}configure(t,e){e.env===this.type&&t.setWindowHandler(this)}release(...t){this.releaseWindow()}isVisible(t){return!0}onVisibleChange(t){}getTopLeft(t){return{top:0,left:0}}setViewBox(t){this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(t,e,i,r,o,n){this.modelMatrix.setValue(t,e,i,r,o,n)}getViewBoxTransform(){return this.modelMatrix}};dg=hg([f(),cg("design:paramtypes",[])],dg);var ug=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},gg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pg=function(t,e){return function(i,r){e(i,r,t)}};let fg=class{constructor(t,e){this.pickItemInterceptorContributions=t,this.pickServiceInterceptorContributions=e,this.type="default",this.global=D.global}reInit(){this._init()}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order)),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort(((t,e)=>t.order-e.order))}pick(t,e,i){let r={graphic:null,group:null};i.pickerService=this;const o=i.bounds.width(),n=i.bounds.height();if(!(new Ge).setValue(0,0,o,n).containsPoint(e))return r;this.pickContext&&(this.pickContext.inuse=!0),i.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const s=new Ve(1,0,0,1,0,0);let a;for(let o=t.length-1;o>=0&&(r=t[o].isContainer?this.pickGroup(t[o],e,s,i):this.pickItem(t[o],e,s,i),!r.graphic);o--)a||(a=r.group);if(r.graphic||(r.group=a),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let t=0;t<this.pickerServiceInterceptorContributions.length;t++){const o=this.pickerServiceInterceptorContributions[t];o.afterPickItem&&(r=o.afterPickItem(r,this,e,i,{parentMatrix:s}))}return r}containsPoint(t,e,i){var r;return!!(null===(r=this.pickItem(t,e,null,null!=i?i:{pickContext:this.pickContext,pickerService:this}))||void 0===r?void 0:r.graphic)}pickGroup(t,e,i,r){let o={group:null,graphic:null};if(!1===t.attribute.visibleAll)return o;const n=r.pickContext,s=n.modelMatrix;if(n.camera){const e=t.transMatrix,i=Ra.allocate();if(xa(i,e),s){if(i){const t=Ra.allocate();n.modelMatrix=_a(t,s,i),Ra.free(i)}}else xa(i,t.globalTransMatrix),n.modelMatrix=i}if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const a=this.InterceptorContributions[o];if(a.beforePickItem){const o=a.beforePickItem(t,this,e,r,{parentMatrix:i});if(o)return n.modelMatrix!==s&&Ra.free(n.modelMatrix),n.modelMatrix=s,o}}const a=t.transMatrix,l=Ta.allocateByObj(i),h=new Ce(e.x,e.y);l.transformPoint(h,h);const c=t.AABBBounds.containsPoint(h);if(!c&&!t.stage.camera)return o;const d=this.pickItem(t,h.clone(),i,r);d&&d.graphic&&(o.graphic=d.graphic,o.params=d.params);const u=!1!==t.attribute.pickable&&c;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),!1===t.attribute.childrenPickable||d&&d.graphic||Su(t,Sr.zIndex,(n=>{if(n.isContainer){const i=new Ce(e.x,e.y),s=nn(t).group,{scrollX:a=s.scrollX,scrollY:h=s.scrollY}=t.attribute;i.x-=a,i.y-=h,o=this.pickGroup(n,i,l,r)}else{const s=new Ce(e.x,e.y);l.transformPoint(s,s);const a=nn(t).group,{scrollX:h=a.scrollX,scrollY:c=a.scrollY}=t.attribute;s.x-=h,s.y-=c;const d=this.pickItem(n,s,i,r);d&&d.graphic&&(o.graphic=d.graphic,o.params=d.params)}return!!o.graphic||!!o.group}),!0,!!n.camera),n.modelMatrix!==s&&Ra.free(n.modelMatrix),n.modelMatrix=s,o.graphic||o.group||!u||t.stage.camera||(o.group=t),Ta.free(l),o}selectPicker(t){return this.pickerMap.get(t.numberType)||null}};fg=ug([f(),pg(0,g(H)),pg(0,m(tu)),pg(1,g(H)),pg(1,m(eu)),gg("design:paramtypes",[Object,Object])],fg);let mg=!1;const bg=new i((t=>{mg||(mg=!0,t(wc).toSelf().inSingletonScope(),t(xd).to(wc).inSingletonScope(),t(Sd).toService(xd),t(Tl).toService(Gh),E(t,Tl))}));let yg=!1;const Cg=new i((t=>{yg||(yg=!0,t(Kc).toSelf().inSingletonScope(),t(Md).to(Kc).inSingletonScope(),t(Sd).toService(Md),t(nc).toSelf(),t(oc).toSelf(),t(El).toService(nc),t(El).toService(oc),t(El).toService(Gh),E(t,El))}));let wg=!1;const vg=new i((t=>{wg||(wg=!0,t(Mc).toSelf().inSingletonScope(),t(ku).toSelf().inSingletonScope(),t(Td).to(Mc).inSingletonScope(),t(Sd).toService(Td))}));let xg=!1;const _g=new i((t=>{xg||(xg=!0,t(qc).toSelf().inSingletonScope(),t(Pd).to(qc).inSingletonScope(),t(Sd).toService(Pd),t(Fl).toService(Gh),E(t,Fl))}));let Sg=!1;const Ag=new i((t=>{Sg||(Sg=!0,t(Sc).toSelf().inSingletonScope(),t(_d).to(Sc).inSingletonScope(),t(Sd).toService(_d),t(Bl).toService(Gh),E(t,Bl))}));let Tg=!1;const Rg=new i((t=>{Tg||(Tg=!0,t(Hd).to(id).inSingletonScope(),t(Sd).toService(Hd),t(Ll).toService(Gh),E(t,Ll))}));let Bg=!1;const Mg=new i((t=>{Bg||(Bg=!0,t(Gc).toSelf().inSingletonScope(),t(Rd).to(Gc).inSingletonScope(),t(Sd).toService(Rd),t(Hl).toService(Gh),E(t,Hl))}));let Pg=!1;const Hg=new i((t=>{Pg||(Pg=!0,t(Bd).to(dd).inSingletonScope(),t(Sd).toService(Bd),t(kl).toService(Gh),E(t,kl))}));var kg=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Eg=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Fg=class extends mc{constructor(){super(),this.numberType=ua,this.builtinContributions=[Jc],this.init()}drawShape(t,e,i,r,o){const n=nn(t).richtext,{strokeOpacity:s=n.strokeOpacity,opacity:a=n.opacity,fillOpacity:l=n.fillOpacity,visible:h=n.visible}=t.attribute;if(!t.valid||!h)return;const c=Cl(a,l,!0),d=Cl(a,s,!0);c&&(e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,n),e.translate(i,r),this.beforeRenderStep(t,e,i,r,c,d,c,d,n,o),t.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(t,e,i,r,c,d,c,d,n,o))}drawIcon(t,e,i,r,o){var n;const s=nn(t).richtextIcon,{width:a=s.width,height:l=s.height,opacity:h=s.opacity,image:c,backgroundFill:d=s.backgroundFill,backgroundFillOpacity:u=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:p=s.backgroundStrokeOpacity,backgroundRadius:f=s.backgroundRadius,margin:m}=t.attribute,{backgroundWidth:b=a,backgroundHeight:y=l}=t.attribute;if(m&&(i+=t._marginArray[3],r+=t._marginArray[0]),t._hovered){const t=(b-a)/2,o=(y-l)/2;0===f?(e.beginPath(),e.rect(i-t,r-o,b,y)):(e.beginPath(),ec(e,i-t,r-o,b,y,f,!0)),d&&(e.globalAlpha=u,e.fillStyle=d,e.fill()),g&&(e.globalAlpha=p,e.strokeStyle=g,e.stroke())}const C=c&&(null===(n=null==t?void 0:t.resources)||void 0===n?void 0:n.get(c));C&&"success"===C.state&&(e.globalAlpha=h,e.drawImage(C.data,i,r,a,l))}draw(t,e,i){const r=nn(t).richtext;this._draw(t,r,!1,i)}};Fg=kg([f(),Eg("design:paramtypes",[])],Fg);let Lg=!1;const Ig=new i((t=>{Lg||(Lg=!0,t(kd).to(Fg).inSingletonScope(),t(Sd).toService(kd))}));let zg=!1;const Og=new i((t=>{zg||(zg=!0,t(Ed).to(wd).inSingletonScope(),t(Sd).toService(Ed),t(Pl).toService(Gh),E(t,Pl))}));const Dg=new Ge;class Wg{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=e.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new Ge}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t,e=!0){if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const r=nn(i).group,{display:o=r.display}=i.attribute;if("flex"!==o)return;const{flexDirection:n=r.flexDirection,flexWrap:s=r.flexWrap,alignItems:a=r.alignItems,clip:l=r.clip}=i.attribute,{alignContent:h=(null!=a?a:r.alignContent)}=i.attribute;let{width:c,height:d,justifyContent:u=r.justifyContent}=i.attribute;const g=i.getChildren();if(null==c||null==d){let t=0,e=0,i=0;if(g.forEach((r=>{const o=this.getAABBBounds(r);o.empty()||("column"===n||"column-reverse"===n?(e+=o.height(),t=Math.max(t,o.width())):(t+=o.width(),e=Math.max(e,o.height())),i+=o.x1,i+=o.y1,i+=o.x2,i+=o.y2)})),!isFinite(i))return;c=t,d=e}null==i.attribute.width?i.attribute.width=c:c=i.attribute.width,null==i.attribute.height?i.attribute.height=d:d=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const p={main:{len:c,field:"x"},cross:{len:d,field:"y"}},f=p.main,m=p.cross;"column"!==n&&"column-reverse"!==n||(f.len=d,m.len=c,f.field="y",m.field="x"),"row-reverse"!==n&&"column-reverse"!==n||("flex-start"===u?u="flex-end":"flex-end"===u?u="flex-start":g.reverse());let b=0,y=0;const C=[];g.forEach((t=>{const e=this.getAABBBounds(t);if(e.empty())return;const i="x"===f.field?e.width():e.height(),r="x"===m.field?e.width():e.height();C.push({mainLen:i,crossLen:r}),b+=i,y=Math.max(y,r)}));const w=[];if(b>f.len&&"wrap"===s){let t=0,e=0;C.forEach((({mainLen:i,crossLen:r},o)=>{t+i>f.len?0===t?(w.push({idx:o,mainLen:t+i,crossLen:r}),t=0,e=0):(w.push({idx:o-1,mainLen:t,crossLen:e}),t=i,e=r):(t+=i,e=Math.max(e,r))})),w.push({idx:C.length-1,mainLen:t,crossLen:e})}else w.push({idx:C.length-1,mainLen:b,crossLen:y});let v=0;if(w.forEach((t=>{this.layoutMain(i,g,u,f,C,v,t),v=t.idx+1})),y=w.reduce(((t,e)=>t+e.crossLen),0),1===w.length){const t={"flex-start":0,"flex-end":m.len,center:m.len/2};this.layoutCross(g,a,m,t,C,w[0],0)}else if("flex-start"===h){v=0;let t=0;w.forEach(((e,i)=>{const r={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"flex-start",m,r,C,w[i],v),v=e.idx+1,t+=e.crossLen}))}else if("center"===h){v=0;let t=Math.max(0,(m.len-y)/2);w.forEach(((e,i)=>{const r={"flex-start":t,"flex-end":t+e.crossLen,center:t+e.crossLen/2};this.layoutCross(g,"center",m,r,C,w[i],v),v=e.idx+1,t+=e.crossLen}))}else if("space-around"===h){v=0;const t=Math.max(0,(m.len-y)/w.length/2);let e=t;w.forEach(((i,r)=>{const o={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",m,o,C,w[r],v),v=i.idx+1,e+=i.crossLen+2*t}))}else if("space-between"===h){v=0;const t=Math.max(0,(m.len-y)/(2*w.length-2));let e=0;w.forEach(((i,r)=>{const o={"flex-start":e,"flex-end":e+i.crossLen,center:e+i.crossLen/2};this.layoutCross(g,"flex-start",m,o,C,w[r],v),v=i.idx+1,e+=i.crossLen+2*t}))}g.forEach(((t,e)=>{t.addUpdateBoundTag(),t.addUpdatePositionTag(),t.clearUpdateLayoutTag()})),i.addUpdateLayoutTag();const x=this.getAABBBounds(i);l||this.tempBounds.equals(x)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(null!=e?e:0)-i}layoutMain(t,e,i,r,o,n,s){if("flex-start"===i){let t=0;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}else if("flex-end"===i){let t=r.len;for(let i=s.idx;i>=n;i--){t-=o[i].mainLen;const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`]))}}else if("space-around"===i)if(s.mainLen>=r.len){let t=0;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}else{const t=s.idx-n+1,i=(r.len-s.mainLen)/t/2;let a=i;for(let t=n;t<=s.idx;t++){const n=a+(e[t],r.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[r.field]=this.updateChildPos(n,e[t].attribute[r.field],s[`${r.field}1`])),a+=o[t].mainLen+2*i}}else if("space-between"===i)if(s.mainLen>=r.len){let t=0;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}else{const t=s.idx-n+1,i=(r.len-s.mainLen)/(2*t-2);let a=0;for(let t=n;t<=s.idx;t++){const n=a+(e[t],r.field,0),s=this.getAABBBounds(e[t]);!s.empty()&&(e[t].attribute[r.field]=this.updateChildPos(n,e[t].attribute[r.field],s[`${r.field}1`])),a+=o[t].mainLen+2*i}}else if("center"===i){let t=(r.len-s.mainLen)/2;for(let i=n;i<=s.idx;i++){const n=t+(e[i],r.field,0),s=this.getAABBBounds(e[i]);!s.empty()&&(e[i].attribute[r.field]=this.updateChildPos(n,e[i].attribute[r.field],s[`${r.field}1`])),t+=o[i].mainLen}}}layoutCross(t,e,i,r,o,n,s){var a;for(let l=s;l<=n.idx;l++){const n=t[l];let{alignSelf:s}=n.attribute;s&&"auto"!==s||(s=e);const h=this.getAABBBounds(n),c=null!==(a=r[s])&&void 0!==a?a:r["flex-start"];"flex-end"===s?!h.empty()&&(n.attribute[i.field]=this.updateChildPos(c-o[l].crossLen+(i.field,0),n.attribute[i.field],h[`${i.field}1`])):"center"===s?!h.empty()&&(n.attribute[i.field]=this.updateChildPos(c-o[l].crossLen/2+(i.field,0),n.attribute[i.field],h[`${i.field}1`])):!h.empty()&&(n.attribute[i.field]=this.updateChildPos(c+(i.field,0),n.attribute[i.field],h[`${i.field}1`]))}}activate(t){this.pluginService=t;const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAttributeUpdate.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),t.stage&&t.stage===this.pluginService.stage&&this.tryLayout(t,!1)})),e.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((t,e,i,r)=>{t.glyphHost&&(t=t.glyphHost),e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&Dg.copy(r)})),e.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((t,e,i,r,o)=>{e&&e===this.pluginService.stage&&t.isContainer&&!this.skipBoundsTrigger&&(Dg.equals(i)||this.tryLayout(t,!1))})),e.graphicService.hooks.onSetStage.tap(this.key,(t=>{t.glyphHost&&(t=t.glyphHost),this.tryLayout(t,!1)})))}deactivate(t){const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAttributeUpdate.taps=e.graphicService.hooks.onAttributeUpdate.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.beforeUpdateAABBBounds.taps=e.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.afterUpdateAABBBounds.taps=e.graphicService.hooks.afterUpdateAABBBounds.taps.filter((t=>t.name!==this.key)),e.graphicService.hooks.onSetStage.taps=e.graphicService.hooks.onSetStage.taps.filter((t=>t.name!==this.key)))}}const Ng=()=>{rg.registerPlugin("FlexLayoutPlugin",Wg)},Gg=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class jg extends rl{constructor(t,e){super(t),this._skipRenderAttributes=Gg,(null==e?void 0:e.mode)&&(this.mode=e.mode,this.setMode(e.mode)),(null==e?void 0:e.skipDefault)&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage((()=>{this.render(),this.bindEvents()}))}setAttribute(t,e,i,r){const o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);if(o)return this._setAttributes(o,i);ht(this.attribute[t])&&ht(e)&&!ot(this.attribute[t])&&!ot(e)?Ht(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every((t=>this._skipRenderAttributes.includes(t)))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){nt(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const r=e[i];!ht(this.attribute[r])||ot(this.attribute[r])||ot(t[r])?this.attribute[r]=t[r]:Ht(this.attribute[r],t[r])}}bindEvents(){}_getNodeId(t){var e;return`${null!==(e=this.id)&&void 0!==e?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const r=new un(t,e);r.manager=null===(i=this.stage)||void 0===i?void 0:i.eventSystem.manager,this.dispatchEvent(r)}eventPosToStagePos(t){var e,i;const r={x:0,y:0},o=null!==(i=null===(e=this.stage)||void 0===e?void 0:e.eventPointTransform(t))&&void 0!==i?i:{x:0,y:0};return this.globalTransMatrix.transformPoint(o,r),r}}const Vg=Symbol.for("MathPickerContribution"),Ug=Symbol.for("MathArcPicker"),Kg=Symbol.for("MathCirclePicker"),$g=Symbol.for("MathImagePicker"),Xg=Symbol.for("MathLinePicker"),Yg=Symbol.for("MathPathPicker"),qg=Symbol.for("MathRectPicker"),Zg=Symbol.for("MathSymbolPicker"),Jg=Symbol.for("MathTextPicker"),Qg=Symbol.for("MathPolygonPicker"),tp=Symbol.for("CanvasArcPicker"),ep=Symbol.for("CanvasCirclePicker"),ip=Symbol.for("CanvasImagePicker"),rp=Symbol.for("CanvasLinePicker"),op=Symbol.for("CanvasPathPicker"),np=Symbol.for("CanvasRectPicker"),sp=Symbol.for("CanvasSymbolPicker"),ap=Symbol.for("CanvasTextPicker"),lp=Symbol.for("CanvasPolygonPicker"),hp=Symbol.for("CanvasRichTextPicker"),cp=Symbol.for("CanvasGroupPicker"),dp=Symbol.for("CanvasPickerContribution"),up={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"};var gp=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};function pp(t,e){if(ut(t))return t.forEach((t=>pp(t,e)));e.push(t)}const fp=(t,e)=>{const i=e.x-t.x,r=e.y-t.y;return Math.abs(i)>Math.abs(r)?i>0?"right":"left":r>0?"down":"up"},mp=(t,e)=>{const i=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y);return Math.sqrt(i*i+r*r)};class bp extends et{constructor(t,e={}){var i,r,o,n,s,a,l,h,c,d;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=t=>{this.startTime=gn.now();const{cachedEvents:e,startPoints:i}=this;t&&e.push(t.clone()),i.length=e.length;for(let t=0;t<e.length;t++){const{x:r,y:o}=e[t],n={x:r,y:o};i[t]=n}if(1!==i.length)this.startDistance=mp(i[0],i[1]),this.center=(t=>{const e=t.length;if(1===e)return{x:Math.round(t[0].x),y:Math.round(t[0].y)};let i=0,r=0,o=0;for(;o<e;)i+=t[o].x,r+=t[o].y,o++;return{x:Math.round(i/e),y:Math.round(r/e)}})([i[0],i[1]]);else{const t=e[0];this.pressTimeout=setTimeout((()=>{t.direction="none",t.deltaX=0,t.deltaY=0,t.points=i,this.triggerStartEvent("press",t),this.triggerEvent("press",t),this.eventType="press",this.direction="none",this.pressTimeout=null}),this.config.press.time)}},this.onMove=t=>{this.clearPressTimeout();const{startPoints:e,cachedEvents:i}=this;if(!e.length)return;const r=t.clone(),{x:o,y:n,pointerId:s}=r;for(let t=0,e=i.length;t<e;t++)if(s===i[t].pointerId){i[t]=r;break}const a={x:o,y:n},l=i.map((t=>({x:t.x,y:t.y}))),h=gn.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=h,this.lastMovePoint=a,1===e.length){const t=e[0],i=o-t.x,s=n-t.y,h=this.direction||fp(t,a);this.direction=h;const c=this.getEventType(a);return r.direction=h,r.deltaX=i,r.deltaY=s,r.points=l,this.triggerStartEvent(c,r),void this.triggerEvent(c,r)}const{startDistance:c}=this,d=mp(l[0],l[1]);r.scale=d/c,r.center=this.center,r.points=l,this.triggerStartEvent("pinch",r),this.triggerEvent("pinch",r)},this.onEnd=t=>{const e=t.clone(),{cachedEvents:i,startPoints:r}=this,o=i.map((t=>({x:t.x,y:t.y})));if(e.points=o,this.triggerEndEvent(e),1===i.length){const i=gn.now(),o=this.lastMoveTime;if(i-o<100){const t=o-(this.prevMoveTime||this.startTime);if(t>0){const i=this.prevMovePoint||r[0],o=this.lastMovePoint||r[0],n=mp(i,o),s=n/t;if(s>this.config.swipe.velocity&&n>this.config.swipe.threshold)return e.velocity=s,e.direction=fp(i,o),this.triggerEvent("swipe",e),this.cachedEvents=[],this.startPoints=[],void this.reset()}}i-this.startTime<this.config.press.time&&(i-this.lastTapTime<this.config.tap.interval&&t.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=i,this.lastTapTarget=t.target,1===this.tapCount?this.triggerEvent("tap",e):2===this.tapCount&&(this.triggerEvent("doubletap",e),this.tapCount=0))}for(let t=0,o=i.length;t<o;t++)if(i[t].pointerId===e.pointerId){i.splice(t,1),r.splice(t,1);break}this.reset(),i.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:null!==(r=null===(i=null==e?void 0:e.press)||void 0===i?void 0:i.time)&&void 0!==r?r:251,threshold:null!==(n=null===(o=null==e?void 0:e.press)||void 0===o?void 0:o.threshold)&&void 0!==n?n:9},swipe:{threshold:null!==(a=null===(s=null==e?void 0:e.swipe)||void 0===s?void 0:s.threshold)&&void 0!==a?a:10,velocity:null!==(h=null===(l=null==e?void 0:e.swipe)||void 0===l?void 0:l.velocity)&&void 0!==h?h:.3},tap:{interval:null!==(d=null===(c=null==e?void 0:e.tap)||void 0===c?void 0:c.interval)&&void 0!==d?d:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerleave",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerleave",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:r}=this;if("press"===e)return e;let o;return o=gn.now()-i>this.config.press.time&&mp(r[0],t)<this.config.press.threshold?"press":"pan",this.eventType=o,o}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,r={type:t,ev:e};for(let e=0,o=i.length;e<o;e++)if(i[e].type===t)return void i.splice(e,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=D.global.getRequestAnimationFrame()((()=>{D.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let t=0,e=r.length;t<e;t++){const{type:e,ev:i}=r[t];this.emitEvent(e,i)}this.emitThrottles.length=0})))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach((i=>{this.triggerEvent(`${i}end`,t),"press"===i&&this.triggerEvent(`${i}up`,t),delete e[i]}))}emitEvent(t,e){if(!this.element)return;const i=this.element._events["*"];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,o=i.length;r<o&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t);this.emit(t,e)}}var yp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Cp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};const wp=[0,0,0];let vp=class{set fillStyle(t){this.nativeContext.fillStyle=t}get fillStyle(){return this.nativeContext.fillStyle}set font(t){t!==this._font&&(this._font=t,this.nativeContext.font=t)}get font(){var t;return null!==(t=this._font)&&void 0!==t?t:this.nativeContext.font}set globalAlpha(t){this.nativeContext.globalAlpha=t*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(t){this.nativeContext.lineCap=t}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(t){this.nativeContext.lineDashOffset=t}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(t){this.nativeContext.lineJoin=t}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(t){this.nativeContext.lineWidth=t}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(t){this.nativeContext.miterLimit=t}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(t){this.nativeContext.shadowBlur=t}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(t){this.nativeContext.shadowColor=t}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(t){this.nativeContext.shadowOffsetX=t}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(t){this.nativeContext.shadowOffsetY=t}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(t){this.nativeContext.strokeStyle=t}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(t){this.nativeContext.textAlign=t}get textAlign(){return this.nativeContext.textAlign}set textBaseline(t){this.nativeContext.textBaseline=t}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(t){t!==!!this._inuse&&(this._inuse=t,t?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(t,e){this.fillAttributes=Object.assign(Object.assign({},yr),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},wr),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},vr),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new Ve(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new Ve(1,0,0,1,0,0),this._clearMatrix=new Ve(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(t=!0){this.stack.length&&Xt.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Ve(1,0,0,1,0,0),this.stack.length=0,t&&this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(t=!1){!t&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(t){return Ta.allocateByObj(t)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(Ta.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0)),this.font="",this._clearFilterStyle=!1,this._clearShadowStyle=!1}highPerformanceRestore(){this.stack.length>0&&(Ta.free(this.matrix),this.matrix=this.stack.pop())}rotate(t,e=!0){this.matrix.rotate(t),e&&this.setTransformForCurrent()}save(){const t=this.cloneMatrix(this.matrix);this.stack.push(t),this.nativeContext.save()}highPerformanceSave(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}scale(t,e,i=!0){this.matrix.scale(t,e),i&&this.setTransformForCurrent()}setScale(t,e,i=!0){this.matrix.setScale(t,e),i&&this.setTransformForCurrent()}scalePoint(t,e,i,r,o=!0){this.translate(i,r,!1),this.scale(t,e,!1),this.translate(-i,-r,!1),o&&this.setTransformForCurrent()}setTransform(t,e,i,r,o,n,s=!0,a=this.dpr){this.matrix.setValue(a*t,a*e,a*i,a*r,a*o,a*n),s&&this.setTransformForCurrent()}setTransformFromMatrix(t,e=!0,i=this.dpr){this.matrix.setValue(t.a*i,t.b*i,t.c*i,t.d*i,t.e*i,t.f*i),e&&this.setTransformForCurrent()}resetTransform(t=!0,e=this.dpr){this.setTransform(e,0,0,e,0,0),t&&this.setTransformForCurrent()}transform(t,e,i,r,o,n,s=!0){this.matrix.multiply(t,e,i,r,o,n),s&&this.setTransformForCurrent()}transformFromMatrix(t,e){this.matrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f),e&&this.setTransformForCurrent()}translate(t,e,i=!0){this.matrix.translate(t,e),i&&this.setTransformForCurrent()}rotateDegrees(t,e=!0){const i=t*Math.PI/180;this.rotate(i,e)}rotateAbout(t,e,i,r=!0){this.translate(e,i,!1),this.rotate(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}rotateDegreesAbout(t,e,i,r=!0){this.translate(e,i,!1),this.rotateDegrees(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(t,e){t?"string"==typeof t?this.nativeContext.clip(t):this.nativeContext.clip(t,e):this.nativeContext.clip()}arc(t,e,i,r,o,n,s){if(s=s||0,this.camera){const a=[];((t,e,i,r,o,n,s,a)=>{if(a)for(;i>e;)i-=le;else for(;i<e;)i+=le;const l=ne/3*(i>e?1:-1);let h=e,c=h;for(;c!==i;){c=l>0?Math.min(c+l,i):Math.max(c+l,i);const e=Math.abs(c-h),a=4*Math.tan(e/4)/3,d=c<h?-1:1,u=Math.cos(h),g=Math.sin(h),p=Math.cos(c),f=Math.sin(c),m=u*n+r,b=g*s+o,y=p*n+r,C=f*s+o,w=n*a*d,v=s*a*d;t.push([m-w*g,b+v*u,y+w*f,C-v*p,y,C]),h=c}})(a,r,o,t,e,i,i,n);for(let t=0;t<a.length;++t){const e=a[t];this.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5],s)}}else this.nativeContext.arc(t,e,Math.max(0,i),r,o,n)}arcTo(t,e,i,r,o){this.nativeContext.arcTo(t,e,i,r,o)}bezierCurveTo(t,e,i,r,o,n,s){if(s=s||0,this.camera){let a=s,l=s;this.modelMatrix&&(Sa(wp,[t,e,s],this.modelMatrix),t=wp[0],e=wp[1],a=wp[2],Sa(wp,[i,r,s],this.modelMatrix),i=wp[0],r=wp[1],l=wp[2],Sa(wp,[o,n,s],this.modelMatrix),o=wp[0],n=wp[1],s=wp[2]);let h=this.camera.vp(o,n,s);o=h.x,n=h.y,h=this.camera.vp(t,e,a),t=h.x,e=h.y,h=this.camera.vp(i,r,l),i=h.x,r=h.y}this.nativeContext.bezierCurveTo(t,e,i,r,o,n)}closePath(){this.nativeContext.closePath()}ellipse(t,e,i,r,o,n,s,a){null==a?this.nativeContext.ellipse(t,e,i,r,o,n,s):this.nativeContext.ellipse(t,e,i,r,o,n,s,a)}lineTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Sa(wp,[t,e,i],this.modelMatrix),t=wp[0],e=wp[1],i=wp[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.lineTo(t,e)}moveTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Sa(wp,[t,e,i],this.modelMatrix),t=wp[0],e=wp[1],i=wp[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.moveTo(t,e)}quadraticCurveTo(t,e,i,r,o){if(o=o||0,this.camera){let n=o;this.modelMatrix&&(Sa(wp,[t,e,o],this.modelMatrix),t=wp[0],e=wp[1],n=wp[2],Sa(wp,[i,r,o],this.modelMatrix),i=wp[0],r=wp[1],o=wp[2]);let s=this.camera.vp(i,r,o);i=s.x,r=s.y,s=this.camera.vp(t,e,n),t=s.x,e=s.y}this.nativeContext.quadraticCurveTo(t,e,i,r)}rect(t,e,i,r,o){o=o||0,this.camera?(this.moveTo(t,e,o),this.lineTo(t+i,e,o),this.lineTo(t+i,e+r,o),this.lineTo(t,e+r,o),this.closePath()):this.nativeContext.rect(t,e,i,r)}createImageData(){const t=arguments;return 2===t.length?this.nativeContext.createImageData(t[0],t[1]):1===t.length?this.nativeContext.createImageData(t[0]):null}createLinearGradient(t,e,i,r){return isFinite(t+e+i+r)||(t=0,e=0,i=0,r=0),this.nativeContext.createLinearGradient(t,e,i,r)}createPattern(t,e){return 0===t.width||0===t.height?null:this.nativeContext.createPattern(t,e)}createRadialGradient(t,e,i,r,o,n){return this.nativeContext.createRadialGradient(t,e,i,r,o,n)}createConicGradient(t,e,i,r){if(this.nativeContext.createConicGradient&&Math.abs(r-i-2*Math.PI)<.001)return this.nativeContext.createConicGradient(i,t,e);let o,n=!1;const s=this;return{stops:[],addColorStop(t,e){this.stops.push([t,e]),n=!0},GetPattern(a,l,h){return n&&(h||(h=r-i),o=function(t,e,i,r,o,n,s,a,l){const h=Math.floor(180*o/Math.PI),c=Va.GetCanvas(),d=Va.GetCtx();if(!d)return null;const u=Ka.GetSize(a),g=Ka.GetSize(l);let p=Ka.Get(e,i,r,n,s,u,g);if(p)return p;const f=Math.sqrt(Math.max(Math.max(Math.pow(i,2)+Math.pow(r,2),Math.pow(u-i,2)+Math.pow(r,2)),Math.max(Math.pow(u-i,2)+Math.pow(g-r,2),Math.pow(i,2)+Math.pow(g-r,2)))),m=h+1,b=o/Math.max(1,m-1),y=Ua.getInstance().GetOrCreate(i,r,u,g,e,m),C=2*Math.PI*f/360;c.width=u,c.height=g,d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,u,g),d.translate(i,r),d.rotate(n);for(let t=0,e=m-1;t<e&&!(n+t*b>s);t++){const e=y.getColor(t);d.beginPath(),d.rotate(b),d.moveTo(0,0),d.lineTo(f,-2*C),d.lineTo(f,0),d.fillStyle=e,d.closePath(),d.fill()}const w=d.getImageData(0,0,u,g);return c.width=w.width,c.height=w.height,d.putImageData(w,0,0),p=t.createPattern(c,"no-repeat"),p&&Ka.Set(e,i,r,n,s,p,u,g),p}(s,this.stops,t,e,h,i,r,a,l),n=!1),o}}}fill(t,e){this.disableFill||(t?this.nativeContext.fill(t):this.nativeContext.fill())}fillRect(t,e,i,r){this.nativeContext.fillRect(t,e,i,r)}clearRect(t,e,i,r){this.nativeContext.clearRect(t,e,i,r)}project(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Sa(wp,[t,e,i],this.modelMatrix),t=wp[0],e=wp[1],i=wp[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}return{x:t,y:e}}view(t,e,i){return i=i||0,this.camera?(this.modelMatrix&&(Sa(wp,[t,e,i],this.modelMatrix),t=wp[0],e=wp[1],i=wp[2]),this.camera.view(t,e,i)):[t,e,i]}fillText(t,e,i,r){if(r=r||0,this.camera){this.modelMatrix&&(Sa(wp,[e,i,r],this.modelMatrix),e=wp[0],i=wp[1],r=wp[2]);const t=this.camera.vp(e,i,r);e=t.x,i=t.y}this.nativeContext.fillText(t,e,i)}getImageData(t,e,i,r){return this.nativeContext.getImageData(t,e,i,r)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(t,e){return this.nativeContext.isPointInPath(t,e)}isPointInStroke(t,e){return this.nativeContext.isPointInStroke(t,e)}measureText(t,e=D.global.measureTextMethod){var i,r;if(!e||"native"===e)return this.nativeContext.measureText(t);this.mathTextMeasure||(this.mathTextMeasure=D.graphicUtil.createTextMeasureInstance({},{},(()=>this.canvas.nativeCanvas)));const o=null!==(i=this.fontFamily)&&void 0!==i?i:vr.fontFamily,n=null!==(r=this.fontSize)&&void 0!==r?r:vr.fontSize;return this.mathTextMeasure.textSpec.fontFamily===o&&this.mathTextMeasure.textSpec.fontSize===n||(this.mathTextMeasure.textSpec.fontFamily=o,this.mathTextMeasure.textSpec.fontSize=n,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(t,e)}putImageData(t,e,i){this.nativeContext.putImageData(t,e,i)}setLineDash(t){const e=arguments,i=this.nativeContext;this.nativeContext.setLineDash?e[0]&&i.setLineDash(e[0]):"mozDash"in i?i.mozDash=e[0]:"webkitLineDash"in i&&(i.webkitLineDash=e[0])}stroke(t){this.disableStroke||(t?this.nativeContext.stroke(t):this.nativeContext.stroke())}strokeRect(t,e,i,r){this.nativeContext.strokeRect(t,e,i,r)}strokeText(t,e,i,r){if(r=r||0,this.camera){this.modelMatrix&&(Sa(wp,[e,i,r],this.modelMatrix),e=wp[0],i=wp[1],r=wp[2]);const t=this.camera.vp(e,i,r);e=t.x,i=t.y}this.nativeContext.strokeText(t,e,i)}drawImage(){const t=this.nativeContext,e=arguments;3===e.length?t.drawImage(e[0],e[1],e[2]):5===e.length?t.drawImage(e[0],e[1],e[2],e[3],e[4]):9===e.length&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(t,e,i,r,o){if(Array.isArray(o)){if(o.length<=1)return this._setCommonStyle(t,e,i,r,o[0]);const n=Object.create(o[0]);return o.forEach(((t,e)=>{0!==e&&Object.assign(n,t)})),this._setCommonStyle(t,e,i,r,n)}return this._setCommonStyle(t,e,i,r,o)}_setCommonStyle(t,e,i,r,o){const n=this.nativeContext;o||(o=this.fillAttributes);const{fillOpacity:s=o.fillOpacity,opacity:a=o.opacity,fill:l=o.fill}=e;n.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12&&(n.fillStyle=jr(this,l,t,i,r))}setShadowBlendStyle(t,e,i){if(Array.isArray(i)){if(i.length<=1)return this._setShadowBlendStyle(t,i[0]);const r=Object.create(i[0]);return i.forEach(((t,e)=>{0!==e&&Object.assign(r,t)})),this._setShadowBlendStyle(t,e,r)}return this._setShadowBlendStyle(t,e,i)}_setShadowBlendStyle(t,e,i){const r=this.nativeContext;i||(i=this.fillAttributes);const{opacity:o=i.opacity,shadowBlur:n=i.shadowBlur,shadowOffsetX:s=i.shadowOffsetX,shadowOffsetY:a=i.shadowOffsetY,blur:l=i.blur,globalCompositeOperation:h=i.globalCompositeOperation}=e;if(!(o<=1e-12)){if(s||a||n){const{shadowColor:t=i.shadowColor,shadowOffsetX:o=i.shadowOffsetX,shadowOffsetY:s=i.shadowOffsetY}=e;r.shadowBlur=n*this.dpr,r.shadowColor=t,r.shadowOffsetX=o*this.dpr,r.shadowOffsetY=s*this.dpr,this._clearShadowStyle=!0}else this._clearShadowStyle&&(r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0);l?(r.filter=`blur(${l}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(r.filter="blur(0px)",this._clearFilterStyle=!1),h?(r.globalCompositeOperation=h,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(r.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1)}}setStrokeStyle(t,e,i,r,o){if(Array.isArray(o)){if(o.length<=1)return this._setStrokeStyle(t,e,i,r,o[0]);const n=Object.create(o[0]);return o.forEach(((t,e)=>{0!==e&&Object.assign(n,t)})),this._setStrokeStyle(t,e,i,r,n)}return this._setStrokeStyle(t,e,i,r,o)}_setStrokeStyle(t,e,i,r,o){const n=this.nativeContext;o||(o=this.strokeAttributes);const{strokeOpacity:s=o.strokeOpacity,opacity:a=o.opacity}=e;if(n.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12){const{lineWidth:s=o.lineWidth,stroke:a=o.stroke,lineJoin:l=o.lineJoin,lineDash:h=o.lineDash,lineDashOffset:c=o.lineDashOffset,lineCap:d=o.lineCap,miterLimit:u=o.miterLimit,keepStrokeScale:g=o.keepStrokeScale}=e;n.lineWidth=g?s:Gr(this,s,this.dpr),n.strokeStyle=jr(this,a,t,i,r),n.lineJoin=l,h&&(n.setLineDash(h),n.lineDashOffset=c),n.lineCap=d,n.miterLimit=u}}setTextStyleWithoutAlignBaseline(t,e,i){const r=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:o=e.scaleIn3d}=t;t.font?this.font=t.font:this.font=Ie(t,e,o&&this.camera&&this.camera.getProjectionScale(i));const{fontFamily:n=e.fontFamily,fontSize:s=e.fontSize}=t;this.fontFamily=n,this.fontSize=s,r.textAlign="left",r.textBaseline="alphabetic"}setTextStyle(t,e,i){var r,o;const n=this.nativeContext;e||(e=this.textAttributes),t.font?this.font=t.font:this.font=Ie(t,e,this.camera&&this.camera.getProjectionScale(i));const{fontFamily:s=e.fontFamily,fontSize:a=e.fontSize}=t;this.fontFamily=s,this.fontSize=a,n.textAlign=null!==(r=t.textAlign)&&void 0!==r?r:e.textAlign,n.textBaseline=null!==(o=t.textBaseline)&&void 0!==o?o:e.textBaseline}draw(){}clearMatrix(t=!0,e=this.dpr){this.setTransformFromMatrix(this._clearMatrix,t,e)}setClearMatrix(t,e,i,r,o,n){this._clearMatrix.setValue(t,e,i,r,o,n)}onlyTranslate(t=this.dpr){return this.matrix.a===t&&0===this.matrix.b&&0===this.matrix.c&&this.matrix.d===t}release(...t){this.stack.forEach((t=>Ta.free(t))),this.stack.length=0}};vp.env="browser",vp=yp([f(),Cp("design:paramtypes",[Object,Number])],vp);var xp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},_p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Sp=class extends Fa{constructor(t){super(t)}init(t){const{container:e}=t;if("string"==typeof e){const t=D.global.getElementById(e);t&&(this._container=t)}else this._container=e;this._context=new vp(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:t}=this;t.width=this._pixelWidth,t.height=this._pixelHeight,!t.style||this.setCanvasStyle(t,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(t),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const t=this._nativeCanvas;t.style.position="absolute",t.style.top=`${this._y}px`,t.style.left=`${this._x}px`}resetStyle(t){if(!this.controled)return;const{width:e=this._displayWidth,height:i=this._displayHeight,dpr:r=this._dpr,x:o=this._x,y:n=this._y}=t,{nativeCanvas:s}=this;s.width=e*r,s.height=i*r,!s.style||this.setCanvasStyle(s,o,n,e,i),t.id&&(s.id=t.id),this.visiable||this.hide()}setCanvasStyle(t,e,i,r,o){this.controled&&(t.style.width=`${r}px`,t.style.height=`${o}px`)}toDataURL(t,e){return"image/jpeg"===t?this._nativeCanvas.toDataURL(t,e):"image/png"===t?this._nativeCanvas.toDataURL(t):this._nativeCanvas.toDataURL(t,e)}resize(t,e){this.controled&&(this._pixelWidth=t*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=t,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${t}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};function Ap(t,e){return new i((i=>{i(ao).toDynamicValue((()=>e=>new t(e))).whenTargetNamed(t.env),i(lo).toDynamicValue((()=>(t,i)=>new e(t,i))).whenTargetNamed(e.env)}))}Sp.env="browser",Sp=xp([f(),_p("design:paramtypes",[Object])],Sp);const Tp=Ap(Sp,vp);var Rp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Bp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mp=function(t,e){return function(i,r){e(i,r,t)}};let Pp=class extends fg{constructor(t,e,i,r){super(i,r),this.contributions=t,this.drawContribution=e,this.pickItemInterceptorContributions=i,this.pickServiceInterceptorContributions=r,this.global.hooks.onSetEnv.tap("canvas-picker-service",((t,e,i)=>{this.configure(i,e)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((t=>{this.pickerMap.set(t.numberType,t)})),super._init()}configure(t,e){this.pickCanvas=Do.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(t,e,i,r){if(!1===t.attribute.pickable)return null;if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const n=this.InterceptorContributions[o];if(n.beforePickItem){const o=n.beforePickItem(t,this,e,r,{parentMatrix:i});if(o)return o}}const o=this.pickerMap.get(t.numberType);if(!o)return null;const n=o.contains(t,e,r),s=n?t:null,a={graphic:s,params:n};if(s)return a;if(this.InterceptorContributions.length)for(let o=0;o<this.InterceptorContributions.length;o++){const n=this.InterceptorContributions[o];if(n.afterPickItem){const o=n.afterPickItem(t,this,e,r,{parentMatrix:i});if(o)return o}}return a}};Pp=Rp([f(),Mp(0,g(H)),Mp(0,m(dp)),Mp(1,g(Fd)),Mp(2,g(H)),Mp(2,m(tu)),Mp(3,g(H)),Mp(3,m(eu)),Bp("design:paramtypes",[Object,Object,Object,Object])],Pp);var Hp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let kp=class{constructor(){this.type="group",this.numberType=sa}contains(t,e,i){return!1}};kp=Hp([f()],kp);const Ep=new i(((t,e,i,r)=>{Ep.__vloaded||(Ep.__vloaded=!0,t(cp).to(kp).inSingletonScope(),t(dp).toService(cp),E(t,dp))}));Ep.__vloaded=!1;var Fp=Ep;const Lp=new i(((t,e,i,r)=>{i(Pp)||t(Pp).toSelf().inSingletonScope(),i(Jd)?r(Jd).toService(Pp):t(Jd).toService(Pp)}));var Ip,zp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Op=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Dp=Ip=class extends dg{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${Ip.idprefix}_${Ip.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=D.global,this.viewBox=new Ge,this.modelMatrix=new Ve(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch(t){}}isElementVisible(t){const e=t.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight;return!(e.right<0||e.bottom<0||e.left>i||e.top>r)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const t=new IntersectionObserver(((t,e)=>{t.forEach((t=>{this._canvasIsIntersecting!==t.isIntersecting?(this._canvasIsIntersecting=t.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(t.isIntersecting)):this._canvasIsIntersecting=t.isIntersecting}))}));t&&t.observe(this.canvas.nativeCanvas)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height});let i;if(i="string"==typeof t.container?this.global.getElementById(t.container):t.container?t.container:this.global.getRootElement(),!i)throw new Error("发生错误，containerId可能传入有误");t.offscreen?i=null:i.appendChild(e);const r={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,container:i,id:Ip.GenerateCanvasId(),canvasControled:!0};this.canvas=new Sp(r)}createWindowByCanvas(t){var e;let i;if("string"==typeof t.canvas){if(i=this.global.getElementById(t.canvas),!i)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else i=t.canvas;if(!i)throw new Error("发生错误，传入的canvas不正确");let r=t.width,o=t.height;if(null==r||null==o||!t.canvasControled){const t=i.getBoundingClientRect();r=t.width,o=t.height}let n=t.dpr;null==n&&(n=null!==(e=i.getContext("2d").pixelRatio)&&void 0!==e?e:i.width/r),this.canvas=new Sp({width:r,height:o,dpr:n,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(t,e,i){return this.canvas.nativeCanvas.addEventListener(t,e,i)}removeEventListener(t,e,i){return this.canvas.nativeCanvas.removeEventListener(t,e,i)}dispatchEvent(t){return this.canvas.nativeCanvas.dispatchEvent(t)}getStyle(){var t;return null!==(t=this.canvas.nativeCanvas.style)&&void 0!==t?t:{}}setStyle(t){this.canvas.nativeCanvas.style=t}getBoundingClientRect(){const t=this.canvas.nativeCanvas,e=this.getWH();return t.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:e.width,height:e.height,left:0,top:0,right:0,bottom:0}}clearViewBox(t){const e=this.viewBox,i=this.getContext(),r=this.getDpr();i.nativeContext.save(),i.nativeContext.setTransform(r,0,0,r,0,0),i.clearRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1),t&&(i.fillStyle=t,i.fillRect(e.x1,e.y1,e.x2-e.x1,e.y2-e.y1)),i.nativeContext.restore()}isVisible(t){return this._canvasIsIntersecting}onVisibleChange(t){this._onVisibleChangeCb=t}getTopLeft(t){return this.global.getElementTopLeft(this.canvas.nativeCanvas,t)}};Dp.env="browser",Dp.idprefix="visactor_window",Dp.prefix_count=0,Dp=Ip=zp([f(),Op("design:paramtypes",[])],Dp);const Wp=new i((t=>{t(Dp).toSelf(),t(jo).toDynamicValue((t=>t.container.get(Dp))).whenTargetNamed(Dp.env)}));var Np=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Gp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jp=function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};class Vp{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function Up(t,e=!1){const i=document.createElement("img");if(D.global.isImageAnonymous&&(i.crossOrigin="anonymous"),e){const e=new Blob([t],{type:"image/svg+xml"});t=window.URL.createObjectURL(e)}return i.src=t,i.complete?Promise.resolve(i):new Promise(((t,e)=>{i.onload=()=>{t(i)},i.onerror=()=>{e(new Error("加载失败"))}}))}let Kp=class extends lg{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch(t){this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(t,e){var i,r;let o=0,n=0,s=0,a=0;if(t.changedTouches){const e=null!==(i=t.changedTouches[0])&&void 0!==i?i:{};o=e.clientX||0,n=e.clientY||0,s=o,a=n}else o=t.clientX||0,n=t.clientY||0,s=t.offsetX||0,a=t.offsetY||0;if(e){const t=o,i=n,s=e.getBoundingClientRect(),a=null===(r=e.getNativeHandler)||void 0===r?void 0:r.call(e).nativeCanvas;let l,h;return a&&(l=s.width/a.offsetWidth,h=s.height/a.offsetHeight),{x:(t-s.left)/(mt(l)?l:1),y:(i-s.top)/(mt(h)?h:1)}}return{x:s,y:a}}getNativeAABBBounds(t){let e=t;if("string"==typeof t&&(e=(new DOMParser).parseFromString(t,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const t=e.getBoundingClientRect();return new Vp(t)}return new Ge}removeDom(t){return t.parentElement.removeChild(t),!0}updateDom(t,e){const{width:i,height:r,style:o}=e;return o&&(dt(o)?t.setAttribute("style",o):Object.keys(o).forEach((e=>{t.style[e]=o[e]}))),null!=i&&(t.style.width=`${i}px`),null!=r&&(t.style.height=`${r}px`),!0}createDom(t){const{tagName:e="div",parent:i}=t,r=document.createElement(e);if(this.updateDom(r,t),i){const t=dt(i)?this.getElementById(i):i;t&&t.appendChild&&t.appendChild(r)}return r}loadImage(t){return Up(t,!1).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadSvg(t){return Up(t,!0).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}createCanvas(t){var i,r;const o=document.createElement("canvas");t.id&&(o.id=null!==(i=t.id)&&void 0!==i?i:e.GenAutoIncrementId().toString());const n=null!==(r=t.dpr)&&void 0!==r?r:window.devicePixelRatio;return t.width&&t.height&&(o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.width=t.width*n,o.height=t.height*n),o}createOffscreenCanvas(t){var e;const i=null!==(e=t.dpr)&&void 0!==e?e:window.devicePixelRatio;return new OffscreenCanvas(t.width*i,t.height*i)}releaseCanvas(t){let e;e="string"==typeof t?document.getElementById(t):t,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(t,e,i){return document.addEventListener(t,e,i)}removeEventListener(t,e,i){return document.removeEventListener(t,e,i)}dispatchEvent(t){return document.dispatchEvent(t)}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}getDocument(){return document}release(...t){}getElementTop(t,e){let i=t.offsetTop,r=t.offsetParent;for(;null!==r;)i+=r.offsetTop,r=r.offsetParent;return i}getElementLeft(t,e){let i=t.offsetLeft,r=t.offsetParent;for(;null!==r;)i+=r.offsetLeft,r=r.offsetParent;return i}getElementTopLeft(t,e){let i=t.offsetTop,r=t.offsetLeft,o=t.offsetParent;for(;null!==o;)i+=o.offsetTop,r+=o.offsetLeft,o=o.offsetParent;return{top:i,left:r}}loadFont(t,e,i){return jp(this,void 0,void 0,(function*(){return new FontFace(t,dt(e)?`url(${e})`:e,i).load().then((function(t){return document.fonts.add(t),{loadState:"success"}})).catch((function(t){return{loadState:"fail"}}))}))}isMacOS(){if(void 0===this._isMacOS)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch(t){this._isMacOS=!1}return this._isMacOS}copyToClipBoard(t){return navigator.clipboard.writeText(t).then((()=>{})).catch((t=>{}))}};Kp=Np([f(),Gp("design:paramtypes",[])],Kp);const $p=new i((t=>{$p.isBrowserBound||($p.isBrowserBound=!0,t(Kp).toSelf().inSingletonScope(),t(z).toService(Kp))}));function Xp(t,e=!0){Xp.__loaded||(Xp.__loaded=!0,t.load($p),t.load(Tp),t.load(Wp),e&&function(t){t.load(Fp),t.load(Lp)}(t))}$p.isBrowserBound=!1,Xp.__loaded=!1;class Yp{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;if(!this.canvasRenderer)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.getGraphicTheme();r.highPerformanceSave();let{x:n=o.x,y:s=o.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);n+=e.x,s+=e.y,r.setTransformForCurrent()}else n=0,s=0,r.transformFromMatrix(t.transMatrix,!0);let a=!1,l=!1;return this.canvasRenderer.drawShape(t,r,n,s,{},null,((t,i,r,o)=>!(!a&&!l)||(a=t.isPointInPath(e.x,e.y),l=o||l,a)),((t,i,o,n)=>{if(a||l)return!0;const s=i.lineWidth||o.lineWidth,h=i.pickStrokeBuffer||o.pickStrokeBuffer,c=i.keepStrokeScale||o.keepStrokeScale;return r.lineWidth=c?s+h:Gr(r,s+h,r.dpr),a=t.isPointInStroke(e.x,e.y),l=n||l,a})),r.highPerformanceRestore(),a}}var qp=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Zp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jp=function(t,e){return function(i,r){e(i,r,t)}};let Qp=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=ia}};Qp=qp([f(),Jp(0,g(xd)),Zp("design:paramtypes",[Object])],Qp);let tf=!1;const ef=new i(((t,e,i,r)=>{tf||(tf=!0,t(Ug).to(Qp).inSingletonScope(),t(Vg).toService(Ug))}));var rf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},of=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},nf=function(t,e){return function(i,r){e(i,r,t)}};let sf=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=na}};sf=rf([f(),nf(0,g(_d)),of("design:paramtypes",[Object])],sf);let af=!1;const lf=new i(((t,e,i,r)=>{af||(af=!0,t(Kg).to(sf).inSingletonScope(),t(Vg).toService(Kg))}));var hf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let cf=class{constructor(){this.type="image",this.numberType=aa}contains(t,e,i){const{pickContext:r}=null!=i?i:{};return!!r&&!!t.AABBBounds.containsPoint(e)}};cf=hf([f()],cf);let df=!1;const uf=new i(((t,e,i,r)=>{df||(df=!0,t($g).to(cf).inSingletonScope(),t(cf).toService($g))}));var gf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},pf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ff=function(t,e){return function(i,r){e(i,r,t)}};let mf=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=la}};mf=gf([f(),ff(0,g(Td)),pf("design:paramtypes",[Object])],mf);let bf=!1;const yf=new i(((t,e,i,r)=>{bf||(bf=!0,t(Xg).to(mf).inSingletonScope(),t(Vg).toService(Xg))}));var Cf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},wf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vf=function(t,e){return function(i,r){e(i,r,t)}};let xf=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=ca}};xf=Cf([f(),vf(0,g(Bd)),wf("design:paramtypes",[Object])],xf);let _f=!1;const Sf=new i(((t,e,i,r)=>{_f||(_f=!0,t(Qg).to(xf).inSingletonScope(),t(Vg).toService(Qg))}));var Af=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Tf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Rf=function(t,e){return function(i,r){e(i,r,t)}};let Bf=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=ha}};Bf=Af([f(),Rf(0,g(Rd)),Tf("design:paramtypes",[Object])],Bf);let Mf=!1;const Pf=new i(((t,e,i,r)=>{Mf||(Mf=!0,t(Yg).to(Bf).inSingletonScope(),t(Vg).toService(Yg))})),Hf=new Ge;class kf{constructor(){this.type="rect",this.numberType=da}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.getGraphicTheme(),{cornerRadius:n=o.cornerRadius}=t.attribute;let{x:s=o.x,y:a=o.y}=t.attribute;r.highPerformanceSave();let l=!0;if(t.transMatrix.onlyTranslate()){const e=t.getOffsetXY(o);s+=e.x,a+=e.y,r.setTransformForCurrent()}else s=0,a=0,l=!1,r.transformFromMatrix(t.transMatrix,!0);let h=!0;if(!l||t.shadowRoot||ft(n,!0)&&0!==n||ut(n)&&n.some((t=>0!==t)))h=!1,this.canvasRenderer.drawShape(t,r,s,a,{},null,((t,i,r)=>!!h||(h=t.isPointInPath(e.x,e.y),h)),((t,i,o)=>{if(h)return!0;const n=i.lineWidth||o.lineWidth,s=i.pickStrokeBuffer||o.pickStrokeBuffer,a=i.keepStrokeScale||o.keepStrokeScale;return r.lineWidth=a?n+s:Gr(r,n+s,r.dpr),h=t.isPointInStroke(e.x,e.y),h}));else{const{fill:i=o.fill,stroke:r=o.stroke,lineWidth:n=o.lineWidth}=t.attribute;if(i)h=!0;else if(r){const i=t.AABBBounds;Hf.setValue(i.x1,i.y1,i.x2,i.y2),Hf.expand(-n/2),h=!Hf.containsPoint(e)}}return r.highPerformanceRestore(),h}}var Ef=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Ff=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lf=function(t,e){return function(i,r){e(i,r,t)}};let If=class extends kf{constructor(t){super(),this.canvasRenderer=t}};If=Ef([f(),Lf(0,g(Md)),Ff("design:paramtypes",[Object])],If);let zf=!1;const Of=new i(((t,e,i,r)=>{zf||(zf=!0,t(qg).to(If).inSingletonScope(),t(Vg).toService(qg))}));let Df=!1;const Wf=new i(((t,e,i,r)=>{Df||(Df=!0,t($g).to(cf).inSingletonScope(),t(cf).toService($g))}));var Nf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Gf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jf=function(t,e){return function(i,r){e(i,r,t)}};let Vf=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=ga}};Vf=Nf([f(),jf(0,g(Pd)),Gf("design:paramtypes",[Object])],Vf);let Uf=!1;const Kf=new i(((t,e,i,r)=>{Uf||(Uf=!0,t(Zg).to(Vf).inSingletonScope(),t(Vg).toService(Zg))}));var $f=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Xf=class{constructor(){this.type="text",this.numberType=pa}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};Xf=$f([f()],Xf);let Yf=!1;const qf=new i(((t,e,i,r)=>{Yf||(Yf=!0,t(Jg).to(Xf).inSingletonScope(),t(Vg).toService(Jg))}));var Zf=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Jf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let Qf=class extends vp{constructor(t,e){super(t,e);const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=i,this.canvas=t,this.matrix=new Ve(1,0,0,1,0,0),this.stack=[],this.dpr=null!=e?e:1}release(...t){}};Qf.env="node",Qf=Zf([f(),Jf("design:paramtypes",[Object,Number])],Qf);var tm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},em=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};let im=class extends Fa{constructor(t){super(t)}init(){this._context=new Qf(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...t){this._nativeCanvas.release&&ot(this._nativeCanvas.release)&&this._nativeCanvas.release()}};im.env="node",im=tm([f(),em("design:paramtypes",[Object])],im);const rm=Ap(im,Qf);var om=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},nm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sm=function(t,e){return function(i,r){e(i,r,t)}};let am=class extends dg{get container(){return null}constructor(t){super(),this.global=t,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t)}createWindowByConfig(t){const i=this.global.createCanvas({width:t.width,height:t.height}),r={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:i,id:e.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new im(r)}createWindowByCanvas(t){var e;const i=t.canvas,r=null!==(e=t.dpr)&&void 0!==e?e:1;let o=t.width,n=t.height;null!=o&&null!=n&&t.canvasControled||(o=i.width/r,n=i.height/r),this.canvas=new im({width:o,height:n,dpr:r,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(t="image/png"){return this.canvas.nativeCanvas.toBuffer(t)}addEventListener(t,e,i){}dispatchEvent(t){return!0}removeEventListener(t,e,i){}getStyle(){}setStyle(t){}getBoundingClientRect(){return null}clearViewBox(t){}};am.env="node",am=om([f(),sm(0,g(O)),nm("design:paramtypes",[Object])],am);const lm=new i((t=>{t(am).toSelf(),t(jo).toDynamicValue((t=>t.container.get(am))).whenTargetNamed(am.env)}));var hm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let cm=class extends lg{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(t,e){t.env===this.type&&(t.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(t){const e=fetch(t).then((t=>t.json()));return e.then((t=>({data:t,state:"success"}))).catch((()=>({data:null,state:"fail"}))),e}loadArrayBuffer(t){return fetch(t).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadImage(t){const{loadImage:e}=this.pkg;return e?e(t).then((t=>({loadState:t?"success":"fail",data:t}))).catch((()=>({loadState:"fail",data:null}))):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(t){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const i=new e(t).render().asPng();return this.loadImage(i)}createCanvas(t){return this.pkg.createCanvas(t.width,t.height)}releaseCanvas(t){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(t){return Hn.call(t)}}getCancelAnimationFrame(){return t=>{Hn.clear(t)}}addEventListener(t,e,i){}removeEventListener(t,e,i){}getElementById(t){return null}getRootElement(){return null}dispatchEvent(t){}release(...t){}createOffscreenCanvas(t){}};cm=hm([f()],cm);const dm=new i((t=>{dm.isNodeBound||(dm.isNodeBound=!0,t(cm).toSelf().inSingletonScope(),t(z).toService(cm))}));function um(t,e=!0){um.__loaded||(um.__loaded=!0,t.load(dm),t.load(rm),t.load(lm))}dm.isNodeBound=!1,um.__loaded=!1;var gm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},pm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},fm=function(t,e){return function(i,r){e(i,r,t)}};let mm=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=ia}};mm=gm([f(),fm(0,g(xd)),pm("design:paramtypes",[Object])],mm);let bm=!1;const ym=new i(((t,e,i,r)=>{bm||(bm=!0,t(tp).to(mm).inSingletonScope(),t(dp).toService(tp))}));var Cm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},wm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vm=function(t,e){return function(i,r){e(i,r,t)}};let xm=class extends kf{constructor(t){super(),this.canvasRenderer=t}};xm=Cm([f(),vm(0,g(Md)),wm("design:paramtypes",[Object])],xm);let _m=!1;const Sm=new i(((t,e,i,r)=>{_m||(_m=!0,t(np).to(xm).inSingletonScope(),t(dp).toService(np))}));class Am extends mc{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if("imprecise"===t.attribute.pickMode)return!0;const{pickContext:r}=null!=i?i:{};if(!r)return!1;r.highPerformanceSave();const o=t.getGraphicTheme(),n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,{},null,(t=>!!d||(d=t.isPointInPath(c.x,c.y),d)),((t,e,i)=>{if(d)return!0;const o=e.lineWidth||i.lineWidth,n=e.pickStrokeBuffer||i.pickStrokeBuffer,s=e.keepStrokeScale||i.keepStrokeScale;return r.lineWidth=s?o+n:Gr(r,o+n,r.dpr),d=t.isPointInStroke(c.x,c.y),d})),this.canvasRenderer.z=0,r.modelMatrix!==h&&Ra.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}}var Tm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Rm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bm=function(t,e){return function(i,r){e(i,r,t)}};let Mm=class extends Am{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=la}};Mm=Tm([f(),Bm(0,g(Td)),Rm("design:paramtypes",[Object])],Mm);let Pm=!1;const Hm=new i(((t,e,i,r)=>{Pm||(Pm=!0,t(rp).to(Mm).inSingletonScope(),t(dp).toService(rp))}));class km extends mc{contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.getGraphicTheme();r.highPerformanceSave();const n=this.transform(t,o,r),{x:s,y:a,z:l,lastModelMatrix:h}=n;let c=e;if(r.camera){c=e.clone();const i=t.parent.globalTransMatrix;c.x=i.a*e.x+i.c*e.y+i.e,c.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=l;let d=!1;return this.canvasRenderer.drawShape(t,r,s,a,i,null,((t,e,i)=>!!d||(d=t.isPointInPath(c.x,c.y),d))),this.canvasRenderer.z=0,r.modelMatrix!==h&&Ra.free(r.modelMatrix),r.modelMatrix=h,r.highPerformanceRestore(),d}}var Em=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Fm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lm=function(t,e){return function(i,r){e(i,r,t)}};let Im=class extends km{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=ga}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.getParsedPath();if(!r.camera){if(!t.AABBBounds.containsPoint(e))return!1;if(o.isSvg||"imprecise"===t.attribute.pickMode)return!0}r.highPerformanceSave();const n=t.getGraphicTheme(),s=this.transform(t,n,r),{x:a,y:l,z:h,lastModelMatrix:c}=s;let d=e;if(r.camera){d=e.clone();const i=t.parent.globalTransMatrix;d.x=i.a*e.x+i.c*e.y+i.e,d.y=i.b*e.x+i.d*e.y+i.f}this.canvasRenderer.z=h;let u=!1;return this.canvasRenderer.drawShape(t,r,a,l,{},null,((t,e,i)=>!!u||(u=t.isPointInPath(d.x,d.y),u)),((t,e,i)=>{if(u)return!0;const o=e.lineWidth||i.lineWidth,n=e.pickStrokeBuffer||i.pickStrokeBuffer,s=e.keepStrokeScale||i.keepStrokeScale;return r.lineWidth=s?o+n:Gr(r,o+n,r.dpr),u=t.isPointInStroke(d.x,d.y),u})),this.canvasRenderer.z=0,r.modelMatrix!==c&&Ra.free(r.modelMatrix),r.modelMatrix=c,r.highPerformanceRestore(),u}};Im=Em([f(),Lm(0,g(Pd)),Fm("design:paramtypes",[Object])],Im);let zm=!1;const Om=new i(((t,e,i,r)=>{zm||(zm=!0,t(sp).to(Im).inSingletonScope(),t(dp).toService(sp))}));var Dm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Wm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Nm=function(t,e){return function(i,r){e(i,r,t)}};let Gm=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=na}};Gm=Dm([f(),Nm(0,g(_d)),Wm("design:paramtypes",[Object])],Gm);let jm=!1;const Vm=new i(((t,e,i,r)=>{jm||(jm=!0,t(ep).to(Gm).inSingletonScope(),t(dp).toService(ep))}));var Um=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Km=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$m=function(t,e){return function(i,r){e(i,r,t)}};let Xm=class extends km{constructor(t){super(),this.canvasRenderer=t,this.type="text",this.numberType=pa}contains(t,e,i){const{pickContext:r}=null!=i?i:{};if(!r)return!1;const o=t.AABBBounds;if(!r.camera)return!!o.containsPoint(e);r.highPerformanceSave();const n=t.getGraphicTheme(),{keepDirIn3d:s=n.keepDirIn3d}=t.attribute,a=!s,l=this.transform(t,n,r,a),{x:h,y:c,z:d,lastModelMatrix:u}=l;this.canvasRenderer.z=d;let g=e;if(r.camera){g=e.clone();const i=t.parent.globalTransMatrix;g.x=i.a*e.x+i.c*e.y+i.e,g.y=i.b*e.x+i.d*e.y+i.f}let p=!1;return this.canvasRenderer.drawShape(t,r,h,c,{},null,((e,i,r)=>{if(p)return!0;const{fontSize:o=n.fontSize,textBaseline:s=n.textBaseline,textAlign:a=n.textAlign}=t.attribute,l=t.AABBBounds,u=l.height(),f=l.width(),m=Ol(s,u,o),b=zl(a,f);return e.rect(b+h,m+c,f,u,d),p=e.isPointInPath(g.x,g.y),p}),((t,e,i)=>p)),this.canvasRenderer.z=0,r.modelMatrix!==u&&Ra.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),p}};Xm=Um([f(),$m(0,g(Hd)),Km("design:paramtypes",[Object])],Xm);let Ym=!1;const qm=new i(((t,e,i,r)=>{Ym||(Ym=!0,t(ap).to(Xm).inSingletonScope(),t(dp).toService(ap))}));var Zm=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},Jm=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Qm=function(t,e){return function(i,r){e(i,r,t)}};let tb=class extends Am{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=ha}};tb=Zm([f(),Qm(0,g(Rd)),Jm("design:paramtypes",[Object])],tb);let eb=!1;const ib=new i(((t,e,i,r)=>{eb||(eb=!0,t(op).to(tb).inSingletonScope(),t(dp).toService(op))}));var rb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},ob=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},nb=function(t,e){return function(i,r){e(i,r,t)}};let sb=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=ca}};sb=rb([f(),nb(0,g(Bd)),ob("design:paramtypes",[Object])],sb);let ab=!1;const lb=new i(((t,e,i,r)=>{ab||(ab=!0,t(lp).to(sb).inSingletonScope(),t(dp).toService(lp))}));var hb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},cb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},db=function(t,e){return function(i,r){e(i,r,t)}};let ub=class{constructor(t){this.canvasRenderer=t,this.type="richtext",this.numberType=ua}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};ub=hb([f(),db(0,g(kd)),cb("design:paramtypes",[Object])],ub);let gb=!1;const pb=new i(((t,e,i,r)=>{gb||(gb=!0,t(hp).to(ub).inSingletonScope(),t(dp).toService(hp))}));var fb=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s},mb=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bb=function(t,e){return function(i,r){e(i,r,t)}};let yb=class extends Yp{constructor(t){super(),this.canvasRenderer=t,this.type="image",this.numberType=aa}};yb=fb([f(),bb(0,g(Ed)),mb("design:paramtypes",[Object])],yb);let Cb=!1;const wb=new i(((t,e,i,r)=>{Cb||(Cb=!0,t(ip).to(yb).inSingletonScope(),t(dp).toService(ip))}));var vb={},xb={},_b={};Object.defineProperty(_b,"__esModule",{value:!0}),_b.loop=_b.conditional=_b.parse=void 0;_b.parse=function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;if(Array.isArray(i))i.forEach((function(i){return t(e,i,r,o)}));else if("function"==typeof i)i(e,r,o,t);else{var n=Object.keys(i)[0];Array.isArray(i[n])?(o[n]={},t(e,i[n],r,o[n])):o[n]=i[n](e,r,o,t)}return r};_b.conditional=function(t,e){return function(i,r,o,n){e(i,r,o)&&n(i,t,r,o)}};_b.loop=function(t,e){return function(i,r,o,n){for(var s=[],a=i.pos;e(i,r,o);){var l={};if(n(i,t,r,l),i.pos===a)break;a=i.pos,s.push(l)}return s}};var Sb={};Object.defineProperty(Sb,"__esModule",{value:!0}),Sb.readBits=Sb.readArray=Sb.readUnsigned=Sb.readString=Sb.peekBytes=Sb.readBytes=Sb.peekByte=Sb.readByte=Sb.buildStream=void 0;Sb.buildStream=function(t){return{data:t,pos:0}};var Ab=function(){return function(t){return t.data[t.pos++]}};Sb.readByte=Ab;Sb.peekByte=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(e){return e.data[e.pos+t]}};var Tb=function(t){return function(e){return e.data.subarray(e.pos,e.pos+=t)}};Sb.readBytes=Tb;Sb.peekBytes=function(t){return function(e){return e.data.subarray(e.pos,e.pos+t)}};Sb.readString=function(t){return function(e){return Array.from(Tb(t)(e)).map((function(t){return String.fromCharCode(t)})).join("")}};Sb.readUnsigned=function(t){return function(e){var i=Tb(2)(e);return t?(i[1]<<8)+i[0]:(i[0]<<8)+i[1]}};Sb.readArray=function(t,e){return function(i,r,o){for(var n="function"==typeof e?e(i,r,o):e,s=Tb(t),a=new Array(n),l=0;l<n;l++)a[l]=s(i);return a}};Sb.readBits=function(t){return function(e){for(var i=function(t){return t.data[t.pos++]}(e),r=new Array(8),o=0;o<8;o++)r[7-o]=!!(i&1<<o);return Object.keys(t).reduce((function(e,i){var o=t[i];return o.length?e[i]=function(t,e,i){for(var r=0,o=0;o<i;o++)r+=t[e+o]&&Math.pow(2,i-o-1);return r}(r,o.index,o.length):e[i]=r[o.index],e}),{})}},function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=_b,i=Sb,r={blocks:function(t){for(var e=[],r=t.data.length,o=0,n=(0,i.readByte)()(t);0!==n&&n;n=(0,i.readByte)()(t)){if(t.pos+n>=r){var s=r-t.pos;e.push((0,i.readBytes)(s)(t)),o+=s;break}e.push((0,i.readBytes)(n)(t)),o+=n}for(var a=new Uint8Array(o),l=0,h=0;h<e.length;h++)a.set(e[h],l),l+=e[h].length;return a}},o=(0,e.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&249===e[1]})),n=(0,e.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,e.conditional)({lct:(0,i.readArray)(3,(function(t,e,i){return Math.pow(2,i.descriptor.lct.size+1)}))},(function(t,e,i){return i.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},r]}]},(function(t){return 44===(0,i.peekByte)()(t)})),s=(0,e.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(t,e,r){return(0,i.readBytes)(r.text.blockSize)(t)}},r]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&1===e[1]})),a=(0,e.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(t,e,r){return(0,i.readString)(r.blockSize)(t)}},r]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&255===e[1]})),l=(0,e.conditional)({comment:[{codes:(0,i.readBytes)(2)},r]},(function(t){var e=(0,i.peekBytes)(2)(t);return 33===e[0]&&254===e[1]})),h=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,e.conditional)({gct:(0,i.readArray)(3,(function(t,e){return Math.pow(2,e.lsd.gct.size+1)}))},(function(t,e){return e.lsd.gct.exists})),{frames:(0,e.loop)([o,a,l,n,s],(function(t){var e=(0,i.peekByte)()(t);return 33===e||44===e}))}],c=h;t.default=c}(xb);var Rb={};Object.defineProperty(Rb,"__esModule",{value:!0}),Rb.deinterlace=void 0;Rb.deinterlace=function(t,e){for(var i=new Array(t.length),r=t.length/e,o=function(r,o){var n=t.slice(o*e,(o+1)*e);i.splice.apply(i,[r*e,e].concat(n))},n=[0,4,2,1],s=[8,8,4,2],a=0,l=0;l<4;l++)for(var h=n[l];h<r;h+=s[l])o(h,a),a++;return i};var Bb={};Object.defineProperty(Bb,"__esModule",{value:!0}),Bb.lzw=void 0;Bb.lzw=function(t,e,i){var r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y,C=4096,w=i,v=new Array(i),x=new Array(C),_=new Array(C),S=new Array(4097);for(a=(o=1<<(u=t))+1,r=o+2,h=-1,n=(1<<(s=u+1))-1,c=0;c<o;c++)x[c]=0,_[c]=c;for(g=p=f=m=b=y=0,d=0;d<w;){if(0===m){if(p<s){g+=e[y]<<p,p+=8,y++;continue}if(c=g&n,g>>=s,p-=s,c>r||c==a)break;if(c==o){n=(1<<(s=u+1))-1,r=o+2,h=-1;continue}if(-1==h){S[m++]=_[c],h=c,f=c;continue}for(l=c,c==r&&(S[m++]=f,c=h);c>o;)S[m++]=_[c],c=x[c];f=255&_[c],S[m++]=f,r<C&&(x[r]=h,_[r]=f,0==(++r&n)&&r<C&&(s++,n+=r)),h=l}m--,v[b++]=S[m],d++}for(d=b;d<w;d++)v[d]=0;return v},Object.defineProperty(vb,"__esModule",{value:!0});var Mb=vb.decompressFrames=vb.decompressFrame=Lb=vb.parseGIF=void 0,Pb=function(t){return t&&t.__esModule?t:{default:t}}(xb),Hb=_b,kb=Sb,Eb=Rb,Fb=Bb;var Lb=vb.parseGIF=function(t){var e=new Uint8Array(t);return(0,Hb.parse)((0,kb.buildStream)(e),Pb.default)},Ib=function(t,e,i){if(t.image){var r=t.image,o=r.descriptor.width*r.descriptor.height,n=(0,Fb.lzw)(r.data.minCodeSize,r.data.blocks,o);r.descriptor.lct.interlaced&&(n=(0,Eb.deinterlace)(n,r.descriptor.width));var s={pixels:n,dims:{top:t.image.descriptor.top,left:t.image.descriptor.left,width:t.image.descriptor.width,height:t.image.descriptor.height}};return r.descriptor.lct&&r.descriptor.lct.exists?s.colorTable=r.lct:s.colorTable=e,t.gce&&(s.delay=10*(t.gce.delay||10),s.disposalType=t.gce.extras.disposal,t.gce.extras.transparentColorGiven&&(s.transparentIndex=t.gce.transparentColorIndex)),i&&(s.patch=function(t){for(var e=t.pixels.length,i=new Uint8ClampedArray(4*e),r=0;r<e;r++){var o=4*r,n=t.pixels[r],s=t.colorTable[n]||[0,0,0];i[o]=s[0],i[o+1]=s[1],i[o+2]=s[2],i[o+3]=n!==t.transparentIndex?255:0}return i}(s)),s}};vb.decompressFrame=Ib;Mb=vb.decompressFrames=function(t,e){return t.frames.filter((function(t){return t.image})).map((function(i){return Ib(i,t.gct,e)}))};const zb=ig();function Ob(){Ob.__loaded||(Ob.__loaded=!0,Fh.RegisterGraphicCreator("arc",Bh),so.load(bg),so.load(zb?ym:ef))}Ob.__loaded=!1;const Db=Ob;function Wb(){Wb.__loaded||(Wb.__loaded=!0,Fh.RegisterGraphicCreator("circle",$l),so.load(Ag),so.load(zb?Vm:lf))}Wb.__loaded=!1;const Nb=Wb;function Gb(){Gb.__loaded||(Gb.__loaded=!0,Fh.RegisterGraphicCreator("group",ol))}Gb.__loaded=!1;const jb=Gb;function Vb(){Vb.__loaded||(Vb.__loaded=!0,Fh.RegisterGraphicCreator("image",fh),so.load(Og),so.load(zb?wb:uf))}Vb.__loaded=!1;const Ub=Vb;function Kb(){Kb.__loaded||(Kb.__loaded=!0,Fh.RegisterGraphicCreator("line",sh),so.load(vg),so.load(zb?Hm:yf))}Kb.__loaded=!1;const $b=Kb;function Xb(){Xb.__loaded||(Xb.__loaded=!0,Fh.RegisterGraphicCreator("path",Ah),so.load(Mg),so.load(zb?ib:Pf))}Xb.__loaded=!1;const Yb=Xb;function qb(){qb.__loaded||(qb.__loaded=!0,Fh.RegisterGraphicCreator("polygon",Hh),so.load(Hg),so.load(zb?lb:Sf))}qb.__loaded=!1;const Zb=qb;function Jb(){Jb.__loaded||(Jb.__loaded=!0,Fh.RegisterGraphicCreator("rect",hh),so.load(Cg),so.load(zb?Sm:Of))}Jb.__loaded=!1;const Qb=Jb;function ty(){ty.__loaded||(ty.__loaded=!0,Fh.RegisterGraphicCreator("richtext",xh),so.load(Ig),so.load(zb?pb:Wf))}ty.__loaded=!1;const ey=ty;function iy(){iy.__loaded||(iy.__loaded=!0,Fh.RegisterGraphicCreator("shadowRoot",Eh))}iy.__loaded=!1;const ry=iy;function oy(){oy.__loaded||(oy.__loaded=!0,Fh.RegisterGraphicCreator("symbol",rh),so.load(_g),so.load(zb?Om:Kf))}oy.__loaded=!1;const ny=oy;function sy(){sy.__loaded||(sy.__loaded=!0,Fh.RegisterGraphicCreator("text",Zl),so.load(Rg),so.load(zb?qm:qf))}sy.__loaded=!1;const ay=sy;function ly(){ly.__loaded||(ly.__loaded=!0,Fh.RegisterGraphicCreator("wrapText",th))}ly.__loaded=!1;const hy=ly;function cy(){jb(),Qb()}const dy="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol";var uy;!function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(uy||(uy={}));const gy={[uy.selectedReverse]:{},[uy.selected]:{},[uy.hover]:{},[uy.hoverReverse]:{}},py={container:"",width:30,height:30,style:{}};function fy(){return"browser"===ju.env?["pointerup","pointerleave","pointercancel"]:["pointerup","pointerleave","pointerupoutside"]}const my={debounce:te,throttle:ee};cy();class by extends jg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},by.defaultAttributes,t)),this.name="scrollbar",this._handleTouchMove=t=>{st(this._prePos)&&t.preventDefault()},this._onRailPointerDown=t=>{const{viewX:e,viewY:i}=t,{direction:r,width:o,height:n,range:s}=this.attribute,a=this._sliderSize,[l,h]=this._getScrollRange();let c;if("vertical"===r){const t=i-this._viewPosition.y,e=Zt(t-a/2,l,h);c=t/n,this._slider.setAttribute("y",e,!0)}else{const t=e-this._viewPosition.x,i=Zt(t-a/2,l,h);c=t/o,this._slider.setAttribute("x",i,!0)}this.setScrollRange([c-(s[1]-s[0])/2,c+(s[1]-s[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=t=>{this._clearDragEvents();const{stopSliderDownPropagation:e=!0}=this.attribute;e&&t.stopPropagation();const{direction:i}=this.attribute,{x:r,y:o}=this.stage.eventPointTransform(t);this._prePos="horizontal"===i?r:o,this._dispatchEvent("scrollDown",{pos:this._prePos,event:t});const n=fy(),s="browser"===ju.env?ju:this.stage;s.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),n.forEach((t=>{s.addEventListener(t,this._onSliderPointerUp)}))},this._computeScrollValue=t=>{const{direction:e}=this.attribute,{x:i,y:r}=this.stage.eventPointTransform(t);let o,n,s=0;const{width:a,height:l}=this.getSliderRenderBounds();return"vertical"===e?(n=r,s=n-this._prePos,o=s/l):(n=i,s=n-this._prePos,o=s/a),[n,o]},this._onSliderPointerMove=t=>{const{stopSliderMovePropagation:e=!0}=this.attribute;e&&t.stopPropagation();const i=this.getScrollRange(),[r,o]=this._computeScrollValue(t);this.setScrollRange([i[0]+o,i[1]+o],!0),this._prePos=r},this._onSliderPointerMoveWithDelay=0===this.attribute.delayTime?this._onSliderPointerMove:my[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=t=>{const{range:e,limitRange:i=[0,1]}=this.attribute,r=this.getScrollRange(),[o,n]=this._computeScrollValue(t),s=[r[0]+n,r[1]+n];this._prePos=null,this._dispatchEvent("scrollUp",{pre:e,value:Jt(s,i[0],i[1])}),this._clearDragEvents()}}setScrollRange(t,e=!0){const{direction:i="horizontal",limitRange:r=[0,1],range:o,realTime:n=!0}=this.attribute,s=Jt(t,r[0],r[1]);if(e){const t=this._getSliderPos(s);if(this._slider){const e=t[1]-t[0];this._sliderSize=e,"horizontal"===i?this._slider.setAttributes({x:t[0],width:e},!0):this._slider.setAttributes({y:t[0],height:e},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=s,n&&this._dispatchEvent("scrollDrag",{pre:o,value:s})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",my[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown),("browser"===ju.env?ju:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1})}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:r,limitRange:o=[0,1],railStyle:n,sliderStyle:s,padding:a=2}=this.attribute,l=this.createOrUpdateChild("scrollbar-container",{},"group"),h=l.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},n),"rect");this._rail=h;const c=this.getSliderRenderBounds(),d=this._getSliderPos(Jt(r,o[0],o[1])),u=d[1]-d[0];let g;this._sliderSize=u,g="horizontal"===t?{x:d[0],y:c.y1,width:u,height:c.height}:{x:c.x1,y:d[0],width:c.width,height:u};const p=l.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},g),{cornerRadius:this._getDefaultSliderCornerRadius()}),s),{boundsPadding:ni(a),pickMode:"imprecise"}),"rect");this._slider=p,this._container=l;const f=this._container.AABBBounds;this._viewPosition={x:f.x1,y:f.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[r,o,n,s]=ni(i),a={x1:s,y1:r,x2:t-o,y2:e-n,width:Math.max(0,t-(s+o)),height:Math.max(0,e-(r+n))};return this._sliderRenderBounds=a,a}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:e,height:i}=this.getSliderRenderBounds();return"horizontal"===t?i:e}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:r,x1:o,y1:n}=this.getSliderRenderBounds();return"horizontal"===e?[i*t[0]+o,i*t[1]+o]:[r*t[0]+n,r*t[1]+n]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,r]=Jt(t,0,1),{width:o,height:n,x1:s,y1:a}=this.getSliderRenderBounds(),l=this._sliderSize;return"horizontal"===e?Jt([s+i*o,s+r*o],s,o-l):Jt([a+i*n,a+r*n],a,n-l)}_clearDragEvents(){const t=fy(),e="browser"===ju.env?ju:this.stage;e.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),t.forEach((t=>{e.removeEventListener(t,this._onSliderPointerUp)}))}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}release(t){super.release(t),("browser"===ju.env?ju:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearDragEvents()}}function yy(t,e){t.forEachChildren((t=>{const i=e(t);t.isContainer&&!i&&yy(t,e)}))}function Cy(t,e){return[t[0]*e,t[1]*e]}function wy(t){const[e,i]=t;return Math.sqrt(e*e+i*i)}function vy(t,e,i){const r=function(t,e){const[i,r]=t,[o,n]=e,s=Math.sqrt((i*i+r*r)*(o*o+n*n)),a=s&&(i*o+r*n)/s;return Math.acos(Math.min(Math.max(a,-1),1))}(t,e),o=(s=e,(n=t)[0]*s[1]-n[1]*s[0]>=0);var n,s;return i?o?2*Math.PI-r:r:o?r:2*Math.PI-r}by.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};const xy=(t,e,i,r)=>new ze(Object.assign({defaultFontParams:Object.assign({fontFamily:dy,fontSize:14},r),getTextBounds:i?void 0:Ih,specialCharSet:"-/: .,@%'\"~"+ze.ALPHABET_CHAR_SET+ze.ALPHABET_CHAR_SET.toUpperCase()},null!=e?e:{}),t);function _y(t,e,i={}){if(!t)return{width:0,height:0};const r=Ih({text:t,fontFamily:e.fontFamily||i.fontFamily||dy,fontSize:e.fontSize||i.fontSize||12,fontWeight:e.fontWeight||i.fontWeight,textAlign:e.textAlign||"center",textBaseline:e.textBaseline,ellipsis:!!e.ellipsis,maxLineWidth:e.maxLineWidth||1/0,lineHeight:e.fontSize||i.fontSize||12});return{width:r.width(),height:r.height()}}function Sy(t,e="type"){var i,r;return at(t.text)&&"type"in t.text?null!==(i=t.text.type)&&void 0!==i?i:"text":e in t&&null!==(r=t[e])&&void 0!==r?r:"text"}function Ay(t){var e,i;return st(t.maxLineWidth)&&(t.maxWidth=t.maxLineWidth,delete t.maxLineWidth),t.width=null!==(e=t.width)&&void 0!==e?e:0,t.height=null!==(i=t.height)&&void 0!==i?i:0,t.textConfig=t.text.text||t.text,t}function Ty(t,e="type"){const i=Sy(t,e);return"rich"===i?Fh.richtext(Ay(t)):("html"===i?t=function(t){const{text:e,_originText:i}=t,{text:r}=e;return t.html=r,t.text=i,t.renderable=!1,t}(t):"react"===i&&(t=function(t){const{text:e,_originText:i}=t,{text:r}=e;return t.react=r,t.text=i,t.renderable=!1,t}(t)),Fh.text(t))}function Ry(){jb(),Qb(),ny(),ey(),ay()}var By=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};Ry();let My=class t extends jg{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Ht({},t.defaultAttributes,e)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:r="",textStyle:o={},shape:n={},panel:s={},space:a=4,minWidth:l,maxWidth:h,padding:c=4,visible:d,state:u,type:g,textAlwaysCenter:p,containerTextAlign:f}=this.attribute,m=ni(c),b=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let y,C=-m[3],w=-m[0],v=m[1]+m[3],x=m[0]+m[2],_=0,S=0;const{visible:A}=n,T=By(n,["visible"]);if(rt(A)){const t=(null==T?void 0:T.size)||10,e=ft(t)?t:Math.max(t[0],t[1]);y=b.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:t,strokeBoundsBuffer:0},T),{visible:A,x:e/2,y:e/2}),"symbol"),_t(null==u?void 0:u.shape)||(y.states=u.shape),A&&(S=e+a)}let R,B,M;if(v+=S,_+=S,function(t,e="type"){return"rich"===Sy(t,e)}({text:r})||"rich"===g){const t=Object.assign(Object.assign(Object.assign({},Ay(Object.assign({type:g,text:r},o))),o),{visible:st(r)&&!1!==d,x:_,y:0});nt(t.lineHeight)&&(t.lineHeight=o.fontSize),R=b.createOrUpdateChild("tag-text",t,"richtext"),B=R.AABBBounds.width(),M=R.AABBBounds.height()}else{const i=Object.assign(Object.assign({text:at(r)&&"type"in r&&"text"===r.type?r.text:r,visible:st(r)&&!1!==d,lineHeight:null==o?void 0:o.fontSize},o),{x:_,y:0});nt(i.lineHeight)&&(i.lineHeight=o.fontSize),R=b.createOrUpdateChild("tag-text",i,"text");const n=_y(i.text,o,null===(e=null===(t=this.stage)||void 0===t?void 0:t.getTheme())||void 0===e?void 0:e.text);B=n.width,M=n.height}v+=B;const P=null!==(i=n.size)&&void 0!==i?i:10,H=ft(P)?P:Math.max(P[0],P[1]);x+=Math.max(M,n.visible?H:0);const{textAlign:k,textBaseline:E}=o;(st(l)||st(h))&&(st(l)&&v<l&&(v=l),st(h)&&v>h&&(v=h,R.setAttribute("maxLineWidth",h-m[1]-m[2]))),C=0,w=0;let F=0;"left"===k||"start"===k?F=1:"right"===k||"end"===k?F=-1:"center"===k&&(F=0),F?F<0?(C-=v,y&&y.setAttribute("x",(y.attribute.x||0)-B),b.setAttribute("x",-m[1]-S)):F>0&&b.setAttribute("x",m[3]):(C-=v/2,y&&y.setAttribute("x",(y.attribute.x||0)-B/2),b.setAttribute("x",-S/2));const L="right"===f||"end"===f,I="left"===f||"start"===f,z=(t,e)=>{"richtext"===R.type?R.setAttributes({x:t,textAlign:e,textConfig:zt(R.attribute.textConfig).map((t=>Object.assign(Object.assign({},t),{textAlign:e})))}):R.setAttributes({x:t,textAlign:e})};if((f?"center"===f:p)&&F){const t=v-m[1]-m[3],e=B+S,i=1===F?(t-e)/2+S+B/2:m[0]+S-(v/2+e/2-S)+B/2;if(z(i,"center"),y){const t=i-B/2-S+H/2;y.setAttributes({x:t})}}if(I&&1!==F){const t=v-m[1]-m[3],e=0===F?-t/2+S/2:-v+m[3]+m[1]+S;if(z(e+S,"left"),y){const t=e+H/2;y.setAttributes({x:t})}}if(L&&-1!==F){const t=v-m[1]-m[3],e=0===F?t/2+S/2:t;if(z(e,"right"),y){const t=e-B-S+H/2;y.setAttributes({x:t})}}"middle"===E?(w-=x/2,y&&y.setAttribute("y",0)):"bottom"===E?(w-=x,y&&y.setAttribute("y",-M/2),b.setAttribute("y",-m[2])):"top"===E&&(b.setAttribute("y",m[0]),y&&y.setAttribute("y",M/2)),_t(null==u?void 0:u.text)||(R.states=u.text);const{visible:O}=s,D=By(s,["visible"]);if(d&&rt(O)){const t=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},D),{visible:O&&!!r,width:v,height:x,x:C,y:w}),"rect");if(_t(null==u?void 0:u.panel)||(t.states=u.panel),D.customShape){const e=D.customShape;t.pathProxy=t=>e(this,t,new pr)}this._bgRect=t}this._textShape=R,this._symbol=y,this.resetStates()}initAttributes(e,i){e=(null==i?void 0:i.skipDefault)?e:Ht({},t.defaultAttributes,e),super.initAttributes(e),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,r,o,n,s,a,l,h,c,d,u,g;this._tagStates=null!==(e=null===(t=this.currentStates)||void 0===t?void 0:t.slice())&&void 0!==e?e:[],this._rectStates=null!==(o=null===(r=null===(i=this._bgRect)||void 0===i?void 0:i.currentStates)||void 0===r?void 0:r.slice())&&void 0!==o?o:[],this._symbolStates=null!==(a=null===(s=null===(n=this._symbol)||void 0===n?void 0:n.currentStates)||void 0===s?void 0:s.slice())&&void 0!==a?a:[],this._textStates=null!==(c=null===(h=null===(l=this._textShape)||void 0===l?void 0:l.currentStates)||void 0===h?void 0:h.slice())&&void 0!==c?c:[],this.clearStates(),null===(d=this._bgRect)||void 0===d||d.clearStates(),null===(u=this._symbol)||void 0===u||u.clearStates(),null===(g=this._textShape)||void 0===g||g.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&(null===(t=this._bgRect)||void 0===t||t.useStates(this._rectStates)),this._symbolStates.length&&(null===(e=this._symbol)||void 0===e||e.useStates(this._symbolStates)),this._textStates.length&&(null===(i=this._textShape)||void 0===i||i.useStates(this._textStates))}};My.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const Py={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},Hy={poptip:Ht({},Py)};var ky=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};const Ey=new Ge;jb(),ay(),ny(),Qb();const Fy="M -0.5 -0.5, L -0.5 0.5, L 0.5 -0.5, Z",Ly="M -0.5 -0.5, L -0.5 0.5, L 0.5 0.5, Z",Iy="M -0.5 -0.5, L 0.5 -0.5, L 0.5 0.5, Z",zy="M 0.5 -0.5, L 0.5 0.5, L -0.5 0.5, Z",Oy={tl:Fy,tr:Iy,bl:Ly,br:zy,lt:Fy,lb:Ly,rt:Iy,rb:zy};class Dy extends jg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},Dy.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,r,o,n,s,a,l;const{titleStyle:h={},position:c,contentStyle:d={},panel:u,logoSymbol:g,poptipAnchor:p="position",logoText:f,logoTextStyle:m={},triangleMode:b="default",space:y=4,minWidth:C=0,maxWidth:w=1/0,padding:v=4,maxWidthPercent:x,visible:_,state:S,dx:A=0,dy:T=0,positionBounds:R}=this.attribute;let{title:B="",content:M=""}=this.attribute;B=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(B):B,M=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(M):M;const P=ni(v),H=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group");this.group=H;const k=w-P[1]-P[3],E=st(B)&&!1!==_,F=Object.assign(Object.assign({text:ut(B)?B:[B],visible:E,wrap:!0},h),{x:P[3],y:P[0],maxLineWidth:k,textAlign:"left",textBaseline:"top"}),L=H.createOrUpdateChild("poptip-title",F,"text");_t(null==S?void 0:S.title)||(L.states=S.title);const I=L.AABBBounds,z=I.height(),O=I.width();let D=z+y;E||(D=0);const W=st(M)&&!1!==_,N=Object.assign(Object.assign({text:ut(M)?M:[M],visible:W,wrap:!0},d),{x:P[3],y:P[0]+D,maxLineWidth:k,textAlign:"left",textBaseline:"top"}),G=H.createOrUpdateChild("poptip-content",N,"text");_t(null==S?void 0:S.content)||(G.states=S.content);const j=G.AABBBounds,V=j.height(),U=j.width();W&&(D+=V),this.titleShape=L,this.contentShape=G;let K=ue(O+P[1]+P[3],U+P[1]+P[3]);K>w?K=w:K<C&&(K=C);let $=P[0]+P[2]+D;const{visible:X,square:Y}=u,q=ky(u,["visible","square"]);if(Y){const t=ue(K,$);K=t;const e=t-$;$=t,L.setAttributes({dy:e/2}),G.setAttributes({dy:e/2})}const Z=null!==(t=q.size)&&void 0!==t?t:12,J=ut(Z)?[Z[0]+(null!==(e=q.space)&&void 0!==e?e:0),Z[1]+(null!==(i=q.space)&&void 0!==i?i:0)]:Z+(null!==(r=q.space)&&void 0!==r?r:0),Q=null!==(o=q.lineWidth)&&void 0!==o?o:1,tt=this.stage?[null!==(n=this.stage.viewWidth)&&void 0!==n?n:this.stage.width,null!==(s=this.stage.viewHeight)&&void 0!==s?s:this.stage.height]:void 0;if(tt){const t=this.AABBBounds,e=null!==(a=this.attribute.x)&&void 0!==a?a:t.x1,i=tt[0]-t.x1;let r=Math.max(e,i);const o=(ut(Z)?Z[0]:12)+3;if(r=Math.min(r-o,r*x),r<K){K=r;const t=P[1]+P[3];L.setAttribute("maxLineWidth",r-t),G.setAttribute("maxLineWidth",r-t),$=P[0]+P[2],E&&($+=L.AABBBounds.height()+y),$+=G.AABBBounds.height()}}const et="auto"===c||ut(c),it=ut(c)?c:this.positionList;let ot,nt=-1/0;for(let t=0;t<it.length+1;t++){const e=et?it[t===it.length?ot:t]:c;let i="arrow2Left",r=(ut(Z)?Z[0]:Z)/4,o=0;"top"===e||"bottom"===e||"left"===e||"right"===e?i="arrow2Left":"concise"===b&&(i=Oy[e],r=["tl","bl","rt","rb"].includes(e)?(ut(Z)?Z[0]:Z)/2:-(ut(Z)?Z[0]:Z)/2,o=["tl","tr","lb","rb"].includes(e)?-(ut(Z)?Z[1]:Z)/2:(ut(Z)?Z[1]:Z)/2);const{angle:n,offset:s}=this.getAngleAndOffset(e,K,$,ut(J)?J:[J,J-Q],i);let a,h={x:0,y:0};if("bounds"===p&&R&&(h=this.calculateAnchorPoint(e,R)),rt(X)){let t;a=H.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},q),{visible:X&&(W||E),x:r,y:o,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:i,angle:n,dx:s[0],dy:s[1]-(null!==(l=q.space)&&void 0!==l?l:0),size:Z,zIndex:9}),"symbol"),_t(null==S?void 0:S.panel)||(a.states=S.panel),t=u.panelSymbolType?H.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},q),{visible:X&&(W||E),x:0,y:0,symbolType:"rect",size:[K,$],zIndex:-8}),"symbol"):H.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},q),{visible:X&&(W||E),x:0,y:0,width:K,height:$,zIndex:-8}),"rect"),_t(null==S?void 0:S.panel)||(t.states=S.panel)}if(H.setAttributes({x:-s[0]+A+h.x,y:-s[1]+T+h.y,anchor:[r,o]}),g){const{size:t=12}=g,e=ut(t)?t:[t,t];"auto"===e[1]&&(e[1]=$),"auto"===e[0]&&(e[0]=$);const i=e[0];H.createOrUpdateChild("poptip-logo",Object.assign(Object.assign({},g),{x:0,y:$/2,visible:X&&(W||E),zIndex:10,size:e}),"symbol"),H.setAttributes({x:-s[0]+A+i/2,y:-s[1]+T}),f&&H.createOrUpdateChild("poptip-logo-text",Object.assign(Object.assign({},m),{x:0,y:$/2,visible:X&&(W||E),text:f,textAlign:"center",textBaseline:"middle",zIndex:10}),"text")}if(!tt)break;{Ey.setValue(0,0,K,$).transformWithMatrix(H.globalTransMatrix);const i=Ey,r=(new Ne).setValue(0,0,tt[0],tt[1]);if(et){if(Re(i,r,!1))break;{const e=Se(i,r,!1),o=(e.x2-e.x1)*(e.y2-e.y1);o>nt&&(nt=o,ot=t)}}if(["top","bottom","left","right"].includes(e)){const t="top"===e||"bottom"===e,o="left"===e||"right"===e;let n=!1;if(t?n="top"===e&&i.y1<0||"bottom"===e&&i.y2>r.y2:o&&(n="left"===e&&i.x1<0||"right"===e&&i.x2>r.x2),!n){let e=0;const n=(ut(Z)?Z[1]:Z)/2;t?(i.x1<0?e=-i.x1:i.x2>r.x2&&(e=r.x2-i.x2),H.setAttribute("x",H.attribute.x+e),a.setAttribute("dx",ge(ue(a.attribute.dx-e,n),i.width()-n))):o&&(i.y1<0?e=-i.y1:i.y2>r.y2&&(e=r.y2-i.y2),H.setAttribute("y",H.attribute.y+e),a.setAttribute("dy",ge(ue(a.attribute.dy-e,n),i.height()-n)));break}}if(!et)break}}}calculateAnchorPoint(t,e){if(!e)return{x:0,y:0};const{x:i,y:r}=this.attribute,{x1:o,y1:n,x2:s,y2:a}=e,l=s-o,h=a-n;switch(t){case"top":case"tl":case"tr":return{x:o+l/2-i,y:n-r};case"bottom":case"bl":case"br":return{x:o+l/2-i,y:a-r};case"left":case"lt":case"lb":return{x:o-i,y:n+h/2-r};case"right":case"rt":case"rb":return{x:s-i,y:n+h/2-r};default:return{x:0,y:0}}}getAngleAndOffset(t,e,i,r,o){const n="arrow2Left"===o?r[1]/2:r[1];switch(t){case"tl":return{angle:"arrow2Left"===o?ne/2*3:0,offset:"arrow2Left"===o?[e/4,i+n]:[0,i+n]};case"top":return{angle:ne/2*3,offset:[e/2,i+n]};case"tr":return{angle:"arrow2Left"===o?ne/2*3:0,offset:"arrow2Left"===o?[e/4*3,i+n]:[e,i+n]};case"rt":return{angle:0,offset:"arrow2Left"===o?[-n,i/5]:[-n,0]};case"right":return{angle:0,offset:[-n,i/2]};case"rb":return{angle:0,offset:"arrow2Left"===o?[-n,i/5*4]:[-n,i]};case"bl":return{angle:"arrow2Left"===o?ne/2:0,offset:"arrow2Left"===o?[e/4,-n]:[0,-n]};case"bottom":return{angle:ne/2,offset:[e/2,-n]};case"br":return{angle:"arrow2Left"===o?ne/2:0,offset:"arrow2Left"===o?[e/4*3,-n]:[e,-n]};case"lt":return{angle:"arrow2Left"===o?ne:0,offset:"arrow2Left"===o?[e+n,i/5]:[e+n,0]};case"left":return{angle:ne,offset:[e+n,i/2]};case"lb":return{angle:"arrow2Left"===o?ne:0,offset:"arrow2Left"===o?[e+n,i/5*4]:[e+n,i]}}}}Dy.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},panel:{},maxWidthPercent:.8,space:8,padding:10};var Wy=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};let Ny=class{render(t,e,i,r,o,n,s,a,l,h,c,d,u){var g,p;if(1===t._showPoptip){const{visible:e,visibleCb:i}=t.attribute.poptip||{};if(!1===e||i&&!1===i(t))return;const r={};Ht(r,Dy.defaultAttributes,t.attribute.poptip?t.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(r):this.poptipComponent=new Dy(r);let o=t.attribute.poptip||{};if("text"===t.type&&null==o.title&&null==o.content){const e={};Ht(e,Hy.poptip,o),o=e,o.content=null!==(g=o.content)&&void 0!==g?g:t.attribute.text}const n=t.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1,poptipAnchor:"bounds"},o),{x:n.e,y:n.f,positionBounds:t.globalAABBBounds})),h.stage.tryInitInteractiveLayer();const s=h.stage.getLayer("_builtin_interactive");s&&s.add(this.poptipComponent)}else 2===t._showPoptip&&(t._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),null===(p=this.poptipComponent.parent)||void 0===p||p.removeChild(this.poptipComponent),this.poptipComponent=null))}};Ny=Wy([f()],Ny);var Gy=function(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};class jy{constructor(){this.activeEvent="onRegister",this._uid=e.GenAutoIncrementId(),this.poptip=t=>{const e=t.target;this.needHide(e)?this.unpoptip(t):e!==this.activeGraphic&&(this.needShow(e)&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0))},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}needHide(t){return t.isContainer||!t.attribute}needShow(t){return!!t.attribute.poptip}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}}let Vy=class extends jy{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};Vy=Gy([f()],Vy);let Uy=class extends jy{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=t=>{const{stage:e}=this.pluginService;t.target===e&&this.unpoptip(t)}}activate(t){super.activate(t);const{stage:e}=this.pluginService;e.addEventListener("pointerleave",this.pointerlave)}needHide(t){return"text"!==t.type||!t.cliped||t.isContainer||!t.attribute||t.attribute.disableAutoClipedPoptip}needShow(t){return!0}deactivate(t){const{stage:e}=this.pluginService;super.deactivate(t),e.removeEventListener("pointerleave",this.pointerlave)}};Uy=Gy([f()],Uy);const Ky=new i(((t,e,i,r)=>{i(Ny)||(t(Ny).toSelf().inSingletonScope(),t(Il).toService(Ny)),i(Vy)||(t(Vy).toSelf(),t(hu).toService(Vy)),i(Uy)||(t(Uy).toSelf(),t(hu).toService(Uy))}));jb(),$b(),Zb(),ny();class $y extends jg{getStartAngle(){return _e(this._startAngle)}getEndAngle(){return _e(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},$y.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:o=!0,multiSegment:n,mainSegmentIndex:s}=this.attribute;if(!o)return;this._computeLineAngle();const a=this._getMainSegmentPoints(),l=this._renderSymbol(t,a,"start"),h=this._renderSymbol(e,a,"end");if(this.startSymbol=l,this.endSymbol=h,n){const t=[...this.attribute.points];if(mt(s))t[s]=this._clipPoints(t[s]);else{const e=this._clipPoints(Gt(t));t[0][0]=e[0],t[t.length-1][t[t.length-1].length-1]=e[e.length-1]}t.forEach(((t,e)=>{var o,n;const s=Fh.line(Object.assign(Object.assign({points:t},ut(i)?null!==(o=i[e])&&void 0!==o?o:i[i.length-1]:i),{fill:!1}));s.name=`${this.name}-line`,s.id=this._getNodeId("line"+e),_t(null==r?void 0:r.line)||(s.states=ut(r.line)?null!==(n=r.line[e])&&void 0!==n?n:r.line[r.line.length-1]:r.line),this.add(s),this.lines.push(s)}))}else{let t=Fh.line;zt(i)[0].cornerRadius&&(t=Fh.polygon);const e=t(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},zt(i)[0]),{fill:!1,closePath:!1}));e.name=`${this.name}-line`,e.id=this._getNodeId("line"),_t(null==r?void 0:r.line)||(e.states=[].concat(r.line)[0]),this.add(e),this.lines.push(e)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:r=!0}=t;let o;if(t&&t.visible){const n=this.getStartAngle(),s=this.getEndAngle(),{state:a}=this.attribute,l=e[0],h=e[e.length-1],{refX:c=0,refY:d=0,refAngle:u=0,style:g,symbolType:p,size:f=12}=t;let m,b;"start"===i?(m={x:l.x+(mt(n)?c*Math.cos(n)+d*Math.cos(n-Math.PI/2):0),y:l.y+(mt(n)?c*Math.sin(n)+d*Math.sin(n-Math.PI/2):0)},b=this._computeStartRotate(this._startAngle)):(m={x:h.x+(mt(s)?c*Math.cos(s)+d*Math.cos(s-Math.PI/2):0),y:h.y+(mt(s)?c*Math.sin(s)+d*Math.sin(s-Math.PI/2):0)},b=this._computeEndRotate(this._endAngle)),o=Fh.symbol(Object.assign(Object.assign(Object.assign({},m),{symbolType:p,size:f,angle:r?b+u:0,strokeBoundsBuffer:0}),g)),o.name=`${this.name}-${i}-symbol`,o.id=this._getNodeId(`${i}-symbol`),_t(null==a?void 0:a.symbol)||(o.states=a.symbol),"start"===i?_t(null==a?void 0:a.startSymbol)||(o.states=a.startSymbol):_t(null==a?void 0:a.endSymbol)||(o.states=a.endSymbol),this.add(o)}return o}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let r;return r=e?mt(i)?t[i]:Gt(t):t,this._mainSegmentPoints=r,r}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let r=t;if(e.visible){const i=e.clip?e.size||10:0;r=[{x:t[0].x-i/2*(Math.cos(this._startAngle)||0),y:t[0].y-i/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const e=i.clip?i.size||10:0,o={x:t[t.length-1].x-e/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-e/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),o]}return r}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],r=t[t.length-2],o=t[t.length-1],n=[e.x-i.x,e.y-i.y],s=Math.atan2(n[1],n[0]),a=[o.x-r.x,o.y-r.y],l=Math.atan2(a[1],a[0]);this._startAngle=s,this._endAngle=l}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}var Xy,Yy;$y.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}},function(t){t.innerView="inner-view",t.axisContainer="axis-container",t.labelContainer="axis-label-container",t.tickContainer="axis-tick-container",t.tick="axis-tick",t.subTick="axis-sub-tick",t.label="axis-label",t.title="axis-title",t.gridContainer="axis-grid-container",t.grid="axis-grid",t.gridRegion="axis-grid-region",t.line="axis-line",t.background="axis-background",t.axisLabelBackground="axis-label-background",t.axisBreak="axis-break",t.axisBreakSymbol="axis-break-symbol"}(Xy||(Xy={})),function(t){t.selected="selected",t.selectedReverse="selected_reverse",t.hover="hover",t.hoverReverse="hover_reverse"}(Yy||(Yy={}));const qy={[Yy.selectedReverse]:{},[Yy.selected]:{},[Yy.hover]:{},[Yy.hoverReverse]:{}},Zy={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},Jy={size:8,stroke:"#000",lineWidth:1,zIndex:1};const Qy=Math.sin(Math.PI/10);function tC(t,e=Qy){const i=!nt(t)&&0!==t,r=i?Math.cos(t):1;return i&&Math.abs(r)<=e}function eC(t,e=Qy){const i=!nt(t)&&0!==t,r=i?Math.sin(t):0;return!i||Math.abs(r)<=e}function iC(t,e){return{x:t.x+e[0],y:t.y+e[1]}}function rC(t,e,i,r=!1,o=!1){const n=[e.x-i.x,e.y-i.y];return Cy(n,(r?-1:1)*(o?-1:1)*t/wy(n))}function oC(t,e,i,r,o){const n=function(t,e,i){return e?{x:t.x+e*Math.cos(i),y:t.y+e*Math.sin(i)}:{x:t.x,y:t.y}}({x:0,y:0},i,t),s=iC(n,rC(r,n,e,o));return a=s,l=rC(r||1,s,e,o),{x:a.x+l[0],y:a.y+l[1]};var a,l}function nC(t,e,i){var r;if(eC(null===(r=t.attribute)||void 0===r?void 0:r.angle,Number.EPSILON))return i>Oe(t.AABBBounds,e.AABBBounds);const o=t.OBBBounds,n=e.OBBBounds;return!o||!n||o.empty()||n.empty()?i>Oe(t.AABBBounds,e.AABBBounds):o.intersects(n)||i>De(o,n)}function sC(t,e){for(let i,r=1,o=t.length,n=t[0];r<o;n=i,++r)if(i=t[r],nC(n,i,e))return!0;return!1}class aC extends jg{_prepareAnimate(t){if(!1!==this.attribute.animation){const{animation:e,animationEnter:i,animationExit:r,animationUpdate:o}=this.attribute,n=at(e)?e:{};this._animationConfig={enter:!1!==i&&Ht({},t,n,null!=i?i:{}),exit:!1!==r&&Ht({},t,n,null!=r?r:{}),update:!1!==o&&(ut(o)?o:Ht({},t,n,null!=o?o:{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}const lC={type:"default",duration:300,easing:"linear"};class hC extends aC{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=((t,e,i)=>{const r=t.target;return r!==i&&r.name&&!_t(r.states)?(r.addState(uy.hover,!0),yy(e,(t=>{t!==r&&t.name&&!_t(t.states)&&t.addState(uy.hoverReverse,!0)})),r):i})(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=((t,e,i)=>i?(yy(e,(t=>{t.name&&!_t(t.states)&&(t.removeState(uy.hoverReverse),t.removeState(uy.hover))})),null):i)(0,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=((t,e,i)=>{const r=t.target;return i===r&&r.hasState(uy.selected)?(yy(e,(t=>{t.name&&!_t(t.states)&&(t.removeState(uy.selectedReverse),t.removeState(uy.selected))})),null):r.name&&!_t(r.states)?(r.addState(uy.selected,!0),yy(e,(t=>{t!==r&&t.name&&!_t(t.states)&&t.addState(uy.selectedReverse,!0)})),r):i})(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=Rt(this.attribute);e.scale=this.attribute.scale,this.attribute=t;const i=Fh.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prepare(),this._prevInnerView=this._innerView&&function(t){const e={};return yy(t,(t=>{"group"!==t.type&&t.id&&(e[t.id]=t)})),e}(this._innerView),this.removeAllChild(!0),this._innerView=Fh.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent(),this.runAnimation()}_prepare(){this._prepareAnimate(lC)}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:r,line:o,items:n}=this.attribute,s=Fh.group({x:0,y:0,zIndex:1,pickable:!1});if(s.name=Xy.axisContainer,s.id=this._getNodeId("container"),s.setMode(this.mode),this.axisContainer=s,t.add(s),o&&o.visible&&this.renderLine(s),n&&n.length&&(this.data=this._transformItems(n[0]),r&&r.visible&&this.renderTicks(s),i&&i.visible)){const t=Fh.group({x:0,y:0,pickable:!1});t.name=Xy.labelContainer,t.id=this._getNodeId("label-container"),this.axisLabelsContainer=t,s.add(t),n.forEach(((e,i)=>{const r=this.renderLabels(t,e,i),o=r.getChildren();this.beforeLabelsOverlap(o,e,r,i,n.length),this.handleLabelsOverlap(o,e,r,i,n.length),this.afterLabelsOverlap(o,e,r,i,n.length);let s=0,a=0,l="center",h="middle",c=0;o.forEach(((t,e)=>{var i;const r=t.attribute,o=null!==(i=r.angle)&&void 0!==i?i:0,n=t.AABBBounds;let d=n.width(),u=n.height();o&&(d=Math.abs(d*Math.cos(o)),u=Math.abs(u*Math.sin(o))),s=Math.max(s,d),a=Math.max(a,u),l=r.textAlign,h=r.textBaseline,0===e&&(c=r.x)})),this.axisLabelLayerSize[i]={width:s,height:a,labelPos:c,textAlign:l,textBaseline:h}}))}e&&e.visible&&this.renderTitle(s)}renderTicks(t){const e=this.getTickLineItems(),i=Fh.group({x:0,y:0,pickable:!1});i.name=Xy.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach(((t,r)=>{var o;const n=Fh.line(Object.assign({},this._getTickLineAttribute("tick",t,r,e)));if(n.name=Xy.tick,n.id=this._getNodeId(t.id),_t(null===(o=this.attribute.tick)||void 0===o?void 0:o.state))n.states=gy;else{const t=this.data[r],e=Ht({},gy,this.attribute.tick.state);Object.keys(e).forEach((i=>{ot(e[i])&&(e[i]=e[i](t.rawValue,r,t,this.data))})),n.states=e}i.add(n)})),this.tickLineItems=e;const{subTick:r}=this.attribute;if(r&&r.visible){const t=this.getSubTickLineItems();t.length&&t.forEach(((t,o)=>{const n=Fh.line(Object.assign({},this._getTickLineAttribute("subTick",t,o,e)));if(n.name=Xy.subTick,n.id=this._getNodeId(`${o}`),_t(r.state))n.states=gy;else{const i=Ht({},gy,r.state);Object.keys(i).forEach((r=>{ot(i[r])&&(i[r]=i[r](t.value,o,t,e))})),n.states=i}i.add(n)})),this.subTickLineItems=t}}renderLabels(t,e,i){const{dataFilter:r}=this.attribute.label;r&&ot(r)&&(e=r(e,i));const o=this._transformItems(e),n=Fh.group({x:0,y:0,pickable:!1});return n.name=`${Xy.labelContainer}-layer-${i}`,n.id=this._getNodeId(`label-container-layer-${i}`),t.add(n),o.forEach(((t,e)=>{var r;const s=Ty(this._getLabelAttribute(t,e,o,i));if(s.name=Xy.label,s.id=this._getNodeId(`layer${i}-label-${t.id}`),_t(null===(r=this.attribute.label)||void 0===r?void 0:r.state))s.states=gy;else{const r=Ht({},gy,this.attribute.label.state);Object.keys(r).forEach((n=>{ot(r[n])&&(r[n]=r[n](t,e,o,i))})),s.states=r}s.data=Object.assign(Object.assign({},t),{index:e,layer:i}),n.add(s)})),n}renderTitle(t){const e=this.getTitleAttribute(),i=new My(Object.assign({},e));i.name=Xy.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return iC(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:r,inside:o=!1,length:n,dataFilter:s}=t;let a=1;return e.length>=2&&(a=e[1].value-e[0].value),(s&&ot(s)?s(e):e).forEach((t=>{let e=t.point,s=t.value;if(!r){const i=t.value-a/2;if(this.isInValidValue(i))return;e=this.getTickCoord(i),s=i}const l=this.getVerticalCoord(e,n,o);if("3d"===this.mode){const r=this.getVerticalVector(n,o,e);let a=0,h=0;he(r[0])>he(r[1])?a=ne/2*(l.x>e.x?1:-1):h=ne/2*(l.y>e.y?-1:1),i.push({start:e,end:l,value:s,id:`tick-${t.id}`,anchor:[e.x,e.y],alpha:a,beta:h})}else i.push({start:e,end:l,value:s,id:`tick-${t.id}`})})),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:r=!1,length:o=2}=t,n=this.tickLineItems,s=n.length;if(s>=2)for(let t=0;t<s-1;t++){const s=n[t],a=n[t+1];for(let t=0;t<i;t++){const n=(t+1)/(i+1),l=(1-n)*s.value+n*a.value,h=this.getTickCoord(l),c=this.getVerticalCoord(h,o,r);e.push({start:h,end:c,value:l,id:`sub-tick-${l}`})}}return e}_getTickLineAttribute(t,e,i,r){let o=St(this.attribute,`${t}.style`);const n=this.data[i];o=ot(o)?Ht({},St(Zy,`${t}.style`),"tick"===t?o(n.rawValue,i,n,this.data):o(e.value,i,e,r)):o;const{start:s,end:a,anchor:l,alpha:h,beta:c}=e;return Object.assign({points:[s,a],anchor:l,alpha:h,beta:c},o)}_getLabelAttribute(t,e,i,r){var o,n;const{space:s=4,inside:a=!1,formatMethod:l,type:h="text",text:c}=this.attribute.label;let d=s,u=0;(null===(o=this.attribute.tick)||void 0===o?void 0:o.visible)&&this.attribute.tick.inside===a&&(u=this.attribute.tick.length||4),(null===(n=this.attribute.subTick)||void 0===n?void 0:n.visible)&&this.attribute.subTick.inside===a&&(u=Math.max(u,this.attribute.subTick.length||2)),d+=u;const g=this.getRelativeVector(t.point);r>0&&(0===g[1]?d+=(this.axisLabelLayerSize[r-1].height+St(this.attribute,"label.space",4))*r:d+=(this.axisLabelLayerSize[r-1].width+St(this.attribute,"label.space",4))*r);const p=this.getVerticalCoord(t.point,d,a),f=this.getVerticalVector(d||1,a,p),m=l?l(`${t.label}`,t,e,i,r):t.label;let{style:b}=this.attribute.label;b=ot(b)?Ht({},Zy.label.style,b(t,e,i,r)):b;return b=Ht(this.getLabelAlign(f,a,b.angle),b),ot(b.text)&&(b.text=b.text({label:t.label,value:t.rawValue,index:t.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,f,m,b)),{text:null!=c?c:m,_originText:t.label,lineHeight:null==b?void 0:b.fontSize,type:h}),b)}getLabelPosition(t,e,i,r){return t}_transformItems(t){const e=[];return t.forEach((t=>{var i;e.push(Object.assign(Object.assign({},t),{point:this.getTickCoord(t.value),id:null!==(i=t.id)&&void 0!==i?i:t.label}))})),e}runAnimation(){const t=this.lastScale;if(this.attribute.scale){const t=this.attribute.scale;this.lastScale=t.clone(),this.lastScale.range([0,1])}if(this.attribute.animation&&this.applyAnimationState){const e=this.getInnerView(),i=this.getPrevInnerView();if(!i)return;const r=this._animationConfig;this._newElementAttrMap={},yy(e,(e=>{var o;if("group"!==e.type&&e.id){const n=i[e.id];if(e.setFinalAttributes(e.attribute),n){n.release();const i=n.attribute,s=e.getFinalAttribute(),a=function(t,e,i){const r={};for(const i in e)i in t&&Ft(t[i],e[i])||(r[i]=e[i]);if(i)for(const o in t)if(!(o in e)){const t=i(o);void 0!==t&&(r[o]=t)}return r}(i,s);let l=Object.keys(a).length>0;if("opacity"in i&&s.opacity!==i.opacity&&(a.opacity=null!==(o=s.opacity)&&void 0!==o?o:1,l=!0),r.update&&l){this._newElementAttrMap[e.id]={state:"update",node:e,attrs:e.attribute};const i=n.attribute;e.setAttributes(i),e.applyAnimationState(["update"],[{name:"update",animation:Object.assign(Object.assign({selfOnly:!0},r.update),{type:"axisUpdate",customParameters:{config:r.update,diffAttrs:a,lastScale:t}})}])}}else r.enter&&(this._newElementAttrMap[e.id]={state:"enter",node:e,attrs:e.attribute},e.applyAnimationState(["enter"],[{name:"enter",animation:Object.assign(Object.assign({},r.enter),{type:"axisEnter",selfOnly:!0,customParameters:{config:r.enter,lastScale:t,getTickCoord:this.getTickCoord.bind(this)}})}]))}}))}}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const cC={parity:function(t){return t.filter(((t,e)=>e%2?t.setAttribute("opacity",0):1))},greedy:function(t,e){let i;return t.filter(((t,r)=>r&&nC(i,t,e)?t.setAttribute("opacity",0):(i=t,1)))}};function dC(t){let e;return e=t.OBBBounds.empty()?t.AABBBounds:t.OBBBounds,e.width()>1&&e.height()>1}function uC(t,e,i,r,o=!1){if(i&&!t.attribute.opacity){const i=e.length;if(i>1){t.setAttribute("opacity",1);for(let t=0;t<i;t++){const n=o?e[i-1-t]:e[t];if(!r(n))break;n.setAttribute("opacity",0)}}}}function gC(t){for(let n=1;n<t.length;n++)if(e=t[n-1],i=t[n],r=void 0,o=void 0,(null===(r=e.OBBBounds)||void 0===r?void 0:r.empty())||(null===(o=i.OBBBounds)||void 0===o?void 0:o.empty())?Be(e.AABBBounds,i.AABBBounds,!1)&&(!e.rotatedBounds||!i.rotatedBounds||Ee(e.rotatedBounds,i.rotatedBounds,!0)):e.OBBBounds.intersects(i.OBBBounds))return!0;var e,i,r,o;return!1}function pC(t,e){"bottom"!==t&&"top"!==t||function(t,e){e.forEach((e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},mC(t,e.attribute.angle)),{angle:fC(e.attribute.angle)}))}))}(t,e),"left"!==t&&"right"!==t||function(t,e){e.forEach(((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},bC(t,e.attribute.angle)),{angle:fC(e.attribute.angle)}))}))}(t,e),function(t){t.forEach((t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=function(t){const e=t.AABBBounds;return{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,centerX:t.attribute.x,centerY:t.attribute.y,angle:t.attribute.angle}}(t),i=Pe({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),r=i.x-e.centerX,o=i.y-e.centerY;e.x1+=r,e.x2+=r,e.y1+=o,e.y2+=o,e.centerX+=r,e.centerY+=o,t.rotatedBounds=e}))}(e)}function fC(t=0){if(t<0)for(;t<0;)t+=2*Math.PI;if(t>0)for(;t>=2*Math.PI;)t-=2*Math.PI;return t}function mC(t,e=0){let i=["center","left","left","left","center","right","right","right","left"],r=["top","top","middle","bottom","bottom","bottom","middle","top","top"];"top"===t&&(i=["center","right","right","right","center","left","left","left","right"],r=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const o=(e=fC(e))/(.5*Math.PI);let n;return n=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[n],textBaseline:r[n]}}function bC(t,e=0){let i=["right","right","center","left","left","left","center","right","right"],r=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];"right"===t&&(i=["left","left","center","right","right","right","center","left","left"],r=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const o=(e=fC(e))/(.5*Math.PI);let n;return n=o===Math.floor(o)?2*Math.floor(o):2*Math.floor(o)+1,{textAlign:i[n],textBaseline:r[n]}}function yC(t,e){const{limitLength:i,verticalLimitLength:r,ellipsis:o="...",orient:n,axisLength:s}=e;if(_t(t)||!mt(i))return;const a=function(t){return mt(t)?{left:t,right:t}:at(t)?{left:t.left||0,right:t.right||0}:{left:0,right:0}}(e.overflowLimitLength),l=t[0],h=l.attribute.angle,c=!nt(h),d=c?Math.cos(h):1,u=c?Math.sin(h):0,g=eC(h),p=tC(h),f="top"===n||"bottom"===n,m=l.attribute.direction,b=!g&&!p&&f&&(t.length<2||t.some((t=>Math.abs(t.AABBBounds.width()-l.AABBBounds.width())>=2)))&&l.AABBBounds.width()>Math.abs(i/u);t.forEach((t=>{var e;if(f){if(p&&Math.floor(t.AABBBounds.height())<=i)return;if(g&&Math.floor(t.AABBBounds.width())<=r)return}if(!f){if("vertical"===m&&Math.floor(t.AABBBounds.height())<=r)return;if("vertical"!==m){if(g&&Math.floor(t.AABBBounds.width())<=i)return;if(p&&Math.floor(t.AABBBounds.height())<=r)return}}let n=null;if(g||p)n=f?g?r:i:"vertical"===m||p?r:i;else if(f){const{x1:e,x2:r}=t.AABBBounds,o=u/d,l=Math.abs(i/u);if(b&&o>0&&e<=s+a.right&&i/o+e>s+a.right){const t=(s-e+a.right)/Math.abs(d);n=Math.min(t,l)}else if(b&&o<0&&r>=-a.left&&i/o+r<-a.left){const t=(r+a.left)/Math.abs(d);n=Math.min(t,l)}else n=l}else n=Math.abs(i/d);mt(t.attribute.maxLineWidth)&&(n=mt(n)?Math.min(t.attribute.maxLineWidth,n):t.attribute.maxLineWidth),t.setAttributes({maxLineWidth:n,ellipsis:null!==(e=t.attribute.ellipsis)&&void 0!==e?e:o})}))}function CC(t,e,i){let r;return mt(e)&&(r=Math.abs(e-t)),mt(i)&&(r=mt(r)?Math.min(Math.abs(t-i),r):Math.abs(t-i)),r}class wC{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0===t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return 0===t?0:Math.pow(2,10*t-10)}static expoOut(t){return 1===t?1:1-Math.pow(2,-10*t)}static expoInOut(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-wC.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*wC.bounceIn(2*t):.5*wC.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(0===i||1===i)return i;const r=e/le*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*le/e)}}static getElasticOut(t,e){return function(i){if(0===i||1===i)return i;const r=e/le*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-r)*le/e)+1}}static getElasticInOut(t,e){return function(i){const r=e/le*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*le/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*le/e)*.5+1}}static registerFunc(t,e){wC[t]=e}}function vC(t,e){const i=1/e;let r=1;for(;t>i;)t-=i,r*=-1;const o=r*t/i;return o>0?o:1+o}wC.quadIn=wC.getPowIn(2),wC.quadOut=wC.getPowOut(2),wC.quadInOut=wC.getPowInOut(2),wC.cubicIn=wC.getPowIn(3),wC.cubicOut=wC.getPowOut(3),wC.cubicInOut=wC.getPowInOut(3),wC.quartIn=wC.getPowIn(4),wC.quartOut=wC.getPowOut(4),wC.quartInOut=wC.getPowInOut(4),wC.quintIn=wC.getPowIn(5),wC.quintOut=wC.getPowOut(5),wC.quintInOut=wC.getPowInOut(5),wC.backIn=wC.getBackIn(1.7),wC.backOut=wC.getBackOut(1.7),wC.backInOut=wC.getBackInOut(1.7),wC.elasticIn=wC.getElasticIn(1,.3),wC.elasticOut=wC.getElasticOut(1,.3),wC.elasticInOut=wC.getElasticInOut(1,.3*1.5),wC.easeInOutQuad=t=>(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2),wC.easeOutElastic=t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},wC.easeInOutElastic=t=>{const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1};for(let t=0;t<10;t++)wC[`flicker${t}`]=e=>vC(e,t);for(let t=2;t<10;t++)wC[`aIn${t}`]=e=>t*e*e+(1-t)*e;function xC(t,e,i){return t+(e-t)*i}const _C=new class{constructor(){this.opacity=(t,e,i,r,o,n)=>{n.attribute.opacity=xC(e,i,r)},this.baseOpacity=(t,e,i,r,o,n)=>{n.attribute.baseOpacity=xC(e,i,r)},this.fillOpacity=(t,e,i,r,o,n)=>{n.attribute.fillOpacity=xC(e,i,r)},this.strokeOpacity=(t,e,i,r,o,n)=>{n.attribute.strokeOpacity=xC(e,i,r)},this.zIndex=(t,e,i,r,o,n)=>{n.attribute.zIndex=xC(e,i,r)},this.backgroundOpacity=(t,e,i,r,o,n)=>{n.attribute.backgroundOpacity=xC(e,i,r)},this.shadowOffsetX=(t,e,i,r,o,n)=>{n.attribute.shadowOffsetX=xC(e,i,r)},this.shadowOffsetY=(t,e,i,r,o,n)=>{n.attribute.shadowOffsetY=xC(e,i,r)},this.shadowBlur=(t,e,i,r,o,n)=>{n.attribute.shadowBlur=xC(e,i,r)},this.fill=(t,e,i,r,o,n)=>{n.attribute.fill=Oa(e,i,r,!1)},this.fillPure=(t,e,i,r,o,n)=>{n.attribute.fill=o.fromParsedProps.fill?Wa(o.fromParsedProps.fill,o.toParsedProps.fill,r):o.toParsedProps.fill},this.stroke=(t,e,i,r,o,n)=>{n.attribute.stroke=Oa(e,i,r,!1)},this.strokePure=(t,e,i,r,o,n)=>{n.attribute.stroke=o.fromParsedProps.stroke?Wa(o.fromParsedProps.stroke,o.toParsedProps.stroke,r):o.toParsedProps.stroke},this.width=(t,e,i,r,o,n)=>{n.attribute.width=xC(e,i,r),n.addUpdateBoundTag()},this.height=(t,e,i,r,o,n)=>{n.attribute.height=xC(e,i,r),n.addUpdateBoundTag()},this.x=(t,e,i,r,o,n)=>{n.attribute.x=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.y=(t,e,i,r,o,n)=>{n.attribute.y=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.dx=(t,e,i,r,o,n)=>{n.attribute.dx=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.dy=(t,e,i,r,o,n)=>{n.attribute.dy=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.angle=(t,e,i,r,o,n)=>{n.attribute.angle=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.scaleX=(t,e,i,r,o,n)=>{n.attribute.scaleX=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.scaleY=(t,e,i,r,o,n)=>{n.attribute.scaleY=xC(e,i,r),n.addUpdateBoundTag(),n.addUpdatePositionTag()},this.lineWidth=(t,e,i,r,o,n)=>{n.attribute.lineWidth=xC(e,i,r),n.addUpdateBoundTag()},this.startAngle=(t,e,i,r,o,n)=>{n.attribute.startAngle=xC(e,i,r),n.addUpdateBoundTag()},this.endAngle=(t,e,i,r,o,n)=>{n.attribute.endAngle=xC(e,i,r),n.addUpdateBoundTag()},this.radius=(t,e,i,r,o,n)=>{n.attribute.radius=xC(e,i,r),n.addUpdateBoundTag()},this.outerRadius=(t,e,i,r,o,n)=>{n.attribute.outerRadius=xC(e,i,r),n.addUpdateBoundTag()},this.innerRadius=(t,e,i,r,o,n)=>{n.attribute.innerRadius=xC(e,i,r),n.addUpdateBoundTag()},this.size=(t,e,i,r,o,n)=>{n.attribute.size=xC(e,i,r),n.addUpdateBoundTag()},this.points=(t,e,i,r,o,n)=>{n.attribute.points=Bn(e,i,r),n.addUpdateBoundTag()}}};function SC(t,e,i,r,o,n){if(Number.isFinite(i)&&Number.isFinite(e))return n.attribute[t]=e+(i-e)*r,!0;if(Array.isArray(i)&&Array.isArray(e)&&i.length===e.length){const o=[];let s=!0;for(let t=0;t<i.length;t++){const n=e[t],a=n+(i[t]-n)*r;if(!Number.isFinite(a)){s=!1;break}o.push(a)}return s&&(n.attribute[t]=o),!0}return!1}function AC(){}class TC{constructor(t,i,r,o){var n;this._startTime=0,this._hasFirstRun=!1,this._syncAttributeUpdate=()=>{this.target.setAttributes(this.target.attribute)},this.type=t,this.props=i,this.duration=r,this.easing=o?"function"==typeof o?o:null!==(n=wC[o])&&void 0!==n?n:wC.linear:wC.linear,"wait"===t&&(this.onUpdate=AC),this.id=e.GenAutoIncrementId(),this.syncAttributeUpdate=AC}bind(t,e){this.target=t,this.animate=e,this.onBind(),this.syncAttributeUpdate()}append(t){this.next=t,t.prev=this,t.setStartTime(this.getStartTime()+this.duration,!1)}updateDownstreamStartTimes(){let t=this.next,e=this._startTime+this.duration;for(;t;)t.setStartTime(e,!1),e+=t.duration,t=t.next;this.animate.updateDuration()}getLastProps(){return this.prev?this.prev.props||{}:this.animate.getStartProps()}setDuration(t,e=!0){this.duration=t,e&&this.updateDownstreamStartTimes()}getDuration(){return this.duration}determineInterpolateUpdateFunction(){if(!this.props)return;const t=[];this.propKeys.forEach((e=>{if("fill"===e||"stroke"===e){const i=this.fromProps[e],r=this.props[e];if(dt(i)&&dt(r)){const o=Ia.Get(i,La.Color255),n=Ia.Get(r,La.Color255);this.fromParsedProps||(this.fromParsedProps={}),this.toParsedProps||(this.toParsedProps={}),this.fromParsedProps[e]=o,this.toParsedProps[e]=n,t.push(_C["fill"===e?"fillPure":"strokePure"])}else _C[e]?t.push(_C[e]):t.push(SC)}else _C[e]?t.push(_C[e]):t.push(SC)})),this.interpolateUpdateFunctions=t}setStartTime(t,e=!0){this._startTime=t,e&&this.updateDownstreamStartTimes()}getStartTime(){return this._startTime}onBind(){"glyph"===this.target.type&&(this.syncAttributeUpdate=this._syncAttributeUpdate)}onFirstRun(){}onStart(){if(!this._hasFirstRun){this._hasFirstRun=!0,this.fromProps=this.getLastProps();const t=this.animate.getStartProps();this.propKeys&&this.propKeys.forEach((e=>{var i;this.fromProps[e]=null!==(i=this.fromProps[e])&&void 0!==i?i:t[e]})),this.determineInterpolateUpdateFunction(),this.tryPreventConflict(),this.trySyncStartProps(),this.onFirstRun()}}tryPreventConflict(){const t=this.animate;this.target.animates.forEach((e=>{if(e===t||e.priority>t.priority||e.priority===1/0)return;const i=e.getStartProps();this.propKeys.forEach((t=>{null!=i[t]&&e.preventAttr(t)}))}))}deleteSelfAttr(t){var e;delete this.props[t],this.fromProps&&delete this.fromProps[t];const i=this.propKeys.indexOf(t);-1!==i&&(this.propKeys.splice(i,1),null===(e=this.interpolateUpdateFunctions)||void 0===e||e.splice(i,1))}trySyncStartProps(){this.propKeys.forEach((t=>{this.fromProps[t]=this.animate.target.getComputedAttribute(t)}))}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.fromProps,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((t,e)=>{if(!this.animate.validAttr(this.propKeys[e]))return;const i=this.propKeys[e];t(i,this.fromProps[i],this.props[i],r,this,this.target)})),this.onUpdate(t,r,i),this.syncAttributeUpdate()}onUpdate(t,e,i){}onEnd(t){this.target.setAttributes(this.props),t?this._endCb=t:this._endCb&&this._endCb(this.animate,this)}getEndProps(){return this.props}getFromProps(){return this.fromProps}getMergedEndProps(){return this.getEndProps()}stop(){}}class RC extends TC{constructor(t,e,i,r){super(t,e,i,r)}onStart(){super.onStart()}onFirstRun(){const t=this.getFromProps();this.target.setAttributes(t)}update(t,e,i){this.onStart()}determineInterpolateUpdateFunction(){}}class BC extends et{get animateCount(){return this._animateCount}constructor(){super(),this.head=null,this.tail=null,this.animateMap=new Map,this._animateCount=0,this._playSpeed=1,this._totalDuration=0,this._startTime=0,this._currentTime=0,this._animationEndFlag=!0,this.id=e.GenAutoIncrementId(),this.paused=!1}isRunning(){return!this.paused&&this._animateCount>0}forEachAccessAnimate(t){let e=this.head,i=0;for(;e;){const r=e.next;t(e.animate,i),i++,e=r}}addAnimate(t){const e={animate:t,next:null,prev:null};this.head?this.tail&&(this.tail.next=e,e.prev=this.tail,this.tail=e):(this.head=e,this.tail=e),this.animateMap.set(t,e),this._animateCount++,this._totalDuration=Math.max(this._totalDuration,t.getStartTime()+t.getDuration())}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;this._animationEndFlag&&(this._animationEndFlag=!1,this.emit("animationStart"));const e=t*this._playSpeed;this._currentTime+=e,this.forEachAccessAnimate(((t,i)=>{t.status===Z.END?this.removeAnimate(t,!0):t.status!==Z.RUNNING&&t.status!==Z.INITIAL||t.advance(e)})),0===this._animateCount&&(this._animationEndFlag=!0,this.emit("animationEnd"))}clear(){this.forEachAccessAnimate((t=>{t.release()})),this.head=null,this.tail=null,this.animateMap.clear(),this._animateCount=0,this._totalDuration=0}removeAnimate(t,e=!0){const i=this.animateMap.get(t);i&&(e&&(t._onRemove&&t._onRemove.forEach((t=>t())),t.release()),i.prev?i.prev.next=i.next:this.head=i.next,i.next?i.next.prev=i.prev:this.tail=i.prev,this.animateMap.delete(t),this._animateCount--,t.getStartTime()+t.getDuration()>=this._totalDuration&&this.recalculateTotalDuration())}recalculateTotalDuration(){this._totalDuration=0,this.forEachAccessAnimate((t=>{this._totalDuration=Math.max(this._totalDuration,t.getStartTime()+t.getDuration())}))}getTotalDuration(){return this._totalDuration}getPlaySpeed(){return this._playSpeed}setPlaySpeed(t){this._playSpeed=t}getPlayState(){return this.paused?"paused":0===this.animateCount?"stopped":"playing"}setStartTime(t){this._startTime=t}getStartTime(){return this._startTime}getCurrentTime(){return this._currentTime}setCurrentTime(t){this._currentTime=t}}const MC=new BC;MC.isGlobal=!0;class PC{constructor(t=e.GenAutoIncrementId(),i=MC,r){this.id=t,this.status=Z.INITIAL,this._timeline=i,i.addAnimate(this),this.slience=r,this._startTime=0,this._duration=0,this._totalDuration=0,this._loopCount=0,this._currentLoop=0,this._bounce=!1,this._firstStep=null,this._lastStep=null,this._startProps={},this._endProps={},this._preventAttrs=new Set,this.currentTime=0,this.interpolateUpdateFunction=null,this.priority=0}getStartProps(){return this._startProps}getEndProps(){return this._endProps}setTimeline(t){this._timeline=t}getTimeline(){return this._timeline}get timeline(){return this._timeline}bind(t){return this.target=t,this.target.animates||(this.target.animates=new Map),this.target.animates.set(this.id,this),this.onRemove((()=>{this.stop(),this.target.animates.delete(this.id)})),this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.target.animationAttribute||(this.target.animationAttribute={}),this}to(t,e=300,i="linear"){const r=new TC(q.to,t,e,i);return r.bind(this.target,this),this.updateStepAfterAppend(r),this}wait(t){const e=new RC(q.wait,{},t,"linear");return e.bind(this.target,this),this.updateStepAfterAppend(e),this}updateStepAfterAppend(t){this._firstStep?(this._lastStep.append(t),this._lastStep=t):(this._firstStep=t,this._lastStep=t),this.parseStepProps(t),this.updateDuration()}parseStepProps(t){this._lastStep&&(t.propKeys=t.propKeys||Object.keys(t.props),Object.keys(this._endProps).forEach((e=>{var i;t.props[e]=null!==(i=t.props[e])&&void 0!==i?i:this._endProps[e]})),t.propKeys.forEach((e=>{this._endProps[e]=t.props[e]})))}reSyncProps(){if(!this._lastStep)return;this._endProps={};let t=this._firstStep;for(;t;)Object.keys(this._endProps).forEach((e=>{var i;t.props[e]=null!==(i=t.props[e])&&void 0!==i?i:this._endProps[e]})),t.propKeys.forEach((e=>{this._endProps[e]=t.props[e]})),t=t.next}from(t,e=300,i="linear"){const r=new TC(q.from,t,e,i);return this._firstStep?(this._lastStep.append(r),this._lastStep=r):(this._firstStep=r,this._lastStep=r),this.updateDuration(),this}play(t){return t.bind(this.target,this),this.updateStepAfterAppend(t),this}pause(){this.status===Z.RUNNING&&(this.status=Z.PAUSED)}resume(){this.status===Z.PAUSED&&(this.status=Z.RUNNING)}onStart(t){var e;t?(this._onStart||(this._onStart=[]),this._onStart.push(t)):(null===(e=this._onStart)||void 0===e||e.forEach((t=>t())),Object.keys(this._endProps).forEach((t=>{this._startProps[t]=this.target.getComputedAttribute(t)})))}onEnd(t){var e;t?(this._onEnd||(this._onEnd=[]),this._onEnd.push(t)):null===(e=this._onEnd)||void 0===e||e.forEach((t=>t()))}onFrame(t){t&&(this._onFrame||(this._onFrame=[]),this._onFrame.push(t))}onRemove(t){var e;t?(this._onRemove||(this._onRemove=[]),this._onRemove.push(t)):null===(e=this._onRemove)||void 0===e||e.forEach((t=>t()))}preventAttr(t){this._preventAttrs.add(t),delete this._startProps[t],delete this._endProps[t];let e=this._firstStep;for(;e;)e.deleteSelfAttr(t),e=e.next}preventAttrs(t){t.forEach((t=>this._preventAttrs.add(t)))}validAttr(t){return!this._preventAttrs.has(t)}runCb(t){var e;return null===(e=this._lastStep)||void 0===e||e.onEnd(t),this}startAt(t){return this._startTime=t,this}customInterpolate(t,e,i,r,o,n){return!1}getFromValue(){return this._startProps}getToValue(){return this._endProps}stop(t){let e=this._firstStep;for(;e;)e.stop(),e=e.next;this.status!==Z.END&&this.onEnd(),this.status=Z.END,this.target&&("start"===t?this.target.setAttributes(this._startProps):"end"===t?this.target.setAttributes(this._endProps):t&&this.target.setAttributes(t))}release(){this.status=Z.END,this._onRemove&&this._onRemove.forEach((t=>t())),this._onStart=[],this._onFrame=[],this._onEnd=[],this._onRemove=[]}getDuration(){return this._duration}getStartTime(){return this._startTime}afterAll(t){if(!t||0===t.length)return this;let e=0;return t.forEach((t=>{const i=t.getStartTime()+t.getTotalDuration();e=Math.max(e,i)})),this.startAt(e)}after(t){if(!t)return this;const e=t.getStartTime()+t.getTotalDuration();return this.startAt(e)}parallel(t){return t?(this.startAt(t.getStartTime()),this):this}loop(t){return!0===t?t=1/0:!1===t&&(t=0),this._loopCount=t,this.updateDuration(),this}bounce(t){return this._bounce=t,this}advance(t){var e,i,r;if(this.status===Z.END)return;const o=this.currentTime+t;if(o<this._startTime)return void(this.currentTime=o);if(o>=this._startTime+this._totalDuration)return null===(e=this._lastStep)||void 0===e||e.onUpdate(!0,1,{}),null===(i=this._lastStep)||void 0===i||i.onEnd(),this.onEnd(),void(this.status=Z.END);this.status=Z.RUNNING,this.currentTime<=this._startTime&&this.onStart(),this.currentTime=o;let n=o-this._startTime,s=!1,a=!1;if(this._loopCount>0){n=(o-this._startTime)%this._duration;const t=Math.floor((o-this._startTime)/this._duration);s=t>this._currentLoop,this._currentLoop=t,a=this._bounce&&t%2==1,a&&(n=this._duration-n)}s&&!a&&this.target.setAttributes(this._startProps);let l=null;if(this._lastStep===this._firstStep)l=this._firstStep;else{let t=this._firstStep;for(;t;){const e=t.getStartTime(),i=t.getDuration();if(n>=e&&n<=e+i){l=t;break}t=t.next}}if(!l)return;l!==this.lastRunStep&&(null===(r=this.lastRunStep)||void 0===r||r.onEnd()),this.lastRunStep=l;const h=(n-l.getStartTime())/l.getDuration(),c=h>=1;l.update(c,h,{}),c&&(l.onEnd(),this.lastRunStep=null)}updateDuration(){this._lastStep?(this._duration=this._lastStep.getStartTime()+this._lastStep.getDuration(),this._totalDuration=this._duration*(this._loopCount+1)):this._duration=0}getTotalDuration(){return this._totalDuration}getLoop(){return this._loopCount}}const HC=new N;class kC{constructor(){this.released=!1}tick(t,e){HC.addAnimationFrameCb((()=>{if(!this.released)return e(this)}))}release(){this.released=!0}getTime(){return Date.now()}}class EC extends et{constructor(t){super(),this.timelines=[],this.frameTimeHistory=[],this.handleTick=(t,e)=>{const{once:i=!1}=null!=e?e:{};if(this.ifCanStop())return this.stop(),!1;const r=t.getTime();this._lastTickTime=r,this.lastFrameTime<0&&(this.lastFrameTime=r-this.interval+this.timeOffset,this.frameTimeHistory.push(this.lastFrameTime));const o=r-this.lastFrameTime,n=this.checkSkip(o);return n||(this._handlerTick(o),this.lastFrameTime=r,this.frameTimeHistory.push(this.lastFrameTime)),i||t.tick(this.interval,this.handleTick),!n},this._handlerTick=t=>{this.status===Y.RUNNING&&(this.tickCounts++,this.timelines.forEach((e=>{e.tick(t)})),this.emit("tick",t))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.stage=t,this.autoStop=!0,this.interval=16,this.computeTimeOffsetAndJitter()}bindStage(t){this.stage=t}computeTimeOffsetAndJitter(){this.timeOffset=Math.floor(Math.random()*this.interval),this._jitter=Math.min(Math.max(.2*this.interval,6),.7*this.interval)}init(){this.interval=16,this.status=Y.INITIAL,D.global.hooks.onSetEnv.tap("graph-ticker",(()=>{this.initHandler(!1)})),D.global.env&&this.initHandler(!1)}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter((e=>e!==t))}getTimelines(){return this.timelines}initHandler(t=!1){this.setupTickHandler(t)}setupTickHandler(t=!1){if(!t&&this.tickerHandler)return!0;const e=new kC;return this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=e,!0}setInterval(t){this.interval=t,this.computeTimeOffsetAndJitter()}getInterval(){return this.interval}setFPS(t){this.setInterval(Math.floor(1e3/t))}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,(t=>this.handleTick(t,{once:!0})))}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,(t=>{this.handleTick(t,{once:!0})}))}pause(){return this.status!==Y.INITIAL&&(this.status=Y.PAUSE,!0)}resume(){return this.status!==Y.INITIAL&&(this.status=Y.RUNNING,!0)}ifCanStop(){if(this.autoStop){if(!this.timelines.length)return!0;if(this.timelines.every((t=>!t.isRunning())))return!0}return!1}start(t=!1){if(this.status===Y.RUNNING)return!1;if(!this.tickerHandler)return!1;if(!t){if(this.status===Y.PAUSE)return!1;if(this.ifCanStop())return!1}return this.status=Y.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0}stop(){this.status=Y.INITIAL,this.setupTickHandler(!0),this.lastFrameTime=-1}trySyncTickStatus(){this.status===Y.INITIAL&&this.timelines.some((t=>t.isRunning()))?this.start():this.status===Y.RUNNING&&this.timelines.every((t=>!t.isRunning()))&&this.stop()}release(){var t;this.stop(),this.timelines=[],null===(t=this.tickerHandler)||void 0===t||t.release(),this.tickerHandler=null,this.lastFrameTime=-1}checkSkip(t){var e,i,r;return"performance"!==(null===(r=null===(i=null===(e=this.stage)||void 0===e?void 0:e.params)||void 0===i?void 0:i.optimize)||void 0===r?void 0:r.tickRenderMode)&&t<this.interval+2*(Math.random()-.5)*this._jitter}}class FC{constructor(){this.transitions=new Map,this.registerDefaultTransitions()}static getInstance(){return FC.instance||(FC.instance=new FC),FC.instance}registerDefaultTransitions(){this.registerTransition("appear","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("appear","appear",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("appear","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("appear","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("normal","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("normal","normal",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("normal","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("normal","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("exit","*",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("exit","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("exit","enter",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("exit","exit",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("enter","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("enter","enter",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("enter","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("enter","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("disappear","*",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("disappear","appear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("update","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("update","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("update","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("state","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("state","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("state","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0})))}isTransitionAllowed(t,e,i){var r,o,n,s;let a=null===(r=this.transitions.get(t))||void 0===r?void 0:r.get(e);return a?a(i,t):(a=null===(o=this.transitions.get(t))||void 0===o?void 0:o.get("*"),a?a(i,t):(a=null===(n=this.transitions.get("*"))||void 0===n?void 0:n.get(e),a?a(i,t):(a=null===(s=this.transitions.get("*"))||void 0===s?void 0:s.get("*"),a?a(i,t):{allowTransition:!0,stopOriginalTransition:!0})))}registerTransition(t,e,i){let r=this.transitions.get(t);r||(r=new Map,this.transitions.set(t,r)),r.set(e,i)}}FC.getInstance();class LC{static registerBuiltInAnimate(t,e){LC.builtInAnimateMap[t]=e}constructor(t){this._animates=[],this._startCallbacks=[],this._endCallbacks=[],this._started=!1,this._activeCount=0,this._target=t}onStart(t){t?(this._startCallbacks.push(t),this._started&&this._activeCount>0&&t()):this._startCallbacks.forEach((t=>{t()}))}onEnd(t){t?this._endCallbacks.push(t):this._endCallbacks.forEach((t=>{t()}))}_trackAnimation(t){this._animates.push(t),this._activeCount++,1!==this._activeCount||this._started||(this._started=!0,this.onStart()),t.onEnd((()=>{this._activeCount--;const e=this._animates.indexOf(t);e>=0&&this._animates.splice(e,1),0===this._activeCount&&this._started&&(this._started=!1,this.onEnd())}))}parseParams(t,e,i){var r,o;const n=this.resolveValue(t.totalTime,void 0,void 0),s=this.resolveValue(t.startTime,void 0,0),a=Object.assign({},t);a.oneByOneDelay=0,a.startTime=s,a.totalTime=n;const l=this.resolveValue(t.oneByOne,i,!1);if(e){const t=a.timeSlices;ut(t)||(a.timeSlices=[t]);let e=0;a.timeSlices=a.timeSlices.map((t=>{const r=this.resolveValue(t.delay,i,0),o=this.resolveValue(t.delayAfter,i,0),n=this.resolveValue(t.duration,i,300);return e+=r+n+o,Object.assign(Object.assign({},t),{delay:r,delayAfter:o,duration:n})}));let r=0;l&&(r="number"==typeof l?l:l?e:0),a.oneByOneDelay=r;let o=1;if(n){const t=e+r*(this._target.count-2);o=n?n/t:1}a.timeSlices=a.timeSlices.map((t=>{let e=t.effects;return Array.isArray(e)||(e=[e]),Object.assign(Object.assign({},t),{delay:t.delay*o,delayAfter:t.delayAfter*o,duration:t.duration*o,effects:e.map((t=>{var e,i;const r=null!==(e=t.custom)&&void 0!==e?e:LC.builtInAnimateMap[null!==(i=t.type)&&void 0!==i?i:"fromTo"],o=r&&ot(r)?/^class\s/.test(Function.prototype.toString.call(r))?1:2:0;return Object.assign(Object.assign({},t),{custom:r,customType:o})}))})})),a.oneByOneDelay=r*o,a.startTime=s*o}else{const e=this.resolveValue(t.delay,i,0),h=this.resolveValue(t.delayAfter,i,0),c=this.resolveValue(t.duration,i,300);let d=0;l&&(d="number"==typeof l?l:l?e+h+c:0),a.oneByOneDelay=d,a.custom=null!==(r=t.custom)&&void 0!==r?r:LC.builtInAnimateMap[null!==(o=t.type)&&void 0!==o?o:"fromTo"];const u=a.custom&&ot(a.custom)?/^class\s/.test(Function.prototype.toString.call(a.custom))?1:2:0;if(a.customType=u,n){const t=e+h+c+d*(this._target.count-2),i=n?n/t:1;a.delay=e*i,a.delayAfter=h*i,a.duration=c*i,a.oneByOneDelay=d*i,a.startTime=s}}return a}execute(t){Array.isArray(t)?t.forEach((t=>this._execute(t))):this._execute(t)}_execute(t){if(t.selfOnly)return this._executeItem(t,this._target,0,1);const e="timeSlices"in t;let i;e&&t.partitioner&&(i=(null!=i?i:this._target.getChildren()).filter((e=>{var i,r;return t.partitioner(null===(r=null===(i=e.context)||void 0===i?void 0:i.data)||void 0===r?void 0:r[0],e,{})}))),e&&t.sort&&(i=null!=i?i:this._target.getChildren(),i.sort(((e,i)=>{var r,o,n,s;return t.sort(null===(o=null===(r=e.context)||void 0===r?void 0:r.data)||void 0===o?void 0:o[0],null===(s=null===(n=i.context)||void 0===n?void 0:n.data)||void 0===s?void 0:s[0],e,i,{})})));const r=e?(i,r,o)=>{const n=this.parseParams(t,e,i),s=this.executeTimelineItem(n,i,r,o);s&&this._trackAnimation(s)}:(i,r,o)=>{const n=this.parseParams(t,e,i),s=this.executeTypeConfigItem(n,i,r,o);s&&this._trackAnimation(s)};i?i.forEach(((t,e)=>r(t,e,i.length))):this._target.count<=1?r(this._target,0,1):this._target.forEachChildren(((t,e)=>r(t,e,this._target.count-1)))}executeTypeConfigItem(t,e,i,r){var o,n,s,a,l,h,c,d;const{type:u="fromTo",channel:g,customParameters:p,easing:f="linear",delay:m=0,delayAfter:b=0,duration:y=300,startTime:C=0,oneByOneDelay:w=0,loop:v,bounce:x,priority:_=0,options:S,custom:A,customType:T,controlOptions:R}=t,B=e.animate();B.priority=_;const M=ot(m)?m(null===(n=null===(o=e.context)||void 0===o?void 0:o.data)||void 0===n?void 0:n[0],e,{}):m,P=null===(a=null===(s=e.context)||void 0===s?void 0:s.data)||void 0===a?void 0:a[0],H=null===(l=e.context)||void 0===l?void 0:l.indexKey;P&&H&&(i=null!==(h=P[H])&&void 0!==h?h:i),B.startAt(C);const k=i*w+M;k>0&&B.wait(k);let E=null,F=t.to,L=t.from;F||(E||(E=this.createPropsFromChannel(g,e)),F=E.props),L||(E||(E=this.createPropsFromChannel(g,e)),L=E.from),this._handleRunAnimate(B,A,T,L,F,y,f,p,R,S,u,e);let I=0;w&&(I=w*(r-i-1));const z=ot(b)?b(null===(d=null===(c=e.context)||void 0===c?void 0:c.data)||void 0===d?void 0:d[0],e,{}):b;return z>0&&(I+=z),I>0&&B.wait(I),v&&v>0&&B.loop(v),x&&B.bounce(!0),B}_handleRunAnimate(t,e,i,r,o,n,s,a,l,h,c,d){var u,g,p,f;if(e&&i){const c=Object.assign({width:d.stage.width,height:d.stage.height,group:this._target.parent},this.resolveValue(a,d)),m=ot(h)?h.call(null,null!==(g=c&&(null===(u=c.data)||void 0===u?void 0:u[0]))&&void 0!==g?g:null===(f=null===(p=d.context)||void 0===p?void 0:p.data)||void 0===f?void 0:f[0],d,c):h;c.options=m,c.controlOptions=l,1===i?this.createCustomAnimation(t,e,r,o,n,s,c):2===i&&this.createCustomInterpolatorAnimation(t,e,o,n,s,c)}else"to"===c?t.to(o,n,s):"from"===c&&t.from(o,n,s)}executeTimelineItem(t,e,i,r){var o,n,s,a;const{timeSlices:l,startTime:h=0,loop:c,bounce:d,oneByOneDelay:u,priority:g,controlOptions:p}=t,f=null===(n=null===(o=e.context)||void 0===o?void 0:o.data)||void 0===n?void 0:n[0],m=null===(s=e.context)||void 0===s?void 0:s.indexKey;f&&m&&(i=null!==(a=f[m])&&void 0!==a?a:i);const b=e.animate();return b.priority=g,b.startAt(h),b.wait(i*u),c&&c>0&&b.loop(c),d&&b.bounce(!0),(Array.isArray(l)?l:[l]).forEach((t=>{this.applyTimeSliceToAnimate(t,b,e,p)})),u&&b.wait(u*(r-i-1)),b}applyTimeSliceToAnimate(t,e,i,r){var o,n,s,a;const{effects:l,duration:h=300,delay:c=0,delayAfter:d=0}=t,u=ot(c)?c(null===(n=null===(o=i.context)||void 0===o?void 0:o.data)||void 0===n?void 0:n[0],i,{}):c,g=ot(d)?d(null===(a=null===(s=i.context)||void 0===s?void 0:s.data)||void 0===a?void 0:a[0],i,{}):d;u>0&&e.wait(u),(Array.isArray(l)?l:[l]).forEach((t=>{var o;const{type:n="fromTo",channel:s,customParameters:a,easing:l="linear",options:c}=t;let d=null,u=t.to,g=t.from;u||(d||(d=this.createPropsFromChannel(s,i)),u=d.props),g||(d||(d=this.createPropsFromChannel(s,i)),g=d.from);const p=null!==(o=t.custom)&&void 0!==o?o:LC.builtInAnimateMap[n],f=t.customType;this._handleRunAnimate(e,p,f,g,u,h,l,a,r,c,n,i)})),g>0&&e.wait(g)}createCustomInterpolatorAnimation(t,e,i,r,o,n){const s=i;Object.keys(s).forEach((e=>{t.target.getComputedAttribute(e)})),t.interpolateUpdateFunction=(i,r,o,s,a)=>{e(o,i,r,s,a,t.target,n)},t.to(i,r,o)}createCustomAnimation(t,e,i,r,o,n,s){const a=new e(i,r,o,n,s);t.play(a)}createPropsFromChannel(t,e){const i={};let r=null;return t?(Array.isArray(t)?t.forEach((t=>{var r,o;const n=null===(o=null===(r=e.context)||void 0===r?void 0:r.diffAttrs)||void 0===o?void 0:o[t];void 0!==n&&(i[t]=n)})):Object.keys(t).forEach((o=>{var n,s,a,l;const h=t[o];void 0!==h.to&&("function"==typeof h.to?i[o]=h.to(null===(s=null===(n=e.context)||void 0===n?void 0:n.data)||void 0===s?void 0:s[0],e,{}):i[o]=h.to),void 0!==h.from&&(r||(r={}),"function"==typeof h.from?r[o]=h.from(null===(l=null===(a=e.context)||void 0===a?void 0:a.data)||void 0===l?void 0:l[0],e,{}):r[o]=h.from)})),{from:r,props:i}):{from:r,props:i}}resolveValue(t,e,i){var r,o;return void 0===t?i:"function"==typeof t&&e?t(null===(o=null===(r=e.context)||void 0===r?void 0:r.data)||void 0===o?void 0:o[0],e,{}):t}executeItem(t,e,i=0,r=1){return Array.isArray(t)?t.map((t=>this._executeItem(t,e,i,r))).filter(Boolean):[this._executeItem(t,e,i,r)].filter(Boolean)}_executeItem(t,e,i=0,r=1){if(!e)return null;const o="timeSlices"in t;let n=null;const s=this.parseParams(t,o);return n=o?this.executeTimelineItem(s,e,i,r):this.executeTypeConfigItem(s,e,i,r),n&&this._trackAnimation(n),n}stop(t){for(;this._animates.length>0;){const e=this._animates.pop();null==e||e.stop(t)}this._animates=[],this._activeCount=0,this._started&&(this._started=!1,this.onEnd())}}LC.builtInAnimateMap={};const IC="appear",zC="disappear",OC="update",DC="highlight",WC="unhighlight";class NC{constructor(t){this.graphic=t}registerState(t){this.states||(this.states=new Map),this.states.set(t.name,t)}clearStates(){var t;null===(t=this.states)||void 0===t||t.clear()}}class GC{constructor(t){this.stateList=null,this.graphic=t}applyState(t,e,i){const r=FC.getInstance(),o=[],n=[];if(this.stateList&&this.stateList.length?t.forEach(((t,i)=>{const s={allowTransition:!0,stopOriginalTransition:!0};this.stateList.forEach((e=>{const i=r.isTransitionAllowed(e.state,t,this.graphic);s.allowTransition=s.allowTransition&&i.allowTransition})),s.allowTransition&&(n.push({state:t,animationConfig:ut(e[i])?e[i].map((t=>t.animation)):e[i].animation,executor:new LC(this.graphic)}),this.stateList.forEach((e=>{r.isTransitionAllowed(e.state,t,this.graphic).stopOriginalTransition&&o.push(e)})))})):t.forEach(((t,i)=>{n.push({state:t,animationConfig:ut(e[i])?e[i].map((t=>t.animation)):e[i].animation,executor:new LC(this.graphic)})})),o.forEach((t=>{t.executor.stop()})),n.length){n[0].executor.execute(n[0].animationConfig);for(let t=0;t<n.length;t++){const e=n[t+1],r=n[t];r.executor.onEnd((()=>{e&&e.executor.execute(e.animationConfig),this.stateList=this.stateList.filter((t=>t!==r)),t===n.length-1&&i&&i(!1)}))}}else i&&i(!0);this.stateList?this.stateList=this.stateList.filter((t=>!o.includes(t))):this.stateList=[],this.stateList.push(...n)}applyAppearState(t,e){this.applyState([IC],[{name:IC,animation:t}],e)}applyDisappearState(t,e){this.applyState([zC],[{name:zC,animation:t}],e)}applyUpdateState(t,e){this.applyState([OC],[{name:OC,animation:t}],e)}applyHighlightState(t,e){this.applyState([DC],[{name:DC,animation:t}],e)}applyUnhighlightState(t,e){this.applyState([WC],[{name:WC,animation:t}],e)}stopState(t,e){var i;const r=null===(i=this.stateList)||void 0===i?void 0:i.find((e=>e.state===t));r&&r.executor.stop(e)}clearState(){var t;null===(t=this.stateList)||void 0===t||t.forEach((t=>{t.executor.stop()})),this.stateList=null}reApplyState(t){var e;const i=null===(e=this.stateList)||void 0===e?void 0:e.find((e=>e.state===t));if(i){const t=this.stateList.slice();i.executor.stop(),this.stateList=t,i.executor.execute(i.animationConfig)}}}class jC{_getAnimationStateManager(t){return t._animationStateManager||(t._animationStateManager=new GC(t)),t._animationStateManager}_getAnimationStateStore(t){return t._animationStateStore||(t._animationStateStore=new NC(t)),t._animationStateStore}registerAnimationState(t){return this._getAnimationStateStore(this).registerState(t),this}applyAnimationState(t,e,i){return this._getAnimationStateManager(this).applyState(t,e,i),this}applyAppearState(t,e){return this._getAnimationStateManager(this).applyAppearState(t,e),this}applyDisappearState(t,e){return this._getAnimationStateManager(this).applyDisappearState(t,e),this}applyUpdateState(t,e){return this._getAnimationStateManager(this).applyUpdateState(t,e),this}applyHighlightState(t,e){return this._getAnimationStateManager(this).applyHighlightState(t,e),this}applyUnhighlightState(t,e){return this._getAnimationStateManager(this).applyUnhighlightState(t,e),this}stopAnimationState(t,e,i=!1){return this._getAnimationStateManager(this).stopState(t,e),i&&this.isContainer&&this.forEachChildren((r=>{r.stopAnimationState(t,e,i)})),this}clearAnimationStates(){const t=this._animationStateManager;return t&&t.clearState(),this}reApplyAnimationState(t,e=!1){const i=this._animationStateManager;return i&&i.reApplyState(t),e&&this.isContainer&&this.forEachChildren((i=>{i.reApplyAnimationState(t,e)})),this}static extend(t){return(new jC)._getAnimationStateManager(t),t}}class VC{getAttributes(t=!1){return t&&this.finalAttribute?this.finalAttribute:this.attribute}animate(t){var e,i,r;const o=new PC(null==t?void 0:t.id,null!==(i=null!==(e=null==t?void 0:t.timeline)&&void 0!==e?e:this.stage&&this.stage.getTimeline())&&void 0!==i?i:MC,null==t?void 0:t.slience);if(o.bind(this),t){const{onStart:e,onEnd:i,onRemove:r}=t;null!=e&&o.onStart(e),null!=i&&o.onEnd(i),null!=r&&o.onRemove(r)}return null===(r=this.stage)||void 0===r||r.ticker.start(),o}createTimeline(){return new BC}createTicker(t){return new EC(t)}setFinalAttributes(t){this.finalAttribute||(this.finalAttribute={}),Object.assign(this.finalAttribute,t)}initFinalAttributes(t){this.finalAttribute=t}initAnimateExecutor(){this._animateExecutor||(this._animateExecutor=new LC(this))}executeAnimation(t){return this.initAnimateExecutor(),this._animateExecutor.execute(t),this}executeAnimations(t){return this.initAnimateExecutor(),t.forEach((t=>{this._animateExecutor.execute(t)})),this}getFinalAttribute(){return this.finalAttribute}getGraphicAttribute(t,e=!1){return!e&&this.finalAttribute?this.finalAttribute[t]:this.attribute[t]}pauseAnimation(t=!1){this.animates&&this.animates.forEach((t=>t.pause())),t&&this.isContainer&&this.forEachChildren((e=>{e.pauseAnimation(t)}))}resumeAnimation(t=!1){this.animates&&this.animates.forEach((t=>t.resume())),t&&this.isContainer&&this.forEachChildren((e=>{e.resumeAnimation(t)}))}stopAnimation(t=!1){this.animates&&this.animates.forEach((t=>t.stop())),t&&this.isContainer&&this.forEachChildren((e=>{e.stopAnimation(t)}))}}class UC extends TC{constructor(t,e,i,r,o){super("customAnimate",e,i,r),this.type="customAnimate",this.customFrom=t,this.params=o,this.from=t,this.to=e}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.onUpdate(t,r,i),this.syncAttributeUpdate()}setProps(t){this.props=t,this.propKeys=Object.keys(t),this.animate.reSyncProps()}}class KC extends UC{completeBind(t){this.setStartTime(0),this._animator&&this._animator.start(),this.setDuration(t.getDuration())}stop(){this._animator&&this._animator.stop()}}class $C{constructor(t){this.tasks=[],this.started=!1,this.completed=0,this.totalDuration=0,this.onStartCallbacks=[],this.onEndCallbacks=[],this.onUpdateCallbacks=[],this.component=t}animate(t,e){return this.started||this.tasks.push({graphic:t,config:e}),this}onStart(t){return this.onStartCallbacks.push(t),this}onEnd(t){return this.onEndCallbacks.push(t),this}onUpdate(t){return this.onUpdateCallbacks.push(t),this}start(){return this.started?this:(this.started=!0,this.completed=0,this.onStartCallbacks.forEach((t=>t())),0===this.tasks.length?(setTimeout((()=>{this.onEndCallbacks.forEach((t=>t()))}),0),this):(this.tasks.forEach((t=>{const e=new LC(t.graphic);e.onEnd((()=>{this.completed++,this.completed===this.tasks.length&&this.onEndCallbacks.forEach((t=>t()))}));const i=e.executeItem(t.config,t.graphic);t.animate=i,i.forEach((t=>{this.totalDuration=Math.max(this.totalDuration,t.getStartTime()+t.getDuration())}))})),this))}deleteSelfAttr(t){this.tasks.forEach((e=>{e.animate&&e.animate.forEach((e=>e.preventAttr(t)))}))}stop(t){return this.tasks.forEach((e=>{e.animate&&e.animate.forEach((e=>e.stop(t)))})),this.started&&this.completed!==this.tasks.length&&(this.onEndCallbacks.forEach((t=>t())),this.completed=this.tasks.length),this}getDuration(){return this.totalDuration}}function XC(t){return new $C(t)}class YC extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.formatTemplate=null,this.decimalLength=null==o?void 0:o.decimalLength,(null==o?void 0:o.formatTemplate)&&o.formatTemplate.includes("{{var}}")&&(this.formatTemplate=o.formatTemplate)}onFirstRun(){var t,e,i;const r=this.getLastProps(),o=this.getEndProps(),n=null!==(t=r.text)&&void 0!==t?t:0,s=null!==(e=o.text)&&void 0!==e?e:0;this.valid=!0;let a=0,l=0,h="",c="",d=0;if("number"==typeof n){a=n;const t=n.toString().split(".")[1]||"";d=Math.max(d,t.length)}else{if("string"!=typeof n)return void(this.valid=!1);if(n.endsWith("%")){h="%";const t=n.substring(0,n.length-1).replace(/,/g,"");if(a=parseFloat(t)/100,isNaN(a))return void(this.valid=!1);const e=t.split(".")[1]||"";d=Math.max(d,e.length+2)}else{const t=n.replace(/,/g,"");if(a=parseFloat(t),isNaN(a))return void(this.valid=!1);n.includes(",")&&(h=",");const e=t.split(".")[1]||"";d=Math.max(d,e.length)}}if("number"==typeof s){l=s;const t=s.toString().split(".")[1]||"";d=Math.max(d,t.length)}else{if("string"!=typeof s)return void(this.valid=!1);if(s.endsWith("%")){c="%";const t=s.substring(0,s.length-1).replace(/,/g,"");if(l=parseFloat(t)/100,isNaN(l))return void(this.valid=!1);const e=t.split(".")[1]||"";d=Math.max(d,e.length+2)}else{const t=s.replace(/,/g,"");if(l=parseFloat(t),isNaN(l))return void(this.valid=!1);s.includes(",")&&(c=",");const e=t.split(".")[1]||"";d=Math.max(d,e.length)}}if(null===(i=this.params)||void 0===i?void 0:i.format){switch(this.params.format){case"percent":this.format="%";break;case"thousandth":this.format=",";break;case"none":this.format="";break;default:this.format=c||h}"%"===this.format&&"%"!==c&&"%"!==h&&void 0===this.decimalLength&&(this.decimalLength=2),"%"===this.format||"%"!==c&&"%"!==h||(a*=100,l*=100)}else this.format=c||h;this.fromNumber=a,this.toNumber=l,void 0===this.decimalLength&&(this.decimalLength=d)}onEnd(t){super.onEnd(t),t||this.props&&this.target.setAttributes(this.props)}onUpdate(t,e,i){if(!this.valid)return;const r=this.fromNumber+(this.toNumber-this.fromNumber)*e;let o="";const n=this.format,s=("%"===n?100*r:r).toFixed(this.decimalLength);let a,l=s;if(parseFloat(s)===Math.floor(parseFloat(s))&&(l=Math.floor(parseFloat(s))),"%"===n)a=`${l}%`;else if(","===n){const t=l.toString().split(".");t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a=t.join(".")}else a=l;o=this.formatTemplate?this.formatTemplate.replace("{{var}}",a.toString()):a,this.target.setAttribute("text",o)}}class qC extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromText="",this.toText="",this.showCursor=!1,this.cursorChar="|",this.blinkCursor=!0,this.beforeText="",this.afterText="",void 0!==(null==o?void 0:o.showCursor)&&(this.showCursor=o.showCursor),void 0!==(null==o?void 0:o.cursorChar)&&(this.cursorChar=o.cursorChar),void 0!==(null==o?void 0:o.blinkCursor)&&(this.blinkCursor=o.blinkCursor),void 0!==(null==o?void 0:o.beforeText)&&(this.beforeText=o.beforeText),void 0!==(null==o?void 0:o.afterText)&&(this.afterText=o.afterText)}onFirstRun(){var t,e;const i=this.getLastProps(),r=this.getEndProps(),o=null!==(t=i.text)&&void 0!==t?t:"",n=null!==(e=r.text)&&void 0!==e?e:"";this.valid=!0,this.fromText=o.toString(),this.toText=n.toString(),this.toText||""===this.toText||(this.valid=!1)}onEnd(t){super.onEnd(t),t||(this.showCursor&&!this.blinkCursor?this.target.setAttribute("text",this.beforeText+this.toText+this.cursorChar+this.afterText):this.target.setAttribute("text",this.beforeText+this.toText+this.afterText))}onUpdate(t,e,i){if(!this.valid)return;const r=this.toText.length,o=this.fromText.length;let n,s;o>r?(n=Math.round(o-(o-r)*e),s=this.fromText.substring(0,n)):(n=Math.round(o+(r-o)*e),s=this.toText.startsWith(this.fromText)?this.toText.substring(0,n):n<=o?this.fromText.substring(0,n):this.toText.substring(0,n-o+Math.min(o,n)));let a=this.beforeText+s+this.afterText;if(this.showCursor)if(this.blinkCursor){const t=.1;Math.floor(e/t)%2==0&&(a=this.beforeText+s+this.cursorChar+this.afterText)}else a=this.beforeText+s+this.cursorChar+this.afterText;this.target.setAttribute("text",a)}}class ZC extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const r=this.target.getFinalAttribute(),o=null!==(t=this.target.attribute)&&void 0!==t?t:{},n={},s=null!==(e=this.from)&&void 0!==e?e:{};this.keys.forEach((t=>{var e,i,a;n[t]=null!==(e=null==r?void 0:r[t])&&void 0!==e?e:1,s[t]=null!==(a=null!==(i=s[t])&&void 0!==i?i:o[t])&&void 0!==a?a:0}));const a=this.target.getFinalAttribute();a&&this.target.setAttributes(a),this.props=n,this.propKeys=this.keys,this.from=s,this.to=n,!1!==(null===(i=this.params.controlOptions)||void 0===i?void 0:i.immediatelyApply)&&this.target.setAttributes(s)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class JC extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const t=this.target.attribute,e={},i={};this.keys.forEach((r=>{var o;e[r]=0,i[r]=null!==(o=t[r])&&void 0!==o?o:1})),this.props=e,this.propKeys=this.keys,this.from=i,this.to=e,Object.assign(this.target.attribute,i),this.target.addUpdatePositionTag(),this.target.addUpdateBoundTag()}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class QC extends ZC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["clipRange"],this.from={clipRange:0}}onFirstRun(){var t;super.onFirstRun();const{clipDimension:e}=(null===(t=this.params)||void 0===t?void 0:t.options)||{};e&&(this.target.attribute.clipRangeByDimension=e)}}class tw extends JC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["clipRange"]}}class ew extends ZC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["opacity","fillOpacity","strokeOpacity"],this.from={opacity:0,fillOpacity:0,strokeOpacity:0}}}class iw extends JC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["opacity","fillOpacity","strokeOpacity"]}}const rw=(t,e,i)=>{var r;return!1!==(null!==(r=null==e?void 0:e.overall)&&void 0!==r&&r)?((t,e,i)=>{const r=t.getFinalAttribute();if(e&&"anticlockwise"===e.orient){const t=ft(e.overall)?e.overall:2*Math.PI;return{from:{startAngle:t,endAngle:t},to:{startAngle:null==r?void 0:r.startAngle,endAngle:null==r?void 0:r.endAngle}}}const o=ft(null==e?void 0:e.overall)?e.overall:0;return{from:{startAngle:o,endAngle:o},to:{startAngle:null==r?void 0:r.startAngle,endAngle:null==r?void 0:r.endAngle}}})(t,e):((t,e,i)=>{const r=t.getFinalAttribute();return e&&"anticlockwise"===e.orient?{from:{startAngle:null==r?void 0:r.endAngle},to:{startAngle:null==r?void 0:r.startAngle}}:{from:{endAngle:null==r?void 0:r.startAngle},to:{endAngle:null==r?void 0:r.endAngle}}})(t,e)};class ow extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}determineUpdateFunction(){this.propKeys?this.propKeys&&this.propKeys.length>1?this._updateFunction=this.updateAngle:"startAngle"===this.propKeys[0]?this._updateFunction=this.updateStartAngle:"endAngle"===this.propKeys[0]?this._updateFunction=this.updateEndAngle:this.valid=!1:this.valid=!1}deleteSelfAttr(t){delete this.props[t],this.fromProps&&delete this.fromProps[t];const e=this.propKeys.indexOf(t);-1!==e&&this.propKeys.splice(e,1),this.propKeys&&this.propKeys.length>1?this._updateFunction=this.updateAngle:"startAngle"===this.propKeys[0]?this._updateFunction=this.updateStartAngle:"endAngle"===this.propKeys[0]?this._updateFunction=this.updateEndAngle:this._updateFunction=null}updateStartAngle(t){this.target.attribute.startAngle=this.from.startAngle+(this.to.startAngle-this.from.startAngle)*t}updateEndAngle(t){this.target.attribute.endAngle=this.from.endAngle+(this.to.endAngle-this.from.endAngle)*t}updateAngle(t){this.updateStartAngle(t),this.updateEndAngle(t)}onUpdate(t,e,i){this._updateFunction&&(this._updateFunction(e),this.target.addUpdateShapeAndBoundsTag())}}class nw extends ow{onBind(){var t,e;super.onBind();const{from:i,to:r}=rw(this.target,this.params.options,this.params),o=null!==(e=null===(t=this.target.context)||void 0===t?void 0:t.lastAttrs)&&void 0!==e?e:i;this.props=r,this.propKeys=Object.keys(r).filter((t=>null!=r[t])),this.from=o,this.to=r;const n=this.target.getFinalAttribute();n&&this.target.setAttributes(n),this.target.setAttributes(o),this.determineUpdateFunction()}}class sw extends ow{onBind(){super.onBind();const{from:t,to:e}=(i=this.target,r=this.params.options,this.params,!1!==(null!==(o=null==r?void 0:r.overall)&&void 0!==o&&o)?((t,e,i)=>{const r=t.attribute;if(e&&"anticlockwise"===e.orient){const t=ft(e.overall)?e.overall:2*Math.PI;return{from:{startAngle:r.startAngle,endAngle:r.endAngle},to:{startAngle:t,endAngle:t}}}const o=ft(null==e?void 0:e.overall)?e.overall:0;return{from:{startAngle:r.startAngle,endAngle:r.endAngle},to:{startAngle:o,endAngle:o}}})(i,r):((t,e,i)=>{const r=t.attribute;return e&&"anticlockwise"===e.orient?{from:{startAngle:r.startAngle},to:{startAngle:null==r?void 0:r.endAngle}}:{from:{endAngle:r.endAngle},to:{endAngle:null==r?void 0:r.startAngle}}})(i,r));var i,r,o;const n=t;this.props=e,this.propKeys=Object.keys(e).filter((t=>null!=e[t])),this.from=null!=n?n:this.target.attribute,this.to=e,this.determineUpdateFunction()}}class aw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const{from:r,to:o}=((t,e,i)=>{const r=t.getFinalAttribute();switch(null==e?void 0:e.direction){case"x":{const t=r.x,e=r.x1,i=r.width;return{from:st(i)?{x:t+i/2,x1:void 0,width:0}:{x:(t+e)/2,x1:(t+e)/2,width:void 0},to:{x:t,x1:e,width:i}}}case"y":{const t=r.y,e=r.y1,i=r.height;return{from:st(i)?{y:t+i/2,y1:void 0,height:0}:{y:(t+e)/2,y1:(t+e)/2,height:void 0},to:{y:t,y1:e,height:i}}}default:{const t=r.x,e=r.x1,i=r.width,o=r.y,n=r.y1,s=r.height,a={};return st(i)?(a.x=t+i/2,a.width=0,a.x1=void 0):(a.x=(t+e)/2,a.x1=(t+e)/2,a.width=void 0),st(s)?(a.y=o+s/2,a.height=0,a.y1=void 0):(a.y=(o+n)/2,a.y1=(o+n)/2,a.height=void 0),{from:a,to:{x:t,y:o,x1:e,y1:n,width:i,height:s}}}}})(this.target,this.params.options,this.params),n=null!==(e=null===(t=this.target.context)||void 0===t?void 0:t.lastAttrs)&&void 0!==e?e:r;this.props=o,this.propKeys=Object.keys(o).filter((t=>null!=o[t])),this.from=n,this.to=o;const s=this.target.getFinalAttribute();s&&this.target.setAttributes(s),!1!==(null===(i=this.params.controlOptions)||void 0===i?void 0:i.immediatelyApply)&&this.target.setAttributes(n)}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class lw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const{from:t,to:e}=((t,e,i)=>{const r=t.attribute;switch(null==e?void 0:e.direction){case"x":{const t=r.x,e=r.x1,i=r.width;return{to:st(i)?{x:t+i/2,x1:void 0,width:0}:{x:(t+e)/2,x1:(t+e)/2,width:void 0}}}case"y":{const t=r.y,e=r.y1,i=r.height;return{to:st(i)?{y:t+i/2,y1:void 0,height:0}:{y:(t+e)/2,y1:(t+e)/2,height:void 0}}}default:{const t=r.x,e=r.y,i=r.x1,o=r.y1,n=r.width,s=r.height,a={};return st(n)?(a.x=t+n/2,a.width=0,a.x1=void 0):(a.x=(t+i)/2,a.x1=(t+i)/2,a.width=void 0),st(s)?(a.y=e+s/2,a.height=0,a.y1=void 0):(a.y=(e+o)/2,a.y1=(e+o)/2,a.height=void 0),{to:a}}}})(this.target,this.params.options,this.params);this.props=e,this.propKeys=Object.keys(e).filter((t=>null!=e[t])),this.from=null!=t?t:this.target.attribute,this.to=e}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}const hw=(t,e,i)=>{var r;return!1!==(null!==(r=null==e?void 0:e.overall)&&void 0!==r&&r)?function(t,e,i){var r,o,n;const s=t.getFinalAttribute(),a=s.y,l=s.y1,h=s.height;let c;return e&&"negative"===e.orient?ft(e.overall)?c=e.overall:i.group?(c=null!==(n=null!==(r=i.groupHeight)&&void 0!==r?r:null===(o=e.layoutRect)||void 0===o?void 0:o.height)&&void 0!==n?n:i.group.getBounds().height(),i.groupHeight=c):c=i.height:c=ft(null==e?void 0:e.overall)?e.overall:0,{from:{y:c,y1:nt(l)?void 0:c,height:nt(h)?void 0:0},to:{y:a,y1:l,height:h}}}(t,e,i):function(t,e,i){const r=t.getFinalAttribute(),o=r.y,n=r.y1,s=r.height;if(e&&"negative"===e.orient){const t=st(s)?Math.max(o,o+s):Math.max(o,n);return{from:{y:t,y1:nt(n)?void 0:t,height:nt(s)?void 0:0},to:{y:o,y1:n,height:s}}}const a=st(s)?Math.min(o,o+s):Math.min(o,n);return{from:{y:a,y1:nt(n)?void 0:a,height:nt(s)?void 0:0},to:{y:o,y1:n,height:s}}}(t,e)};class cw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const{from:r,to:o}=hw(this.target,this.params.options,this.params),n=null!==(e=null===(t=this.target.context)||void 0===t?void 0:t.lastAttrs)&&void 0!==e?e:r;this.props=o,this.propKeys=Object.keys(o).filter((t=>null!=o[t])),this.from=n,this.to=o;const s=this.target.getFinalAttribute();s&&this.target.setAttributes(s),!1!==(null===(i=this.params.controlOptions)||void 0===i?void 0:i.immediatelyApply)&&this.target.setAttributes(n)}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class dw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const{from:t,to:e}=(i=this.target,r=this.params.options,o=this.params,!1!==(null!==(n=null==r?void 0:r.overall)&&void 0!==n&&n)?function(t,e,i){var r,o,n;const s=t.getFinalAttribute(),a=s.y1,l=s.height;let h;return e&&"negative"===e.orient?ft(e.overall)?h=e.overall:i.group?(h=null!==(n=null!==(r=i.groupHeight)&&void 0!==r?r:null===(o=e.layoutRect)||void 0===o?void 0:o.height)&&void 0!==n?n:i.group.getBounds().height(),i.groupHeight=h):h=i.height:h=ft(null==e?void 0:e.overall)?e.overall:0,{to:{y:h,y1:nt(a)?void 0:h,height:nt(l)?void 0:0}}}(i,r,o):function(t,e,i){const r=t.getFinalAttribute(),o=r.y,n=r.y1,s=r.height;if(e&&"negative"===e.orient){const t=st(s)?Math.max(o,o+s):Math.max(o,n);return{to:{y:t,y1:nt(n)?void 0:t,height:nt(s)?void 0:0}}}const a=st(s)?Math.min(o,o+s):Math.min(o,n);return{to:{y:a,y1:nt(n)?void 0:a,height:nt(s)?void 0:0}}}(i,r));var i,r,o,n;this.props=e,this.propKeys=Object.keys(e).filter((t=>null!=e[t])),this.from=null!=t?t:this.target.attribute,this.to=e}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}const uw=(t,e,i)=>{const r=t.getFinalAttribute().points,o={x:0,y:0};return r.forEach((t=>{o.x+=t.x,o.y+=t.y})),o.x/=r.length,o.y/=r.length,e&&e.center&&(mt(e.center.x)&&(o.x=e.center.x),mt(e.center.y)&&(o.y=e.center.y)),"area"===t.type&&(o.x1=o.x,o.y1=o.y),r.map((t=>Object.assign({},t,o)))};class gw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){var r,o;const n=null===(r=this.from)||void 0===r?void 0:r.points,s=null===(o=this.to)||void 0===o?void 0:o.points;n&&s&&(this.target.attribute.points=n.map(((t,i)=>Rn(n[i],s[i],e))),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag())}}class pw extends gw{onBind(){var t;if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:e,to:i}=((t,e,i)=>{const r=t.getFinalAttribute();return{from:{points:uw(t,e)},to:{points:r.points}}})(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((t=>null!=i[t])),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),!1!==(null===(t=this.params.controlOptions)||void 0===t?void 0:t.immediatelyApply)&&this.target.setAttributes(e)}else this.valid=!1}}class fw extends gw{onBind(){if(super.onBind(),["area","line"].includes(this.target.type)){const i=this.target.getFinalAttribute(),{from:r,to:o}=(t=this.target,e=this.params.options,this.params,{from:{points:t.getFinalAttribute().points},to:{points:uw(t,e)}});this.props=o,this.propKeys=Object.keys(o).filter((t=>null!=o[t])),this.from=r||i,this.to=o}else this.valid=!1;var t,e}}const mw=(t,e,i)=>t.getFinalAttribute().points.map((i=>{if(e&&"negative"===e.orient){let e=t.stage.viewWidth;return t.parent.parent.parent&&(e=t.parent.parent.parent.AABBBounds.width()),Object.assign(Object.assign({},i),{x:e,y:i.y,x1:e,y1:i.y1,defined:!1!==i.defined})}return Object.assign(Object.assign({},i),{x:0,y:i.y,x1:0,y1:i.y1,defined:!1!==i.defined})}));class bw extends gw{onBind(){var t;if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:e,to:i}=((t,e,i)=>{const r=t.getFinalAttribute();return{from:{points:mw(t,e)},to:{points:r.points}}})(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((t=>null!=i[t])),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),!1!==(null===(t=this.params.controlOptions)||void 0===t?void 0:t.immediatelyApply)&&this.target.setAttributes(e)}else this.valid=!1}}class yw extends gw{onBind(){if(super.onBind(),["area","line"].includes(this.target.type)){const i=this.target.getFinalAttribute(),{from:r,to:o}=(t=this.target,e=this.params.options,this.params,{from:{points:t.getFinalAttribute().points},to:{points:mw(t,e)}});this.props=o,this.propKeys=Object.keys(o).filter((t=>null!=o[t])),this.from=r||i,this.to=o}else this.valid=!1;var t,e}}const Cw=(t,e,i)=>t.getFinalAttribute().points.map((i=>{if(e&&"negative"===e.orient){let e=t.stage.viewHeight;return t.parent.parent.parent&&(e=t.parent.parent.parent.AABBBounds.height()),Object.assign(Object.assign({},i),{x:i.x,y:e,x1:i.x1,y1:e,defined:!1!==i.defined})}return Object.assign(Object.assign({},i),{x:i.x,y:0,x1:i.x1,y1:0,defined:!1!==i.defined})}));class ww extends gw{onBind(){var t;if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:e,to:i}=((t,e,i)=>{const r=t.getFinalAttribute();return{from:{points:Cw(t,e)},to:{points:r.points}}})(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((t=>null!=i[t])),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),!1!==(null===(t=this.params.controlOptions)||void 0===t?void 0:t.immediatelyApply)&&this.target.setAttributes(e)}else this.valid=!1}}class vw extends gw{onBind(){if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:i,to:r}=(t=this.target,e=this.params.options,this.params,{from:{points:t.getFinalAttribute().points},to:{points:Cw(t,e)}});this.props=r,this.propKeys=Object.keys(r).filter((t=>null!=r[t])),this.from=null!=i?i:this.target.attribute,this.to=r}else this.valid=!1;var t,e}}const xw=(t,e,i)=>{var r;return!1!==(null!==(r=null==e?void 0:e.overall)&&void 0!==r&&r)?((t,e,i)=>{const r=t.getFinalAttribute(),o=ft(null==e?void 0:e.overall)?e.overall:0;return{from:{innerRadius:o,outerRadius:o},to:{innerRadius:null==r?void 0:r.innerRadius,outerRadius:null==r?void 0:r.outerRadius}}})(t,e):((t,e,i)=>{const r=t.getFinalAttribute();return e&&"inside"===e.orient?{from:{innerRadius:null==r?void 0:r.outerRadius},to:{innerRadius:null==r?void 0:r.innerRadius}}:{from:{outerRadius:null==r?void 0:r.innerRadius},to:{outerRadius:null==r?void 0:r.outerRadius}}})(t,e)};class _w extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Sw extends _w{onBind(){var t,e;super.onBind();const{from:i,to:r}=xw(this.target,this.params.options,this.params),o=null!==(e=null===(t=this.target.context)||void 0===t?void 0:t.lastAttrs)&&void 0!==e?e:i;this.props=r,this.propKeys=Object.keys(r).filter((t=>null!=r[t])),this.from=o,this.to=r;const n=this.target.getFinalAttribute();n&&this.target.setAttributes(n),this.target.setAttributes(o)}}class Aw extends _w{onBind(){super.onBind();const{to:t}=(e=this.target,i=this.params.options,this.params,!1!==(null!==(r=null==i?void 0:i.overall)&&void 0!==r&&r)?((t,e,i)=>{const r=t.getFinalAttribute(),o=ft(null==e?void 0:e.overall)?e.overall:0;return{from:{innerRadius:null==r?void 0:r.innerRadius,outerRadius:null==r?void 0:r.outerRadius},to:{innerRadius:o,outerRadius:o}}})(e,i):((t,e,i)=>{const r=t.getFinalAttribute();return e&&"inside"===e.orient?{from:{innerRadius:null==r?void 0:r.innerRadius},to:{innerRadius:null==r?void 0:r.outerRadius}}:{from:{outerRadius:null==r?void 0:r.outerRadius},to:{outerRadius:null==r?void 0:r.innerRadius}}})(e,i));var e,i,r;this.props=t,this.propKeys=Object.keys(t).filter((e=>null!=t[e])),this.from=this.target.attribute,this.to=t}}const Tw=(t,e,i)=>{var r;return!1!==(null!==(r=null==e?void 0:e.overall)&&void 0!==r&&r)?function(t,e,i){var r;const o=t.getFinalAttribute(),n=o.x,s=o.x1,a=o.width;let l;return e&&"negative"===e.orient?ft(e.overall)?l=e.overall:i.group?(l=null!==(r=i.groupWidth)&&void 0!==r?r:i.group.getBounds().width(),i.groupWidth=l):l=i.width:l=ft(null==e?void 0:e.overall)?null==e?void 0:e.overall:0,{from:{x:l,x1:nt(s)?void 0:l,width:nt(a)?void 0:0},to:{x:n,x1:s,width:a}}}(t,e,i):function(t,e,i){const r=t.getFinalAttribute(),o=r.x,n=r.x1,s=r.width;if(e&&"negative"===e.orient){const t=st(s)?Math.max(o,o+s):Math.max(o,n);return{from:{x:t,x1:nt(n)?void 0:t,width:nt(s)?void 0:0},to:{x:o,x1:n,width:s}}}const a=st(s)?Math.min(o,o+s):Math.min(o,n);return{from:{x:a,x1:nt(n)?void 0:a,width:nt(s)?void 0:0},to:{x:o,x1:n,width:s}}}(t,e)};class Rw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e;super.onBind();const{from:i,to:r}=Tw(this.target,this.params.options,this.params),o=null!==(e=null===(t=this.target.context)||void 0===t?void 0:t.lastAttrs)&&void 0!==e?e:i;this.props=r,this.propKeys=Object.keys(r).filter((t=>null!=r[t])),this.from=o,this.to=r;const n=this.target.getFinalAttribute();n&&this.target.setAttributes(n),this.target.setAttributes(o)}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Bw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const{from:t,to:e}=(i=this.target,r=this.params.options,o=this.params,!1!==(null!==(n=null==r?void 0:r.overall)&&void 0!==n&&n)?function(t,e,i){var r;const o=t.getFinalAttribute(),n=o.x1,s=o.width;let a;return e&&"negative"===e.orient?ft(e.overall)?a=e.overall:i.group?(a=null!==(r=i.groupWidth)&&void 0!==r?r:i.group.getBounds().width(),i.groupWidth=a):a=i.width:a=ft(null==e?void 0:e.overall)?e.overall:0,{to:{x:a,x1:nt(n)?void 0:a,width:nt(s)?void 0:0}}}(i,r,o):function(t,e,i){const r=t.getFinalAttribute(),o=r.x,n=r.x1,s=r.width;if(e&&"negative"===e.orient){const t=st(s)?Math.max(o,o+s):Math.max(o,n);return{to:{x:t,x1:nt(n)?void 0:t,width:nt(s)?void 0:0}}}const a=st(s)?Math.min(o,o+s):Math.min(o,n);return{to:{x:a,x1:nt(n)?void 0:a,width:nt(s)?void 0:0}}}(i,r));var i,r,o,n;this.props=e,this.propKeys=Object.keys(e).filter((t=>null!=e[t])),this.from=null!=t?t:this.target.attribute,this.to=e}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Mw extends KC{onBind(){super.onBind();const t=XC(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target,{symbolStartOuterType:o="scale",titleType:n="typewriter",titlePanelType:s="scale"}=this.params,a=e/10;let l,h;if(r._symbolStart.setAttributes({scaleX:0,scaleY:0}),t.animate(r._symbolStart,{type:"to",to:{scaleX:1,scaleY:1},duration:5*a,easing:i}),"scale"===o?(l={scaleX:0,scaleY:0},h={scaleX:1,scaleY:1}):(l={clipRange:0},h={clipRange:1}),r._symbolStartOuter.setAttributes(l),t.animate(r._symbolStartOuter,{type:"to",to:h,duration:5*a,easing:i}),r._symbolEnd.setAttributes({scaleX:0,scaleY:0}),t.animate(r._symbolEnd,{type:"to",to:{scaleX:1,scaleY:1},duration:2*a,delay:8*a,easing:i}),r._line.setAttributes({clipRange:0}),t.animate(r._line,{type:"to",to:{clipRange:1},duration:9*a,easing:i}),"typewriter"===n){const e=r._titleTop.attribute.text;r._titleTop.setAttributes({text:""}),t.animate(r._titleTop,{type:"custom",delay:5*a,duration:4*a,easing:"linear",to:{text:e},custom:qC});const i=r._titleBottom.attribute.text;r._titleBottom.setAttributes({text:""}),t.animate(r._titleBottom,{type:"custom",delay:5*a,duration:4*a,easing:"linear",to:{text:i},custom:qC})}else r._titleTop.setAttributes({dy:r._titleTop.AABBBounds.height()+10}),t.animate(r._titleTop,{type:"to",to:{dy:0},delay:5*a,duration:4*a,easing:"linear"}),r._titleBottom.setAttributes({dy:-(10+r._titleBottom.AABBBounds.height())}),t.animate(r._titleBottom,{type:"to",to:{dy:0},delay:5*a,duration:4*a,easing:"linear"});"scale"===s?[r._titleTopPanel,r._titleBottomPanel].forEach((r=>{var o;const n=null!==(o=r.attribute.scaleX)&&void 0!==o?o:1;r.setAttributes({scaleX:0}),t.animate(r,{type:"to",to:{scaleX:n},duration:e,easing:i})})):"stroke"===s&&[r._titleTopPanel,r._titleBottomPanel].forEach((r=>{const o=r.AABBBounds,n=2*(o.width()+o.height());r.setAttributes({lineDash:[0,10*n]}),t.animate(r,{type:"to",to:{lineDash:[n,10*n]},duration:e,easing:i})})),this.completeBind(t)}}class Pw extends KC{onBind(){super.onBind();const t=XC(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target,{mode:o}=this.params;"scale"===o?t.animate(r._symbolStart,{type:"to",to:{scaleX:0,scaleY:0},duration:e,easing:i}):(t.animate(r._line,{type:"to",to:{clipRange:0},duration:e,easing:i}),t.animate(r._symbolStart,{type:"to",to:{scaleX:0,scaleY:0},duration:e/2,delay:e/2,easing:i}),t.animate(r._symbolEnd,{type:"to",to:{scaleX:0,scaleY:0},duration:e,easing:i}),t.animate(r._titleTop,{type:"to",to:{dy:r._titleTop.AABBBounds.height()+10},duration:e/2,easing:i}),t.animate(r._titleBottom,{type:"to",to:{dy:-(10+r._titleBottom.AABBBounds.height())},duration:e/2,easing:i}),t.animate(r._symbolStartOuter,{type:"to",to:{clipRange:0},duration:e/2,delay:e/2,easing:i}),t.animate(r._titleTopPanel,{type:"to",to:{scaleX:0},duration:e,easing:i}),t.animate(r._titleBottomPanel,{type:"to",to:{scaleX:0},duration:e,easing:i})),this.completeBind(t)}}class Hw extends KC{onBind(){super.onBind();const t=XC(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target,{wave:o}=this.params;if(r.setAttributes({scaleX:0,scaleY:0}),t.animate(r,{type:"to",to:{scaleX:1,scaleY:1},duration:e/3*2,easing:i}),r.titleShape&&t.animate(r.titleShape,{type:"custom",to:{text:r.titleShape.attribute.text},duration:e,easing:i,custom:qC}),r.contentShape&&t.animate(r.contentShape,{type:"custom",to:{text:r.contentShape.attribute.text},duration:e,easing:i,custom:qC}),o){const n=e/6;t.animate(r.group,{timeSlices:[{duration:n,effects:{type:"to",to:{angle:o},easing:i}},{duration:2*n,effects:{type:"to",to:{angle:-o},easing:i}},{duration:2*n,effects:{type:"to",to:{angle:o},easing:i}},{duration:n,effects:{type:"to",to:{angle:0},easing:i}}]})}this.completeBind(t)}}class kw extends KC{onBind(){super.onBind();const t=XC(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target;t.animate(r,{type:"to",to:{scaleX:0,scaleY:0},duration:e,easing:i}),this.completeBind(t)}}class Ew extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.showCursor=!1,this.cursorChar="|",this.blinkCursor=!0,this.fadeInChars=!1,this.fadeInDuration=.3,this.strokeFirst=!1,this.strokeToFillRatio=.3,void 0!==(null==o?void 0:o.showCursor)&&(this.showCursor=o.showCursor),void 0!==(null==o?void 0:o.cursorChar)&&(this.cursorChar=o.cursorChar),void 0!==(null==o?void 0:o.blinkCursor)&&(this.blinkCursor=o.blinkCursor),void 0!==(null==o?void 0:o.fadeInChars)&&(this.fadeInChars=o.fadeInChars),void 0!==(null==o?void 0:o.fadeInDuration)&&(this.fadeInDuration=o.fadeInDuration),void 0!==(null==o?void 0:o.strokeFirst)&&(this.strokeFirst=o.strokeFirst),void 0!==(null==o?void 0:o.strokeToFillRatio)&&(this.strokeToFillRatio=o.strokeToFillRatio)}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=e.textConfig?[...e.textConfig]:[],this.valid=!0,this.originalTextConfig&&0!==this.originalTextConfig.length?(this.fromTextConfig=t.textConfig&&t.textConfig.length>0?vh.TransformTextConfig2SingleCharacter(t.textConfig):[],this.toTextConfig=vh.TransformTextConfig2SingleCharacter(this.originalTextConfig)):this.valid=!1}onEnd(t){super.onEnd(t),t||this.target.setAttribute("textConfig",this.originalTextConfig)}onUpdate(t,e,i){if(!this.valid)return;const r=this.toTextConfig.length,o=this.fromTextConfig.length,n=this.fadeInChars?1-this.fadeInDuration:1;let s,a;if(o>r)s=Math.round(o-(o-r)*e);else if(this.fadeInChars){const t=Math.min(1,e/n);s=Math.round(o+(r-o)*t)}else s=Math.round(o+(r-o)*e);if(a=o>r?this.fromTextConfig.slice(0,s):this.toTextConfig.slice(0,s).map(((t,i)=>{if("text"in t){const o=Object.assign({},t);if(this.strokeFirst){const t=i/r*n,s=Math.max(0,e-t),a=1-t,l=Math.min(1,s/(this.strokeToFillRatio*a));if("fill"in o&&o.fill&&(o.stroke=o.fill,l<1&&(o.fillOpacity=l)),this.fadeInChars){const t=Math.min(1,s/(this.fadeInDuration*a));o.opacity=Math.max(0,Math.min(1,t))}}else if(this.fadeInChars){const t=(e-i/r*n)/this.fadeInDuration;o.opacity=Math.max(0,Math.min(1,t))}return o}return t})),this.showCursor&&s<r){let t=!0;if(this.blinkCursor){const i=.1;t=Math.floor(e/i)%2==0}if(t&&a.length>0){const t=a.length-1,e=a[t];if("text"in e)a[t]=Object.assign(Object.assign({},e),{text:String(e.text)+this.cursorChar});else{const t={text:this.cursorChar,fontSize:16};a.push(t)}}}this.target.setAttribute("textConfig",a)}}class Fw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.showCursor=!1,this.cursorChar="|",this.blinkCursor=!0,this.beforeText="",this.afterText="",this.fadeOutChars=!1,this.fadeOutDuration=.3,this.direction="backward",void 0!==(null==o?void 0:o.showCursor)&&(this.showCursor=o.showCursor),void 0!==(null==o?void 0:o.cursorChar)&&(this.cursorChar=o.cursorChar),void 0!==(null==o?void 0:o.blinkCursor)&&(this.blinkCursor=o.blinkCursor),void 0!==(null==o?void 0:o.beforeText)&&(this.beforeText=o.beforeText),void 0!==(null==o?void 0:o.afterText)&&(this.afterText=o.afterText),void 0!==(null==o?void 0:o.fadeOutChars)&&(this.fadeOutChars=o.fadeOutChars),void 0!==(null==o?void 0:o.fadeOutDuration)&&(this.fadeOutDuration=o.fadeOutDuration),void 0!==(null==o?void 0:o.direction)&&(this.direction=o.direction),this.propKeys=["textConfig"]}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=t.textConfig?[...t.textConfig]:[],this.valid=!0,this.originalTextConfig&&0!==this.originalTextConfig.length?(this.fromTextConfig=vh.TransformTextConfig2SingleCharacter(this.originalTextConfig),this.toTextConfig=e.textConfig&&e.textConfig.length>0?vh.TransformTextConfig2SingleCharacter(e.textConfig):[]):this.valid=!1}onEnd(t){super.onEnd(t),t||(this.toTextConfig.length>0?this.target.setAttribute("textConfig",this.toTextConfig):this.target.setAttribute("textConfig",[]))}onUpdate(t,e,i){if(!this.valid)return;const r=this.fromTextConfig.length,o=this.fadeOutChars?1-this.fadeOutDuration:1;let n;if("forward"===this.direction){if(this.fadeOutChars){const t=Math.min(1,e/o);n=Math.round(r*(1-t))}else n=Math.round(r*(1-e));let t="forward"===this.direction?this.fromTextConfig.slice(r-n):this.fromTextConfig.slice(0,n);this.fadeOutChars&&(t=this.applyFadeEffect(t,e,r,n)),this.showCursor&&n>0&&(t=this.addCursor(t,e)),this.target.setAttribute("textConfig",t)}else{if(this.fadeOutChars){const t=Math.min(1,e/o);n=Math.round(r*(1-t))}else n=Math.round(r*(1-e));let t=this.fromTextConfig.slice(0,n);this.fadeOutChars&&(t=this.applyFadeEffect(t,e,r,n)),this.showCursor&&n>0&&(t=this.addCursor(t,e)),this.target.setAttribute("textConfig",t)}}applyFadeEffect(t,e,i,r){this.direction;const o=(e-(1-this.fadeOutDuration))/this.fadeOutDuration,n=Math.max(0,1-Math.min(1,o));return t.map(((e,i)=>{if("forward"===this.direction){if(0===i&&"text"in e)return Object.assign(Object.assign({},e),{opacity:n})}else if(i===t.length-1&&"text"in e)return Object.assign(Object.assign({},e),{opacity:n});return e}))}addCursor(t,e){let i=!0;if(this.blinkCursor){const t=.1;i=Math.floor(e/t)%2==0}if(i&&t.length>0){const e="forward"===this.direction?0:t.length-1,i=t[e];if("text"in i){const r=[...t];return"forward"===this.direction?r[e]=Object.assign(Object.assign({},i),{text:this.cursorChar+String(i.text)}):r[e]=Object.assign(Object.assign({},i),{text:String(i.text)+this.cursorChar}),r}}return t}}class Lw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.singleCharConfig=[],this.fadeInDuration=.3,this.slideDirection="right",this.slideDistance=30,this.wordByWord=!1,this.wordRegex=/[a-zA-Z]+(-[a-zA-Z]+)*|[\u4e00-\u9fa5]+|[0-9]+|[^\s\w\u4e00-\u9fa5]/g,this.wordGroups=[],void 0!==(null==o?void 0:o.fadeInDuration)&&(this.fadeInDuration=o.fadeInDuration),void 0!==(null==o?void 0:o.slideDirection)&&(this.slideDirection=o.slideDirection),void 0!==(null==o?void 0:o.slideDistance)&&(this.slideDistance=o.slideDistance),void 0!==(null==o?void 0:o.wordByWord)&&(this.wordByWord=o.wordByWord),void 0!==(null==o?void 0:o.wordRegex)&&(this.wordRegex=o.wordRegex)}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=e.textConfig?[...e.textConfig]:[],this.valid=!0,this.originalTextConfig&&0!==this.originalTextConfig.length?(this.fromTextConfig=t.textConfig&&t.textConfig.length>0?vh.TransformTextConfig2SingleCharacter(t.textConfig):[],this.toTextConfig=vh.TransformTextConfig2SingleCharacter(this.originalTextConfig),this.singleCharConfig=this.toTextConfig.map((t=>"text"in t?Object.assign(Object.assign({},t),{opacity:0,dx:this.getInitialDx(),dy:this.getInitialDy()}):Object.assign(Object.assign({},t),{opacity:0}))),this.wordByWord&&this.calculateWordGroups()):this.valid=!1}calculateWordGroups(){this.wordGroups=[];let t="";const e={};let i,r=0;for((this.toTextConfig.forEach(((i,o)=>{if("text"in i){const n=String(i.text);t+=n,e[r]=o,r++}})),this.wordRegex.lastIndex=0);null!==(i=this.wordRegex.exec(t));){const t=i.index,r=i.index+i[0].length,o=[];for(let i=t;i<r;i++)void 0!==e[i]&&o.push(e[i]);o.length>0&&this.wordGroups.push(o)}const o=new Set;this.wordGroups.forEach((t=>{t.forEach((t=>o.add(t)))}));for(let t=0;t<this.toTextConfig.length;t++)"text"in this.toTextConfig[t]&&!o.has(t)&&this.wordGroups.push([t])}getInitialDx(){switch(this.slideDirection){case"left":return-this.slideDistance;case"right":return this.slideDistance;default:return 0}}getInitialDy(){switch(this.slideDirection){case"up":return-this.slideDistance;case"down":return this.slideDistance;default:return 0}}onEnd(t){super.onEnd(t),t||this.target.setAttribute("textConfig",this.originalTextConfig)}onUpdate(t,e,i){if(!this.valid)return;const r=1-this.fadeInDuration;let o;o=this.wordByWord&&this.wordGroups.length>0?this.updateByWord(e,r):this.updateByCharacter(e,r),this.target.setAttribute("textConfig",o)}updateByWord(t,e){const i=this.wordGroups.length,r=[...this.singleCharConfig];for(let o=0;o<this.wordGroups.length;o++){let n;if(n="left"===this.slideDirection?(i-1-o)/i*e:o/i*e,t<n){for(const t of this.wordGroups[o]){const e=r[t];"text"in e&&(r[t]=Object.assign(Object.assign({},e),{opacity:0,dx:this.getInitialDx(),dy:this.getInitialDy()}))}continue}const s=(t-n)/this.fadeInDuration,a=Math.max(0,Math.min(1,s)),l=this.getInitialDx()*(1-a),h=this.getInitialDy()*(1-a);for(const t of this.wordGroups[o]){const e=r[t];"text"in e&&(r[t]=Object.assign(Object.assign({},e),{opacity:a,dx:l,dy:h}))}}return r}updateByCharacter(t,e){const i=this.toTextConfig.length,r=[...this.singleCharConfig];for(let o=0;o<r.length;o++){const n=r[o];if("text"in n){let s;if(s="left"===this.slideDirection?(i-1-o)/i*e:o/i*e,t<s){r[o]=Object.assign(Object.assign({},n),{opacity:0,dx:this.getInitialDx(),dy:this.getInitialDy()});continue}const a=(t-s)/this.fadeInDuration,l=Math.max(0,Math.min(1,a)),h=this.getInitialDx()*(1-l),c=this.getInitialDy()*(1-l);r[o]=Object.assign(Object.assign({},n),{opacity:l,dx:h,dy:c})}}return r}}class Iw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.singleCharConfig=[],this.fadeOutDuration=.3,this.slideDirection="right",this.slideDistance=30,this.wordByWord=!1,this.wordRegex=/[a-zA-Z]+(-[a-zA-Z]+)*|[\u4e00-\u9fa5]+|[0-9]+|[^\s\w\u4e00-\u9fa5]/g,this.wordGroups=[],this.reverseOrder=!1,void 0!==(null==o?void 0:o.fadeOutDuration)&&(this.fadeOutDuration=o.fadeOutDuration),void 0!==(null==o?void 0:o.slideDirection)&&(this.slideDirection=o.slideDirection),void 0!==(null==o?void 0:o.slideDistance)&&(this.slideDistance=o.slideDistance),void 0!==(null==o?void 0:o.wordByWord)&&(this.wordByWord=o.wordByWord),void 0!==(null==o?void 0:o.wordRegex)&&(this.wordRegex=o.wordRegex),void 0!==(null==o?void 0:o.reverseOrder)&&(this.reverseOrder=o.reverseOrder),this.propKeys=["textConfig"]}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=t.textConfig?[...t.textConfig]:[],this.valid=!0,this.originalTextConfig&&0!==this.originalTextConfig.length?(this.fromTextConfig=vh.TransformTextConfig2SingleCharacter(this.originalTextConfig),this.toTextConfig=e.textConfig&&e.textConfig.length>0?vh.TransformTextConfig2SingleCharacter(e.textConfig):[],this.singleCharConfig=this.fromTextConfig.map((t=>"text"in t?Object.assign(Object.assign({},t),{opacity:1,dx:0,dy:0}):Object.assign(Object.assign({},t),{opacity:1}))),this.wordByWord&&this.calculateWordGroups()):this.valid=!1}calculateWordGroups(){this.wordGroups=[];let t="";const e={};let i,r=0;for((this.fromTextConfig.forEach(((i,o)=>{if("text"in i){const n=String(i.text);t+=n,e[r]=o,r++}})),this.wordRegex.lastIndex=0);null!==(i=this.wordRegex.exec(t));){const t=i.index,r=i.index+i[0].length,o=[];for(let i=t;i<r;i++)void 0!==e[i]&&o.push(e[i]);o.length>0&&this.wordGroups.push(o)}const o=new Set;this.wordGroups.forEach((t=>{t.forEach((t=>o.add(t)))}));for(let t=0;t<this.fromTextConfig.length;t++)"text"in this.fromTextConfig[t]&&!o.has(t)&&this.wordGroups.push([t])}getTargetDx(){switch(this.slideDirection){case"left":return-this.slideDistance;case"right":return this.slideDistance;default:return 0}}getTargetDy(){switch(this.slideDirection){case"up":return-this.slideDistance;case"down":return this.slideDistance;default:return 0}}onEnd(t){super.onEnd(t),t||(this.toTextConfig.length>0?this.target.setAttribute("textConfig",this.toTextConfig):this.target.setAttribute("textConfig",[]))}onUpdate(t,e,i){if(!this.valid)return;const r=1-this.fadeOutDuration;let o;o=this.wordByWord&&this.wordGroups.length>0?this.updateByWord(e,r):this.updateByCharacter(e,r),this.target.setAttribute("textConfig",o)}updateByWord(t,e){const i=this.wordGroups.length,r=[...this.singleCharConfig];for(let o=0;o<this.wordGroups.length;o++){let n;if(n=this.reverseOrder?"left"===this.slideDirection?o/i*e:(i-1-o)/i*e:"left"===this.slideDirection?(i-1-o)/i*e:o/i*e,t<n){for(const t of this.wordGroups[o]){const e=r[t];"text"in e&&(r[t]=Object.assign(Object.assign({},e),{opacity:1,dx:0,dy:0}))}continue}const s=(t-n)/this.fadeOutDuration,a=Math.max(0,Math.min(1,s)),l=this.getTargetDx()*a,h=this.getTargetDy()*a,c=1-a;for(const t of this.wordGroups[o]){const e=r[t];"text"in e&&(r[t]=Object.assign(Object.assign({},e),{opacity:c,dx:l,dy:h}))}}return r}updateByCharacter(t,e){const i=this.fromTextConfig.length,r=[...this.singleCharConfig];for(let o=0;o<r.length;o++){const n=r[o];if("text"in n){let s;if(s=this.reverseOrder?"left"===this.slideDirection?o/i*e:(i-1-o)/i*e:"left"===this.slideDirection?(i-1-o)/i*e:o/i*e,t<s){r[o]=Object.assign(Object.assign({},n),{opacity:1,dx:0,dy:0});continue}const a=(t-s)/this.fadeOutDuration,l=Math.max(0,Math.min(1,a)),h=this.getTargetDx()*l,c=this.getTargetDy()*l,d=1-l;r[o]=Object.assign(Object.assign({},n),{opacity:d,dx:h,dy:c})}}return r}}class zw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,n,s,a,l,h,c;let d,u;super.onBind();const g=this.target.getFinalAttribute(),p=null!==(t=this.target.attribute)&&void 0!==t?t:{};switch(null===(e=this.params)||void 0===e?void 0:e.direction){case"x":d={scaleX:null!==(i=p.scaleX)&&void 0!==i?i:0},u={scaleX:null!==(r=null==g?void 0:g.scaleX)&&void 0!==r?r:1},this._updateFunction=this.updateX;break;case"y":d={scaleY:null!==(o=p.scaleY)&&void 0!==o?o:0},u={scaleY:null!==(n=null==g?void 0:g.scaleY)&&void 0!==n?n:1},this._updateFunction=this.updateY;break;default:d={scaleX:null!==(s=p.scaleX)&&void 0!==s?s:0,scaleY:null!==(a=p.scaleY)&&void 0!==a?a:0},u={scaleX:null!==(l=null==g?void 0:g.scaleX)&&void 0!==l?l:1,scaleY:null!==(h=null==g?void 0:g.scaleY)&&void 0!==h?h:1},this._updateFunction=this.updateXY}const f=this.target.getFinalAttribute();f&&this.target.setAttributes(f),this.props=u,this.from=d,this.to=u,!1!==(null===(c=this.params.controlOptions)||void 0===c?void 0:c.immediatelyApply)&&this.target.setAttributes(d)}onEnd(t){super.onEnd(t)}updateX(t){this.target.attribute.scaleX=this.from.scaleX+(this.to.scaleX-this.from.scaleX)*t}updateY(t){this.target.attribute.scaleY=this.from.scaleY+(this.to.scaleY-this.from.scaleY)*t}updateXY(t){this.updateX(t),this.updateY(t)}deleteSelfAttr(t){delete this.props[t],this.fromProps&&delete this.fromProps[t];const e=this.propKeys.indexOf(t);-1!==e&&this.propKeys.splice(e,1),this.propKeys&&this.propKeys.length>1?this._updateFunction=this.updateXY:"scaleX"===this.propKeys[0]?this._updateFunction=this.updateX:"scaleY"===this.propKeys[0]?this._updateFunction=this.updateY:this._updateFunction=null}onUpdate(t,e,i){this._updateFunction&&(this._updateFunction(e),this.target.addUpdatePositionTag(),this.target.addUpdateBoundTag())}}class Ow extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o;let n,s;super.onBind();const a=this.target.attribute;switch(null===(t=this.params)||void 0===t?void 0:t.direction){case"x":n={scaleX:null!==(e=null==a?void 0:a.scaleX)&&void 0!==e?e:1},s={scaleX:0};break;case"y":n={scaleY:null!==(i=null==a?void 0:a.scaleY)&&void 0!==i?i:1},s={scaleY:0};break;default:n={scaleX:null!==(r=null==a?void 0:a.scaleX)&&void 0!==r?r:1,scaleY:null!==(o=null==a?void 0:a.scaleY)&&void 0!==o?o:1},s={scaleX:0,scaleY:0}}this.props=s,this.from=n,this.to=s}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateBoundTag()}}class Dw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.fromProps,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((t,e)=>{if(!this.animate.validAttr(this.propKeys[e]))return;const i=this.propKeys[e];t(i,this.fromProps[i],this.props[i],r,this,this.target)})),this.onUpdate(t,r,i),this.syncAttributeUpdate()}}class Ww extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,n,s,a,l,h,c,d;super.onBind();const u=this.target.getFinalAttribute(),g=(null===(t=this.params)||void 0===t?void 0:t.direction)||"right",p=(null===(e=this.params)||void 0===e?void 0:e.distance)||50,f=null!==(r=null===(i=this.params)||void 0===i?void 0:i.fromOpacity)&&void 0!==r?r:0,m={opacity:f,baseOpacity:f},b={opacity:1,baseOpacity:1};"top"===g?(m.y=(null!==(o=u.y)&&void 0!==o?o:0)-p,b.y=null!==(n=u.y)&&void 0!==n?n:0,this.propKeys=["opacity","baseOpacity","y"]):"bottom"===g?(m.y=(null!==(s=u.y)&&void 0!==s?s:0)+p,b.y=null!==(a=u.y)&&void 0!==a?a:0,this.propKeys=["opacity","baseOpacity","y"]):"left"===g?(m.x=(null!==(l=u.x)&&void 0!==l?l:0)-p,b.x=null!==(h=u.x)&&void 0!==h?h:0,this.propKeys=["opacity","baseOpacity","x"]):(m.x=(null!==(c=u.x)&&void 0!==c?c:0)+p,b.x=null!==(d=u.x)&&void 0!==d?d:0,this.propKeys=["opacity","baseOpacity","x"]),this.from=m,this.to=b,this.props=b,this.target.setAttributes(m)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Nw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,n,s;super.onBind();const a=this.target.getFinalAttribute(),l=null!==(e=null===(t=this.params)||void 0===t?void 0:t.fromScale)&&void 0!==e?e:0,h=(null===(i=this.params)||void 0===i?void 0:i.direction)||"xy",c=null!==(o=null===(r=this.params)||void 0===r?void 0:r.fromOpacity)&&void 0!==o?o:0,d={opacity:c,baseOpacity:c},u={opacity:1,baseOpacity:1};this.propKeys=["opacity","baseOpacity"],"x"!==h&&"xy"!==h||(d.scaleX=l,u.scaleX=null!==(n=a.scaleX)&&void 0!==n?n:1,this.propKeys.push("scaleX")),"y"!==h&&"xy"!==h||(d.scaleY=l,u.scaleY=null!==(s=a.scaleY)&&void 0!==s?s:1,this.propKeys.push("scaleY")),this.from=d,this.to=u,this.props=u,this.target.setAttributes(d)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Gw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,n,s,a,l;super.onBind();const h=this.target.getFinalAttribute(),c=null!==(e=null===(t=this.params)||void 0===t?void 0:t.fromAngle)&&void 0!==e?e:2*Math.PI,d=null!==(r=null===(i=this.params)||void 0===i?void 0:i.fromScale)&&void 0!==r?r:0,u=null!==(n=null===(o=this.params)||void 0===o?void 0:o.fromOpacity)&&void 0!==n?n:0,g={opacity:u,baseOpacity:u,angle:c,scaleX:d,scaleY:d},p={opacity:1,baseOpacity:1,angle:null!==(s=h.angle)&&void 0!==s?s:0,scaleX:null!==(a=h.scaleX)&&void 0!==a?a:1,scaleY:null!==(l=h.scaleY)&&void 0!==l?l:1};this.propKeys=["opacity","baseOpacity","angle","scaleX","scaleY"],this.from=g,this.to=p,this.props=p,this.target.setAttributes(g)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class jw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.perimeter=0,this.originalAttributes={}}onBind(){var t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b;if(super.onBind(),this.originalAttributes=Object.assign({},this.target.getAttributes()),"rect"===this.target.type){const i=this.target.attribute,r=null!==(t=i.width)&&void 0!==t?t:100,o=null!==(e=i.height)&&void 0!==e?e:100;this.perimeter=2*(r+o)}else if("circle"===this.target.type){const t=null!==(i=this.target.attribute.radius)&&void 0!==i?i:50;this.perimeter=2*Math.PI*t}else if("ellipse"===this.target.type){const t=this.target.attribute,e=null!==(r=t.radiusX)&&void 0!==r?r:50,i=null!==(o=t.radiusY)&&void 0!==o?o:50;this.perimeter=2*Math.PI*Math.sqrt((e*e+i*i)/2)}else this.perimeter=1e3;const y=null!==(s=null===(n=this.params)||void 0===n?void 0:n.lineWidth)&&void 0!==s?s:2,C=null!==(l=null===(a=this.params)||void 0===a?void 0:a.strokeColor)&&void 0!==l?l:"black",w=null!==(c=null===(h=this.params)||void 0===h?void 0:h.fromOpacity)&&void 0!==c?c:1,v=null!==(u=null===(d=this.params)||void 0===d?void 0:d.dashLength)&&void 0!==u?u:this.perimeter,x=null!==(p=null===(g=this.params)||void 0===g?void 0:g.showFill)&&void 0!==p&&p,_=null!==(m=null===(f=this.params)||void 0===f?void 0:f.fillOpacity)&&void 0!==m?m:0;this.from={lineDash:[v,v],lineDashOffset:v,lineWidth:y,stroke:C,strokeOpacity:w},this.to={lineDash:[v,v],lineDashOffset:0,lineWidth:y,stroke:C,strokeOpacity:w},x?(this.from.fillOpacity=_,this.to.fillOpacity=null!==(b=this.originalAttributes.fillOpacity)&&void 0!==b?b:1):(this.from.fillOpacity=0,this.to.fillOpacity=0),this.propKeys=["lineDash","lineDashOffset","lineWidth","stroke","strokeOpacity","fillOpacity"],this.props=this.to,this.target.setAttributes(this.from)}onUpdate(t,e,i){var r;const o=this.target.attribute;o.lineDashOffset=this.from.lineDashOffset+(this.to.lineDashOffset-this.from.lineDashOffset)*e,(null===(r=this.params)||void 0===r?void 0:r.showFill)&&(o.fillOpacity=this.from.fillOpacity+(this.to.fillOpacity-this.from.fillOpacity)*e)}onEnd(){var t;if(super.onEnd(),!(null===(t=this.params)||void 0===t?void 0:t.showFill)){const t=Object.assign({},this.originalAttributes);t.fillOpacity=0,this.target.setAttributes(t)}}}class Vw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.perimeter=0,this.originalAttributes={}}onFirstRun(){var t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f;if(this.originalAttributes=Object.assign({},this.target.getAttributes()),"rect"===this.target.type){const i=this.target.attribute,r=null!==(t=i.width)&&void 0!==t?t:100,o=null!==(e=i.height)&&void 0!==e?e:100;this.perimeter=2*(r+o)}else if("circle"===this.target.type){const t=null!==(i=this.target.attribute.radius)&&void 0!==i?i:50;this.perimeter=2*Math.PI*t}else if("ellipse"===this.target.type){const t=this.target.attribute,e=null!==(r=t.radiusX)&&void 0!==r?r:50,i=null!==(o=t.radiusY)&&void 0!==o?o:50;this.perimeter=2*Math.PI*Math.sqrt((e*e+i*i)/2)}else this.perimeter=1e3;const m=null!==(s=null===(n=this.params)||void 0===n?void 0:n.lineWidth)&&void 0!==s?s:2,b=null!==(l=null===(a=this.params)||void 0===a?void 0:a.strokeColor)&&void 0!==l?l:"black",y=null!==(c=null===(h=this.params)||void 0===h?void 0:h.fromOpacity)&&void 0!==c?c:1,C=null!==(u=null===(d=this.params)||void 0===d?void 0:d.dashLength)&&void 0!==u?u:this.perimeter,w=null!==(p=null===(g=this.params)||void 0===g?void 0:g.showFill)&&void 0!==p&&p;this.from={lineDash:[C,C],lineDashOffset:0,lineWidth:m,stroke:b,strokeOpacity:y},this.to={lineDash:[C,C],lineDashOffset:-C,lineWidth:m,stroke:b,strokeOpacity:y},w?(this.from.fillOpacity=null!==(f=this.originalAttributes.fillOpacity)&&void 0!==f?f:1,this.to.fillOpacity=0):(this.from.fillOpacity=0,this.to.fillOpacity=0),this.propKeys=["lineDash","lineDashOffset","lineWidth","stroke","strokeOpacity","fillOpacity"],this.props=this.to,this.target.setAttributes(this.from)}onUpdate(t,e,i){var r;const o=this.target.attribute;o.lineDashOffset=this.from.lineDashOffset+(this.to.lineDashOffset-this.from.lineDashOffset)*e,(null===(r=this.params)||void 0===r?void 0:r.showFill)&&(o.fillOpacity=this.from.fillOpacity+(this.to.fillOpacity-this.from.fillOpacity)*e)}}class Uw extends UC{constructor(t,e,i,r,o){var n;super(t,e,i,r,o);const s=null!==(n=null==o?void 0:o.slideRatio)&&void 0!==n?n:.5;this.slideInDuration=i*s,this.growInDuration=i*(1-s)}onBind(){var t,e,i,r,o,n;super.onBind();const s=new LC(this.target);s.execute({type:"custom",custom:Ww,customParameters:{direction:(null===(t=this.params)||void 0===t?void 0:t.slideDirection)||"right",distance:(null===(e=this.params)||void 0===e?void 0:e.slideDistance)||50,fromOpacity:null!==(r=null===(i=this.params)||void 0===i?void 0:i.fromOpacity)&&void 0!==r?r:0},duration:this.slideInDuration,easing:this.easing}),s.execute({type:"custom",custom:Nw,customParameters:{fromScale:(null===(o=this.params)||void 0===o?void 0:o.fromScale)||.5,direction:(null===(n=this.params)||void 0===n?void 0:n.scaleDirection)||"xy",fromOpacity:1},duration:this.growInDuration,easing:this.easing,delay:this.slideInDuration})}onUpdate(t,e,i){}}class Kw extends UC{constructor(t,e,i,r,o){var n;super(t,e,i,r,o);const s=null!==(n=null==o?void 0:o.slideRatio)&&void 0!==n?n:.5;this.slideInDuration=i*s,this.spinInDuration=i*(1-s)}onBind(){var t,e,i,r,o,n;super.onBind();const s=new LC(this.target);s.execute({type:"custom",custom:Ww,customParameters:{direction:(null===(t=this.params)||void 0===t?void 0:t.slideDirection)||"right",distance:(null===(e=this.params)||void 0===e?void 0:e.slideDistance)||50,fromOpacity:null!==(r=null===(i=this.params)||void 0===i?void 0:i.fromOpacity)&&void 0!==r?r:0},duration:this.slideInDuration,easing:this.easing}),s.execute({type:"custom",custom:Gw,customParameters:{fromAngle:(null===(o=this.params)||void 0===o?void 0:o.fromAngle)||Math.PI,fromScale:(null===(n=this.params)||void 0===n?void 0:n.fromScale)||.5,fromOpacity:1},duration:this.spinInDuration,easing:this.easing,delay:this.slideInDuration})}onUpdate(t,e,i){}}class $w extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onFirstRun(){var t,e,i,r,o,n,s,a,l,h,c,d,u,g;const p=this.target.getAttributes(),f=(null===(t=this.params)||void 0===t?void 0:t.direction)||"right",m=(null===(e=this.params)||void 0===e?void 0:e.distance)||50,b=null!==(r=null===(i=this.params)||void 0===i?void 0:i.fromOpacity)&&void 0!==r?r:1,y=null!==(n=null===(o=this.params)||void 0===o?void 0:o.toOpacity)&&void 0!==n?n:0,C={opacity:b,baseOpacity:b},w={opacity:y,baseOpacity:y};"top"===f?(C.y=null!==(s=p.y)&&void 0!==s?s:0,w.y=(null!==(a=p.y)&&void 0!==a?a:0)-m,this.propKeys=["opacity","baseOpacity","y"]):"bottom"===f?(C.y=null!==(l=p.y)&&void 0!==l?l:0,w.y=(null!==(h=p.y)&&void 0!==h?h:0)+m,this.propKeys=["opacity","baseOpacity","y"]):"left"===f?(C.x=null!==(c=p.x)&&void 0!==c?c:0,w.x=(null!==(d=p.x)&&void 0!==d?d:0)-m,this.propKeys=["opacity","baseOpacity","x"]):(C.x=null!==(u=p.x)&&void 0!==u?u:0,w.x=(null!==(g=p.x)&&void 0!==g?g:0)+m,this.propKeys=["opacity","baseOpacity","x"]),this.from=C,this.to=w,this.props=w}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Xw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onFirstRun(){var t,e,i,r,o,n,s,a,l;const h=this.target.getAttributes(),c=null!==(e=null===(t=this.params)||void 0===t?void 0:t.fromScale)&&void 0!==e?e:0,d=(null===(i=this.params)||void 0===i?void 0:i.direction)||"xy",u=null!==(o=null===(r=this.params)||void 0===r?void 0:r.fromOpacity)&&void 0!==o?o:1,g=null!==(s=null===(n=this.params)||void 0===n?void 0:n.toOpacity)&&void 0!==s?s:0,p={opacity:u,baseOpacity:u},f={opacity:g,baseOpacity:g};this.propKeys=["opacity","baseOpacity"],"x"!==d&&"xy"!==d||(p.scaleX=null!==(a=h.scaleX)&&void 0!==a?a:1,f.scaleX=c,this.propKeys.push("scaleX")),"y"!==d&&"xy"!==d||(p.scaleY=null!==(l=h.scaleY)&&void 0!==l?l:1,f.scaleY=c,this.propKeys.push("scaleY")),this.from=p,this.to=f,this.props=f}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Yw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onFirstRun(){var t,e,i,r,o,n,s,a,l,h,c;const d=this.target.getAttributes(),u=null!==(e=null===(t=this.params)||void 0===t?void 0:t.fromAngle)&&void 0!==e?e:2*Math.PI,g=null!==(r=null===(i=this.params)||void 0===i?void 0:i.fromScale)&&void 0!==r?r:0,p=null!==(n=null===(o=this.params)||void 0===o?void 0:o.fromOpacity)&&void 0!==n?n:1,f=null!==(a=null===(s=this.params)||void 0===s?void 0:s.toOpacity)&&void 0!==a?a:0,m={opacity:p,baseOpacity:p,angle:null!==(l=d.angle)&&void 0!==l?l:0,scaleX:null!==(h=d.scaleX)&&void 0!==h?h:1,scaleY:null!==(c=d.scaleY)&&void 0!==c?c:1},b={opacity:f,baseOpacity:f,angle:u,scaleX:g,scaleY:g};this.propKeys=["opacity","baseOpacity","angle","scaleX","scaleY"],this.from=m,this.to=b,this.props=b}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class qw extends UC{constructor(t,e,i,r,o){var n;super(t,e,i,r,o);const s=null!==(n=null==o?void 0:o.slideRatio)&&void 0!==n?n:.5;this.growOutDuration=i*(1-s),this.slideOutDuration=i*s}onFirstRun(){var t,e,i,r;const o=new LC(this.target);o.execute({type:"custom",custom:Xw,customParameters:{fromScale:(null===(t=this.params)||void 0===t?void 0:t.fromScale)||.5,direction:(null===(e=this.params)||void 0===e?void 0:e.scaleDirection)||"xy",fromOpacity:1,toOpacity:1},duration:this.growOutDuration,easing:this.easing}),o.execute({type:"custom",custom:$w,customParameters:{direction:(null===(i=this.params)||void 0===i?void 0:i.slideDirection)||"right",distance:(null===(r=this.params)||void 0===r?void 0:r.slideDistance)||50,fromOpacity:1},duration:this.slideOutDuration,easing:this.easing,delay:this.growOutDuration})}onUpdate(t,e,i){}}class Zw extends UC{constructor(t,e,i,r,o){var n;super(t,e,i,r,o);const s=null!==(n=null==o?void 0:o.slideRatio)&&void 0!==n?n:.5;this.spinOutDuration=i*(1-s),this.slideOutDuration=i*s}onFirstRun(){var t,e,i,r;const o=new LC(this.target);o.execute({type:"custom",custom:Yw,customParameters:{fromAngle:(null===(t=this.params)||void 0===t?void 0:t.fromAngle)||Math.PI,fromScale:(null===(e=this.params)||void 0===e?void 0:e.fromScale)||.5,fromOpacity:1,toOpacity:1},duration:this.spinOutDuration,easing:this.easing}),o.execute({type:"custom",custom:$w,customParameters:{direction:(null===(i=this.params)||void 0===i?void 0:i.slideDirection)||"right",distance:(null===(r=this.params)||void 0===r?void 0:r.slideDistance)||50,fromOpacity:1},duration:this.slideOutDuration,easing:this.easing,delay:this.spinOutDuration})}onUpdate(t,e,i){}}class Jw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.originalAttributes={},this.pulseCount=3,this.pulseOpacity=.3,this.pulseScale=1.05,this.pulseColor=null,this.pulseColorIntensity=.2,this.strokeOnly=!1,this.fillOnly=!1,this.useScale=!0,this.useOpacity=!0,this.useStroke=!0,this.useFill=!0,this.useColor=!1,this.originalFill=null,this.originalStroke=null,void 0!==(null==o?void 0:o.pulseCount)&&(this.pulseCount=o.pulseCount),void 0!==(null==o?void 0:o.pulseScale)&&(this.pulseScale=o.pulseScale),void 0!==(null==o?void 0:o.pulseColor)&&(this.pulseColor=o.pulseColor),void 0!==(null==o?void 0:o.pulseColorIntensity)&&(this.pulseColorIntensity=o.pulseColorIntensity),void 0!==(null==o?void 0:o.strokeOnly)&&(this.strokeOnly=o.strokeOnly),void 0!==(null==o?void 0:o.fillOnly)&&(this.fillOnly=o.fillOnly),void 0!==(null==o?void 0:o.useScale)&&(this.useScale=o.useScale),void 0!==(null==o?void 0:o.useOpacity)&&(this.useOpacity=o.useOpacity),void 0!==(null==o?void 0:o.useStroke)&&(this.useStroke=o.useStroke),void 0!==(null==o?void 0:o.useFill)&&(this.useFill=o.useFill),void 0!==(null==o?void 0:o.useColor)&&(this.useColor=o.useColor)}onBind(){super.onBind(),this.originalAttributes=Object.assign({},this.target.getAttributes()),this.useColor&&(this.originalFill=this.originalAttributes.fill||null,this.originalStroke=this.originalAttributes.stroke||null,this.pulseColor||(this.fillOnly&&this.originalFill?this.pulseColor=this.originalFill:this.strokeOnly&&this.originalStroke?this.pulseColor=this.originalStroke:this.originalFill?this.pulseColor=this.originalFill:this.originalStroke?this.pulseColor=this.originalStroke:this.pulseColor="#FFFFFF"))}onUpdate(t,e,i){const r=e*Math.PI*this.pulseCount,o=Math.abs(Math.sin(r)),n=this.target.attribute;if(this.useOpacity){const t=1+(this.pulseOpacity-1)*o;this.useStroke&&(n.strokeOpacity=(this.originalAttributes.strokeOpacity||1)*t),this.useFill&&(n.fillOpacity=(this.originalAttributes.fillOpacity||1)*t)}if(this.useScale){const t=1+(this.pulseScale-1)*o;n.scaleX=(this.originalAttributes.scaleX||1)*t,n.scaleY=(this.originalAttributes.scaleY||1)*t}this.useColor&&this.pulseColor&&this.applyColorPulse(n,o),this.target.addUpdateShapeAndBoundsTag(),this.target.addUpdatePositionTag()}applyColorPulse(t,e){const i=this.pulseColorIntensity*e;this.useFill&&this.originalFill&&this.pulseColor&&(t.fill=Oa(this.originalFill,this.pulseColor,i,!0)),this.useStroke&&this.originalStroke&&this.pulseColor&&(t.stroke=Oa(this.originalStroke,this.pulseColor,i,!0))}onEnd(){super.onEnd(),this.target.setAttributes(this.originalAttributes)}}class Qw extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e;super.onBind();let{diffAttrs:i={}}=null!==(t=this.target.context)&&void 0!==t?t:{};const{options:r}=this.params;i=Object.assign({},i),(null===(e=null==r?void 0:r.excludeChannels)||void 0===e?void 0:e.length)&&r.excludeChannels.forEach((t=>{delete i[t]})),this.props=i}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.fromProps,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((t,e)=>{if(!this.animate.validAttr(this.propKeys[e]))return;const i=this.propKeys[e];t(i,this.fromProps[i],this.props[i],r,this,this.target)})),this.onUpdate(t,r,i)}}class tv extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class ev extends tv{onBind(){var t;super.onBind();const{from:e,to:i}=((t,e,i)=>{var r,o,n,s;const{offset:a=0,orient:l,direction:h,point:c,excludeChannels:d=[],layoutRect:u={}}=null!=e?e:{};let g=0,p=0;"negative"===l&&(g=null!==(r=u.width)&&void 0!==r?r:t.stage.viewWidth,p=null!==(o=u.height)&&void 0!==o?o:t.stage.viewHeight),g+=a,p+=a;const f=ot(c)?c.call(null,null===(s=null===(n=t.context)||void 0===n?void 0:n.data)||void 0===s?void 0:s[0],t,i):c,m=t.getGraphicAttribute("x"),b=t.getGraphicAttribute("y"),y=d.includes("x")?m:f&&mt(f.x)?f.x:g,C=d.includes("y")?b:f&&mt(f.y)?f.y:p;switch(h){case"x":return{from:{x:d.includes("x")?m:y},to:{x:m}};case"y":return{from:{y:C},to:{y:b}};default:return{from:{x:y,y:C},to:{x:m,y:b}}}})(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((t=>null!=i[t])),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),!1!==(null===(t=this.params.controlOptions)||void 0===t?void 0:t.immediatelyApply)&&this.target.setAttributes(e)}}class iv extends tv{onBind(){super.onBind();const{from:t,to:e}=((t,e,i)=>{var r,o,n,s;const{offset:a=0,orient:l,direction:h,point:c}=null!=e?e:{},d=i.group?i.group.AABBBounds:null,u=null!==(r=d.width())&&void 0!==r?r:i.width,g=null!==(o=d.height())&&void 0!==o?o:i.height,p=("negative"===l?u:0)+a,f=("negative"===l?g:0)+a,m=ot(c)?c.call(null,null===(s=null===(n=t.context)||void 0===n?void 0:n.data)||void 0===s?void 0:s[0],t,i):c,b=m&&mt(m.x)?m.x:p,y=m&&mt(m.y)?m.y:f;switch(h){case"x":return{from:{x:t.getGraphicAttribute("x")},to:{x:b}};case"y":return{from:{y:t.getGraphicAttribute("y")},to:{y:y}};default:return{from:{x:t.getGraphicAttribute("x"),y:t.getGraphicAttribute("y")},to:{x:b,y:y}}}})(this.target,this.params.options,this.params);this.props=e,this.propKeys=Object.keys(e).filter((t=>null!=e[t])),this.from=t,this.to=e}}class rv extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((t=>{r[t]=this.from[t]+(this.to[t]-this.from[t])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class ov extends rv{onBind(){var t;super.onBind();const{from:e,to:i}=((t,e)=>{var i;const r=null!==(i=t.getFinalAttribute().angle)&&void 0!==i?i:0;let o=0;return o=Yt(r/(2*Math.PI),0)?Math.round(r/(2*Math.PI))*Math.PI*2:mt(null==e?void 0:e.angle)?e.angle:"anticlockwise"===(null==e?void 0:e.orient)?Math.ceil(r/(2*Math.PI))*Math.PI*2:Math.floor(r/(2*Math.PI))*Math.PI*2,{from:{angle:o},to:{angle:r}}})(this.target,this.params.options);this.props=i,this.propKeys=["angle"],this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),!1!==(null===(t=this.params.controlOptions)||void 0===t?void 0:t.immediatelyApply)&&this.target.setAttributes(e)}}class nv extends rv{onBind(){super.onBind();const{from:t,to:e}=((t,e)=>{var i;const r=null!==(i=t.getFinalAttribute().angle)&&void 0!==i?i:0;let o=0;return o=Yt(r/(2*Math.PI),0)?Math.round(r/(2*Math.PI))*Math.PI*2:mt(null==e?void 0:e.angle)?e.angle:"anticlockwise"===(null==e?void 0:e.orient)?Math.ceil(r/(2*Math.PI))*Math.PI*2:Math.floor(r/(2*Math.PI))*Math.PI*2,{from:{angle:r},to:{angle:o}}})(this.target,this.params.options);this.props=e,this.propKeys=["angle"],this.from=t,this.to=e}}class sv extends UC{constructor(t,e,i,r,o){var n;super(t,e,i,r,o),o&&(this.pathLength=o.path.getLength(),this.path=o.path,this.distance=o.distance,this.totalLength=this.distance*this.pathLength,this.initAngle=null!==(n=o.initAngle)&&void 0!==n?n:0,this.changeAngle=!!o.changeAngle,this.cb=o.cb)}onBind(){this.from={x:0,y:0},this.to=this.path.getAttrAt(this.totalLength).pos,this.props=this.to}onUpdate(t,e,i){const r={},o=this.totalLength*e,{pos:n,angle:s}=this.path.getAttrAt(o);r.x=n.x,r.y=n.y,this.changeAngle&&(r.angle=s+this.initAngle),this.cb&&this.cb(this.from,this.to,e,this.target),this.target.setAttributes(r)}}class av extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o),this.from=null!=t?t:{}}onBind(){var t,e;super.onBind(),Object.keys(this.from).forEach((t=>{null==this.props[t]&&(this.props[t]=this.target.getGraphicAttribute(t))}));const i=this.target.getFinalAttribute();"appear"===(null===(t=this.target.context)||void 0===t?void 0:t.animationState)&&i&&this.target.setAttributes(i),!1!==(null===(e=this.params.controlOptions)||void 0===e?void 0:e.immediatelyApply)&&this.target.setAttributes(this.from)}onFirstRun(){this.from=Object.assign(Object.assign({},this.getLastProps()),this.from);const t=this.animate.getStartProps();this.propKeys&&this.propKeys.forEach((e=>{var i;this.from[e]=null!==(i=this.from[e])&&void 0!==i?i:t[e]})),this.target.setAttributes(this.from)}deleteSelfAttr(t){super.deleteSelfAttr(t),delete this.from[t]}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.from,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((t,e)=>{if(!this.animate.validAttr(this.propKeys[e]))return;const i=this.propKeys[e];t(i,this.from[i],this.props[i],r,this,this.target)})),this.onUpdate(t,r,i),this.syncAttributeUpdate()}}class lv extends UC{constructor(t,e,i,r,o){super(t,e,i,r,o)}getEndProps(){return{}}onStart(){this.target&&("rect"===this.target.type?this.onStartRect():"line"===this.target.type?this.onStartLineOrArea("line"):"area"===this.target.type&&this.onStartLineOrArea("area"))}onStartLineOrArea(t){var e;const i=this.target.attachShadow(),r=D.graphicService.creator[t](Object.assign({},null===(e=this.params)||void 0===e?void 0:e.attribute));this[t]=r,r.pathProxy=new pr,i.add(r)}onStartRect(){var t,e,i;const r=this.target.attachShadow(),o=null===(e=null===(t=this.params)||void 0===t?void 0:t.isHorizontal)||void 0===e||e,n=o?"height":"width",s=o?"width":"height",a=this.target.AABBBounds[n](),l=o?0:this.target.AABBBounds.y1,h=D.graphicService.creator.rect(Object.assign(Object.assign({[n]:a,fill:"#bcdeff",shadowBlur:30,shadowColor:"#bcdeff"},null===(i=this.params)||void 0===i?void 0:i.attribute),{x:0,y:l,[s]:0}));this.rect=h,r.add(h)}onBind(){}onEnd(){this.target.detachShadow()}onUpdate(t,e,i){return this.rect?this.onUpdateRect(t,e,i):this.line||this.area?this.onUpdateLineOrArea(t,e,i):void 0}onUpdateRect(t,e,i){var r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y;const C=null===(o=null===(r=this.params)||void 0===r?void 0:r.isHorizontal)||void 0===o||o,w=this.target.attribute;if(C){const i=null!==(s=null!==(n=w.width)&&void 0!==n?n:Math.abs(w.x1-w.x))&&void 0!==s?s:250,r=null!==(l=null===(a=this.params)||void 0===a?void 0:a.streamLength)&&void 0!==l?l:i,o=null!==(d=null===(c=null===(h=this.params)||void 0===h?void 0:h.attribute)||void 0===c?void 0:c.width)&&void 0!==d?d:60,u=-o,g=u+(r-u)*e,p=Math.max(g,0),f=Math.min(Math.min(g+o,o),r-g),m=f+p>i?Math.max(i-p,0):f;this.rect.setAttributes({x:p+Math.min(w.x1-w.x,0),width:m},!1,{type:wi.ANIMATE_PLAY,animationState:{ratio:e,end:t}})}else{const i=null!==(g=null!==(u=w.height)&&void 0!==u?u:Math.abs(w.y1-w.y))&&void 0!==g?g:250,r=null!==(f=null===(p=this.params)||void 0===p?void 0:p.streamLength)&&void 0!==f?f:i,o=null!==(y=null===(b=null===(m=this.params)||void 0===m?void 0:m.attribute)||void 0===b?void 0:b.height)&&void 0!==y?y:60,n=i-(r+o)*e;let s=Math.min(n,i);const a=Math.min(i-n,o);let l;s<=0?(l=Math.max(s+a,0),s=0):l=a,this.rect.setAttributes({y:s+Math.min(w.y1-w.y,0),height:l},!1,{type:wi.ANIMATE_PLAY,animationState:{ratio:e,end:t}})}}onUpdateLineOrArea(t,e,i){const r=this.line||this.area;if(!r)return;const o=r.pathProxy,n=this.target;n.cache||n.cacheArea?this._onUpdateLineOrAreaWithCache(o,n,t,e,i):this._onUpdateLineWithoutCache(o,n,t,e,i);const s=n.attribute;r.setAttributes(Object.assign({stroke:s.stroke},r.attribute)),r.addUpdateBoundTag()}_onUpdateLineOrAreaWithCache(t,e,i,r,o){var n,s;if(t.clear(),"line"===e.type){let i=e.cache;Array.isArray(i)||(i=[i]);const o=i.reduce(((t,e)=>t+e.getLength()),0),n=[];return i.forEach((t=>{t.curves.forEach((t=>n.push(t)))})),this._updateCurves(t,n,o,r)}if("area"===e.type&&(null===(s=null===(n=e.cacheArea)||void 0===n?void 0:n.top)||void 0===s?void 0:s.curves)){const i=e.cacheArea,o=i.top.curves.reduce(((t,e)=>t+e.getLength()),0);return this._updateCurves(t,i.top.curves,o,r)}}_updateCurves(t,e,i,r){var o,n;const s=i*r,a=Math.min(s+(null!==(n=null===(o=this.params)||void 0===o?void 0:o.streamLength)&&void 0!==n?n:10),i);let l=0,h=!1;for(let i=0;i<e.length;i++)if(!1!==e[i].defined){const r=e[i],o=r.getLength(),n=1-(l+o-s)/o;let c,d=1-(l+o-a)/o;if(l<s&&l+o>s)if(h=!0,r.p2&&r.p3){const[e,i]=Fi(r,n);t.moveTo(i.p0.x,i.p0.y),c=i}else{const e=r.getPointAt(n);t.moveTo(e.x,e.y)}if(l<a&&l+o>a){if(r.p2&&r.p3){c&&(d=(a-s)/c.getLength());const[e]=Fi(c||r,d);t.bezierCurveTo(e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y)}else{const e=r.getPointAt(d);t.lineTo(e.x,e.y)}break}if(h)if(r.p2&&r.p3){const e=c||r;t.bezierCurveTo(e.p1.x,e.p1.y,e.p2.x,e.p2.y,e.p3.x,e.p3.y)}else t.lineTo(r.p1.x,r.p1.y);l+=o}}_onUpdateLineWithoutCache(t,e,i,r,o){var n,s;const{points:a,curveType:l}=e.attribute;if(!a||a.length<2||"linear"!==l)return;let h=0;for(let t=1;t<a.length;t++)h+=we.distancePP(a[t],a[t-1]);const c=h*r,d=Math.min(c+(null!==(s=null===(n=this.params)||void 0===n?void 0:n.streamLength)&&void 0!==s?s:10),h),u=[];let g=0;for(let t=1;t<a.length;t++){const e=we.distancePP(a[t],a[t-1]);if(g<c&&g+e>c&&u.push(we.pointAtPP(a[t-1],a[t],1-(g+e-c)/e)),g<d&&g+e>d){u.push(we.pointAtPP(a[t-1],a[t],1-(g+e-d)/e));break}u.length&&u.push(a[t]),g+=e}if(u.length&&!(u.length<2)){t.clear(),t.moveTo(u[0].x,u[0].y);for(let e=1;e<u.length;e++)t.lineTo(u[e].x,u[e].y)}}}class hv extends KC{onBind(){var t;const e=XC(this.target);this._animator=e;const i=this.duration,r=this.easing,{config:o,lastScale:n,getTickCoord:s}=this.params;let a=1;const l=this.target.data;if(n&&s&&l){a=.7;const t=s(n.scale(l.rawValue)),o=this.target.attribute.x,h=this.target.attribute.y;this.target.setAttributes({x:t.x,y:t.y}),e.animate(this.target,{type:"to",to:{x:o,y:h},duration:i,easing:r})}e.animate(this.target,{type:null!==(t=o.type)&&void 0!==t?t:"fadeIn",to:o.to,duration:i*a,easing:r}),this.completeBind(e)}}class cv extends KC{onBind(){const t=XC(this.target);this._animator=t;const e=this.duration,i=this.easing,{config:r,diffAttrs:o}=this.params;t.animate(this.target,{type:"to",to:Object.assign({},o),duration:e,easing:i,customParameters:{diffAttrs:Object.assign({},o)}}),this.completeBind(t)}deleteSelfAttr(t){super.deleteSelfAttr(t),this._animator.deleteSelfAttr(t)}tryPreventConflict(){}}function dv(){jb(),$b(),ey(),ay(),LC.registerBuiltInAnimate("axisEnter",hv),LC.registerBuiltInAnimate("axisUpdate",cv)}var uv=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};dv(),Qb();class gv extends hC{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},gv.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const t=[];for(let e=0;e<this.attribute.breaks.length;e++){const i=this.attribute.breaks[e],{range:r,breakSymbol:o,rawRange:n}=i;t.push({startPoint:this.getTickCoord(r[0]),endPoint:this.getTickCoord(r[1]),range:r,breakSymbol:o,rawRange:n})}this._breaks=t}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach(((e,i)=>{const{startPoint:r,endPoint:o,breakSymbol:n,rawRange:s}=e;if(!1!==(null==n?void 0:n.visible)){const e=Fh.group({zIndex:999});e.name=Xy.axisBreak,e.id=this._getNodeId(`${Xy.axisBreak}-${i}`),e.data=s;const a=function(t={}){var e,i;const{style:r={},angle:o=.5*Math.PI}=t,n=Ht({},Jy,r),s=null!==(e=n.size)&&void 0!==e?e:Jy.size;return Object.assign(Object.assign({},n),{symbolType:null!==(i=n.symbolType)&&void 0!==i?i:`M ${-s/2} ${s*Math.sin(o)} L ${s/2} ${-s*Math.sin(o)}`,symbolSize:s})}(n),l=Fh.symbol(Object.assign({x:r.x,y:r.y},a));l.name=Xy.axisBreakSymbol;const h=Fh.symbol(Object.assign({x:o.x,y:o.y},a));h.name=Xy.axisBreakSymbol,e.add(l),e.add(h),t.add(e)}}));const{panel:i}=this.attribute;if(i&&i.visible){const t=this.axisContainer,r=t.AABBBounds,o=Fh.rect(Object.assign({x:r.x1,y:r.y1,width:r.width(),height:r.height()},i.style));o.name=Xy.background,o.id=this._getNodeId("background"),o.states=Ht({},qy,null!==(e=i.state)&&void 0!==e?e:{}),t.insertBefore(o,t.firstChild)}}renderLine(t){const{start:e,end:i,line:r}=this.attribute,o=r,{startSymbol:n,endSymbol:s,style:a,state:l}=o,h=uv(o,["startSymbol","endSymbol","style","state"]),c=Object.assign({startSymbol:n,endSymbol:s,lineStyle:a},h);if(this._breaks&&this._breaks.length){const t=[];let r=e;this._breaks.forEach((e=>{const{startPoint:i,endPoint:o}=e;t.push([r,i]),r=o})),t.push([r,i]),c.points=t,c.multiSegment=!0}else c.points=[e,i];_t(l)||(c.state={line:Ht({},qy,l),symbol:Ht({},qy,l)});const d=new $y(c);d.name=Xy.line,d.id=this._getNodeId("line"),t.add(d)}getTextAlign(t){let e="center";return Yt(t[0],0)?Yt(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const r=this.attribute.title,{position:o="middle",space:n=4,textStyle:s={},autoRotate:a=!0,shape:l,background:h,state:c={},maxWidth:d}=r,u=uv(r,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let g=.5;"start"===o?g=0:"end"===o&&(g=1);const{verticalFactor:p=1}=this.attribute,f=-1*p,m=this.getTickCoord(g),b=this.getRelativeVector();let y=0;if((null===(t=this.attribute.label)||void 0===t?void 0:t.visible)&&!1===this.attribute.label.inside){const t=+St(this.attribute,"label.space",4);y+=t;const e=Object.keys(this.axisLabelLayerSize).length;if(0===b[1]){const i=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(i)?y+=i+(e-1)*t:y=0}else if(0===b[0])if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const i=this.axisLabelLayerSize[0].labelPos,r=this.axisLabelsContainer.AABBBounds;y+=(1===f?r.x2>i?Math.min(r.x2-i,r.width()):0:r.x1<i?Math.min(i-r.x1,r.width()):0)+(e-1)*t}else y=0;else Object.keys(this.axisLabelLayerSize).forEach(((e,i)=>{y+=this.axisLabelLayerSize[e].width+(i>0?t:0)}))}let C=0;(null===(e=this.attribute.tick)||void 0===e?void 0:e.visible)&&!1===this.attribute.tick.inside&&(C=this.attribute.tick.length||4),(null===(i=this.attribute.subTick)||void 0===i?void 0:i.visible)&&!1===this.attribute.subTick.inside&&(C=Math.max(C,this.attribute.subTick.length||2));const w=C+y+n,v=this.getVerticalCoord(m,w,!1),x=this.getVerticalVector(w,!1,{x:0,y:0});let _,S,{angle:A}=u;if(_="start"===o?"start":"end"===o?"end":"center",nt(A)&&a){A=vy(b,[1,0],!0);const{verticalFactor:t=1}=this.attribute;S=1==-1*t?"bottom":"top"}else _=this.getTextAlign(x),S=this.getTextBaseline(x,!1);let T=d;if(nt(T)){const{verticalLimitSize:t,verticalMinSize:e,orient:i}=this.attribute,r=Math.min(t||1/0,e||1/0);if(mt(r))if("bottom"===i||"top"===i)if(A!==Math.PI/2){const t=Math.abs(Math.cos(null!=A?A:0));T=t<1e-6?1/0:this.attribute.end.x/t}else T=r-w;else if(A&&0!==A){const t=Math.abs(Math.sin(A));T=t<1e-6?1/0:this.attribute.end.y/t}else T=r-w}const R=Object.assign(Object.assign(Object.assign({},v),u),{maxWidth:T,textStyle:Object.assign({textAlign:_,textBaseline:S},s),state:{text:Ht({},qy,c.text),shape:Ht({},qy,c.shape),panel:Ht({},qy,c.background)}});return R.angle=A,l&&l.visible&&(R.shape=Object.assign({visible:!0},l.style),l.space&&(R.space=l.space)),h&&h.visible&&(R.panel=Object.assign({visible:!0},h.style)),R}getTextBaseline(t,e){let i="middle";const{verticalFactor:r=1}=this.attribute,o=(e?1:-1)*r;return Yt(t[1],0)?i=!Yt(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":1===o?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const r=this.attribute.orient;if(["top","bottom","right","left"].includes(r)||0===t[0]&&0===t[1]){if("top"===r||"bottom"===r)return mC(e?"bottom"===r?"top":"bottom":r,i);if("left"===r||"right"===r)return bC(e?"left"===r?"right":"left":r,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,r,o){var n,s,a,l;const{flush:h=!1}=this.attribute.label||{};if(h&&t.length){const{orient:e,start:i,end:r}=this.attribute,o="bottom"===e||"top"===e,h=t[0],c=Ot(t),d=o?h.attribute.x>c.attribute.x:h.attribute.y<c.attribute.y;if(o){const t=d?c:h,e=d?h:c,o=i.x,a=r.x,l=t.AABBBounds.x1,u=e.AABBBounds.x2;l<o&&(t.attribute.angle?t.setAttributes({dx:(null!==(n=t.attribute.dx)&&void 0!==n?n:0)+o-l}):t.setAttributes({x:o,textAlign:"left"})),u>a&&(e.attribute.angle?e.setAttributes({dx:(null!==(s=e.attribute.dx)&&void 0!==s?s:0)+a-u}):e.setAttributes({x:a,textAlign:"right"}))}else{const t=d?c:h,e=d?h:c,o=t.AABBBounds.y2,n=e.AABBBounds.y1,s=i.y,u=r.y;n<s&&(e.attribute.angle?e.setAttributes({dy:(null!==(a=e.attribute.dy)&&void 0!==a?a:0)+s-n}):e.setAttributes({y:s,textBaseline:"top"})),o>u&&(t.attribute.angle?t.setAttributes({dy:(null!==(l=t.attribute.dy)&&void 0!==l?l:0)+u-o}):t.setAttributes({y:u,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,r,o){if(_t(t))return;const{verticalLimitSize:n,label:s,orient:a}=this.attribute,l=this._getAxisLabelLimitLength(n,o),{layoutFunc:h,autoRotate:c,autoRotateAngle:d,autoLimit:u,limitEllipsis:g,autoHide:p,autoHideMethod:f,autoHideSeparation:m,lastVisible:b,firstVisible:y,autoWrap:C,overflowLimitLength:w}=s;if(ot(h))h(t,e,r,this);else{if(c)!function(t,e){if(_t(t))return;const{orient:i,labelRotateAngle:r=[0,45,90]}=e;if(0===r.length||t.some((t=>!!t.attribute.angle)))return;let o=0,n=0;for(r&&r.length>0&&(n=r.length);o<n;){const e=r[o++];if(t.forEach((t=>{t.attribute.angle=ve(e)})),pC(i,t),!gC(t))break}}(t,{labelRotateAngle:d,orient:a});else if(C){!function(t,e){const{limitLength:i,axisLength:r,ellipsis:o="...",orient:n}=e;if(_t(t)||!mt(i))return;const s=t[0].attribute.angle,a=eC(s),l=tC(s),h="top"===n||"bottom"===n;let c=r/t.length;t.forEach(((e,r)=>{var n,s,d,u,g;if(h){if(l&&Math.floor(e.AABBBounds.height())<=i)return;if(a){const i=CC(e.attribute.x,null===(n=t[r+1])||void 0===n?void 0:n.attribute.x,null===(s=t[r-1])||void 0===s?void 0:s.attribute.x);mt(i)&&(c=ge(c,i))}}else{if(l){const i=CC(e.attribute.y,null===(d=t[r+1])||void 0===d?void 0:d.attribute.y,null===(u=t[r-1])||void 0===u?void 0:u.attribute.y);mt(i)&&(c=ge(c,i))}if(a&&Math.floor(e.AABBBounds.width())<=i)return}let p=null,f=null;h?l?(p=i,f=c):(p=c,f=i):l?(p=c,f=i):(p=i,f=c),e.setAttributes({maxLineWidth:p,ellipsis:null!==(g=e.attribute.ellipsis)&&void 0!==g?g:o,whiteSpace:"normal",heightLimit:f})}))}(t,{orient:a,limitLength:l,axisLength:"left"===a||"right"===a?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x),ellipsis:g})}if(!C&&u&&mt(l)&&l>0){const e="left"===a||"right"===a,i=e?Math.abs(this.attribute.start.y-this.attribute.end.y):Math.abs(this.attribute.start.x-this.attribute.end.x);yC(t,{limitLength:l,verticalLimitLength:e?i/t.length:p||c?1/0:i/t.length,ellipsis:g,orient:a,axisLength:i,overflowLimitLength:w})}p&&function(t,e){if(_t(t))return;const i=t.filter(dC);if(_t(i))return;let r;r=function(t){return t.forEach((t=>t.setAttribute("opacity",1))),t}(i);const{method:o="parity",separation:n=0}=e,s=ot(o)?o:cC[o]||cC.parity;if(r.length>=3&&sC(r,n)){do{r=s(r,n)}while(r.length>=3&&sC(r,n));const t=(t,e,i=!0)=>i&&t<3||e,o=t(r.length,e.firstVisible,!1);let a=t(r.length,e.lastVisible);const l=i[0],h=Ot(i);nC(l,h,n)&&o&&a&&(h.setAttribute("opacity",0),a=!1),uC(l,r,o,(t=>nC(t,l,n))),uC(h,r,a,(t=>nC(t,h,n)||!(!o||t===l)&&nC(t,l,n)),!0)}i.forEach((t=>{t.setAttribute("visible",!!t.attribute.opacity)}))}(t,{orient:a,method:f,separation:m,lastVisible:b,firstVisible:y})}}afterLabelsOverlap(t,e,i,r,o){const{verticalLimitSize:n,orient:s}=this.attribute,a="bottom"===s||"top"===s,l=i.AABBBounds;let h=a?l.height():l.width();const{verticalMinSize:c}=this.attribute;if(mt(c)&&(!mt(n)||c<=n)){const t=this._getAxisLabelLimitLength(c,o);let e,r;h=Math.max(h,t),"left"===s?(e=l.x2-h,r=l.y1):"right"===s?(e=l.x1,r=l.y1):"top"===s?(e=l.x1,r=l.y2-h):"bottom"===s&&(e=l.x1,r=l.y1);const n=Fh.rect({x:e,y:r,width:a?l.width():h,height:a?h:l.height(),pickable:!1});n.name=Xy.axisLabelBackground,n.id=this._getNodeId("axis-label-background"),i.insertBefore(n,i.firstChild)}if(st(this.attribute.label.containerAlign)){let e;"left"===s?e=l.x2-h:"right"===s?e=l.x1:"top"===s?e=l.y2-h:"bottom"===s&&(e=l.y1),function(t,e,i,r,o){"left"===r||"right"===r?"left"===o?t.forEach((t=>{var i;t.setAttributes({dx:(null!==(i=t.attribute.dx)&&void 0!==i?i:0)+e-t.AABBBounds.x1})})):"right"===o?t.forEach((t=>{var r;t.setAttributes({dx:(null!==(r=t.attribute.dx)&&void 0!==r?r:0)+e+i-t.AABBBounds.x2})})):"center"===o&&t.forEach((t=>{var r;t.setAttributes({dx:(null!==(r=t.attribute.dx)&&void 0!==r?r:0)+e+i/2-(t.AABBBounds.x1+t.AABBBounds.x2)/2})})):"bottom"!==r&&"top"!==r||("top"===o?t.forEach((t=>{var i;t.setAttributes({dy:(null!==(i=t.attribute.dy)&&void 0!==i?i:0)+e-t.AABBBounds.y1})})):"bottom"===o?t.forEach((t=>{var r;t.setAttributes({dy:(null!==(r=t.attribute.dy)&&void 0!==r?r:0)+e+i-t.AABBBounds.y2})})):"middle"===o&&t.forEach((t=>{var r;t.setAttributes({dy:(null!==(r=t.attribute.dy)&&void 0!==r?r:0)+e+i/2-(t.AABBBounds.y1+t.AABBBounds.y2)/2})})))}(t,e,h,s,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,r,o,n,s;const{label:a,title:l,line:h,tick:c}=this.attribute,d=null!==(i=a.space)&&void 0!==i?i:4;let u=t,g=0,p=0;const f=h&&h.visible?null!==(r=h.style.lineWidth)&&void 0!==r?r:1:0,m=c&&c.visible?null!==(o=c.length)&&void 0!==o?o:4:0;if(l&&l.visible&&"string"==typeof l.text){g=_y(l.text,l.textStyle,null===(s=null===(n=this.stage)||void 0===n?void 0:n.getTheme())||void 0===s?void 0:s.text).height;const t=ni(l.padding);p=l.space+t[0]+t[2]}return u&&(u=(u-d-p-g-f-m)/e),u}release(){super.release(),this._breaks=null}}gv.defaultAttributes=Zy,It(gv,class{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:r=1}=this.attribute,o=function(t){let e=wy(t);return e>0&&(e=1/e),[t[0]*e,t[1]*e]}(this.getRelativeVector());return Cy([o[1],-1*o[0]],t*(e?1:-1)*r)}});const pv=t=>t.map(((t,e)=>({index:e,value:t}))),fv=(t,e,i=0)=>{const r=new Ge(t).expand(i/2),o=new Ge(e).expand(i/2);return r.intersects(o)},mv=(t,e,i,r)=>i<t?Math.max(t-e/2,i):i>t?Math.min(t-e/2,i-e):i<r?i:i-e,bv=(t,e,i)=>{var r,o,n;const{labelStyle:s,axisOrientType:a,labelFlush:l,labelFormatter:h,startAngle:c=0}=i;let d=null!==(r=s.angle)&&void 0!==r?r:0;"vertical"===s.direction&&(d+=ve(90));const u=["bottom","top"].includes(a),g=["left","right"].includes(a);let p=1,f=0;u||(g?(p=0,f=1):c&&(p=Math.cos(c),f=-Math.sin(c)));const m=xy(s),b=t.range();let y=[];for(let i=0;i<e.length;i++){const r=e[i],a=h?h(r):`${r}`;if(ht(a)){y=void 0;break}const{width:c,height:C}=m.quickMeasure(a),w=Math.max(c,12),v=Math.max(C,12),x=t.scale(r),_=p*x,S=f*x;let A,T,R=_,B=S;l&&u&&0===i?R=mv(_,w,b[0],b[b.length-1]):l&&u&&i===e.length-1?R=mv(_,w,b[b.length-1],b[0]):A=null!==(o=s.textAlign)&&void 0!==o?o:"center","right"===A?R-=w:"center"===A&&(R-=w/2),l&&g&&0===i?B=mv(S,v,b[0],b[b.length-1]):l&&g&&i===e.length-1?B=mv(S,v,b[b.length-1],b[0]):T=null!==(n=s.textBaseline)&&void 0!==n?n:"middle","bottom"===T?B-=v:"middle"===T&&(B-=v/2);const M=(new Ge).set(R,B,R+w,B+v);d&&M.rotate(d,_,S),y.push(M)}return y};var yv;function Cv(t){switch(t){case yv.Linear:case yv.Log:case yv.Pow:case yv.Sqrt:case yv.Symlog:case yv.Time:return!0;default:return!1}}function wv(t){return t}function vv(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function xv(t,e,i){const r=t[0],o=t[1],n=e[0],s=e[1];let a,l;return o<r?(a=vv(o,r),l=i(s,n)):(a=vv(r,o),l=i(n,s)),t=>l(a(t))}function _v(t,e,i){const r=Math.min(t.length,e.length)-1,o=new Array(r),n=new Array(r);let s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)o[s]=vv(t[s],t[s+1]),n[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e,i=0,r){for(nt(r)&&(r=t.length);i<r;){const o=i+r>>>1;jt(t[o],e)>0?r=o:i=o+1}return i}(t,e,1,r)-1;return n[i](o[i](e))}}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(yv||(yv={})),Object.values(yv).forEach((t=>{}));let Sv=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:st(this._rangeFactorStart)&&st(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=function(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),r=t[0]-i*e[0];return[r,i+r]}(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):st(this._rangeFactorStart)&&st(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return nt(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!nt(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return nt(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!nt(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),n=o[0],s=o[o.length-1],a=Math.min(n,s),l=Math.max(n,s),h=Zt(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),c=nt(r)?(l-a)*i:r;let d=Math.exp(e);d=d/(d-1)*c;const u=e/c;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=c)return t;if(e<=1e-6)return h;const i=d*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}};const{interpolateRgb:Av}=oi;function Tv(t,e){const i=typeof e;let r;if(nt(e)||"boolean"===i)return()=>e;if("number"===i)return ie(t,e);if("string"===i){if(r=ii.parseColorString(e)){const e=Av(ii.parseColorString(t),r);return t=>e(t).formatRgb()}return ie(Number(t),Number(e))}return e instanceof ri?Av(t,e):e instanceof ii?Av(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),r=e.valueOf(),o=new Date;return t=>(o.setTime(i*(1-t)+r*t),o)}(t,e):ie(Number(t),Number(e))}let Rv=class extends Sv{constructor(t=wv,e=wv){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=wv,this._piecewise=xv,this._interpolate=Tv}calculateVisibleDomain(t){var e;return st(this._rangeFactorStart)&&st(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),ie)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,Vt);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=re,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,r=i.length,o=this._range.length;let n=Math.min(r,o);if(r&&r<o&&this._forceAlign){const t=o-r+1,e=i[r-1],s=r>=2?(e-i[r-2])/t:0;for(let o=1;o<=t;o++)i[r-2+o]=e-s*(t-o);n=o}return this._autoClamp&&(this._clamp=function(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}(i[0],i[n-1])),this._piecewise=n>2?_v:xv,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:wv),this.rescale(i)):this._clamp!==wv}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return nt(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return nt(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const Bv=Math.sqrt(50),Mv=Math.sqrt(10),Pv=Math.sqrt(2),Hv=[1,2,5,10],kv=(t,e,i)=>{let r=1,o=t;const n=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?o=0:t<0&&t>=-Number.MIN_VALUE?o=-(e-1):!i&&s<1?r=Iv(s).step:(i||s>1)&&(o=Math.floor(t)-n*r),r>0?(t>0?o=Math.max(o,0):t<0&&(o=Math.min(o,-(e-1)*r)),function(t,e,i){st(e)||(e=t,t=0),st(i)||(i=1);let r=-1;const o=0|Math.max(0,Math.ceil((e-t)/i)),n=new Array(o);for(;++r<o;)n[r]=t+r*i;return n}(0,e).map((t=>o+t*r))):t>0?Fv(0,-(e-1)/r,r):Fv((e-1)/r,0,r)},Ev=qt(((t,e,i,r)=>{let o,n,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((o=e<t)&&(n=t,t=e,e=n),a=zv(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),r=Math.round(e/a);for(i*a<t&&++i,r*a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)*a}else if(a<0&&(null==r?void 0:r.noDecimals)){a=1;const i=Math.ceil(t),r=Math.floor(e);if(!(i<=r))return[];for(s=new Array(n=r-i+1);++l<n;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),r=Math.round(e*a);for(i/a<t&&++i,r/a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)/a}return o&&s.reverse(),s})),Fv=(t,e,i)=>{let r,o,n=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)/i}return o},Lv=qt(((t,e,i,r)=>{let o,n,s;if(i=+i,(t=+t)==(e=+e))return kv(t,i,null==r?void 0:r.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return kv(t,i,null==r?void 0:r.noDecimals);(o=e<t)&&(s=t,t=e,e=s);const a=zv(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let r=1;const{power:o,gap:s}=a,h=10===s?2*10**o:1*10**o;for(;r<=5&&(n=Fv(t,e,l),n.length>i+1)&&i>2;)l+=h,r+=1;i>2&&n.length<i-1&&(n=((t,e,i)=>{let r;const o=t[0],n=t[t.length-1],s=e-t.length;if(n<=0){const e=[];for(r=s;r>=1;r--)e.push(o-r*i);return e.concat(t)}if(o>=0){for(r=1;r<=s;r++)t.push(n+r*i);return t}let a=[];const l=[];for(r=1;r<=s;r++)r%2==0?a=[o-Math.floor(r/2)*i].concat(a):l.push(n+Math.ceil(r/2)*i);return a.concat(t).concat(l)})(n,i,l))}else(null==r?void 0:r.noDecimals)&&l<0&&(l=1),n=Fv(t,e,l);return o&&n.reverse(),n})),Iv=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let r=Hv[0];return i>=Bv?r=Hv[3]:i>=Mv?r=Hv[2]:i>=Pv&&(r=Hv[1]),e>=0?{step:r*10**e,gap:r,power:e}:{step:-(10**-e)/r,gap:r,power:e}};function zv(t,e,i){const r=(e-t)/Math.max(0,i);return Iv(r)}function Ov(t,e,i){let r;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(r=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(r))return[];const o=new Array(i);for(let e=0;e<i;e++)o[e]=t+e*r;return o}function Dv(t,e=10){let i,r,o=0,n=t.length-1,s=t[o],a=t[n],l=10;for(a<s&&(r=s,s=a,a=r,r=o,o=n,n=r);l-- >0;){if(r=zv(s,a,e).step,r===i)return t[o]=s,t[n]=a,t;if(r>0)s=Math.floor(s/r)*r,a=Math.ceil(a/r)*r;else{if(!(r<0))break;s=Math.ceil(s*r)/r,a=Math.floor(a*r)/r}i=r}}let Wv=class t extends Rv{constructor(){super(...arguments),this.type=yv.Linear}clone(){var e;const i=new t;return i.domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate),this._niceType&&(i._niceType=this._niceType,i._domainValidator=this._domainValidator,i._niceDomain=null===(e=this._niceDomain)||void 0===e?void 0:e.slice()),i}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return Ev(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(ot(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(st(this._rangeFactorStart)&&st(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const r=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,o=this._domain,n=r[0],s=r[r.length-1];let a=Lv(o[0],o[o.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==n||a[a.length-1]!==s)&&this._niceType){const t=r.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==n?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Ov(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let r,o,n=-1;if(i=+i,(o=(e=+e)<(t=+t))&&(r=t,t=e,e=r),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++n<s;)a[n]=t+n*i;return o&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const o=this._domain;let n=[];if(e){const t=function(t,e){const i=ft(e.forceMin),r=ft(e.forceMax);let o=null;const n=[];let s=null;const a=i&&r?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:r?t=>t<=e.forceMax:null;return i?n[0]=e.forceMin:ft(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(n[0]=e.min),r?n[1]=e.forceMax:ft(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(n[1]=e.max),ft(n[0])&&ft(n[1])?(s=t.slice(),s[0]=n[0],s[s.length-1]=n[1]):o=ft(n[0])||ft(n[1])?ft(n[0])?"max":"min":"all",{niceType:o,niceDomain:s,niceMinMax:n,domainValidator:a}}(o,e);if(n=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=Dv(o.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=n[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(r=n[0])&&void 0!==r?r:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=Dv(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=Dv(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};function Nv(t,e,i,r){let o;const{breakData:n}=t;if(n&&n()){const{breakDomains:t}=n(),s=e.domain();o=[];for(let e=0;e<s.length-1;e++)r(i,[s[e],s[e+1]]).forEach((e=>{t.some((t=>e>=t[0]&&e<=t[1]))||o.push(e)}));e.domain(s)}else o=r(i);return o}function Gv(t,e,i,r,o=!1){if(i&&!e.includes(t)){let i=e.length;if(i>1){o?e.push(t):e.unshift(t);for(let t=0;t<i;t++){const n=o?i-1-t:t;if(!r(e[n]))break;e.splice(n,1),t--,i--}}}}const jv={parity:function(t){return t.filter(((t,e)=>e%2==0))},greedy:function(t,e){let i;return t.filter(((t,r)=>!(r&&nC(i,t,e)||(i=t,0))))}},Vv=(t,e,i,r)=>{const o=bv(t,e,i);return o&&o.map((t=>r?[t.x1,t.x2,t.width()]:[t.y1,t.y2,t.height()]))},Uv=(t,e,i=0)=>Math.max(t[0],e[0])-i/2<=Math.min(t[1],e[1])+i/2,Kv=(t,e)=>t[1]<e[0]?e[0]-t[1]:e[1]<t[0]?t[0]-e[1]:0,$v=(t,e,i,r,o,n)=>{let s=0,a=0,l=-1,h=Number.MAX_VALUE;const c=r=>{let o=!0,n=0;do{n+r<t.length&&Uv(e[n],e[n+r],i)&&(o=!1),n+=r}while(o&&n<t.length);return o},d=((t,e,i)=>{let r=t,o=e;for(;r<o;){const t=Math.floor((r+o)/2);i(t)>=0?o=t:r=t+1}return r})(o,t.length,(t=>c(t)?1:-1));let u=d;do{if(u>d&&!n&&!c(u))u++;else{if(!r){a=u;break}{const r=t.length-1;let o,n=0;o=t.length%u>0?t.length-t.length%u+u:t.length;do{if(o-=u,o!==r&&!Uv(e[o],e[r],i))break;n++}while(o>0);if(o===r){a=u,s=n;break}{const i=Math.floor(t.length/u)-n+1;if(i<l)break;{l=i;const t=Kv(e[o],e[r]),c=o-u>=0?Kv(e[o-u],e[o]):t,d=Math.abs(t-c);if(d<h&&(h=d,a=u,s=n),t<=c)break}}}u++}}while(u<=t.length);return{step:a,delCount:s}},Xv=(t,e)=>{const{tickCount:i,forceTickCount:r,tickStep:o,getRadius:n,labelOffset:s,labelGap:a=0,labelStyle:l}=e,h=null==n?void 0:n();if(!h)return pv(t.domain());let c;if(st(o))c=t.stepTicks(o);else if(st(r))c=t.forceTicks(r);else if(st(i)){const e=t.range(),r=Math.abs(e[e.length-1]-e[0]),o=ot(i)?i({axisLength:r,labelStyle:l}):i;c=t.ticks(o)}else if(e.sampling){const i=t.domain(),r=t.range(),o=((t,e,i)=>{var r;const{labelStyle:o,getRadius:n,labelOffset:s,labelFormatter:a,inside:l}=i,h=null==n?void 0:n(),c=null!==(r=o.angle)&&void 0!==r?r:0,d=xy(o);return e.map((e=>{const i=a?a(e):`${e}`,{width:r,height:n}=d.quickMeasure(i),u=Math.max(r,12),g=Math.max(n,12),p=t.scale(e),f={x:0,y:0};let m=0,b=0;const y={align:o.textAlign,baseline:o.textBaseline},{x:C,y:w}=oC(p,f,h,s,l);return y.align||(Yt(C,f.x)?y.baseline||(y.baseline=w>f.y?"top":"bottom"):C>f.x?y.align="left":C<f.x&&(y.align="right")),m=C+("right"===y.align?-u:"left"===y.align?0:-u/2),b=w+("bottom"===y.baseline?-g:"top"===y.baseline?0:-g/2),(new Ge).set(m,b,m+u,b+g).rotate(c,m+u/2,b+g/2)}))})(t,i,e),n=Wt(r),l=Dt(r),d=Math.abs(l-n)*(h+s)/i.length,{step:u,delCount:g}=Yv(i,o,a,Math.floor(o.reduce(((t,e)=>Math.min(t,e.width(),e.height())),Number.MAX_VALUE)/d));c=t.stepTicks(u),c=c.slice(0,c.length-g)}else c=t.domain();return pv(c)},Yv=(t,e,i,r)=>{let o=r;do{let r=!0;o++;let n=0;do{n+o<t.length&&fv(e[n],e[n+o],i)&&(r=!1),n+=o}while(r&&n<t.length);if(r)break}while(o<=t.length);let n=0;if(t.length>2){let i=t.length-t.length%o;for(i>=t.length&&(i-=o);i>0&&fv(e[0],e[i]);)n++,i-=o}return{step:o,delCount:n}},qv=(t,e)=>{if(Cv(t.type))return((t,e)=>{var i,r,o,n;if(!Cv(t.type))return pv(t.domain());const s=t.range(),a=Math.abs(s[s.length-1]-s[0]);if(a<2)return pv([t.domain()[0]]);const{tickCount:l,forceTickCount:h,tickStep:c,noDecimals:d=!1,labelStyle:u,breakData:g}=e;let p;if(st(c))f=t.stepTicks(c),m=g&&g()?g().breakDomains:null,p=m&&m.length?f.filter((t=>m.every((e=>t<e[0]||t>e[1])))):f;else if(st(h))p=Nv(e,t,h,((e,i)=>i&&i.length?t.domain(i,!0).forceTicks(e):t.forceTicks(e)));else if("d3"===e.tickMode){const r=null!==(i=ot(l)?l({axisLength:a,labelStyle:u}):l)&&void 0!==i?i:5;p=Nv(e,t,r,((e,i)=>i&&i.length?t.domain(i,!0).d3Ticks(e,{noDecimals:d}):t.d3Ticks(e,{noDecimals:d})))}else{const i=null!==(r=ot(l)?l({axisLength:a,labelStyle:u}):l)&&void 0!==r?r:5,o=ot(e.tickMode)?e.tickMode:void 0;p=Nv(e,t,i,((e,i)=>i&&i.length?t.domain(i,!0).ticks(e,{noDecimals:d,customTicks:o}):t.ticks(e,{noDecimals:d,customTicks:o})))}var f,m;const b=t.domain();if(e.labelFirstVisible&&b[0]!==p[0]&&!p.includes(b[0])&&p.unshift(b[0]),e.labelLastVisible&&b[b.length-1]!==p[p.length-1]&&!p.includes(b[b.length-1])&&p.push(b[b.length-1]),e.sampling&&p.length>1&&("cartesian"===e.coordinateType||"polar"===e.coordinateType&&"radius"===e.axisOrientType)){const{labelGap:i=4,labelFlush:r}=e,s=6;let l;if(p.length*s>a){const i=[],r=Math.floor(p.length*s/a);p.forEach(((t,e)=>{e%r!=0&&e!==p.length-1||i.push(t)})),l=null===(o=bv(t,i,e))||void 0===o?void 0:o.map(((t,e)=>({AABBBounds:t,value:i[e]})))}else l=null===(n=bv(t,p,e))||void 0===n?void 0:n.map(((t,e)=>({AABBBounds:t,value:p[e]})));if(l){const t=l[0],o=Ot(l),n=g&&g()?jv.greedy:jv.parity;for(;l.length>=3&&sC(l,i);)l=n(l,i);const s=e.labelFirstVisible;let a=e.labelLastVisible;nC(t,o,i)&&l.includes(o)&&l.length>1&&s&&a&&(l.splice(l.indexOf(o),1),a=!1),Gv(t,l,s,(e=>nC(e,t,i))),Gv(o,l,a,(e=>nC(e,o,i)||!(!s||e===t)&&nC(e,t,i)),!0);const h=l.map((t=>t.value));h.length<3&&r&&(h.length>1&&h.pop(),Ot(h)!==Ot(p)&&h.push(Ot(p))),p=h}}return pv(p)})(t,e);if(function(t){switch(t){case yv.Ordinal:case yv.Point:case yv.Band:return!0;default:return!1}}(t.type)){if("cartesian"===e.coordinateType)return((t,e)=>{var i;const r=t.domain();if(!r.length)return[];const{tickCount:o,forceTickCount:n,tickStep:s,labelGap:a=4,axisOrientType:l,labelStyle:h}=e,c=(t=>["bottom","top","z"].includes(t))(l),d=t.range(),u=t.calculateWholeRangeSize();if(u<2)return e.labelLastVisible?pv([r[r.length-1]]):pv([r[0]]);let g;if(st(s))g=t.stepTicks(s);else if(st(n))g=t.forceTicks(n);else if(st(o)){const e=ot(o)?o({axisLength:u,labelStyle:h}):o;g=t.ticks(e)}else if(e.sampling){const o=(null!==(i=e.labelStyle.fontSize)&&void 0!==i?i:12)+2,n=Wt(d),s=Dt(d);if(r.length<=u/o){const i=Vv(t,r,e,c);if(i){const o=Math.min(...i.map((t=>t[2]))),l=(s-n)/r.length,h=$v(r,i,a,e.labelLastVisible,Math.floor(o/l),!1);g=t.stepTicks(h.step),e.labelLastVisible&&(h.delCount&&(g=g.slice(0,g.length-h.delCount)),g.push(r[r.length-1]))}}else{const i=[r[0],r[Math.floor(r.length/2)],r[r.length-1]],o=Vv(t,i,e,c);if(o){let i=null;o.forEach((t=>{i?i[2]<t[2]&&(i=t):i=t}));const l=s-n-a>0?Math.ceil(r.length*(a+i[2])/(s-n-a)):r.length-1;g=t.stepTicks(l),!e.labelLastVisible||g.length&&g[g.length-1]===r[r.length-1]||(g.length&&Math.abs(t.scale(g[g.length-1])-t.scale(r[r.length-1]))<i[2]&&(g=g.slice(0,-1)),g.push(r[r.length-1]))}}}return nt(g)&&(g=t.domain()),pv(g)})(t,e);if("polar"===e.coordinateType&&"angle"===e.axisOrientType)return Xv(t,e)}return pv(t.domain())};function Zv(){jb(),ny(),ay()}const Jv={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};Zv();class Qv extends jg{getCurrent(){return this._current}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},Qv.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=t=>{const e=t.target;e.hasState("disable")||e.addState("hover")},this._onUnHover=t=>{t.target.removeState("hover")},this._onClick=t=>{const e=t.target;if("preHandler"===e.name){if(1===this._current)return;this._current-=1,1===this._current?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:t})}if("nextHandler"===e.name){if(this._current===this._total)return;this._current+=1,this._current===this._total?e.addState("disable"):e.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:t})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:r="horizontal",handler:o=Jv,total:n,defaultCurrent:s=1,textStyle:a,padding:l=0}=this.attribute;this._current=s;const h=ni(l),c="horizontal"===r,d=Fh.group({x:0,y:0}),u=o.style||{},g=u.size||15,p=null!==(t=o.space)&&void 0!==t?t:8,f=o.state||{};let{preShape:m,nextShape:b}=o;m||(m=c?"triangleLeft":"triangleUp"),b||(b=c?"triangleRight":"triangleDown");const y=Fh.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:0,y:0,symbolType:m,size:g}));y.states=f,y.name="preHandler",this.preHandler=y,d.add(y);const{width:C,height:w}=_y(this._getPageText(n),Object.assign({textAlign:"center",textBaseline:"middle"},a),null===(i=null===(e=this.stage)||void 0===e?void 0:e.getTheme())||void 0===i?void 0:i.text),v=ft(g)?g:g[0],x=ft(g)?g:g[1],_=Fh.text(Object.assign({x:c?v/2+p+C/2:0,y:c?0:x/2+p+w/2,text:this._getPageText(s),textAlign:"center",textBaseline:"middle",lineHeight:null==a?void 0:a.fontSize},a));this.text=_,d.add(_);const S=Fh.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},u),{x:c?v+2*p+C:0,y:c?0:x+2*p+w,symbolType:b,size:g}));S.name="nextHandler",S.states=f,this.nextHandler=S,d.add(S),1===this._total?(y.addState("disable"),S.addState("disable")):1===this._current?y.addState("disable"):this._current===n&&S.addState("disable");const A=d.AABBBounds,T=A.width(),R=A.height();d.translateTo(0-A.x1+h[3],0-A.y1+h[0]),this.add(d),this.attribute.width=T+h[1]+h[3],this.attribute.height=R+h[0]+h[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?ot(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,1!==this._current&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}Qv.defaultAttributes={handler:Jv,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const tx=16,ex=8,ix=12;var rx,ox,nx;!function(t){t.selected="selected",t.unSelected="unSelected",t.selectedHover="selectedHover",t.unSelectedHover="unSelectedHover",t.focus="focus"}(rx||(rx={})),function(t){t.legendItemHover="legendItemHover",t.legendItemUnHover="legendItemUnHover",t.legendItemClick="legendItemClick",t.legendItemAttributeUpdate="legendItemAttributeUpdate"}(ox||(ox={})),function(t){t.innerView="innerView",t.title="legendTitle",t.item="legendItem",t.itemShape="legendItemShape",t.itemLabel="legendItemLabel",t.itemValue="legendItemValue",t.focus="legendItemFocus"}(nx||(nx={}));class sx extends jg{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=ni(i);const r=Fh.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});r.name=nx.innerView,this.add(r),this._innerView=r,(null==e?void 0:e.visible)&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const o=this._innerView.AABBBounds;this.attribute.width=o.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=o.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:r=0,background:o,minWidth:n,maxWidth:s,shape:a}=t,l={x:0,y:0,text:e,textStyle:i,padding:ni(r),minWidth:n,maxWidth:s};a&&a.visible&&(l.shape=Object.assign({visible:!0},a.style),st(a.space)&&(l.space=a.space)),o&&o.visible&&(l.panel=Object.assign({visible:!0},o.style));const h=new My(l);h.name=nx.title,this._title=h,this._innerView.add(h)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=null===(t=this.attribute.title)||void 0===t?void 0:t.align;"center"===r?this._title.setAttribute("x",(e-i)/2):"end"===r&&this._title.setAttribute("x",e-i)}}}function ax(){jb(),ay(),Qb(),ny()}function lx(){jb(),Ry()}var hx=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(i[r[o]]=t[r[o]])}return i};const cx={[rx.focus]:{},[rx.selected]:{},[rx.selectedHover]:{},[rx.unSelected]:{},[rx.unSelectedHover]:{}};lx(),Zv(),cy();class dx extends sx{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},dx.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=t=>{const e=t.target;if(e&&e.name&&e.name.startsWith(nx.item)){const i=e.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===i.id)return;this._unHover(this._lastActiveItem,t)}this._hover(i,t)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onUnHover=t=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,t),this._lastActiveItem=null)},this._onClick=t=>{var e,i,r,o;const n=t.target;if(n&&n.name&&n.name.startsWith(nx.item)){const s=n.delegate,{selectMode:a="multiple"}=this.attribute;if(n.name===nx.focus||"focus"===a){const r=s.hasState(rx.focus);s.toggleState(rx.focus),r?null===(e=this._itemsContainer)||void 0===e||e.getChildren().forEach((e=>{this._removeLegendItemState(e,[rx.unSelected,rx.unSelectedHover,rx.focus],t),this._setLegendItemState(e,rx.selected,t)})):(this._setLegendItemState(s,rx.selected,t),this._removeLegendItemState(s,[rx.unSelected,rx.unSelectedHover],t),null===(i=this._itemsContainer)||void 0===i||i.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[rx.selected,rx.selectedHover,rx.focus],t),this._setLegendItemState(e,rx.unSelected,t))})))}else{null===(r=this._itemsContainer)||void 0===r||r.getChildren().forEach((t=>{t.removeState(rx.focus)}));const{allowAllCanceled:e=!0}=this.attribute,i=s.hasState(rx.selected),n=this._getSelectedLegends();if("multiple"===a){if(!1===e&&i&&1===n.length)return void this._dispatchLegendEvent(ox.legendItemClick,s,t);i?(this._removeLegendItemState(s,[rx.selected,rx.selectedHover],t),this._setLegendItemState(s,rx.unSelected,t)):(this._setLegendItemState(s,rx.selected,t),this._removeLegendItemState(s,[rx.unSelected,rx.unSelectedHover],t))}else this._setLegendItemState(s,rx.selected,t),this._removeLegendItemState(s,[rx.unSelected,rx.unSelectedHover],t),null===(o=this._itemsContainer)||void 0===o||o.getChildren().forEach((e=>{s!==e&&(this._removeLegendItemState(e,[rx.selected,rx.selectedHover],t),this._setLegendItemState(e,rx.unSelected,t))}))}this._dispatchLegendEvent(ox.legendItemClick,s,t)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;(null===(e=this._itemsContainer)||void 0===e?void 0:e.getChildren()).forEach((e=>{const i=e.data;t.includes(i.label)?(this._setLegendItemState(e,rx.selected),this._removeLegendItemState(e,[rx.unSelected,rx.unSelectedHover])):(this._removeLegendItemState(e,[rx.selected,rx.selectedHover]),this._setLegendItemState(e,rx.unSelected))}))}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:r,defaultSelected:o,lazyload:n,autoPage:s}=this.attribute,{spaceCol:a=tx,spaceRow:l=ex,verticalAlign:h="middle"}=t,c=this._itemsContainer,{items:d,isHorizontal:u,startIndex:g,isScrollbar:p}=this._itemContext,f=p?1:u?i:e,m=this._contentMaxHeight;let b,{doWrap:y,maxWidthInCol:C,startX:w,startY:v,pages:x}=this._itemContext,_=0,S=0;const A=[];for(let t=g,e=d.length;t<e&&!(n&&x>this._itemContext.currentPage*f);t++){n&&(this._itemContext.startIndex=t+1),b=d[t],b.id||(b.id=b.label),b.index=t;let e=!0;ut(o)&&(e=o.includes(b.label));const i=this._renderEachItem(b,e,t,d),g=i.attribute.width,f=i.attribute.height;this._itemHeight=Math.max(this._itemHeight,f),C=Math.max(g,C),this._itemMaxWidth=Math.max(g,this._itemMaxWidth),u?(st(r)&&(p&&s?(x=Math.ceil((w+g)/r),y=x>1):w+g>r&&(y=!0,w>0&&("middle"!==h&&"bottom"!==h||A.forEach((t=>{t.setAttributes({y:t.attribute.y+(S-t.attribute.height)/("middle"===h?2:1)})})),x+=1,w=0,v+=S+l,S=0,A.length=0))),0===w&&0===v||i.setAttributes({x:w,y:v}),w+=a+g,S=Math.max(S,f),A.push(i)):(st(m)&&(p&&s?(x=Math.ceil((v+f)/m),y=x>1):m<=f?(x+=1,y=!0,v=0,t>0&&(w+=_+a)):m<v+f&&(x+=1,y=!0,v=0,w+=C+a,C=0)),0===w&&0===v||i.setAttributes({x:w,y:v}),v+=l+f),c.add(i),_=g}return!u||"middle"!==h&&"bottom"!==h||A.forEach((t=>{t.setAttributes({y:t.attribute.y+(S-t.attribute.height)/("middle"===h?2:1)})})),this._itemContext.doWrap=y,this._itemContext.startX=w,this._itemContext.startY=v,this._itemContext.maxWidthInCol=C,this._itemContext.pages=x,this._itemContext.maxPages=f,p&&(this._itemContext.totalPage=x),n||(this._itemContext.startIndex=d.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:r,maxHeight:o}=this.attribute;if(!1===t.visible||_t(e))return;let n=e;i&&(n=null==e?void 0:e.reverse()),this._contentMaxHeight=Math.max(0,o-this._parsedPadding[0]-this._parsedPadding[2]);const s=Fh.group({x:0,y:0});this._itemsContainer=s;const{layout:a,autoPage:l}=this.attribute,h="horizontal"===a,{maxWidth:c,width:d,height:u}=t,g=[];st(c)&&g.push(c),st(d)&&g.push(d),g.length&&(st(r)&&g.push(r),this._itemWidthByUser=Wt(g)),st(u)&&(this._itemHeightByUser=u);const p=this.attribute.pager;this._itemContext={currentPage:p&&p.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:n,isHorizontal:h,totalPage:1/0,isScrollbar:p&&"scrollbar"===p.type,clipContainer:void 0},this._itemContext=this._renderItems();let f=!1;this._itemContext.doWrap&&l&&this._itemContext.pages>this._itemContext.maxPages&&(f=this._renderPagerComponent()),f||(s.setAttribute("y",this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",8):0),this._innerView.add(s))}_bindEvents(){if(this.attribute.disableTriggerEvent)return;if(!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let e="pointermove",i="pointerleave";at(t)&&(t.trigger&&(e=t.trigger),t.triggerOff&&(i=t.triggerOff)),this._itemsContainer.addEventListener(e,this._onHover),this._itemsContainer.addEventListener(i,this._onUnHover)}if(e){let t="pointerdown";at(e)&&e.trigger&&(t=e.trigger),this._itemsContainer.addEventListener(t,this._onClick)}}_autoEllipsis(t,e,i,r){var o,n;const{label:s,value:a}=this.attribute.item,l=r.AABBBounds,h=i.AABBBounds,c=l.width(),d=h.width();let u=!1;"labelFirst"===t?d>e?u=!0:r.setAttribute("maxLineWidth",e-d):"valueFirst"===t?c>e?u=!0:i.setAttribute("maxLineWidth",e-c):c+d>e&&(u=!0),u&&(r.setAttribute("maxLineWidth",Math.max(e*(null!==(o=s.widthRatio)&&void 0!==o?o:.5),e-d)),i.setAttribute("maxLineWidth",Math.max(e*(null!==(n=a.widthRatio)&&void 0!==n?n:.5),e-c)))}_renderEachItem(t,e,i,r){var o,n;const{id:s,label:a,value:l,shape:h}=t,{padding:c=0,focus:d,focusIconStyle:u,align:g,autoEllipsisStrategy:p}=this.attribute.item,{shape:f,label:m,value:b,background:y}=this.attribute.item,C=this._handleStyle(f,t,e,i,r),w=this._handleStyle(m,t,e,i,r),v=this._handleStyle(b,t,e,i,r),x=this._handleStyle(y,t,e,i,r),_=ni(c);let S;!1===y.visible?(S=Fh.group({x:0,y:0,cursor:null===(o=x.style)||void 0===o?void 0:o.cursor}),this._appendDataToShape(S,nx.item,t,S)):(S=Fh.group(Object.assign({x:0,y:0},x.style)),this._appendDataToShape(S,nx.item,t,S,x.state)),S.id=`${null!=s?s:a}-${i}`,S.addState(e?rx.selected:rx.unSelected);const A=Fh.group({x:0,y:0,pickable:!1});S.add(A);let T,R=0,B=0,M=0;if(f&&!1!==f.visible){const i=St(C,"style.size",10);B=ut(i)?i[0]||0:i,M=St(f,"space",8);const r=Fh.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},h),C.style));Object.keys(C.state||{}).forEach((t=>{const e=C.state[t].fill||C.state[t].stroke;h.fill&&nt(C.state[t].fill)&&e&&(C.state[t].fill=e),h.stroke&&nt(C.state[t].stroke)&&e&&(C.state[t].stroke=e)})),this._appendDataToShape(r,nx.itemShape,t,S,C.state),r.addState(e?rx.selected:rx.unSelected),A.add(r)}let P=0;if(d){const e=St(u,"size",10);T=Fh.symbol(Object.assign(Object.assign({x:0,y:-e/2-1,strokeBoundsBuffer:0,boundsPadding:_},u),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(T,nx.focus,t,S),P=e}const H=m.formatMethod?m.formatMethod(a,t,i):a,k=Ty(Object.assign(Object.assign({x:B/2+M,y:0,textAlign:"start",textBaseline:"middle",lineHeight:null===(n=w.style)||void 0===n?void 0:n.fontSize},w.style),{text:H,_originText:m.formatMethod?a:void 0}));this._appendDataToShape(k,nx.itemLabel,t,S,w.state),k.addState(e?rx.selected:rx.unSelected),A.add(k);const E=St(m,"space",8);if(st(l)){const r=St(b,"space",d?8:0),o=b.formatMethod?b.formatMethod(l,t,i):l,n=Ty(Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:v.style.fontSize},v.style),{text:o,_originText:b.formatMethod?l:void 0}));if(this._appendDataToShape(n,nx.itemValue,t,S,v.state),n.addState(e?rx.selected:rx.unSelected),this._itemWidthByUser){const t=this._itemWidthByUser-_[1]-_[3]-B-M-E-P-r;this._autoEllipsis(p,t,k,n),b.alignRight?n.setAttributes({textAlign:"right",x:this._itemWidthByUser-B/2-_[1]-_[3]-P-r}):n.setAttribute("x",E+(k.AABBBounds.empty()?0:k.AABBBounds.x2))}else n.setAttribute("x",E+(k.AABBBounds.empty()?0:k.AABBBounds.x2));R=r+(n.AABBBounds.empty()?0:n.AABBBounds.x2),A.add(n)}else this._itemWidthByUser?(k.setAttribute("maxLineWidth",this._itemWidthByUser-_[1]-_[3]-B-M-P),R=E+(k.AABBBounds.empty()?0:k.AABBBounds.x2)):R=E+(k.AABBBounds.empty()?0:k.AABBBounds.x2);T&&(T.setAttribute("x",R),A.add(T));const F=A.AABBBounds,L=F.width();if("right"===g){const t=F.x2,e=F.x1;A.forEachChildren(((i,r)=>{"symbol"!==i.type&&"right"!==i.attribute.textAlign||i===T?i.setAttribute("x",e+t-i.attribute.x-i.AABBBounds.width()):"symbol"!==i.type?i.setAttributes({x:e+t-i.attribute.x,textAlign:"left"}):i.setAttribute("x",e+t-i.attribute.x)}))}const I=F.height(),z=st(this.attribute.item.width)?this.attribute.item.width:L+_[1]+_[3],O=this._itemHeightByUser||I+_[0]+_[2];return S.attribute.width=z,S.attribute.height=O,T&&T.setAttribute("visible",!1),A.translateTo(-F.x1+_[3],-F.y1+_[0]),S}_createPager(t){var e,i;const{disableTriggerEvent:r,maxRow:o}=this.attribute,n=t=>t<=99?99:t<=999?999:9999;return this._itemContext.isHorizontal?new Qv(Object.assign(Object.assign({layout:1===o?"horizontal":"vertical",total:n(this._itemContext.pages)},Ht({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:null===(e=this.attribute.pager)||void 0===e?void 0:e.defaultCurrent,disableTriggerEvent:r})):new Qv(Object.assign({layout:"horizontal",total:n(this._itemContext.pages),disableTriggerEvent:r,defaultCurrent:null===(i=this.attribute.pager)||void 0===i?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new by(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:!1===t.visible?0:12},t),{width:e})):new by(Object.assign(Object.assign({direction:"vertical",width:!1===t.visible?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:r}=this.attribute,{totalPage:o,isHorizontal:n}=this._itemContext,s=r&&r.position||"middle";if(this._pagerComponent.setTotal(o),n){let r;r="start"===s?t:"end"===s?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:r})}else{let t;t="start"===s?0:"end"===s?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:t,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,r=e.AABBBounds;let o,n;return t?(n=r.width(),o=n/i.width()):(n=r.height(),o=n/i.height()),o}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:r,currentPage:o,totalPage:n}=this._itemContext,s=(o-1)/n;this._pagerComponent.setScrollRange([s,s+this._computeScrollbarDelta()]),r?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:r=!0,animationDuration:o=450,animationEasing:n="quadIn"}=i,s=this._itemContext.isScrollbar?t=>{const{value:e}=t.detail;let i;return i=0===e[0]?1:1===e[1]?this._itemContext.totalPage:e[0]*this._itemContext.totalPage+1,i}:t=>t.detail.current,a=t=>{const e=this._pagerComponent,i=e.getScrollRange(),{direction:r}=e.attribute,{width:o,height:n}=e.getSliderRenderBounds(),s="vertical"===r?t.deltaY/n:t.deltaX/o;e.setScrollRange([i[0]+s,i[1]+s],!0),this.updateScrollMask()},l=i=>{const a=s(i);if(a!==this._itemContext.currentPage){if(this._itemContext.currentPage=a,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const t=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=t,this._itemContext.isScrollbar&&this._pagerComponent){const t=this._computeScrollbarDelta(),[e]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([e,e+t])}}if(this._itemContext.isScrollbar){const[t]=this._pagerComponent.getScrollRange();let i;i=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const s=i*t;this.updateScrollMask(),r?this._itemsContainer.animate().to({[e]:-s},o,n):this._itemsContainer.setAttribute(e,-s)}else r?this._itemsContainer.animate().to({[e]:-(a-1)*t},o,n):this._itemsContainer.setAttribute(e,-(a-1)*t)}};if(this._itemContext.isScrollbar){if(this._pagerComponent.addEventListener("scrollDrag",l),this._pagerComponent.addEventListener("scrollUp",l),this.attribute.pager.roamScroll){const t=50;this.addEventListener("wheel",(t=>t.nativeEvent.preventDefault())),this.addEventListener("wheel",ee(a,t))}}else this._pagerComponent.addEventListener("toPrev",l),this._pagerComponent.addEventListener("toNext",l)}_renderPager(){const t=this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:r=2,item:o={},pager:n={}}=this.attribute,{spaceCol:s=tx,spaceRow:a=ex}=o,l=this._itemsContainer,{space:h=ix,defaultCurrent:c=1}=n,d=hx(n,["space","defaultCurrent"]),{isHorizontal:u}=this._itemContext,g=this._contentMaxHeight;let p,f=0,m=0,b=0,y=0,C=0,w=0,v=1;if(u){if(m=(r-1)*a+this._itemHeight*r,f=e,p=this._createPager(d),this._pagerComponent=p,this._innerView.add(p),b=e-p.AABBBounds.width()-h,b<=0)return this._innerView.removeChild(p),!1;l.getChildren().forEach(((t,e)=>{const{width:i,height:r}=t.attribute;b<C+i&&(C=0,w+=r+a,v+=1),e>0&&t.setAttributes({x:C,y:w}),C+=s+i})),this._itemContext.startX=C,this._itemContext.startY=w,this._itemContext.pages=v;const i=Math.ceil(v/r);this._itemContext.totalPage=i,this._updatePositionOfPager(t,f,m)}else{if(f=this._itemMaxWidth*i+(i-1)*s,m=g,b=f,p=this._createPager(d),this._pagerComponent=p,this._innerView.add(p),y=g-p.AABBBounds.height()-h-t,y<=0)return this._innerView.removeChild(p),!1;l.getChildren().forEach(((t,e)=>{const{height:i}=t.attribute;y<w+i&&(w=0,C+=this._itemMaxWidth+s,v+=1),e>0&&t.setAttributes({x:C,y:w}),w+=a+i}));const e=Math.ceil(v/i);this._itemContext.totalPage=e,this._updatePositionOfPager(t,f,m)}c>1&&(u?l.setAttribute("y",-(c-1)*(m+a)):l.setAttribute("x",-(c-1)*(f+s)));const x=Fh.group({x:0,y:t,width:u?b:f,height:u?m:y,clip:!0,pickable:!1});return x.add(l),this._innerView.add(x),this._itemContext.clipContainer=x,this._bindEventsOfPager(u?m+a:f+s,u?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",8):0,{maxWidth:i,item:r={},pager:o={}}=this.attribute,{spaceCol:n=tx,spaceRow:s=ex}=r,a=this._itemsContainer,{space:l=ix,defaultCurrent:h=1}=o,c=hx(o,["space","defaultCurrent"]),{isHorizontal:d}=this._itemContext,u=this._contentMaxHeight;let g,p=0,f=0,m=0,b=1;if(d)p=i,f=this._itemHeight,g=this._createScrollbar(c,p),this._pagerComponent=g,this._innerView.add(g);else{if(f=u-e,p=this._itemMaxWidth,g=this._createScrollbar(c,f),this._pagerComponent=g,this._innerView.add(g),f<=0)return this._innerView.removeChild(g),!1;const t=a.getChildren(),i=t.map((t=>t.attribute.height));if(1===i.length||i.every((t=>t===i[0]))){const e=i[0],r=f,o=Math.floor(r/(s+e));f=o*(s+e),b=Math.ceil(t.length/o)}else t.forEach(((t,e)=>{const{height:i}=t.attribute,r=b,o=m;b=Math.floor((m+i)/f)+1,m+=s+i,r!==b&&e===a.getChildren().length-1&&m-f>=1/3*i&&(f=o+i,b-=1)}));this._itemContext.totalPage=b,this._itemContext.pages=b}if(h>1)if(d){const t=this._itemsContainer.AABBBounds.width()-p;a.setAttribute("x",-Math.min((h-1)*(p+n),t))}else{const t=this._itemsContainer.AABBBounds.height()-f;a.setAttribute("y",-Math.min((h-1)*(f+s),t))}const y=Fh.group({x:0,y:e,width:p,height:f,clip:!0,pickable:!1});return y.add(a),this._innerView.add(y),this._itemContext.clipContainer=y,this._updatePositionOfScrollbar(p,f,e),(null===(t=o.scrollMask)||void 0===t?void 0:t.visible)&&this.renderScrollMask(y),this._bindEventsOfPager(d?p:f,d?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:r=16,gradientStops:o}=e;if(!i||!o)return;const n=t.AABBBounds.width(),s=t.AABBBounds.height(),a=this._itemContext.isHorizontal?n:s,l=o.map((t=>({offset:r*t.offset/a,color:t.color}))),h=o.map((t=>({offset:(a-r*t.offset)/a,color:t.color}))),c=Fh.rect({x:0,y:0,width:n,height:s});this._scrollMask=c,this._scrollMaskContext={startStops:l,endStops:h},this.updateScrollMask(),t.add(c)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent)return;if(!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];Yt(Zt(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),Yt(Zt(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(rx.selected)?this._setLegendItemState(t,rx.selectedHover,e):this._setLegendItemState(t,rx.unSelectedHover,e);const i=t.getChildren()[0].find((t=>t.name===nx.focus),!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(ox.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(rx.unSelectedHover)||t.hasState(rx.selectedHover))&&(i=!0),t.removeState(rx.unSelectedHover),t.removeState(rx.selectedHover),t.getChildren()[0].getChildren().forEach((t=>{i||!t.hasState(rx.unSelectedHover)&&!t.hasState(rx.selectedHover)||(i=!0),t.removeState(rx.unSelectedHover),t.removeState(rx.selectedHover)}));const r=t.getChildren()[0].find((t=>t.name===nx.focus),!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(ox.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(ox.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let r=!1;t.hasState(e)||(r=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach((t=>{t.name!==nx.focus&&(r||t.hasState(e)||(r=!0),t.addState(e,!0))})),r&&this._dispatchLegendEvent(ox.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let r=!1;e.forEach((e=>{!r&&t.hasState(e)&&(r=!0),t.removeState(e)})),t.getChildren()[0].getChildren().forEach((t=>{t.name!==nx.focus&&e.forEach((e=>{!r&&t.hasState(e)&&(r=!0),t.removeState(e)}))})),r&&this._dispatchLegendEvent(ox.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return null===(t=this._itemsContainer)||void 0===t||t.getChildren().forEach((t=>{t.hasState(rx.selected)&&e.push(t.data)})),e}_appendDataToShape(t,e,i,r,o={}){t.name=e,t.data=i,t.delegate=r,t.states=Ht({},cx,o)}_dispatchLegendEvent(t,e,i){const r=this._getSelectedLegends();r.sort(((t,e)=>t.index-e.index));const o=r.map((t=>t.label));this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(rx.selected),currentSelectedItems:r,currentSelected:o,event:i})}_handleStyle(t,e,i,r,o){const n={};return t.style&&(ot(t.style)?n.style=t.style(e,i,r,o):n.style=t.style),t.state&&(n.state={},Object.keys(t.state).forEach((s=>{t.state[s]&&(ot(t.state[s])?n.state[s]=t.state[s](e,i,r,o):n.state[s]=t.state[s])}))),n}release(){super.release(),this.removeAllEventListeners()}}var ux;function gx(t){return ut(t)?t:[t,t]}function px(t){return t?"ew-resize":"ns-resize"}dx.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:tx,spaceRow:ex,shape:{space:8,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:8,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:10,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:ix,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0},function(t){t.innerView="innerView",t.railContainer="sliderRailContainer",t.rail="sliderRail",t.startText="sliderStartText",t.endText="sliderEndText",t.startHandler="sliderStartHandler",t.startHandlerText="startHandlerText",t.endHandler="sliderEndHandler",t.endHandlerText="sliderEndHandlerText",t.track="sliderTrack",t.trackContainer="sliderTrackContainer"}(ux||(ux={})),ax();class fx extends jg{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},fx.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=t=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(t),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=t=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const e=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),i=Zt(this._isHorizontal?(t.viewX-this._rail.globalAABBBounds.x1)/e:(t.viewY-this._rail.globalAABBBounds.y1)/e,0,1);i!==this._tooltipState.pos&&(this._tooltipState.pos=i,this._tooltipState.value=this.calculateValueByPos(i*e),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:t}=this.attribute;t&&t.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=t=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:e,y:i}=this.stage.eventPointTransform(t);this._currentHandler=t.target,this._prePos=this._isHorizontal?e:i;const r=fy(),o="browser"===ju.env?ju:this.stage;o.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),r.forEach((t=>{o.addEventListener(t,this._onHandlerPointerUp)}))},this._onHandlerPointerMove=t=>{var e,i;this._isChanging=!0;const{railWidth:r,railHeight:o,min:n,max:s}=this.attribute;if(s===n)return;const{x:a,y:l}=this.stage.eventPointTransform(t);let h,c,d,u=0;this._isHorizontal?(h=a,u=h-this._prePos,c=null===(i=this._currentHandler)||void 0===i?void 0:i.attribute.x,d=r):(h=l,u=h-this._prePos,c=null===(e=this._currentHandler)||void 0===e?void 0:e.attribute.y,d=o);const g=Zt(c+u,0,d),p=this.calculateValueByPos(g);"text"===this._currentHandler.type?this._updateHandlerText(this._currentHandler,g,p):this._updateHandler(this._currentHandler,g,p),this._updateTrack(),this._prePos=h,this._dispatchChangeEvent()},this._onHandlerPointerUp=t=>{this._isChanging=!1,this._currentHandler=null,this._clearAllDragEvents()},this._handleTouchMove=t=>{this._isChanging&&t.preventDefault()},this._onTrackPointerdown=t=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:e,y:i}=this.stage.eventPointTransform(t);this._prePos=this._isHorizontal?e:i;const r=fy(),o="browser"===ju.env?ju:this.stage;o.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),r.forEach((t=>{o.addEventListener(t,this._onTrackPointerUp)}))},this._onTrackPointerMove=t=>{this._isChanging=!0;const{railWidth:e,railHeight:i,min:r,max:o,inverse:n}=this.attribute;if(o===r)return;const{startHandler:s,endHandler:a}=this._getHandlers();let l,h,c;const{x:d,y:u}=this.stage.eventPointTransform(t);this._isHorizontal?(l=d,h=this._track.attribute.width,c=e):(l=u,h=this._track.attribute.height,c=i);const g=l-this._prePos;if(s){const t=this._isHorizontal?s.attribute.x:s.attribute.y,e=n?Zt(t+g,h,c):Zt(t+g,0,c-h),i=this.calculateValueByPos(e);this._updateHandler(s,e,i)}if(a){const t=this._isHorizontal?a.attribute.x:a.attribute.y,e=n?Zt(t+g,0,c-h):Zt(t+g,h,c),i=this.calculateValueByPos(e),r=null==s?void 0:s.attribute;this._updateHandler(a,e,i),this._track.setAttributes(this._isHorizontal?{x:Math.min(r.x,a.attribute.x),width:Math.abs(r.x-a.attribute.x)}:{y:Math.min(r.y,a.attribute.y),height:Math.abs(r.y-a.attribute.y)})}this._prePos=l,this._dispatchChangeEvent()},this._onTrackPointerUp=t=>{this._isChanging=!1,this._clearAllDragEvents()},this._onRailPointerDown=t=>{this._clearAllDragEvents(),this._isChanging=!0;const{railWidth:e,railHeight:i,min:r,max:o}=this.attribute;if(o===r)return;const n=this._startHandler,s=this._endHandler;let a,l,h;this._isHorizontal?(a=t.viewX-this._rail.globalAABBBounds.x1,l=null==n?void 0:n.attribute.x,h=null==s?void 0:s.attribute.x):(a=t.viewY-this._rail.globalAABBBounds.y1,l=null==n?void 0:n.attribute.y,h=null==s?void 0:s.attribute.y);const c=this.calculateValueByPos(a);if(st(h)){const t=Math.abs(a-l)>Math.abs(a-h)?s:n;this._updateHandler(t,a,c)}else this._updateHandler(n,a,c);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:r,railHeight:o,min:n,max:s,inverse:a}=this.attribute;let l=0;return l=n===s?"start"===e?0:"end"===e?1:0:(t-n)/(s-n),(a?1-l:l)*("vertical"===i?o:r)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:r,min:o,max:n,inverse:s}=this.attribute,a="vertical"===e?r:i;return o+(n-o)*(s?1-t/a:t/a)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[r,o]=zt(t),{startHandler:n,endHandler:s}=this._getHandlers();n&&this._updateHandler(n,this.calculatePosByValue(r),r),s&&this._updateHandler(s,this.calculatePosByValue(o),o),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:o,startText:n,endText:s,min:a,max:l,showHandler:h=!0,showTooltip:c}=this.attribute;let{value:d}=this.attribute;nt(d)&&(d=[a,l]),this._currentValue={startValue:gx(d)[0],endValue:gx(d)[1]};const u="horizontal"===i;this._isHorizontal=u;const g=Fh.group({x:0,y:0});g.name=ux.innerView,this.add(g),this._innerView=g;let p,f=0;if(n&&n.visible){p=Fh.text(Object.assign({x:u?0:r/2,y:u?o/2:0,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:n.text,lineHeight:null===(t=n.style)||void 0===t?void 0:t.fontSize},n.style)),p.name=ux.startText,g.add(p);const e=st(n.space)?n.space:0;f+=(u?p.AABBBounds.width():p.AABBBounds.height())+e}const m=Fh.group({x:u?f:0,y:u?0:f});g.add(m);const b=Fh.group({x:0,y:0});let y;if(b.name=ux.railContainer,this._railContainer=b,m.add(b),this._mainContainer=m,this._renderRail(b),f+=u?r:o,s&&s.visible){const t=st(s.space)?s.space:0;y=Fh.text(Object.assign({x:u?f+t:r/2,y:u?o/2:f+t,textAlign:u?"start":"center",textBaseline:u?"middle":"top",text:s.text,lineHeight:null===(e=s.style)||void 0===e?void 0:e.fontSize},s.style)),y.name=ux.endText,g.add(y)}this._renderTrack(b),h&&(this._renderHandlers(m),this._bindEvents()),c&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:r,slidable:o}=this.attribute;let n="default";!1!==o&&(n="pointer");const s=Fh.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:n},r));return s.name=ux.rail,t.add(s),this._rail=s,s}_renderHandlers(t){const{range:e,min:i,max:r,handlerSize:o=14,handlerStyle:n,handlerText:s,railHeight:a,railWidth:l,slidable:h}=this.attribute;let{value:c}=this.attribute;nt(c)&&(c=[i,r]);const d=s&&s.visible,u=this._isHorizontal,[g,p]=gx(c),f=this.calculatePosByValue(g,e?"start":"end"),m=this._renderHandler(Object.assign({x:u?f:l/2,y:u?a/2:f,size:o,strokeBoundsBuffer:0,cursor:!1===h?"default":px(u)},n));if(m.name=ux.startHandler,this._startHandler=m,t.add(m),this._currentValue.startPos=f,d){const i=this._renderHandlerText(g,e?"start":"end");i.name=ux.startHandlerText,t.add(i),this._startHandlerText=i}if(e){const e=this.calculatePosByValue(p,"end"),i=this._renderHandler(Object.assign({x:u?e:l/2,y:u?a/2:e,size:o,strokeBoundsBuffer:0,cursor:!1===h?"default":px(u)},n));if(i.name=ux.endHandler,this._endHandler=i,t.add(i),this._currentValue.endPos=e,d){const e=this._renderHandlerText(p,"end");e.name=ux.endHandlerText,t.add(e),this._endHandlerText=e}}}_renderTrack(t){const{range:e,min:i,max:r,railHeight:o,railWidth:n,trackStyle:s,railStyle:a,slidable:l,value:h}=this.attribute;let c,d;if(nt(h))e?(c=i,d=r):c=d=i;else if(e){const t=Jt(h,i,r);c=t[0],d=t[1]}else c=i,d=Zt(h,i,r);const u=this._isHorizontal;e||(c=i);const g=Fh.group({x:0,y:0,width:n,height:o,cornerRadius:null==a?void 0:a.cornerRadius,clip:!0,pickable:!1});g.name=ux.trackContainer;const p=at(e)&&!0===e.draggableTrack;let f;f=!1===l?"default":!1===e||!1===p?"pointer":px(u);const m=this.calculatePosByValue(c,"start"),b=this.calculatePosByValue(d,e?"end":"start"),y=Fh.rect(Object.assign({x:u?Math.min(m,b):0,y:u?0:Math.min(m,b),width:u?Math.abs(b-m):n,height:u?o:Math.abs(b-m),cursor:f},s));y.name=ux.track,this._track=y,g.add(y),t.add(g)}_renderHandler(t){return Fh.symbol(t)}_renderHandlerText(t,e){var i,r,o;const{align:n,handlerSize:s=14,handlerText:a={},railHeight:l,railWidth:h,slidable:c}=this.attribute,d=this._isHorizontal,u=this.calculatePosByValue(t,e),g=null!==(i=a.space)&&void 0!==i?i:4,p={text:a.formatter?a.formatter(t):t.toFixed(null!==(r=a.precision)&&void 0!==r?r:0),lineHeight:null===(o=a.style)||void 0===o?void 0:o.lineHeight,cursor:!1===c?"default":px(d)};return d?"top"===n?(p.textBaseline="bottom",p.textAlign="center",p.x=u,p.y=(l-s)/2-g):(p.textBaseline="top",p.textAlign="center",p.x=u,p.y=(l+s)/2+g):"left"===n?(p.textBaseline="middle",p.textAlign="end",p.x=(h-s)/2-g,p.y=u):(p.textBaseline="middle",p.textAlign="start",p.x=(h+s)/2+g,p.y=u),Fh.text(Object.assign(Object.assign({},p),a.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:r,align:o}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const n=this._isHorizontal?0:r/2,s=this._isHorizontal?i/2:0;if(e&&e.shape){const t=Fh.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:n,y:s,symbolType:"circle"},e.shapeStyle));this._tooltipShape=t,this._mainContainer.add(t)}const a=e&&e.text||{},l=null!==(t=a.space)&&void 0!==t?t:6,h={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(h.x=n,h.y="top"===o?s-i/2-l:s+i/2+l,h.textAlign="center",h.textBaseline="top"===o?"bottom":"top"):(h.y=s,h.x="left"===o?n-r/2-l:s+r/2+l,h.textAlign="left"===o?"end":"start",h.textBaseline="middle");const c=Fh.text(Object.assign(Object.assign({},h),a.style));this._mainContainer.add(c),this._tooltipText=c,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:r}=this.attribute,o=this._isHorizontal?i:r,n=this._tooltipState.pos*o,s=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[s]:n});const{align:a}=this.attribute;if(this._tooltipText){const i=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[s]:n,text:i.formatter?i.formatter(this._tooltipState.value):this._isHorizontal||"left"!==a?`≈ ${this._tooltipState.value.toFixed(null!==(e=i.precision)&&void 0!==e?e:0)}`:`${this._tooltipState.value.toFixed(null!==(t=i.precision)&&void 0!==t?t:0)} ≈`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),at(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown),("browser"===ju.env?ju:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_clearAllDragEvents(){const t=fy(),e="browser"===ju.env?ju:this.stage;e.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),t.forEach((t=>{e.removeEventListener(t,this._onHandlerPointerUp)})),e.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),t.forEach((t=>{e.removeEventListener(t,this._onTrackPointerUp)}))}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,r=this._startHandler,o=this._endHandler;if(this._isHorizontal){const i=null==r?void 0:r.attribute.x;if(o){const t=null==o?void 0:o.attribute.x;this._track.setAttributes({x:Math.min(i,t),width:Math.abs(i-t)})}else t?this._track.setAttributes({x:i,width:e-i}):this._track.setAttributes({width:i})}else{const e=null==r?void 0:r.attribute.y;if(o){const t=null==o?void 0:o.attribute.y;this._track.setAttributes({y:Math.min(e,t),height:Math.abs(e-t)})}else t?this._track.setAttributes({y:e,height:i-e}):this._track.setAttributes({height:e})}}_updateHandler(t,e,i){var r;const o=this._isHorizontal;t.setAttribute(o?"x":"y",e);const n=t.name===ux.startHandler?this._startHandlerText:this._endHandlerText;if(n){const{handlerText:t={}}=this.attribute;n.setAttributes({text:t.formatter?t.formatter(i):i.toFixed(null!==(r=t.precision)&&void 0!==r?r:0),[o?"x":"y"]:e})}t.name===ux.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var r;const o=this._isHorizontal,{handlerText:n={}}=this.attribute;t.setAttributes({[o?"x":"y"]:e,text:n.formatter?n.formatter(i):i.toFixed(null!==(r=n.precision)&&void 0!==r?r:0)});const s=t.name===ux.startHandlerText?this._startHandler:this._endHandler;s&&s.setAttributes({[o?"x":"y"]:e}),t.name===ux.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<(null==e?void 0:e.attribute.x)||t&&i.attribute.x>(null==e?void 0:e.attribute.x))&&([e,i]=[i,e]):(!t&&i.attribute.y<(null==e?void 0:e.attribute.y)||t&&i.attribute.y>(null==e?void 0:e.attribute.y))&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}release(t){super.release(t),("browser"===ju.env?ju:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearAllDragEvents()}}fx.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}},lx(),ax();class mx extends sx{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},mx.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=t=>{const e=this._slider.tooltipShape;if(e&&t.detail&&!nt(t.detail.value)){const i=this._colorScale.scale(t.detail.value);e.setAttribute("fill",i)}this.dispatchEvent(t)},this._onSliderChange=t=>{this._updateColor(),this.dispatchEvent(t)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:r,min:o,max:n,value:s,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:c,handlerStyle:d,railStyle:u,trackStyle:g,startText:p,endText:f,handlerText:m,showTooltip:b,tooltip:y,inverse:C,disableTriggerEvent:w}=this.attribute,v=[],x=(n-o)/(t.length-1);for(let e=0;e<t.length;e++)v.push(o+x*e);this._colorScale=(new Wv).domain(v,!0).range(t),this._color=this._getTrackColor();const _=new fx({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:r,min:o,max:n,value:s,railWidth:a,railHeight:l,showHandler:h,handlerSize:c,handlerStyle:d,railStyle:u,trackStyle:Object.assign({fill:this._color},g),startText:p,endText:f,handlerText:m,showTooltip:b,tooltip:y,disableTriggerEvent:w,inverse:C});this._innerView.add(_),this._slider=_,_.translateTo(0-_.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",12):0)-_.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(_t(t))return;const r=t.length;if(1===r)return t[0];const o=[];for(let e=0;e<r;e++){const i=e/(r-1);o.push({offset:i,color:t[e]})}const n="horizontal"===e,s={gradient:"linear",stops:o,x0:0,y0:0,x1:n?1:0,y1:n?0:1};return i&&(n?(s.x0=1,s.x1=0):(s.y0=1,s.y1=0)),s}_updateColor(){var t;const{layout:e="horizontal",colors:i,railWidth:r,railHeight:o}=this.attribute,{startHandler:n,endHandler:s,track:a,attribute:l}=this._slider,{startValue:h,endValue:c,startPos:d,endPos:u}=this._slider.currentValue,g=null===(t=l.handlerStyle)||void 0===t?void 0:t.fill;if(n&&!g){const t=this._colorScale.scale(h);n.setAttribute("fill",t)}if(s&&!g){const t=this._colorScale.scale(c);s.setAttribute("fill",t)}const p="horizontal"===e?r:o;if(Math.abs(d-u)!==p&&i&&i.length>1){const t=this._color.stops,e=Math.min(d,u),i=Math.max(d,u),r=e/p,o=i/p,n=o-r,s=t.filter((t=>t.offset>r&&t.offset<o)),l=Math.min(h,c),g=Math.max(h,c),f=this._colorScale.scale(l),m=this._colorScale.scale(g),b=[{offset:0,color:f}];s.forEach((t=>{b.push({offset:(t.offset-r)/n,color:t.color})})),b.push({offset:1,color:m}),a.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:b}))}}}function bx(t="bottom"){let e=0;return"top"===t?`\n    M${e},-6L${e-3.5},-2.5\n    v5\n    h7\n    v-5\n    Z\n`:"left"===t?(e=1,`\n    M${e-6},0L${e-6+2.5},-3.5\n    h5\n    v7\n    h-5\n    Z\n`):"right"===t?(e=-1,`\n    M${e+6},0L${e+6-2.5},-3.5\n    h-5\n    v7\n    h5\n    Z\n  `):`\n    M${e},6L${e-3.5},2.5\n    v-5\n    h7\n    v5\n    Z\n`}mx.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}},lx(),ax(),Yb();class yx extends sx{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},yx.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=t=>{this.dispatchEvent(t)},this._onSliderToolipChange=t=>{this.dispatchEvent(t)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:r,max:o,value:n,railWidth:s,railHeight:a,showHandler:l=!0,handlerSize:h,handlerStyle:c,railStyle:d,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:m,tooltip:b,sizeBackground:y,disableTriggerEvent:C,inverse:w}=this.attribute,v=Fh.group({x:0,y:0});this._innerView.add(v);const x=new fx({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:r,max:o,value:n,railWidth:s,railHeight:a,showHandler:l,handlerSize:h,handlerStyle:Object.assign({symbolType:bx(i)},c),railStyle:d,trackStyle:u,startText:g,endText:p,handlerText:f,showTooltip:m,tooltip:b,disableTriggerEvent:C,inverse:w});v.add(x);let _,S=0;"horizontal"===e?"top"===i?(_=`M0,0L${s},0L${w?0:s},12Z`,S=a):(_=`M0,12L${s},12L${w?0:s},0Z`,x.setAttribute("y",12)):"left"===i?_=`M${s},0L${s+12},${w?0:a}L${s},${a}Z`:(_=`M0,${w?0:a}L12,${a}L12,0Z`,x.setAttribute("x",12));const A=Fh.path(Object.assign(Object.assign({x:0,y:S,path:_},y),{zIndex:0}));v.add(A);const T=this._title?this._title.AABBBounds.height()+St(this.attribute,"title.space",12):0;v.translate(0-v.AABBBounds.x1,T-v.AABBBounds.y1),this._slider=x}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}yx.defaultAttributes={layout:"horizontal",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}},jb(),ay(),ey();let Cx=class t extends jg{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Ht({},t.defaultAttributes,e)),this.name="title"}render(){var t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y,C;const{textType:w,text:v,subtextType:x,textStyle:_={},subtext:S,subtextStyle:A={},width:T,height:R,minWidth:B,maxWidth:M,minHeight:P,maxHeight:H,align:k,verticalAlign:E,padding:F=0}=this.attribute,L=ni(F),I=this.createOrUpdateChild("title-container",{x:L[3],y:L[0],zIndex:1},"group"),z=null!==(t=_.height)&&void 0!==t?t:R;if(!1!==this.attribute.visible&&!1!==_.visible){const{width:t,maxHeight:a,maxWidth:l,x:h=0,y:c=0,ellipsis:d=!0,wordBreak:u="break-word",maxWidth:g,lineClamp:p}=_;if("rich"===w||st(_.character)){const r=Object.assign({x:h,y:c,width:null!==(e=null!=t?t:T)&&void 0!==e?e:0,height:null!=z?z:0,ellipsis:null==d||d,wordBreak:null!=u?u:"break-word",maxHeight:null!=a?a:H,maxWidth:null!=l?l:g,textConfig:null!==(i=_.character)&&void 0!==i?i:v},_);this._mainTitle=I.createOrUpdateChild("mainTitle",r,"richtext")}else if("html"===w){const e=Object.assign({html:Object.assign(Object.assign({dom:v},py),_),x:h,y:c,width:null!==(r=null!=t?t:T)&&void 0!==r?r:0,height:null!=z?z:0,ellipsis:d,wordBreak:u,maxHeight:null!=a?a:H,maxWidth:null!=l?l:g,textConfig:[]},_);this._mainTitle=I.createOrUpdateChild("mainTitle",e,"richtext")}else st(v)&&(this._mainTitle=I.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:ut(v)?v:[v],whiteSpace:"normal"},_),{maxLineWidth:null!==(n=null!==(o=_.maxLineWidth)&&void 0!==o?o:t)&&void 0!==n?n:T,heightLimit:null!==(s=_.height)&&void 0!==s?s:H,lineClamp:p,ellipsis:d,x:h,y:c}),"text"))}const O=this._mainTitle?this._mainTitle.AABBBounds.height():0,D=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(!1!==this.attribute.visible&&!1!==A.visible){const{width:t,height:e,maxWidth:i,maxHeight:r,x:o=0,y:n=0,ellipsis:s=!0,wordBreak:p="break-word",lineClamp:f}=A,m=Math.max(Number.MIN_VALUE,H-O);if("rich"===x||st(A.character)){const c=Object.assign({x:o,y:n,width:null!==(a=null!=t?t:T)&&void 0!==a?a:0,height:null!==(l=null!=e?e:R)&&void 0!==l?l:0,ellipsis:s,wordBreak:p,maxHeight:null!=r?r:m,maxWidth:null!=i?i:M,textConfig:null!==(h=A.character)&&void 0!==h?h:S},A);this._subTitle=I.createOrUpdateChild("subTitle",c,"richtext")}else if("html"===x){const a=Object.assign({html:Object.assign(Object.assign({dom:S},py),A),x:o,y:n,width:null!==(c=null!=t?t:T)&&void 0!==c?c:0,height:null!==(d=null!=e?e:R)&&void 0!==d?d:0,ellipsis:s,wordBreak:p,maxHeight:null!=r?r:m,maxWidth:null!=i?i:M,textConfig:[]},A);this._subTitle=I.createOrUpdateChild("subTitle",a,"richtext")}else st(S)&&(this._subTitle=I.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:ut(S)?S:[S],whiteSpace:"normal"},A),{maxLineWidth:null!==(u=A.maxLineWidth)&&void 0!==u?u:T,heightLimit:null!==(g=A.heightLimit)&&void 0!==g?g:m,lineClamp:f,ellipsis:s,x:0,y:O}),"text"))}const W=this._subTitle?this._subTitle.AABBBounds.height():0,N=this._subTitle?this._subTitle.AABBBounds.width():0;let G=Math.max(D,N),j=O+(null!==(p=A.height)&&void 0!==p?p:W);if(st(T)&&(G=T),st(R)&&(j=R),st(B)&&G<B&&(G=B),st(M)&&G>M&&(G=M),st(P)&&j<P&&(j=P),st(H)&&j>H&&(j=H),I.attribute.width=G,I.attribute.height=j,I.attribute.boundsPadding=L,this._mainTitle){if(st(k)||st(_.align)){const t=_.align?_.align:k,e=null!==(f=_.width)&&void 0!==f?f:G;"center"===t?(this._mainTitle.setAttribute("x",e/2),this._mainTitle.setAttribute("textAlign","center")):"right"===t?(this._mainTitle.setAttribute("x",e),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}const t=_.verticalAlign?_.verticalAlign:E,e=null!=z?z:this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height();"middle"===t?(this._mainTitle.setAttribute("y",e/2),this._mainTitle.setAttribute("textBaseline","middle")):"bottom"===t?(this._mainTitle.setAttribute("y",e),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}if(this._subTitle){if(st(k)||st(A.align)){const t=A.align?A.align:k,e=null!==(b=null!==(m=A.width)&&void 0!==m?m:_.width)&&void 0!==b?b:G;"center"===t?(this._subTitle.setAttribute("x",e/2),this._subTitle.setAttribute("textAlign","center")):"right"===t?(this._subTitle.setAttribute("x",e),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}const t=A.verticalAlign?A.verticalAlign:E,e=this._mainTitle?st(z)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height(),z):this._mainTitle.AABBBounds.y2:0,i=null!==(C=null!==(y=A.height)&&void 0!==y?y:R)&&void 0!==C?C:this._subTitle.AABBBounds.empty()?0:this._subTitle.AABBBounds.height();"middle"===t?(this._subTitle.setAttribute("y",e+i/2),this._subTitle.setAttribute("textBaseline","middle")):"bottom"===t?(this._subTitle.setAttribute("y",e+i),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",e),this._subTitle.setAttribute("textBaseline","top"))}}};Cx.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};jb(),Qb(),ay(),Ub();class wx extends jg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},wx.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new lh(Ht({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t?this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}):this.attribute.disabled&&this._box.setAttributes({fill:this.attribute.box.disableFill}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new ph(Ht({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new ph(Ht({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new ql(Ht({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),r=Math.max(t,e,i),o=r/2-t/2,n=r/2-e/2,s=r/2-i/2,a=this.attribute.box.width,l=this.attribute.icon.width,h=Math.max(a,l),c=h/2-a/2,d=h/2-l/2,u=h+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:c,y:o}),this._checkIcon.setAttributes({x:d,y:n}),this._indeterminateIcon.setAttributes({x:d,y:n}),this._text.setAttributes({x:u,y:s})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Ht({},wx.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}wx.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:'<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',indeterminateIconImage:'<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>',width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}},jb(),Qb(),hy(),Ub();class vx extends jg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},vx.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new Rh(Ht({},this.attribute.circle));const t=this.attribute.checked;t&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):t?this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}):this.attribute.disabled&&this._circle.setAttributes({fill:this.attribute.circle.disableFill}),this.appendChild(this._circle)}renderText(){this._text=new ql(Ht({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),e=this._text.AABBBounds.height(),i=Math.max(t,e),r=i/2-t/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,o=i/2-e/2,n=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),s=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,a=n+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:s,y:r}),this._text.setAttributes({x:a,y:o})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Ht({},vx.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}vx.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};jb(),ay(),Ub();let xx=class t extends jg{constructor(e,i){super((null==i?void 0:i.skipDefault)?e:Ht({},t.defaultAttributes,e))}render(){this.removeAllChild(!0),this.renderIcon(),this.renderText(),this.layout()}renderIcon(){this._emptyTipIcon=new ph(Ht({image:this.attribute.icon.image},this.attribute.icon)),this.appendChild(this._emptyTipIcon)}renderText(){this._text=new ql(Ht({wrap:!0},this.attribute.text)),this.appendChild(this._text)}layout(){const t=this.attribute.icon.height,e=this._text.AABBBounds.height(),i=this.attribute.icon.width,{width:r,height:o,spaceBetweenTextAndIcon:n}=this.attribute;this._emptyTipIcon.setAttribute("x",r/2-i/2),this._emptyTipIcon.setAttribute("y",o/2-t/2-e/2-n/2),this._text.setAttribute("x",r/2),this._text.setAttribute("textAlign","center"),this._text.setAttribute("y",o/2+t/2+n/2),this._text.setAttribute("textBaseline","middle")}};xx.defaultAttributes={spaceBetweenTextAndIcon:20,text:{text:"no data",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",pickable:!1},icon:{image:'<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>',width:100,height:100,pickable:!1}},jb(),Qb(),ay(),Nb();class _x extends jg{constructor(t,e){super((null==e?void 0:e.skipDefault)?t:Ht({},_x.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?this.setAttribute("checked",!1):this.setAttribute("checked",!0),this._dispatchEvent("switch_state_change",{eventType:"switch_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(t,e,i)=>{"interactive"in t&&this.setAttribute("pickable",t.interactive),"disabled"in t&&this.setAttribute("cursor",t.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderCircle(),this.renderText(),this.layout()}renderBox(){this._box=new lh(Ht({},this.attribute.box)),this.attribute.disabled&&this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill}):this.attribute.disabled&&!this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableUncheckedFill}):this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.checkedFill}):this._box.setAttributes({fill:this.attribute.box.uncheckedFill}),this.appendChild(this._box)}renderCircle(){this._circle=new Kl(Ht({},this.attribute.circle)),this.appendChild(this._circle)}renderText(){var t,e,i;this._text=new ql(Ht({},null!==(t=this.attribute.text)&&void 0!==t?t:{})),this.attribute.checked&&(null===(e=this.attribute.text)||void 0===e?void 0:e.checkedText)?this._text.setAttributes({text:this.attribute.text.checkedText}):(null===(i=this.attribute.text)||void 0===i?void 0:i.uncheckedText)&&this._text.setAttributes({text:this.attribute.text.uncheckedText}),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){var t,e,i,r,o,n,s,a,l,h;const c=this.attribute.spaceBetweenTextAndCircle,d=this.attribute.circle.radius,u=this.attribute.box.height,g=2*d,p=this._text.AABBBounds.height(),f=Math.max(u,g,p),m=f/2-g/2+d,b=f/2-p/2,y=this.attribute.box.width,C=2*d,w=_y((null!==(i=null===(e=null===(t=this.attribute.text)||void 0===t?void 0:t.checkedText)||void 0===e?void 0:e.length)&&void 0!==i?i:0)>(null!==(n=null===(o=null===(r=this.attribute.text)||void 0===r?void 0:r.uncheckedText)||void 0===o?void 0:o.length)&&void 0!==n?n:0)?null!==(a=null===(s=this.attribute.text)||void 0===s?void 0:s.checkedText)&&void 0!==a?a:"":null!==(h=null===(l=this.attribute.text)||void 0===l?void 0:l.uncheckedText)&&void 0!==h?h:"",this._text.attribute).width,v=Math.max(y,C+w+3*c),x=u/2-C/2+d,_=x+d+c;this._box.setAttributes({width:v,height:f}),this._circle.setAttributes({y:m,x:this.attribute.checked?v-x:x}),this._text.setAttributes({x:this.attribute.checked?v-_-w:_,y:b})}initAttributes(t,e){t=(null==e?void 0:e.skipDefault)?t:Ht({},_x.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}_x.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",circle:{radius:8,fill:"#FFF",pickable:!1},box:{width:40,height:24,cornerRadius:12,uncheckedFill:"rgb(201,205,212)",checkedFill:"#165DFF",disableUncheckedFill:"rgb(242,243,245)",disableCheckedFill:"rgb(148,191,255)",pickable:!1},text:{textAlign:"left",textBaseline:"top",pickable:!1},spaceBetweenTextAndCircle:6};let Sx=!1;function Ax(){Sx||(Sx=!0,Gu(),ig()?Xp(so):function(){eg();const t=D.global&&D.global.env;return t?"node"===t:!tg}()&&um(so),Db(),Nb(),jb(),Ub(),$b(),Qb(),ey(),ry(),ny(),ay(),Ng(),so.load(Ky),Ng())}var Tx,Rx;!function(t){t.default="default",t.grabing="grabing",t.scrolling="scrolling"}(Tx||(Tx={})),function(t){t.single="single",t.column="column",t.row="row",t.cross="cross",t.none="none"}(Rx||(Rx={}));const Bx=["bgColor","color","strokeColor","borderColor","linkColor"];var Mx,Px,Hx,kx,Ex,Fx,Lx;!function(t){t.RECORD="RECORD",t.NONE="NONE",t.SUM="SUM",t.MIN="MIN",t.MAX="MAX",t.AVG="AVG",t.COUNT="COUNT",t.CUSTOM="CUSTOM",t.RECALCULATE="RECALCULATE"}(Mx||(Mx={})),function(t){t.ASC="ASC",t.DESC="DESC",t.NORMAL="NORMAL",t.desc="desc",t.asc="asc",t.normal="normal"}(Px||(Px={})),function(t){t.top="top",t.bottom="bottom",t.left="left",t.right="right"}(Hx||(Hx={})),function(t){t.expand="expand",t.collapse="collapse",t.none="none",t.loading="loading"}(kx||(kx={})),function(t){t.inlineFront="inlineFront",t.inlineEnd="inlineEnd",t.left="left",t.right="right",t.absoluteRight="absoluteRight",t.contentLeft="contentLeft",t.contentRight="contentRight",t.absolute="absolute"}(Ex||(Ex={})),function(t){t.frozen="frozen",t.sort="sort",t.dropDown="dropDown",t.dropDownState="dropDownState",t.play="play",t.damagePic="damagePic",t.expand="expand",t.collapse="collapse",t.drillDown="drillDown",t.drillUp="drillUp",t.dragReorder="dragReorder"}(Fx||(Fx={})),function(t){t.upwardIconName="sort_upward",t.downwardIconName="sort_downward",t.normalIconName="sort_normal",t.freezeIconName="freeze",t.frozenIconName="frozen",t.frozenCurrentIconName="frozenCurrent",t.dropdownIconName="dropdownIcon",t.expandIconName="expand",t.collapseIconName="collapse",t.dragReorderIconName="dragReorder",t.loadingIconName="loading"}(Lx||(Lx={}));var Ix=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var zx=(t,e=!1)=>e?"boolean"==typeof t:!0===t||!1===t||Ix(t,"Boolean");var Ox=t=>"function"==typeof t;var Dx=t=>null==t;var Wx=t=>null!=t;var Nx=t=>{const e=typeof t;return null!==t&&"object"===e||"function"===e};var Gx=t=>"object"==typeof t&&null!==t;var jx=function(t){if(!Gx(t)||!Ix(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var Vx=(t,e=!1)=>{const i=typeof t;return e?"string"===i:"string"===i||Ix(t,"String")};var Ux=t=>Array.isArray?Array.isArray(t):Ix(t,"Array");var Kx=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var $x=t=>Ix(t,"Date");var Xx=(t,e=!1)=>{const i=typeof t;return e?"number"===i:"number"===i||Ix(t,"Number")};var Yx=t=>Xx(t)&&Number.isFinite(t);var qx=t=>({}.toString.call(t).replace(/^\[object /,"").replace(/]$/,""));const Zx=Object.prototype;var Jx=function(t){const e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Zx)};const Qx=Object.prototype.hasOwnProperty;function t_(t){if(Dx(t))return!0;if(Kx(t))return!t.length;const e=qx(t);if("Map"===e||"Set"===e)return!t.size;if(Jx(t))return!Object.keys(t).length;for(const e in t)if(Qx.call(t,e))return!1;return!0}var e_=(t,e,i)=>{const r=Vx(e)?e.split("."):e;for(let e=0;e<r.length;e++)t=t?t[r[e]]:void 0;return void 0===t?i:t};function i_(t,e,i){let r;if(!Wx(t)||"object"!=typeof t||e&&e(t))return t;const o=Ux(t),n=t.length;r=o?new Array(n):"object"==typeof t?{}:zx(t)||Xx(t)||Vx(t)?t:$x(t)?new Date(+t):void 0;const s=o?void 0:Object.keys(Object(t));let a=-1;if(r)for(;++a<(s||t).length;){const o=s?s[a]:a,n=t[o];i&&i.includes(o.toString())?r[o]=n:r[o]=i_(n,e,i)}return r}function r_(t,e,i=!1,r=!1){if(e){if(t===e)return;if(Wx(e)&&"object"==typeof e){const o=Object(e),n=[];for(const t in o)n.push(t);let{length:s}=n,a=-1;for(;s--;){const s=n[++a];!Wx(o[s])||"object"!=typeof o[s]||r&&Ux(t[s])?n_(t,s,o[s]):o_(t,e,s,i,r)}}}}function o_(t,e,i,r=!1,o=!1){const n=t[i],s=e[i];let a=e[i],l=!0;if(Ux(s)){if(r)a=[];else if(Ux(n))a=n;else if(Kx(n)){a=new Array(n.length);let t=-1;const e=n.length;for(;++t<e;)a[t]=n[t]}}else jx(s)?(a=null!=n?n:{},"function"!=typeof n&&"object"==typeof n||(a={})):l=!1;l&&r_(a,s,r,o),n_(t,i,a)}function n_(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function s_(t,...e){let i=-1;const r=e.length;for(;++i<r;)r_(t,e[i],!0);return t}function a_(t){return Object.prototype.toString.call(t)}function l_(t){return Object.keys(t)}function h_(t,e,i){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(null==t||null==e)return!1;if(Number.isNaN(t)&&Number.isNaN(e))return!0;if(a_(t)!==a_(e))return!1;if(Ox(t))return!!(null==i?void 0:i.skipFunction);if("object"!=typeof t)return!1;if(Ux(t)){if(t.length!==e.length)return!1;for(let r=t.length-1;r>=0;r--)if(!h_(t[r],e[r],i))return!1;return!0}if(!jx(t))return!1;const r=l_(t),o=l_(e);if(r.length!==o.length)return!1;r.sort(),o.sort();for(let t=r.length-1;t>=0;t--)if(r[t]!=o[t])return!1;for(let o=r.length-1;o>=0;o--){const n=r[o];if(!h_(t[n],e[n],i))return!1}return!0}function c_(t){return t*(Math.PI/180)}const d_=t=>{let e=t.charCodeAt(0),i=2===t.length?t.charCodeAt(1):0,r=e;return 55296<=e&&e<=56319&&56320<=i&&i<=57343&&(e&=1023,i&=1023,r=e<<10|i,r+=65536),12288===r||65281<=r&&r<=65376||65504<=r&&r<=65510?"F":8361===r||65377<=r&&r<=65470||65474<=r&&r<=65479||65482<=r&&r<=65487||65490<=r&&r<=65495||65498<=r&&r<=65500||65512<=r&&r<=65518?"H":4352<=r&&r<=4447||4515<=r&&r<=4519||4602<=r&&r<=4607||9001<=r&&r<=9002||11904<=r&&r<=11929||11931<=r&&r<=12019||12032<=r&&r<=12245||12272<=r&&r<=12283||12289<=r&&r<=12350||12353<=r&&r<=12438||12441<=r&&r<=12543||12549<=r&&r<=12589||12593<=r&&r<=12686||12688<=r&&r<=12730||12736<=r&&r<=12771||12784<=r&&r<=12830||12832<=r&&r<=12871||12880<=r&&r<=13054||13056<=r&&r<=19903||19968<=r&&r<=42124||42128<=r&&r<=42182||43360<=r&&r<=43388||44032<=r&&r<=55203||55216<=r&&r<=55238||55243<=r&&r<=55291||63744<=r&&r<=64255||65040<=r&&r<=65049||65072<=r&&r<=65106||65108<=r&&r<=65126||65128<=r&&r<=65131||110592<=r&&r<=110593||127488<=r&&r<=127490||127504<=r&&r<=127546||127552<=r&&r<=127560||127568<=r&&r<=127569||131072<=r&&r<=194367||177984<=r&&r<=196605||196608<=r&&r<=262141?"W":32<=r&&r<=126||162<=r&&r<=163||165<=r&&r<=166||172===r||175===r||10214<=r&&r<=10221||10629<=r&&r<=10630?"Na":161===r||164===r||167<=r&&r<=168||170===r||173<=r&&r<=174||176<=r&&r<=180||182<=r&&r<=186||188<=r&&r<=191||198===r||208===r||215<=r&&r<=216||222<=r&&r<=225||230===r||232<=r&&r<=234||236<=r&&r<=237||240===r||242<=r&&r<=243||247<=r&&r<=250||252===r||254===r||257===r||273===r||275===r||283===r||294<=r&&r<=295||299===r||305<=r&&r<=307||312===r||319<=r&&r<=322||324===r||328<=r&&r<=331||333===r||338<=r&&r<=339||358<=r&&r<=359||363===r||462===r||464===r||466===r||468===r||470===r||472===r||474===r||476===r||593===r||609===r||708===r||711===r||713<=r&&r<=715||717===r||720===r||728<=r&&r<=731||733===r||735===r||768<=r&&r<=879||913<=r&&r<=929||931<=r&&r<=937||945<=r&&r<=961||963<=r&&r<=969||1025===r||1040<=r&&r<=1103||1105===r||8208===r||8211<=r&&r<=8214||8216<=r&&r<=8217||8220<=r&&r<=8221||8224<=r&&r<=8226||8228<=r&&r<=8231||8240===r||8242<=r&&r<=8243||8245===r||8251===r||8254===r||8308===r||8319===r||8321<=r&&r<=8324||8364===r||8451===r||8453===r||8457===r||8467===r||8470===r||8481<=r&&r<=8482||8486===r||8491===r||8531<=r&&r<=8532||8539<=r&&r<=8542||8544<=r&&r<=8555||8560<=r&&r<=8569||8585===r||8592<=r&&r<=8601||8632<=r&&r<=8633||8658===r||8660===r||8679===r||8704===r||8706<=r&&r<=8707||8711<=r&&r<=8712||8715===r||8719===r||8721===r||8725===r||8730===r||8733<=r&&r<=8736||8739===r||8741===r||8743<=r&&r<=8748||8750===r||8756<=r&&r<=8759||8764<=r&&r<=8765||8776===r||8780===r||8786===r||8800<=r&&r<=8801||8804<=r&&r<=8807||8810<=r&&r<=8811||8814<=r&&r<=8815||8834<=r&&r<=8835||8838<=r&&r<=8839||8853===r||8857===r||8869===r||8895===r||8978===r||9312<=r&&r<=9449||9451<=r&&r<=9547||9552<=r&&r<=9587||9600<=r&&r<=9615||9618<=r&&r<=9621||9632<=r&&r<=9633||9635<=r&&r<=9641||9650<=r&&r<=9651||9654<=r&&r<=9655||9660<=r&&r<=9661||9664<=r&&r<=9665||9670<=r&&r<=9672||9675===r||9678<=r&&r<=9681||9698<=r&&r<=9701||9711===r||9733<=r&&r<=9734||9737===r||9742<=r&&r<=9743||9748<=r&&r<=9749||9756===r||9758===r||9792===r||9794===r||9824<=r&&r<=9825||9827<=r&&r<=9829||9831<=r&&r<=9834||9836<=r&&r<=9837||9839===r||9886<=r&&r<=9887||9918<=r&&r<=9919||9924<=r&&r<=9933||9935<=r&&r<=9953||9955===r||9960<=r&&r<=9983||10045===r||10071===r||10102<=r&&r<=10111||11093<=r&&r<=11097||12872<=r&&r<=12879||57344<=r&&r<=63743||65024<=r&&r<=65039||65533===r||127232<=r&&r<=127242||127248<=r&&r<=127277||127280<=r&&r<=127337||127344<=r&&r<=127386||917760<=r&&r<=917999||983040<=r&&r<=1048573||1048576<=r&&r<=1114109?"A":"N"};class u_{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet="-/: .,@%'\"~",this._option=t,this._userSpec=null!=e?e:{},this.textSpec=this._initSpec(),Wx(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=Wx(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(Dx(this._canvas)&&(Wx(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),Dx(this._canvas)&&"undefined"!=typeof window&&void 0!==window.document&&globalThis&&Wx(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),Dx(this._context)&&Wx(this._canvas)){const t=this._canvas.getContext("2d");Wx(t)&&(t.save(),t.font=function(t,e={},i){i||(i=1);const{fontStyle:r=e.fontStyle,fontVariant:o=e.fontVariant,fontWeight:n=e.fontWeight,fontSize:s=e.fontSize,fontFamily:a=e.fontFamily}=t;return(r?r+" ":"")+(o?o+" ":"")+(n?n+" ":"")+s*i+"px "+(a||"sans-serif")}(this.textSpec),this._contextSaved=!0,this._context=t)}return!Dx(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:n=r.fontVariant,fontWeight:s=(null!==(t=r.fontWeight)&&void 0!==t?t:"normal"),fontSize:a=(null!==(e=r.fontSize)&&void 0!==e?e:12),fontFamily:l=(null!==(i=r.fontFamily)&&void 0!==i?i:"sans-serif"),align:h,textAlign:c=(null!=h?h:"center"),baseline:d,textBaseline:u=(null!=d?d:"middle"),ellipsis:g,limit:p}=this._userSpec;let{lineHeight:f=a}=this._userSpec;if(Vx(f)&&"%"===f[f.length-1]){const t=Number.parseFloat(f.substring(0,f.length-1))/100;f=a*t}return{fontStyle:o,fontVariant:n,fontFamily:l,fontSize:a,fontWeight:s,textAlign:c,textBaseline:u,ellipsis:g,limit:p,lineHeight:f}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(Dx(t))return{width:0,height:0};if(Dx(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:n,ellipsis:s,limit:a,lineHeight:l}=this.textSpec;let h;try{const c=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:n,ellipsis:!!s,maxLineWidth:a||1/0,lineHeight:l});h={width:c.width(),height:c.height()}}catch(e){this._notSupportVRender=!0,h=this.measureWithNaiveCanvas(t)}return h}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:null!==(e=o)&&void 0!==e?e:r,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);Dx(o)&&u_.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),Dx(o)&&["F","W"].includes(d_(r))&&(o=this._measureFullSizeChar()),Dx(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height),!Dx(o.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=o.fontBoundingBoxAscent),!Dx(o.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=o.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let e=0;e<t.length;e++){const o=t[e],n=["F","W"].includes(d_(o))?1:.53;i.width+=n*r}return i.height=null!==(e=o)&&void 0!==e?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,n={width:0,height:0};if(Dx(t))return n;if(Ux(t)){const s=t.filter(Wx).map((t=>t.toString()));return 0===s.length?n:1===s.length?e(s[0]):{width:s.reduce(((t,i)=>Math.max(t,e(i).width)),0),height:s.length*((null!==(i=o)&&void 0!==i?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(Dx(this._numberCharSize)){const t=this._standardMethod(u_.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/u_.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return Dx(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(u_.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(Dx(this._letterCharSize)){const t=this._standardMethod(u_.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/u_.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return Wx(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){Wx(this._canvas)&&(this._canvas=null),Wx(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}u_.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",u_.NUMBERS_CHAR_SET="0123456789",u_.FULL_SIZE_CHAR="字";class g_{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new g_(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return Ux(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return function(t,e,i){const{x1:r,y1:o,x2:n,y2:s}=e;i.onlyTranslate()?(t!==e&&t.setValue(e.x1,e.y1,e.x2,e.y2),t.translate(i.e,i.f)):(t.clear(),t.add(i.a*r+i.c*o+i.e,i.b*r+i.d*o+i.f),t.add(i.a*n+i.c*o+i.e,i.b*n+i.d*o+i.f),t.add(i.a*n+i.c*s+i.e,i.b*n+i.d*s+i.f),t.add(i.a*r+i.c*s+i.e,i.b*r+i.d*s+i.f))}(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:n,y2:s}=this,a=Math.cos(t),l=Math.sin(t),h=e-e*a+i*l,c=i-e*l-i*a;return[a*r-l*o+h,l*r+a*o+c,a*r-l*s+h,l*r+a*s+c,a*n-l*o+h,l*n+a*o+c,a*n-l*s+h,l*n+a*s+c]}scalePoints(t,e,i,r){const{x1:o,y1:n,x2:s,y2:a}=this;return[t*o+(1-t)*i,e*n+(1-e)*r,t*s+(1-t)*i,e*a+(1-e)*r]}}class p_ extends g_{}const f_={};class m_{isAggregator=!0;isRecord=!0;records=[];type;key;field;formatFun;changedValue;children=[];_formatedValue;constructor(t){this.key=t.key,this.field=t.field,this.formatFun=t.formatFun,this.isRecord=t.isRecord??this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[],this.changedValue=void 0,this.children=[],this.clearCacheValue()}}class b_ extends m_{type=Mx.RECORD;isRecord=!0;push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&this.children&&this.children.push(t),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t)))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.clearCacheValue())}value(){return this.changedValue??this.records}reset(){this.children=[],this.changedValue=void 0,this.records=[]}recalculate(){}}class y_ extends m_{type=Mx.NONE;isRecord=!0;fieldValue;push(t){t&&(this.isRecord&&(this.records=[t]),t.isAggregator&&this.children&&(this.children=[t]),this.field&&(this.fieldValue=t[this.field])),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field]),this.clearCacheValue())}value(){return this.changedValue??this.fieldValue}reset(){this.children=[],this.changedValue=void 0,this.records=[],this.fieldValue=void 0}recalculate(){}}class C_ extends m_{type=Mx.CUSTOM;isRecord=!0;aggregationFun;values=[];fieldValue;constructor(t){super(t),this.aggregationFun=t.aggregationFun}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&this.children&&this.children.push(t),this.field&&this.values.push(t[this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.values=this.records.map((t=>t[this.field]))),this.clearCacheValue())}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.field&&this.records.length&&(this.values=this.records.map((t=>t[this.field])))),this.clearCacheValue()}value(){return this.fieldValue||(this.fieldValue=this.aggregationFun?.(this.values,this.records,this.field)),this.changedValue??this.fieldValue}reset(){this.records=[],this.children=[],this.changedValue=void 0,this.fieldValue=void 0}recalculate(){this.fieldValue=void 0,this._formatedValue=void 0}}class w_ extends m_{type=Mx.RECALCULATE;isRecord=!0;calculateFun;fieldValue;dependAggregators;dependIndicatorKeys;constructor(t){super(t),this.calculateFun=t.calculateFun,this.dependAggregators=t.dependAggregators,this.dependIndicatorKeys=t.dependIndicatorKeys}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.children&&t.isAggregator&&this.children.push(t),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t)))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.clearCacheValue())}value(){if(!this.fieldValue){const t=function(t,e){const i={};for(let r=0;r<e?.length;r++){const o=t.find((t=>t?.key===e[r]));o&&(i[o.key]=o?.value())}return i}(this.dependAggregators,this.dependIndicatorKeys);this.fieldValue=this.calculateFun?.(t,this.records,this.field)}return this.changedValue??this.fieldValue}reset(){this.records=[],this.children=[],this.changedValue=void 0,this.fieldValue=void 0}recalculate(){}}class v_ extends m_{type=Mx.SUM;sum=0;positiveSum=0;nagetiveSum=0;needSplitPositiveAndNegativeForSum=!1;constructor(t){super(t),this.needSplitPositiveAndNegativeForSum=t.needSplitPositiveAndNegative??!1}push(t){if(t)if(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&this.children){this.children.push(t);const e=t.value();this.sum+=e??0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}this.clearCacheValue()}deleteRecord(t){if(t)if(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children){this.children=this.children.filter((e=>e!==t));const e=t.value();this.sum-=e??0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum-=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}this.clearCacheValue()}updateRecord(t,e){if(t&&e){if(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&this.children){const i=t.value();this.children=this.children.filter((e=>e!==t));const r=e.value();this.children.push(e),this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const i=parseFloat(t[this.field]),r=parseFloat(e[this.field]);this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}this.clearCacheValue()}}value(){return this.changedValue??(this.records?.length>=1?this.sum:void 0)}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){super.reset(),this.records=[],this.sum=0}recalculate(){if(this.sum=0,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const t=e.value();this.sum+=t??0,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];if(e.isAggregator){const t=e.value();this.sum+=t??0,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const t=parseFloat(e[this.field]);this.sum+=t,this.needSplitPositiveAndNegativeForSum&&(t>0?this.positiveSum+=t:t<0&&(this.nagetiveSum+=t))}}}}class x_ extends m_{type=Mx.COUNT;count=0;push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?(this.children&&this.children.push(t),this.count+=t.value()):this.count++),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator?(this.children&&(this.children=this.children.filter((e=>e!==t))),this.count-=t.value()):this.count--),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&(this.count+=e.value()-t.value()),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))))}value(){return this.changedValue??this.count}reset(){this.changedValue=void 0,this.children=[],this.records=[],this.count=0}recalculate(){if(this.count=0,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const t=e.value();this.count+=t??0}else this.count++}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.count+=e.value():this.count++}}}class __ extends m_{type=Mx.AVG;sum=0;count=0;push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&t.type===Mx.AVG?(this.children&&this.children.push(t),this.sum+=t.sum,this.count+=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(t[this.field]),this.count++)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&t.type===Mx.AVG?(this.children&&(this.children=this.children.filter((e=>e!==t))),this.sum-=t.sum,this.count-=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum-=parseFloat(t[this.field]),this.count--)),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&t.type===Mx.AVG?(this.children&&e.isAggregator&&(this.children=this.children.map((i=>i===t?e:i))),this.sum+=e.sum-t.sum,this.count+=e.count-t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(e[this.field])-parseFloat(t[this.field])),this.clearCacheValue())}value(){return this.changedValue??(this.records?.length>=1?this.sum/this.count:void 0)}reset(){this.changedValue=void 0,this.children=[],this.records=[],this.sum=0,this.count=0}recalculate(){if(this.sum=0,this.count=0,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator&&e.type===Mx.AVG){const t=e.value();this.sum+=t*e.count,this.count+=e.count}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator&&e.type===Mx.AVG?(this.sum+=e.sum,this.count+=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(e[this.field]),this.count++)}}}class S_ extends m_{type=Mx.MAX;max=Number.MIN_SAFE_INTEGER;push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?(this.children&&this.children.push(t),this.max=t.max>this.max?t.max:this.max):"number"==typeof t?this.max=t>this.max?t:this.max:this.field&&"number"==typeof t[this.field]?this.max=t[this.field]>this.max?t[this.field]:this.max:this.field&&!isNaN(t[this.field])&&(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.recalculate())}value(){return this.changedValue??(this.records?.length>=1?this.max:void 0)}reset(){this.records=[],this.changedValue=void 0,this.children=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){if(this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const t=e.value();this.max=Math.max(this.max,t)}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.max=e.max>this.max?e.max:this.max:"number"==typeof e?this.max=e>this.max?e:this.max:this.field&&"number"==typeof e[this.field]?this.max=e[this.field]>this.max?e[this.field]:this.max:this.field&&!isNaN(e[this.field])&&(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class A_ extends m_{type=Mx.MIN;min=Number.MAX_SAFE_INTEGER;push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?(this.children&&this.children.push(t),this.min=t.min<this.min?t.min:this.min):"number"==typeof t?this.min=t<this.min?t:this.min:this.field&&"number"==typeof t[this.field]?this.min=t[this.field]<this.min?t[this.field]:this.min:this.field&&!isNaN(t[this.field])&&(this.min=parseFloat(t[this.field])<this.min?parseFloat(t[this.field]):this.min)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.recalculate())}value(){return this.changedValue??(this.records?.length>=1?this.min:void 0)}reset(){this.records=[],this.changedValue=void 0,this.children=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){if(this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const t=e.value();this.min=Math.min(this.min,t)}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.min=e.min<this.min?e.min:this.min:"number"==typeof e?this.min=e<this.min?e:this.min:this.field&&"number"==typeof e[this.field]?this.min=e[this.field]<this.min?e[this.field]:this.min:this.field&&!isNaN(e[this.field])&&(this.min=parseFloat(e[this.field])<this.min?parseFloat(e[this.field]):this.min)}}}function T_(t,e,i){if(i===Px.NORMAL||i===Px.normal)return 0;const r=i===Px.DESC||i===Px.desc?-1:1;return t&&e?t.toString().localeCompare(e.toString(),"zh")*r:t?1*r:-1*r}function R_(t,e,i){if(i===Px.NORMAL||i===Px.normal)return 0;const r=/(\d+)|(\D+)/g,o=/\d/,n=/^0/;let s,a,l,h,c=0,d=0;const u=i===Px.DESC||i===Px.desc?-1:1;if(null!==e&&null===t)return-1*u;if(null!==t&&null===e)return 1*u;if("number"==typeof t&&isNaN(t))return-1*u;if("number"==typeof e&&isNaN(e))return 1*u;if(c=+t,d=+e,c<d)return-1*u;if(c>d)return 1*u;if("number"==typeof t&&"number"!=typeof e)return-1*u;if("number"==typeof e&&"number"!=typeof t)return 1*u;if("number"==typeof t&&"number"==typeof e)return 0;if(isNaN(d)&&!isNaN(c))return-1*u;if(isNaN(c)&&!isNaN(d))return 1*u;if(s=String(t),l=String(e),s===l)return 0;if(!o.test(s)||!o.test(l))return(s>l?1:-1)*u;for(s=s.match(r),l=l.match(r);s.length&&l.length;)if(a=s.shift(),h=l.shift(),a!==h)return o.test(a)&&o.test(h)?(a.replace(n,".0")-h.replace(n,".0"))*u:(a>h?1:-1)*u;return(s.length-l.length)*u}function B_(t){let e;const i={},r={};for(let o=0;o<t.length;o++)e=t[o],i[e]=o,"string"==typeof e&&(r[e.toLowerCase()]=o);return function(t,e,o){if(o===Px.NORMAL||o===Px.normal)return 0;const n=o===Px.DESC||o===Px.desc?-1:1;let s;return null!==i[t]&&void 0!==i[t]&&null!==i[e]&&void 0!==i[e]?s=i[t]-i[e]:null!==i[t]&&void 0!==i[t]?s=-1:null!==i[e]&&void 0!==i[e]?s=1:null!==r[t]&&void 0!==i[t]&&null!==r[e]&&void 0!==i[e]?s=r[t]-r[e]:null===r[t]||void 0===i[t]||null===r[e]||void 0===i[e]?s=0:null!==r[t]&&void 0!==i[t]?s=-1:null!==r[e]&&void 0!==i[e]&&(s=1),Wx(s)?s*n:R_(t,e,o)}}var M_=Object.freeze({__proto__:null,get AggregationType(){return Mx},Aggregator:m_,AvgAggregator:__,CountAggregator:x_,CustomAggregator:C_,get HierarchyState(){return kx},get HighlightScope(){return Rx},get IconFuncTypeEnum(){return Fx},get IconPosition(){return Ex},get InteractionState(){return Tx},get InternalIconName(){return Lx},MaxAggregator:S_,MinAggregator:A_,NoneAggregator:y_,get Placement(){return Hx},RecalculateAggregator:w_,RecordAggregator:b_,get SortType(){return Px},SumAggregator:v_,cellStyleKeys:Bx,indicatorSort:function(t,e){return t&&e?t.toString().localeCompare(e.toString(),"zh"):t?1:-1},naturalSort:R_,registeredAggregators:f_,sortBy:B_,typeSort:T_});let P_,H_=1,k_=class{listenersData={listeners:{},listenerData:{}};on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const r=H_++;return this.listenersData.listenerData[r]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[r];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},r}off(t,e){if(e){const i=t;this.removeEventListener(i,e)}else{const e=t;if(!this.listenersData)return;this.listenersData.listenerData[e]?.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===t&&r.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((t=>t.call(this,e))).filter((t=>Wx(t))):[]}release(){delete this.listenersData}};const E_={CHANGE_STYLE:"change_style"};let F_,L_,I_,z_=class t extends k_{_color;_strokeColor;_fontSize;_fontFamily;_fontWeight;_fontVariant;_fontStyle;_padding;_defaultPadding=[10,16,10,16];_textStick;_textStickBaseOnAlign;_textOverflow;_textAlign;_textBaseline;_bgColor;_borderColor;_lineHeight;_underline;_underlineColor;_underlineDash;_underlineOffset;_lineThrough;_lineThroughColor;_lineThroughDash;_linkColor;_cursor;_borderLineWidth;_borderLineDash;_marked;static get EVENT_TYPE(){return E_}static get DEFAULT(){return P_||(P_=new t)}constructor(t={},e={}){super(),this._textAlign=t?.textAlign??e?.textAlign,this._textBaseline=t?.textBaseline??e?.textBaseline,this._color=t?.color??e?.color,this._strokeColor=t?.strokeColor??e?.strokeColor,this._fontSize=t.fontSize??e?.fontSize,this._fontFamily=t.fontFamily??e?.fontFamily,this._fontWeight=t.fontWeight??e?.fontWeight,this._fontVariant=t.fontVariant??e?.fontVariant,this._fontStyle=t.fontStyle??e?.fontStyle,this._padding=t?.padding??e?.padding??this._defaultPadding,this._borderColor=t?.borderColor??e?.borderColor,this._textOverflow=t?.textOverflow??e?.textOverflow,this._textStick=t.textStick??e?.textStick??!1,this._textStickBaseOnAlign=t.textStickBaseOnAlign??e?.textStickBaseOnAlign??!1,this._bgColor=t?.bgColor??e?.bgColor,this._lineHeight=t?.lineHeight??e?.lineHeight,this._underline=t?.underline??e?.underline,this._underlineColor=t?.underlineColor??e?.underlineColor,this._underlineDash=t?.underlineDash??e?.underlineDash,this._underlineOffset=t?.underlineOffset??e?.underlineOffset,this._lineThrough=t?.lineThrough??e?.lineThrough,this._lineThroughColor=t?.lineThroughColor??e?.lineThroughColor,this._lineThroughDash=t?.lineThroughDash??e?.lineThroughDash,this._linkColor=t?.linkColor??e?.linkColor,this._cursor=t.cursor??e?.cursor,this._borderLineWidth=t.borderLineWidth??e?.borderLineWidth,this._borderLineDash=t.borderLineDash??e?.borderLineDash,this._marked=t.marked??e?.marked}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new t(this,null)}},O_=class t extends z_{static get DEFAULT(){return F_||(F_=new t)}constructor(t={},e={}){super(t,e)}clone(){return new t(this,null)}};class D_ extends z_{_autoWrapText;_lineClamp;static get DEFAULT(){return L_||(L_=new D_)}constructor(t={},e={}){super(t,e),this._autoWrapText=t?.autoWrapText??e?.autoWrapText,this._lineClamp=t?.lineClamp??e?.lineClamp}clone(){return new D_(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let W_,N_,G_,j_=class t extends z_{_size;_spaceBetweenTextAndIcon;_defaultFill;_defaultStroke;_disableFill;_checkedFill;_checkedStroke;_disableCheckedFill;_disableCheckedStroke;_checkIconImage;_indeterminateIconImage;static get DEFAULT(){return I_||(I_=new t)}constructor(t={},e={},i={}){super(t,e),this._size=(t?.size??e?.size??i?.size)||14,this._spaceBetweenTextAndIcon=(t?.spaceBetweenTextAndIcon??e?.spaceBetweenTextAndIcon??i?.spaceBetweenTextAndIcon)||8,this._defaultFill=t?.checkboxStyle?.defaultFill??i?.defaultFill,this._defaultStroke=t?.checkboxStyle?.defaultStroke??i?.defaultStroke,this._disableFill=t?.checkboxStyle?.disableFill??i?.disableFill,this._checkedFill=t?.checkboxStyle?.checkedFill??i?.checkedFill,this._checkedStroke=t?.checkboxStyle?.checkedStroke??i?.checkedStroke,this._disableCheckedFill=t?.checkboxStyle?.disableCheckedFill??i?.disableCheckedFill,this._disableCheckedStroke=t?.checkboxStyle?.disableCheckedStroke??i?.disableCheckedStroke,this._checkIconImage=t?.checkboxStyle?.checkIconImage??i?.checkIconImage,this._indeterminateIconImage=t?.checkboxStyle?.indeterminateIconImage??i?.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(e){return new t(e,this)}clone(){return new t(this)}};class V_ extends z_{_size;_spaceBetweenTextAndIcon;_spaceBetweenRadio;_outerRadius;_innerRadius;_defaultFill;_defaultStroke;_disableFill;_checkedFill;_checkedStroke;_disableCheckedFill;_disableCheckedStroke;static get DEFAULT(){return W_||(W_=new V_)}constructor(t={},e={},i={}){super(t,e),this._size=(t?.size??e?.size??i?.size)||14,this._spaceBetweenTextAndIcon=(t?.spaceBetweenTextAndIcon??e?.spaceBetweenTextAndIcon??i?.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=(t?.spaceBetweenRadio??e?.spaceBetweenRadio??i?.spaceBetweenRadio)||2,this._innerRadius=t?.radioStyle?.innerRadius??i?.innerRadius,this._outerRadius=t?.radioStyle?.outerRadius??i?.outerRadius,this._defaultFill=t?.radioStyle?.defaultFill??i?.defaultFill,this._defaultStroke=t?.radioStyle?.defaultStroke??i?.defaultStroke,this._disableFill=t?.radioStyle?.disableFill??i?.disableFill,this._checkedFill=t?.radioStyle?.checkedFill??i?.checkedFill,this._checkedStroke=t?.radioStyle?.checkedStroke??i?.checkedStroke,this._disableCheckedFill=t?.radioStyle?.disableCheckedFill??i?.disableCheckedFill,this._disableCheckedStroke=t?.radioStyle?.disableCheckedStroke??i?.disableCheckedStroke}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(t){this._spaceBetweenRadio=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}getStyle(t){return new V_(t,this)}clone(){return new V_(this)}}class U_ extends z_{_spaceBetweenTextAndCircle;_circleRadius;_boxWidth;_boxHeight;_checkedFill;_uncheckedFill;_disableCheckedFill;_disableUncheckedFill;_circleFill;static get DEFAULT(){return N_||(N_=new U_)}constructor(t={},e={},i={}){super(t,e),this._spaceBetweenTextAndCircle=(t?.spaceBetweenTextAndCircle??e?.spaceBetweenTextAndCircle??i?.spaceBetweenTextAndCircle)||6,this._circleRadius=(t?.switchStyle?.circleRadius??i?.circleRadius)||8,this._boxWidth=(t?.switchStyle?.boxWidth??i?.boxWidth)||40,this._boxHeight=(t?.switchStyle?.boxHeight??i?.boxHeight)||24,this._checkedFill=(t?.switchStyle?.checkedFill??i?.checkedFill)||"#165DFF",this._uncheckedFill=(t?.switchStyle?.uncheckedFill??i?.uncheckedFill)||"#c9cdd4",this._disableCheckedFill=(t?.switchStyle?.disableCheckedFill??i?.disableCheckedFill)||"#94bfff",this._disableUncheckedFill=(t?.switchStyle?.disableUncheckedFill??i?.disableUncheckedFill)||"#f2f3f5",this._circleFill=(t?.switchStyle?.circleFill??i?.circleFill)||"#FFF"}get spaceBetweenTextAndCircle(){return this._spaceBetweenTextAndCircle}set spaceBetweenTextAndCircle(t){this._spaceBetweenTextAndCircle=t}get circleRadius(){return this._circleRadius}set circleRadius(t){this._circleRadius=t}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth=t}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get uncheckedFill(){return this._uncheckedFill}set uncheckedFill(t){this._uncheckedFill=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableUncheckedFill(){return this._disableUncheckedFill}set disableUncheckedFill(t){this._disableUncheckedFill=t}get circleFill(){return this._circleFill}set circleFill(t){this._circleFill=t}getStyle(t){return new U_(t,this)}clone(){return new U_(this)}}class K_ extends z_{_buttonColor;_buttonBorderColor;_buttonLineWidth;_buttonBorderRadius;_buttonHoverColor;_buttonHoverBorderColor;_buttonTextHoverColor;_buttonDisableColor;_buttonDisableBorderColor;_buttonTextDisableColor;_buttonTextHoverBorderColor;_buttonPadding;static get DEFAULT(){return G_||(G_=new K_)}constructor(t={},e={},i={}){super(t,e),this._buttonColor=(t?.buttonStyle?.buttonColor??i?.buttonColor)||"#165DFF",this._buttonBorderColor=(t?.buttonStyle?.buttonBorderColor??i?.buttonBorderColor)||"#165DFF",this._buttonLineWidth=(t?.buttonStyle?.buttonLineWidth??i?.buttonLineWidth)||1,this._buttonBorderRadius=(t?.buttonStyle?.buttonBorderRadius??i?.buttonBorderRadius)||2,this._buttonHoverColor=(t?.buttonStyle?.buttonHoverColor??i?.buttonHoverColor)||"#4080FF",this._buttonHoverBorderColor=(t?.buttonStyle?.buttonHoverBorderColor??i?.buttonHoverBorderColor)||"#4080FF",this._buttonTextHoverColor=t?.buttonStyle?.buttonTextHoverColor??i?.buttonTextHoverColor,this._buttonDisableColor=(t?.buttonStyle?.buttonDisableColor??i?.buttonDisableColor)||"#94bfff",this._buttonDisableBorderColor=(t?.buttonStyle?.buttonDisableBorderColor??i?.buttonDisableBorderColor)||"#94bfff",this._buttonTextDisableColor=t?.buttonStyle?.buttonTextDisableColor??i?.buttonTextDisableColor,this._buttonPadding=(t?.buttonStyle?.buttonPadding??i?.buttonPadding)||10}get buttonColor(){return this._buttonColor}set buttonColor(t){this._buttonColor=t}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(t){this._buttonBorderColor=t}get buttonLineWidth(){return this._buttonLineWidth}set buttonLineWidth(t){this._buttonLineWidth=t}get buttonBorderRadius(){return this._buttonBorderRadius}set buttonBorderRadius(t){this._buttonBorderRadius=t}get buttonHoverColor(){return this._buttonHoverColor}set buttonHoverColor(t){this._buttonHoverColor=t}get buttonHoverBorderColor(){return this._buttonHoverBorderColor}set buttonHoverBorderColor(t){this._buttonHoverBorderColor=t}get buttonTextHoverColor(){return this._buttonTextHoverColor}set buttonTextHoverColor(t){this._buttonTextHoverColor=t}get buttonDisableColor(){return this._buttonDisableColor}set buttonDisableColor(t){this._buttonDisableColor=t}get buttonDisableBorderColor(){return this._buttonDisableBorderColor}set buttonDisableBorderColor(t){this._buttonDisableBorderColor=t}get buttonTextDisableColor(){return this._buttonTextDisableColor}set buttonTextDisableColor(t){this._buttonTextDisableColor=t}get buttonTextHoverBorderColor(){return this._buttonTextHoverBorderColor}set buttonTextHoverBorderColor(t){this._buttonTextHoverBorderColor=t}get buttonPadding(){return this._buttonPadding}set buttonPadding(t){this._buttonPadding=t}getStyle(t){return new K_(t,this)}clone(){return new K_(this)}}function $_(t,e,i,r=z_,o,n){return t||e?t instanceof z_?t:"function"==typeof t?$_(t(i),e,i,r,o,n):(t||(t={}),o&&!Wx(t.autoWrapText)&&(t.autoWrapText=!0),r===j_?new j_(t??{},e??{},n.checkboxStyle??{}):r===V_?new V_(t??{},e??{},n.radioStyle??{}):r===U_?new U_(t??{},e??{},n.switchStyle??{}):r===K_?new K_(t??{},e??{},n.buttonStyle??{}):new r(t??{},e??{})):r.DEFAULT}class X_{static _mode;static get mode(){return X_._mode||(X_._mode=function(){let t="browser";try{"node"===window.type?t="node":"undefined"==typeof window||window.performance?"undefined"==typeof window&&(t="node"):t="miniApp"}catch(e){t="node"}return t}()),X_._mode}static set mode(t){X_._mode=t}static dpr=0;static CreateCanvas;static LoadImage;static RequestAnimationFrame;static CancelAnimationFrame;static RegisterCreateCanvas(t){X_.CreateCanvas=t}static RegisterLoadImage(t){X_.LoadImage=t}static GetCreateCanvasFunc(){return X_.CreateCanvas?X_.CreateCanvas:"worker"===X_.mode?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(t){X_.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(X_.RequestAnimationFrame)return X_.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){X_.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(X_.CancelAnimationFrame)return X_.CancelAnimationFrame}}const Y_=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e,q_=t=>Y_(t,"object"),Z_=t=>Y_(t,"string"),J_=t=>Y_(t,"number"),Q_=t=>Y_(t,"boolean");function tS(t,...e){if(!e.length)return t||{};const i=e.shift();if(q_(t)&&q_(i))for(const e in i)q_(i[e])?(t[e]||Object.assign(t,{[e]:{}}),q_(t[e])||Object.assign(t,{[e]:i[e]}),tS(t[e],i[e])):null!==i[e]&&void 0!==i[e]&&Object.assign(t,{[e]:i[e]});return tS(t,...e)}function eS(t){return"function"==typeof t&&(t=t()),Wx(t)?`${t}`:""}function iS(t){if(t?.length<=0)return t;const e=t.length,i=t[0].length,r=new Array(i);for(let o=0;o<e;o++)for(let n=0;n<i;n++)r[n]||(r[n]=new Array(e)),r[n][o]=t[o][n];return r}function rS(t,e){let i=null;return function(...r){i||(t.apply(this,r),i=setTimeout((()=>{i=null}),e))}}function oS(t,e){for(t=`${t}`;t.length<e;)t="0"+t;return t}function nS(t,e,i){t=(t=t.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const r=Math.round(256*e)*(i?-1:1),o=t.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),n=o&&Wx(o[4])?o[4]:null,s=o?[o[1],o[2],o[3]]:t.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,(function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`})).split(/,/);return o?`rgb${null!==n?"a":""}(${Math[i?"max":"min"](parseInt(s[0],10)+r,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[1],10)+r,i?0:255)}, ${Math[i?"max":"min"](parseInt(s[2],10)+r,i?0:255)}${null!==n?`, ${n}`:""})`:["#",oS(Math[i?"max":"min"](parseInt(s[0],10)+r,i?0:255).toString(16),2),oS(Math[i?"max":"min"](parseInt(s[1],10)+r,i?0:255).toString(16),2),oS(Math[i?"max":"min"](parseInt(s[2],10)+r,i?0:255).toString(16),2)].join("")}function sS(t){return Z_(t)||J_(t)||Q_(t)?t.toString():""}function aS(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function lS(t,e,i){return"desc"!==i?t===e?0:t>e?1:-1:t===e?0:t<e?1:-1}function hS(t){return/^-?\d+(\.\d+)?$/.test(t)}function cS(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function dS(t,e,i){i(t),t?.[e]&&Array.isArray(t?.[e])&&t[e].forEach((t=>dS(t,e,i)))}function uS(t,e,i){let r=0;if(!e||e===kx.collapse||e===kx.none)return r;const o=i.filteredChildren?i.filteredChildren:i.children;if(o)for(let e=0;e<o.length;e++){r+=1;r+=uS(Array.isArray(t)?t.concat([e]):[t,e],o[e].hierarchyState,o[e])}return r}const gS="undefined"==typeof window||void 0===window.window;let pS,fS;const mS={get find(){return pS||(pS=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const i=mS.findIndex(t,e);return i>=0?t[i]:void 0},pS)},get findIndex(){return fS||(fS=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:i}=t;for(let r=0;r<i;r++){if(e(t[r],r,t))return r}return-1},fS)}};const{IE:bS,Chrome:yS,Firefox:CS,Edge:wS,Safari:vS}=function(){if(gS)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}();function xS(...t){const e={};return t.forEach((t=>{for(const i in t)Object.defineProperty(e,i,{get:()=>t[i],set(e){t[i]=e},configurable:!0,enumerable:!0})})),e}function _S(t,e,...i){let r=t;for(let t=0;t<i.length&&null!=r;t++)r=e(r,i[t]);return r}function SS(t,...e){return _S(t,((t,e)=>t[e]),...e)}function AS(t,...e){return"function"==typeof t?t(...e):t}function TS(t){return Boolean(t&&"function"==typeof t.then)}function RS(t,e){TS(t)?t.then((t=>{e(t)})).catch((t=>{})):e(t)}function BS(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:[t[0],t[1],t[2],t[3]]:[t,t,t,t]}function MS(t,e,i){return t.start.col<=e&&e<=t.end.col&&t.start.row<=i&&i<=t.end.row||t.end.col<=e&&e<=t.start.col&&t.end.row<=i&&i<=t.start.row||t.end.col<=e&&e<=t.start.col&&t.start.row<=i&&i<=t.end.row||t.start.col<=e&&e<=t.end.col&&t.end.row<=i&&i<=t.start.row}function PS(t){return{start:{col:Math.min(t.start.col,t.end.col),row:Math.min(t.start.row,t.end.row)},end:{col:Math.max(t.start.col,t.end.col),row:Math.max(t.start.row,t.end.row)}}}function HS(t,e){const i=PS(t),r=PS(e);if(Math.max(i.start.col,r.start.col)<=Math.min(i.end.col,r.end.col)){if(Math.max(i.start.row,r.start.row)<=Math.min(i.end.row,r.end.row))return!0}return!1}const kS=bS,ES={isObject:function(t){return t===Object(t)}},FS={endsWith:function(t,e,i){const r=sS(t);("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>r.length)&&(i=r.length),i-=e.length;const o=r.lastIndexOf(e,i);return-1!==o&&o===i}},LS={isTouchEvent:function(t){return!!t.changedTouches}},IS={toBoxArray:BS},zS=Function.prototype,OS={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",SELECTED_CLEAR:"selected_clear",BEFORE_KEYDOWN:"before_keydown",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_TABLE:"mousemove_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION_START:"change_header_position_start",CHANGE_HEADER_POSITION:"change_header_position",CHANGING_HEADER_POSITION:"changing_header_position",CHANGE_HEADER_POSITION_FAIL:"change_header_position_fail",SORT_CLICK:"sort_click",AFTER_SORT:"after_sort",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",CAN_SCROLL:"can_scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",SWITCH_STATE_CHANGE:"switch_state_change",BEFORE_SET_SIZE:"before_set_size",BEFORE_INIT:"before_init",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle",EMPTY_TIP_CLICK:"empty_tip_click",EMPTY_TIP_DBLCLICK:"empty_tip_dblclick",BUTTON_CLICK:"button_click",BEFORE_CACHE_CHART_IMAGE:"before_cache_chart_image",PASTED_DATA:"pasted_data"},DS=(t,e)=>(t=>{switch(Object.prototype.toString.call(t)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}})(t)===e;function WS(t,e,i){let r,o,n,s,a,l,h=0,c=!1,d=!1,u=!0;const g=!e&&0!==e&&"function"==typeof requestAnimationFrame;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){const i=r,n=o;return o=void 0,r=void 0,h=e,s=t.apply(n,i),s}function f(t,e){return g?requestAnimationFrame(t):setTimeout(t,e)}function m(t){const i=t-l;return void 0===l||i>=e||i<0||c&&t-h>=n}function b(){const t=Date.now();if(m(t))return function(t){return a=void 0,u&&r?p(t):(o=void 0,r=void 0,s)}(t);a=f(b,function(t){const i=t-h,r=e&&-(t-l);return c?Math.min(r,n-i):r}(t))}return e=+e||0,DS(i,"object")&&(d=!!i.leading,c="maxWait"in i,c&&(n=Math.max(+i.maxWait||0,e)),u="trailing"in i?!!i.trailing:u),function(...t){const i=Date.now(),n=m(i);if(r=t,o=this,l=i,n){if(void 0===a)return function(t){return h=t,a=f(b,e),d?p(t):s}(l);if(c)return a=f(b,e),p(l)}return void 0===a&&(a=f(b,e)),s}}let NS=1;class GS{resizeTime;listeners={};reseizeListeners={};on(t,e,i,...r){if("node"===X_.mode)return-1;const o=NS++;if(t?.addEventListener)if("resize"!==e||t===window)t?.addEventListener(e,i,...r);else{const e=new class{resizeTime=100;element;cb;observer;lastSize={width:0,height:0};callBackDebounce;constructor(t,e,i){if(this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=WS(this.callBack,this.resizeTime),window?.addEventListener("resize",this.onResize),"ResizeObserver"in window){const t=window.ResizeObserver;this.observer=new t(this.mutationResize),this.observer?.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}mutationResize=()=>{this.onResize()};disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}callBack=()=>{const t=this.getSize();let e=!1;t.width===this.lastSize.width&&t.height===this.lastSize.height&&(e=!0),this.lastSize=t,this.cb&&this.cb({...this.lastSize,windowSizeNotChange:e})};setSize(t){this.lastSize=t}onResize=()=>{this.callBackDebounce()};checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:{...this.lastSize}}}(t,i,this.resizeTime);this.reseizeListeners[o]=e}const n={target:t,type:e,listener:i,options:r};return this.listeners[o]=n,o}once(t,e,i,...r){if("node"===X_.mode)return-1;const o=this.on(t,e,((...t)=>{this.off(o),i(...t)}),...r);return o}off(t){if("node"===X_.mode)return;if(null===t)return;const e=this.listeners?.[t];e&&(delete this.listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...i){if("node"!==X_.mode)for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&o.listener.call(o.target,...i)}}hasListener(t,e){if("node"===X_.mode)return!1;let i=!1;for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if("node"!==X_.mode){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e?.disConnect()}this.listeners={}}}release(){"node"!==X_.mode&&(this.clear(),this.listeners={})}}const jS=(t,e)=>{let i=0,r=t.length-1;for(;i<=r;){const o=Math.floor((i+r)/2);if(t[o]===e)return o;t[o]>e?r=o-1:i=o+1}return r<0?0:r};class VS{_keys=[];_vals={};_sorted=!1;count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:r}=this;if(this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>e){const o=[];for(let n=jS(r,t+i-1);n>=0;n--){const s=r[n];if(s>=t)o.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,o[i-1-t])}const{length:o}=r;if(t<e){const n=[];for(let s=jS(r,t);s<o;s++){const o=r[s];if(o>=t&&o<t+i)n.push(this.get(o));else if(t+i<=o&&o<=e)this.put(o-i,this.get(o));else if(o>e)break}for(let t=0;t<i;t++)this.put(e+t,n[t])}}exchangeOrder(t,e,i,r,o){const{_keys:n}=this;if(this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const r=[],s=[];for(let o=jS(n,i);o<jS(n,t)+e;o++){const i=n[o];i>=t&&i<t+e?s.push(this.get(i)):r.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,s[t]);for(let t=0;t<r.length;t++)this.put(o+e+t,r[t])}else{const s=[],a=[];for(let o=jS(n,t);o<jS(n,i)+r;o++){const i=n[o];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);-1!==e&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return Wx(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:r}=this,{length:o}=r;this._sorted||(r.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let n=jS(r,t);n<o;n++){const o=r[n];if(t<=o&&o<=e){if(!1===i(this.get(o),o))break}else if(e<o)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){if(Wx(e)){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),this.put(t,e)}}}let US=class t{bounds;constructor(t,e,i,r){this.bounds=new g_,this.bounds.set(t,e,t+i,e+r)}static bounds(e,i,r,o){return new t(e,i,Math.round(r-e),Math.round(o-i))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new t(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}};var KS={name:"DARK",underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#282a2e":"#2d3137"},fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"},functionalIconsStyle:{sort_color:"#FFFFFF",sort_color_opacity:"0.75",sort_color_2:"#416EFF",sort_color_opacity_2:"1",frozen_color:"#FFFFFF",frozen_color_opacity:"0.75",collapse_color:"#FFF",collapse_color_opacity:"0.75",expand_color:"#FFF",expand_color_opacity:"0.75",dragReorder_color:"#FFF",dragReorder_color_opacity:"0.75"}};var $S={name:"BRIGHT",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FFF":"#F4F8FF"},borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var XS={name:"ARCO",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#fbfbfc":"#FFF"},borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var YS={name:"DEFAULT",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:function(t){const{row:e,table:i}=t;return 1&e-i.frozenRowCount?"#FDFDFD":"#FAF9FB"},hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};var qS={name:"SIMPLIFY",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:function(t){const{col:e,table:i}=t,{colCount:r,frozenColCount:o}=i,n="#ccc7c7",s="#ccc7c7";return o-1===e||r-1===e?[n,"#f2f2f2",s,null]:[n,null,s,null]},hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:function(t){const{row:e,table:{frozenRowCount:i}}=t;return i-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};const ZS={},JS="Arial,sans-serif",QS=[],tA=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,eA="$$indicator$$",iA={type:"line"};function rA(t){return t||{}}const oA={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function nA(t,e,i,r){return SS(t,...i)??SS(e,...i)??(r&&SS(t,...r))??(r&&SS(e,...r))}class sA{internalTheme;_defaultStyle=null;_header=null;_cornerHeader=null;_cornerRightTopCell=null;_cornerLeftBottomCell=null;_cornerRightBottomCell=null;_rightFrozen=null;_bottomFrozen=null;_rowHeader=null;_body=null;_groupTitle=null;_scroll=null;_tooltip=null;_frameStyle=null;_columnResize=null;_dragHeaderSplitLine=null;_frozenColumnLine=null;_selectionStyle=null;_axisStyle=null;_checkboxStyle=null;_radioStyle=null;_switchStyle=null;_buttonStyle=null;_textPopTipStyle=null;_internalIconsStyle=null;isPivot=!1;name="";constructor(t,e){this.internalTheme={obj:t,superTheme:e},this.name=nA(t,e,["name"])}getExtendTheme(){return this.internalTheme.obj}clearBodyStyleCache(){this._body=null}get font(){const{obj:t,superTheme:e}=this.internalTheme;return nA(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return nA(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){const{obj:t,superTheme:e}=this.internalTheme;return nA(t,e,["cellInnerBorder"])??!0}get cellBorderClipDirection(){const{obj:t,superTheme:e}=this.internalTheme;return nA(t,e,["cellBorderClipDirection"])??"top-left"}get _contentOffset(){const{obj:t,superTheme:e}=this.internalTheme;return nA(t,e,["_contentOffset"])??0}get defaultStyle(){const t=this;if(!this._defaultStyle){const{obj:e,superTheme:i}=this.internalTheme,r=tS({},i.defaultStyle,e.defaultStyle);this._defaultStyle={get fontSize(){return r.fontSize??16},get fontFamily(){return r.fontFamily??JS},get fontWeight(){return r.fontWeight},get fontVariant(){return r.fontVariant},get fontStyle(){return r.fontStyle},get bgColor(){return r.bgColor??"#FFF"},get color(){return r.color??"#000"},get borderColor(){return r.borderColor??"#000"},get borderLineWidth(){return r.borderLineWidth??1},get borderLineDash(){return r.borderLineDash??QS},get hover(){if(r.hover)return{get cellBgColor(){return r.hover?.cellBgColor??void 0},get inlineColumnBgColor(){return r.hover?.inlineColumnBgColor??(r.hover?.cellBgColor&&"string"==typeof r.hover?.cellBgColor?nS(r.hover?.cellBgColor,.1,!1):void 0)??void 0},get inlineRowBgColor(){return r.hover?.inlineRowBgColor??(r.hover?.cellBgColor&&"string"==typeof r.hover?.cellBgColor?nS(r.hover?.cellBgColor,.1,!1):void 0)??void 0}}},get select(){if(r.select)return{get inlineColumnBgColor(){return r.select?.inlineColumnBgColor??t.selectionStyle?.inlineColumnBgColor??(t.selectionStyle?.cellBgColor&&"string"==typeof t.selectionStyle.cellBgColor?nS(t.selectionStyle.cellBgColor,.1,!1):void 0)??void 0},get inlineRowBgColor(){return r.select?.inlineRowBgColor??t.selectionStyle.inlineRowBgColor??(t.selectionStyle?.cellBgColor&&"string"==typeof t.selectionStyle.cellBgColor?nS(t.selectionStyle.cellBgColor,.1,!1):void 0)??void 0}}},get padding(){return r.padding??[10,16,10,16]},get textAlign(){return r.textAlign??"left"},get textBaseline(){return r.textBaseline??"middle"},get textOverflow(){return r.textOverflow??"ellipsis"},get lineHeight(){return r.lineHeight},get autoWrapText(){return r.autoWrapText??!1},get lineClamp(){return r.lineClamp??"auto"},get linkColor(){return r.linkColor??"#3772ff"},get cursor(){return r.cursor??"auto"},get marked(){return r.marked??!1},get underline(){return r.underline??!1},get underlineColor(){return r.underlineColor},get underlineDash(){return r.underlineDash},get underlineOffset(){return r.underlineOffset},get lineThrough(){return r.lineThrough??!1},get lineThroughColor(){return r.lineThroughColor},get lineThroughDash(){return r.lineThroughDash}}}return this._defaultStyle}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=tS({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=tS({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=tS({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=tS({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=tS({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){if(!this._rowHeader){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},this.defaultStyle,e.rowHeaderStyle,t.rowHeaderStyle??(this.isPivot?null:t.headerStyle));this._rowHeader=this.getStyle(i)}return this._rowHeader}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get groupTitleStyle(){if(!this._groupTitle){const{obj:t,superTheme:e}=this.internalTheme;if(!e.groupTitleStyle&&!t.groupTitleStyle)return this._groupTitle;const i=tS({},this.defaultStyle,e.groupTitleStyle,t.groupTitleStyle);this._groupTitle=this.getStyle(i)}return this._groupTitle}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){return i.scrollSliderColor??"#C0C0C0"},get scrollSliderCornerRadius(){return i.scrollSliderCornerRadius},get scrollRailColor(){return i.scrollRailColor},get visible(){return i.visible??"scrolling"},get verticalVisible(){return i.verticalVisible},get horizontalVisible(){return i.horizontalVisible},get width(){return i.width??7},get hoverOn(){return i.hoverOn??!0},get barToSide(){return i.barToSide??!1},get horizontalPadding(){return i.horizontalPadding??0},get verticalPadding(){return i.verticalPadding??0}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){return i.fontFamily??JS},get fontSize(){return i.fontSize??16},get bgColor(){return i.bgColor??"#000"},get padding(){return i.padding??[6,8]},get color(){return i.color??"#FFF"},get maxWidth(){return i.maxWidth},get maxHeight(){return i.maxHeight}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){return i.lineColor??"#416EFF"},get bgColor(){return i.bgColor??"#D9E2FF"},get lineWidth(){return i.lineWidth??1},get width(){return i.width??i.lineWidth+2},get resizeHotSpotSize(){return i.resizeHotSpotSize??16},get labelColor(){return i.labelColor??"#FFF"},get labelFontSize(){return i.labelFontSize??10},get labelFontFamily(){return i.labelFontFamily??"sans-serif"},get labelBackgroundFill(){return i.labelBackgroundFill??"#3073F2"},get labelBackgroundCornerRadius(){return i.labelBackgroundCornerRadius??5},get labelVisible(){return i.labelVisible??!0},get visibleOnHover(){return i.visibleOnHover??!1}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){return i.lineColor??"blue"},get lineWidth(){return i.lineWidth??2},get shadowBlockColor(){return i.shadowBlockColor??"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){return i.shadow?.width??24},get startColor(){return i.shadow?.startColor??"rgba(00, 24, 47, 0.06)"},get endColor(){return i.shadow?.endColor??"rgba(00, 24, 47, 0)"},get visible(){return i.shadow?.visible??"always"}}},get border(){if(i.border)return{get lineColor(){return i.border?.lineColor??"rgba(00, 24, 47, 0.06)"},get bgColor(){return i.border?.bgColor??i.border?.lineColor??"rgba(00, 24, 47, 0.06)"},get lineWidth(){return i.border?.lineWidth??4},get width(){return i.border?.width??i.border?.lineWidth??4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){return i?.cellBgColor??"rgba(0, 0, 255,0.1)"},get cellBorderColor(){return i?.cellBorderColor??"#3073f2"},get cellBorderLineWidth(){return i?.cellBorderLineWidth??2},get inlineColumnBgColor(){return i?.inlineColumnBgColor},get inlineRowBgColor(){return i?.inlineRowBgColor},get selectionFillMode(){return i?.selectionFillMode??"overlay"},get dynamicUpdateSelectionSize(){return i?.dynamicUpdateSelectionSize??!1}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.axisStyle,t.axisStyle);this._axisStyle=function(t){return{defaultAxisStyle:rA(t.defaultAxisStyle),leftAxisStyle:rA(t.leftAxisStyle),rightAxisStyle:rA(t.rightAxisStyle),topAxisStyle:rA(t.topAxisStyle),bottomAxisStyle:rA(t.bottomAxisStyle)}}(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.radioStyle,t.radioStyle);this._radioStyle=i}return this._radioStyle}get switchStyle(){if(!this._switchStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.switchStyle,t.switchStyle);this._switchStyle=i}return this._switchStyle}get buttonStyle(){if(!this._buttonStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.buttonStyle,t.buttonStyle);this._buttonStyle=i}return this._buttonStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},oA,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}get functionalIconsStyle(){if(!this._internalIconsStyle){const{obj:t,superTheme:e}=this.internalTheme,i=tS({},e.functionalIconsStyle,t.functionalIconsStyle);this._internalIconsStyle=i}return this._internalIconsStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return aA(e,t)||aA(i,t)}extends(t){return new sA(tS({},t),tS(this.internalTheme.superTheme,this.internalTheme.obj))}getStyle(t){const e=this;return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get strokeColor(){return t.strokeColor},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){return t.hover?.cellBgColor??void 0},get inlineColumnBgColor(){return t.hover?.inlineColumnBgColor??(t.hover?.cellBgColor&&"string"==typeof t.hover?.cellBgColor?nS(t.hover?.cellBgColor,.1,!1):void 0)??void 0},get inlineRowBgColor(){return t.hover?.inlineRowBgColor??(t.hover?.cellBgColor&&"string"==typeof t.hover?.cellBgColor?nS(t.hover?.cellBgColor,.1,!1):void 0)??void 0}}},get select(){return{get inlineColumnBgColor(){return t.select?.inlineColumnBgColor??e.selectionStyle?.inlineColumnBgColor??(e.selectionStyle?.cellBgColor&&"string"==typeof e.selectionStyle.cellBgColor?nS(e.selectionStyle.cellBgColor,.1,!1):void 0)??void 0},get inlineRowBgColor(){return t.select?.inlineRowBgColor??e.selectionStyle.inlineRowBgColor??(e.selectionStyle?.cellBgColor&&"string"==typeof e.selectionStyle.cellBgColor?nS(e.selectionStyle.cellBgColor,.1,!1):void 0)??void 0},get cellBgColor(){if("replace"===e.selectionStyle.selectionFillMode)return t.select?.cellBgColor??e.selectionStyle.cellBgColor??void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){return t.frameStyle?.borderColor??void 0},get borderLineWidth(){return t.frameStyle?.borderLineWidth??void 0},get borderLineDash(){return t.frameStyle?.borderLineDash??void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){return t.underline??!1},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){return t.lineThrough??!1},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function aA(t,e){if(t instanceof sA)return t.hasProperty(e);let i=t;if(!i)return!1;for(let t=0;t<e.length;t++){if(i=i[e[t]],!i)return!1}return!!i}const lA=new sA(KS,KS),hA=new sA($S,$S),cA=new sA(XS,XS),dA=new sA(YS,YS),uA=new sA(qS,qS),gA={DEFAULT:dA,SIMPLIFY:uA,ARCO:cA,DARK:lA,BRIGHT:hA},pA={TableTheme:sA};function fA(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const i=e.toLowerCase();if(t[i])return t[i];const r=e.toLowerCase();if(t[r])return t[r];for(const e in t)if(e.toLowerCase()===i)return t[e]}(mA(),t);return e?e instanceof sA?e:new sA(e,e):null}return t instanceof sA?t:new sA(t,t)}function mA(){return xS(gA,ZS)}var bA={DARK:lA,BRIGHT:hA,ARCO:cA,DEFAULT:dA,SIMPLIFY:uA,theme:pA,of:fA,get:mA},yA=Object.freeze({__proto__:null,ARCO:cA,BRIGHT:hA,DARK:lA,DEFAULT:dA,SIMPLIFY:uA,TableTheme:sA,default:bA,get:mA,of:fA,theme:pA});function CA(t,e,i){if(t.internalProps.customMergeCell){const r=t.getCustomMerge(e,i);if(r)return r.range}if(!t.internalProps.enableTreeNodeMerge&&!t.isHeader(e,i)&&!t.getBodyColumnDefine(e,i)?.mergeCell)return!1;const r=t.getCellRange(e,i);return!(r.start.col===r.end.col&&r.start.row===r.end.row)&&r}class wA{static _components={};static _functions={};static _cellTypes={};static registerComponent(t,e){wA._components[t]=e}static getComponent(t){return wA._components[t]}static registerFunction(t,e){wA._functions[t]=e}static getFunction(t){return wA._functions[t]}static registerCellType(t,e){wA._cellTypes[t]=e}static getCellType(t){return wA._cellTypes[t]}}function vA(t,e,i,r,o,n){const s=function(t,e){const i=new Array(e);for(let r=0;r<e;r++)i[r]=t(r);return i}(t,i);s.sort(((t,e)=>r(n(t),n(e),o)));for(let t=0;t<i;t++)e(t,s[t])}const xA={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function _A(t,e){const i=AS(t);if(TS(i)){const t=i.then((t=>(e(t),t)));return e(t),t}return i}function SA(t,e,i,r,o,n){if(null==t)return;if(TS(t))return t.then((t=>SA(t,e,i,r,o,n)));const s=function(t){if(ES.isObject(t)){const e=t;if(Wx(e.get)&&Wx(e.set))return!0}return!1}(e)?e.get:e;if((void 0===s||""===s)&&Array.isArray(t)){return t[i-o.leftRowSeriesNumberCount]}if(Nx(t)&&s in t){return _A(t[s],n)}if("function"==typeof s){return _A(s(t,i,r,o),n)}if(Array.isArray(s)){const e=function(t,e){let i,r=t;for(;(i=e.shift())&&(r=r[i],r););return r}(t,[...s]);return _A(e,n)}const a=`${s}`.split(".");if(a.length<=1){return _A(t[s],n)}return _A(_S(t,((t,e)=>SA(t,e,i,r,o,zS)),...a),n)}function AA(t,e){if(!t)return e;const i=t[e];return Wx(i)?i:e}class TA extends k_{dataConfig;dataSourceObj;_get;_sourceLength;_source;sortedIndexMap;lastSortStates;currentIndexedData=[];userPagination;pagination;_currentPagerIndexedData;hierarchyExpandLevel=0;static get EVENT_TYPE(){return xA}hasHierarchyStateExpand=!1;beforeChangedRecordsMap=new Map;registedAggregators={};rowHierarchyType="grid";fieldAggregators=[];columns;lastFilterRules;constructor(t,e,i,r,o,n){super(),this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=t?.get,this.columns=r,this._source=t?.records?this.processRecords(t?.records):t,this._sourceLength=this._source?.length||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},n>=1&&(this.hierarchyExpandLevel=n),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===o&&this.initTreeHierarchyState(),this.rowHierarchyType=o,this.updatePagerData()}initTreeHierarchyState(){this._sourceLength=this._source?.length||0,this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let t=this._sourceLength;for(let e=0;e<t;e++){const i=this.currentIndexedData[e],r=this.getOriginalRecord(i);if(!r)continue;const o=r.filteredChildren??r.children;if(o?.length>0){if(this.hierarchyExpandLevel>1?!r.hierarchyState&&(r.hierarchyState=kx.expand):!r.hierarchyState&&(r.hierarchyState=kx.collapse),this.hasHierarchyStateExpand=!0,r.hierarchyState===kx.collapse)continue;const o=this.initChildrenNodeHierarchy(i,this.hierarchyExpandLevel,2,r);e+=o,t+=o}else!0===r.children&&!r.hierarchyState&&(r.hierarchyState=kx.collapse)}}supplementConfig(t,e,i,r){this.columns=e,this._sourceLength=this._source?.length||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=t,this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},r>=1&&(this.hierarchyExpandLevel=r),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===i&&this.initTreeHierarchyState(),this.rowHierarchyType=i,this.updatePagerData()}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(Mx.RECORD,b_),this.registerAggregator(Mx.SUM,v_),this.registerAggregator(Mx.COUNT,x_),this.registerAggregator(Mx.MAX,S_),this.registerAggregator(Mx.MIN,A_),this.registerAggregator(Mx.AVG,__),this.registerAggregator(Mx.NONE,y_),this.registerAggregator(Mx.CUSTOM,C_)}updateColumns(t){this.columns=t}_generateFieldAggragations(){const t=this.columns;this.fieldAggregators=[];const e=t=>{delete t.vtable_aggregator;const e=t.field,i=t.aggregation;if(i)if(Array.isArray(i))for(const r of i){const i=new this.registedAggregators[r.aggregationType]({field:e,formatFun:r.formatFun,isRecord:!0,aggregationFun:r.aggregationFun});this.fieldAggregators.push(i),t.vtable_aggregator||(t.vtable_aggregator=[]),t.vtable_aggregator.push(i)}else{const r=new this.registedAggregators[i.aggregationType]({field:e,formatFun:i.formatFun,isRecord:!0,aggregationFun:i.aggregationFun});this.fieldAggregators.push(r),t.vtable_aggregator=r}},i=t=>{if(t&&0!==t.length)for(const r of t)e(r),r.columns&&i(r.columns)};i(t)}processRecords(t){this._generateFieldAggragations();const e=[],i=this.fieldAggregators.length>=1;if(this.dataConfig?.filterRules?.length>=1||this.lastFilterRules?.length>=1||i){for(let r=0,o=t.length;r<o;r++){const o=t[r];this.dataConfig?.filterRules?.length>=1?this.filterRecord(o)&&(e.push(o),"tree"===this.rowHierarchyType&&o.children&&(o.filteredChildren=this.filteredChildren(o.children)),i&&this.processRecord(o)):this.lastFilterRules?.length>=1?(this.clearFilteredChildren(o),i&&this.processRecord(o)):i&&this.processRecord(o)}if(this.dataConfig?.filterRules?.length>=1)return e}return t}filteredChildren(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];this.filterRecord(r)&&(e.push(r),r.children&&(r.filteredChildren=this.filteredChildren(r.children)))}return e}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++){this.fieldAggregators[e].push(t)}}initChildrenNodeHierarchy(t,e,i,r){let o=0;const n=r.filteredChildren?r.filteredChildren.length:r.children?.length??0;for(let s=0;s<n;s++){(i<=e||r.hierarchyState===kx.expand)&&(o+=1);const n=r.filteredChildren?r.filteredChildren[s]:r.children[s],a=Array.isArray(t)?t.concat(s):[t,s];(i<=e||r.hierarchyState===kx.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+o,0,a),(n.filteredChildren?n.filteredChildren.length>0:n.children?.length>0)&&(i<e||n.hierarchyState===kx.expand?(!n.hierarchyState&&(n.hierarchyState=kx.expand),this.hasHierarchyStateExpand=!0):!n.hierarchyState&&(n.hierarchyState=kx.collapse)),n.hierarchyState===kx.expand&&(o+=this.initChildrenNodeHierarchy(a,e,i+1,n)),!0===n.children&&!n.hierarchyState&&(n.hierarchyState=kx.collapse)}return o}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,r=e*(i||0),o=r+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let e=-1;for(let i=0;i<t.length;i++)if((Array.isArray(t[i])&&1===t[i].length||!Array.isArray(t[i]))&&e++,e>=r&&e<o)this._currentPagerIndexedData.push(t[i]);else if(e>=o)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}getRecordIndexPaths(t){return this._currentPagerIndexedData[t]}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(t){return this.getOriginalRecord(AA(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(AA(this.currentPagerIndexedData,t))}getIndexKey(t){return AA(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?"tree"===this.rowHierarchyType?this.currentPagerIndexedData.findIndex((e=>function(t,e){if(!Ux(t)||!Ux(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}(e,t))):this.currentPagerIndexedData.findIndex((e=>e===t[0])):this.currentPagerIndexedData.findIndex((e=>e===t))}getField(t,e,i,r,o){return this.getOriginalField(AA(this.currentPagerIndexedData,t),e,i,r,o)}getRawField(t,e,i,r,o){return this.getRawFieldData(AA(this.currentPagerIndexedData,t),e,i,r,o)}hasField(t,e){return this.hasOriginalField(AA(this.currentPagerIndexedData,t),e)}getHierarchyState(t){const e=this.getOriginalRecord(this.currentPagerIndexedData[t]);if(e?.hierarchyState){const t=e.hierarchyState;if(e.children?.length>0||!0===e.children)return t}return null}toggleHierarchyState(t,e,i){const r=this.currentIndexedData.slice(0),o=this.getIndexKey(t),n=this.getHierarchyState(t),s=this.getOriginalRecord(o);if(this.clearSortedIndexMap(),n===kx.collapse)s.hierarchyState=kx.expand,this.pushChildrenNode(o,kx.expand,s),this.hasHierarchyStateExpand=!0;else if(n===kx.expand){const t=uS(o,n,s);this.currentIndexedData.splice(this.currentIndexedData.indexOf(o)+1,t),s.hierarchyState=kx.collapse}this.updatePagerData();const a=[],l=[];if(n===kx.collapse){const e=this.currentIndexedData.length-r.length;for(let i=0;i<e;i++)a.push(t+i+1)}else if(n===kx.expand){const e=r.length-this.currentIndexedData.length;for(let i=0;i<e;i++)l.push(t+i+1)}return{add:a,remove:l}}pushChildrenNode(t,e,i){if(!e||e===kx.collapse||e===kx.none)return 0;let r=0;const o=i.filteredChildren?i.filteredChildren:i.children;if(o){const e=Array.from({length:o.length},((t,e)=>e));this.lastSortStates?.forEach((i=>{"normal"!==i.order&&vA((t=>Wx(e[t])?e[t]:e[t]=t),((t,i)=>{e[t]=i}),o.length,i.orderFn,i.order,(e=>this.getOriginalField(Array.isArray(t)?t.concat([e]):[t,e],i.field)))}));for(let i=0;i<e.length;i++){r+=1;const n=Array.isArray(t)?t.concat([e[i]]):[t,e[i]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+r,0,n);const s=this.getOriginalRecord(n);!s.hierarchyState&&(s.filteredChildren??s.children)&&(s.hierarchyState=kx.collapse),r+=this.pushChildrenNode(n,s.hierarchyState,o[e[i]])}}return r}changeFieldValue(t,e,i,r,o,n){if(null!==i&&e>=0){const o=this.getIndexKey(e);if(this.cacheBeforeChangedRecord(o,n),void 0!==i&&""!==i||(i=r-n.leftRowSeriesNumberCount),"string"==typeof i||"number"==typeof i){const e=this.beforeChangedRecordsMap.get(o.toString())?.[i],r=this.getOriginalRecord(o);let n=t;"number"==typeof e&&hS(t)&&(n=parseFloat(t)),TS(r)?r.then((t=>{t[i]=n})).catch((t=>{})):r?r[i]=n:(this.records[o]={},this.records[o][i]=n)}}}cacheBeforeChangedRecord(t,e){if(!this.beforeChangedRecordsMap.has(t.toString())){const e=this.getOriginalRecord(t);this.beforeChangedRecordsMap.set(t.toString(),i_(e,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"])??{})}}setRecord(t,e){let i=!0;if(this.dataConfig?.filterRules?.length>=1&&(this.filterRecord(t)?"tree"===this.rowHierarchyType&&t.children&&(t.filteredChildren=this.filteredChildren(t.children)):i=!1),i&&Array.isArray(this.records)){const i=this.getIndexKey(e);Array.isArray(i)||this.records.splice(i,1,t)}}addRecord(t,e){if(Array.isArray(this.records)){this.records.splice(e,0,t),this.adjustBeforeChangedRecordsMap(e,1),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1;for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t);if("tree"===this.rowHierarchyType&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();this.dataSourceObj?.added&&this.dataSourceObj.added(e,1)}}addRecords(t,e){if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.splice(e,0,...t),this.adjustBeforeChangedRecordsMap(e,t.length);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length;for(let e=0;e<this.fieldAggregators.length;e++)for(let i=0;i<t.length;i++)this.fieldAggregators[e].push(t[i])}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:t,currentPage:i}=this.pagination;e<t*(i||0)+t&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();this.dataSourceObj?.added&&this.dataSourceObj.added(e,t.length)}}addRecordForSorted(t){Array.isArray(this.records)&&(this.beforeChangedRecordsMap.clear(),this.records.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(t){if(Array.isArray(this.records)){if(this.beforeChangedRecordsMap.clear(),Array.isArray(t)){this.records.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}adjustBeforeChangedRecordsMap(t,e,i="add"){for(let r=this.beforeChangedRecordsMap.size-1;r>=t;r--){const t=this.beforeChangedRecordsMap.get(r.toString());this.beforeChangedRecordsMap.delete(r.toString()),this.beforeChangedRecordsMap.set((r+("add"===i?e:-e)).toString(),t)}}deleteRecords(t){if(Array.isArray(this.records)){const e=[],i=t.sort(((t,e)=>e-t));for(let t=0;t<i.length;t++){const r=i[t];if(r>=this._sourceLength||r<0)continue;this.adjustBeforeChangedRecordsMap(r,1,"delete"),e.push(r);const o=this.records[r];for(let t=0;t<this.fieldAggregators.length;t++)this.fieldAggregators[t].deleteRecord(o);this.records.splice(r,1),this.currentIndexedData.pop(),this._sourceLength-=1}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),this.dataSourceObj?.deleted&&this.dataSourceObj.deleted(e),e}return[]}deleteRecordsForSorted(t){if(Array.isArray(this.records)){const e=t.sort(((t,e)=>e-t));for(let t=0;t<e.length;t++){const i=e[t];if(i>=this._sourceLength||i<0)continue;const r=this.currentIndexedData[i];this.records.splice(r,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.beforeChangedRecordsMap.clear()}}updateRecords(t,e){const i=[];for(let r=0;r<e.length;r++){const o=e[r];if(Array.isArray(o))this.beforeChangedRecordsMap.delete(o.toString()),i.push(o),o.slice(0,-1).reduce(((t,e)=>(void 0===t[e]&&(t[e]={}),t[e].children)),this.records)[o[o.length-1]]=t[r];else{if(o>=this._sourceLength||o<0)continue;this.beforeChangedRecordsMap.delete(o.toString()),i.push(o);for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].updateRecord(this.records[o],t[r]);this.records[o]=t[r]}}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];if("number"!=typeof o)return;this.beforeChangedRecordsMap.delete(o.toString()),this.records[o]=t[i]}this.sortedIndexMap.clear()}sort(t){t=(Array.isArray(t)?t:[t]).filter((t=>{const e=this.columns.find((e=>e.field===t.field));return!1!==e?.sort&&"normal"!==t.order})),this.lastSortStates=t;let e=t.map((t=>this.sortedIndexMap.get(t?.field)||{asc:[],desc:[],normal:[]})),i=null;if(e.length>0&&(i=t.reduce(((t,i,r)=>{const o=e[r]?.[i.order];return o&&o.length>0?o:t}),null),i&&i.length>0))return this.currentIndexedData=i,this.updatePagerData(),void this.fireListeners(xA.CHANGE_ORDER,null);const r=Array.from({length:this._sourceLength},((t,e)=>e));if(r.sort(((e,i)=>t.reduce(((t,r)=>{if(0!==t)return t;return(r.orderFn||("desc"!==r.order?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1))(this.getOriginalField(e,r.field),this.getOriginalField(i,r.field),r.order)}),0))),this.currentIndexedData=r,this.hierarchyExpandLevel){let t=r.length;for(let e=0;e<t;e++){const i=this.getOriginalRecord(r[e]),o=this.pushChildrenNode(r[e],i.hierarchyState,this.getOriginalRecord(r[e]));t+=o,e+=o}}if(!e.length){e=t.map((()=>({asc:[],desc:[],normal:[]})));for(let i=0;i<t.length;i++)this.sortedIndexMap.set(t[i].field,e[i])}t.forEach(((t,i)=>{e[i][t.order]=r.slice()})),this.updatePagerData(),this.fireListeners(xA.CHANGE_ORDER,null)}setSortedIndexMap(t,e){this.sortedIndexMap.set(t,e)}clearFilteredChildren(t){t.filteredChildren=void 0;for(let e=0;e<(t.children?.length??0);e++)this.clearFilteredChildren(t.children[e])}filterRecord(t){let e=!0;for(let i=0;i<this.dataConfig.filterRules?.length;i++){const r=this.dataConfig?.filterRules[i];if(r.filterKey){const i=t[r.filterKey];if(-1===r.filteredValues.indexOf(i)){e=!1;break}}else if(!r.filterFunc?.(t)){e=!1;break}}return e}updateFilterRulesForSorted(t){this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(this.dataSourceObj?.records??this.dataSourceObj),this._sourceLength=this._source?.length||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),"tree"===this.rowHierarchyType&&this.initTreeHierarchyState(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords(this.dataSourceObj?.records??this.dataSourceObj),this._sourceLength=this._source?.length||0,this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,"tree"===this.rowHierarchyType&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastSortStates&&this.lastSortStates.length>0&&this.sortedIndexMap.forEach(((t,e)=>{this.lastSortStates.some((t=>t.field===e))?this.lastSortStates.forEach((e=>{"asc"===e.order?(t.desc=[],t.normal=[]):"desc"===e.order?(t.asc=[],t.normal=[]):(t.asc=[],t.desc=[])})):this.sortedIndexMap.delete(e)}))}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(xA.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){super.release?.(),this.lastFilterRules=null,this.clearSortedMap(),this.clearCurrentIndexedData(),this.currentPagerIndexedData.length=0}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach((t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)})),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){let e;return e=this.dataSourceObj.records?Array.isArray(t)?RA(this.records,t):this.records[t]:this._get(t),_A(e,(e=>{this.recordPromiseCallBack(t,e)}))}getRawRecord(t){if(this.beforeChangedRecordsMap?.has(t.toString()))return this.beforeChangedRecordsMap?.get(t.toString());let e;return e=this.dataSourceObj.records?Array.isArray(t)?RA(this.records,t):this.records[t]:this._get(t),_A(e,(e=>{this.recordPromiseCallBack(t,e)}))}getOriginalField(t,e,i,r,o){if(null===e)return;return SA(this.getOriginalRecord(t),e,i,r,o,(i=>{this.fieldPromiseCallBack(t,e,i)}))}getRawFieldData(t,e,i,r,o){if(null===e)return;return SA(this.getRawRecord(t),e,i,r,o,(i=>{this.fieldPromiseCallBack(t,e,i)}))}hasOriginalField(t,e){if(null===e)return!1;if("function"==typeof e)return!0;const i=this.getOriginalRecord(t);return Boolean(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}static EMPTY=new TA({get(){},length:0});canChangeOrder(t,e){if(this.dataSourceObj?.canChangeOrder)return this.dataSourceObj.canChangeOrder(t,e);if(this.hasHierarchyStateExpand){let i=this.currentPagerIndexedData[t],r=this.currentPagerIndexedData[e];if(i=Array.isArray(i)?[...i]:[i],r=Array.isArray(r)?[...r]:[r],e>t&&r.length>i.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<r.length&&r.splice(r.length-1,1)}if(i.length===r.length){for(let t=0;t<=i.length-2;t++)if(i[t]!==r[t])return!1;return!0}return!1}return!0}changeOrder(t,e){if(this.dataSourceObj?.changeOrder)this.dataSourceObj.changeOrder(t,e);else if(!this.lastSortStates?.some((t=>"asc"===t.order||"desc"===t.order))&&this.canChangeOrder(t,e))if(this.hasHierarchyStateExpand){let i,r,o=this.currentPagerIndexedData[t],n=this.currentPagerIndexedData[e];if(o=Array.isArray(o)?[...o]:[o],n=Array.isArray(n)?[...n]:[n],o.length>1||n.length>1){if(e>t&&n.length>o.length){let t=this.currentPagerIndexedData[e+1];t=Array.isArray(t)?[...t]:[t],t.length<n.length&&n.splice(n.length-1,1)}if(i=o.splice(o.length-1,1)[0],r=n.splice(n.length-1,1)[0],o.length>=1){const t=this.getOriginalRecord(o);if(t){const e=t.filteredChildren?t.filteredChildren.splice(i,1):t.children.splice(i,1);e.unshift(r,0),Array.prototype.splice.apply(t.filteredChildren??t.children,e)}}else{const t=this.records.splice(i,1);t.unshift(r,0),Array.prototype.splice.apply(this.records,t)}}else{i=this.currentPagerIndexedData[t],r=this.currentPagerIndexedData[e];const o=this.records.splice(i,1);o.unshift(r,0),Array.prototype.splice.apply(this.records,o)}this.restoreTreeHierarchyState(),this.updatePagerData()}else{const i=this.records.splice(t,1);i.unshift(e,0),Array.prototype.splice.apply(this.records,i)}}restoreTreeHierarchyState(){if(this.hierarchyExpandLevel){for(let t=0;t<this._sourceLength;t++){const e=this.getOriginalRecord(t);if(!e)continue;(e.filteredChildren??e.children)&&!e.hierarchyState&&(e.hierarchyState=kx.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},((t,e)=>e));let t=this._sourceLength;for(let e=0;e<t;e++){const i=this.currentIndexedData[e],r=this.getOriginalRecord(i);if(!r)continue;const o=r.filteredChildren??r.children;if(o?.length>0&&r.hierarchyState===kx.expand){this.hasHierarchyStateExpand=!0;const o=this.restoreChildrenNodeHierarchy(i,r);e+=o,t+=o}else!0===r.children&&!r.hierarchyState&&(r.hierarchyState=kx.collapse)}}}restoreChildrenNodeHierarchy(t,e){let i=0;const r=e.filteredChildren??e.children,o=r?.length??0;for(let n=0;n<o;n++){e.hierarchyState===kx.expand&&(i+=1);const o=r[n],s=Array.isArray(t)?t.concat(n):[t,n];e.hierarchyState===kx.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+i,0,s),i+=this.restoreChildrenNodeHierarchy(s,o)}return i}_setNodeStateRecursive(t,e){if(!t)return;const i=t.filteredChildren??t.children;if(i&&(Array.isArray(i)?i.length>0:!0===i)&&(t.hierarchyState=e),i&&Array.isArray(i))for(const t of i)this._setNodeStateRecursive(t,e)}expandAllNodes(){if(Array.isArray(this._source)){for(const t of this._source)this._setNodeStateRecursive(t,kx.expand);this.hasHierarchyStateExpand=!0,this.clearSortedIndexMap(),this.restoreTreeHierarchyState(),this.lastSortStates&&this.lastSortStates.length>0?this.sort(this.lastSortStates):this.updatePagerData()}}collapseAllNodes(){if(Array.isArray(this._source)){for(const t of this._source)this._setNodeStateRecursive(t,kx.collapse);this.clearSortedIndexMap(),this.restoreTreeHierarchyState(),this.lastSortStates&&this.lastSortStates.length>0?this.sort(this.lastSortStates):this.updatePagerData()}}}function RA(t,e){let i=t;for(let t=0;t<e.length;t++){const r=e[t];if(!i[r])return;i=i[r];const o=i.filteredChildren??i?.children;o&&t+1<e.length&&(i=o)}return i}function BA(t,e){const i=t.sort(((t,i)=>{Xx(t)&&(t=[t]),Xx(i)&&(i=[i]);const r=Math.max(t.length,i.length);for(let o=0;o<r;o++){const r=t[o]??-1,n=i[o]??-1;if(r!==n)return 1===e?r-n:n-r}return 0}));return i}var MA=Array.isArray,PA="object"==typeof J&&J&&J.Object===Object&&J,HA="object"==typeof self&&self&&self.Object===Object&&self,kA=PA||HA||Function("return this")(),EA=kA.Symbol,FA=EA,LA=Object.prototype,IA=LA.hasOwnProperty,zA=LA.toString,OA=FA?FA.toStringTag:void 0;var DA=function(t){var e=IA.call(t,OA),i=t[OA];try{t[OA]=void 0;var r=!0}catch(t){}var o=zA.call(t);return r&&(e?t[OA]=i:delete t[OA]),o},WA=Object.prototype.toString;var NA=DA,GA=function(t){return WA.call(t)},jA=EA?EA.toStringTag:void 0;var VA=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":jA&&jA in Object(t)?NA(t):GA(t)};var UA=VA,KA=function(t){return null!=t&&"object"==typeof t};var $A=function(t){return"symbol"==typeof t||KA(t)&&"[object Symbol]"==UA(t)},XA=MA,YA=$A,qA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ZA=/^\w*$/;var JA=function(t,e){if(XA(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!YA(t))||(ZA.test(t)||!qA.test(t)||null!=e&&t in Object(e))};var QA=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},tT=VA,eT=QA;var iT,rT=function(t){if(!eT(t))return!1;var e=tT(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},oT=kA["__core-js_shared__"],nT=(iT=/[^.]+$/.exec(oT&&oT.keys&&oT.keys.IE_PROTO||""))?"Symbol(src)_1."+iT:"";var sT=function(t){return!!nT&&nT in t},aT=Function.prototype.toString;var lT=rT,hT=sT,cT=QA,dT=function(t){if(null!=t){try{return aT.call(t)}catch(t){}try{return t+""}catch(t){}}return""},uT=/^\[object .+?Constructor\]$/,gT=Function.prototype,pT=Object.prototype,fT=gT.toString,mT=pT.hasOwnProperty,bT=RegExp("^"+fT.call(mT).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var yT=function(t,e){return null==t?void 0:t[e]},CT=function(t){return!(!cT(t)||hT(t))&&(lT(t)?bT:uT).test(dT(t))},wT=yT;var vT=function(t,e){var i=wT(t,e);return CT(i)?i:void 0},xT=vT(Object,"create"),_T=xT;var ST=function(){this.__data__=_T?_T(null):{},this.size=0};var AT=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},TT=xT,RT=Object.prototype.hasOwnProperty;var BT=function(t){var e=this.__data__;if(TT){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return RT.call(e,t)?e[t]:void 0},MT=xT,PT=Object.prototype.hasOwnProperty;var HT=function(t){var e=this.__data__;return MT?void 0!==e[t]:PT.call(e,t)},kT=xT;var ET=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=kT&&void 0===e?"__lodash_hash_undefined__":e,this},FT=ST,LT=AT,IT=BT,zT=HT,OT=ET;function DT(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}DT.prototype.clear=FT,DT.prototype.delete=LT,DT.prototype.get=IT,DT.prototype.has=zT,DT.prototype.set=OT;var WT=DT;var NT=function(){this.__data__=[],this.size=0};var GT=function(t,e){return t===e||t!=t&&e!=e};var jT=function(t,e){for(var i=t.length;i--;)if(GT(t[i][0],e))return i;return-1},VT=jT,UT=Array.prototype.splice;var KT=function(t){var e=this.__data__,i=VT(e,t);return!(i<0)&&(i==e.length-1?e.pop():UT.call(e,i,1),--this.size,!0)},$T=jT;var XT=function(t){var e=this.__data__,i=$T(e,t);return i<0?void 0:e[i][1]},YT=jT;var qT=function(t){return YT(this.__data__,t)>-1},ZT=jT;var JT=function(t,e){var i=this.__data__,r=ZT(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this},QT=NT,tR=KT,eR=XT,iR=qT,rR=JT;function oR(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}oR.prototype.clear=QT,oR.prototype.delete=tR,oR.prototype.get=eR,oR.prototype.has=iR,oR.prototype.set=rR;var nR=oR,sR=vT(kA,"Map"),aR=WT,lR=nR,hR=sR;var cR=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var dR=function(t,e){var i=t.__data__;return cR(e)?i["string"==typeof e?"string":"hash"]:i.map},uR=dR;var gR=function(t){var e=uR(this,t).delete(t);return this.size-=e?1:0,e},pR=dR;var fR=function(t){return pR(this,t).get(t)},mR=dR;var bR=function(t){return mR(this,t).has(t)},yR=dR;var CR=function(t,e){var i=yR(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this},wR=function(){this.size=0,this.__data__={hash:new aR,map:new(hR||lR),string:new aR}},vR=gR,xR=fR,_R=bR,SR=CR;function AR(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}AR.prototype.clear=wR,AR.prototype.delete=vR,AR.prototype.get=xR,AR.prototype.has=_R,AR.prototype.set=SR;var TR=AR;function RR(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var r=arguments,o=e?e.apply(this,r):r[0],n=i.cache;if(n.has(o))return n.get(o);var s=t.apply(this,r);return i.cache=n.set(o,s)||n,s};return i.cache=new(RR.Cache||TR),i}RR.Cache=TR;var BR=RR;var MR=function(t){var e=BR(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e},PR=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,HR=/\\(\\)?/g,kR=MR((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(PR,(function(t,i,r,o){e.push(r?o.replace(HR,"$1"):i||t)})),e})),ER=kR;var FR=function(t,e){for(var i=-1,r=null==t?0:t.length,o=Array(r);++i<r;)o[i]=e(t[i],i,t);return o},LR=FR,IR=MA,zR=$A,OR=EA?EA.prototype:void 0,DR=OR?OR.toString:void 0;var WR=function t(e){if("string"==typeof e)return e;if(IR(e))return LR(e,t)+"";if(zR(e))return DR?DR.call(e):"";var i=e+"";return"0"==i&&1/e==-Infinity?"-0":i},NR=WR;var GR=MA,jR=JA,VR=ER,UR=function(t){return null==t?"":NR(t)};var KR=$A;var $R=function(t){if("string"==typeof t||KR(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},XR=function(t,e){return GR(t)?t:jR(t,e)?[t]:VR(UR(t))},YR=$R;var qR=function(t,e){for(var i=0,r=(e=XR(e,t)).length;null!=t&&i<r;)t=t[YR(e[i++])];return i&&i==r?t:void 0},ZR=qR;var JR=function(t,e,i){var r=null==t?void 0:ZR(t,e);return void 0===r?i:r},QR=Q(JR);class tB extends TA{_recordCache;_fieldCache;groupAggregator;_isGrouped;static get EVENT_TYPE(){return TA.EVENT_TYPE}static ofArray(t,e,i,r,o,n){return new tB({get:e=>t[e],length:t.length,records:t},e,i,r,o,n)}constructor(t,e,i,r,o,n){let s;Ux(e?.groupByRules)&&(o="tree",s=!0),super(t,e,i,r,o,n),this._isGrouped=s,this._recordCache=[],this._fieldCache={}}getOriginalRecord(t){return Xx(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getRawRecord(t){let e,i;if(this._isGrouped){if(e=this.getOriginRecordIndexForGroup(t),Wx(e)&&this.beforeChangedRecordsMap?.has(e.toString()))return this.beforeChangedRecordsMap?.get(e.toString())}else if(this.beforeChangedRecordsMap?.has(t.toString()))return this.beforeChangedRecordsMap?.get(t.toString());return Xx(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:(i=this.dataSourceObj.records?Array.isArray(t)?RA(this.records,t):this.records[t]:this._get(t),_A(i,(e=>{this.recordPromiseCallBack(t,e)})))}getOriginalField(t,e,i,r,o){const n=this._fieldCache&&this._fieldCache[t];if(n){const t=n.get(e);if(t)return t}return super.getOriginalField(t,e,i,r,o)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){!function(t,e,i,r){(t[e]||(t[e]=new Map)).set(i,r)}(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache&&(this._recordCache[t]=e)}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){super.release?.(),this._recordCache=null,this._fieldCache=null}_generateFieldAggragations(){if(super._generateFieldAggragations(),Ux(this.dataConfig?.groupByRules)){const t=this.dataConfig.groupByRules;this.groupAggregator=new this.registedAggregators[Mx.CUSTOM]({field:"",aggregationFun:(e,i,r)=>{const o=new Map,n=[];for(let e=0;e<i.length;e++)eB(i[e],n,o,t,0);return n}}),this.fieldAggregators.push(this.groupAggregator)}}processRecords(t){const e=super.processRecords(t),i=this.groupAggregator?.value();return i||e}getGroupLength(){return this.dataConfig?.groupByRules?.length??0}updateGroup(){this.clearCache();const t=this.source;this._source=this.processRecords(this.dataSourceObj?.records??this.dataSourceObj),t&&iB(t,this.source),this.sourceLength=this.source?.length||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this.sourceLength},((t,e)=>e)),this.userPagination||(this.pagination.perPageCount=this.sourceLength,this.pagination.totalCount=this.sourceLength),this.initTreeHierarchyState(),this.updatePagerData()}getOriginRecordIndexForGroup(t){const e=this.getOriginalRecord(t);if(Wx(e)&&!(e.children&&e.children.length>0))for(let t=0;t<this.dataSourceObj.records.length;t++)if(this.dataSourceObj.records[t]===e)return t}addRecordsForGroup(t,e){if(!Ux(t)||0===t.length)return;let i=this.getOriginRecordIndexForGroup(e);(void 0===i||i>this.dataSourceObj.records)&&(i=this.dataSourceObj.records.length),this.dataSourceObj.records.splice(i,0,...t),this.adjustBeforeChangedRecordsMap(i,t.length),this.updateGroup()}deleteRecordsForGroup(t){if(!Ux(t)||0===t.length)return;const e=BA(t,-1);for(let t=0;t<e.length;t++){const i=e[t];if(Xx(i)&&(i>=this.sourceLength||i<0))continue;const r=this.getOriginRecordIndexForGroup(i);this.beforeChangedRecordsMap.delete(r.toString()),this.dataSourceObj.records.splice(r,1),this.sourceLength-=1,this.adjustBeforeChangedRecordsMap(r,1,"delete")}this.updateGroup()}updateRecordsForGroup(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(Xx(r)&&(r>=this.sourceLength||r<0))continue;const o=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records[o]=t[i]}this.updateGroup()}addRecordsForTree(t,e){if(Ux(t)&&0!==t.length){if(this.adjustBeforeChangedRecordsMap(e,t.length),Xx(e))this.dataSourceObj.records.splice(e,0,...t);else{const i=[...e],r=i.pop(),o=this.getOriginalRecord(i);o.children?o.children.splice(r,0,...t):o.children=t}this.initTreeHierarchyState(),this.updatePagination()}}deleteRecordsForTree(t){if(!Ux(t)||0===t.length)return[];const e=BA(t,-1),i=[];for(let t=0;t<e.length;t++){const r=e[t];if(!Xx(r)||!(r>=this.sourceLength||r<0)){if(this.beforeChangedRecordsMap.delete(r.toString()),Xx(r))this.dataSourceObj.records.splice(r,1);else{const t=[...r],e=t.pop();this.getOriginalRecord(t).children.splice(e,1)}this.adjustBeforeChangedRecordsMap(r,1,"delete"),i.push(r)}}return this.initTreeHierarchyState(),this.updatePagination(),i}updateRecordsForTree(t,e){for(let i=0;i<e.length;i++){const r=e[i],o=t[i];if(!Xx(r)||!(r>=this.sourceLength||r<0))if(this.beforeChangedRecordsMap.delete(r.toString()),Xx(r))this.dataSourceObj.records.splice(r,1,o);else{const t=[...r],e=t.pop();this.getOriginalRecord(t).children.splice(e,1,o)}}this.initTreeHierarchyState(),this.updatePagerData()}adjustBeforeChangedRecordsMap(t,e,i="add"){if("tree"===this.rowHierarchyType){let r;r=Xx(t)?[t]:t;const o=[];this.beforeChangedRecordsMap.forEach(((t,n)=>{const s=n.split(","),a=Math.max(s.length,r.length);for(let l=0;l<a;l++){const a=r[l]??-1,h=Number(s[l])??-1;if(a<h||a===h&&l===s.length-1&&l===r.length-1)return s[l]=(h+("add"===i?e:-e)).toString(),void o.push({originKey:n,targetKey:s.toString(),value:t})}})),o.forEach((({originKey:t,targetKey:e,value:i})=>{this.beforeChangedRecordsMap.delete(t),this.beforeChangedRecordsMap.set(e,i)}))}else super.adjustBeforeChangedRecordsMap(t,e,i)}cacheBeforeChangedRecord(t,e){const i=this.getOriginalRecord(t);e.internalProps.groupBy&&(t=this.getOriginRecordIndexForGroup(t)),this.beforeChangedRecordsMap.has(t.toString())||this.beforeChangedRecordsMap.set(t.toString(),i_(i,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"])??{})}getGroupSeriesNumber(t){const e=this.dataSource.currentIndexedData[t],i=e.length-1;let r=e.length,o=1;for(;r>i;o++){const e=this.dataSource.currentIndexedData[t-o];r=Xx(e)?1:e.length}return o-1}}function eB(t,e,i,r,o){const n=r[o];if(!Wx(n))return void e.push(t);const s=QR(t,n);if(void 0!==s){if(i.has(s)){const n=i.get(s);return eB(t,e[n].children,e[n].map,r,o+1)}return i.set(s,e.length),e.push({vtableMerge:!0,vtableMergeName:s,children:[],map:new Map}),eB(t,e[e.length-1].children,e[e.length-1].map,r,o+1)}}function iB(t,e,i,r){if(!i){i=new Map;for(let e=0;e<t.length;e++){const r=t[e];r.vtableMerge&&i.set(r.vtableMergeName,e)}}if(!r){r=new Map;for(let t=0;t<e.length;t++){const i=e[t];i.vtableMerge&&r.set(i.vtableMergeName,t)}}for(let i=0;i<t.length;i++){const o=t[i],n=e[r.get(o.vtableMergeName)];Wx(n)&&(n.hierarchyState=t[i].hierarchyState),Ux(o.children)&&Ux(n.children)&&0!==o.map.size&&0!==n.map.size&&iB(o.children,n.children,o.map,n.map)}}var rB=Object.freeze({__proto__:null,CachedDataSource:tB,DataSource:TA}),oB={exports:{}},nB={},sB=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),aB=["style","variant","weight","size","lineHeight","family"],lB=/([\.0-9]+)(.*)/,hB=function(t,e,i){var r=t.match(lB);if(r){t=parseFloat(r[1]);var o=r[2].toLowerCase().trim(),n=Math.round(t);switch(n===t&&(t=n),o){case"em":if(null===e)return;return t*e;case"px":return t;case"pt":return t/(72/i);case"pc":return t/(6/i);case"mm":return t*(i/25.4);case"cm":return t*(i/2.54);case"in":return t*i;case"%":if(null===e)return;return e*(t/100)}}},cB={size:hB,lineHeight:hB},dB={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},uB=oB.exports=function(t,e,i){var r=t+"-"+(e||"null")+"@"+i;if(i=i||96,void 0!==nB[r])return nB[r];if(e&&(e=uB(e,null,i)),"inherit"===t)return e;var o=sB.exec(t);if(o){o.shift();for(var n={},s=0;s<o.length;s++){var a=aB[s],l=o[s];if(cB[a]&&l){var h=e&&e[a]||null,c=cB[a](l,h,i);l=void 0===c&&"lineHeight"===a&&l?n.size*parseFloat(l):c}if(l&&"normal"!==l){if("inherit"===l){if(!e)return;l=e[a]}l.trim&&(l=l.trim()),n[a]=l}}Object.keys(n).length||(n=null),nB[r]=n;var d=[];n.style&&d.push(n.style),n.variant&&d.push(n.variant),n.weight&&"400"!==n.weight&&"normal"!==n.weight&&d.push(n.weight),d.push(n.size+"px"),n.lineHeight&&(d[d.length-1]+="/"+n.lineHeight+"px");var u=n.family.split(",");return n.family=u.map((function(t){return t=t.trim(),dB[t.toLowerCase()]&&(t=t.toLowerCase()),t})),d.push(n.family),Object.defineProperty(n,"toString",{value:function(){return d.map((function(t){return Array.isArray(t)?t.map((function(t){return t.indexOf(" ")>-1?'"'+t.replace(/["']/g,"")+'"':t})).join(", "):t})).join(" ")}}),n}nB[r]=null};oB.exports.generics=dB;var gB=Q(oB.exports);function pB(t){if(Xx(t)||Vx(t)||Ux(t)){let e=_n(t);return"number"==typeof e||"string"==typeof e?e=[e,e,e,e]:Array.isArray(e)&&(e=e.slice(0)),e}return t&&(isFinite(t.bottom)||isFinite(t.left)||isFinite(t.right)||isFinite(t.top))?[t.top??0,t.right??0,t.bottom??0,t.left??0]:[0,0,0,0]}const fB=0,mB=1,bB=2,yB=3,CB=10,wB=11,vB=12,xB=9,_B=13,SB=10,AB=12,TB=32,RB=37,BB=46,MB=48,PB=57,HB=65,kB=90,EB=97,FB=122;function LB(t){return function(t){return t>=EB&&t<=FB}(t)||function(t){return t>=HB&&t<=kB}(t)}function IB(t){return t===xB||t===SB||t===AB||t===_B||t===TB}function zB(t){return t>=MB&&t<=PB}function OB(t){return t===BB}function DB(t){return LB(t)||t===RB}function WB(t){return new Error(`calc parse error: ${t}`)}const NB={"*":3,"/":3,"+":2,"-":2};function GB(t,e){function i(t){const i=t.pop(),r=t.pop(),o=t.pop();if(!(o&&o.nodeType&&r&&r.type===bB&&i&&i.nodeType))throw WB(e);return{nodeType:wB,left:o,op:r,right:i}}const r=[];for(;t.length;){const o=t.shift();if(o.type===fB&&"("===o.value){let i=0;const o=mS.findIndex(t,(t=>{if(t.type===fB&&"("===t.value)i++;else if(t.type===fB&&")"===t.value){if(!i)return!0;i--}return!1}));if(-1===o)throw WB(e);r.push(GB(t.splice(0,o),e)),t.shift()}else if(o.type===bB){if(r.length>=3){const t=r[r.length-2].value;NB[o.value]<=NB[t]&&r.push(i(r))}r.push(o)}else if(o.type===mB){const{value:t,unit:e}=o;r.push({nodeType:CB,value:t,unit:e})}else o.type===yB&&r.push({nodeType:vB,value:o.value})}for(;r.length>1;)r.push(i(r));return r[0]}function jB(t){const e=function(t){const e=t.replace(/calc\(/g,"(").trim(),i=[],r=e.length;for(let s=0;s<r;s++){const r=e[s],a=r.charCodeAt(0);if("("===r||")"===r)i.push({value:r,type:fB});else if("*"===r||"/"===r)i.push({value:r,type:bB});else if("+"===r||"-"===r)s=o(r,s+1)-1;else if(zB(a)||OB(a))s=n(r,s+1)-1;else if(!IB(a))throw WB(t)}function o(t,o){if(o<r){const i=e[o],r=i.charCodeAt(0);if(zB(r)||OB(r))return n(t+i,o+1)}return i.push({value:t,type:bB}),o}function n(o,n){let a=n;for(;a<r;a++){const i=e[a],r=i.charCodeAt(0);if(zB(r))o+=i;else{if("."!==i){if(DB(r))return s(o,i,a+1);break}if(o.indexOf(".")>=0)throw WB(t);o+=i}}if("."===o)throw WB(t);return i.push({value:parseFloat(o),type:yB}),a}function s(t,o,n){let s=n;for(;s<r;s++){const t=e[s];if(!DB(t.charCodeAt(0)))break;o+=t}return i.push({value:parseFloat(t),unit:o,type:mB}),s}return i}(t);return GB(e,t)}function VB(t,e){if(t.nodeType===wB){const i=VB(t.left,e),r=VB(t.right,e);switch(t.op.value){case"+":return i+r;case"-":return i-r;case"*":return i*r;case"/":return i/r;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if(t.nodeType===CB)switch(t.unit){case"%":return t.value*e.full/100;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if(t.nodeType===vB)return t.value;throw new Error("calc error.")}function UB(t,e){return VB(jB(t),e)}function KB(t){return!!Vx(t)&&(!!t.endsWith("%")&&function(t){return!(Dx(t)||!Xx(t)&&+t!=+t)}(t.substring(0,t.length-1)))}function $B(t,e){const{dataSourceEventIds:i}=t.internalProps;i&&i.forEach((e=>t.internalProps.handler.off(e))),e(t),t.internalProps.dataSourceEventIds=[t.internalProps.handler.on(t.internalProps.dataSource,TA.EVENT_TYPE.CHANGE_ORDER,(()=>{t.dataSource.hierarchyExpandLevel&&t.refreshRowColCount(),t.render()}))]}function XB(t,e=[]){$B(t,(()=>{t.internalProps.records=e;const i=t.internalProps.dataSource=tB.ofArray(e,t.internalProps.dataConfig,t.pagination,t.internalProps.columns,t.internalProps.layoutMap.rowHierarchyType,YB(t));t.addReleaseObj(i)}))}function YB(t){return t.options.hierarchyExpandLevel?t.options.hierarchyExpandLevel:t.internalProps.groupBy?1/0:t._hasHierarchyTreeHeader?.()?1:void 0}function qB(t,e){return Math.round((i=e,r=t.internalProps.calcWidthContext,"string"==typeof i?UB(i.trim(),r):i-0));var i,r}function ZB(t,e,i,r,o,n=!0){const s=pB(o("padding",t,i,r,e)),a=o("bgColor",t,i,r,e),l=o("font",t,i,r,e);let h,c,d,u,g;if(l){const{family:t,size:e,weight:i,style:r,variant:o}=function(t){return gB(t)}(l);h=t.join(" "),c=e,d=i,u=r,u=o}else h=o("fontFamily",t,i,r,e),c=o("fontSize",t,i,r,e),d=o("fontWeight",t,i,r,e),u=o("fontStyle",t,i,r,e),g=o("fontVariant",t,i,r,e);const p=o("textAlign",t,i,r,e),f=o("textBaseline",t,i,r,e),m=o("color",t,i,r,e),b=o("strokeColor",t,i,r,e),y=o("lineHeight",t,i,r,e),C=o("underline",t,i,r,e),w=o("underlineDash",t,i,r,e),v=o("underlineOffset",t,i,r,e),x=o("lineThrough",t,i,r,e),_=Math.max(1,Math.floor(c/10)),S=o("textOverflow",t,i,r,e),A=o("borderColor",t,i,r,e),T=o("borderLineWidth",t,i,r,e),R=o("borderLineDash",t,i,r,e),B=o("marked",t,i,r,e),M=o("cursor",t,i,r,e),P=!(s&&a&&l&&p&&f&&m&&S&&A&&T&&R&&"boolean"==typeof C&&"boolean"==typeof x&&"boolean"==typeof B);if(!n)return{hasFunctionPros:P};const H={text:{fontFamily:h,fontSize:c,fontWeight:d,fontStyle:u,fontVariant:g,fill:m,stroke:b??!1,textAlign:p,textBaseline:f,lineHeight:y??c,underline:C?_:void 0,underlineDash:w,underlineOffset:v,lineThrough:x?_:void 0,ellipsis:"clip"===S?"":"ellipsis"===S?"...":Wx(S)?S:void 0},group:{fill:a,lineDash:R,lineWidth:T,stroke:A,cursor:"auto"===M||"default"===M?void 0:M},_vtable:{padding:s,marked:B}};if(Array.isArray(T)&&(H.group.strokeArrayWidth=pB(T)),Array.isArray(A)){const t=pB(A);H.group.stroke=!t.every((t=>!t))&&t,H.group.strokeArrayColor=pB(A)}return{theme:H,hasFunctionPros:P}}function JB(t,e,i){const r=i.theme.frameStyle.cornerRadius;if(i.theme.cellInnerBorder){if(Array.isArray(r)){const o=[0,0,0,0];return 0===t&&0===e&&(o[0]=r[0]),t===i.colCount-1&&0===e&&(o[1]=r[1]),0===t&&e===i.rowCount-1&&(o[3]=r[3]),t===i.colCount-1&&e===i.rowCount-1&&(o[2]=r[2]),o}if(r){const o=[0,0,0,0];return 0===t&&0===e&&(o[0]=r),t===i.colCount-1&&0===e&&(o[1]=r),0===t&&e===i.rowCount-1&&(o[3]=r),t===i.colCount-1&&e===i.rowCount-1&&(o[2]=r),o}}return 0}function QB(t){if(t){if(Array.isArray(t)){let e;for(let i=0;i<t.length;i++)if(t[i].autoRange){if("sum"===t[i].y||"sum"===t[i].x||"sum"===t[i].y1||"sum"===t[i].x1)return"sum";"max"!==t[i].y&&"max"!==t[i].x&&"max"!==t[i].y1&&"max"!==t[i].x1||(e="max"),"number"==typeof t[i].y&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].y)),"number"==typeof t[i].x&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].x)),"number"==typeof t[i].y1&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].y1)),"number"==typeof t[i].x1&&"number"==typeof(e??0)&&(e=Math.max(e??0,t[i].x1))}return e}if(t.autoRange){if("sum"===t.y||"sum"===t.x||"sum"===t.y1||"sum"===t.x1)return"sum";if("max"===t.y||"max"===t.x||"max"===t.y1||"max"===t.x1)return"max";if("number"==typeof t.y)return t.y;if("number"==typeof t.x)return t.x;if("number"==typeof t.y1)return t.y1;if("number"==typeof t.x1)return t.x1}}}function tM(t){for(let e=0;e<t.internalProps.columns.length;e++){const i=t.internalProps.columns[e];if(i.aggregation);else if(t.options.aggregation){let r;if(r="function"==typeof t.options.aggregation?t.options.aggregation({col:e,field:i.field}):t.options.aggregation,r)if(Array.isArray(r)){const t=[];r.forEach((e=>{t.push(Object.assign({showOnTop:!1},e))})),i.aggregation=t}else i.aggregation=Object.assign({showOnTop:!1},r)}}}function eM(t){for(let e=0;e<t.length;e++){if(t[e].aggregation)return!0}return!1}let iM,rM,oM,nM,sM,aM,lM,hM,cM,dM,uM,gM,pM,fM,mM,bM,yM,CM,wM,vM,xM,_M,SM,AM;function TM(t){iM=t?.sort_color??"#282F38",rM=t?.sort_color_opacity??"0.35",oM=t?.sort_color_2??"#416EFF",nM=t?.sort_color_opacity_2??"1",sM=t?.sort_size??16,aM=t?.sort_size_2??22,lM=t?.frozen_color??"#282F38",hM=t?.frozen_color_opacity??"0.35",cM=t?.frozen_color_opacity??"0.2",dM=t?.frozen_color_2??"#416EFF",uM=t?.frozen_color_opacity_2??"1",gM=t?.frozen_size??22,pM=t?.frozen_size_2??22,fM=t?.collapse_color??"#141414",mM=t?.collapse_color_opacity??"0.65",bM=t?.collapse_size??16,yM=t?.frozen_size_2??22,CM=t?.expand_color??"#141414",wM=t?.expand_color_opacity??"0.65",vM=t?.expand_size??16,xM=t?.expand_size_2??22,_M=t?.dragReorder_color??"#666666",SM=t?.dragReorder_color_opacity??"1",AM=t?.dragReorder_size??20}const RM={get sort_downward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${oM}"  fill-opacity="${nM}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${iM}" fill-opacity="${rM}"/></svg> `,width:sM,height:sM,funcType:Fx.sort,name:"sort_downward",positionType:Ex.contentRight,marginLeft:3,hover:{width:aM,height:aM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${iM}"  fill-opacity="${rM}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${oM}"  fill-opacity="${nM}"/> </svg>`,width:sM,height:sM,funcType:Fx.sort,positionType:Ex.contentRight,name:"sort_upward",marginLeft:3,hover:{width:aM,height:aM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${iM}" fill-opacity="${rM}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${iM}" fill-opacity="${rM}"/></svg> `,width:sM,height:sM,funcType:Fx.sort,positionType:Ex.contentRight,name:"sort_normal",marginLeft:3,hover:{width:aM,height:aM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="${lM}" fill-opacity="${cM}"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>`,width:gM,height:gM,name:"freeze",funcType:Fx.frozen,positionType:Ex.right,marginRight:0,hover:{width:pM,height:pM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="${lM}" fill-opacity="${hM}"/></svg>`,width:gM,height:gM,name:"frozen",funcType:Fx.frozen,positionType:Ex.right,marginRight:0,hover:{width:pM,height:pM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z"  fill="${dM}" fill-opacity="${uM}"/></svg>`,width:gM,height:gM,funcType:Fx.frozen,positionType:Ex.right,name:"frozenCurrent",marginRight:0,hover:{width:pM,height:pM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:Fx.dropDown,positionType:Ex.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:Fx.play,positionType:Ex.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:Fx.damagePic,positionType:Ex.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:Ex.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="${CM}" fill-opacity="${wM}"/>\n      </svg>`,width:vM,height:vM,funcType:Fx.expand,name:"expand",positionType:Ex.contentLeft,marginLeft:0,marginRight:4,hover:{width:xM,height:xM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\n      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z"  fill="${fM}" fill-opacity="${mM}"/>\n      </svg>`,width:bM,height:bM,funcType:Fx.collapse,name:"collapse",positionType:Ex.contentLeft,marginLeft:0,marginRight:4,hover:{width:yM,height:yM,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:Ex.absolute,funcType:Fx.drillDown,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:Ex.absolute,funcType:Fx.drillUp,svg:'<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:`<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${_M}"  fill-opacity="${SM}" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${_M}"  fill-opacity="${SM}" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${_M}"  fill-opacity="${SM}" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${_M}"  fill-opacity="${SM}" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${_M}"  fill-opacity="${SM}" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${_M}"  fill-opacity="${SM}" p-id="5172"></path></svg>`,width:AM,height:AM,funcType:Fx.dragReorder,positionType:Ex.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}},BM={};function MM(){return xS(RM,BM)}let PM=class extends ph{role;tooltip;frameImageData;tempCanvas;tempCtx;gifCanvas;gifCtx;loadedFrames;frameIndex;playing;lastTime;constructor(t){super(t),"mouseenter_cell"!==this.attribute.visibleTime&&"click_cell"!==this.attribute.visibleTime||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image),this.attribute.isGif&&this.attribute.gif&&this.loadGif()}loadGif(){this.playing=!1,yn.GetFile(this.attribute.gif+"?role=gif"+`&radom=${Math.random()}`,"arrayBuffer").then((t=>{const e=Lb(t),i=Mb(e,!0);this.renderGIF(i),this.resources.set(this.attribute.image,{state:"success",data:this.gifCanvas})})).catch((t=>{}))}get backgroundWidth(){return this.attribute.backgroundWidth??this.attribute.width??0}get backgroundHeight(){return this.attribute.backgroundHeight??this.attribute.height??0}renderGIF(t){this.loadedFrames=t,this.frameIndex=0,this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d")),this.gifCanvas||(this.gifCanvas=document.createElement("canvas"),this.gifCtx=this.gifCanvas.getContext("2d")),this.gifCanvas.width=t[0].dims.width,this.gifCanvas.height=t[0].dims.height,this.playing=!0,this.lastTime=(new Date).getTime(),this.animate().to({},1e3,"linear").loop(1/0)}renderFrame(t,e,i){const r=this.loadedFrames[this.frameIndex||0];2===r.disposalType&&this.gifCtx.clearRect(0,0,this.gifCanvas.width,this.gifCanvas.height),this.drawPatch(r),this.manipulate(t,e,i);const o=(new Date).getTime()-this.lastTime;r.delay<o&&(this.frameIndex++,this.lastTime=(new Date).getTime()),this.frameIndex>=this.loadedFrames.length&&(this.frameIndex=0)}drawPatch(t){const e=t.dims;this.frameImageData&&e.width===this.frameImageData.width&&e.height===this.frameImageData.height||(this.tempCanvas.width=e.width,this.tempCanvas.height=e.height,this.frameImageData=this.tempCtx.createImageData(e.width,e.height)),this.frameImageData.data.set(t.patch),this.tempCtx.putImageData(this.frameImageData,0,0),this.gifCtx.drawImage(this.tempCanvas,e.left,e.top)}manipulate(t,e,i){t.drawImage(this.gifCanvas,0,0,this.gifCanvas.width,this.gifCanvas.height,e,i,this.attribute.width,this.attribute.height)}setAttribute(t,e,i,r){super.setAttribute(t,e,i,r),"gif"===t&&this.loadGif()}setAttributes(t,e,i){super.setAttributes(t,e,i),t.gif&&this.loadGif()}failCallback=()=>{const t=MM(),{svg:e,src:i}=t.damage_pic||{},r=e||i;r&&(super.image=r)}};class HM extends ql{role;tooltip;constructor(t){t.fill=t.fill??"#00F",t.fontSize=t.fontSize??12,t.underline=t.underline??1,t.textBaseline=t.textBaseline??"top",t.cursor=t.cursor??"pointer",super(t)}}function kM(t){return{rootContainer:new rl({}),renderDefault:!0}}class EM{removeAllContainer;table;customLayoutFuncCache;reactRemoveGraphicCache;reactRemoveAllGraphicCache;headerCustomLayoutFuncCache;headerReactRemoveGraphicCache;headerReactRemoveAllGraphicCache;constructor(t){this.table=t,this.customLayoutFuncCache=new Map,this.reactRemoveGraphicCache=new Map,this.reactRemoveAllGraphicCache=new Map,this.headerCustomLayoutFuncCache=new Map,this.headerReactRemoveGraphicCache=new Map,this.headerReactRemoveAllGraphicCache=new Map}hasReactCreateGraphic(t,e){return e?this.headerCustomLayoutFuncCache.has(t):this.customLayoutFuncCache.has(t)}setReactCreateGraphic(t,e,i){i?this.headerCustomLayoutFuncCache.set(t,e):this.customLayoutFuncCache.set(t,e)}setReactRemoveGraphic(t,e,i){i?this.headerReactRemoveGraphicCache.set(t,e):this.reactRemoveGraphicCache.set(t,e)}setReactRemoveAllGraphic(t,e,i){i?this.headerReactRemoveAllGraphicCache.set(t,e):this.reactRemoveAllGraphicCache.set(t,e)}updateCustomCell(t,e){const i=this.table;if("autoWidth"===i.widthMode&&i.scenegraph.recalculateColWidths(),(i.isAutoRowHeight()||"auto"===i.internalProps.defaultRowHeight&&!e||"auto"===i.internalProps.defaultHeaderRowHeight&&e)&&i.scenegraph.recalculateRowHeights(),i.isPivotTable()){const r=function(t,e,i){const r=e.internalProps.rowSeriesNumber?1:0,o=[],n=e.internalProps.layoutMap;if(i){const{headerObjects:e}=n,i=[];for(let r=0;r<e.length;r++){const o=e[r];o&&(o.define.componentId===t&&i.push(o.id))}for(let t=0;t<i.length;t++){const e=i[t],r=n.getHeaderCellAdressById(e),s=n.getCellRange(r.col,r.row);o.push(s)}}else{let e;const{columnObjects:i,indicatorsAsCol:s}=n;for(let r=0;r<i.length;r++){if(i[r].define.componentId===t){e=r;break}}if(s)for(let t=n.rowHeaderLevelCount+e;t<n.colCount;t+=i.length){const e={start:{col:t+r,row:n.columnHeaderLevelCount},end:{col:t+r,row:n.rowCount-1}};o.push(e)}else for(let t=n.columnHeaderLevelCount+e;t<n.rowCount;t+=i.length){const e={start:{col:n.rowHeaderLevelCount+r,row:t},end:{col:n.colCount-1,row:t}};o.push(e)}}return o}(t,i,e);for(let t=0;t<r.length;t++){const e=r[t];for(let t=e.start.col;t<=e.end.col;t++)for(let r=e.start.row;r<=e.end.row;r++)i.scenegraph.updateCellContent(t,r)}}else{const r=function(t,e,i){const r=e.internalProps.rowSeriesNumber?1:0;if(i){const i=e.internalProps.layoutMap,{headerObjects:r}=e.internalProps.layoutMap;let o;for(let e=0;e<r.length;e++){const i=r[e];if(i.define.componentId===t){o=i.id;break}}const n=i.getHeaderCellAdressById(o);return i.getCellRange(n.col,n.row)}const{columnObjects:o}=e.internalProps.layoutMap;for(let i=0;i<o.length;i++){if(o[i].define.componentId===t)return{start:{col:r+i,row:e.columnHeaderLevelCount},end:{col:r+i,row:e.rowCount-1}}}return{start:{col:0,row:0},end:{col:e.colCount-1,row:e.rowCount-1}}}(t,i,e);for(let t=r.start.col;t<=r.end.col;t++)for(let e=r.start.row;e<=r.end.row;e++)i.scenegraph.updateCellContent(t,e)}i.scenegraph.renderSceneGraph()}getCustomLayoutFunc(t,e){if(this.table.isHeader(t,e)){const{componentId:i}=this.table.getHeaderDefine(t,e);return this.headerCustomLayoutFuncCache.get(i)??kM}const{componentId:i}=this.table.getBodyColumnDefine(t,e);return this.customLayoutFuncCache.get(i)||kM}removeCustomCell(t,e){let i;if(this.table.isHeader(t,e)){const r=this.table.getHeaderDefine(t,e),{componentId:o}=r;i=this.headerReactRemoveGraphicCache.get(o)}else{const r=this.table.getBodyColumnDefine(t,e),{componentId:o}=r;i=this.reactRemoveGraphicCache.get(o)}i&&i(t,e)}clearCache(){this.reactRemoveAllGraphicCache.forEach((t=>{t()})),this.headerReactRemoveAllGraphicCache.forEach((t=>{t()}))}updateAllCustomCell(){this.customLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e)})),this.headerCustomLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e,!0)}))}}function FM(t){const e={abstractPos:{x:t.viewport.x,y:t.viewport.y}},i=LM(t.target);return i&&(e.eventArgs={col:i.col,row:i.row,event:t,targetCell:i,mergeInfo:IM(i),target:t.target}),e}function LM(t){for(;t&&t.parent;){if("cell"===t.role)return t;t=t.parent}return null}function IM(t){if(Wx(t.mergeStartCol)&&Wx(t.mergeStartRow)&&Wx(t.mergeEndCol)&&Wx(t.mergeEndRow))return{colStart:t.mergeStartCol,colEnd:t.mergeEndCol,rowStart:t.mergeStartRow,rowEnd:t.mergeEndRow}}const zM=/radio-\d+-\d+-(\d+)/,OM="_custom_",DM="custom-container",WM=OM+"_0";function NM(t,e,i,r,o,n,s,a,l,h,c){let d,u,g,p,f=!0,m=!1;if("react-custom-layout"===t&&(t=c.reactCustomLayout?.getCustomLayoutFunc(i,r)||kM),"function"==typeof t){const e=t({col:h?.start.col??i,row:h?.start.row??r,dataValue:c.getCellOriginValue(i,r),value:c.getCellValue(i,r)||"",rect:{left:0,top:0,right:o,bottom:n,width:o,height:n},table:c,originCol:i,originRow:r});if(!e)return{renderDefault:!0};e.rootContainer&&(e.rootContainer=VM(e.rootContainer,c.animationManager.timeline)),e.rootContainer instanceof rl&&(p=e.rootContainer,p.name=DM,p.col=i,p.row=r),f=e.renderDefault,m=e.enableCellPadding}else if("function"==typeof e){const t=e({col:i,row:r,dataValue:c.getCellOriginValue(i,r),value:c.getCellValue(i,r)||"",rect:{left:0,top:0,right:o,bottom:n,width:o,height:n},table:c});t&&(g=t.elements,f=t.renderDefault,d=t.expectedWidth,u=t.expectedHeight)}else e&&(d=e.expectedWidth,u=e.expectedHeight,g=e.elements,f=e.renderDefault);if(g){p=function(t,e,i,r){const o=new rl({x:0,y:0,width:e,height:i,fill:!1,stroke:!1,pickable:!1});o.name=DM;const n=function(t,e,i,r){const o=[],n=0,s=0,a=[0,0,0,0];for(let l=0;l<t.length;l++){const h=t[l],c=Object.assign({},h);for(const t in c)c.hasOwnProperty(t)&&Ox(c[t])&&(c[t]=c[t](r));const d=c;Wx(d.x)&&(d.x=Vx(d.x)?GM(d.x,e-a[1]):Number(d.x)),Wx(d.y)&&(d.y=Vx(d.y)?GM(d.y,i-a[2]):Number(d.y)),"width"in c&&(c.width=Vx(c.width)?GM(c.width,e-a[1]):Number(c.width)),"height"in c&&(c.height=Vx(c.height)?GM(c.height,i-a[2]):Number(c.height)),"radius"in c&&(c.radius=Vx(c.radius)?GM(c.radius,Math.min(e-a[1],i-a[2])):Number(c.radius)),"hover"in c&&(c.hover.x=Vx(c.hover.x)?GM(c.hover.x,e-a[1]):Number(c.hover.x),c.hover.y=Vx(c.hover.y)?GM(c.hover.y,i-a[2]):Number(c.hover.y),c.hover.width=Vx(c.hover.width)?GM(c.hover.width,e-a[1]):Number(c.hover.width),c.hover.height=Vx(c.hover.height)?GM(c.hover.height,i-a[2]):Number(c.hover.height),c.hover.x+=n,c.hover.y+=s),d.x=d.x+n,d.y=d.y+s,o.push(c)}return o}(t,e,i,r);return n.forEach((t=>{switch(t.clickable&&(t.pickable=t.clickable),t.type){case"arc":const e=Bh({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,fill:t.fill,stroke:t.stroke,outerRadius:t.radius,startAngle:t.startAngle,endAngle:t.endAngle,pickable:!!t.pickable,cursor:t.cursor});e.name=t.name,o.appendChild(e);break;case"text":if(t.background){const e=t.background?.expandX??0,i=t.background?.expandY??0,r=hh({x:t.x-e,y:t.y-i,dx:t.dx??0,dy:t.dy??0,width:t.width+2*e,height:t.height+2*i,cornerRadius:t.background?.cornerRadius??0,fill:t.background?.fill??"#888"});o.appendChild(r)}const i=new ql(Object.assign({pickable:!!t.pickable,fill:t.color??t.fill},t));i.name=t.name,o.appendChild(i);break;case"rect":const r=hh({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,width:t.width,height:t.height,cornerRadius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});r.name=t.name,o.appendChild(r);break;case"circle":const n=$l({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,radius:t.radius,fill:t.fill,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});n.name=t.name,o.appendChild(n);break;case"icon":const s=new PM({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,width:t.width,height:t.height,image:t.svg,backgroundWidth:t.hover?t.hover.width??t.width:void 0,backgroundHeight:t.hover?t.hover.width??t.width:void 0,backgroundColor:t.hover?t.hover.bgColor??"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor});s.name=t.name,s.role="icon-custom",o.appendChild(s);break;case"image":const a=new PM({x:t.x,y:t.y,dx:t.dx??0,dy:t.dy??0,width:t.width,height:t.height,image:t.src,backgroundWidth:t.hover?t.hover.width??t.width:void 0,backgroundHeight:t.hover?t.hover.width??t.width:void 0,backgroundColor:t.hover?t.hover.bgColor??"rgba(22,44,66,0.2)":void 0,pickable:!!t.pickable,cursor:t.cursor,shape:t.shape});a.name=t.name,a.role="image-custom",o.appendChild(a);break;case"line":const l=sh({points:t.points,lineWidth:t.lineWidth??1,stroke:t.stroke,pickable:!!t.pickable,cursor:t.cursor});l.name=t.name,o.appendChild(l)}})),o}(g,s?d:o,a?u:n,c.getCellValue(i,r))}return m&&p.setAttributes({x:l[3],y:l[0],width:o-l[1]-l[3],height:n-l[0]-l[2]}),jM(p,o,n),!h||h.start.col===h.end.col&&h.start.row===h.end.row||UM(p,i,r,0),{elementsGroup:p,renderDefault:f}}function GM(t,e){return t.endsWith("px")?parseInt(t,10):t.endsWith("%")&&e?parseInt(t,10)/100*e:parseInt(t,10)}function jM(t,e,i){t&&t.forEachChildren((t=>{t&&(Nx(t.attribute.width)&&t.attribute.width.percent&&t.setAttribute("width",Math.max(0,t.attribute.width.percent/100*e+(t.attribute.width.delta??0))),t.attribute.width<0&&t.setAttribute("width",0),Nx(t.attribute.height)&&t.attribute.height.percent&&t.setAttribute("height",Math.max(0,t.attribute.height.percent/100*i+(t.attribute.height.delta??0))),t.attribute.height<0&&t.setAttribute("height",0),"group"===t.type&&jM(t,t.attribute.width,t.attribute.height))}))}function VM(t,e){if(!t||!Wx(t.$$typeof)&&!Wx(t.vtype))return t;const i=t.type,{attribute:r,children:o,stateProxy:n,animation:s}=t.props,a=i({attribute:r});if(function(t,e){let i=!1;switch(t.type){case"richtext":case"rich/image":break;default:i=!0}i&&Object.keys(e).forEach((i=>{const r=up[i];r&&t.on(r,e[i])}))}(a,t.props),n&&(a.stateProxy=n),a.id=r.id,a.name=r.name,Ux(o)?o.forEach((t=>{const i=VM(t,e);i&&i.type&&a.add(i)})):o&&a.add(VM(o,e)),Ux(s)&&e){const t=a.animate();t.setTimeline(e),s.forEach((e=>{t[e[0]](...e.slice(1))}))}return a}function UM(t,e,i,r,o){t&&(t.name=`${OM}${o??""}_${r}`,t.onBeforeAttributeUpdate=KM,"group"===t.type&&t.childrenCount&&t.forEachChildren(((t,n)=>{UM(t,e,i,n,(o??"")+"_"+r)})))}function KM(t,e){const i=this;if(i.skipMergeUpdate)return;const r=LM(i);if(!r||!r.stage)return;const o=r.stage.table;i.skipAttributeUpdate=!0;const{mergeStartCol:n,mergeEndCol:s,mergeStartRow:a,mergeEndRow:l}=r;if(Wx(n)&&Wx(s)&&Wx(a)&&Wx(l)&&(n!==s||a!==l)){for(let e=n;e<=s;e++)for(let n=a;n<=l;n++){if(e===r.col&&n===r.row)continue;const s=o.scenegraph.highPerformanceGetCell(e,n);if("cell"===s.role){const e=s.getChildByName(i.name,!0);if(!e||e.skipAttributeUpdate)continue;for(const i in t)t[i]!==e.attribute[i]&&"dx"!==i&&"dy"!==i&&e.setAttribute(i,t[i])}}i.skipAttributeUpdate=void 0}}let $M=class extends rl{role;col;row;mergeStartCol;mergeStartRow;mergeEndCol;mergeEndRow;contentWidth;contentHeight;rowNumber;colHeight;border;needUpdate;needUpdateWidth;needUpdateHeight;clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren((e=>e.name===t&&(i=e,!0))),e&&this.forEachChildren((e=>{if(e.getChildByName){const r=e.getChildByName(t,!0);if(r)return i=r,!0}return!1})),i}get width(){let t=this.AABBBounds.width();return t!==1/0&&t!==-1/0||(t=0),Math.max(t,this.attribute.width??0)}get height(){let t=this.AABBBounds.height();return t!==1/0&&t!==-1/0||(t=0),Math.max(t,this.attribute.height??0)}setDeltaWidth(t){0!==t&&(this.setAttribute("width",(this.attribute.width??0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){0!==t&&(this.setAttribute("height",(this.attribute.height??0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),"group"===this.border.type&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){0!==t&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){0!==t&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t,e="border-rect",i=!1){if(i){let i=this._lastChild,r=0;for(;i;){if(i.name!==e){if(t(i,r++))return}i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(i.name!==e){if(t(i,r++))return}i=i._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(0===this.childrenCount||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&"border-rect"===e.name?e._next:e}tryUpdateAABBBounds(){if("cell"===this.role){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),function(t,e){if(!t.stage||!t.stage.dirtyBounds||!t.stage.renderCount)return;if(t.isContainer&&!e)return;t.stage.dirty(t.globalAABBBounds)}(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if("cell"===this.role){const t=this.attribute,{x:e,y:i,width:r,height:o}=t;return this._AABBBounds.setValue(e,i,e+r,i+o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds}return"body"===this.role||"row-header"===this.role||"col-header"===this.role||"right-frozen"===this.role||"bottom-frozen"===this.role||"corner-header"===this.role||"corner-right-top-header"===this.role||"corner-right-bottom-header"===this.role||"corner-left-bottom-header"===this.role?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}};function XM(t,e,i,r){const o=t/e;let n,s;return o>i/r?(n=i,s=n/o):(s=r,n=s*o),{width:n,height:s}}function YM(t,e,i,r,o,n,s="left",a="middle",l=[0,0,0,0],h=0,c=0,d=0,u=0){const g=t+i,p=e+r;let f=t+l[3]+h;"right"===s||"end"===s?f=g-o-l[1]-c:"center"===s&&(f=t+(i-o+h-c)/2);let m=e+l[0]+d;return"bottom"===a||"alphabetic"===a||"ideographic"===a?m=p-n-l[2]-u:"middle"===a&&(m=e+(r-n+d-u)/2),{x:f,y:m}}function qM(t,e,i,r,o){const n=e&&Wx(e[t])?e[t]:void 0;if("function"==typeof n){return n({col:i,row:r,table:o,value:o.getCellValue(i,r),dataValue:o.getCellOriginValue(i,r),cellHeaderPaths:o.getCellHeaderPaths(i,r)})}return n}function ZM(t,e,i,r,o){const n=e&&Wx(e[t])?e[t]:void 0;if("function"==typeof n){return n({col:i,row:r,table:o,value:o.getCellValue(i,r),dataValue:o.getCellOriginValue(i,r),cellHeaderPaths:o.getCellHeaderPaths(i,r)})}}function JM(t,e,i,r){let o=i?.group?.strokeArrayWidth??void 0;return r.theme.cellInnerBorder||!function(t){return!!Wx(t)&&(!Ux(t)||t.some((t=>Wx(t))))}(r.theme.frameStyle.borderLineWidth)||function(t){return 0===t||Ux(t)&&t.every((t=>0===t))}(r.theme.frameStyle.borderLineWidth)||(0===t&&(o=o??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],o[3]=0),t===r.colCount-1&&(o=o??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],o[1]=0),0===e&&(o=o??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],o[0]=0),e===r.rowCount-1&&(o=o??[i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth,i?.group?.lineWidth],o[2]=0)),o}class QM extends $M{_leftGroup;_rightGroup;_centerGroup;_autoWidth=!1;_autoHeight=!1;_cellWidth;_originCellWidth;_cellHeight;_align;_baseline;constructor(t){super(t),this._leftGroup=new $M({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new $M({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new $M({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){t.setAttribute("x",this._leftGroup.width+(t.attribute.marginLeft??0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth((t.attribute.marginLeft??0)+(t.attribute.marginRight??0)+t.attribute.width)}addRightOccupyingIcon(t){t.setAttribute("x",this._rightGroup.width+(t.attribute.marginLeft??0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth((t.attribute.marginLeft??0)+(t.attribute.marginRight??0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof ql&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const i=this._centerGroup.width;this._cellWidth=t+e+i,this.setAttribute("width",this._cellWidth)}else{const i=this._cellWidth-t-e;this.updateCenterLayout(i);const r=this._centerGroup.width;this._cellWidth=t+e+r,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._centerGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren((t=>{(t instanceof PM||t instanceof HM)&&(e-=t.AABBBounds.width())}));const i=this._centerGroup.getChildByName("text");i instanceof vh?i.setAttribute("width",e):i instanceof ql&&i.setAttribute("maxLineWidth",e);let r=0;this._centerGroup.forEachChildren((t=>{t.setAttribute("x",r),r+=t.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),"left"===this._align||"start"===this._align?this.setAttribute("dx",0):"center"===this._align?this.setAttribute("dx",-this.attribute.width/2):"right"!==this._align&&"end"!==this._align||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){"top"===this._baseline?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):"middle"===this._baseline?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):"bottom"===this._baseline&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth;const e=this.getChildByName("text",!0);e&&e.setAttribute("heightLimit",t),this.layout()}}function tP(t,e,i){let r=0;const o=i.internalProps.layoutMap;if(o.isHeader(t,e)){const n=o.getHeader(t,e);Wx(n?.hierarchyLevel)&&(r=(n.hierarchyLevel??0)*("tree"===o.rowHierarchyType?o.rowHierarchyIndent??0:0),o.rowHierarchyTextStartAlignment&&!i.internalProps.headerHelper.getHierarchyIcon(t,e)&&(r+=i.internalProps.headerHelper.getHierarchyIconWidth()))}else if(i.internalProps.groupBy||i.getBodyColumnDefine(t,e)?.tree){const n=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),s=i.dataSource.getGroupLength()??0;let a=Ux(n)?n.length-1:0;s>0&&a===s&&(a=0),r=Array.isArray(n)&&i.getHierarchyState(t,e)!==kx.none?a*(o.hierarchyIndent??0):0,o.hierarchyTextStartAlignment&&!i.internalProps.bodyHelper.getHierarchyIcon(t,e)&&(r+=i.internalProps.bodyHelper.getHierarchyIconWidth())}return r}function eP(t,e){let i,r=!1;for(Vx(t)&&t.length>(e.options.maxCharactersNumber||200)&&(t=t.slice(0,e.options.maxCharactersNumber||200),t+="…",r=!0),i=e.internalProps.enableLineBreak||e.options.customConfig?.multilinesForXTable?eS(t).replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n")||[]:[eS(t)];i.length&&i.length>1&&!i[i.length-1];)i.pop();if(e.options.customConfig?.multilinesForXTable&&!e.internalProps.autoWrapText)for(;i.length&&i.length>1&&!i[0];)i.shift();return{text:i,moreThanMaxCharacters:r}}function iP(t,e,i,r,o,n,s){const a={};"image"===t.type?t.isGif?(a.gif=t.src,a.image=t.src):a.image=t.src:("svg"===t.type||"svg"in t)&&(a.image=t.svg),a.width=t.width,a.height=t.height,a.visibleTime=t.visibleTime??"always",a.funcType=t.funcType,a.interactive=t.interactive,a.isGif=t.isGif;let l,h=0;return s&&0!==s?.addedHierarchyOffset||!Xx(i)||!Xx(r)||!n||t.funcType!==Fx.collapse&&t.funcType!==Fx.expand&&t.positionType!==Ex.contentLeft&&t.positionType!==Ex.contentRight||(h=o?tP(o.start.col,o.start.row,n):tP(i,r,n),s&&(s.addedHierarchyOffset=1)),a.marginLeft=(t.marginLeft??0)+h,a.marginRight=t.marginRight??0,!1===t.interactive&&(a.pickable=!1),t.hover&&(a.backgroundWidth=t.hover.width??t.width,a.backgroundHeight=t.hover.width??t.width,a.backgroundColor=t.hover.bgColor??"rgba(22,44,66,0.2)",a.hoverImage=t.hover.image),t.cursor&&(a.cursor=t.cursor),"shape"in t&&"circle"===t.shape&&(a.shape=t.shape),e?(e.setAttributes(a),e.loadImage(a.image),e.tooltip=t.tooltip,e.name=t.name,e):("text"===t.type?(a.text=t.content,s_(a,t.style),l=new HM(a),l.tooltip=t.tooltip,l.name=t.name):(l=new PM(a),l.tooltip=t.tooltip,l.name=t.name),l)}function rP(t){const e={};return"image"===t.type?e.image=t.src:("svg"===t.type||"svg"in t)&&(e.image=t.svg),e.visibleTime=t.visibleTime??"always",e.funcType=t.funcType,e.id=t.name,e.width=t.width,e.height=t.height,(t.marginRight||t.marginLeft)&&(e.margin=[0,t.marginRight??0,0,t.marginLeft??0]),t.hover&&(e.backgroundWidth=t.hover.width??t.width,e.backgroundHeight=t.hover.height??t.height,e.backgroundShowMode="hover",e.hoverImage=t.hover.image,e.backgroundStroke=!1,e.backgroundFill=t.hover.bgColor??"rgba(22,44,66,0.2)"),t.cursor&&(e.cursor=t.cursor),e.tooltip=t.tooltip,e}function oP(t,e,i,r,o,n,s,a,l){Yx(t.contentWidth)&&(r=e-(t.contentWidth??t.attribute.width));let h,c=0,d=0,u=0,g=0;t.forEachChildren((t=>{"icon-left"===t.role?(c+=t.AABBBounds.width()+(t.attribute.marginLeft??0)+(t.attribute.marginRight??0),d=Math.max(d,t.AABBBounds.height())):"icon-right"===t.role&&(u+=t.AABBBounds.width()+(t.attribute.marginLeft??0)+(t.attribute.marginRight??0),g=Math.max(g,t.AABBBounds.height()))}));const p=t.getChildByName("text"),f=t.getChildByName("content");let m;p instanceof ql?(h=p.AABBBounds.height(),p.setAttribute("maxLineWidth",e-c-u-(n[1]+n[3])-(p.attribute.dx??0)-(l.table.theme._contentOffset??0)),m=p.AABBBounds.height()):p instanceof vh?(h=p.AABBBounds.height(),p.setAttribute("width",e-c-u-(n[1]+n[3])),m=p.AABBBounds.height()):f&&(h=f.AABBBounds.height(),f.updateWidth(e-c-u-(n[1]+n[3])),m=f.AABBBounds.height());const b=Math.round(Math.max(d,g,h)+n[0]+n[2]);if(t.forEachChildren((i=>{if("icon-left"===i.role);else if("icon-right"===i.role)i.setAttribute("x",i.attribute.x+r);else if("icon-absolute-right"===i.role)i.setAttribute("x",i.attribute.x+r);else if("content"===i.name||"text"===i.name&&"richtext"!==i.type){const t=i.attribute.textAlign??s;"center"===t?i.setAttribute("x",n[3]+c+(e-(n[1]+n[3])-c-u)/2):"right"===t&&i.setAttribute("x",n[3]+e-(n[1]+n[3])-u)}else"mark"===i.name&&i.setAttribute("x",t.attribute.width)})),o){let e=Math.max(d,m,g);if(function(t,e,i,r){const o=t.table,n=CA(o,e.col,e.row);if(n&&n.end.row-n.start.row){r/=n.end.row-n.start.row+1,i/=n.end.row-n.start.row+1;for(let t=n.start.row;t<=n.end.row;t++){const e=o.getRowHeight(t);if(e===r&&i!==e)return!0;if(i>e)return!0}}else{const t=o.getRowHeight(e.row);if(t===r&&i!==t)return!0;if(i>t)return!0}return!1}(l,t,Math.round(e+n[0]+n[2]),b))return!0;e=(t.contentHeight??i)-(n[0]+n[2]),t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&t.name!==DM&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",n[0]+(e-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",n[0]+e-t.AABBBounds.height()):t.setAttribute("y",n[0]))}))}else"middle"!==a&&"bottom"!==a||t.forEachChildren((t=>{"rect"!==t.type&&"chart"!==t.type&&t.name!==DM&&("mark"===t.name?t.setAttribute("y",0):"middle"===a?t.setAttribute("y",(i-n[2]+n[0]-t.AABBBounds.height())/2):"bottom"===a?t.setAttribute("y",i-t.AABBBounds.height()-n[2]):t.setAttribute("y",n[0]))}));return!1}function nP(t,e,i,r,o,n,s,a){const l=e-Math.floor(o[0]+o[2]),h=t.getChildByName("text");if(h instanceof ql&&!r)h.setAttributes({heightLimit:!1===a.options.customConfig?.limitContentHeight?-1:l});else if(h instanceof vh&&!r)h.setAttributes({height:l});else if(t.getChildByName("content")){t.getChildByName("content").updateHeight(l)}t.forEachChildren((t=>{t.setAttribute("dy",0),"rect"===t.type||"chart"===t.type||t.name===DM||("mark"===t.name?t.setAttribute("y",0):"middle"===s?t.setAttribute("y",o[0]+(l-t.AABBBounds.height())/2):"bottom"===s?t.setAttribute("y",o[0]+l-t.AABBBounds.height()):t.setAttribute("y",o[0]))}))}function sP(t,e,i,r){const o=[],n=[],s=[],a=[],l=[],h=[],c=[],d=[];let u=0,g=0,p=0,f=0,m=0,b=0;return t.forEach((t=>{switch(t.positionType){case Ex.left:o.push(t);break;case Ex.right:n.push(t);break;case Ex.contentLeft:s.push(t);break;case Ex.contentRight:a.push(t);break;case Ex.absoluteRight:d.push(t);break;case Ex.inlineFront:l.push(t);break;case Ex.inlineEnd:h.push(t)}})),o.forEach((t=>{const o=iP(t,void 0,e.col,e.row,i,r);o.role="icon-left",o.name=t.name,o.setAttribute("x",u+(o.attribute.marginLeft??0)),u+=o.AABBBounds.width()+(o.attribute.marginLeft??0)+(o.attribute.marginRight??0),g=Math.max(g,o.AABBBounds.height()),e.appendChild(o)})),n.forEach((t=>{const o=iP(t,void 0,e.col,e.row,i,r);o.role="icon-right",o.name=t.name,o.setAttribute("x",p+(o.attribute.marginLeft??0)),p+=o.AABBBounds.width()+(o.attribute.marginLeft??0)+(o.attribute.marginRight??0),f=Math.max(f,o.AABBBounds.height()),e.appendChild(o)})),c.forEach((t=>{const o=iP(t,void 0,e.col,e.row,i,r);o.role="icon-absolute-left",o.name=t.name,o.setAttribute("x",m+(o.attribute.marginLeft??0)),m+=o.AABBBounds.width()+(o.attribute.marginLeft??0)+(o.attribute.marginRight??0),e.appendChild(o)})),d.forEach((t=>{const o=iP(t,void 0,e.col,e.row,i,r);o.role="icon-absolute-right",o.name=t.name,o.setAttribute("x",b+(o.attribute.marginLeft??0)),b+=o.AABBBounds.width()+(o.attribute.marginLeft??0)+(o.attribute.marginRight??0),e.appendChild(o)})),{leftIcons:o,rightIcons:n,contentLeftIcons:s,contentRightIcons:a,inlineFrontIcons:l,inlineEndIcons:h,absoluteLeftIcons:c,absoluteRightIcons:d,leftIconWidth:u,leftIconHeight:g,rightIconWidth:p,rightIconHeight:f,absoluteLeftIconWidth:m,absoluteRightIconWidth:b}}function aP(t,e){if(t.hasOwnProperty("hoverIconId")){const e=this;if(e.skipMergeUpdate)return;const i=LM(e);if(!i||!i.stage)return;const r=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:o,mergeEndCol:n,mergeStartRow:s,mergeEndRow:a}=i;if(Wx(o)&&Wx(n)&&Wx(s)&&Wx(a)&&(o!==n||s!==a)){for(let l=o;l<=n;l++)for(let o=s;o<=a;o++){if(l===i.col&&o===i.row){if(t.hoverIconId!==e.attribute.hoverIconId){const i=e._frameCache.icons.get(t.hoverIconId);e.updateHoverIconState(i)}continue}const n=r.scenegraph.highPerformanceGetCell(l,o);if("cell"===n.role){const i=n.getChildByName(e.name,!0);if(!i||i.skipAttributeUpdate)continue;t.hoverIconId!==i.attribute.hoverIconId&&(i.setAttribute("hoverIconId",t.hoverIconId),n.addUpdateBoundTag())}}e.skipAttributeUpdate=void 0}}}function lP(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m){const b=ZM("padding",g._getCellStyle(r,o),r,o,g);g.options.customConfig?.imageMargin?h=pB(g.options.customConfig?.imageMargin):Wx(b)&&(h=b),p?.text?.textAlign&&(c=p?.text?.textAlign),p?.text?.textBaseline&&(d=p?.text?.textBaseline);const y=JM(r,o,p,g);let C,w;if(m&&(C=g.scenegraph.highPerformanceGetCell(r,o,!0),C&&"cell"===C.role&&C.setAttributes({x:e,y:i,width:n,height:s,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:y??void 0,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),C&&"cell"===C.role||(C=new $M({x:e,y:i,width:n,height:s,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:y??void 0,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),C.role="cell",C.col=r,C.row=o,t?.addCellGroup(C)),u){let t=r,e=o;f&&(t=f.start.col,e=f.start.row),w=g.getCellIcons(t,e)}let v=0,x=0,_=0;if(Array.isArray(w)&&0!==w.length){const{leftIconWidth:t,rightIconWidth:e,absoluteLeftIconWidth:i,absoluteRightIconWidth:r}=sP(w,C,f,g);v=t+e,x=t,_=e,C.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+n-e-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+n-r-h[1])})),C.forEachChildren((t=>{"middle"===d?t.setAttribute("y",(s-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",s-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])})),C._cellLeftIconWidth=x,C._cellRightIconWidth=_}const S=g.getCellValue(r,o),A=fh({x:h[3],y:h[0],width:n-h[1]-h[3]-v,height:s-h[0]-h[2],image:S,cursor:"pointer"});return A.name="image",A.keepAspectRatio=a,A.textAlign=c,A.textBaseline=d,a||l?A.resources&&A.resources.has(A.attribute.image)&&"success"===A.resources.get(A.attribute.image).state?(A.setAttribute("opacity",0),setTimeout((()=>{A.setAttribute("opacity",1),gP(l,a,h,c,d,A,C,g),g.scenegraph.updateNextFrame()}),0)):A.successCallback=()=>{gP(l,a,h,c,d,A,C,g),g.scenegraph.updateNextFrame()}:A.resources&&A.resources.has(A.attribute.image)&&"success"===A.resources.get(A.attribute.image).state?cP(C,r,o,0,0,g):A.successCallback=()=>{cP(C,r,o,0,0,g)},A.failCallback=()=>{const t=MM();A.image=t.damage_pic.svg},C.appendChild(A),C}function hP(t,e,i,r,o,n,s){let a=!1,l=null,h=null;const{width:c,height:d,isMerge:u}=dP(s,o.table);if(c<i+n[1]+n[3]&&(l=i+n[1]+n[3],a=!0),d<r+n[2]+n[0]&&(h=r+n[2]+n[0],a=!0),a){if("number"==typeof l)if(u)for(let t=s.mergeStartCol;t<=s.mergeEndCol;t++)o.setColWidth(t,l/(s.mergeEndCol-s.mergeStartCol+1));else o.setColWidth(t,l);if("number"==typeof h)if(u)for(let t=s.mergeStartRow;t<=s.mergeEndRow;t++)o.setRowHeight(t,h/(s.mergeEndRow-s.mergeStartRow+1));else o.setRowHeight(e,h);return o.component.updateScrollBar(),!0}return!1}function cP(t,e,i,r,o,n){const s=t.getChildByName("image");if(!s)return;const a="string"!=typeof s.attribute.image&&s.attribute.image||s.resources?.get(s.attribute.image).data;if(!a)return;const l=n._getCellStyle(e,i),h=qM("textAlign",l,e,i,n)??"left",c=qM("textBaseline",l,e,i,n)??"middle";let d;d=n.options.customConfig?.imageMargin?pB(n.options.customConfig?.imageMargin):pB(qM("padding",l,e,i,n))??[0,0,0,0];const{width:u,height:g,isMerge:p}=dP(t,n),f=t.mergeStartCol??t.col,m=t.mergeStartRow??t.row,b=t.mergeEndCol??t.col,y=t.mergeEndCol??t.row,C=t._cellLeftIconWidth??0,w=t._cellRightIconWidth??0;if(s.keepAspectRatio){const{width:t,height:e}=XM(a.width||a.videoWidth,a.height||a.videoHeight,u-(d[1]+d[3]),g-(d[0]+d[2])),i=YM(0,0,u,g,t,e,h,c,d);for(let r=f;r<=b;r++)for(let o=m;o<=y;o++){const s=n.scenegraph.getCell(r,o).getChildByName("image");s?.setAttributes({x:i.x,y:i.y,width:t,height:e})}}else for(let t=f;t<=b;t++)for(let e=m;e<=y;e++){const i=n.scenegraph.getCell(t,e).getChildByName("image");i?.setAttributes({x:C+d[3],y:d[0],width:u-d[1]-d[3]-w-C,height:g-d[0]-d[2]})}if(t.getChildByName("play-icon")){const e=0,i=0,{width:r,height:o}=dP(t,n),a=Math.floor(Math.min(r-d[1]-d[3],o-d[2]-d[0])/2),l=e+(r>s.attribute.width?s.attribute.x-e+s.attribute.width/2:r/2),h=i+(o>s.attribute.height?s.attribute.y-i+s.attribute.height/2:o/2);for(let t=f;t<=b;t++)for(let e=m;e<=y;e++){n.scenegraph.getCell(t,e).getChildByName("play-icon").setAttributes({x:l-a/2,y:h-a/2,width:a,height:a})}}t.forEachChildren((t=>{"icon-left"===t.role||("icon-right"===t.role||"icon-absolute-right"===t.role)&&t.setAttribute("x",t.attribute.x+r)})),t.forEachChildren((t=>{("rect"===t.type||t.role&&t.role.startsWith("icon"))&&("middle"===c?t.setAttribute("y",d[0]+(g-d[0]-d[2]-t.AABBBounds.height())/2):"bottom"===c?t.setAttribute("y",d[0]+g-d[0]-d[2]-t.AABBBounds.height()):t.setAttribute("y",d[0]))})),p&&uP(t.mergeStartCol,t.mergeEndCol,t.mergeStartRow,t.mergeEndRow,n)}function dP(t,e){return"cell"===t.role&&Wx(t.mergeStartCol)&&Wx(t.mergeEndCol)&&Wx(t.mergeStartRow)&&Wx(t.mergeEndRow)?{width:e.getColsWidth(t.mergeStartCol,t.mergeEndCol),height:e.getRowsHeight(t.mergeStartRow,t.mergeEndRow),isMerge:!0}:{width:t.attribute.width,height:t.attribute.height,isMerge:!1}}function uP(t,e,i,r,o){for(let n=t;n<=e;n++)for(let t=i;t<=r;t++){const e=o.scenegraph.getCell(n,t);if(e){const i=e.getChildByName("image");i&&i.setAttributes({dx:-o.getColsWidth(e.mergeStartCol,n-1),dy:-o.getRowsHeight(e.mergeStartRow,t-1)});const r=e.getChildByName("play-icon");r&&r.setAttributes({dx:-o.getColsWidth(e.mergeStartCol,n-1),dy:-o.getRowsHeight(e.mergeStartRow,t-1)})}}}function gP(t,e,i,r,o,n,s,a){const l=n.resources.get(n.attribute.image).data,{col:h,row:c}=s;if(t&&!pP(n)&&hP(h,c,l.width,l.height,a.scenegraph,i,s),e||pP(n)){const{width:t,height:e,isMerge:h}=dP(s,a),{width:c,height:d}=XM(l.width,l.height,t-i[1]-i[3],e-i[0]-i[2]),u=YM(0,0,t,e,c,d,r,o,i);n.setAttributes({x:u.x,y:u.y,width:c,height:d}),h&&uP(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,a)}}function pP(t){const e=MM();return t.attribute.image===e.damage_pic.svg}function fP(t,e,i){t.then((()=>{i(),e.scenegraph.updateNextFrame()})).catch((t=>{}))}function mP(t,e){const i=this;if(i.shadowRoot&&i.shadowRoot.childrenCount&&(Wx(t.width)||Wx(t.height))){const e=i.shadowRoot.findChildrenByName("shadow-rect")[0];e&&e.setAttributes({width:t.width??e.attribute.width,height:t.height??e.attribute.height})}}function bP(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b){let y,C=!1;if(TS(e)){if("cell"!==r.scenegraph.highPerformanceGetCell(o,n).role)return y;e=r.getCellValue(o,n),C=!0}if("checkbox"===t&&i.tree){y=wA.getFunction("createCheckboxCellGroup")(null,h,0,c,o,n,s,a,l,d,u,g,p,r,f,i,m,C,!0)}else if("text"===t||"link"===t||b){if("link"===t){const s=e,a=r.getCellOriginValue(o,n),l=r._getCellStyle(o,n);"link"===t&&("templateLink"in i&&i.templateLink||!("linkDetect"in i)||!AS(i.linkDetect,{col:o,row:n,table:r,value:s,dataValue:a,cellHeaderPaths:void 0})||tA.test(s))&&(f?(f.text.fill=qM("linkColor",l,o,n,r),f.group.cursor="pointer"):f={text:{fill:qM("linkColor",l,o,n,r)},group:{cursor:"pointer"}})}const{customElementsGroup:w,renderDefault:v}=yP(r,i,o,n,a,l,d,m,b);y=wA.getFunction("createTextCellGroup")(r,e,h,0,c,o,n,s,a,l,d,u,g,p,w,v,f,m,C);const x=r.internalProps.layoutMap.getAxisConfigInPivotChart(o,n);if(x){const t=new(wA.getComponent("axis"))(x,y.attribute.width,y.attribute.height,x.__vtablePadding??d,r);y.clear(),y.appendChild(t.component),t.overlap()}else r.internalProps.layoutMap.isEmpty(o,n)?(y.setAttributes({fill:!1,stroke:!1}),y.clear()):r.internalProps.layoutMap.isAxisCell(o,n)&&y.clear()}else if("image"===t){y=wA.getFunction("createImageCellGroup")(h,0,c,o,n,a,l,i.keepAspectRatio,i.imageAutoSizing,d,u,g,p,r,f,m,C)}else if("video"===t){y=wA.getFunction("createVideoCellGroup")(h,0,c,o,n,a,l,i.keepAspectRatio,i.imageAutoSizing,d,u,g,p,r,f,m,C)}else if("chart"===t){const t=r.internalProps.layoutMap.getChartInstance(o,n);y=wA.getFunction("createChartCellGroup")(null,h,0,c,o,n,a,l,d,e,i.chartModule,r.internalProps.layoutMap.getChartSpec(o,n),t,r.internalProps.layoutMap.getChartDataId(o,n)??"data",r,f,r.internalProps.layoutMap.isShareChartSpec(o,n),C,r.internalProps.layoutMap.isNoChartDataRenderNothing(o,n))}else if("progressbar"===t){const{customElementsGroup:t,renderDefault:w}=yP(r,i,o,n,a,l,d,m,b),v=r._getCellStyle(o,n),x=r.getCellOriginValue(o,n);y=wA.getFunction("createTextCellGroup")(r,e,h,0,c,o,n,s,a,l,d,u,g,p,t,w,f,m,C);const _=wA.getFunction("createProgressBarCell")(i,v,s,e,x,o,n,d,r,m);y.firstChild?y.insertBefore(_,y.firstChild):y.appendChild(_)}else if("sparkline"===t){y=wA.getFunction("createSparkLineCellGroup")(null,h,0,c,o,n,a,l,d,r,f,C)}else if("checkbox"===t){const t="isAggregation"in r.internalProps.layoutMap&&r.internalProps.layoutMap.isAggregation(o,n),b=r.internalProps.layoutMap.isSeriesNumber(o,n);if(t&&b){y=wA.getFunction("createTextCellGroup")(r,e,h,0,c,o,n,s,a,l,d,u,g,!1,void 0,!0,f,m,C)}else{y=wA.getFunction("createCheckboxCellGroup")(null,h,0,c,o,n,s,a,l,d,u,g,p,r,f,i,m,C,!1)}}else if("radio"===t){y=wA.getFunction("createRadioCellGroup")(null,h,0,c,o,n,s,a,l,d,u,g,r,f,i,m)}else if("switch"===t){y=wA.getFunction("createSwitchCellGroup")(null,h,0,c,o,n,s,a,l,d,u,g,p,r,f,i,m,C)}else if("button"===t){y=wA.getFunction("createButtonCellGroup")(null,h,0,c,o,n,s,a,l,d,u,g,p,r,f,i,m,C)}return y.onBeforeAttributeUpdate=mP,y}function yP(t,e,i,r,o,n,s,a,l){let h,c=!0;if(l)h=l.elementsGroup,c=l.renderDefault;else if(a?.isCustom&&!t.isCornerHeader(i,r));else{let l,d;if("body"!==t.getCellLocation(i,r)?(l=e?.headerCustomRender,d=e?.headerCustomLayout):(l=e?.customRender||t.customRender,d=e?.customLayout),d||l){const e=NM(d,l,i,r,o,n,!1,t.isAutoRowHeight(r),s,a,t);h=e.elementsGroup,c=e.renderDefault}}return{customElementsGroup:h,renderDefault:c}}function CP(t,e,i,r,o,n){const s=i.scenegraph.highPerformanceGetCell(t,e,!0);if("cell"!==s.role&&!r)return;const a=i.getCellLocation(t,e);let l,h,c,d,u=i.getCellValue(t,e),g=!1;if(i.internalProps.customMergeCell){const r=i.getCustomMerge(t,e);if(r){const{range:t,text:o,style:n,customLayout:s,customRender:a}=r;h=t,l=h.start.col!==h.end.col||h.start.row!==h.end.row,u=o,c=n,(s||a)&&(d=NM(s,a,t.start.col,t.start.row,i.getColsWidth(t.start.col,t.end.col),i.getRowsHeight(t.start.row,t.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],h,i)),g=!0}}let p=t,f=e;h&&(p=h.start.col,f=h.start.row);const m="body"!==a?i.getHeaderDefine(p,f):i.getBodyColumnDefine(p,f);let b="body"!==a||(m?.dragOrder||!!m?.icon||!!m?.tree);h||!i.internalProps.enableTreeNodeMerge&&"body"===a&&!m?.mergeCell||(h=i.getCellRange(t,e),l=h.start.col!==h.end.col||h.start.row!==h.end.row);let y=!1;if(i.internalProps.enableTreeNodeMerge&&l){const r=i.getCellRawRecord(h.start.col,h.start.row),{vtableMergeName:o,vtableMerge:n}=r??{};y=n,n&&(b=!0,i.internalProps.groupTitleCustomLayout&&(d=NM(i.internalProps.groupTitleCustomLayout,void 0,h.start.col,h.start.row,i.getColsWidth(h.start.col,h.end.col),i.getRowsHeight(h.start.row,h.end.row),!1,i.isAutoRowHeight(e),[0,0,0,0],h,i)),i.internalProps.groupTitleFieldFormat?u=i.internalProps.groupTitleFieldFormat(r,t,e,i):void 0!==o&&(u=o))}const C=c||i._getCellStyle(h?h.start.col:t,h?h.start.row:e),w=C.autoWrapText??i.internalProps.autoWrapText,v=ZB(C,i,l?h.start.col:t,l?h.start.row:e,qM).theme;if(v.group.cornerRadius=JB(t,e,i),!r&&!l&&!(m?.customLayout||m?.customRender||m?.headerCustomLayout||m?.headerCustomRender)&&(n||function(t,e,i,r,o,n){const s=n.getBodyColumnType(t,e),a=n.isAutoRowHeight(e),l=n.getCellValue(t,e);if(!(n.isHeader(t,e)||"cell"!==i.role||"text"!==s||r||a||o||"text"!==i.firstChild?.type||TS(l)))return!0;return!1}(t,e,s,w,b,i))){const r=i.getColWidth(t),o=i.getRowHeight(e),a=JM(t,e,v,i);s.setAttributes({width:r,height:o,lineWidth:v?.group?.lineWidth??void 0,fill:v?.group?.fill??void 0,stroke:v?.group?.stroke??void 0,strokeArrayWidth:a??void 0,strokeArrayColor:v?.group?.strokeArrayColor??void 0,cursor:v?.group?.cursor??void 0,cornerRadius:v?.group?.cornerRadius??0,lineDash:v?.group?.lineDash??void 0,y:i.scenegraph.getCellGroupY(e)}),s.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));const l=s.getChildByName("text");if(n&&l){const r=v.text.textAlign,o=tP(t,e,i),n={textBaseline:"top",dx:"left"===r?o:0};l.setAttributes(v.text?Object.assign({},v.text,n):n)}else if(l){const n=i.getCellValue(t,e),{text:s,moreThanMaxCharacters:a}=eP(n,i),h=tP(t,e,i),c=C.lineClamp,d=pB(qM("padding",C,t,e,i))??[0,0,0,0],u=v.text.textAlign;let g=0;g="center"===u?d[3]+(r-(d[1]+d[3]))/2:"right"===u?d[3]+r-(d[1]+d[3]):d[3];const p={text:1!==s.length||w?s:s[0],moreThanMaxCharacters:a,maxLineWidth:r-(d[1]+d[3]+h),textBaseline:"top",autoWrapText:w,lineClamp:c,wordBreak:"break-word",heightLimit:o-Math.floor(d[0]+d[2]),pickable:!1,dx:"left"===u?h:0,x:g};if(l.setAttributes(v.text?Object.assign({},v.text,p):p),l.attribute.text){const t=v.text.textBaseline,e=o-(d[0]+d[2]);let i=0;i="middle"===t?d[0]+(e-l.AABBBounds.height())/2:"bottom"===t?d[0]+e-l.AABBBounds.height():d[0],l.setAttributes({y:i})}}return s}if(!r&&"empty"===s.role)return;const x=y||g?"text":i.isHeader(t,e)?i._getHeaderLayoutMap(t,e).headerType??"text":i.getBodyColumnType(t,e)??"text",_=v._vtable.padding,S=v.text.textAlign,A=v.text.textBaseline;let T,R,B;if(h?(R=i.getColsWidth(h.start.col,h.end.col),B=i.getRowsHeight(h.start.row,h.end.row)):(R=i.getColWidth(t),B=i.getRowHeight(e)),TS(u)?(s.removeAllChild(),fP(u,i,vP.bind(null,{type:x,value:u,define:m,table:i,col:t,row:e,cellWidth:R,cellHeight:B,oldCellGroup:s,padding:_,textAlign:S,textBaseline:A,mayHaveIcon:b,addNew:r,range:h,customResult:d,customStyle:c}))):T=wP(x,u,m,i,t,e,R,B,s,_,S,A,b,r,v,h,d),l){const{width:t}=T.attribute,{height:e}=T.attribute;T.contentWidth=t,T.contentHeight=e,o?function(t,e,i,r,o,n,s,a){const{col:l,row:h}=a;t.start.row!==t.end.row&&a.contentHeight!==i&&nP(a,i,0,s.isAutoRowHeight(h),r,0,n,s);t.start.col!==t.end.col&&a.contentWidth!==e&&oP(a,e,i,0,s.isAutoRowHeight(h),r,o,n,s.scenegraph);a.contentWidth=e,a.contentHeight=i;const c=s.getRowHeight(h),d=s.getColWidth(l);_P(a,d,c,t,s)}(h,R,B,_,S,A,i,T):xP(h,R,B,_,S,A,i)}return T}function wP(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m){if(TS(e)&&(e=r.getCellValue(o,n)),!g&&(l.row!==n||l.col!==o))return null;if(!g&&l.parent&&r.reactCustomLayout){const t=l.getChildByName("custom-container");if(t){const{col:e,row:i}=t;Xx(e)&&Xx(i)&&r.reactCustomLayout.removeCustomCell(e,i)}}const b=bP(t,e,i,r,o,n,r.getColWidth(o),s,a,g?r.scenegraph.getColGroup(o):l.parent,g?0:r.scenegraph.getCellGroupY(n),h,c,d,u,p,f,m);return!g&&l.parent&&(l.parent.insertAfter(b,l),l.parent.removeChild(l),l.release(!0),r.scenegraph?.proxy.cellCache.get(o)&&r.scenegraph?.proxy.cellCache.set(o,b)),b}function vP(t){const{type:e,value:i,define:r,table:o,col:n,row:s,cellWidth:a,cellHeight:l,oldCellGroup:h,padding:c,textAlign:d,textBaseline:u,mayHaveIcon:g,addNew:p,range:f,customResult:m,customStyle:b}=t,y=ZB(b||o._getCellStyle(f?f.start.col:n,f?f.start.row:s),o,f?f.start.col:n,f?f.start.row:s,qM).theme;y.group.cornerRadius=JB(n,s,o),wP(e,i,r,o,n,s,a,l,h,c,d,u,g,p,y,f,m)}function xP(t,e,i,r,o,n,s){for(let a=t.start.col;a<=t.end.col;a++)for(let l=t.start.row;l<=t.end.row;l++){const h=s.scenegraph.highPerformanceGetCell(a,l,!0);if("cell"!==h.role)continue;t.start.row!==t.end.row&&h.contentHeight!==i&&nP(h,i,0,s.isAutoRowHeight(l),r,0,n,s),t.start.col!==t.end.col&&h.contentWidth!==e&&oP(h,e,i,0,s.isAutoRowHeight(l),r,o,n,s.scenegraph),h.contentWidth=e,h.contentHeight=i;const c=s.getRowHeight(l);_P(h,s.getColWidth(a),c,t,s)}}function _P(t,e,i,r,o){const{col:n,row:s}=t,a=-o.getColsWidth(r.start.col,n-1);let l=0;if(o.options.customConfig?._disableColumnAndRowSizeRound)for(let t=r.start.row;t<=s-1;t++)l-=o.getRowHeight(t);else l=-o.getRowsHeight(r.start.row,s-1);t.forEachChildren((t=>{"number"==typeof t._dx?(t.skipMergeUpdate=!0,t.setAttributes({dx:(t._dx??0)+a}),t.skipMergeUpdate=!1):(t._dx=t.attribute.dx??0,t.skipMergeUpdate=!0,t.setAttributes({dx:(t.attribute.dx??0)+a}),t.skipMergeUpdate=!1),"number"==typeof t._dy?(t.skipMergeUpdate=!0,t.setAttributes({dy:(t._dy??0)+l}),t.skipMergeUpdate=!1):(t._dy=t.attribute.dy??0,t.skipMergeUpdate=!0,t.setAttributes({dy:(t.attribute.dy??0)+l}),t.skipMergeUpdate=!1)}));const h=t.attribute.strokeArrayWidth??t.attribute.lineWidth,c=Ux(h),d=[0,0,0,0];n===r.start.col&&(d[3]=c?h[3]:h),s===r.start.row&&(d[0]=c?h[0]:h),n===r.end.col&&(d[1]=c?h[1]:h),s===r.end.row&&(d[2]=c?h[2]:h);const u=e!==t.attribute.width,g=i!==t.attribute.height;return t.skipMergeUpdate=!0,t.setAttributes({width:e,height:i,strokeArrayWidth:d}),t.skipMergeUpdate=!1,t.mergeStartCol=r.start.col,t.mergeStartRow=r.start.row,t.mergeEndCol=r.end.col,t.mergeEndRow=r.end.row,{widthChange:u,heightChange:g}}function SP(t,e,i,r){if(r.internalProps.customMergeCell){const o=r.getCustomMerge(t,e);if(o){const{range:n,text:s,style:a,customLayout:l,customRender:h}=o;if(l||h){const o=NM(l,h,n.start.col,n.start.row,r.getColsWidth(n.start.col,n.end.col),r.getRowsHeight(n.start.row,n.end.row),!1,r.isAutoRowHeight(e),[0,0,0,0],n,r).elementsGroup;i.childrenCount>0&&o?i.insertBefore(o,i.firstChild):o&&i.appendChild(o);const s=r.getRowHeight(e),a=r.getColWidth(t),{width:c}=i.attribute,{height:d}=i.attribute;return i.contentWidth=c,i.contentHeight=d,_P(i,a,s,n,r),n}}}}function AP(t){return!!("cell"===t.role&&Xx(t.mergeStartCol)&&Xx(t.mergeStartRow)&&Xx(t.mergeEndCol)&&Xx(t.mergeEndRow))}const TP=new wx({}),RP=new vx({}),BP=new My({});function MP(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=sS(Nx(t)?t.text:t).split("\n")||[],m=p.getColsWidth(e,r),b=qM("size",o,e,i,p);let y=qM("outerRadius",o,e,i,p);const C=Xx(y)?2*y:b;let w=0;if(n){const t=qM("spaceBetweenTextAndIcon",o,e,i,p),r=m-(g[1]+g[3])-s-C-t;Xx(y)||(y=Math.round(b/2)),RP.setAttributes({text:{maxLineWidth:r,text:f,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:c,lineHeight:d,wordBreak:"break-word",lineClamp:u},circle:{outerRadius:y},spaceBetweenTextAndIcon:t}),RP.render(),w=RP.AABBBounds.height()}else w=Math.max(b,f.length*d);return w}let PP="",HP="quick";const kP=new i(((t,e,i,r)=>{i(oo)?r(oo).to(IP).inSingletonScope():t(oo).to(IP).inSingletonScope()})),EP=new i(((t,e,i,r)=>{i(oo)?r(oo).to(no).inSingletonScope():t(oo).to(no).inSingletonScope()})),FP=new Map;function LP(t,e,i,r="normal"){const o=`${t}-${e}-${i}-${r}`,n=FP.get(o);if(n)return n;const s=(a={fontSize:t,fontFamily:i,fontWeight:e,fontStyle:r},new u_({defaultFontParams:{fontFamily:vr.fontFamily,fontSize:vr.fontSize},getTextBounds:h?void 0:Ih,specialCharSet:`{}()//&-/: .,@%'"~…=——${u_.ALPHABET_CHAR_SET}${u_.ALPHABET_CHAR_SET.toUpperCase()}0123456789${PP}`,...l??{}},a));var a,l,h;return FP.set(o,s),s}class IP extends no{_fastMeasure(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e,s=LP(i,o,r,n).measure(t,HP);if(!Wx(s.fontBoundingBoxAscent)&&!Wx(s.fontBoundingBoxDescent)){const{ascent:t,descent:i}=this.measureTextBoundADscentEstimate(e);s.fontBoundingBoxAscent=t,s.fontBoundingBoxDescent=i}return s}measureTextWidth(t,e){return this._fastMeasure(t,e).width}measureText(t,e){return this._fastMeasure(t,e)}_measureTextWithoutAlignBaseline(t,e,i){return this._fastMeasure(t,e)}_measureTextWithAlignBaseline(t,e,i){return this._fastMeasure(t,e)}}const zP=new class{measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e;return LP(i,o,r,n).measure(t,HP)}measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:n="normal"}=e;return LP(i,o,r,n).measure(t,HP).width}clipText(t,e,i){if(0===t.length)return{str:"",width:0};let r=this.measureTextWidth(t,e);return r<=i?{str:t,width:r}:(r=this.measureTextWidth(t[0],e),r>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,r,o){const n=Math.floor((r+o)/2),s=t.substring(0,n+1),a=this.measureTextWidth(s,e);let l;if(a>i){if(s.length<=1)return{str:"",width:0};const o=t.substring(0,n);return l=this.measureTextWidth(o,e),l<=i?{str:o,width:l}:this._clipText(t,e,i,r,n)}if(a<i){if(n>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const r=t.substring(0,n+2);return l=this.measureTextWidth(r,e),l>=i?{str:s,width:a}:this._clipText(t,e,i,n,o)}return{str:s,width:a}}clipTextWithSuffix(t,e,i,r){if(""===r)return this.clipText(t,e,i);if(0===t.length)return{str:"",width:0};const o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};const n=this.measureTextWidth(r,e);if(n>i)return{str:"",width:0};i-=n;const s=this._clipText(t,e,i,0,t.length-1);return s.str+=r,s.width+=n,s}};const OP=new ql({ignoreBuf:!0});function DP(t){return OP.initAttributes({...t,ignoreBuf:!0}),OP.AABBBounds}const WP=new vh({width:0,height:0,textConfig:[]});function NP(t,e,i,r=!0,o){"undefined"!=typeof window&&window.performance.now();const n=[],s=[];if(o)for(let r=e;r<=i;r++)n[r]=t.getRowHeight(r);const a=t.internalProps.layoutMap;t.isPivotTable()&&(a.enableUseGetBodyCache(),a.enableUseHeaderPathCache()),t.defaultHeaderRowHeight,t.defaultHeaderColWidth;const l="auto"===t.defaultHeaderRowHeight||Ux(t.defaultHeaderRowHeight)&&t.defaultHeaderRowHeight.some((t=>"auto"===t)),h=t.isAutoRowHeight(e)||"adaptive"===t.heightMode&&!1!==t.options.autoHeightInAdaptiveMode,c="auto"===t.options.defaultRowHeight;if(h||l||c){e=e??0,i=i??t.rowCount-1,(0===e&&i===t.rowCount-1||r)&&t._clearRowRangeHeightsMap();for(let i=e;i<t.columnHeaderLevelCount;i++){let e=0,r=t.colCount-1;if((t.isPivotTable()&&!t.isPivotChart()||t.isPivotChart()&&!t.internalProps.layoutMap.indicatorsAsCol)&&VP(t,i)&&!CA(t,t.rowHeaderLevelCount,i)&&(e=0,r=t.rowHeaderLevelCount),h||"auto"===t.getDefaultRowHeight(i)){const n=GP(i,e,r,t);s[i]=Math.round(n),"only-body"!==t.heightAdaptiveMode&&o||t._setRowHeight(i,n)}}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++)if(h||"auto"===t.getDefaultRowHeight(e)){const i=GP(e,0,t.colCount-1,t);o?s[e]=Math.round(i):t._setRowHeight(e,i)}if(i<t.columnHeaderLevelCount||!h&&!c);else if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol||t.options.customComputeRowHeight||!function(t,e){const{layoutMap:i}=t.internalProps,r=t.columnHeaderLevelCount;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak||t.isPivotChart())&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;for(let e=0;e<t.colCount;e++){const o=i.getBody(e,r);if("radio"===o.cellType)return!1;if("function"==typeof o.style||"function"==typeof o.icon||o.define?.customRender||o.define?.customLayout||"function"==typeof o.define?.icon)return!1;const n=t._getCellStyle(e,r);if("function"==typeof n.padding||"function"==typeof n.fontSize||"function"==typeof n.lineHeight||!0===n.autoWrapText)return!1}return!0}(t,e))if(t.internalProps.transpose||t.isPivotTable()&&!t.internalProps.layoutMap.indicatorsAsCol)for(let r=Math.max(e,t.columnHeaderLevelCount);r<=i;r++){let e;e=jP(t,r)?GP(r,0,t.rowHeaderLevelCount,t):GP(r,0,t.colCount-1,t),o?s[r]=Math.round(e):t._setRowHeight(r,e)}else for(let r=Math.max(e,t.columnHeaderLevelCount);r<=i;r++){const e=GP(r,0,t.colCount-1,t);o?s[r]=Math.round(e):t._setRowHeight(r,e)}else{!function(t,e,i,r,o){if(r.internalProps.useOneRowHeightFillAll)return;for(let n=e;n<=i;n++)o?o[n]=t:r._setRowHeight(n,t);r.internalProps.useOneRowHeightFillAll=!0}(GP(t.columnHeaderLevelCount,0,t.colCount-1,t),t.columnHeaderLevelCount,t.rowCount-1-t.bottomFrozenRowCount,t,o?s:void 0);for(let e=t.rowCount-t.bottomFrozenRowCount;e<=i;e++){const i=GP(e,0,t.colCount-1,t);o?s[e]=Math.round(i):t._setRowHeight(e,i)}}}else if(("adaptive"===t.heightMode||t.autoFillHeight)&&t.clearRowHeightCache(),o)for(let r=e;r<=i;r++)s[r]=t.getRowHeight(r);if((0===e&&i===t.rowCount-1||r)&&t._clearRowRangeHeightsMap(),"adaptive"===t.heightMode){t._clearRowRangeHeightsMap();let e=t.tableNoFrameHeight,i=0,r=t.rowCount;if("only-body"===t.heightAdaptiveMode){const o=t.getRowsHeight(0,t.columnHeaderLevelCount-1),n=t.isPivotChart()?t.getBottomFrozenRowsHeight():0;e=t.tableNoFrameHeight-o-n,i=t.columnHeaderLevelCount,r=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount}let n=0;for(let e=i;e<r;e++)n+=o?s[e]??t.getRowHeight(e):t.getRowHeight(e);const a=e/n;for(let n=i;n<r;n++){let l;l=n===r-1?e-(o?s.reduce(((t,e,o)=>o>=i&&o<=r-2?t+e:t),0):t.getRowsHeight(i,r-2)):Math.round((o?s[n]??t.getRowHeight(n):t.getRowHeight(n))*a),o?s[n]=l:t._setRowHeight(n,l,!1)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const e=t.tableNoFrameHeight;let i=0,r=0;for(let e=0;e<t.rowCount;e++){const n=o?s[e]??t.getRowHeight(e):t.getRowHeight(e);(e<t.columnHeaderLevelCount||t.isPivotChart()&&e>=t.rowCount-t.bottomFrozenRowCount)&&(r+=n),i+=n}if(t.scenegraph._dealAutoFillHeightOriginRowsHeight=i,i<e&&i-r>0){const n=t.columnHeaderLevelCount,a=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,l=(e-r)/(i-r);for(let i=n;i<a;i++){let h;h=i===a-1?e-r-(o?s.reduce(((t,e,i)=>i>=n&&i<=a-2?t+e:t),0):t.getRowsHeight(n,a-2)):Math.round((o?s[i]??t.getRowHeight(i):t.getRowHeight(i))*l),o?s[i]=h:t._setRowHeight(i,h,!1)}}}if(o){for(let r=e;r<=i;r++){const e=s[r]??t.getRowHeight(r);Wx(e)&&t._setRowHeight(r,e)}for(let e=0;e<=t.frozenRowCount-1;e++){const i=t.getRowHeight(e);i!==(n[e]??t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(n[e]??t.getRowHeight(e)),!0)}for(let e=t.rowCount-t.bottomFrozenRowCount;e<=t.rowCount-1;e++){const i=t.getRowHeight(e);i!==(n[e]??t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(n[e]??t.getRowHeight(e)),!0)}for(let e=t.scenegraph.proxy.rowStart;e<=t.scenegraph.proxy.rowEnd;e++){const i=t.getRowHeight(e);i!==(n[e]??t.getRowHeight(e))&&t.scenegraph.updateRowHeight(e,i-(n[e]??t.getRowHeight(e)),!0)}}t.isPivotTable()&&(a.disableUseGetBodyCache(),a.disableUseHeaderPathCache())}function GP(t,e,i,r){if(!(r.isAutoRowHeight(t)||"adaptive"===r.heightMode&&!1!==r.options.autoHeightInAdaptiveMode)&&"auto"!==r.getDefaultRowHeight(t))return r.getDefaultRowHeight(t);let o;if(r.options.customComputeRowHeight){const e=r.options.customComputeRowHeight({row:t,table:r});if("number"==typeof e)return e;if("auto"!==e)return r.getDefaultRowHeight(t)}if(r.isPivotChart()&&t>=r.columnHeaderLevelCount&&t<r.rowCount-r.bottomFrozenRowCount)if(r.internalProps.layoutMap.indicatorsAsCol){const e=r.internalProps.layoutMap.getOptimunHeightForChart(t);if(e>0)return e}else{const e=r.getDefaultRowHeight(t);if(Xx(e))return e}for(let n=e;n<=i;n++){const e=UP(n,t,r);if(e&&(o=Wx(o)?Math.max(e.height,o):e.height,!e.renderDefault))continue;if(r.isPivotChart()){const e=r.internalProps.layoutMap.getAxisConfigInPivotChart(n,t);if(e){const t=wA.getFunction("computeAxisComponentHeight")(e,r);if("number"==typeof t){o=Wx(o)?Math.max(t,o):t;continue}}}if(r.isPivotChart()&&(r.isLeftFrozenColumn(n)&&r.isBottomFrozenRow(t)||r.isRightFrozenColumn(n)&&r.isBottomFrozenRow(t)))continue;const i=KP(n,t,r.isHeader(n,t)?r._getHeaderLayoutMap(n,t)?.headerType:r.getBodyColumnType(n,t),r);o=Wx(o)?Math.max(i,o):i}if(Wx(o))return o;const n=r.getDefaultRowHeight(t);return Xx(n)?n:r.defaultRowHeight}function jP(t,e){const{layoutMap:i}=t.internalProps;if((t.internalProps.autoWrapText||t.internalProps.enableLineBreak)&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;const r=i.getBody(t.rowHeaderLevelCount,e);if("function"==typeof r.style||"function"==typeof r.icon||r.define?.customRender||r.define?.customLayout||"function"==typeof r.define?.icon)return!1;const o=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof o.padding&&"function"!=typeof o.fontSize&&"function"!=typeof o.lineHeight&&!0!==o.autoWrapText}function VP(t,e){const{layoutMap:i}=t.internalProps;if(t.internalProps.autoWrapText&&(t.isAutoRowHeight(e)||"adaptive"===t.options.heightMode))return!1;const r=i.getHeader(t.rowHeaderLevelCount,e);if("function"==typeof r.style||"function"==typeof r.icons||r.define?.headerCustomRender||r.define?.headerCustomLayout||"function"==typeof r.define?.icon)return!1;const o=t._getCellStyle(t.rowHeaderLevelCount,e);return"function"!=typeof o.padding&&"function"!=typeof o.fontSize&&"function"!=typeof o.lineHeight&&!0!==o.autoWrapText}function UP(t,e,i){const r=i.getCustomRender(t,e);let o=i.getCustomLayout(t,e);if(r||o){let n,s=1,a=0,l=!1,h=!1;(i.isHeader(t,e)||i.getBodyColumnDefine(t,e)?.mergeCell||i.hasCustomMerge())&&(n=i.getCellRange(t,e),s=n.end.row-n.start.row+1);const c={col:n?.start.col??t,row:n?.start.row??e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:$P(t,e,i),table:i,originCol:t,originRow:e,forComputation:!0};if("react-custom-layout"===o&&(o=i.reactCustomLayout?.getCustomLayoutFunc(t,e)||kM),Ox(o)){const e=o(c);e.rootContainer?(e.rootContainer=VM(e.rootContainer),jM(e.rootContainer,i.getColWidth(t),0),e.rootContainer.setStage(i.scenegraph.stage),a=e.rootContainer.AABBBounds.height()??0,l=e.renderDefault,h=e.enableCellPadding):(a=0,l=e.renderDefault,h=e.enableCellPadding)}else if("function"==typeof r){const t=r(c);a=t?.expectedHeight??0,l=t?.renderDefault}else a=r?.expectedHeight??0,l=r?.renderDefault;if(h){const r=pB(qM("padding",i._getCellStyle(t,e),t,e,i));a+=r[0]+r[2]}return{height:a/s,renderDefault:l}}}function KP(t,e,i,r){let o=0;const n=r.getCellValue(t,e),s=r._getCellStyle(t,e);let a=0,l=0;const h=[];let c=0;const d=[];let u=0,g=!1;if("body"!==r.getCellLocation(t,e))g=!0;else{const i=r.getBodyColumnDefine(t,e);g=!!i?.icon||!!i?.tree||i?.dragOrder}if(g){const i=r.getCellIcons(t,e);i?.forEach((t=>{t.positionType!==Ex.absoluteRight&&t.positionType!==Ex.inlineFront&&t.positionType!==Ex.inlineEnd?(l+=(t.width??0)+(t.marginLeft??0)+(t.marginRight??0),a=Math.max(a,t.height??0)):t.positionType===Ex.inlineFront?(h.push(t),c=Math.max(c,(t.height??0)+(t.marginLeft??0)+(t.marginRight??0))):t.positionType===Ex.inlineEnd&&(d.push(t),u=Math.max(u,(t.height??0)+(t.marginLeft??0)+(t.marginRight??0)))}))}let p=1,f=t;if(r.isHeader(t,e)||r.getBodyColumnDefine(t,e)?.mergeCell||r.hasCustomMerge()){const i=r.getCellRange(t,e);p=i.end.row-i.start.row+1,t=i.start.col,f=i.end.col}const m=pB(qM("padding",s,t,e,r)),b=qM("fontSize",s,t,e,r),y=qM("fontStyle",s,t,e,r),C=qM("fontWeight",s,t,e,r),w=qM("lineHeight",s,t,e,r)??b,v=qM("fontFamily",s,t,e,r),x=qM("autoWrapText",s,t,e,r),_=qM("lineClamp",s,t,e,r),S=qM("underline",s,t,e,r),A=qM("underlineOffset",s,t,e,r)??0;let T;if("text"!==i&&"link"!==i&&"progressbar"!==i&&"checkbox"!==i&&"radio"!==i&&"switch"!==i&&"button"!==i)o=w;else if("checkbox"===i)o=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=sS(Nx(t)?t.text:t).split("\n")||[],m=p.getColsWidth(e,r),b=qM("size",o,e,i,p);let y=0;if(n){const t=qM("spaceBetweenTextAndIcon",o,e,i,p),r=m-(g[1]+g[3])-s-b-t;TP.setAttributes({text:{maxLineWidth:r,text:f,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:c,lineHeight:d,wordBreak:"break-word",lineClamp:u},icon:{width:Math.floor(b/1.4),height:Math.floor(b/1.4)},box:{width:b,height:b},spaceBetweenTextAndIcon:t}),TP.render(),y=TP.AABBBounds.height()}else y=Math.max(b,f.length*d);return y}(n,t,e,f,s,x,l,b,y,C,v,w,_,m,r);else if("radio"===i)o=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){if(Ux(t)){let f=0;const m=p.getBodyColumnDefine(e,i),b=qM("spaceBetweenRadio",o,e,i,p),y=m?.radioDirectionInCell??"vertical";return"vertical"===y?t.forEach(((m,y)=>{const C=MP(m,e,i,r,o,n,s,a,l,h,c,d,u,g,p);f+=C,y!==t.length-1&&(f+=b)})):"horizontal"===y&&t.forEach((t=>{const m=MP(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p);f=Math.max(m,f)})),f}return MP(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p)}(n,t,e,f,s,x,l,b,y,C,v,w,_,m,r);else if("switch"===i)o=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){return qM("boxWidth",o,e,i,p)}(0,t,e,0,s,0,0,0,0,0,0,0,0,0,r);else if("button"===i)o=function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=sS(Nx(t)?t.text:t).split("\n")||[],m=p.getColsWidth(e,r),b=qM("buttonPadding",o,e,i,p),y=qM("buttonLineWidth",o,e,i,p);let C=0;if(n){const t=m-(g[1]+g[3]);BP.setAttributes({text:f,textStyle:{maxLineWidth:t,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:c,lineHeight:d,wordBreak:"break-word",lineClamp:u},padding:b,panel:{visible:!0,fill:"red",stroke:"red",lineWidth:y}}),RP.render(),C=RP.AABBBounds.height()}else C=f.length*d+2*b;return C}(n,t,e,f,s,x,0,b,y,C,v,w,_,m,r);else{T=n;const i=eP(T,r).text,s=r.getColsWidth(t,f);if(h.length||d.length)if(x){const t=Object.assign({text:n?.toString(),fontFamily:v,fontSize:b,fontStyle:y,fontWeight:C,lineHeight:w});t.textBaseline="middle";const e=[...h.map((t=>rP(t))),t,...d.map((t=>rP(t)))];WP.setAttributes({width:s-(m[1]+m[3])-l,height:0,textConfig:e}),o=WP.AABBBounds.height()}else o=0,i.forEach(((t,e)=>{r.options.customConfig?.multilinesForXTable&&0!==e||(0===e&&h.length?o+=Math.max(w,c):e===i.length-1&&d.length?o+=Math.max(w,u):o+=w)}));else if(x){const n=tP(t,e,r),a=DP({maxLineWidth:s-(m[1]+m[3])-l-n,text:i,fontSize:b,fontStyle:y,fontWeight:C,fontFamily:v,lineHeight:w,wordBreak:"break-word",whiteSpace:1!==i.length||x?"normal":"no-wrap",lineClamp:_});o=(a.height()||("number"==typeof w?w:b))+(S?A:0)}else o=r.options.customConfig?.multilinesForXTable?w:i.length*w}return(Math.max(o,a)+m[0]+m[2])/p}function $P(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:i.getColWidth(t),height:0}}function XP(t,e){if(!e||!e.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:i,mergeEndCol:r,mergeStartRow:o,mergeEndRow:n,col:s,row:a}=t;return{colStart:i,colEnd:r,rowStart:o,rowEnd:n}}function YP(t,e,i,r){!r&&i&&t.table._setRowHeight(e,t.table.getRowHeight(e)+i,!0);for(let r=0;r<t.table.colCount;r++){const o=t.getCell(r,e);if("empty"===o.role)continue;const n=CA(t.table,r,e);if(n&&n.start.col!==r)continue;qP(t,o,r,e,o.attribute.height+i,i,t.table.isHeader(r,e)),t.updateCellContentWhileResize(r,e)}let o=0,n=0;e<t.table.frozenRowCount?(o=e+1,n=t.table.frozenRowCount-1):e>=t.table.rowCount-t.table.bottomFrozenRowCount?(o=e+1,n=t.table.rowCount-1):(o=e+1,n=Math.min(t.proxy.rowEnd,t.table.rowCount-t.table.bottomFrozenRowCount-1));for(let e=0;e<t.table.colCount;e++)for(let r=o;r<=n;r++){const o=t.highPerformanceGetCell(e,r);"cell"===o.role&&o.setAttribute("y",o.attribute.y+i)}}function qP(t,e,i,r,o,n,s){e&&function(t,e,i,r,o,n,s){if(e.attribute.height===o&&!e.needUpdateHeight)return;e.needUpdateHeight=!1,e.setAttribute("height",o);const a=t.table.getCellRawRecord(i,r)?.vtableMerge,l=!!t.table.getCustomMerge(i,r),h=a||l?"text":t.table.isHeader(i,r)?t.table._getHeaderLayoutMap(i,r).headerType??"text":t.table.getBodyColumnType(i,r)??"text";if("progressbar"===h){const s=t.table.getBodyColumnDefine(i,r),a=t.table._getCellStyle(i,r),l=t.table.getCellValue(i,r),h=t.table.getCellOriginValue(i,r),c=pB(qM("padding",a,i,r,t.table));let d;s?.mergeCell&&(d=t.table.getCellRange(i,r));const u=wA.getFunction("createProgressBarCell")(s,a,e.attribute.width,l,h,i,r,c,t.table,d),g=e.getChildByName("progress-bar");e.insertBefore(u,g),e.removeChild(g),g.removeAllChild(),g.release(),ZP(e,o,n,t.table.isAutoRowHeight(r),!0,t.table)}else if("sparkline"===h){e.removeAllChild();const o=t.table._getCellStyle(i,r),n=pB(qM("padding",o,i,r,t.table));wA.getFunction("createSparkLineCellGroup")(e,e.parent,e.attribute.x,e.attribute.y,i,r,e.attribute.width,e.attribute.height,n,t.table,ZB(o,t.table,i,r,qM).theme,!1)}else if("image"===h||"video"===h)cP(e,i,r,0,0,t.table);else if("axis"===e.firstChild?.name)e.firstChild?.originAxis.resize(e.attribute.width,e.attribute.height);else{let s=!0;const a=e.getChildByName(DM)||e.getChildByName(WM);if(a){let o;e.removeChild(a);const n=SP(i,r,e,t.table);if(n)for(let e=n.start.row;e<=n.end.row;e++){if(e===r)continue;const o=t.getCell(i,e),n=o.getChildByName(DM)||o.getChildByName(WM);n.removeAllChild(),o.removeChild(n),SP(i,e,o,t.table)}else{let n,a;const l=t.table.getCellLocation(i,r),{vtableMerge:h}=t.table.getCellRawRecord(i,r)||{};if(h&&t.table.internalProps.groupTitleCustomLayout)a=t.table.internalProps.groupTitleCustomLayout;else if("body"!==l){const e=t.table.getHeaderDefine(i,r);n=e?.headerCustomRender,a=e?.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,r);n=e?.customRender||t.table.customRender,a=e?.customLayout}if((n||a)&&AP(e))for(let i=e.mergeStartCol;i<=e.mergeEndCol;i++)for(let o=e.mergeStartRow;o<=e.mergeEndRow;o++)o!==r&&t.updateCellContent(i,o);if(a||n){const l=pB(qM("padding",t.table._getCellStyle(i,r),i,r,t.table));let h=e.attribute.width,c=e.attribute.height;AP(e)&&(h=t.table.getColsWidth(e.mergeStartCol,e.mergeEndCol),c=t.table.getRowsHeight(e.mergeStartRow,e.mergeEndRow));const d=NM(a,n,i,r,h,c,!1,t.table.isAutoRowHeight(r),l,AP(e)?{start:{col:e.mergeStartCol,row:e.mergeStartRow},end:{col:e.mergeEndCol,row:e.mergeEndRow}}:void 0,t.table);o=d.elementsGroup,s=d.renderDefault}e.childrenCount>0&&o?e.insertBefore(o,e.firstChild):o&&e.appendChild(o)}}ZP(e,o,n,t.table.isAutoRowHeight(r),s,t.table)}}(t,e,i,r,o,n)}function ZP(t,e,i,r,o,n){if(AP(t)){e=0;for(let i=t.mergeStartRow;i<=t.mergeEndRow;i++)e+=n.getRowHeight(i);const{colStart:i,colEnd:s,rowStart:a,rowEnd:l}=XP(t,n.scenegraph);for(let h=i;h<=s;h++)for(let s=a;s<=l;s++){const l=n.scenegraph.getCell(h,s);if("cell"!==l.role)continue;if(l.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})})),o){const t=n._getCellStyle(i,a);nP(l,e,0,r,pB(qM("padding",t,h,s,n)),t.textAlign,t.textBaseline,n)}const c=n.getRowHeight(s),d=n.getColWidth(h);l.contentHeight=e;const{widthChange:u}=_P(l,d,c,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},n);u&&(l.needUpdateWidth=!0)}}else{const i=n._getCellStyle(t.col,t.row);nP(t,e,0,r,pB(qM("padding",i,t.col,t.row,n)),i.textAlign,i.textBaseline,n)}}function JP(t,e,i,r){let o=!1;const n=t?.attribute.width??0;if(t?.setAttribute("width",n+e),t?.forEachChildren(((t,s)=>{const a=function(t,e,i,r,o,n,s,a,l){if(e.attribute.width===n&&!e.needUpdateWidth)return!1;e.needUpdateWidth=!1,e.setAttribute("width",n);const h=e;if(!h)return!1;const c=t.table.isAutoRowHeight(r),d=t.table.getCellRawRecord(i,r)?.vtableMerge,u=!!t.table.getCustomMerge(i,r),g=d||u?"text":t.table.isHeader(i,r)?t.table._getHeaderLayoutMap(i,r).headerType??"text":t.table.getBodyColumnType(i,r)??"text";let p=!1;if("progressbar"===g){const e=t.table.getBodyColumnDefine(i,r),o=t.table._getCellStyle(i,r),a=t.table.getCellValue(i,r),l=t.table.getCellOriginValue(i,r),d=pB(qM("padding",o,i,r,t.table));let u;e?.mergeCell&&(u=t.table.getCellRange(i,r));const g=wA.getFunction("createProgressBarCell")(e,o,h.attribute.width,a,l,i,r,d,t.table,u),f=h.getChildByName("progress-bar");h.insertBefore(g,f),h.removeChild(f),f.removeAllChild(),f.release();const m=QP(h,n,s,c,!0,t.table);p=p||m}else if("sparkline"===g){h.removeAllChild();const e=t.table._getCellStyle(i,r),o=pB(qM("padding",e,i,r,t.table));wA.getFunction("createSparkLineCellGroup")(h,h.parent,h.attribute.x,h.attribute.y,i,r,h.attribute.width,h.attribute.height,o,t.table,ZB(e,t.table,i,r,qM).theme,!1)}else if("image"===g||"video"===g)cP(h,i,r,s,0,t.table);else if("axis"===h.firstChild?.name){const e=t.table.internalProps.layoutMap.getAxisConfigInPivotChart(i,r),o=pB(qM("padding",t.table._getCellStyle(i,r),i,r,t.table));if(e){const i=new(wA.getComponent("axis"))(e,h.attribute.width,h.attribute.height,e.__vtablePadding??o,t.table);h.clear(),h.appendChild(i.component),i.overlap()}}else if("axis"===e.firstChild?.name)e.firstChild?.originAxis.resize(e.attribute.width,e.attribute.height);else{let o=!0;const a=e.getChildByName(DM)||e.getChildByName(WM);if(a){let n;e.removeChild(a);const s=SP(i,r,e,t.table);if(s)for(let e=s.start.col;e<=s.end.col;e++){if(e===i)continue;const o=t.getCell(e,r),n=o.getChildByName(DM)||o.getChildByName(WM);n.removeAllChild(),o.removeChild(n),SP(e,r,o,t.table)}else{let s,a;const l=t.table.getCellLocation(i,r),{vtableMerge:c}=t.table.getCellRawRecord(i,r)||{};if(c&&t.table.internalProps.groupTitleCustomLayout)a=t.table.internalProps.groupTitleCustomLayout;else if("body"!==l){const e=t.table.getHeaderDefine(i,r);s=e?.headerCustomRender,a=e?.headerCustomLayout}else{const e=t.table.getBodyColumnDefine(i,r);s=e?.customRender||t.table.customRender,a=e?.customLayout}if((s||a)&&AP(h))for(let e=h.mergeStartCol;e<=h.mergeEndCol;e++)if(e!==i)for(let i=h.mergeStartRow;i<=h.mergeEndRow;i++)t.updateCellContent(e,i);if(a||s){const e=pB(qM("padding",t.table._getCellStyle(i,r),i,r,t.table));let l=h.attribute.width,c=h.attribute.height;AP(h)&&(l=t.table.getColsWidth(h.mergeStartCol,h.mergeEndCol),c=t.table.getRowsHeight(h.mergeStartRow,h.mergeEndRow));const d=NM(a,s,i,r,l,c,!1,t.table.isAutoRowHeight(r),e,AP(h)?{start:{col:h.mergeStartCol,row:h.mergeStartRow},end:{col:h.mergeEndCol,row:h.mergeEndRow}}:void 0,t.table);n=d.elementsGroup,o=d.renderDefault,p=!0}e.childrenCount>0&&n?e.insertBefore(n,e.firstChild):n&&e.appendChild(n)}}const l=QP(h,n,s,c,o,t.table);p=p||l}if(!l){l=t.table._getCellStyle(i,r).autoWrapText}return!(!c||!l)&&p}(r,t,t.col,t.row,0,n+e,e,"row-body"!==i||(t.col,r.table.rowHeaderLevelCount),r.table.internalProps.autoWrapText);if(a){const e=CA(r.table,t.col,t.row);if(e&&e.end.row-e.start.row)for(let t=e.start.row;t<=e.end.row;t++)tH(r,t);else tH(r,t.row);o=!0}})),o){let t,e,o,n=0;for(let s=0;s<r.table.colCount;s++){if("col-corner"===i?(o=0,t=r.getColGroup(s,!0),e=r.colHeaderGroup.attribute.height??0):"row-body"===i?(o=r.table.frozenRowCount,t=r.getColGroup(s,!1),e=r.bodyGroup.attribute.height??0):"bottom"===i?(o=r.table.rowCount-r.table.bottomFrozenRowCount,t=r.getColGroupInBottom(s),e=r.bottomFrozenGroup.attribute.height??0):"left-bottom"===i?(o=r.table.rowCount-r.table.bottomFrozenRowCount,t=r.getColGroupInLeftBottomCorner(s),e=r.leftBottomCornerGroup.attribute.height??0):"right-top"===i?(o=0,t=r.getColGroupInRightTopCorner(s),e=r.rightTopCornerGroup.attribute.height??0):"right-bottom"===i&&(o=r.table.rowCount-r.table.bottomFrozenRowCount,t=r.getColGroupInRightBottomCorner(s),e=r.rightBottomCornerGroup.attribute.height??0),!t)continue;let a=0;t.forEachChildren((t=>{t.setAttribute("y",a),a+=r.table.getRowHeight(t.row)??0})),n=a}r.updateContainerHeight(o,n-e);for(let t=0;t<r.table.frozenColCount;t++){const e=r.getColGroupInLeftBottomCorner(t);let i=0;e?.forEachChildren((t=>{t.setAttribute("y",i),i+=r.table.getRowHeight(t.row)}))}for(let t=r.table.colCount-r.table.rightFrozenColCount;t<r.table.colCount;t++){const e=r.getColGroupInRightBottomCorner(t);let i=0;e?.forEachChildren((t=>{t.setAttribute("y",i),i+=r.table.getRowHeight(t.row)}))}for(let t=r.table.frozenColCount;t<r.table.colCount-r.table.rightFrozenColCount;t++){const e=r.getColGroupInBottom(t);let i=0;e?.forEachChildren((t=>{t.setAttribute("y",i),i+=r.table.getRowHeight(t.row)}))}}}function QP(t,e,i,r,o,n){if(AP(t)){e=0;let s=!1;for(let i=t.mergeStartCol;i<=t.mergeEndCol;i++)e+=n.getColWidth(i);let a=0;for(let e=t.mergeStartRow;e<=t.mergeEndRow;e++)a+=n.getRowHeight(e);const{colStart:l,colEnd:h,rowStart:c,rowEnd:d}=XP(t,n.scenegraph);for(let u=l;u<=h;u++)for(let h=c;h<=d;h++){if(u===t.col&&h!==t.row)continue;const d=n.scenegraph.getCell(u,h);if("cell"!==d.role)continue;d.forEachChildren((t=>{t.setAttributes({dx:0,dy:0})}));let g=!1;if(o){const t=n._getCellStyle(l,c);g=oP(d,e,a,i,r,pB(qM("padding",t,u,h,n)),t.textAlign,t.textBaseline,n.scenegraph);const o=tP(d.col,d.row,n);if(o){const t=d.getChildByName("text"),e=d.getChildByName("expand")||d.getChildByName("collapse");"icon-left"!==e?.role&&t&&t.setAttribute("dx",o)}}const p=n.getRowHeight(h),f=n.getColWidth(u);d.contentWidth=e;const{heightChange:m}=_P(d,f,p,{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}},n);m&&(d.needUpdateHeight=!0),s=s||g}return s}const s=n._getCellStyle(t.col,t.row),a=pB(qM("padding",s,t.col,t.row,n)),l=s.textAlign,h=s.textBaseline;return oP(t,e,n.getRowHeight(t.row),i,r,a,l,h,n.scenegraph)}function tH(t,e){const i=Math.round(GP(e,0,t.table.colCount-1,t.table));t.table._setRowHeight(e,i,!0);for(let r=0;r<t.table.colCount;r++){const o=i,n=t.highPerformanceGetCell(r,e);"empty"!==n.role&&qP(t,n,r,e,o,o-n.attribute.height,t.table.isHeader(r,e))}}var eH;!function(t){t.dropDown="dropDown",t.contextmenu="contextmenu",t.custom="custom"}(eH||(eH={}));const iH={fontSize:12,fontFamily:"Arial,sans-serif",color:"#000",highlightColor:"#2E68CF",hoverBgColor:"#EEE",lineHeight:30,bgColor:"#FFF",cornerRadius:4,borderWidth:.5,borderColor:"#CCC",menuPadding:6,menuItemPadding:9,maxLineWidth:200};const rH=MM();class oH{icon;constructor(){const t=rH.drillDown;this.icon=new PM({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,r,o,n){if(!t||r&&o)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void n.updateNextFrame();const s=rH.drillDown,a=rH.drillUp;this.icon.setAttributes({x:e,y:i,image:r?s.svg:a.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),n.updateNextFrame()}}class nH{columnMoverLabel;columnMoverLine;columnMoverBack;table;x;constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,r=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=rh({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=sh({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=hh({visible:!1,pickable:!1,fill:r,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const r=this.table.getCellLocation(t,e),o=CA(this.table,t,e);o&&(t=o.start.col,e=o.start.row);let n=0,s=0,a=0,l=0,h=0,c=0,d=0,u=0,g=Math.PI;const p=[];return"columnHeader"===r?(n=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,s=this.table.getRowsHeight(0,this.table.frozenRowCount-1),l=this.table.tableNoFrameHeight,a=o?this.table.getColsWidth(o.start.col,o.end.col):this.table.getColWidth(t),h=n-i,d=n+a,u=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):("rowHeader"===r||this.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(s=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,n=this.table.getColsWidth(0,this.table.frozenColCount-1),a=this.table.tableNoFrameWidth,l=o?this.table.getRowsHeight(o.start.row,o.end.row):this.table.getRowHeight(e),c=s-i,d=2,u=s+l,g=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:n-h,y:s-c,width:a,height:l,dx:h,dy:c}),this.columnMoverLine.setAttributes({x:d,y:u,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:d,y:u,angle:g}),{backX:n-h,lineX:d,backY:s-c,lineY:u}}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,r){"number"==typeof t&&"number"==typeof e?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):"number"==typeof i&&"number"==typeof r&&(this.columnMoverLabel.setAttribute("y",r),this.columnMoverLine.setAttribute("y",r),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function sH(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllColsWidth())-e.getColsWidth(t,e.colCount-1);let r=e.getColsWidth(0,t);return t>=e.frozenColCount&&(r-=e.scrollLeft),r}function aH(t,e,i){if(i)return Math.min(e.tableNoFrameWidth,e.getAllRowsHeight())-e.getRowsHeight(t,e.rowCount-1);let r=e.getRowsHeight(0,t);return t>=e.frozenRowCount&&(r-=e.scrollTop),r}class lH{table;border;columnResizeLine;columnResizeBgLine;columnResizeLabel;rowResizeLine;rowResizeBgLine;rowResizeLabel;menu;vScrollBar;hScrollBar;frozenShadowLine;rightFrozenShadowLine;drillIcon;cellMover;labelVisible;constructor(t){this.table=t;const e=this.table.theme;this.createScrollBar();const i=e.columnResize?.lineColor,r=e.columnResize?.lineWidth,o=e.columnResize?.bgColor,n=e.columnResize?.width,s=e.columnResize?.labelVisible??!0,a=e.columnResize?.labelColor,l=e.columnResize?.labelFontSize,h=e.columnResize?.labelFontFamily,c=e.columnResize?.labelBackgroundFill,d=e.columnResize?.labelBackgroundCornerRadius;this.labelVisible=s,this.columnResizeLine=sh({visible:!1,pickable:!1,stroke:i,lineWidth:r,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=sh({visible:!1,pickable:!1,stroke:o,lineWidth:n,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const u=Zl({visible:!1,pickable:!1,x:0,y:0,fontSize:l,fill:a,fontFamily:h,text:"",textBaseline:"top",dx:16,dy:-l/2}),g=hh({visible:!1,pickable:!1,fill:c,x:0,y:0,width:5*l*.8,height:l+8,cornerRadius:d,dx:12,dy:-l/2-4});this.columnResizeLabel=ol({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(g),this.columnResizeLabel.appendChild(u),this.rowResizeLine=sh({visible:!1,pickable:!1,stroke:i,lineWidth:r,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=sh({visible:!1,pickable:!1,stroke:o,lineWidth:n,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const p=Zl({visible:!1,pickable:!1,x:0,y:0,fontSize:l,fill:a,fontFamily:h,text:"",textBaseline:"top",dx:16,dy:-l/2}),f=hh({visible:!1,pickable:!1,fill:c,x:0,y:0,width:5*l*.8,height:l+8,cornerRadius:d,dx:12,dy:-l/2-4});this.rowResizeLabel=ol({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(f),this.rowResizeLabel.appendChild(p),this.cellMover=new nH(this.table);const m=e.frozenColumnLine?.shadow?.width,b=e.frozenColumnLine?.shadow?.startColor,y=e.frozenColumnLine?.shadow?.endColor,C=e.frozenColumnLine?.shadow?.visible;this.frozenShadowLine=hh({visible:"always"===C,pickable:!1,x:0,y:0,width:m,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:b,offset:0},{color:y,offset:1}]}}),this.rightFrozenShadowLine=hh({visible:"always"===C,pickable:!1,x:0,y:0,width:m,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:y,offset:0},{color:b,offset:1}]}}),this.menu=new class{_table;_menuInstance;_menuInfo;constructor(t){this._table=t,this._menuInstance=new $M({x:0,y:0,fill:iH.bgColor,stroke:iH.borderColor,cornerRadius:iH.cornerRadius,lineWidth:iH.borderWidth}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:eH.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,r,o,n){if(o===eH.dropDown&&this.checkDropDownMenuChange(i,r)){const t=this.getMenuInfo(i,r,o);if(!t)return;const{menuInfo:e,highlightIndex:n}=t;this.updateMenuInfo(i,r,o,e,n),this.updateMenuInstance(e,n)}else if(o===eH.contextmenu&&this.checkContextMenuChange(t,e)){const t=this.getMenuInfo(i,r,o);if(!t)return;const{menuInfo:e,highlightIndex:n}=t;this.updateMenuInfo(i,r,o,e,n),this.updateMenuInstance(e,n)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,r,o){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=r,this._menuInfo.highlightIndex=o}checkDropDownMenuChange(t,e){const{type:i,col:r,row:o}=this._menuInfo;return i!==eH.dropDown||t!==r||e!==o}checkContextMenuChange(t,e){const{type:i,menuInfo:r}=this._menuInfo;return i!==eH.contextmenu||r!==this._table.internalProps.menu?.contextMenuItems}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=iH.menuPadding;const r=iH.menuPadding;let o=0;t.forEach(((t,n)=>{const s=e===n;let a,l;"string"==typeof t?l=t:"object"==typeof t&&(l=t.text,a=s?t.selectedIcon:t.icon);const h=new $M({y:i,x:r,height:iH.lineHeight,fill:iH.bgColor});h.role="menu-item",this._menuInstance.appendChild(h),h.stateProxy=t=>"hover"===t?{fill:iH.hoverBgColor}:{fill:iH.bgColor},h.addEventListener("pointerenter",(t=>{h.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()})),h.addEventListener("pointerleave",(t=>{h.removeState("hover",!1),this._table.scenegraph.updateNextFrame()}));const c=new ql({x:iH.menuItemPadding,y:iH.menuItemPadding,fill:s?iH.highlightColor:iH.color,text:l,textBaseline:"top",fontSize:iH.fontSize,fontFamily:iH.fontFamily,pickable:!1,maxLineWidth:iH.maxLineWidth,ellipsis:"…"});if(h.addChild(c),a){c.AABBBounds.height();const t=a.width??16,e=a.height??16,i=new PM({x:iH.menuItemPadding,y:(iH.lineHeight-e)/2,width:t,height:e,image:a.svg,pickable:!1});i.role="menu-icon",h.insertBefore(i,c),c.setAttribute("x",t+iH.menuItemPadding)}o=Math.max(h.AABBBounds.width(),o),i+=iH.lineHeight})),this._menuInstance.setAttributes({width:o+2*iH.menuItemPadding+2*iH.menuPadding,height:i+iH.menuPadding}),this._menuInstance.forEachChildren((t=>{t.setAttribute("width",o+2*iH.menuItemPadding)}))}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===eH.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=eH.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){if(i===eH.dropDown){let i=this._table.globalDropDownMenu;i=this._table._getHeaderLayoutMap(t,e).dropDownMenu,"function"==typeof i&&(i=i({row:e,col:t,table:this._table}));let r=-1;if(Array.isArray(i))for(let o=0;o<i.length;o++)if(this._table._dropDownMenuIsHighlight(t,e,o)){r=o;break}return{menuInfo:i,highlightIndex:r}}if(i===eH.contextmenu){const i=this._table.internalProps.menu?.contextMenuItems;let r;if(Array.isArray(i))r=i;else if("function"==typeof i){const{field:o}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);r=i(o,e,t)}return{menuInfo:r,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",(t=>{const{target:e}=t;if(e&&"menu-item"===e.role){const i=this.getEventInfo(e),r=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),o=Object.assign(i,r);o.event=t.nativeEvent,this._table.fireListeners(OS.DROPDOWN_MENU_CLICK,o)}}))}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren(((e,r)=>e===t&&(i=r-1,!0)));const r="string"==typeof this._menuInfo.menuInfo[i]?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,o="string"==typeof this._menuInfo.menuInfo[i]?r:this._menuInfo.menuInfo[i].menuKey||r;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:r,menuKey:o}}get bounds(){return this._menuInstance.globalAABBBounds}}(this.table),this.drillIcon=new oH}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.rightFrozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),t.addChild(this.rowResizeBgLine),t.addChild(this.rowResizeLine),t.addChild(this.rowResizeLabel);this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){const t=this.table.theme,e=t.scrollStyle?.scrollRailColor,i=t.scrollStyle?.scrollSliderColor,r=t.scrollStyle?.scrollSliderCornerRadius,o=t.scrollStyle?.width,n=t.scrollStyle?.horizontalPadding,s=t.scrollStyle?.verticalPadding;let a;a=Wx(r)?{cornerRadius:r,fill:i}:{fill:i},this.hScrollBar=new by({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:o,padding:n,railStyle:{fill:e},sliderStyle:a,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new by({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:o,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:s,railStyle:{fill:e},sliderStyle:a,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){const t=this.table.stateManager.scroll.horizontalBarPos,e=this.table.stateManager.scroll.verticalBarPos,i=this.table.theme,r=i.scrollStyle?.width,o=i.scrollStyle?.visible,n=i.scrollStyle?.horizontalVisible??o,s=i.scrollStyle?.verticalVisible??o,a=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),l=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),h=this.table.getAllRowsHeight(),c=this.table.getAllColsWidth(),d=this.table.getFrozenRowsHeight(),u=this.table.getFrozenColsWidth(),g=this.table.getBottomFrozenRowsHeight(),p=this.table.getRightFrozenColsWidth(),f=this.table.options.customConfig?._disableColumnAndRowSizeRound?1:0;if(c>a+f){const t=Math.min(l,h),e=Math.max(.05,(a-u)/(c-u)),i=this.table.theme.scrollStyle.hoverOn;let o=0;o=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(i?r:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:t-(i?r:-this.table.scenegraph.tableGroup.attribute.y),this.hScrollBar.setAttributes({x:u+(i?0:this.table.scenegraph.tableGroup.attribute.x),y:o,width:a-u-p,range:[0,e],visible:"always"===n});const s=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:s.x1,y:s.y1},"always"===n&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(h>l+f){const t=Math.min(a,c),e=Math.max(.05,(l-d)/(h-d));let i=0;const o=this.table.theme.scrollStyle.hoverOn;i=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(o?r:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:t-(o?r:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:i,y:d+(o?0:this.table.scenegraph.tableGroup.attribute.y),height:l-d-g,range:[0,e],visible:"always"===s});const n=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:n.x1,y:n.y1},"always"===s&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(t),this.table.stateManager.setScrollTop(e)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const r=sH(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`))}updateResizeCol(t,e,i){const r=sH(t,this.table,i);this.columnResizeLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.setAttributes({x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`))}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(t,e,i){const r=aH(t,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(t)}px`))}updateResizeRow(t,e,i){const r=aH(t,this.table,i);this.rowResizeLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.setAttributes({y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(t))}px`))}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){return this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,r){this.cellMover.update(t,e,i,r)}setFrozenColumnShadow(t,e){const i=sH(t,this.table,e);t<0||"always"!==this.table.theme.frozenColumnLine?.shadow?.visible?this.frozenShadowLine.setAttributes({visible:!1,x:i,height:this.table.getDrawRange().height}):this.frozenShadowLine.setAttributes({visible:!0,x:i,height:this.table.getDrawRange().height})}setRightFrozenColumnShadow(t){const e=sH(t,this.table,!0);t>=this.table.colCount||"always"!==this.table.theme.frozenColumnLine?.shadow?.visible?this.rightFrozenShadowLine.setAttributes({visible:!1,x:e-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height}):this.rightFrozenShadowLine.setAttributes({visible:!0,x:e-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}hideFrozenColumnShadow(){const t=this.table.theme.frozenColumnLine?.shadow?.visible;"scrolling"===(this.table.theme.frozenColumnLine?.shadow?.visible??t)&&(this.frozenShadowLine.setAttribute("visible",!1),this.rightFrozenShadowLine.setAttribute("visible",!1),this.table.scenegraph.updateNextFrame())}showFrozenColumnShadow(){const t=this.table.theme.frozenColumnLine?.shadow?.visible;"scrolling"===(this.table.theme.frozenColumnLine?.shadow?.visible??t)&&(this.frozenShadowLine.setAttribute("visible",!0),this.rightFrozenShadowLine.setAttribute("visible",!0),this.table.scenegraph.updateNextFrame())}hideVerticalScrollBar(){const t=this.table.theme.scrollStyle.visible,e=this.table.theme.scrollStyle.verticalVisible??t;"focus"!==e&&"scrolling"!==e||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){const t=this.table.theme.scrollStyle.visible,e=this.table.theme.scrollStyle.verticalVisible??t;"focus"!==e&&"scrolling"!==e||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){const t=this.table.theme.scrollStyle.visible,e=this.table.theme.scrollStyle.horizontalVisible??t;"focus"!==e&&"scrolling"!==e||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){const t=this.table.theme.scrollStyle.visible,e=this.table.theme.scrollStyle.horizontalVisible??t;"focus"!==e&&"scrolling"!==e||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateStyle(){const t=this.table.theme,e=t.scrollStyle?.scrollRailColor,i=t.scrollStyle?.scrollSliderColor,r=t.scrollStyle?.scrollSliderCornerRadius,o=t.scrollStyle?.width,n=t.scrollStyle?.horizontalPadding,s=t.scrollStyle?.verticalPadding;let a;a=Wx(r)?{cornerRadius:r,fill:i}:{fill:i},this.hScrollBar.setAttributes({height:o,padding:n,railStyle:{fill:e},sliderStyle:a}),this.vScrollBar.setAttributes({width:o,padding:s,railStyle:{fill:e},sliderStyle:a});const l=t.columnResize?.lineColor,h=t.columnResize?.lineWidth,c=t.columnResize?.bgColor,d=t.columnResize?.width;this.columnResizeLine.setAttributes({stroke:l,lineWidth:h}),this.columnResizeBgLine=sh({stroke:c,lineWidth:d});const u=t.columnResize?.labelColor,g=t.columnResize?.labelFontSize,p=t.columnResize?.labelFontFamily,f=t.columnResize?.labelBackgroundFill,m=t.columnResize?.labelBackgroundCornerRadius,b=t.columnResize?.labelVisible??!0;this.labelVisible=b,this.columnResizeLabel.lastChild.setAttributes({fontSize:g,fill:u,fontFamily:p,dy:-g/2}),this.columnResizeLabel.firstChild.setAttributes({fill:f,width:5*g*.8,height:g+8,cornerRadius:m,dy:-g/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:g,fill:u,fontFamily:p,dy:-g/2}),this.rowResizeLabel.firstChild.setAttributes({fill:f,width:5*g*.8,height:g+8,cornerRadius:m,dy:-g/2-4});const y=t.frozenColumnLine?.shadow?.width,C=t.frozenColumnLine?.shadow?.startColor,w=t.frozenColumnLine?.shadow?.endColor;this.frozenShadowLine.setAttributes({width:y,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:C,offset:0},{color:w,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:y,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:w,offset:0},{color:C,offset:1}]}}),this.cellMover.updateStyle()}}function hH(t,e,i,r,o){if(!e)return;const n="table"===i,{shadowBlur:s,shadowOffsetX:a,shadowOffsetY:l,shadowColor:h,cornerRadius:c,borderColor:d,borderLineWidth:u,borderLineDash:g}=e;let p=!1;const f={},m={pickable:!1};s&&n&&(m.shadowBlur=s,m.shadowOffsetX=a,m.shadowOffsetY=l,m.shadowColor=h,m.stroke=!0,m.stroke=h,m.lineWidth=1,p=!0),u&&(m.stroke=!0,m.fill=!1,m.stroke=dH(d??"#E1E4E8",r,u),m.lineWidth=u,g&&(m.lineDash=g),m.lineCap="butt"),Array.isArray(d)&&(m.strokeArrayColor=pB(d)),Array.isArray(u)&&(m.strokeArrayWidth=pB(u),m.lineWidth=1),c&&(m.cornerRadius=c,f.cornerRadius=c);const b=m.strokeArrayWidth?m.strokeArrayWidth[0]:m.lineWidth??0,y=m.strokeArrayWidth?m.strokeArrayWidth[1]:m.lineWidth??0,C=m.strokeArrayWidth?m.strokeArrayWidth[2]:m.lineWidth??0,w=m.strokeArrayWidth?m.strokeArrayWidth[3]:m.lineWidth??0;if(t.setAttributes(f),!o)if(m.stroke)if(m.x=w/2,m.y=b/2,m.pickable=!1,n){if(c)if(Array.isArray(c)){const t=pB(c);m.cornerRadius=t,f.cornerRadius=t,t[0]&&(t[0]=t[0]+Math.min(w,b)/2),t[1]&&(t[1]=t[1]+Math.min(b,y)/2),t[2]&&(t[2]=t[2]+Math.min(y,C)/2),t[3]&&(t[3]=t[3]+Math.min(C,w)/2)}else if(Ux(u)){const t=[];m.cornerRadius=t,f.cornerRadius=t,t[0]=c+Math.min(w,b)/2,t[1]=c+Math.min(b,y)/2,t[2]=c+Math.min(y,C)/2,t[3]=c+Math.min(C,w)/2}else m.cornerRadius=c+(m.lineWidth??0)/2,f.cornerRadius=c+(m.lineWidth??0)/2;let i,r;if(e.innerBorder?(m.x=t.attribute.x+w/2,m.y=t.attribute.y+b/2,m.width=t.attribute.width-w/2-y/2,m.height=t.attribute.height-b/2-C/2):(m.x=t.attribute.x-w/2,m.y=t.attribute.y-b/2,m.width=t.attribute.width+w/2+y/2,m.height=t.attribute.height+b/2+C/2),p){m.fill="white",m.notAdjustPos=!0,r=ol(m),r.name="table-border-rect",i=hh({x:w/2,y:b/2,width:t.attribute.width,height:t.attribute.height,fill:"red",cornerRadius:t.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),r.addChild(i);const e=hh({x:w/2,y:b/2,width:t.attribute.width,height:t.attribute.height,fill:"transparent",pickable:!1,globalCompositeOperation:"source-over"});r.addChild(e)}else r=hh(m),r.name="table-border-rect";e.innerBorder&&!p?t.parent.insertAfter(r,t):t.parent.insertBefore(r,t),t.border=r}else{m.width=t.attribute.width-w/2-y/2,m.height=t.attribute.height-b/2-C/2;const e=hh(m);e.name="border-rect",t.addChild(e),t.border=e}else{const e=hh({fill:!1,stroke:!1,pickable:!1,lineWidth:0});e.name="border-rect",t.addChild(e),t.border=e}}function cH(t,e,i){if(!e)return;const{borderColor:r}=e;t.border?.setAttribute("stroke",dH(r,i))}function dH(t,e,i){let r=!0;return!e&&!Ux(i)||Ux(t)?e?r=e:e||Ux(t)?Ux(t)&&(r=!0):r=t:r=(e??i).map((e=>!!e&&t)),r}function uH(t){if(!t.border)return;const e=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[0]:t.border.attribute.lineWidth??0,i=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[1]:t.border.attribute.lineWidth??0,r=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[2]:t.border.attribute.lineWidth??0,o=t.border.attribute.strokeArrayWidth?t.border.attribute.strokeArrayWidth[3]:t.border.attribute.lineWidth??0;t.border.setAttributes({borderLeft:o,borderTop:e,borderRight:i,borderBottom:r,width:t.attribute.width-o/2-i/2,height:t.attribute.height-e/2-r/2}),"group"===t.border.type&&t.border.firstChild.setAttributes({width:t.attribute.width,height:t.attribute.height})}function gH(t,e){t.setAttribute("cornerRadius",e),t.border&&t.border.setAttribute("cornerRadius",e)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function pH(t,e,i,r){var o,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(n<3?o(s):n>3?o(e,i,s):o(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s}function fH(t,e){let i,r;if("cell"===t.role&&Wx(t.mergeStartCol)&&Wx(t.mergeStartRow)&&Wx(t.mergeEndCol)&&Wx(t.mergeEndRow)){const{colStart:r,colEnd:o,rowStart:n,rowEnd:s}=XP(t,e.scenegraph);for(let a=r;a<=o;a++)for(let r=n;r<=s;r++){const o=mH(e.stateManager,a,r,t);!o||i&&"cellBgColor"!==o||(i=o)}}else"cell"===t.role&&(i=mH(e.stateManager,t.col,t.row,t));if(!i)return;const o=e.internalProps.layoutMap;o.isCornerHeader(t.col,t.row)?r=e.theme.cornerHeaderStyle?.hover||e.theme.headerStyle?.hover:o.isColumnHeader(t.col,t.row)?r=e.theme.headerStyle?.hover:o.isRowHeader(t.col,t.row)?r=e.theme.rowHeaderStyle?.hover:o.isBottomFrozenRow(t.col,t.row)?r=e.theme.bottomFrozenStyle?.hover||(e.isListTable()?e.theme.bodyStyle?.hover:e.theme.headerStyle?.hover):o.isRightFrozenColumn(t.col,t.row)?r=e.theme.rightFrozenStyle?.hover||(e.isListTable()?e.theme.bodyStyle?.hover:e.theme.rowHeaderStyle?.hover):e.isHeader(t.col,t.row)||(r=e.theme.bodyStyle?.hover);return qM(i,r,t.col,t.row,e)}function mH(t,e,i,r){const{highlightScope:o,disableHeader:n,cellPos:s}=t.hover,a=t.table,l=a.isHeader(e,i);if(l&&n)return;let h;if(o===Rx.single&&s.col===e&&s.row===i?h="cellBgColor":o===Rx.column&&s.col===e?h=s.col===e&&s.row===i?"cellBgColor":"inlineColumnBgColor":o===Rx.row&&s.row===i?h=s.col===e&&s.row===i?"cellBgColor":"inlineRowBgColor":o===Rx.cross&&(s.col===e&&s.row===i?h="cellBgColor":s.col===e?h="inlineColumnBgColor":s.row===i&&(h="inlineRowBgColor")),h){let t;if(l){const o=a.getHeaderDefine(e,i);t=o?.disableHeaderHover,r.firstChild&&"axis"===r.firstChild.name&&a.options.hover?.disableAxisHover&&(t=!0)}else{const r=a.getBodyColumnDefine(e,i);t=r?.disableHover}t&&(h=void 0)}return h}const bH=Zs();class yH extends lh{type="chart";chartInstance;activeChartInstance;active;cacheCanvas;isShareChartSpec;constructor(t,e){if(super(e),this.numberType=bH,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const t=this.chartInstance=new e.ClassType(e.spec,s_({},this.attribute.tableChartOption,{renderCanvas:e.canvas,mode:"node"===this.attribute.mode?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1}));t.renderSync(),t.getStage().enableDirtyBounds(),e.chartInstance=this.chartInstance=t}}activate(t){this.active=!0;const{col:e,row:i}=this.parent,r=fH(this.parent,t),{x1:o,y1:n,x2:s,y2:a}=this.getViewBox(),l=function(t,e,i){const{layoutMap:r}=i.internalProps,o=new g_,n=i.scenegraph.tableGroup.globalAABBBounds;o.x1=n.x1,o.x2=n.x2,o.y1=n.y1,o.y2=n.y2,r.isLeftBottomCorner(t,e)||r.isRightTopCorner(t,e)||r.isLeftTopCorner(t,e)||r.isRightBottomCorner(t,e)||(r.isFrozenColumn(t,e)?(o.y1=n.y1+i.getFrozenRowsHeight(),o.y2=n.y2-i.getBottomFrozenRowsHeight()):r.isFrozenRow(t,e)?(o.x1=n.x1+i.getFrozenColsWidth(),o.x2=n.x2-i.getRightFrozenColsWidth()):r.isRightFrozenColumn(t,e)?(o.y1=n.y1+i.getFrozenRowsHeight(),o.y2=n.y2-i.getBottomFrozenRowsHeight()):r.isBottomFrozenRow(t,e)?(o.x1=n.x1+i.getFrozenColsWidth(),o.x2=n.x2-i.getRightFrozenColsWidth()):r.isFrozenColumn(t,e)||r.isRightFrozenColumn(t,e)||(o.x1=n.x1+i.getFrozenColsWidth(),o.x2=n.x2-i.getRightFrozenColsWidth(),o.y1=n.y1+i.getFrozenRowsHeight(),o.y2=n.y2-i.getBottomFrozenRowsHeight()));return o.x1=o.x1+(i.options.viewBox?.x1??0),o.x2=o.x2+(i.options.viewBox?.x1??0),o.y1=o.y1+(i.options.viewBox?.y1??0),o.y2=o.y2+(i.options.viewBox?.y1??0),o}(e,i,t),h=l.intersect({x1:o-t.scrollLeft,x2:s-t.scrollLeft,y1:n-t.scrollTop,y2:a-t.scrollTop});this.activeChartInstance?.release(),this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,s_({},this.attribute.tableChartOption,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:0,x2:s-o,y1:0,y2:a-n},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:e=>{const i=this.stage,r=e.window.getContext(),o=i.window.getViewBoxTransform(),n=i.window.getViewBox();r.inuse=!0,r.clearMatrix(),r.setTransform(o.a,o.b,o.c,o.d,o.e,o.f,!0),r.translate(n.x1,n.y1),r.setTransformForCurrent(!0),r.beginPath(),r.rect(h.x1,h.y1,h.x2-h.x1,h.y2-h.y1),r.clip(),r.clearMatrix(),t.options.canvas&&!e.needRender&&(e.pauseRender(),t.scenegraph.stage.dirtyBounds.union(this.globalAABBBounds),t.scenegraph.updateNextFrame())},afterRender(t){t.window.getContext().inuse=!1,t.needRender=!1,c.resumeRender()},renderHooks:{afterClearRect(t){const{context:e,layer:i,viewBox:o}=t;i.main&&t.clear&&r&&(e.beginPath(),e.fillStyle=r,e.rect(o.x1,o.y1,o.x2-o.x1,o.y2-o.y1),e.fill())}}}));const c=this.activeChartInstance.getStage(),d=this.globalTransMatrix.clone(),u=this.stage.window.getViewBoxTransform();d.multiply(u.a,u.b,u.c,u.d,u.e,u.f),c.window.setViewBoxTransform&&c.window.setViewBoxTransform(d.a,d.b,d.c,d.d,d.e,d.f),this.activeChartInstance.renderSync(),t.internalProps.layoutMap?.updateDataStateToActiveChartInstance?.(this.activeChartInstance),this.activeChartInstance.on("click",(e=>{!1===this.attribute.spec.select?.enable?t.scenegraph.updateChartState(null):yH.temp&&t.scenegraph.updateChartState(e?.datum)})),this.activeChartInstance.on("brushEnd",(e=>{t.scenegraph.updateChartState(e?.value?.inBrushData),yH.temp=0,setTimeout((()=>{yH.temp=1}),0)})),t._bindChartEvent?.(this.activeChartInstance)}static temp=1;deactivate(){this.active=!1,this.activeChartInstance?.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),this.activeChartInstance?.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){const t=this.parent,e=this.attribute.cellPadding,i=this.stage.table,{x1:r,y1:o,x2:n,y2:s}=t.globalAABBBounds;return{x1:Math.ceil(r+e[3]+i.scrollLeft+(i.options.viewBox?.x1??0)),x2:Math.ceil(r+t.attribute.width-e[1]+i.scrollLeft+(i.options.viewBox?.x1??0)),y1:Math.ceil(o+e[0]+i.scrollTop+(i.options.viewBox?.y1??0)),y2:Math.ceil(o+t.attribute.height-e[2]+i.scrollTop+(i.options.viewBox?.y1??0))}}}let CH,wH=[],vH=[],xH=5,_H=!1;function SH(t){Wx(t)&&(xH=t)}function AH(){wH=[],vH=[],_H=!1,cancelAnimationFrame(CH)}function TH(t){const{axes:e,dataId:i,data:r,spec:o,ClassType:n,canvas:s,mode:a,modeParams:l,dpr:h}=t.attribute;let{chartInstance:c}=t;c||(c=new n(o,{renderCanvas:s,mode:"node"===a?"node":"desktop-browser",modeParams:l,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:h,interactive:!1,animation:!1,autoFit:!1}),c.renderSync(),t.chartInstance=c);const d=t.getViewBox();d.x2<=d.x1&&(d.x2=d.x1+1),d.y2<=d.y1&&(d.y2=d.y1+1),c.updateViewBox({x1:0,x2:d.x2-d.x1,y1:0,y2:d.y2-d.y1},!1,!1);const u=c.getStage(),g=t.globalTransMatrix,p=t.stage.window.getViewBoxTransform().clone();p.multiply(g.a,g.b,g.c,g.d,g.e,g.f),u.window.setViewBoxTransform&&u.window.setViewBoxTransform(p.a,p.b,p.c,p.d,p.e,p.f);const{table:f}=t.getRootNode();let m=!1;if(f.options.specFormat){const e=f.options.specFormat(t.attribute.spec,c,t);if(e.needFormatSpec&&e.spec){const t=e.spec;c.updateSpecSync(t),m=e.updateSpec??!0}}if(!m)if(e?.forEach(((t,e)=>{"band"===t.type?c.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0):c.updateModelSpecSync({type:"axes",index:e},{min:t.range?.min??0,max:t.range?.max??0,tick:{tickMode:t.tick?.tickMode}},!0)})),f.internalProps.layoutMap?.updateDataStateToActiveChartInstance?.(c),"string"==typeof i)c.updateDataSync(i,r??[]);else{const t=[];for(const e in i){const n=i[e],s=o.series.find((t=>t?.data?.id===e));t.push({id:e,values:n?r?.filter((t=>t.hasOwnProperty(n)))??[]:r??[],fields:s?.data?.fields}),c.updateFullDataSync||c.updateDataSync(e,n?r?.filter((t=>t.hasOwnProperty(n)))??[]:r??[])}c.updateFullDataSync?.(t)}f.fireListeners("before_cache_chart_image",{chartInstance:c});MH(c.getStage(),t)}function RH(t){_H=!0,vH.length>0?CH=requestAnimationFrame((()=>{const e=vH.splice(0,xH);wH.splice(0,xH),e.forEach((t=>{TH(t),t.addUpdateBoundTag()})),t.render(),RH(t)})):_H=!1}const BH=2e3;function MH(t,e){const{viewWidth:i,viewHeight:r}=t;if(i<BH&&r<BH)return e.cacheCanvas=PH(t),void(e.isShareChartSpec||(e.chartInstance?.release(),e.chartInstance=null,e.setAttribute("chartInstance",null)));const o=Math.ceil(r/BH),n=Math.ceil(i/BH),s=[];for(let e=0;e<o;e++)for(let o=0;o<n;o++){const n=o*BH,a=e*BH,l=n+BH>i?i:n+BH,h=a+BH>r?r:a+BH,c=l-n,d=h-a,u=new g_;u.setValue(n,a,l,h);const g=PH(t,!1,u);s.push({canvas:g,x:n,y:a,width:c,height:d})}e.cacheCanvas=s}function PH(t,e=!0,i){if("released"===t.releaseStatus)return null;const r=function(t,e=!0,i){const r=t.window.getViewBoxTransform(),o=so.get(Go),n=i?-i.x1:0,s=i?-i.y1:0,a=i?i.x2:t.viewWidth,l=i?i.y2:t.viewHeight,h=i?i.width():t.viewWidth,c=i?i.height():t.viewHeight;o.create({viewBox:{x1:n,y1:s,x2:a,y2:l},width:h*r.a,height:c*r.d,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""});return o.setViewBoxTransform(r.a,r.b,r.c,r.d,0,0),t.renderTo(o),o}(t,e,i),o=r.getNativeHandler();return o.nativeCanvas?o.nativeCanvas:null}const HH=Symbol.for("ChartRender");let kH=class extends mc{type;numberType=bH;drawShape(t,e,i,r,o,n,s,a){const l=nn(t,n?.theme).group,{dataId:h,data:c,spec:d}=t.attribute;t.getViewBox();const{width:u=l.width,height:g=l.height}=t.attribute,{table:p}=t.getRootNode(),{active:f,cacheCanvas:m,activeChartInstance:b}=t;if(!f&&m)Ux(m)?m.forEach((t=>{const{x:i,y:r,width:o,height:n,canvas:s}=t;e.drawImage(s,i,r,o,n)})):e.drawImage(m,i,r,u,g);else if(b){if(p.options.specFormat){const e=p.options.specFormat(t.attribute.spec,b,t);if(e.needFormatSpec&&e.spec){const t=e.spec;b.updateSpecSync(t)}}const e=t.getViewBox();b.updateViewBox({x1:0,x2:e.x2-e.x1,y1:0,y2:e.y2-e.y1},!1,!1);const i=b.getStage();i.needRender=!0;const r=t.globalTransMatrix.clone(),o=t.stage.window.getViewBoxTransform().clone();if(o.multiply(r.a,r.b,r.c,r.d,r.e,r.f),i.window.setViewBoxTransform(o.a,o.b,o.c,o.d,o.e,o.f),"string"==typeof h)b.updateDataSync(h,c??[]);else{const t=[];for(const e in h){const i=h[e],r=d.series.find((t=>t?.data?.id===e));t.push({id:e,values:i?c?.filter((t=>t.hasOwnProperty(i)))??[]:c??[],fields:r?.data?.fields}),b.updateFullDataSync||b.updateDataSync(e,i?c?.filter((t=>t.hasOwnProperty(i)))??[]:c??[])}b.updateFullDataSync?.(t)}}else p.internalProps.renderChartAsync?(-1===wH.indexOf(`${t.parent.col}+${t.parent.row}`)&&(wH.push(`${t.parent.col}+${t.parent.row}`),vH.push(t)),_H||RH(p)):TH(t)}draw(t,e,i,r){this._draw(t,{},!1,i,r)}};kH=pH([f()],kH);let EH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{shape:g}=t.attribute;if("circle"===g){const{width:o=l.width,height:n=l.height}=t.attribute;e.beginPath(),e.arc(i+o/2,r+n/2,Math.min(o,n)/2,0,2*Math.PI),e.closePath(),e.save(),e.clip()}}};EH=pH([f()],EH);let FH=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{shape:g}=t.attribute;"circle"===g&&e.restore()}};FH=pH([f()],FH);let LH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{isGif:g}=t.attribute;g&&t.playing&&(t.attribute.opacity=0)}};LH=pH([f()],LH);let IH=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{isGif:g}=t.attribute;g&&t.playing&&(t.attribute.opacity=1,e.globalAlpha=t.attribute.opacity,t.renderFrame(e,i,r))}};function zH(t,e,i,r){const{highlightInRange:o,disableHeader:n,ranges:s}=t.select;let a;const l=1===s.length&&function(t){return t.start.col!==t.end.col||t.start.row!==t.end.row}(s?.[0])&&o;if(l?1===s?.length&&s[0].start&&s[0].end:1===s?.length&&s[0].end.col===s[0].start.col&&s[0].end.row===s[0].start.row){if(t.table.isHeader(e,i)&&n)return;if(a=l?function(t,e,i){let r;const{highlightScope:o,cellPos:n,ranges:s}=t.select,a=s[0],l=Math.min(a.start.col,a.end.col),h=Math.max(a.start.col,a.end.col),c=Math.min(a.start.row,a.end.row),d=Math.max(a.start.row,a.end.row);return o===Rx.single&&n.col===e&&n.row===i?r="cellBgColor":o===Rx.column&&e>=l&&e<=h?r=MS(s[0],e,i)?"cellBgColor":"inlineColumnBgColor":o===Rx.row&&i>=c&&i<=d?r=MS(s[0],e,i)?"cellBgColor":"inlineRowBgColor":o===Rx.cross&&(MS(s[0],e,i)?r="cellBgColor":e>=l&&e<=h?r="inlineColumnBgColor":i>=c&&i<=d&&(r="inlineRowBgColor")),r}(t,e,i):function(t,e,i){let r;const{highlightScope:o,cellPos:n}=t.select;return o===Rx.single&&n.col===e&&n.row===i?r="cellBgColor":o===Rx.column&&n.col===e?r=n.col===e&&n.row===i?"cellBgColor":"inlineColumnBgColor":o===Rx.row&&n.row===i?r=n.col===e&&n.row===i?"cellBgColor":"inlineRowBgColor":o===Rx.cross&&(n.col===e&&n.row===i?r="cellBgColor":n.col===e?r="inlineColumnBgColor":n.row===i&&(r="inlineRowBgColor")),r}(t,e,i),a){OH(t.table,e,i)&&(a=void 0)}}else if("replace"===t.table.theme.selectionStyle.selectionFillMode)for(let t=0;t<s.length;t++){const r=s[t],o=Math.min(r.start.col,r.end.col),n=Math.max(r.start.col,r.end.col),l=Math.min(r.start.row,r.end.row),h=Math.max(r.start.row,r.end.row);if(o<=e&&l<=i&&n>=e&&h>=i){a="cellBgColor";break}}return a}function OH(t,e,i){const r=t.options.select?.disableSelect;if("function"==typeof r?r(e,i,t):r)return!0;if(t.isHeader(e,i)){let r=t.options.select?.disableHeaderSelect;if(r)return!0;const o=t.getHeaderDefine(e,i);if(r=o?.disableHeaderSelect,r)return!0}else{const r=t.getBodyColumnDefine(e,i),o=r?.disableSelect;if("function"==typeof o?o(e,i,t):o)return!0}return!1}IH=pH([f()],IH);let DH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};DH=pH([f()],DH);let WH=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{stroke:u=l.stroke,strokeArrayColor:g=l.strokeArrayColor,strokeArrayWidth:p=l.strokeArrayWidth,lineWidth:f=l.lineWidth,strokeColor:m=l.stroke,cornerRadius:b=l.cornerRadius}=t.attribute;let y,C,{width:w=l.width,height:v=l.height}=t.attribute;if(u&&(Array.isArray(p)||0!==f)&&(Array.isArray(g)||Array.isArray(p))){if("number"==typeof f&&1&f||Array.isArray(p)&&p.some((t=>1&t))){const e=t.stage.table;if(!e)return;const o="bottom-right"===e?.theme?.cellBorderClipDirection;if(o){if(i=Math.floor(i)-.5,r=Math.floor(r)-.5,"cell"===t.role){const e=t.col,o=t.row;0===e&&(i+=1),0===o&&(r+=1)}}else i=Math.floor(i)+.5,r=Math.floor(r)+.5;e.options.customConfig?._disableColumnAndRowSizeRound&&(w=Math.round(w),v=Math.round(v));const{width:n,height:s}=JH(t,Math.ceil(w),Math.ceil(v),o);y=n,C=s}else y=Math.ceil(w),C=Math.ceil(v);0===b||Ux(b)&&b.every((t=>0===t))?GH(t,e,i,r,l,u,p||f,g||m,y,C):(e.beginPath(),ec(e,i,r,y,C,b,!0,new Array(4).fill(0).map(((o,n)=>(o,s,a,h)=>{ik(n,o,s,a,h,t,e,i,r,l,u,p||f,g||m,y,C)}))),e.stroke())}}};function NH(t){if(!Array.isArray(t))return{isSplitDraw:!1,width:t};let e;for(let i=0;i<t.length;i++){const r=t[i];if(r)if(e){if(r!==e)return{isSplitDraw:!0}}else e=r}return{isSplitDraw:!1,width:e}}function GH(t,e,i,r,o,n,s,a,l,h,c,d){const u=NH(s),g=!Array.isArray(s),p=!Array.isArray(n),f=Array.isArray(d),m=Array.isArray(a)||u.isSplitDraw;e.setStrokeStyle(t,t.attribute,i,r,o);const{lineDash:b=o.lineDash}=t.attribute;let y=!1;b.length&&b.some((t=>Array.isArray(t)))&&(y=!0),e.beginPath(),e.moveTo(i,r);const C=(p||n[0])&&(g||s[0]),w=(p||n[1])&&(g||s[1]),v=(p||n[2])&&(g||s[2]),x=(p||n[3])&&(g||s[3]);if(C){const t=(g?u.width:s[0])/2,o=(g?u.width:s[0])/2;f&&Array.isArray(d[0])?(e.moveTo(i-t+(l+t+o)*d[0][0],r),e.lineTo(i-t+(l+t+o)*(d[0][1]-d[0][0]),r),e.moveTo(i+l+o,r)):(e.moveTo(i-t,r),e.lineTo(i+l+o,r)),(m||y)&&(a&&a[0]?e.strokeStyle=a[0]:a&&!a[0]&&(e.strokeStyle="transparent"),g||(e.lineWidth=s[0]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,y&&e.setLineDash(b[0]??[]),e.stroke(),e.beginPath(),e.moveTo(i+l,r))}else e.moveTo(i+l,r);if(w){const t=(g?u.width:s[1])/2,o=(g?u.width:s[1])/2;f&&Array.isArray(d[1])?(e.moveTo(i+l,r-t+h*d[1][0]),e.lineTo(i+l,r-t+(h+t+o)*(d[1][1]-d[1][0])),e.moveTo(i+l,r+h+o)):(e.moveTo(i+l,r-t),e.lineTo(i+l,r+h+o)),(m||y)&&(a&&a[1]?e.strokeStyle=a[1]:a&&!a[1]&&(e.strokeStyle="transparent"),g||(e.lineWidth=s[1]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,y&&e.setLineDash(b[1]??[]),e.stroke(),e.beginPath(),e.moveTo(i+l,r+h))}else e.moveTo(i+l,r+h);if(v){const t=(g?u.width:s[2])/2,o=(g?u.width:s[2])/2;f&&Array.isArray(d[2])?(e.moveTo(i-t+(l+t+o)*d[2][0],r+h),e.lineTo(i-t+(l+t+o)*(d[2][1]-d[2][0]),r+h),e.moveTo(i-t,r+h)):(e.moveTo(i-t,r+h),e.lineTo(i+l+o,r+h)),(m||y)&&(a&&a[2]?e.strokeStyle=a[2]:a&&!a[2]&&(e.strokeStyle="transparent"),g||(e.lineWidth=s[2]),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,y&&e.setLineDash(b[2]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r+h))}else e.moveTo(i,r+h);if(x){const t=(g?u.width:s[3])/2,o=(g?u.width:s[3])/2;f&&Array.isArray(d[3])?(e.moveTo(i,r-t+(h+t+o)*d[3][0]),e.lineTo(i,r-t+(h+t+o)*(d[3][1]-d[3][0])),e.moveTo(i,r-t)):(e.moveTo(i,r-t),e.lineTo(i,r+h+o)),(m||y)&&(a&&a[3]?e.strokeStyle=a[3]:a&&!a[3]&&(e.strokeStyle="transparent"),g||(e.lineWidth=s[3]),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,y&&e.setLineDash(b[3]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r))}else e.moveTo(i,r);m||y||(!g&&u.width&&(e.lineWidth=u.width),e.stroke()),e.lineDashOffset=0,e.setLineDash([])}WH=pH([f()],WH);let jH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{lineDash:g=l.lineDash,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth}=t.attribute;p&&Array.isArray(g)&&g.length&&g[0]?.length&&!Array.isArray(f)&&!Array.isArray(m)&&(u.doStroke=!1)}};jH=pH([f()],jH);let VH=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{lineDash:u=l.lineDash,stroke:g=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:f=l.strokeArrayWidth,lineWidth:m=l.lineWidth}=t.attribute;if(!g||!(Array.isArray(u)&&u.length&&u[0]?.length)||Array.isArray(p)||Array.isArray(f))return;const b=t.stage.table;if(!b)return;const y=Ux(u[0])?function(t){if(1===t.length)return[t[0],t[0],t[0],t[0]];if(2===t.length)return[t[0],t[1],t[0],t[1]];return t}(u):[u,u,u,u];let C,w,{width:v=l.width,height:x=l.height}=t.attribute;if(b.options.customConfig?._disableColumnAndRowSizeRound?(v=Math.round(v),x=Math.round(x)):(v=Math.ceil(v),x=Math.ceil(x)),1&m){const e="bottom-right"===b.theme.cellBorderClipDirection,o=0,n=0;if(e){if(i=Math.floor(i)-.5,r=Math.floor(r)-.5,"cell"===t.role){0===t.col&&(i+=1),0===t.row&&(r+=1)}}else i=Math.floor(i)+.5,r=Math.floor(r)+.5;const{width:s,height:a}=JH(t,Math.ceil(v+o),Math.ceil(x+n),e);C=s,w=a}else C=Math.ceil(v),w=Math.ceil(x);e.setStrokeStyle(t,t.attribute,i,r,l),e.beginPath(),e.moveTo(i,r),e.lineTo(i+C,r),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(y[0]??[]),e.stroke(),e.beginPath(),e.moveTo(i+C,r),e.lineTo(i+C,r+w),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(y[1]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r+w),e.lineTo(i+C,r+w),e.lineDashOffset=e.currentMatrix.e/e.currentMatrix.a,e.setLineDash(y[2]??[]),e.stroke(),e.beginPath(),e.moveTo(i,r),e.lineTo(i,r+w),e.lineDashOffset=e.currentMatrix.f/e.currentMatrix.d,e.setLineDash(y[3]??[]),e.stroke(),e.lineDashOffset=0,e.setLineDash([])}};VH=pH([f()],VH);let UH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{lineWidth:g=l.lineWidth,stroke:p=l.stroke,lineDash:f=l.lineDash,strokeArrayWidth:m=l.strokeArrayWidth,strokeArrayColor:b=l.strokeArrayColor,notAdjustPos:y}=t.attribute;!0!==y&&p&&Array.isArray(f)&&!f.length&&!Array.isArray(b)&&!Array.isArray(m)&&1&g&&(u.doStroke=!1)}};UH=pH([f()],UH);let KH=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{lineWidth:u=l.lineWidth,stroke:g=l.stroke,lineDash:p=l.lineDash,strokeArrayWidth:f=l.strokeArrayWidth,strokeArrayColor:m=l.strokeArrayColor,notAdjustPos:b,cornerRadius:y=l.cornerRadius}=t.attribute;let{width:C=l.width,height:w=l.height}=t.attribute;if(!0!==b&&g&&Array.isArray(p)&&!p.length&&!Array.isArray(m)&&!Array.isArray(f)&&1&u){const o=t.stage.table;if(!o)return;o.options.customConfig?._disableColumnAndRowSizeRound&&(C=Math.round(C),w=Math.round(w)),e.beginPath();const n="bottom-right"===o?.theme?.cellBorderClipDirection,s=0,a=0;if(n){if(i=Math.floor(i)-.5,r=Math.floor(r)-.5,"cell"===t.role){0===t.col&&(i+=1),0===t.row&&(r+=1)}}else i=Math.floor(i)+.5,r=Math.floor(r)+.5;const{width:h,height:c}=JH(t,Math.ceil(C),Math.ceil(w),n);y?ec(e,i,r,h+s,c+a,y):e.rect(i,r,h,c),e.setStrokeStyle(t,t.attribute,i,r,l),e.stroke()}}};KH=pH([f()],KH);let $H=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){if("cell"===t.role){const e=t.stage.table;if(e){const i=function(t,e){let i,r;if("cell"===t.role&&Wx(t.mergeStartCol)&&Wx(t.mergeStartRow)&&Wx(t.mergeEndCol)&&Wx(t.mergeEndRow)){const{colStart:r,colEnd:o,rowStart:n,rowEnd:s}=XP(t,e.scenegraph);for(let t=r;t<=o;t++)for(let r=n;r<=s;r++){const o=zH(e.stateManager,t,r);!o||i&&"cellBgColor"!==o||(i=o)}}else"cell"===t.role&&(i=zH(e.stateManager,t.col,t.row));if(!i)return;const o=e.internalProps.layoutMap;return o.isCornerHeader(t.col,t.row)?r=e.theme.cornerHeaderStyle?.select||e.theme.headerStyle?.select:o.isColumnHeader(t.col,t.row)?r=e.theme.headerStyle?.select:o.isRowHeader(t.col,t.row)?r=e.theme.rowHeaderStyle?.select:o.isBottomFrozenRow(t.col,t.row)?r=e.theme.bottomFrozenStyle?.select||(e.isListTable()?e.theme.bodyStyle?.select:e.theme.headerStyle?.select):o.isRightFrozenColumn(t.col,t.row)?r=e.theme.rightFrozenStyle?.select||(e.isListTable()?e.theme.bodyStyle?.select:e.theme.rowHeaderStyle?.select):e.isHeader(t.col,t.row)||(r=e.theme.bodyStyle?.select),qM(i,r,t.col,t.row,e)}(t,e);if(i)t.attribute._vtableHightLightFill=i;else if(e.stateManager.interactionState!==Tx.scrolling){const i=fH(t,e);i&&(t.attribute._vtableHightLightFill=i)}}}}};$H=pH([f()],$H);let XH=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){if(t.attribute._vtableHightLightFill)if(c);else if(s){const o=t.attribute.fill;t.attribute.fill=t.attribute._vtableHightLightFill,e.setCommonStyle(t,t.attribute,i,r,l),e.fill(),t.attribute.fill=o,t.attribute._vtableHightLightFill=void 0}}};XH=pH([f()],XH);let YH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const g=t.stage.table;if(g)if("body"===t.role){ZH(e,-(t.attribute.x??0)+g.getFrozenColsWidth(),-(t.attribute.y??0)+g.getFrozenRowsHeight(),t.parent.attribute.width-g.getFrozenColsWidth()-g.getRightFrozenColsWidth(),t.parent.attribute.height-g.getFrozenRowsHeight()-g.getBottomFrozenRowsHeight())}else if("row-header"===t.role){ZH(e,0,-(t.attribute.y??0)+g.getFrozenRowsHeight(),g.getFrozenColsWidth(),t.parent.attribute.height-g.getFrozenRowsHeight()-g.getBottomFrozenRowsHeight())}else if("col-header"===t.role){ZH(e,-(t.attribute.x??0)+g.getFrozenColsWidth(),0,t.parent.attribute.width-g.getFrozenColsWidth()-g.getRightFrozenColsWidth(),g.getFrozenRowsHeight())}else if("right-frozen"===t.role){ZH(e,0,-(t.attribute.y??0)+g.getFrozenRowsHeight(),g.getRightFrozenColsWidth(),t.parent.attribute.height-g.getFrozenRowsHeight()-g.getBottomFrozenRowsHeight())}else if("bottom-frozen"===t.role){ZH(e,-(t.attribute.x??0)+g.getFrozenColsWidth(),0,t.parent.attribute.width-g.getFrozenColsWidth()-g.getRightFrozenColsWidth(),g.getBottomFrozenRowsHeight())}else if("corner-header"===t.role){ZH(e,0,0,g.getFrozenColsWidth(),g.getFrozenRowsHeight())}else if("corner-right-top-header"===t.role){ZH(e,0,0,g.getRightFrozenColsWidth(),g.getFrozenRowsHeight())}else if("corner-right-bottom-header"===t.role){ZH(e,0,0,g.getRightFrozenColsWidth(),g.getBottomFrozenRowsHeight())}else if("corner-left-bottom-header"===t.role){ZH(e,0,0,g.getFrozenColsWidth(),g.getBottomFrozenRowsHeight())}}};YH=pH([f()],YH);const qH=Math.pow(2,24);function ZH(t,e,i,r,o){t.beginPath();const n=t.applyedMatrix;Math.abs(n.f)>qH||Math.abs(n.g)>qH?t.rect(e-qH,i-qH,r+2*qH,o+2*qH):t.rect(e,i,r,o)}function JH(t,e,i,r){const o=t.stage.table;if(!o)return{width:e,height:i};if("cell"===t.role){let n=t.col,s=t.row;const a=CA(o,n,s);a&&(n=a.end.col,s=a.end.row),r?(0===n&&(e-=1),0===s&&(i-=1)):((n===o.colCount-1||n===o.frozenColCount-1&&o.scrollLeft||o.containerFit?.width&&o.rightFrozenColCount&&n===o.colCount-o.rightFrozenColCount-1)&&(e-=1),(s===o.rowCount-1||s===o.frozenRowCount-1&&o.scrollTop||o.containerFit?.height&&o.bottomFrozenRowCount&&s===o.rowCount-o.bottomFrozenRowCount-1)&&(i-=1))}else"corner-frozen"===t.role&&(o.scrollLeft&&!r&&(e-=1),o.scrollTop&&!r&&(i-=1));return{width:e,height:i}}let QH=class{time=_i.beforeFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=t.attribute;g&&(Array.isArray(g)||Array.isArray(p)||Array.isArray(f))&&(u.doStroke=!1)}};QH=pH([f()],QH);let tk,ek=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d){const{width:u=l.width,height:g=l.height,stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth,lineWidth:b=l.lineWidth,strokeColor:y=l.stroke,cornerRadius:C=l.cornerRadius}=t.attribute;if(p&&(Array.isArray(m)||0!==b)&&(Array.isArray(p)||Array.isArray(f)||Array.isArray(m))){const o=0,n=0;"border-rect"!==t.name&&"table-border-rect"!==t.name&&("number"==typeof b&&1&b||Array.isArray(m)&&m.some((t=>1&t)))&&(i=Math.floor(i)+.5,r=Math.floor(r)+.5),0===C||Ux(C)&&C.every((t=>0===t))?GH(t,e,i,r,l,p,m||b,f||y,"table-border-rect"!==t.name?Math.ceil(u+o):u+o,"table-border-rect"!==t.name?Math.ceil(g+n):g+n):(e.beginPath(),ec(e,i,r,u,g,C,!0,new Array(4).fill(0).map(((s,a)=>(s,h,c,d)=>{ik(a,s,h,c,d,t,e,i,r,l,p,m||b,f||y,Math.ceil(u+o),Math.ceil(g+n))}))),e.stroke())}}};function ik(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){const f=n,m=h,b=NH(d),y=!Array.isArray(d),C=!Array.isArray(c),w=Array.isArray(u)||b.isSplitDraw;s.stroke(),s.setStrokeStyle(n,n.attribute,a,l,h);const{lineDash:v=m.lineDash}=f.attribute;let x=!1;v.length&&v.some((t=>Array.isArray(t)))&&(x=!0),s.beginPath(),s.moveTo(a,l);const _=(C||c[0])&&(y||d[0]),S=(C||c[1])&&(y||d[1]),A=(C||c[2])&&(y||d[2]),T=(C||c[3])&&(y||d[3]);_&&0===t?(y?b.width:d[0],y?b.width:d[0],s.moveTo(e,i),s.lineTo(r,o),(w||x)&&(u&&u[0]?s.strokeStyle=u[0]:u&&!u[0]&&(s.strokeStyle="transparent"),y||(s.lineWidth=d[0]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,x&&s.setLineDash(v[0]??[]),s.stroke(),s.beginPath())):0===t&&s.moveTo(a+g,l),S&&1===t?(y?b.width:d[1],y?b.width:d[1],s.moveTo(e,i),s.lineTo(r,o),(w||x)&&(u&&u[1]?s.strokeStyle=u[1]:u&&!u[1]&&(s.strokeStyle="transparent"),y||(s.lineWidth=d[1]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,x&&s.setLineDash(v[1]??[]),s.stroke(),s.beginPath(),s.moveTo(a+g,l+p))):1===t&&s.moveTo(a+g,l+p),A&&2===t?(y?b.width:d[2],y?b.width:d[2],s.moveTo(e,i),s.lineTo(r,o),(w||x)&&(u&&u[2]?s.strokeStyle=u[2]:u&&!u[2]&&(s.strokeStyle="transparent"),y||(s.lineWidth=d[2]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,x&&s.setLineDash(v[2]??[]),s.stroke(),s.beginPath(),s.moveTo(a,l+p))):2===t&&s.moveTo(a,l+p),T&&3===t?(y?b.width:d[3],y?b.width:d[3],s.moveTo(e,i),s.lineTo(r,o),(w||x)&&(u&&u[3]?s.strokeStyle=u[3]:u&&!u[3]&&(s.strokeStyle="transparent"),y||(s.lineWidth=d[3]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,x&&s.setLineDash(v[3]??[]),s.stroke(),s.beginPath(),s.moveTo(a,l))):3===t&&s.moveTo(a,l),s.closePath(),w||x||(!y&&b.width&&(s.lineWidth=b.width),s.stroke()),s.lineDashOffset=0,s.setLineDash([]),s.beginPath()}ek=pH([f()],ek);let rk=class{order=1;interceptors;constructor(){this.interceptors=[new ok]}afterDrawItem(t,e,i,r,o){for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].afterDrawItem&&this.interceptors[n].afterDrawItem(t,e,i,r,o))return!0;return!1}beforeDrawItem(t,e,i,r,o){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let n=0;n<this.interceptors.length;n++)if(this.interceptors[n].beforeDrawItem&&this.interceptors[n].beforeDrawItem(t,e,i,r,o))return!0;return!1}};rk=pH([f()],rk);class ok{order=1;afterDrawItem(t,e,i,r,o){return"image"===t.type&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){const{image:n,gif:s}=t.attribute;if(s&&t.playing)return!1;if(!n||!t.resources)return!1;const a=t.resources.get(n);if(!a||"loading"!==a.state)return!1;if(!tk){const t=MM(),e=t.loading_pic.svg,i=t.loading_pic.width,r=t.loading_pic.height;tk=fh({width:i,height:r,image:e})}const{image:l}=tk.attribute;if(!n||!tk.resources)return!1;const h=tk.resources.get(l);if("success"!==h.state)return!1;const{context:c}=i;c.highPerformanceSave(),t.parent&&c.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&c.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const d=t.AABBBounds,{width:u,height:g}=XM(h.data.width,h.data.height,d.width(),d.height());return c.drawImage(h.data,d.x1+(d.width()-u)/2,d.y1+(d.height()-g)/2,u,g),c.highPerformanceRestore(),!0}}let nk=class{time=_i.afterFillStroke;useStyle=!0;order=0;drawShape(t,e,i,r,o,n,s,a,l,h,c,d,u){const{text:g,underline:p=l.underline,lineThrough:f=l.lineThrough,direction:m=l.direction,whiteSpace:b=l.whiteSpace,fontSize:y=l.fontSize,verticalMode:C=l.verticalMode,ellipsis:w=l.ellipsis,textAlign:v=l.textAlign,textBaseline:x=l.textBaseline,x:_=l.x,y:S=l.y}=t.attribute;let A=!1;if(Array.isArray(t)){const e=t.cache?.layoutData;w&&e&&e.lines.every((t=>""===t.str))&&(A=!0)}else{const{cache:e}=t;w&&e&&""===e.clipedText&&0===e.clipedWidth&&(A=!0)}if(!A)return;const T=Vx(w)?w:"...",R=kn(t.attribute.lineHeight,y)??y;let B=0;R!==y&&("top"===x?B=(R-y)/2:"middle"===x||"bottom"===x&&(B=-(R-y)/2)),n&&(d?d(e,t.attribute,l):a&&(e.setStrokeStyle(t,t.attribute,_-i,S-r,l),e.strokeText(T,_,S+B))),o&&(c?c(e,t.attribute,l):s&&(e.setCommonStyle(t,t.attribute,_-i,S-r,l),e.fillText(T,_,S+B),this.drawUnderLine(p,f,t,_,S+B,0,l,e,T)))}drawUnderLine(t,e,i,r,o,n,s,a,l){if(e+t<=0)return;const{textAlign:h=s.textAlign,textBaseline:c=s.textBaseline,fontSize:d=s.fontSize,fontFamily:u=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:p=s.fontStyle,fill:f=s.fill,opacity:m=s.opacity,underlineOffset:b=s.underlineOffset,underlineDash:y=s.underlineDash,fillOpacity:C=s.fillOpacity}=i.attribute;if(!t&&!e)return;const w=zP.measureTextWidth(l,{fontSize:d,fontFamily:u,fontWeight:g,fontStyle:p}),v=zl(h,w),x=Ol(c,d,d),_={lineWidth:0,stroke:f,opacity:m,strokeOpacity:C};if(t){_.lineWidth=t,a.setStrokeStyle(i,_,r,o,s),a.setLineDash(y),a.beginPath();const e=o+x+d+b;a.moveTo(r+v,e,n),a.lineTo(r+v+w,e,n),a.stroke()}if(e){_.lineWidth=e,a.setStrokeStyle(i,_,r,o,s),a.beginPath();const t=o+x+d/2;a.moveTo(r+v,t,n),a.lineTo(r+v+w,t,n),a.stroke()}}};nk=pH([f()],nk);let sk=class{type="chart";numberType=bH;contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};sk=pH([f()],sk);var ak=new i(((t,e,i,r)=>{i(oc)?r(oc).to(QH).inSingletonScope():(t(QH).toSelf().inSingletonScope(),t(El).toService(QH)),i(nc)?r(nc).to(ek).inSingletonScope():(t(ek).toSelf().inSingletonScope(),t(El).toService(ek)),t(kH).toSelf().inSingletonScope(),t(HH).to(kH),t(Sd).to(kH),t(sk).toSelf().inSingletonScope(),t(dp).toService(sk),t(EH).toSelf().inSingletonScope(),t(Pl).toService(EH),t(FH).toSelf().inSingletonScope(),t(Pl).toService(FH),t(LH).toSelf().inSingletonScope(),t(Pl).toService(LH),t(IH).toSelf().inSingletonScope(),t(Pl).toService(IH),t($H).toSelf().inSingletonScope(),t(Ml).toService($H),t(XH).toSelf().inSingletonScope(),t(Ml).toService(XH),t(WH).toSelf().inSingletonScope(),t(Ml).toService(WH),t(DH).toSelf().inSingletonScope(),t(Ml).toService(DH),t(jH).toSelf().inSingletonScope(),t(Ml).toService(jH),t(VH).toSelf().inSingletonScope(),t(Ml).toService(VH),t(UH).toSelf().inSingletonScope(),t(Ml).toService(UH),t(KH).toSelf().inSingletonScope(),t(Ml).toService(KH),t(YH).toSelf().inSingletonScope(),t(Ml).toService(YH),t(rk).toSelf().inSingletonScope(),t(Od).toService(rk),t(nk).toSelf().inSingletonScope(),t(Ll).toService(nk)}));function lk(t,e,i,r){t.internalProps.columnWidthConfig&&t._parseColumnWidthConfig(t.internalProps.columnWidthConfig),t.isPivotTable()&&t.internalProps.columnWidthConfigForRowHeader&&t._parseColumnWidthConfigForRowHeader(t.internalProps.columnWidthConfigForRowHeader),e=e??0,i=i??t.colCount-1,0===e&&i===t.colCount-1&&t._clearColRangeWidthsMap();const o=t.internalProps.layoutMap;t.isPivotTable()&&(o.enableUseGetBodyCache(),o.enableUseHeaderPathCache());const n=[],s=[];if(r)for(let e=0;e<t.colCount;e++)n[e]=t.getColWidth(e);for(let o=e;o<=i;o++){let e;if(t.internalProps.transpose||"only-header"!==t.internalProps.layoutMap.columnObjects?.[o]?.columnWidthComputeMode&&"only-header"!==t.columnWidthComputeMode||!("showHeader"in t.internalProps.layoutMap))e=t.internalProps.transpose||"only-body"!==t.internalProps.layoutMap.columnObjects?.[o]?.columnWidthComputeMode&&"only-body"!==t.columnWidthComputeMode?hk(o,0,t.rowCount-1,t):hk(o,t.internalProps.layoutMap.getBodyRange().start.row,t.internalProps.layoutMap.getBodyRange().end.row,t);else{const i=t.internalProps.layoutMap.showHeader;t.internalProps.layoutMap.showHeader=!0,e=hk(o,0,t.internalProps.layoutMap.headerLevelCount-1,t),t.internalProps.layoutMap.showHeader=i}t._setColContentWidth(o,e);t.getColWidth(o)!==e&&t._clearColRangeWidthsMap(o),r?s[o]=Math.round(t._adjustColWidth(o,e)):t._setColWidth(o,t._adjustColWidth(o,e),!1,!0)}if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0,n=t.colCount;if("only-body"===t.widthAdaptiveMode){for(let e=0;e<t.colCount;e++){const o=r?s[e]??t.getColWidth(e):t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=o)}o=t.rowHeaderLevelCount,n=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}pk(e-i,o,n,r,s,t)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,o=0;for(let e=0;e<t.colCount;e++){const n=r?s[e]??t.getColWidth(e):t.getColWidth(e);(e<t.rowHeaderLevelCount+t.leftRowSeriesNumberCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=n),o+=n}if(o<e&&o>i){pk(e-i,t.rowHeaderLevelCount+t.leftRowSeriesNumberCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,r,s,t)}}if(r){for(let e=0;e<t.colCount;e++){const i=s[e]??t.getColWidth(e)??t.getColWidth(e);i!==n[e]&&t._setColWidth(e,i,!1,!0)}t.stateManager.checkFrozen();for(let e=0;e<t.colCount;e++){const i=t.getColWidth(e);i!==n[e]&&t.scenegraph.updateColWidth(e,i-n[e],!0,!0)}t.scenegraph.updateContainer(!0)}t.isPivotTable()&&(o.disableUseGetBodyCache(),o.disableUseHeaderPathCache())}function hk(t,e,i,r,o=!1){let n=function(t,e){const i=e.getColWidthDefined(t);if(e.internalProps._widthResizedColMap.has(t))return e.getColWidth(t);return i}(t,r);return r.internalProps.transpose&&"auto"===n&&("only-header"===r.columnWidthComputeMode&&t>=r.rowHeaderLevelCount||"only-body"===r.columnWidthComputeMode&&t<r.rowHeaderLevelCount)&&(n=r.getDefaultColumnWidth(t)),o&&!r.internalProps.transpose?ck(n,t,e,i,o,r):"number"==typeof n?n:"auto"!==n&&"string"==typeof n?r._adjustColWidth(t,r._colWidthDefineToPxWidth(n)):ck(n,t,e,i,o,r)}function ck(t,e,i,r,o,n){let s=0,a=1,l=1;if(r-i>5e3&&(l=Math.ceil((r-i)/5e3)),n.isPivotChart()&&e>=n.rowHeaderLevelCount&&e<n.colCount-n.rightFrozenColCount){if(n.internalProps.layoutMap.indicatorsAsCol)return n.defaultColWidth;{const t=n.internalProps.layoutMap.getOptimunWidthForChart(e);if(t>0)return t}}for(let h=i;h<=r;h+=a){if(n.isPivotChart()){const t=n.internalProps.layoutMap,i=t.getAxisConfigInPivotChart(e,h);if(i){const t=wA.getFunction("computeAxisComponentWidth")(i,n);if("number"==typeof t){s=Math.max(t,s);continue}}else if(t.isLeftBottomCorner(e,h)||t.isRightTopCorner(e,h)||t.isRightBottomCorner(e,h))continue}const i=dk(e,h,n);if(i&&(s=Math.max(i.width,s),!i.renderDefault))continue;const r=t;if("number"==typeof r&&"standard"===n.widthMode&&!o){s=Math.max(r,s);continue}const c=n.isHeader(e,h)?n._getHeaderLayoutMap(e,h)?.headerType:n.getBodyColumnType(e,h);if(Wx(c)&&"text"!==c&&"link"!==c&&"progressbar"!==c&&"checkbox"!==c&&"radio"!==c&&"switch"!==c&&"button"!==c){s=Math.max(s,n.getColWidthDefinedNumber(e)||0);continue}let d=0;const u=n.internalProps.layoutMap;if(u.isHeader(e,h)){const t=u.getHeader(e,h);if("only-body"===t?.define?.columnWidthComputeMode)continue;Wx(t?.hierarchyLevel)&&(d=(t.hierarchyLevel??0)*("tree"===u.rowHierarchyType?u.rowHierarchyIndent??0:0),u.rowHierarchyTextStartAlignment&&!n.internalProps.headerHelper.getHierarchyIcon(e,h)&&(d+=n.internalProps.headerHelper.getHierarchyIconWidth()))}else if(n.isListTable()){a=l;const t=n.getBodyColumnDefine(e,h);if(t?.tree){const t=n.dataSource.getIndexKey(n.getRecordShowIndexByCell(e,h));d=Array.isArray(t)&&n.getHierarchyState(e,h)!==kx.none?(t.length-1)*(u.hierarchyIndent??0):0,u.hierarchyTextStartAlignment&&!n.internalProps.bodyHelper.getHierarchyIcon(e,h)&&(d+=n.internalProps.headerHelper.getHierarchyIconWidth())}}const g=uk(e,h,c,n);s=Math.max(g+d,s),a>1&&n.bottomFrozenRowCount>0&&h<n.rowCount-n.bottomFrozenRowCount&&h+a>=n.rowCount-n.bottomFrozenRowCount&&(h=n.rowCount-n.bottomFrozenRowCount-a,a=1,l=1)}const h=n.getMinColWidth(e),c=n.getMaxColWidth(e);return s<h?h:s>c?c:(s<=0&&(s=n.defaultColWidth),s)}function dk(t,e,i){const r=i.getCustomRender(t,e);let o=i.getCustomLayout(t,e);if(r||o){let n,s=1,a=0,l=!1,h=!1;(i.isHeader(t,e)||i.getBodyColumnDefine(t,e)?.mergeCell||i.hasCustomMerge())&&(n=i.getCellRange(t,e),s=n.end.col-n.start.col+1);const c={col:n?.start.col??t,row:n?.start.row??e,dataValue:i.getCellOriginValue(t,e),value:i.getCellValue(t,e)||"",rect:gk(t,e,i),table:i,originCol:t,originRow:e,forComputation:!0};if("react-custom-layout"===o&&(o=i.reactCustomLayout?.getCustomLayoutFunc(t,e)||kM),Ox(o)){const t=o(c);if(t.rootContainer){t.rootContainer=VM(t.rootContainer),jM(t.rootContainer,0,i.getRowHeight(e));const r=t.rootContainer.attribute.width;t.rootContainer.setStage(i.scenegraph.stage),a=r>0?r:t.rootContainer.AABBBounds.width()??0,l=t.renderDefault,h=t.enableCellPadding}else a=0,l=t.renderDefault,h=t.enableCellPadding}else if("function"==typeof r){const t=r(c);a=t?.expectedWidth??0,l=t?.renderDefault}else a=r?.expectedWidth??0,l=r?.renderDefault;if(a=Math.ceil(a),h){const r=pB(qM("padding",i._getCellStyle(t,e),t,e,i));a+=r[1]+r[3]}return{width:a/s,renderDefault:l}}}function uk(t,e,i,r){let o=0;const n=r.getCellValue(t,e),s=r._getCellStyle(t,e);let a=0,l=!1;if("body"!==r.getCellLocation(t,e))l=!0;else{const i=r.getBodyColumnDefine(t,e);l=!!i?.icon||!!i?.tree||i?.dragOrder}if(l){const i=r.getCellIcons(t,e);i?.forEach((t=>{t.positionType!==Ex.absoluteRight&&(a+=(t.width??0)+(t.marginLeft??0)+(t.marginRight??0))}))}let h=1;if(r.isHeader(t,e)||r.getBodyColumnDefine(t,e)?.mergeCell||r.hasCustomMerge()){const i=r.getCellRange(t,e);h=i.end.col-i.start.col+1}const c=pB(qM("padding",s,t,e,r)),d=c[1]+c[3],u=qM("fontSize",s,t,e,r),g=qM("fontFamily",s,t,e,r),p=qM("fontWeight",s,t,e,r);let f;if("checkbox"===i)f=Nx(n)?n.text:n;else if("radio"===i)if(Ux(n)){f="";const i=r.getBodyColumnDefine(t,e),o=i?.radioDirectionInCell??"vertical";"vertical"===o?n.forEach((t=>{f+=(Nx(t)?t.text:t).toString()+"\n"})):"horizontal"===o&&n.forEach((t=>{f+=(Nx(t)?t.text:t).toString()}))}else f=Nx(n)?n.text:n;else if("button"===i){const i=AS(r.getBodyColumnDefine(t,e).text,{col:t,row:e,table:r,context:null,value:n,dataValue:r.getCellOriginValue(t,e)});f=i??n??""}else f=n;const m=eP(f,r).text;if(m.length>=1&&(1!==m.length||""!==m[0])?m.forEach((t=>{const e=r.measureText(t,{fontSize:u,fontFamily:g,fontWeight:p}).width;o=Math.max((e+d+4+a)/h,o)})):o=Math.max((d+4+a)/h,o),!1!==r.internalProps.limitMaxAutoWidth&&(o=Math.min("number"==typeof r.internalProps.limitMaxAutoWidth?r.internalProps.limitMaxAutoWidth:450,o)),"checkbox"===i){const i=qM("size",s,t,e,r);if(o+=i,f){const i=qM("spaceBetweenTextAndIcon",s,t,e,r);o+=i}}else if("radio"===i){const i=qM("size",s,t,e,r),a=qM("outerRadius",s,t,e,r),l=Xx(a)?2*a:i,h=qM("spaceBetweenTextAndIcon",s,t,e,r);if(Ux(n)){const i=r.getBodyColumnDefine(t,e),a=qM("spaceBetweenRadio",s,t,e,r),c=i?.radioDirectionInCell??"vertical";"vertical"===c?(o+=l,o+=h):"horizontal"===c&&(o+=(l+h)*n.length,o+=a*(n.length-1))}else o+=l,f&&(o+=h)}else if("switch"===i){const i=qM("boxWidth",s,t,e,r);o=i}else if("button"===i){const i=qM("buttonPadding",s,t,e,r);o+=2*i}return o}function gk(t,e,i){return{left:0,top:0,right:i.getColWidth(t),bottom:i.getRowHeight(e),width:null,height:null}}function pk(t,e,i,r,o,n,s){let a=0;const l=[],h=[];let c=0;const d=new Map,u=new Map;for(let t=e;t<i;t++){const e=r?o[t]??n.getColWidth(t):n.getColWidth(t),i=n.getMaxColWidth(t),s=n.getMinColWidth(t);if(a+=e,l.push(t),i===e?d.set(t,e):s===e&&u.set(t,e),n.options.customConfig?.shrinkSparklineFirst){"sparkline"===n.getBodyColumnType(t,0)&&(h.push({col:t,width:e}),c+=e-n.defaultColWidth)}}if(a>t)for(const[e,i]of u){t-=i,a-=i;const r=l.indexOf(e);-1!==r&&l.splice(r,1)}else if(a<t)for(const[e,i]of d){t-=i,a-=i;const r=l.indexOf(e);-1!==r&&l.splice(r,1)}const g=t/a;if(n.options.customConfig?.shrinkSparklineFirst&&g<1&&a-t<c)for(let e=0;e<h.length;e++){const{col:i,width:l}=h[e],c=(a-t)/h.length,d=Math.floor(l-c);r?o[i]=n._adjustColWidth(i,d):s?n.scenegraph.setColWidth(i,n._adjustColWidth(i,d)):n._setColWidth(i,n._adjustColWidth(i,d),!1,!0)}else for(let e=0;e<l.length;e++){const i=l[e];let a;a=e===l.length-1?t-l.reduce(((t,e,s)=>e!==i?t+(r?o[e]??n.getColWidth(i):n.getColWidth(e)):t),0):Math.round((r?o[i]??n.getColWidth(i):n.getColWidth(i))*g),r?o[i]=n._adjustColWidth(i,a):s?n.scenegraph.setColWidth(i,n._adjustColWidth(i,a)):n._setColWidth(i,n._adjustColWidth(i,a),!1,!0)}}const fk=new $M({});function mk(t,e,i,r,o,n,s,a,l){let h,c,d,u=0;t.lastChild&&t.lastChild.row===r-1?u=t.lastChild.attribute.y+t.lastChild.attribute.height:t.colHeight&&(u=t.colHeight);for(let g=r;g<=o;g++){const o=g;let p,f,m,b,y=a.getCellLocation(e,o),C=a.getCellValue(e,o),w=i,v=a.getRowHeight(o),x=!1;if(a.internalProps.customMergeCell){const t=a.getCustomMerge(e,o);if(t){const{range:e,text:i,style:s,customLayout:l,customRender:h}=t;if(p=e,f=p.start.col!==p.end.col||p.start.row!==p.end.row,f){const t=yk(p,n,a,r>p.start.row);w=t.cellWidth,v=t.cellHeight}C=i,m=s,(l||h)&&(b=NM(l,h,e.start.col,e.start.row,a.getColsWidth(e.start.col,e.end.col),a.getRowsHeight(e.start.row,e.end.row),!1,a.isAutoRowHeight(o),[0,0,0,0],p,a)),x=!0}}let _,S=e,A=o;p&&(S=p.start.col,A=p.start.row),!a.isPivotTable()&&("columnHeader"===y||"cornerHeader"===y)&&o>=a.columnHeaderLevelCount&&(y="body"),_=!a.isPivotTable()&&a.isSeriesNumberInBody(e,o)?a.getBodyColumnDefine(S,A):"body"!==y?a.getHeaderDefine(S,A):a.getBodyColumnDefine(S,A);const T="isAggregation"in a.internalProps.layoutMap&&a.internalProps.layoutMap.isAggregation(e,o),R=a.internalProps.layoutMap.isSeriesNumber(e,o);let B="body"!==y||(_?.dragOrder||!!_?.icon||!!_?.tree)&&!(T&&R);if(!p&&(a.internalProps.enableTreeNodeMerge||"body"!==y||_?.mergeCell)&&(p=a.getCellRange(e,o),f=p.start.col!==p.end.col||p.start.row!==p.end.row,f)){const t=yk(p,n,a,r>p.start.row);w=t.cellWidth,v=t.cellHeight}let M=!1;if(a.internalProps.enableTreeNodeMerge&&f){const t=a.getCellRawRecord(p.start.col,p.start.row),{vtableMergeName:i,vtableMerge:r}=t??{};M=r,r&&(B=!0,a.internalProps.groupTitleCustomLayout&&(b=NM(a.internalProps.groupTitleCustomLayout,void 0,p.start.col,p.start.row,a.getColsWidth(p.start.col,p.end.col),a.getRowsHeight(p.start.row,p.end.row),!1,a.isAutoRowHeight(o),[0,0,0,0],p,a)),a.internalProps.groupTitleFieldFormat?C=a.internalProps.groupTitleFieldFormat(t,e,o,a):void 0!==i&&(C=i))}const P=M||x?"text":(a.isHeader(e,o)?a._getHeaderLayoutMap(e,o).headerType??"text":a.getBodyColumnType(e,o))??"text";if(TS(C)){Ck(e,o,0,u,w,v,t),fP(C,a,bk.bind(null,{type:P,value:C,define:_,table:a,col:e,row:o,colWidth:i,cellWidth:w,cellHeight:v,columnGroup:t,y:u,customStyle:m,mayHaveIcon:B,cellLocation:y,range:p,customResult:b,defaultRowHeight:s})),t.updateColumnRowNumber(o);const r=a.getRowHeight(o);t.updateColumnHeight(r),u+=r}else{const r=ZB(m||a._getCellStyle(p?p.start.col:e,p?p.start.row:o),a,p?p.start.col:e,p?p.start.row:o,qM).theme;r.group.cornerRadius=JB(e,o,a),r.group.width=i,r.group.height=Array.isArray(s)?s[o]:s,r._vtable.padding&&(h=r._vtable.padding),r.text.textAlign&&(c=r.text.textAlign),r.text.textBaseline&&(d=r.text.textBaseline),"body"===y||r.group.fill||(r.group.fill="#fff");const n=bP(P,C,_,a,e,o,i,w,v,t,u,h,c,d,B,r,p,b);if(t.updateColumnRowNumber(o),f){const i=a.getRowHeight(o);a.getColWidth(e);const{width:r}=n.attribute,{height:s}=n.attribute;n.contentWidth=r,n.contentHeight=s,xP(p,r,s,h,c,d,a),t.updateColumnHeight(i),u+=i}else t.updateColumnHeight(v),u+=v}if(l&&o>l)break}return t.setAttribute("width",i),{width:i,height:u}}function bk(t){let e,i,r;const{type:o,value:n,define:s,table:a,col:l,row:h,colWidth:c,cellWidth:d,cellHeight:u,columnGroup:g,y:p,cellLocation:f,mayHaveIcon:m,customStyle:b,range:y,customResult:C,defaultRowHeight:w}=t,v=ZB(b||a._getCellStyle(y?y.start.col:l,y?y.start.row:h),a,y?y.start.col:l,y?y.start.row:h,qM).theme;v.group.cornerRadius=JB(l,h,a),v.group.width=c,v.group.height=Array.isArray(w)?w[h]:w,v._vtable.padding&&(e=v._vtable.padding),v.text.textAlign&&(i=v.text.textAlign),v.text.textBaseline&&(r=v.text.textBaseline),"body"===f||v.group.fill||(v.group.fill="#fff"),bP(o,n,s,a,l,h,c,d,u,g,p,e,i,r,m,v,y,C)}function yk(t,e,i,r){let o=0,n=0;const s=e.get(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`);if(!s||r){for(let e=t.start.col;e<=t.end.col;e++)o+=i.getColWidth(e);for(let e=t.start.row;e<=t.end.row;e++)n+=i.getRowHeight(e);e.set(`${t.start.col},${t.start.row};${t.end.col},${t.end.row}`,{cellWidth:o,cellHeight:n})}else o=s.cellWidth,n=s.cellHeight;return{cellWidth:o,cellHeight:n}}function Ck(t,e,i,r,o,n,s){const a=new $M({x:i,y:r,width:o,height:n});a.role="cell",a.col=t,a.row=e,s.addChild(a)}function wk(t,e,i,r,o,n,s,a,l,h){if(r>o||n>s)return;const{layoutMap:c,defaultHeaderRowHeight:d,defaultColWidth:u}=l.internalProps,g=l.defaultRowHeight;let p=0,f=0;for(let c=r;c<=o;c++){const r=c,o=l.getColWidth(r),u=new $M({x:e+p,y:i,width:o,height:0,clip:!1,pickable:!1});u.role="column",u.col=c,t.addChild(u);const{width:m,height:b}=mk(u,r,o,n,s,l.scenegraph.mergeMap,"columnHeader"===a&&Xx(d)?d:g,l,h);p+=m,f=Math.max(f,b)}t.setAttribute("width",p),t.setAttribute("height",f)}function vk(t){let e=t.firstChild;for(;e&&"group"!==e.type;)e=e._next;return e}function xk(t){let e=t.lastChild;for(;e&&"group"!==e.type;)e=e._prev;return e}function _k(t,e,i,r="left"){for(let o=t;o<=e;o++){const t=i.scenegraph.getColGroup(o);t&&Sk(t,i,r);const e=i.scenegraph.getColGroup(o,!0);e&&Sk(e,i,r);const n=i.scenegraph.getColGroupInBottom(o);n&&Sk(n,i,r)}const o=Math.min(i.scenegraph.proxy.colLimit,i.scenegraph.proxy.bodyRightCol-i.scenegraph.proxy.bodyLeftCol+1),n=i.getColsWidth(i.frozenColCount,i.frozenColCount+o),s=i.getColsWidth(i.frozenColCount,i.colCount-1);i.scenegraph.proxy.xLimitLeft=n/2,i.scenegraph.proxy.xLimitRight=s-n/2}function Sk(t,e,i="left"){if("left"===i){let i;const r=function(t){let e=t._prev;for(;e&&"group"!==e.type;)e=e._prev;return e}(t);i=r?r.attribute.x+e.getColWidth(t._prev.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}else{let i;const r=function(t){let e=t._next;for(;e&&"group"!==e.type;)e=e._next;return e}(t);i=r?r.attribute.x-e.getColWidth(t.col):e.getColsWidth(e.frozenColCount,t.col-1),t.setAttribute("x",i)}}async function Ak(t,e,i,r){if(!e)return;const o=e.col,n=e.left;let s;if(s=i?r.bodyRightCol-r.colEnd:r.screenLeftCol-r.referenceCol,function(t,e,i,r,o){t>0?(Tk(t,"left",o.screenLeftCol,i,r,o),o.updateDeltaX(r,i,e),o.table.scenegraph.setBodyAndColHeaderX(-r+o.deltaX)):t<0?(Tk(-t,"right",o.screenLeftCol,i,r,o),o.updateDeltaX(r,i,e),o.table.scenegraph.setBodyAndColHeaderX(-r+o.deltaX)):(o.updateDeltaX(r,i,e),o.table.scenegraph.setBodyAndColHeaderX(-r+o.deltaX))}(s,o,n,t,r),i){const e=r.table.scenegraph.getColGroup(r.colEnd);if(e){const i=e.attribute.x+e.attribute.width-(r.table.tableNoFrameWidth-r.table.getFrozenColsWidth()-r.table.getRightFrozenColsWidth())-t;r.deltaX=-i,r.table.scenegraph.setBodyAndColHeaderX(-t+r.deltaX)}}r.table.scenegraph.updateNextFrame()}async function Tk(t,e,i,r,o,n){if("left"===e&&n.colEnd+t>n.bodyRightCol?t=n.bodyRightCol-n.colEnd:"right"===e&&n.colStart-t<n.bodyLeftCol&&(t=n.colStart-n.bodyLeftCol),0!==t)if(t<0&&(e="left"===e?"right":"left",t=-t),t<n.colEnd-n.colStart){const o="left"===e?n.colStart:n.colEnd-t+1,s="left"===e?n.colStart+t-1:n.colEnd,a="left"===e?n.colEnd+1:n.colStart-t,l="left"===e?n.colEnd+t:n.colStart-1;lk(n.table,a,l),function(t,e,i,r){for(let o=t;o<=e;o++)r.table.scenegraph.bodyGroup.childrenCount>0&&"group"===r.table.scenegraph.bodyGroup.firstChild.type&&Pk(r.table.scenegraph.bodyGroup,i,r),r.table.scenegraph.colHeaderGroup.childrenCount>0&&"group"===r.table.scenegraph.colHeaderGroup.firstChild.type&&Pk(r.table.scenegraph.colHeaderGroup,i,r),r.table.scenegraph.bottomFrozenGroup.childrenCount>0&&"group"===r.table.scenegraph.bottomFrozenGroup.firstChild.type&&Pk(r.table.scenegraph.bottomFrozenGroup,i,r)}(o,s,e,n);const h=a,c=l;n.colStart="left"===e?n.colStart+t:n.colStart-t,n.colEnd="left"===e?n.colEnd+t:n.colEnd-t,Hk(h,c,n),_k(h,c,n.table,e);const d=r-((n.table.scenegraph.getColGroup(i)||n.table.scenegraph.getColGroup(i,!0)).attribute.x+n.table.getFrozenColsWidth()+n.table.scenegraph.proxy.deltaX);n.table.scenegraph.proxy.deltaX+=d,n.currentCol="left"===e?n.currentCol+t:n.currentCol-t,n.totalCol=Math.max(0,Math.min(n.table.colCount-1,"left"===e?n.totalCol+t:n.totalCol-t)),n.referenceCol=n.colStart+Math.floor((n.colEnd-n.colStart)/2),n.colUpdatePos=a,n.colUpdateDirection=e,n.table.scenegraph.updateNextFrame()}else{const i="left"===e?n.colStart+t:n.colStart-t,r="left"===e?n.colEnd+t:n.colEnd-t;lk(n.table,i,r);!function(t,e,i,r){r.table.scenegraph.colHeaderGroup.forEachChildren(((o,n)=>{"group"===o.type&&Rk(o,"left"===i?o.col+e:o.col-e,0===n?t:o._prev.attribute.x+r.table.getColWidth(o._prev.col))})),r.table.scenegraph.bottomFrozenGroup.forEachChildren(((o,n)=>{"group"===o.type&&Rk(o,"left"===i?o.col+e:o.col-e,0===n?t:o._prev.attribute.x+r.table.getColWidth(o._prev.col))})),r.table.scenegraph.bodyGroup.forEachChildren(((o,n)=>{"group"===o.type&&Rk(o,"left"===i?o.col+e:o.col-e,0===n?t:o._prev.attribute.x+r.table.getColWidth(o._prev.col))}))}(n.table.getColsWidth(n.bodyLeftCol,i-1),t,e,n);const o=i,s=r;n.colStart=i,n.colEnd=r,Hk(o,s,n),_k(o,s,n.table,r>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left"),n.currentCol="left"===e?n.currentCol+t:n.currentCol-t,n.totalCol=Math.max(0,Math.min(n.table.colCount-1,"left"===e?n.totalCol+t:n.totalCol-t)),n.referenceCol=n.colStart+Math.floor((n.colEnd-n.colStart)/2),n.colUpdatePos=n.colStart,n.colUpdateDirection=r>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left",n.table.scenegraph.updateNextFrame()}}function Rk(t,e,i){t.col=e,t.forEachChildren((t=>{t.col=e,t.needUpdate=!0})),t.setAttribute("x",i),t.needUpdate=!0}function Bk(t,e){if(!t)return;let i=t.firstChild;for(;i;){i=e.updateCellGroupContent(i)._next}t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function Mk(t,e){if(!t)return;const i=e.screenTopRow,r=Math.max(e.bodyTopRow,i-1*e.screenRowCount),o=Math.min(e.bodyBottomRow,i+2*e.screenRowCount,e.table.rowCount-1);for(let i=r;i<=o;i++){const r=e.highPerformanceGetCell(t.col,i,!0);e.updateCellGroupContent(r)}e.rowUpdatePos=e.rowStart,t.needUpdate=!1,t.setAttribute("width",e.table.getColWidth(t.col))}function Pk(t,e,i){if("left"===e){const e=vk(t),r=xk(t);Rk(e,r.col+1,r.attribute.x+i.table.getColWidth(r.col)),t.appendChild(e),t.border&&t.appendChild(t.border)}else{const e=xk(t),r=vk(t);Rk(e,r.col-1,r.attribute.x-i.table.getColWidth(r.col-1)),t.insertBefore(e,t.firstChild)}}function Hk(t,e,i){for(let r=t;r<=e;r++){const t=i.table.scenegraph.getColGroup(r,!0);t&&Bk(t,i);const e=i.table.scenegraph.getColGroupInBottom(r);e&&Bk(e,i);const o=i.table.scenegraph.getColGroupInRightTopCorner(r);o&&Bk(o,i);const n=i.table.scenegraph.getColGroupInRightBottomCorner(r);n&&Bk(n,i);const s=i.table.scenegraph.getColGroup(r);s&&Mk(s,i)}kk(i.table.scenegraph.colHeaderGroup),kk(i.table.scenegraph.bottomFrozenGroup),kk(i.table.scenegraph.bodyGroup),i.progress()}function kk(t){const e=xk(t);if(e&&(t.setAttribute("width",e.attribute.x+e.attribute.width),t.border)){const i=t.border;i.setAttribute("width",e.attribute.x+e.attribute.width-(i.attribute.borderLeft??0)/2-(i.attribute.borderRight??0)/2)}}function Ek(t,e,i,r,o,n="up",s){if("up"===n)for(let n=t;n<=e;n++)for(let t=i;t<=r;t++){const e=o.scenegraph.highPerformanceGetCell(n,t,!0);if("cell"!==e.role||!e.row)continue;let i;if(e._prev)i=e._prev?.attribute.y+o.getRowHeight(e._prev.row);else if(s){const e=r===o.rowCount-o.bottomFrozenRowCount-1?r:r+1;if(i=o.scenegraph.highPerformanceGetCell(n,e,!0).attribute.y,Wx(i))for(let r=t;r<e;r++)i-=o.getRowHeight(r)}else i=Fk(e.row,o);Wx(i)&&e.setAttribute("y",i)}else for(let n=t;n<=e;n++)for(let t=r;t>=i;t--){const e=o.scenegraph.highPerformanceGetCell(n,t,!0);if("cell"!==e.role||!e.row)continue;let r;if(e._next)r=e._next?.attribute.y-o.getRowHeight(e.row);else if(s){const e=i<=o.frozenRowCount?o.frozenRowCount:i-1;if(i<=o.frozenRowCount)r=0;else{r=o.scenegraph.highPerformanceGetCell(n,e,!0).attribute.y}for(let i=e;i<t;i++){r+=o.getRowHeight(i)}}else r=Fk(e.row,o);Wx(r)&&e.setAttribute("y",r)}const a=Math.min(o.scenegraph.proxy.rowLimit,o.scenegraph.proxy.bodyBottomRow-o.scenegraph.proxy.bodyTopRow+1),l=o.getRowsHeight(o.frozenRowCount,o.frozenRowCount+a),h=o.getRowsHeight(o.frozenRowCount,o.rowCount-1);o.scenegraph.proxy.yLimitTop=l/2,o.scenegraph.proxy.yLimitBottom=h-l/2}function Fk(t,e){let i;return i=t<e.frozenRowCount?e.getRowsHeight(0,t-1):t>=e.rowCount-e.bottomFrozenRowCount?e.getRowsHeight(e.rowCount-e.bottomFrozenRowCount,t-1):e.getRowsHeight(e.frozenRowCount,t-1),i}async function Lk(t,e,i,r){if(!e)return;const o=e.row,n=e.top;let s;if(s=i?r.bodyBottomRow-r.rowEnd:o-r.referenceRow,function(t,e,i,r,o){t>0?(Ik(t,"up",e,i,r,o),o.updateDeltaY(r,i,e),o.updateBody(r-o.deltaY)):t<0?(Ik(-t,"down",e,i,r,o),o.updateDeltaY(r,i,e),o.updateBody(r-o.deltaY)):(o.updateDeltaY(r,i,e),o.updateBody(r-o.deltaY))}(s,o,n,t,r),i){const e=r.table.scenegraph.highPerformanceGetCell(r.colStart,r.rowEnd,!0);if("cell"===e.role){const i=e.attribute.y+e.attribute.height-(r.table.tableNoFrameHeight-r.table.getFrozenRowsHeight()-r.table.getBottomFrozenRowsHeight())-t;r.deltaY=-i,r.updateBody(t-r.deltaY)}}}async function Ik(t,e,i,r,o,n){if("up"===e&&n.rowEnd+t>n.bodyBottomRow?t=n.bodyBottomRow-n.rowEnd:"down"===e&&n.rowStart-t<n.bodyTopRow&&(t=n.rowStart-n.bodyTopRow),0!==t)if(t<0&&(e="up"===e?"down":"up",t=-t),t<n.rowEnd-n.rowStart){const r="up"===e?n.rowStart:n.rowEnd-t+1,o="up"===e?n.rowStart+t-1:n.rowEnd,s="up"===e?n.rowEnd+1:n.rowStart-t,a="up"===e?n.rowEnd+t:n.rowStart-1;let l,h;if(n.table.isAutoRowHeight(r))l=s,h=a;else{l=Math.max(n.bodyTopRow,i-1*n.screenRowCount),h=Math.min(n.bodyBottomRow,i+2*n.screenRowCount,n.table.rowCount-1)}NP(n.table,l,h,!1),function(t,e,i,r){for(let o=0;o<r.table.frozenColCount;o++){const n=r.table.scenegraph.getColGroup(o);if(n)for(let o=t;o<=e;o++)zk(n,i,r)}for(let o=r.table.colCount-r.table.rightFrozenColCount;o<r.table.colCount;o++){const n=r.table.scenegraph.getColGroup(o);if(n)for(let o=t;o<=e;o++)zk(n,i,r)}for(let o=r.bodyLeftCol;o<=r.bodyRightCol;o++){const n=r.table.scenegraph.getColGroup(o);if(n)for(let o=t;o<=e;o++)zk(n,i,r)}}(r,o,e,n),n.rowStart="up"===e?n.rowStart+t:n.rowStart-t,n.rowEnd="up"===e?n.rowEnd+t:n.rowEnd-t;const c=Ok(l,h,n,!0);n.table.isAutoRowHeight(r)&&(Ek(n.bodyLeftCol,n.bodyRightCol,l,h,n.table,a>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",!0),Ek(0,n.table.frozenColCount-1,l,h,n.table,a>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",!0),Ek(n.table.colCount-n.table.rightFrozenColCount,n.table.colCount-1,l,h,n.table,a>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",!0)),n.currentRow="up"===e?n.currentRow+t:n.currentRow-t,n.totalRow=Math.max(0,Math.min(n.bodyBottomRow,"up"===e?n.totalRow+t:n.totalRow-t,n.table.rowCount-1)),n.referenceRow=n.rowStart+Math.floor((n.rowEnd-n.rowStart)/2),n.table.isAutoRowHeight(r)&&c?n.rowUpdatePos=Math.min(n.rowUpdatePos,n.rowEnd+1):n.rowUpdatePos=Math.min(n.rowUpdatePos,s),n.rowUpdateDirection=e,n.table.scenegraph.updateNextFrame(),await n.progress()}else{const r="up"===e?n.rowStart+t:n.rowStart-t,o=Math.min(n.table.rowCount-1,"up"===e?n.rowEnd+t:n.rowEnd-t),s=n.table.getRowsHeight(n.bodyTopRow,r-1);let a,l;n.table.isAutoRowHeight(r)?(a=r,l=o):(a=Math.max(n.bodyTopRow,i-1*n.screenRowCount),l=Math.min(n.bodyBottomRow,i+2*n.screenRowCount,n.table.rowCount-1)),NP(n.table,a,l,!1),function(t,e,i,r){for(let o=0;o<r.table.frozenColCount;o++){const n=r.table.scenegraph.getColGroup(o);n?.forEachChildren(((o,n)=>{r.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===n?t:o._prev.attribute.y+r.table.getRowHeight(o._prev.row))}))}for(let o=r.table.colCount-r.table.rightFrozenColCount;o<r.table.colCount;o++){const n=r.table.scenegraph.getColGroup(o);n?.forEachChildren(((o,n)=>{r.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===n?t:o._prev.attribute.y+r.table.getRowHeight(o._prev.row))}))}for(let o=r.bodyLeftCol;o<=r.bodyRightCol;o++){const n=r.table.scenegraph.getColGroup(o);n?.forEachChildren(((o,n)=>{r.updateCellGroupPosition(o,"up"===i?o.row+e:o.row-e,0===n?t:o._prev.attribute.y+r.table.getRowHeight(o._prev.row))}))}}(s,t,e,n),n.rowStart=r,n.rowEnd=o;const h=Ok(a,l,n,!0);n.table.isAutoRowHeight(r)&&(Ek(n.bodyLeftCol,n.bodyRightCol,a,l,n.table,o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),Ek(0,n.table.frozenColCount-1,a,l,n.table,o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),Ek(n.table.colCount-n.table.rightFrozenColCount,n.table.colCount-1,a,l,n.table,o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up")),n.currentRow="up"===e?n.currentRow+t:n.currentRow-t,n.totalRow=Math.max(0,Math.min(n.bodyBottomRow,"up"===e?n.totalRow+t:n.totalRow-t,n.table.rowCount-1)),n.referenceRow=n.rowStart+Math.floor((n.rowEnd-n.rowStart)/2),n.table.isAutoRowHeight(r)&&h?n.rowUpdatePos=n.rowEnd+1:n.rowUpdatePos=n.rowStart,n.rowUpdateDirection=o>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",n.table.scenegraph.updateNextFrame(),await n.progress()}}function zk(t,e,i){if(t.childrenCount>=1)if("up"===e){const e=t.firstChild;i.updateCellGroupPosition(e,t.lastChild.row+1,t.lastChild.attribute.y+i.table.getRowHeight(t.lastChild.row)),t.appendChild(e)}else{const e=t.lastChild;i.updateCellGroupPosition(e,t.firstChild.row-1,t.firstChild.attribute.y-i.table.getRowHeight(e.row)),t.insertBefore(e,t.firstChild)}}function Ok(t,e,i,r=!1){for(let r=0;r<i.table.frozenColCount;r++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(r,o,!0);i.updateCellGroupContent(t)}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(r,o);i.updateCellGroupContent(t)}let o=i.bodyLeftCol,n=i.bodyRightCol,s=!0;if(r){const t=i.screenLeftCol;o=Math.max(i.bodyLeftCol,t-1*i.screenColCount),n=Math.min(i.bodyRightCol,t+2*i.screenColCount),o===i.bodyLeftCol&&n===i.bodyRightCol||(s=!1)}for(let r=o;r<=n;r++)for(let o=t;o<=e;o++){const t=i.highPerformanceGetCell(r,o);i.updateCellGroupContent(t)}return Dk(i.table.scenegraph.rowHeaderGroup),Dk(i.table.scenegraph.rightFrozenGroup),Dk(i.table.scenegraph.bodyGroup),i.table.scenegraph.updateNextFrame(),s}function Dk(t){const e=xk(t);if(!e)return;const i=xk(e);if(i&&(t.setAttribute("height",i.attribute.y+i.attribute.height),t.border)){const e=t.border;e.setAttribute("height",i.attribute.y+i.attribute.height-(e.attribute.borderTop??0)/2-(e.attribute.borderBottom??0)/2)}}function Wk(t){const{changedCells:e}=t.internalProps.stick;return e.forEach((e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((t=>{t.setAttributes({dx:e.dx,dy:e.dy})}))})),e.clear(),e}function Nk(t){const e=Wk(t),{scrollTop:i,scrollLeft:r,frozenRowCount:o,frozenColCount:n}=t,s=t.getFrozenRowsHeight(),a=t.getFrozenColsWidth(),{row:l}=t.getRowAt(i+s+1),{col:h}=t.getColAt(r+a+1),c=Math.max(l,t.frozenRowCount),d=Math.max(h,t.frozenColCount),u=t.getAllRowsHeight()>t.tableNoFrameHeight?t.getRowAt(i+t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()-1).row:t.rowCount-t.bottomFrozenRowCount-1,g=t.getAllColsWidth()>t.tableNoFrameWidth?t.getColAt(r+t.tableNoFrameWidth-t.getRightFrozenColsWidth()-1).col:t.colCount-t.rightFrozenColCount-1;if(!(g<0||u<0)){for(let i=0;i<o&&!(g<d);i++)[d,g].forEach((r=>{const o=t._getCellStyle(r,i);if(o?.textStick&&"vertical"!==o?.textStick){Vk(t.scenegraph.getCell(r,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,o?.textStickBaseOnAlign,t)}}));for(let i=0;i<n&&!(u<c);i++)[c,u].forEach((r=>{const o=t._getCellStyle(i,r);if(o?.textStick&&"horizontal"!==o?.textStick){Gk(t.scenegraph.getCell(i,r),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,o?.textStickBaseOnAlign,t)}}));for(let i=d;i<=g&&!(u<c);i++)[c,u].forEach((r=>{const o=t._getCellStyle(i,r);if(o?.textStick&&"horizontal"!==o?.textStick){Gk(t.scenegraph.getCell(i,r),s+t.tableY,t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()+t.tableY,e,o?.textStickBaseOnAlign,t)}}));for(let i=c;i<=u&&!(g<d);i++)[d,g].forEach((r=>{const o=t._getCellStyle(r,i);if(o?.textStick&&"vertical"!==o?.textStick){Vk(t.scenegraph.getCell(r,i),a+t.tableX,t.tableNoFrameWidth-t.getRightFrozenColsWidth()+t.tableX,e,o?.textStickBaseOnAlign,t)}}))}}function Gk(t,e,i,r,o,n){if(Xx(t.mergeStartCol)&&Xx(t.mergeStartRow)&&Xx(t.mergeEndCol)&&Xx(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=XP(t,n.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){const a=n.scenegraph.getCell(t,s);"cell"===a.role&&jk(a,e,i,r,o)}}else jk(t,e,i,r,o)}function jk(t,e,i,r,o){const n=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!n)return;if("image"===n.type){const{image:t}=n.attribute;if(!t||!n.resources)return;if("success"!==n.resources.get(t).state)return}const s=n.textBaseline??"top";n.AABBBounds.width();const a=n.globalAABBBounds.y1,l=n.globalAABBBounds.y2;if("middle"===s&&o){const o=t.globalAABBBounds.y1+(t.firstChild?.attribute.dy??0),s=o+(t.contentHeight??t.attribute.height??0);if(o<e||s>i){const a=Math.max(o,e),l=Math.min(s,i),h=n.globalTransMatrix.f-(l+a)/2+n.AABBBounds.height()/2;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dy",(t.attribute.dy??0)-h+2)}))}}else if(a<e){const i=a-e;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dy",(t.attribute.dy??0)-i+2)}))}else if(l>i){const e=l-i;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dy",(t.attribute.dy??0)-e)}))}}function Vk(t,e,i,r,o,n){if(Xx(t.mergeStartCol)&&Xx(t.mergeStartRow)&&Xx(t.mergeEndCol)&&Xx(t.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=XP(t,n.scenegraph);for(let t=s;t<=a;t++)for(let s=l;s<=h;s++){const a=n.scenegraph.getCell(t,s);"cell"===a.role&&Uk(a,e,i,r,o)}}else Uk(t,e,i,r,o)}function Uk(t,e,i,r,o){const n=t.getChildByName("text",!0)||t.getChildByName("image",!0);if(!n)return;if("image"===n.type){const{image:t}=n.attribute;if(!t||!n.resources)return;if("success"!==n.resources.get(t).state)return}const s=n.attribute.textAlign??n.textAlign??"left";n.AABBBounds.width();const a=n.globalAABBBounds.x1,l=n.globalAABBBounds.x2;if("center"===s&&o){const o=t.globalAABBBounds.x1+(t.firstChild?.attribute.dx??0),s=o+(t.contentWidth??t.attribute.width??0);if(o<e||s>i){const a=Math.max(o,e),l=Math.min(s,i),h=n.globalTransMatrix.e-(l+a)/2;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dx",(t.attribute.dx??0)-h+2)}))}}else if(a<e){const i=a-e;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dx",(t.attribute.dx??0)-i+2)}))}else if(l>i){const e=l-i;!r.has(`${t.col}-${t.row}`)&&r.set(`${t.col}-${t.row}`,{col:t.col,row:t.row,dx:t.firstChild?.attribute.dx??0,dy:t.firstChild?.attribute.dy??0}),t.forEachChildren((t=>{t.setAttribute("dx",(t.attribute.dx??0)-e)}))}}function Kk(t){const e=t.internalProps.layoutMap.headerObjects,i=t.internalProps.layoutMap.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(i&&i.style?.textStick)return!0}for(let t=0;t<i.length;t++){const e=i[t];if(e&&e.style?.textStick)return!0}return!!(t.theme.headerStyle.textStick||t.theme.rowHeaderStyle.textStick||t.theme.bodyStyle.textStick)}fk.role="empty";class $k{table;isRelease=!1;mode="column";isProgressing;rowLimit=200;currentRow=0;totalRow;yLimitTop;yLimitBottom;rowStart=0;rowEnd=0;referenceRow=0;bodyBottomRow;screenRowCount;firstScreenRowLimit;taskRowCount;rowUpdatePos;rowUpdateDirection;screenTopRow=0;totalActualBodyRowCount;deltaY=0;deltaHeight=0;colLimit=100;bodyRightCol;totalCol;colStart;colEnd;taskColCount;xLimitLeft;xLimitRight;screenColCount;firstScreenColLimit;colUpdatePos;currentCol;referenceCol;screenLeftCol=0;colUpdateDirection;totalActualBodyColCount;deltaX=0;deltaWidth=0;cellCache=new Map;constructor(t){this.table=t,this.table.isPivotChart()?(this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))):this.table.isAutoRowHeight(t.columnHeaderLevelCount)?this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)):("autoWidth"===this.table.widthMode||(this.rowLimit=Math.max(200,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight))),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount),this.table.options.maintainedColumnCount&&(this.colLimit=this.table.options.maintainedColumnCount),"adaptive"===this.table.heightMode&&(this.rowLimit=this.table.rowCount),"adaptive"===this.table.widthMode&&(this.colLimit=this.table.colCount)}get bodyLeftCol(){return this.table.frozenColCount}get bodyTopRow(){return this.table.frozenRowCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,r=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=r-i/2;const o=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(o/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow,this.rowEnd=this.totalRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,r=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=r-i/2;const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/e))),this.rowUpdatePos=this.bodyBottomRow}refreshRowCount(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.rowStart+t-1}refreshColCount(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const r=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(r/i))}createGroupForFirstScreen(t,e,i,r,o,n,s,a){!function(t,e,i,r,o,n,s,a,l){const{table:h}=l,{leftBottomCornerGroup:c,rightTopCornerGroup:d,rightBottomCornerGroup:u}=h.scenegraph;let g,p,f,m;l.setParamsForRow(),l.setParamsForColumn(),"adaptive"===h.widthMode||h.options.autoWrapText&&("adaptive"===h.heightMode||h.isAutoRowHeight(h.columnHeaderLevelCount))?(f=h.colCount-1,g=Math.min(l.firstScreenColLimit-1,h.colCount-1)):g=Math.min(l.firstScreenColLimit-1,h.colCount-1),"adaptive"===h.heightMode?(m=h.rowCount-1,p=Math.min(l.firstScreenRowLimit-1,h.rowCount-1)):p=Math.min(l.firstScreenRowLimit-1,h.rowCount-1),0===h.internalProps._widthResizedColMap.size&&lk(h,0,f??g),0===h.internalProps._heightResizedRowMap.size&&NP(h,0,"auto"===h.options.canvasHeight||h.options.customConfig?.forceComputeAllRowHeight?h.rowCount-1:m??p),g<h.colCount-h.rightFrozenColCount&&h.colCount-h.rightFrozenColCount<=h.colCount-1&&lk(h,h.colCount-h.rightFrozenColCount,h.colCount-1),p<h.rowCount-h.bottomFrozenRowCount&&h.rowCount-h.bottomFrozenRowCount<=h.rowCount-1&&NP(h,h.rowCount-h.bottomFrozenRowCount,h.rowCount-1),h.scenegraph.colHeaderGroup.setAttribute("x",h.getFrozenColsWidth()),h.scenegraph.rowHeaderGroup.setAttribute("y",h.getFrozenRowsHeight()),h.scenegraph.bottomFrozenGroup.setAttribute("x",h.getFrozenColsWidth()),h.scenegraph.rightFrozenGroup.setAttribute("y",h.getFrozenRowsHeight()),h.scenegraph.bodyGroup.setAttributes({x:h.getFrozenColsWidth(),y:h.getFrozenRowsHeight()}),wk(t,s,a,0,h.frozenColCount-1,0,h.frozenRowCount-1,h.isListTable()?"columnHeader":"cornerHeader",h),g-h.rightFrozenColCount>=h.frozenColCount&&wk(e,s,a,h.frozenColCount,g-h.rightFrozenColCount,0,h.frozenRowCount-1,"columnHeader",h),h.frozenColCount>0&&(h.leftRowSeriesNumberCount>0&&wk(i,s,a,0,h.leftRowSeriesNumberCount-1,h.frozenRowCount,p-h.bottomFrozenRowCount,"rowHeader",h),h.frozenColCount>h.leftRowSeriesNumberCount&&wk(i,s,a,h.leftRowSeriesNumberCount,Math.min(h.frozenColCount-1,h.rowHeaderLevelCount+h.leftRowSeriesNumberCount-1),h.frozenRowCount,p-h.bottomFrozenRowCount,"rowHeader",h),h.frozenColCount>h.rowHeaderLevelCount+h.leftRowSeriesNumberCount&&wk(i,s,a,h.rowHeaderLevelCount+h.leftRowSeriesNumberCount,h.frozenColCount-1,h.frozenRowCount,p-h.bottomFrozenRowCount,"body",h)),h.bottomFrozenRowCount>0&&(h.frozenColCount>0&&(h.leftRowSeriesNumberCount>0&&wk(c,s,a,0,h.leftRowSeriesNumberCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"rowHeader",h),h.rowHeaderLevelCount>0&&wk(c,s,a,h.leftRowSeriesNumberCount,h.leftRowSeriesNumberCount+h.rowHeaderLevelCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"rowHeader",h),h.frozenColCount>h.rowHeaderLevelCount+h.leftRowSeriesNumberCount&&wk(c,s,a,h.rowHeaderLevelCount+h.leftRowSeriesNumberCount,h.frozenColCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"body",h)),g-h.rightFrozenColCount>=h.frozenColCount&&wk(o,s,a,h.frozenColCount,g-h.rightFrozenColCount,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,h.isPivotChart()?"rowHeader":"body",h)),h.rightFrozenColCount>0&&(wk(d,s,a,h.colCount-1-h.rightFrozenColCount+1,h.colCount-1,0,h.frozenRowCount-1,"columnHeader",h),wk(r,s,a,h.colCount-1-h.rightFrozenColCount+1,h.colCount-1,h.frozenRowCount,p-h.bottomFrozenRowCount,h.isPivotChart()?"rowHeader":"body",h)),h.bottomFrozenRowCount>0&&h.rightFrozenColCount>0&&wk(u,s,a,h.colCount-1-h.rightFrozenColCount+1,h.colCount-1,h.rowCount-1-h.bottomFrozenRowCount+1,h.rowCount-1,"body",h),g-h.rightFrozenColCount>=h.frozenColCount&&wk(n,s,a,h.frozenColCount,g-h.rightFrozenColCount,h.frozenRowCount,p-h.bottomFrozenRowCount,"body",h),n.firstChild||e.firstChild||t.firstChild||i.firstChild?(l.currentRow=n.firstChild?.rowNumber??i.firstChild?.rowNumber??l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=n.lastChild?.col??e.lastChild?.col??i.lastChild?.col??t.lastChild?.col??l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}(t,e,i,r,o,n,s,a,this)}async progress(){if(!this.isProgressing)return this.isProgressing=!0,new Promise(((t,e)=>{setTimeout((async()=>{this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(await this.updateColCellGroupsAsync(),await this.progress()):this.rowUpdatePos<=this.rowEnd?(await this.updateRowCellGroupsAsync(),await this.progress()):this.currentCol<this.totalCol?(await this.createCol(),await this.progress()):this.currentRow<this.totalRow&&(await this.createRow(),await this.progress()),Nk(this.table),this.table.scenegraph.updateNextFrame(),t())}),16)}))}async createRow(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)}async createCol(){this.taskColCount&&this.createColGroup(this.taskRowCount)}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if("adaptive"!==this.table.heightMode&&NP(this.table,this.currentRow+1,e,!1),this.rowEnd=e,this.table.frozenColCount){let t=0;for(let i=0;i<this.table.frozenColCount;i++){const r=this.table.scenegraph.getColGroup(i);this.table.isListTable();const{height:o}=mk(r,i,r.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);t=Math.max(t,o),this.table.scenegraph.rowHeaderGroup.setAttribute("height",t)}}if(this.table.rightFrozenColCount){let t=0;for(let i=this.table.colCount-this.table.rightFrozenColCount;i<this.table.colCount;i++){const r=this.table.scenegraph.getColGroup(i);this.table.isPivotChart();const{height:o}=mk(r,i,r.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);t=Math.max(t,o),this.table.scenegraph.rightFrozenGroup.setAttribute("height",t)}}let i=0;for(let t=this.bodyLeftCol;t<=this.bodyRightCol;t++){const r=this.table.scenegraph.getColGroup(t);if(!r)continue;this.table.rowHeaderLevelCount;const{height:o}=mk(r,t,r.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);i=Math.max(i,o)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);"adaptive"!==this.table.widthMode&&lk(this.table,this.currentCol+1,e),this.colEnd=e;for(let t=0;t<this.table.rowCount;t++){const e=this.highPerformanceGetCell(this.currentCol,t);"cell"===e.role&&Xx(e.mergeStartCol)&&e.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(e.col,e.row)}if(this.table.frozenRowCount){const t=this.table.scenegraph.colHeaderGroup.lastChild instanceof $M?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,r=t.attribute.y;wk(this.table.scenegraph.colHeaderGroup,i,r,this.currentCol+1,e,0,this.table.frozenRowCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const t=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof $M?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,i=t.attribute.x+t.attribute.width,r=t.attribute.y;wk(this.table.scenegraph.bottomFrozenGroup,i,r,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof $M?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof $M?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const r=i.attribute.x+i.attribute.width,o=i.attribute.y;wk(this.table.scenegraph.bodyGroup,r,o,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}async setY(t,e=!1){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,r=this.table.getAllRowsHeight()-i,o=this.table.getTargetRowAt(t+this.table.scenegraph.colHeaderGroup.attribute.height);o&&(this.screenTopRow=o.row),t<i&&this.rowStart===this.bodyTopRow||t>r&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&"group"===this.table.scenegraph.bodyGroup.firstChild.type&&0!==this.table.scenegraph.bodyGroup.firstChild.childrenCount||this.table.scenegraph.rowHeaderGroup.firstChild&&"group"===this.table.scenegraph.rowHeaderGroup.firstChild.type&&0!==this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount?this.dynamicSetY(t,o,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))}async setX(t,e=!1){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,r=this.table.getAllColsWidth()-i,o=this.table.getTargetColAt(t+this.table.scenegraph.rowHeaderGroup.attribute.width);o&&(this.screenLeftCol=o.col),t<i&&this.colStart===this.bodyLeftCol||t>r&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&"group"===this.table.scenegraph.bodyGroup.firstChild.type&&0===this.table.scenegraph.bodyGroup.firstChild.childrenCount?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,o,e)}async dynamicSetY(t,e,i=!1){Lk(t,e,i,this)}async dynamicSetX(t,e,i=!1){Ak(t,e,i,this)}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}async updateRowCellGroupsAsync(){this.updateCellGroups(this.taskRowCount)}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);this.table.isAutoRowHeight(this.rowUpdatePos)&&NP(this.table,this.rowUpdatePos,e,!1),Ok(this.rowUpdatePos,e,this),this.table.isAutoRowHeight(this.rowUpdatePos)&&(Ek(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),Ek(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),Ek(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;this.table.isAutoRowHeight(t)&&NP(this.table,t,e,!1),Ok(t,e,this),this.table.isAutoRowHeight(t)&&(Ek(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),Ek(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),Ek(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;"autoWidth"===this.table.widthMode&&lk(this.table,t,e,!1),Hk(t,e,this),this.table.isAutoRowHeight(this.rowStart)&&_k(t,e,this.table,this.colUpdateDirection)}async updateColCellGroupsAsync(){this.updateColGroups(this.taskRowCount)}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);"autoWidth"===this.table.widthMode&&lk(this.table,this.colUpdatePos,e),Hk(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||"cell"!==t.role)return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}async sortCellVertical(){await async function(t){let e,i;t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,t?.forEachChildren((t=>{t.needUpdate=!0})))})),t.table.isAutoRowHeight(t.rowStart)?(e=t.rowStart,i=t.rowEnd):(e=Math.max(t.bodyTopRow,t.screenTopRow-1*t.screenRowCount),i=Math.min(t.bodyBottomRow,t.screenTopRow+2*t.screenRowCount,t.table.rowCount-1));const r=t.table.getAllRowsHeight();NP(t.table,e,i);const o=t.table.getAllRowsHeight();r!==o&&t.table.scenegraph.updateContainerHeight(t.table.frozenRowCount,o-r);for(let e=0;e<(t.table.frozenColCount??0);e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}Ok(e,i,t),t.table.isAutoRowHeight(e)&&Ek(t.bodyLeftCol,t.bodyRightCol,e,i,t.table,t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up"),t.rowUpdatePos=t.rowStart,t.rowUpdateDirection=t.rowEnd>t.bodyBottomRow-(t.rowEnd-t.rowStart+1)?"down":"up",t.table.scenegraph.updateNextFrame(),t.table.isAutoRowHeight(t.rowStart)||await t.progress()}(this)}async sortCellHorizontal(){await async function(t){t.table.scenegraph.bodyGroup.forEachChildren(((t,e)=>{"group"===t.type&&(t.needUpdate=!0,t?.forEachChildren((t=>{t.needUpdate=!0})))}));const e=Math.max(t.bodyLeftCol,t.screenLeftCol-1*t.screenColCount),i=Math.min(t.bodyRightCol,t.screenLeftCol+2*t.screenColCount);lk(t.table,e,i);for(let e=t.colStart;e<=t.colEnd;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}for(let e=t.table.colCount-t.table.rightFrozenColCount;e<t.table.colCount;e++){const i=t.table.scenegraph.getColGroup(e);i?.setAttribute("chartInstance",void 0);for(let i=t.rowStart;i<=t.rowEnd;i++)t.table.scenegraph.updateCellContent(e,i);for(let i=t.table.rowCount-t.table.bottomFrozenRowCount;i<t.table.rowCount;i++)t.table.scenegraph.updateCellContent(e,i)}Hk(e,i,t),t.colUpdatePos=t.colStart,t.colUpdateDirection=t.colEnd>t.bodyRightCol-(t.colEnd-t.colStart+1)?"right":"left",t.table.scenegraph.updateNextFrame(),await t.progress()}(this)}highPerformanceGetCell(t,e,i){if(e>=this.table.frozenRowCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd))return fk;if(t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return fk;if(this.cellCache.get(t)){const r=this.cellCache.get(t);if((r._next||r._prev)&&Math.abs(r.row-e)<e){let o=Xk(r,e);return o&&(i||"shadow-cell"!==o.role)||(o=this.table.scenegraph.getCell(t,e,i)),o.row&&this.cellCache.set(t,o),o}const o=this.table.scenegraph.getCell(t,e,i);return o.col===t&&o.row&&this.cellCache.set(t,o),o}const r=this.table.scenegraph.getCell(t,e,i);return r.col===t&&r.row&&this.cellCache.set(t,r),r}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if("cell"===t.role){const e=t.attribute.y;this.deltaY=-e}}else if(this.rowEnd===this.bodyBottomRow){const t=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if("cell"===t.role){const e=t.attribute.y+t.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-e}}else if(Wx(e)&&Wx(i)){let r=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);"cell"!==r.role&&(r=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const o=t-this.deltaY,n=e-o,s=r.attribute.y-o+this.table.getFrozenRowsHeight();this.deltaY=n-s}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const t=this.table.scenegraph.getColGroup(this.colStart);if(t){const e=t.attribute.x;this.deltaX=-e}}else if(this.colEnd===this.bodyRightCol){const t=this.table.scenegraph.getColGroup(this.colEnd);if(t){const e=t.attribute.x+t.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-e}}else if(Wx(e)&&Wx(i)){const r=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),o=t-this.deltaX,n=e-o,s=r.attribute.x-o+this.table.getFrozenColsWidth();this.deltaX=n-s}}release(){this.isRelease=!0}}function Xk(t,e){if(!t)return null;if(t.row===e)return t;const i=t._prev,r=t._next;return t.row>e&&i&&i.row===t.row-1?Xk(i,e):t.row<e&&r&&r.row===t.row+1?Xk(r,e):null}function Yk(t){t.customSelectedRangeComponents.forEach(((e,i)=>{qk(e,i,t)})),t.selectingRangeComponents.forEach(((e,i)=>{qk(e,i,t)})),t.selectedRangeComponents.forEach(((e,i)=>{qk(e,i,t)}))}function qk(t,e,i){const r=i.table,[o,n,s,a]=e.split("-"),l=parseInt(o,10),h=parseInt(n,10),c=parseInt(s,10),d=parseInt(a,10);let u,g=l,p=h,f=c,m=d;switch(t.role){case"rowHeader":u=r.getBodyVisibleRowRange(),u&&(p=Math.max(h,u.rowStart-1),m=Math.min(d,u.rowEnd+1));break;case"columnHeader":case"bottomFrozen":u=r.getBodyVisibleCellRange(),u&&(g=Math.max(l,u.colStart-1),f=Math.min(c,u.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":u=r.getBodyVisibleCellRange(),u&&(p=Math.max(h,u.rowStart-1),m=Math.min(d,u.rowEnd+1));break;default:u=r.getBodyVisibleCellRange(),u&&(p=Math.max(h,u.rowStart-1),m=Math.min(d,u.rowEnd+1),g=Math.max(l,u.colStart-1),f=Math.min(c,u.colEnd+1))}const b=r.getColsWidth(g,f),y=r.getRowsHeight(p,m),C=i.highPerformanceGetCell(g,p).globalAABBBounds;if(t.rect.setAttributes({x:C.x1-i.tableGroup.attribute.x,y:C.y1-i.tableGroup.attribute.y,width:b,height:y,visible:!0}),t.fillhandle){const e=i.table.options.excelOptions?.fillHandle;let o,n=!0;"function"==typeof e&&(n=e({selectRanges:i.table.stateManager.select.ranges,table:i.table})),o=f<r.colCount-1?i.highPerformanceGetCell(f,m).globalAABBBounds:i.highPerformanceGetCell(g-1,m).globalAABBBounds;const s=o.x2-i.tableGroup.attribute.x-3;o=m<r.rowCount-1?i.highPerformanceGetCell(f,m).globalAABBBounds:i.highPerformanceGetCell(f,p-1).globalAABBBounds;const a=o.y2-i.tableGroup.attribute.y-3;t.fillhandle?.setAttributes({x:s,y:a,width:6,height:6,visible:n})}let w=!!r.frozenColCount&&l===r.frozenColCount;if(!w&&r.frozenColCount&&r.scrollLeft>0&&l>=r.frozenColCount){r.getColsWidth(0,l-1)-r.scrollLeft<r.getFrozenColsWidth()&&(w=!0)}let v=!!r.rightFrozenColCount&&(r.rightFrozenColCount>0&&c===r.colCount-r.rightFrozenColCount-1);if(!v&&r.rightFrozenColCount&&c<r.colCount-r.rightFrozenColCount){r.getColsWidth(0,c)-r.scrollLeft>r.tableNoFrameWidth-r.getRightFrozenColsWidth()&&(v=!0)}let x=!r.frozenRowCount||h===r.frozenRowCount;if(!x&&r.frozenRowCount&&r.scrollTop>0&&h>=r.frozenRowCount){r.getRowsHeight(0,h-1)-r.scrollTop<r.getFrozenRowsHeight()&&(x=!0)}let _=!!r.bottomFrozenRowCount&&d===r.rowCount-r.bottomFrozenRowCount-1;if(!_&&r.bottomFrozenRowCount&&d<r.rowCount-r.bottomFrozenRowCount){r.getRowsHeight(0,d)-r.scrollTop>r.tableNoFrameHeight-r.getBottomFrozenRowsHeight()&&(_=!0)}const{dynamicUpdateSelectionSize:S}=r.theme.selectionStyle;if(w&&(t.rect.attribute.stroke[3]||S)||v&&(t.rect.attribute.stroke[1]||S)||x&&(t.rect.attribute.stroke[0]||S)||_&&(t.rect.attribute.stroke[2]||S)){if(w&&t.rect.attribute.stroke[3]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.cornerHeaderGroup:"bottomFrozen"===t.role?i.leftBottomCornerGroup:i.rowHeaderGroup),_&&t.rect.attribute.stroke[2]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.leftBottomCornerGroup:"rightFrozen"===t.role?i.rightBottomCornerGroup:i.bottomFrozenGroup),x&&t.rect.attribute.stroke[0]&&i.tableGroup.insertAfter(t.rect,"rowHeader"===t.role?i.cornerHeaderGroup:"rightFrozen"===t.role?i.rightTopCornerGroup:i.colHeaderGroup),v&&t.rect.attribute.stroke[1]&&i.tableGroup.insertAfter(t.rect,"columnHeader"===t.role?i.rightTopCornerGroup:"bottomFrozen"===t.role?i.rightBottomCornerGroup:i.rightFrozenGroup),t.rect.attribute.x<r.getFrozenColsWidth()&&r.scrollLeft>0&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=t.rect.attribute.width-(r.getFrozenColsWidth()-t.rect.attribute.x);t.rect.setAttributes({x:t.rect.attribute.x+(r.getFrozenColsWidth()-t.rect.attribute.x),width:e>0?e:0}),t.fillhandle?.setAttributes({visible:e>0})}if(r.getRightFrozenColsWidth()>0&&i.rightFrozenGroup.attribute.height>0&&t.rect.attribute.x+t.rect.attribute.width>i.rightFrozenGroup.attribute.x&&("body"===t.role||"columnHeader"===t.role||"bottomFrozen"===t.role)){const e=i.rightFrozenGroup.attribute.x-t.rect.attribute.x;t.rect.setAttributes({x:t.rect.attribute.x,width:e>0?e:0}),t.fillhandle?.setAttributes({visible:e-b>0})}if(t.rect.attribute.y<i.colHeaderGroup.attribute.height&&r.scrollTop>0&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=t.rect.attribute.height-(i.colHeaderGroup.attribute.height-t.rect.attribute.y);t.rect.setAttributes({y:t.rect.attribute.y+(i.colHeaderGroup.attribute.height-t.rect.attribute.y),height:e>0?e:0}),t.fillhandle?.setAttributes({visible:e>0})}if(i.bottomFrozenGroup.attribute.width>0&&i.bottomFrozenGroup.attribute.height>0&&t.rect.attribute.y+t.rect.attribute.height>i.bottomFrozenGroup.attribute.y&&("body"===t.role||"rowHeader"===t.role||"rightFrozen"===t.role)){const e=i.bottomFrozenGroup.attribute.y-t.rect.attribute.y;t.rect.setAttributes({y:t.rect.attribute.y,height:e>0?e:0}),t.fillhandle?.setAttributes({visible:e-y>0})}}else i.tableGroup.insertAfter(t.rect,"body"===t.role?i.bodyGroup:"columnHeader"===t.role?i.colHeaderGroup:"rowHeader"===t.role?i.rowHeaderGroup:"cornerHeader"===t.role?i.cornerHeaderGroup:"rightTopCorner"===t.role?i.rightTopCornerGroup:"rightFrozen"===t.role?i.rightFrozenGroup:"leftBottomCorner"===t.role?i.leftBottomCornerGroup:"bottomFrozen"===t.role?i.bottomFrozenGroup:i.rightBottomCornerGroup);let A=0;"number"==typeof t.rect.attribute.lineWidth&&(A=Math.ceil(t.rect.attribute.lineWidth/2)),c===r.colCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(A=Math.ceil((t.rect.attribute.lineWidth[1]??0)/2)),t.rect.setAttributes({width:t.rect.attribute.width-A})),0===l&&(Array.isArray(t.rect.attribute.lineWidth)&&(A=Math.ceil((t.rect.attribute.lineWidth[3]??0)/2)),t.rect.setAttributes({x:t.rect.attribute.x+A,width:t.rect.attribute.width-A})),d===r.rowCount-1&&(Array.isArray(t.rect.attribute.lineWidth)&&(A=Math.ceil((t.rect.attribute.lineWidth[2]??0)/2)),t.rect.setAttributes({height:t.rect.attribute.height-A})),0===h&&(Array.isArray(t.rect.attribute.lineWidth)&&(A=Math.ceil((t.rect.attribute.lineWidth[0]??0)/2)),t.rect.setAttributes({y:t.rect.attribute.y+A,height:t.rect.attribute.height-A}))}function Zk(t,e,i=!0){const r=t.table,o=e.start.col,n=e.start.row,s=e.end.col,a=e.end.row,l=e.skipBodyMerge;let h=Math.max(Math.min(s,o),0),c=Math.max(Math.min(a,n),0),d=Math.min(Math.max(s,o),r.colCount-1),u=Math.min(Math.max(a,n),r.rowCount-1);const g=()=>{let t=!1;for(let e=h;e<=d;e++){if(e===h)for(let i=c;i<=u;i++){if(!r.isHeader(e,i)&&l)continue;const o=CA(r,e,i);if(o&&o.start.col<h){h=o.start.col,t=!0;break}}if(!t&&e===d)for(let i=c;i<=u;i++){if(!r.isHeader(e,i)&&l)continue;const o=CA(r,e,i);if(o&&Math.min(o.end.col,r.colCount-1)>d){d=o.end.col,t=!0;break}}if(t)break}if(!t)for(let e=c;e<=u;e++){if(e===c)for(let i=h;i<=d;i++){if(!r.isHeader(i,e)&&l)continue;const o=CA(r,i,e);if(o&&o.start.row<c){c=o.start.row,t=!0;break}}if(!t&&e===u)for(let i=h;i<=d;i++){if(!r.isHeader(i,e)&&l)continue;const o=CA(r,i,e);if(o&&Math.min(o.end.row,r.rowCount-1)>u){u=o.end.row,t=!0;break}}if(t)break}t&&g()};i&&(g(),e.start.col>e.end.col?(e.start.col=Math.max(h,d),e.end.col=Math.min(h,d)):(e.start.col=Math.min(h,d),e.end.col=Math.max(h,d)),e.start.row>e.end.row?(e.start.row=Math.max(c,u),e.end.row=Math.min(c,u)):(e.start.row=Math.min(c,u),e.end.row=Math.max(c,u))),t.selectingRangeComponents.forEach(((t,e)=>{t.rect.delete(),t.fillhandle?.delete()})),t.selectingRangeComponents=new Map;let p=!1,f=!1,m=!1,b=!1,y=!1,C=!1,w=!1,v=!1,x=!1;if(h<=r.frozenColCount-1&&c<=r.frozenRowCount-1&&(C=!0),d>=r.colCount-r.rightFrozenColCount&&c<=r.frozenRowCount-1&&(w=!0),h<=r.frozenColCount-1&&u>=r.rowCount-r.bottomFrozenRowCount&&(x=!0),d>=r.colCount-r.rightFrozenColCount&&u>=r.rowCount-r.bottomFrozenRowCount&&(v=!0),h<=r.frozenColCount-1&&u>=r.frozenRowCount&&c<=r.rowCount-r.bottomFrozenRowCount-1&&(p=!0),d>=r.colCount-r.rightFrozenColCount&&u>=r.frozenRowCount&&c<=r.rowCount-r.bottomFrozenRowCount-1&&(f=!0),c<=r.frozenRowCount-1&&d>=r.frozenColCount&&h<=r.colCount-r.rightFrozenColCount-1&&(m=!0),u>=r.rowCount-r.bottomFrozenRowCount&&d>=r.frozenColCount&&h<=r.colCount-r.rightFrozenColCount-1&&(b=!0),h<=r.colCount-r.rightFrozenColCount-1&&d>=r.frozenColCount&&c<=r.rowCount-r.bottomFrozenRowCount-1&&u>=r.frozenRowCount&&(y=!0),C){const e=Math.min(d,r.frozenColCount-1),i=Math.min(u,r.frozenRowCount-1),o=[!0,!m,!p,!0];t.createCellSelectBorder(h,c,e,i,"cornerHeader",`${h}${c}${d}${u}`,o)}if(w){const e=Math.max(h,r.colCount-r.rightFrozenColCount),i=Math.min(u,r.frozenRowCount-1),o=[!0,!0,!f,!m];t.createCellSelectBorder(e,c,d,i,"rightTopCorner",`${h}${c}${d}${u}`,o)}if(x){const e=Math.min(d,r.frozenColCount-1),i=Math.max(c,r.rowCount-r.bottomFrozenRowCount),o=[!p,!b,!0,!0];t.createCellSelectBorder(h,i,e,u,"leftBottomCorner",`${h}${c}${d}${u}`,o)}if(v){const e=Math.max(h,r.colCount-r.rightFrozenColCount),i=Math.max(c,r.rowCount-r.bottomFrozenRowCount),o=[!f,!0,!0,!b];t.createCellSelectBorder(e,i,d,u,"rightBottomCorner",`${h}${c}${d}${u}`,o)}if(m){const e=Math.max(h,r.frozenColCount),i=Math.min(d,r.colCount-r.rightFrozenColCount-1),o=Math.min(u,r.frozenRowCount-1),n=[!0,!w,!y,!C];t.createCellSelectBorder(e,c,i,o,"columnHeader",`${h}${c}${d}${u}`,n)}if(b){const e=Math.max(h,r.frozenColCount),i=Math.min(d,r.colCount-r.rightFrozenColCount-1),o=Math.max(c,r.rowCount-r.bottomFrozenRowCount),n=[!y,!v,!0,!x];t.createCellSelectBorder(e,o,i,u,"bottomFrozen",`${h}${c}${d}${u}`,n)}if(p){const e=Math.max(c,r.frozenRowCount),i=Math.min(u,r.rowCount-r.bottomFrozenRowCount-1),o=Math.min(d,r.frozenColCount-1),n=[!C,!y,!x,!0];t.createCellSelectBorder(h,e,o,i,"rowHeader",`${h}${c}${d}${u}`,n)}if(f){const e=Math.max(c,r.frozenRowCount),i=Math.min(u,r.rowCount-r.bottomFrozenRowCount-1),o=Math.max(h,r.colCount-r.rightFrozenColCount),n=[!w,!0,!v,!y];t.createCellSelectBorder(o,e,d,i,"rightFrozen",`${h}${c}${d}${u}`,n)}if(y){const e=Math.max(h,r.frozenColCount),i=Math.max(c,r.frozenRowCount),o=Math.min(d,r.colCount-r.rightFrozenColCount-1),n=Math.min(u,r.rowCount-r.bottomFrozenRowCount-1),s=[!m,!f,!b,!p];t.createCellSelectBorder(e,i,o,n,"body",`${h}${c}${d}${u}`,s)}}function Jk(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)}))}function Qk(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)})),t.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)}))}function tE(t,e,i,r,o,n,s){if(!e)return;const a=Array.isArray(e)?e:[e,e,e,e],l=s.colCount-1,h=s.rowCount-1,c=[0,0,0,0];let d=!1;return 0===i&&0===r?(c[0]=a[0],d=!0):o===l&&n===h?(c[2]=a[2],d=!0):0===i&&n===h?(c[3]=a[3],d=!0):o===l&&0===r&&(c[1]=a[1],d=!0),d?c:void 0}function eE(t){t.selectingRangeComponents.forEach(((e,i)=>{t.selectedRangeComponents.get(i)&&(t.selectingRangeComponents.get(i).rect.delete(),t.selectingRangeComponents.get(i).fillhandle?.delete()),t.selectedRangeComponents.set(i,e)})),t.selectingRangeComponents=new Map,t.updateNextFrame()}function iE(t){t.selectedRangeComponents.forEach(((t,e)=>{t.rect.delete(),t.fillhandle?.delete()})),t.selectedRangeComponents=new Map}function rE(t){t.selectingRangeComponents.forEach(((t,e)=>{t.rect.delete(),t.fillhandle?.delete()})),t.selectingRangeComponents=new Map}function oE(t,e,i,r,o){Kk(r)&&Wk(r);const n=r.scenegraph,s=cS(t.map((t=>t.row))).sort(((t,e)=>e-t)),a=cS(e.map((t=>t.row))).sort(((t,e)=>t-e)),l=cS(i.map((t=>t.row))).sort(((t,e)=>t-e));let h;if(l.length){h=lE(l[0]-1,l[l.length-1]+1,n)}if(a.length){const t=lE(a[0]-1,a[a.length-1]+1,n);h=Wx(h)?Wx(t)?Math.min(h,t):h:t}if(s.length){const t=lE(s[0]-1,s[s.length-1]+1,n);h=Wx(h)?Wx(t)?Math.min(h,t):h:t}s.forEach((t=>{!function(t,e,i){const r=e.proxy;t>=r.rowStart&&t<=r.rowEnd&&(sE(t,e),r.rowEnd--,r.currentRow--);if(!i){r.bodyBottomRow--;const t=Math.min(r.rowLimit,r.bodyBottomRow-r.bodyTopRow+1);r.totalActualBodyRowCount=t,r.totalRow=Math.min(r.table.rowCount-1,r.rowStart+t-1)}}(t,n,o)}));const c=r.rowHeightsMap;if(s.forEach((t=>{c.delete(t)})),s.length){!function(t){function e(e,i){e.row=i;const r=CA(t.table,e.col,e.row);r?(e.mergeStartCol=r.start.col,e.mergeEndCol=r.end.col,e.mergeStartRow=r.start.row,e.mergeEndRow=r.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let r=t.bodyRowStart;i?.forEachChildren((t=>{e(t,r),r++}))})),t.rowHeaderGroup.forEachChildren((i=>{let r=t.bodyRowStart;i?.forEachChildren((t=>{e(t,r),r++}))})),t.rightFrozenGroup.forEachChildren((i=>{let r=t.bodyRowStart;i?.forEachChildren((t=>{e(t,r),r++}))})),t.bottomFrozenGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount;i?.forEachChildren((t=>{e(t,r),r++}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount;i?.forEachChildren((t=>{e(t,r),r++}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount;i?.forEachChildren((t=>{e(t,r),r++}))}))}(n);const t=aE(s[s.length-1]-1,s[0]-s.length+1,n);h=Wx(h)?Wx(t)?Math.min(h,t):h:t}let d;if(n.table._clearRowRangeHeightsMap(),a.forEach((t=>{const e=function(t,e,i){const r=e.proxy;if(!i){r.bodyBottomRow++;const t=Math.min(r.rowLimit,r.bodyBottomRow-r.bodyTopRow+1);r.totalActualBodyRowCount=t,r.totalRow=r.rowStart+t-1}if(t<r.rowStart)return;if(t>r.rowEnd)return r.rowEnd-r.rowStart+1<r.rowLimit?(r.rowEnd++,r.currentRow++,nE(t,e),t):void 0;if(r.rowEnd-r.rowStart+1<r.rowLimit)return r.rowEnd++,r.currentRow++,nE(t,e),t;return t}(t,n,o);d=d??e,c.insert(t)})),function(t){function e(e,i,r){e.row=i,e.setAttribute("y",r);const o=CA(t.table,e.col,e.row);o?(e.mergeStartCol=o.start.col,e.mergeEndCol=o.end.col,e.mergeStartRow=o.start.row,e.mergeEndRow=o.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}t.bodyGroup.forEachChildren((i=>{let r=t.bodyRowStart,o=t.getCellGroupY(r);i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.rowHeaderGroup.forEachChildren((i=>{let r=t.bodyRowStart,o=t.getCellGroupY(r);i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.rightFrozenGroup.forEachChildren((i=>{let r=t.bodyRowStart,o=t.getCellGroupY(r);i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.bottomFrozenGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.leftBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))})),t.rightBottomCornerGroup.forEachChildren((i=>{let r=t.table.rowCount-t.table.bottomFrozenRowCount,o=0;i?.forEachChildren((t=>{e(t,r,o),r++,o+=t.attribute.height}))}))}(n),a.length){const t=aE(a[0]-1,a[a.length-1]+1,n);h=Wx(h)?Wx(t)?Math.min(h,t):h:t}const u=new Set;for(let t=0;t<r.colCount;t++)l.forEach((e=>{if(e<r.frozenRowCount){const i=CA(n.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++){const i=`${t}-${e}`;u.has(i)||(CP(t,e,n.table,!1),u.add(i))}else CP(t,e,n.table,!1)}else if(e>r.rowCount-1||e<n.table.rowCount-n.table.bottomFrozenRowCount&&(e<n.proxy.rowStart||e>n.proxy.rowEnd))sE(e,n);else{const i=CA(n.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++){const i=`${t}-${e}`;u.has(i)||(CP(t,e,n.table,!1),u.add(i))}else CP(t,e,n.table,!1)}}));if(l.length){const t=aE(l[0]-1,l[l.length-1]+1,n);h=Wx(h)?Wx(t)?Math.min(h,t):h:t}if(Xx(d)){for(let t=0;t<Math.max(r.colCount,r.internalProps._oldColCount??r.colCount);t++)for(let e=d;e<Math.max(r.rowCount,r.internalProps._oldRowCount??r.rowCount);e++){const i=n.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}h=Wx(h)?Wx(d)?Math.min(h,d):h:d}if(Xx(h)&&(n.proxy.rowUpdatePos=Math.min(n.proxy.rowUpdatePos,h)),a.length){if(!Xx(d)){const t=Math.min(...a);n.proxy.rowUpdatePos=Math.min(t,n.proxy.rowUpdatePos)}n.proxy.rowUpdateDirection="up",n.proxy.updateCellGroups(2*n.proxy.screenRowCount),p()}else s.length&&(!function(t,e){if(e.table.isHasSeriesNumber())for(let i=t;i<=e.table.rowCount-1;i++)CP(0,i,e.table,!1)}(s[s.length-1],n),n.proxy.updateCellGroups(2*n.proxy.screenRowCount),p());n.proxy.progress();const g=r.getRowsHeight(r.frozenRowCount,r.rowCount-1-r.bottomFrozenRowCount);function p(){if(a?.[a?.length-1]>=r.rowCount-r.bottomFrozenRowCount||l?.[l?.length-1]>=r.rowCount-r.bottomFrozenRowCount||s?.[0]>=r.rowCount-r.bottomFrozenRowCount){for(let t=0;t<r.colCount;t++)for(let e=r.rowCount-r.bottomFrozenRowCount;e<r.rowCount;e++){const i=n.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}n.proxy.updateBottomFrozenCellGroups()}}n.updateContainerHeight(n.table.frozenRowCount,g-n.bodyGroup.attribute.height)}function nE(t,e){for(let i=0;i<e.table.colCount;i++){const r=new $M({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(t)});if(r.role="cell",r.col=i,r.row=t,r.needUpdate=!0,!r)continue;const o=e.getColGroup(i);if(o)if(o.firstChild&&t<o.firstChild.row)o.insertBefore(r,o.firstChild),o.firstChild.row=o.firstChild.row+1;else if(o.lastChild&&t>o.lastChild.row)o.appendChild(r);else{const n=e.highPerformanceGetCell(i,t,!0);n!==r&&(o.insertBefore(r,n),n&&(n.row=n.row+1),n!==o.lastChild&&o.lastChild&&(o.lastChild.row=o.lastChild.row+1))}}}function sE(t,e){for(let i=0;i<e.table.colCount;i++){const r=e.getColGroup(i,!1);if(!r)continue;let o;r.forEachChildren((e=>e.row===t&&(o=e,!0))),o&&(r.updateColumnHeight(-o.attribute.height),r.removeChild(o))}}function aE(t,e,i){let r;for(let o=0;o<i.table.colCount;o++){const n=i.table.getCellRange(o,t);let s;n.start.row<=t+1&&n.end.row>=t+1&&(hE(n,i),s=n.start.row);const a=i.table.getCellRange(o,e);a.start.row<=e+1&&a.end.row>=e+1&&(hE(a,i),s=a.start.row),Wx(s)&&(r=Wx(r)?Math.min(r,s):s)}return r}function lE(t,e,i){let r;for(let o=0;o<i.table.colCount;o++){let n;const s=i.highPerformanceGetCell(o,t);s.mergeStartRow&&s.mergeEndRow&&s.mergeEndRow>t&&(hE({start:{row:s.mergeStartRow,col:i.table.isAutoRowHeight(e)?0:s.mergeStartCol},end:{row:s.mergeEndRow,col:i.table.isAutoRowHeight(e)?i.table.colCount-1:s.mergeEndCol}},i),n=s.mergeStartRow);const a=i.highPerformanceGetCell(o,e);a.mergeStartRow&&a.mergeEndRow&&a.mergeStartRow<e&&(hE({start:{row:a.mergeStartRow,col:i.table.isAutoRowHeight(e)?0:a.mergeStartCol},end:{row:a.mergeEndRow,col:i.table.isAutoRowHeight(e)?i.table.colCount-1:a.mergeEndCol}},i),n=a.mergeStartRow),Wx(n)&&(r=Wx(r)?Math.min(r,n):n)}return r}function hE(t,e){const{start:i,end:r}=t;for(let t=i.col;t<=r.col;t++)for(let o=i.row;o<=r.row;o++){const i=e.highPerformanceGetCell(t,o,!0);i&&(i.needUpdate=!0)}}function cE(t){if(!t.table.reactCustomLayout)return;const{table:e,stage:i}=t,r=i.pluginService.findPluginsByName("ReactAttributePlugin")[0],{htmlMap:o,renderId:n}=r;for(const s in o){const a=o[s],{graphic:l,wrapContainer:h,renderId:c}=a;if(c!==n)continue;let d;if(t.frozenColCount>e.frozenColCount){const i=LM(l);if(!i)continue;const{col:r,row:o}=i;o>=e.rowCount-e.bottomFrozenRowCount&&r<t.frozenColCount&&r>=e.frozenColCount&&l.attribute.react.container===e.frozenBottomDomContainer?d=e.bottomDomContainer:o>=e.frozenRowCount&&r<t.frozenColCount&&r>=e.frozenColCount&&l.attribute.react.container===e.frozenBodyDomContainer?d=e.bodyDomContainer:o<e.frozenRowCount&&r<t.frozenColCount&&r>=e.frozenColCount&&l.attribute.react.container===e.frozenHeaderDomContainer&&(d=e.headerDomContainer)}else if(t.frozenColCount<e.frozenColCount){const i=LM(l);if(!i)continue;const{col:r,row:o}=i;o>=e.rowCount-e.bottomFrozenRowCount&&r<e.frozenColCount&&r>=t.frozenColCount&&l.attribute.react.container===e.bottomDomContainer?d=e.frozenBottomDomContainer:o>=e.frozenRowCount&&r<e.frozenColCount&&r>=t.frozenColCount&&l.attribute.react.container===e.bodyDomContainer?d=e.frozenBodyDomContainer:o<e.frozenRowCount&&r<e.frozenColCount&&r>=t.frozenColCount&&l.attribute.react.container===e.headerDomContainer&&(d=e.frozenHeaderDomContainer)}d&&(d.appendChild(h),a.nativeContainer=d,a.container=d,l.attribute.react.container=d,r.updateStyleOfWrapContainer(l,i,h,d,l.attribute.react))}}function dE(t){const e=t.bodyGroup.firstChild instanceof $M?t.bodyGroup.firstChild:null;e&&(t.rowHeaderGroup.appendChild(e),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width+e.attribute.width),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width-e.attribute.width))}function uE(t){const e=t.colHeaderGroup.firstChild instanceof $M?t.colHeaderGroup.firstChild:null;e&&(t.cornerHeaderGroup.appendChild(e),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width+e.attribute.width),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width-e.attribute.width))}function gE(t){const e=t.rowHeaderGroup.lastChild instanceof $M?t.rowHeaderGroup.lastChild:t.rowHeaderGroup.lastChild?._prev;e&&(bE(t.bodyGroup,e,t.bodyGroup.firstChild),t.bodyGroup.setAttribute("width",t.bodyGroup.attribute.width+e.attribute.width),t.rowHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width-e.attribute.width))}function pE(t){const e=t.cornerHeaderGroup.lastChild instanceof $M?t.cornerHeaderGroup.lastChild:t.cornerHeaderGroup.lastChild?._prev;e&&(bE(t.colHeaderGroup,e,t.colHeaderGroup.firstChild),t.colHeaderGroup.setAttribute("width",t.colHeaderGroup.attribute.width+e.attribute.width),t.cornerHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width-e.attribute.width))}function fE(t){const e=t.bottomFrozenGroup.firstChild instanceof $M?t.bottomFrozenGroup.firstChild:null;e&&(t.leftBottomCornerGroup.appendChild(e),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width+e.attribute.width),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width-e.attribute.width),t.table.isPivotChart()&&e.forEachChildren((t=>{t.setAttributes({stroke:!1,fill:!1})})))}function mE(t){const e=t.leftBottomCornerGroup.lastChild instanceof $M?t.leftBottomCornerGroup.lastChild:t.leftBottomCornerGroup.lastChild?._prev;e&&(bE(t.bottomFrozenGroup,e,t.bottomFrozenGroup.firstChild),t.bottomFrozenGroup.setAttribute("width",t.bottomFrozenGroup.attribute.width+e.attribute.width),t.leftBottomCornerGroup.setAttribute("width",t.leftBottomCornerGroup.attribute.width-e.attribute.width),t.table.isPivotChart()&&e.forEachChildren((e=>{const i=t.table._getCellStyle(e.col,e.row),r=t.table.getCellRange(e.col,e.row),o=ZB(i,t.table,r?r.start.col:e.col,r?r.start.row:e.row,qM).theme;e.setAttributes({fill:o?.group?.fill??void 0,stroke:o?.group?.stroke??void 0})})))}function bE(t,e,i){e&&t&&(i?t.insertBefore(e,i):t.appendChild(e))}function yE(t){let e=!1;for(let i=0;i<t.bodyGroup.childrenCount;i++){const r=t.bodyGroup.children[i];if(!SE(r))continue;const o=r.firstChild;t.colHeaderGroup.children[i]?.appendChild(o),e||(t.colHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height+o.attribute.height),t.bodyGroup.setAttribute("height",t.bodyGroup.attribute.height-o.attribute.height),e=!0)}}function CE(t){let e=!1;for(let i=0;i<t.rowHeaderGroup.childrenCount;i++){const r=t.rowHeaderGroup.children[i];if(!SE(r))continue;const o=r.firstChild;t.cornerHeaderGroup.children[i]?.appendChild(o),e||(t.cornerHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height+o.attribute.height),t.rowHeaderGroup.setAttribute("height",t.rowHeaderGroup.attribute.height-o.attribute.height),e=!0)}}function wE(t){let e=!1;for(let i=0;i<t.rightFrozenGroup.childrenCount;i++){const r=t.rightFrozenGroup.children[i];if(!SE(r))continue;const o=r.firstChild;t.rightTopCornerGroup.children[i]?.appendChild(o),e||(t.rightTopCornerGroup.setAttribute("height",t.rightTopCornerGroup.attribute.height+o.attribute.height),t.rightFrozenGroup.setAttribute("height",t.rightFrozenGroup.attribute.height-o.attribute.height),e=!0)}}function vE(t){let e=!1;for(let i=0;i<t.colHeaderGroup.childrenCount;i++){const r=t.colHeaderGroup.children[i];if(!SE(r))continue;const o=t.bodyGroup.children[i];if(!o)continue;const n=r.lastChild;bE(o,n,o.firstChild),e||(t.colHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height-n.attribute.height),t.bodyGroup.setAttribute("height",t.bodyGroup.attribute.height+n.attribute.height),e=!0)}}function xE(t){let e=!1;for(let i=0;i<t.cornerHeaderGroup.childrenCount;i++){const r=t.cornerHeaderGroup.children[i];if(!SE(r))continue;const o=t.rowHeaderGroup.children[i];if(!o)continue;const n=r.lastChild;bE(o,n,o.firstChild),e||(t.cornerHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height-n.attribute.height),t.rowHeaderGroup.setAttribute("height",t.rowHeaderGroup.attribute.height+n.attribute.height),e=!0)}}function _E(t){let e=!1;for(let i=0;i<t.rightTopCornerGroup.childrenCount;i++){const r=t.rightTopCornerGroup.children[i];if(!SE(r))continue;const o=t.rightFrozenGroup.children[i];if(!o)continue;const n=r.lastChild;bE(o,n,o.firstChild),e||(t.rightTopCornerGroup.setAttribute("height",t.rightTopCornerGroup.attribute.height-n.attribute.height),t.rightFrozenGroup.setAttribute("height",t.rightFrozenGroup.attribute.height+n.attribute.height),e=!0)}}function SE(t){return t instanceof $M&&"table-border-rect"!==t?.name}function AE(t){for(let e=t.proxy.colStart;e<=t.proxy.colEnd;e++){const i=t.getColGroup(e);i?.getChildren()?.forEach((t=>{t.children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.addUpdateBoundTag())}))}))}}function TE(t,e){t.forEachChildren((t=>{"column"===t.role&&t.forEachChildren((t=>{if("cell"===t.role){let i=!1;if(t.forEachChildren((t=>"axis"===t.name&&(i=!0,!0))),i){const i=e.internalProps.layoutMap.getAxisConfigInPivotChart(t.col,t.row),r=pB(qM("padding",e._getCellStyle(t.col,t.row),t.col,t.row,e)),o=new(wA.getComponent("axis"))(i,t.attribute.width,t.attribute.height,i.__vtablePadding??r,e);t.clear(),t.appendChild(o.component),o.overlap()}}}))}))}function RE(t,e,i){t.forEachChildren((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.setAttributes({width:Math.ceil(e-t.attribute.cellPadding[3]-t.attribute.cellPadding[1]),height:Math.ceil(i-t.attribute.cellPadding[0]-t.attribute.cellPadding[2])}))}))}function BE(t,e,i){return new $M({x:0,y:0,width:t,height:e,clip:i??!1,pickable:!1})}function ME(t,e){return t.forEachChildrenSkipChild(((t,i)=>{t.setAttribute("x",e),e+=t.attribute.width})),e}function PE(t,e,i,r,o){const n=t.name;EE(i,r,(t=>t.name===n),(t=>{iP(e,t),t.name=e.name}),o),o.updateNextFrame()}function HE(t){const{col:e,row:i,iconMark:r,order:o,oldSortCol:n,oldSortRow:s,oldIconMark:a,scene:l}=t,h=l.table.internalProps.headerHelper.getSortIcon(o,l.table,e,i);if(r&&PE(r,h,e,i,l),!function(t,e,i,r,o){const n=o.getCellRange(t,e),s=o.getCellRange(i,r);return n.start.col===s.start.col&&n.start.row===s.start.row&&n.end.col===s.end.col&&n.end.row===s.end.row}(e,i,n,s,l.table)){const t=l.table.internalProps.headerHelper.getSortIcon("normal",l.table,n,s);a?PE(a,t,n,s,l):function(t,e,i,r){const o=r.getCell(t,e);if(Wx(o.mergeStartCol)&&Wx(o.mergeStartRow)&&Wx(o.mergeEndCol)&&Wx(o.mergeEndRow))for(let t=o.mergeStartCol;t<=o.mergeEndCol;t++)for(let e=o.mergeStartRow;e<=o.mergeEndRow;e++){let o;r.getCell(t,e).forEachChildren((t=>"sort"===t.attribute.funcType&&(o=t,!0))),o&&(iP(i,o),o.name=i.name)}else{let t;dS(o,"children",(e=>"sort"===e.attribute.funcType&&(t=e,!0))),t&&(iP(i,t),t.name=i.name)}}(n,s,t,l)}}function kE(t,e,i){t&&"empty"!==t.role&&t.forEachChildren((t=>{"group"===t.type?kE(t,e,i):e(t)&&i(t)}))}function EE(t,e,i,r,o){const n=o.getCell(t,e);if("cell"===n.role&&Wx(n.mergeStartCol)&&Wx(n.mergeStartRow)&&Wx(n.mergeEndCol)&&Wx(n.mergeEndRow)){const{colStart:t,colEnd:e,rowStart:s,rowEnd:a}=XP(n,o);for(let n=t;n<=e;n++)for(let t=s;t<=a;t++)kE(o.highPerformanceGetCell(n,t),i,r)}else kE(n,i,r)}function FE(t,e){const{bgColor:i,borderColor:r,borderLineWidth:o,borderLineDash:n}=e,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:i};return s.stroke=dH(r,void 0),s.lineWidth=o,n&&(s.lineDash=n),s.lineCap="butt",Array.isArray(r)&&(s.strokeArrayColor=pB(r)),Array.isArray(o)&&(s.strokeArrayWidth=pB(o),s.lineWidth=1),t.setAttributes(s),t.role="corner-frozen",t}function LE(t,e,i,r){Kk(r)&&Wk(r);const o=r.scenegraph,n=IE(t.map((t=>t.col))).sort(((t,e)=>e-t)),s=IE(e.map((t=>t.col))).sort(((t,e)=>t-e)),a=IE(i.map((t=>t.col))).sort(((t,e)=>t-e));n.forEach((t=>{!function(t,e){const i=e.proxy;if(t>=e.table.rowHeaderLevelCount)if(t>=e.table.colCount-e.table.rightFrozenColCount);else{const i=e.getColGroup(t,!1);i&&i.parent===e.bodyGroup&&e.bodyGroup.removeChild(i);const r=e.getColGroupInBottom(t);r&&r.parent===e.bottomFrozenGroup&&e.bottomFrozenGroup.removeChild(r);const o=e.getColGroup(t,!0);o&&o.parent===e.colHeaderGroup&&e.colHeaderGroup.removeChild(o)}t>=i.colStart&&t<=i.colEnd&&(i.colEnd--,i.currentCol--);i.bodyRightCol--;const r=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);i.totalActualBodyColCount=r,i.totalCol=i.colStart+r-1}(t,o)}));const l=r.colWidthsMap;let h;n.forEach((t=>{l.delAndReorder(t)})),n.length&&zE(o),o.table._clearColRangeWidthsMap(),s.forEach((t=>{const e=function(t,e){const i=e.proxy;i.bodyRightCol++;const r=Math.min(i.colLimit,i.bodyRightCol-i.bodyLeftCol+1);if(i.totalActualBodyColCount=r,i.totalCol=i.colStart+r-1,t<i.colStart)return;if(t>i.colEnd)return i.colEnd-i.colStart+1<i.colLimit?(i.colEnd++,i.currentCol++,OE(t,e),t):void 0;if(i.colEnd-i.colStart+1<i.colLimit)return i.colEnd++,i.currentCol++,OE(t,e),t;return t}(t,o);zE(o),h=h??e,l.addAndReorder(t)})),function(t){let e=t.bodyColStart,i=t.getCellGroupX(e);function r(i){i.col=e;const r=CA(t.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.colHeaderGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.bodyColStart,i=t.getCellGroupX(e),t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightFrozenGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightTopCornerGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++})),e=t.table.colCount-t.table.rightFrozenColCount,i=0,t.rightBottomCornerGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{r(t)})),t.setAttribute("x",i),i+=t.attribute.width,e++}))}(o);const c=new Set;if(a.forEach((t=>{for(let e=0;e<r.rowCount;e++){const i=CA(o.table,t,e);if(i)for(let t=i.start.col;t<=i.end.col;t++)for(let t=i.start.col;t<=i.end.col;t++){const i=`${t}-${e}`;c.has(i)||(CP(t,e,o.table,!1),c.add(i))}else CP(t,e,o.table,!1)}})),Xx(h)){for(let t=h;t<Math.max(r.colCount,r.internalProps._oldColCount??r.colCount);t++)for(let e=0;e<Math.max(r.rowCount,r.internalProps._oldRowCount??r.rowCount);e++){const i=o.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}o.proxy.colUpdatePos=h}if(s.length){if(!Xx(h)){const t=Math.min(...s);o.proxy.colUpdatePos=t}o.proxy.colUpdateDirection="left",o.proxy.updateColGroups(2*o.proxy.screenColCount),u(),o.proxy.progress()}else n.length&&(o.proxy.updateColGroups(2*o.proxy.screenColCount),u(),o.proxy.progress());const d=r.getColsWidth(r.frozenColCount,r.colCount-1);function u(){if(s?.[s?.length-1]>=r.colCount-r.rightFrozenColCount||a?.[a?.length-1]>=r.colCount-r.rightFrozenColCount||n?.[0]>=r.colCount-r.rightFrozenColCount){for(let t=r.colCount-r.rightFrozenColCount;t<r.colCount;t++)for(let e=0;e<r.rowCount;e++){const i=o.highPerformanceGetCell(t,e,!0);i&&(i.needUpdate=!0)}o.proxy.updateRightFrozenCellGroups()}}o.updateContainerWidth(o.table.frozenColCount,d-o.bodyGroup.attribute.width)}function IE(t){const e=[];for(let i=0;i<t.length;i++)-1===e.indexOf(t[i])&&e.push(t[i]);return e}function zE(t){let e=t.bodyColStart;function i(i){i.col=e;const r=CA(t.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}t.bodyGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.colHeaderGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{i(t)})),e++})),e=t.bodyColStart,t.bottomFrozenGroup.forEachChildren((t=>{t.col=e,t?.forEachChildren((t=>{i(t)})),e++}))}function OE(t,e){if(e.colHeaderGroup&&e.table.columnHeaderLevelCount>0){const r=new $M({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});r.role="column",r.col=t;const o=e.getColGroup(t,!0);o?e.colHeaderGroup.insertBefore(r,o):e.colHeaderGroup.appendChild(r),i(r,t,0,e.table.columnHeaderLevelCount-1)}if(e.bodyGroup){const r=new $M({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});r.role="column",r.col=t;const o=e.getColGroup(t,!1);o?e.bodyGroup.insertBefore(r,o):e.bodyGroup.appendChild(r),i(r,t,e.bodyRowStart,e.bodyRowEnd)}if(e.bottomFrozenGroup&&e.table.bottomFrozenRowCount>0){const r=new $M({x:0,y:0,width:e.table.getColWidth(t),height:0,clip:!1,pickable:!1});r.role="column",r.col=t;const o=e.getColGroupInBottom(t);o?e.bottomFrozenGroup.insertBefore(r,o):e.bottomFrozenGroup.appendChild(r),i(r,t,e.table.rowCount-e.table.bottomFrozenRowCount,e.table.rowCount-1)}function i(t,i,r,o){for(let n=r;n<=o;n++){const r=new $M({x:0,y:0,width:e.table.getColWidth(i),height:e.table.getRowHeight(n)});r.role="cell",r.col=i,r.row=n,r.needUpdate=!0,t.appendChild(r)}}}Ax(),so.load(ak),so.load(kP);class DE{proxy;tableGroup;colHeaderGroup;cornerHeaderGroup;rowHeaderGroup;bodyGroup;rightFrozenGroup;bottomFrozenGroup;rightTopCornerGroup;leftBottomCornerGroup;rightBottomCornerGroup;componentGroup;selectedRangeComponents;selectingRangeComponents;customSelectedRangeComponents;lastSelectId;component;stage;table;isPivot;hasFrozen;frozenColCount;frozenRowCount;clear;mergeMap;_dealAutoFillHeightOriginRowsHeight;_needUpdateContainer=!1;constructor(t){var e;let i,r;var o;this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,e=this.table.theme.textPopTipStyle,Ht(Hy.poptip,Py,e),"node"===X_.mode?(ju.setEnv("node",t.options.modeParams),i=t.canvasWidth,r=t.canvasHeight):t.options.canvas&&t.options.viewBox?(ju.setEnv("browser"),i=t.options.viewBox.x2-t.options.viewBox.x1,r=t.options.viewBox.y2-t.options.viewBox.y1):(ju.setEnv("browser"),i=t.canvas.width,r=t.canvas.height),this.stage=(o={canvas:t.canvas,width:i,height:r,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,beforeRender:t=>{this.table.options.beforeRender&&this.table.options.beforeRender(t),this.table.animationManager.ticker.start()},afterRender:t=>{this.table.options.afterRender&&this.table.options.afterRender(t),this.table.fireListeners("after_render",null)},canvasControled:!t.options.canvas,viewBox:t.options.viewBox,...t.options.renderOption},new ng(o)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){return this.tableGroup.attribute?.width??0}get height(){return this.tableGroup.attribute?.height??0}get x(){return this.tableGroup.attribute?.x??0}get y(){return this.tableGroup.attribute?.y??0}get bodyRowStart(){return this.proxy.rowStart??0}get bodyRowEnd(){return this.proxy.rowEnd??this.table.rowCount-1}get bodyColStart(){return this.proxy.colStart??0}get bodyColEnd(){return this.proxy.colEnd??this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),function(t){const e=t.table.tableNoFrameWidth,i=t.table.tableNoFrameHeight;t.tableGroup=new $M({x:0,y:0,width:e,height:i,clip:!0,pickable:!1}),t.tableGroup.role="table";const r=BE(0,0,!t.table.internalProps.enableTreeStickCell);r.role="col-header",t.colHeaderGroup=r;const o=BE(0,0,!t.table.options.enableTreeStickCell);o.role="corner-header",t.cornerHeaderGroup=o;const n=BE(0,0,!0);n.role="row-header",t.rowHeaderGroup=n;const s=BE(e,0,!0);s.role="body",t.bodyGroup=s;const a=BE(0,0,!0);a.role="right-frozen",t.rightFrozenGroup=a;const l=BE(0,0,!0);l.role="bottom-frozen",t.bottomFrozenGroup=l;const h=BE(0,0);h.role="component",t.componentGroup=h;const c=BE(0,0,!0);c.role="corner-right-top-header",t.rightTopCornerGroup=c;const d=BE(0,0,!0);d.role="corner-right-bottom-header",t.rightBottomCornerGroup=d;const u=BE(0,0,!0);u.role="corner-left-bottom-header",t.leftBottomCornerGroup=u,t.tableGroup.addChild(s),t.tableGroup.addChild(n),t.tableGroup.addChild(l),t.tableGroup.addChild(r),t.tableGroup.addChild(a),t.tableGroup.addChild(d),t.tableGroup.addChild(c),t.tableGroup.addChild(u),t.tableGroup.addChild(o),t.tableGroup.addChild(h)}(this)}clearCells(){this.table.animationManager.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach((t=>{t.deactivate(this.stage.pluginService)})),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),delete this.colHeaderGroup.border,this.rowHeaderGroup.clear(),delete this.rowHeaderGroup.border,this.cornerHeaderGroup.clear(),delete this.cornerHeaderGroup.border,this.bodyGroup.clear(),delete this.bodyGroup.border,this.bottomFrozenGroup.clear(),delete this.bottomFrozenGroup.border,this.rightFrozenGroup.clear(),delete this.rightFrozenGroup.border,this.rightTopCornerGroup.clear(),delete this.rightTopCornerGroup.border,this.rightBottomCornerGroup.clear(),delete this.rightBottomCornerGroup.border,this.leftBottomCornerGroup.clear(),delete this.leftBottomCornerGroup.border,this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),this.proxy?.release(),this.table.reactCustomLayout?.clearCache()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new lH(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map,this.customSelectedRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(t=!1){t||(this.table.rowHeightsMap.clear(),this.table.internalProps.layoutMap.clearCellRangeMap()),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach((t=>{"poptipForText"===t.name&&this.stage.pluginService.register(t)})),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.frozenRowCount,this.proxy=new $k(this.table),hH(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(FE(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),FE(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),FE(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){let r;if(r=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?this.rightTopCornerGroup.getColGroup(t)?.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?this.leftBottomCornerGroup.getColGroup(t)?.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?this.rightBottomCornerGroup.getColGroup(t)?.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t)?.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?this.bottomFrozenGroup.getColGroup(t)?.getRowGroup(e):this.getColGroup(t,e<this.frozenRowCount)?.getRowGroup(e),r&&"shadow-cell"===r.role&&!i){const i=this.table.getCellRange(t,e);i.start.col===t&&i.start.row===e||(r=this.getCell(i.start.col,i.start.row))}return r||fk}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t,e=!1){let i;return i=t<this.frozenColCount&&e?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):e?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),i||void 0}getColGroupInBottom(t,e=!1){if(e){const e=this.getColGroupInLeftBottomCorner(t)??this.getColGroupInRightBottomCorner(t);if(e)return e}if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),r=CA(this.table,t,e);let o=i.attribute.width,n=i.attribute.height;return r&&(o/=r.end.col-r.start.col+1,n/=r.end.row-r.start.row+1),{width:o,height:n}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){(this.table.stateManager.select?.ranges?.length>0||this.table.stateManager.select?.customSelectRanges?.length>0)&&Yk(this)}hideHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(EE(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0);const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1)}),i),i.updateNextFrame())}(t,e,this)}showHoverIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(EE(t,e,(t=>"mouseenter_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}hideClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(EE(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",0)}),i),i.updateNextFrame())}(t,e,this)}showClickIcon(t,e){!function(t,e,i){-1!==t&&-1!==e&&(EE(t,e,(t=>"click_cell"===t.attribute.visibleTime),(t=>{t.setAttribute("opacity",1)}),i),i.updateNextFrame())}(t,e,this)}getIcon(t,e,i,r){return function(t,e,i,r,o){let n;return o.getCell(t,e).forEachChildren((t=>{t.role&&t.role.startsWith("icon")&&t.containsPoint(i,r,Ci.GLOBAL)&&(n=t)})),n}(t,e,i,r,this)}setIconHoverStyle(t,e,i,r){!function(t,e,i,r,o){if((t.attribute.backgroundColor||t.attribute.hoverImage)&&EE(e,i,(e=>e.name===t.name),(t=>{if(t.attribute.backgroundColor){let e=t.parent.getChildByName("icon-back");e?e.setAttributes({x:(t.attribute.x??0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(t.attribute.y??0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:t.attribute.dx??0,dy:t.attribute.dy??0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,visible:!0}):(e=hh({x:(t.attribute.x??0)+(t.AABBBounds.width()-t.backgroundWidth)/2,y:(t.attribute.y??0)+(t.AABBBounds.height()-t.backgroundHeight)/2,dx:t.attribute.dx??0,dy:t.attribute.dy??0,width:t.backgroundWidth,height:t.backgroundHeight,fill:t.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),e.name="icon-back"),t.parent.insertBefore(e,t)}t.attribute.hoverImage&&t.attribute.image!==t.attribute.hoverImage&&(t.image=t.attribute.hoverImage)}),o),t.tooltip){const{x1:r,x2:n,y1:s,y2:a}=t.globalAABBBounds,l={content:t.tooltip.title,referencePosition:{rect:{left:r,right:n,top:s,bottom:a,width:t.globalAABBBounds.width(),height:t.globalAABBBounds.height()},placement:t.tooltip.placement},disappearDelay:t.tooltip.disappearDelay,style:Object.assign({},o.table.internalProps.theme?.tooltipStyle,t.tooltip?.style)};o.table.internalProps.tooltipHandler.isBinded(l)||o.table.showTooltip(e,i,l)}}(t,e,i,0,this)}updateSortIcon(t){const{col:e,row:i,iconMark:r,order:o,oldSortCol:n,oldSortRow:s,oldIconMark:a}=t;HE({col:e,row:i,iconMark:r,order:o,oldSortCol:n,oldSortRow:s,oldIconMark:a,scene:this})}updateFrozenIcon(t,e){!function(t){for(let e=0;e<t.table.colCount;e++)for(let i=0;i<t.table.columnHeaderLevelCount;i++)EE(e,i,(t=>"frozen"===t.attribute.funcType),(r=>{const o=t.table.internalProps.headerHelper.getFrozenIcon(e,i);iP(o,r),r.name=o.name}),t)}(this)}updateHierarchyIcon(t,e){!function(t,e,i){let r;r=i.table.isHeader(t,e)?i.table.internalProps.headerHelper.getHierarchyIcon(t,e):i.table.internalProps.bodyHelper.getHierarchyIcon(t,e),EE(t,e,(t=>t.attribute.funcType===Fx.collapse||t.attribute.funcType===Fx.expand),(t=>{iP(r,t),t.name=r.name}),i)}(t,e,this)}setIconNormalStyle(t,e,i){!function(t,e,i,r){(t.attribute.backgroundColor||t.attribute.hoverImage)&&EE(e,i,(e=>e.name===t.name),(t=>{const e=t.parent.getChildByName("icon-back");e&&e.setAttribute("visible",!1),t.attribute.hoverImage&&t.attribute.image!==t.attribute.originImage&&(t.image=t.attribute.originImage)}),r)}(t,e,i,this)}residentHoverIcon(t,e){!function(t,e,i){EE(t,e,(t=>t.attribute.funcType===Fx.dropDown),(t=>{t.oldVisibleTime=t.attribute.visibleTime,t.setAttribute("visibleTime","always"),t.setAttribute("opacity",1)}),i)}(t,e,this)}resetResidentHoverIcon(t,e){!function(t,e,i){EE(t,e,(t=>t.attribute.funcType===Fx.dropDown),(t=>{t.oldVisibleTime&&t.setAttribute("visibleTime",t.oldVisibleTime),t.setAttribute("opacity","always"===t.attribute.visibleTime?1:0)}),i)}(t,e,this)}deactivateChart(t,e){if(-1===t||-1===e)return;const i=this.getCell(t,e);i?.firstChild?.deactivate?.()}activateChart(t,e){if(-1===t||-1===e)return;const i=this.getCell(t,e);return i?.firstChild?.activate?.(this.table),i?.firstChild?.activeChartInstance}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,r,o,n,s){!function(t,e,i,r,o,n,s,a){let l=!!t.table.options.excelOptions?.fillHandle;if(t.table.stateManager.select.ranges?.length>1)l=!1,t.removeFillHandleFromSelectComponents();else if(1===t.table.stateManager.select.ranges?.length){const e=Math.max(t.table.stateManager.select.ranges[0].start.row,t.table.stateManager.select.ranges[0].end.row),i=Math.max(t.table.stateManager.select.ranges[0].start.col,t.table.stateManager.select.ranges[0].end.col);t.table.isHeader(i,e)&&(l=!1)}!Array.isArray(a)||!1!==a[1]&&!1!==a[2]||(l=!1);const h=Math.min(e,r),c=Math.min(i,o),d=Math.max(e,r),u=Math.max(i,o),g=t.highPerformanceGetCell(h,c).globalAABBBounds,p=t.highPerformanceGetCell(d,u).globalAABBBounds,f=t.table.theme,m=f.selectionStyle?.cellBorderColor,b=f.selectionStyle?.cellBorderLineWidth,y=hh({pickable:!1,fill:"replace"!==f.selectionStyle?.selectionFillMode&&(f.selectionStyle?.cellBgColor??"rgba(0, 0, 255,0.1)"),lineWidth:b,stroke:a.map((t=>!!t&&m)),x:g.x1-t.tableGroup.attribute.x,y:g.y1-t.tableGroup.attribute.y,width:0,height:0,visible:!0,cornerRadius:tE(0,t.table.theme.frameStyle?.cornerRadius,e,i,r,o,t.table)});let C;l&&(C=hh({pickable:!1,fill:m,stroke:m,x:p.x2-3,y:p.y2-3,width:6,height:6,visible:!0})),t.lastSelectId=s,t.selectingRangeComponents.set(`${h}-${c}-${d}-${u}-${s}`,{rect:y,fillhandle:C,role:n}),t.tableGroup.insertAfter(y,"body"===n?t.bodyGroup:"columnHeader"===n?t.colHeaderGroup:"rowHeader"===n?t.rowHeaderGroup:"cornerHeader"===n?t.cornerHeaderGroup:"rightTopCorner"===n?t.rightTopCornerGroup:"rightFrozen"===n?t.rightFrozenGroup:"leftBottomCorner"===n?t.leftBottomCornerGroup:"bottomFrozen"===n?t.bottomFrozenGroup:t.rightBottomCornerGroup),l&&t.tableGroup.insertAfter(C,"body"===n?t.bodyGroup:"columnHeader"===n?t.colHeaderGroup:"rowHeader"===n?t.rowHeaderGroup:"cornerHeader"===n?t.cornerHeaderGroup:"rightTopCorner"===n?t.rightTopCornerGroup:"rightFrozen"===n?t.rightFrozenGroup:"leftBottomCorner"===n?t.leftBottomCornerGroup:"bottomFrozen"===n?t.bottomFrozenGroup:t.rightBottomCornerGroup)}(this,t,e,i,r,o,n,s)}moveSelectingRangeComponentsToSelectedRangeComponents(){eE(this)}deleteLastSelectedRangeComponents(){var t;(t=this).selectedRangeComponents.forEach(((e,i)=>{i.split("-")[4]===t.lastSelectId&&(e.rect.delete(),e.fillhandle?.delete(),t.selectedRangeComponents.delete(i))}))}deleteAllSelectBorder(){iE(this),rE(this)}updateCellSelectBorder(t,e=!0){Zk(this,t,e)}removeFillHandleFromSelectComponents(){this.selectedRangeComponents.forEach(((t,e)=>{t.fillhandle?.delete(),t.fillhandle=void 0}))}recreateAllSelectRangeComponents(){iE(this),this.table.stateManager.select.ranges.forEach((t=>{Zk(this,t),eE(this)}))}updateColWidth(t,e,i,r){!function(t,e,i,r){r||t.table._setColWidth(e,t.table.getColWidth(e)+i,!0);const o=t.getColGroup(e,!0),n=t.getColGroupInRightTopCorner(e);o&&!n&&JP(o,i,"col-corner",t),n&&JP(n,i,"right-top",t);const s=t.getColGroup(e);s&&JP(s,i,"row-body",t);const a=t.getColGroupInLeftBottomCorner(e);a&&JP(a,i,"left-bottom",t);const l=t.getColGroupInBottom(e);l&&JP(l,i,"bottom",t);const h=t.getColGroupInRightBottomCorner(e);h&&JP(h,i,"right-bottom",t),e<t.frozenColCount?(t.cornerHeaderGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.rowHeaderGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))):(t.colHeaderGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),t.bodyGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))),a&&t.leftBottomCornerGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),l&&t.bottomFrozenGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)})),h&&t.rightBottomCornerGroup.forEachChildrenSkipChild(((t,r)=>{t.col>e&&t.setAttribute("x",t.attribute.x+i)}))}(this,t,Math.round(e),r),i||this.updateContainer(!0)}updateChartSizeForResizeColWidth(t){!function(t,e){const{table:i}=t,r=i.internalProps.layoutMap,o=-1===e?"all":i.internalProps.columnResizeType;if("column"===o){const r=t.getColGroup(e),o=t.getColGroup(e,!0),n=t.getColGroupInBottom(e,!0);if(r?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),o?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),n?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),"adaptive"===i.widthMode&&e<i.colCount-1){const r=t.getColGroup(e+1),o=t.getColGroup(e+1,!0),n=t.getColGroupInBottom(e+1,!0);r?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),o?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),n?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))}))}}else{let n,s,a,l=i.rowHeaderLevelCount,h=i.colCount-1;if("indicator"===o)if(r.indicatorsAsCol)n=r.getIndicatorKey(e,i.columnHeaderLevelCount);else{const t=r.getCellHeaderPaths(e,i.columnHeaderLevelCount-1),o=t.colHeaderPaths[t.colHeaderPaths.length-1];s=o.dimensionKey,a=o.value}else if("indicatorGroup"===o){const t=i.internalProps.layoutMap,e=t.getCellHeaderPaths(i.stateManager.columnResize.col,i.columnHeaderLevelCount),r=t.getHeadNodeByRowOrColDimensions(e.colHeaderPaths.slice(0,e.colHeaderPaths.length-1));l=r.startInTotal+i.frozenColCount,h=r.startInTotal+i.frozenColCount+r.size-1}for(let e=l;e<=h;e++){const l=t.getColGroup(e),h=t.getColGroup(e,!0),c=t.getColGroupInBottom(e,!0);if(l){if("indicator"===o){const t=r.getIndicatorKey(e,i.columnHeaderLevelCount);if(r.indicatorsAsCol&&t!==n)continue;if(!r.indicatorsAsCol){const t=r.getCellHeaderPaths(e,i.columnHeaderLevelCount-1),o=t?.colHeaderPaths[t.colHeaderPaths.length-1];if(!o||s!==o.dimensionKey||a!==o.value)continue}}l.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),h?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))})),c?.forEachChildren((t=>{RE(t,i.getColWidth(t.col),i.getRowHeight(t.row))}))}}}}(this,t)}updateChartSizeForResizeRowHeight(t){!function(t,e){const{table:i}=t,r=i.internalProps.layoutMap,o=i.stateManager,n=-1===e?"all":i.internalProps.rowResizeType;let s,a,l,h=i.columnHeaderLevelCount,c=i.rowCount-1;if("indicator"===n)if(r.indicatorsAsCol){const t=r.getCellHeaderPaths(i.rowHeaderLevelCount-1,e),o=t.rowHeaderPaths?.[t.rowHeaderPaths.length-1];a=o?.dimensionKey,l=o?.value}else s=r.getIndicatorKey(i.rowHeaderLevelCount,e);else if("indicatorGroup"===n){const t=i.internalProps.layoutMap,r=t.getCellHeaderPaths(i.rowHeaderLevelCount,e),o=t.getHeadNodeByRowOrColDimensions(r.rowHeaderPaths.slice(0,r.rowHeaderPaths.length-1));h=o.startInTotal+i.frozenRowCount,c=o.startInTotal+i.frozenRowCount+o.size-1}const d=[{startCol:t.proxy.colStart,endCol:t.proxy.colEnd}];i.frozenColCount&&d.push({startCol:0,endCol:i.frozenColCount-1}),i.rightFrozenColCount&&d.push({startCol:i.colCount-i.rightFrozenColCount,endCol:i.colCount-1}),d.forEach((({startCol:d,endCol:u})=>{for(let g=d;g<=u;g++)if("row"===n){const r=t.highPerformanceGetCell(g,e);if("cell"!==r.role)continue;if(RE(r,i.getColWidth(r.col),i.getRowHeight(r.row)),"adaptive"===i.heightMode&&e<i.rowCount-1){const r=t.highPerformanceGetCell(g,e+1);RE(r,i.getColWidth(r.col),i.getRowHeight(r.row))}}else for(let e=h;e<=c;e++){if("indicator"===n){const t=r.getIndicatorKey(o.table.rowHeaderLevelCount,e);if(!r.indicatorsAsCol&&t!==s)continue;if(r.indicatorsAsCol){const t=r.getCellHeaderPaths(o.table.rowHeaderLevelCount-1,e),i=t?.rowHeaderPaths[t.rowHeaderPaths.length-1];if(!i||a!==i.dimensionKey||l!==i.value)continue}}const h=t.highPerformanceGetCell(g,e);"cell"===h.role&&RE(h,i.getColWidth(h.col),i.getRowHeight(h.row))}}))}(this,t)}updateChartState(t){this.table.isPivotChart()&&function(t,e){const i=t.table;if(i.isPivotChart()){const r=i._selectedDataItemsInChart.length;if((null===e||0===e?.length||0===Object.keys(e).length)&&0===r)return;const o=[];if(Array.isArray(e))e.forEach((t=>{if(t&&0!==t.key&&Object.keys(t).length>0){const e={};for(const i in t)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(e[i]=t[i]);o.push(e)}}));else if(e&&0!==e.key&&Object.keys(e).length>0){const t={};for(const i in e)i.startsWith("VGRAMMAR_")||i.startsWith("__VCHART")||(t[i]=e[i]);o.push(t)}h_(i._selectedDataItemsInChart,o)||(i._selectedDataItemsInChart=o,i.internalProps.layoutMap.updateDataStateToChartInstance(),AE(t),i.scenegraph.updateNextFrame())}}(this,t)}updateCheckboxCellState(t,e,i){if(this.table.transpose)this.bodyGroup.children?.forEach((t=>{t.getChildAt(e)?.getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}));else{const e=this.getColGroup(t);e?.children?.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}))}}updateHeaderCheckboxCellState(t,e,i){if(this.table.transpose)this.rowHeaderGroup.children?.forEach((t=>{t.getChildAt(e).getChildren().forEach((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}));else{const e=this.getColGroup(t,!0);e.children?.forEach((t=>{t.getChildren().find((t=>{"checkbox"===t.name&&("indeterminate"===i?(t.setAttribute("indeterminate",!0),t.setAttribute("checked",void 0)):(t.setAttribute("indeterminate",void 0),t.setAttribute("checked",i))),"checkbox-content"===t.name&&("indeterminate"===i?(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(t._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),t._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}))}}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=hk(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){const t=this.table;"adaptive"===t.widthMode||t.autoFillWidth||t.internalProps.transpose?lk(this.table,0,this.table.colCount-1,!0):(t._clearColRangeWidthsMap(),t.frozenColCount>0&&lk(this.table,0,t.frozenColCount-1,!0),t.rightFrozenColCount>0&&lk(this.table,t.rightFrozenColCount,t.colCount-1,!0),lk(t,this.proxy.colStart,this.proxy.colEnd,!0))}recalculateRowHeights(){const t=this.table;t.internalProps.useOneRowHeightFillAll=!1,"adaptive"===t.heightMode||t.autoFillHeight?NP(this.table,0,this.table.rowCount-1,!0,!0):(t.frozenRowCount>0&&NP(this.table,0,t.frozenRowCount-1,!0,!0),t.bottomFrozenRowCount>0&&NP(this.table,t.bottomFrozenRowCount,t.rowCount-1,!0,!0),NP(t,this.proxy.rowStart,this.proxy.rowEnd,!0,!0))}resize(){this.proxy.resize(),("adaptive"===this.table.widthMode||this.table.autoFillWidth)&&(0===this.table.internalProps._widthResizedColMap.size?this.recalculateColWidths():this.dealWidthMode()),"adaptive"===this.table.heightMode?0===this.table.internalProps._heightResizedRowMap.size?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),("adaptive"===this.table.widthMode||"adaptive"===this.table.heightMode||this.table.autoFillWidth||this.table.autoFillHeight||this.table.containerFit?.width||this.table.containerFit?.height)&&this.updateChartSizeForResizeColWidth(-1),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){const t=Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0),e=Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0);let i=t,r=e;if(i=this.table.containerFit?.width?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,t),r=this.table.containerFit?.height?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,e),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:i,height:r}),this.tableGroup.border){const t=this.tableGroup.border?.attribute;let e,i,r,o;t?.strokeArrayWidth?(e=t.strokeArrayWidth?t.strokeArrayWidth[0]:t.lineWidth??0,i=t.strokeArrayWidth?t.strokeArrayWidth[1]:t.lineWidth??0,r=t.strokeArrayWidth?t.strokeArrayWidth[2]:t.lineWidth??0,o=t.strokeArrayWidth?t.strokeArrayWidth[3]:t.lineWidth??0):(e=t?.lineWidth??0,i=t?.lineWidth??0,r=t?.lineWidth??0,o=t?.lineWidth??0),"rect"===this.tableGroup.border.type?this.table.theme.frameStyle?.innerBorder?this.tableGroup.border.setAttributes({x:this.table.tableX+o/2,y:this.table.tableY+e/2,width:this.tableGroup.attribute.width-o/2-i/2,height:this.tableGroup.attribute.height-e/2-r/2}):this.tableGroup.border.setAttributes({x:this.table.tableX-o/2,y:this.table.tableY-e/2,width:this.tableGroup.attribute.width+o/2+i/2,height:this.tableGroup.attribute.height+e/2+r/2}):"group"===this.tableGroup.border.type&&(this.table.theme.frameStyle?.innerBorder?(this.tableGroup.border.setAttributes({x:this.table.tableX+o/2,y:this.table.tableY+e/2,width:this.tableGroup.attribute.width-o/2-i/2,height:this.tableGroup.attribute.height-e/2-r/2}),this.tableGroup.border.firstChild?.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-o/2-i/2,height:this.tableGroup.attribute.height-e/2-r/2})):(this.tableGroup.border.setAttributes({x:this.table.tableX-o/2,y:this.table.tableY-e/2,width:this.tableGroup.attribute.width+o/2+i/2,height:this.tableGroup.attribute.height+e/2+r/2}),this.tableGroup.border.firstChild?.setAttributes({x:o/2,y:e/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height})))}this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()})),this.updateDomContainer()}updateRowHeight(t,e,i){YP(this,t,e=Math.round(e),i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let r=0;r<t.length;r++){const o=t[r];if(o>=this.proxy.rowStart&&o<=this.proxy.rowEnd){const t=e[r];YP(this,o,Math.round(t),i),this._updateContainerHeight(o,t)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1||t<this.table.frozenRowCount)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t,e=!1){this.table.scenegraph.proxy.setX(-t,e)}setY(t,e=!1){this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){const e=this.bodyGroup.firstChild?.firstChild??this.rowHeaderGroup.firstChild?.firstChild,i=this.bodyGroup.firstChild?.lastChild??this.rowHeaderGroup.firstChild?.lastChild;0===t&&e&&e.row===this.table.frozenRowCount&&e.attribute.y+t<0?t=-e.attribute.y:i&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&i.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&i.attribute.y+i.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-i.attribute.y-i.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;0===t&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),Nk(this.table),this.table.options.animationAppear&&function(t){if(!t.options.animationAppear)return;let e,i,r,o;!0===t.options.animationAppear?(e=500,i=0,r="one-by-one",o="column"):(e=t.options.animationAppear.duration??500,i=t.options.animationAppear.delay??0,r=t.options.animationAppear.type??"one-by-one",o=t.options.animationAppear.direction??"row");const{scenegraph:n,frozenColCount:s,frozenRowCount:a}=t,{colStart:l,colEnd:h,rowStart:c,rowEnd:d}=n.proxy;for(let t=0;t<=h;t++)for(let s=0;s<=d;s++){const a=n.highPerformanceGetCell(t,s);a&&"cell"===a.role&&a.forEachChildren((n=>{n.setAttribute("opacity",0),n.animate().wait("one-by-one"===r?("row"===o?s:t)*(e-i):i).to({opacity:1},e,"linear")}))}}(this.table),this.updateNextFrame()}dealWidthMode(){const t=this.table;if("adaptive"===t.widthMode){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,r=0,o=t.colCount;if("only-body"===t.widthAdaptiveMode){for(let e=0;e<t.colCount;e++)if(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount){i+=t.getColWidth(e)}r=t.rowHeaderLevelCount,o=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}pk(e-i,r,o,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const e=t.tableNoFrameWidth;let i=0,r=0;for(let e=0;e<t.colCount;e++){const o=t.getColWidth(e);(e<t.rowHeaderLevelCount||t.isPivotChart()&&e>=t.colCount-t.rightFrozenColCount)&&(i+=o),r+=o}if(r<e&&r>i){pk(e-i,t.rowHeaderLevelCount,t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount,!1,[],t,!0)}}let e=0;this.bodyGroup.forEachChildrenSkipChild((t=>{e+=t.attribute.width})),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild((t=>{i+=t.attribute.width})),this.colHeaderGroup.setAttribute("width",i);let r=0;this.rowHeaderGroup.forEachChildrenSkipChild((t=>{r+=t.attribute.width})),this.rowHeaderGroup.setAttribute("width",r);let o=0;this.cornerHeaderGroup.forEachChildrenSkipChild((t=>{o+=t.attribute.width})),this.cornerHeaderGroup.setAttribute("width",o),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){const t=this.table;if("adaptive"===t.heightMode){t._clearRowRangeHeightsMap();const e=t.getRowsHeight(0,t.columnHeaderLevelCount-1),i=t.isPivotChart()?t.getBottomFrozenRowsHeight():0,r=t.tableNoFrameHeight-e-i,o=t.columnHeaderLevelCount,n=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount;let s=0;for(let e=o;e<n;e++)s+=t.getRowHeight(e);const a=r/s;for(let e=o;e<n;e++){let i;i=e===n-1?r-t.getRowsHeight(o,n-2):Math.round(t.getRowHeight(e)*a),this.setRowHeight(e,i)}}else if(t.autoFillHeight){t._clearRowRangeHeightsMap();const e=t.tableNoFrameHeight;let i=0,r=0;for(let e=0;e<t.rowCount;e++){const o=t.getRowHeight(e);(e<t.columnHeaderLevelCount||t.isPivotChart()&&e>=t.rowCount-t.bottomFrozenRowCount)&&(r+=o),i+=o}if((this._dealAutoFillHeightOriginRowsHeight??i)<e&&i-r>0){const o=t.columnHeaderLevelCount,n=t.isPivotChart()?t.rowCount-t.bottomFrozenRowCount:t.rowCount,s=(e-r)/(i-r);for(let i=o;i<n;i++){let a;a=i===n-1?e-r-t.getRowsHeight(o,n-2):Math.round(t.getRowHeight(i)*s),this.setRowHeight(i,a)}}}}dealFrozen(){!function(t){if(t.table.frozenColCount>t.table.rowHeaderLevelCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.table.rowHeaderLevelCount;e++)dE(t),uE(t),fE(t)}else if(t.table.frozenColCount<t.table.rowHeaderLevelCount){t.bodyGroup.setAttribute("height",t.rowHeaderGroup.attribute.height),t.bodyGroup.setAttribute("y",t.rowHeaderGroup.attribute.y),t.colHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height);for(let e=0;e<t.table.rowHeaderLevelCount-t.table.frozenColCount;e++)gE(t),pE(t),mE(t)}t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.frozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0,t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=t.colHeaderGroup.firstChild?.childrenCount??t.cornerHeaderGroup.firstChild?.childrenCount??t.table.frozenRowCount}(this)}resetFrozen(){!function(t){if(t.frozenColCount>t.table.frozenColCount){t.bodyGroup.setAttribute("height",t.rowHeaderGroup.attribute.height),t.bodyGroup.setAttribute("y",t.rowHeaderGroup.attribute.y),t.colHeaderGroup.setAttribute("height",t.cornerHeaderGroup.attribute.height);for(let e=0;e<t.frozenColCount-t.table.frozenColCount;e++)gE(t),pE(t),mE(t)}else if(t.frozenColCount<t.table.frozenColCount){t.rowHeaderGroup.setAttribute("height",t.bodyGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.bodyGroup.attribute.y),t.cornerHeaderGroup.setAttribute("height",t.colHeaderGroup.attribute.height);for(let e=0;e<t.table.frozenColCount-t.frozenColCount;e++)dE(t),uE(t),fE(t)}cE(t),t.recreateAllSelectRangeComponents(),t.frozenColCount=t.table.frozenColCount,t.frozenRowCount=t.colHeaderGroup.firstChild?.childrenCount??t.cornerHeaderGroup.firstChild?.childrenCount??t.table.frozenRowCount,t.proxy.colStart=t.bodyGroup.firstChild?.col??t.table.frozenColCount,t.bodyGroup.setAttribute("x",t.rowHeaderGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.cornerHeaderGroup.attribute.width),t.updateContainer(),t.updateBorderSizeAndPosition(),t.isPivot||t.table.transpose?t.table.options.frozenColCount?t.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):(t.component.setFrozenColumnShadow(t.table.frozenColCount-1),t.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)),t.hasFrozen=!0}(this)}resetRowFrozen(){!function(t){if(t.frozenRowCount>t.table.frozenRowCount){t.bodyGroup.setAttribute("width",t.colHeaderGroup.attribute.width),t.bodyGroup.setAttribute("x",t.colHeaderGroup.attribute.x),t.rowHeaderGroup.setAttribute("width",t.cornerHeaderGroup.attribute.width);for(let e=0;e<t.frozenRowCount-t.table.frozenRowCount;e++)vE(t),xE(t),_E(t)}else if(t.frozenRowCount<t.table.frozenRowCount){t.colHeaderGroup.setAttribute("width",t.bodyGroup.attribute.width),t.colHeaderGroup.setAttribute("x",t.bodyGroup.attribute.x),t.cornerHeaderGroup.setAttribute("width",t.rowHeaderGroup.attribute.width);for(let e=0;e<t.table.frozenRowCount-t.frozenRowCount;e++)yE(t),CE(t),wE(t)}cE(t),t.recreateAllSelectRangeComponents(),t.frozenRowCount=t.table.frozenRowCount,t.frozenColCount=t.rowHeaderGroup?.childrenCount??0,t.proxy.rowStart=t.bodyGroup.firstChild?.firstChild?.row??t.table.frozenRowCount,t.bodyGroup.setAttribute("y",t.colHeaderGroup.attribute.height),t.rowHeaderGroup.setAttribute("y",t.cornerHeaderGroup.attribute.height),t.updateContainer(),t.updateBorderSizeAndPosition(),t.hasFrozen=!0}(this)}updateCellLayoutWidthCertainWidth(t,e,i){const r=t.attribute.width;let o=!1;return t.forEachChildren(((t,n)=>{n+=e;const s=CA(this.table,i,n);s?t=this.getCell(s.start.col,s.start.row):t.setAttribute("width",r);const a=pB(qM("padding",this.table._getCellStyle(i,n),i,n,this.table)),l=t.getChildByName("text");let h=0,c=0;if(l)h=l.AABBBounds.height()+(a[0]+a[2]),l.setAttribute("maxLineWidth",r-(a[1]+a[3])),c=l.AABBBounds.height()+(a[0]+a[2]);else{const e=t.getChildAt(1);h=e.AABBBounds.height()+(a[0]+a[2]),e._cellWidth=r-(a[1]+a[3]),e.layout(),c=e.AABBBounds.height()+(a[0]+a[2])}const d=this.table.getRowHeight(n);t.attribute.height!==c&&(t.setAttribute("height",c),(d===h||c>d)&&(o=!0))})),o}updateHeaderPosition(t,e,i,r,o){!function(t,e,i,r,o,n){const s=n.scenegraph;for(let i=t;i<=e;i++){const t=n.getColWidth(i),e=n.scenegraph.getColGroup(i,!0),r=n.scenegraph.getColGroup(i),o=n.scenegraph.getColGroupInBottom(i),s=n.scenegraph.getColGroupInLeftBottomCorner(i),a=n.scenegraph.getColGroupInRightBottomCorner(i);e&&(e.setAttribute("width",t),e.forEachChildren((e=>{e.setAttribute("width",t)}))),r&&(r.setAttribute("width",t),r.forEachChildren((e=>{e.setAttribute("width",t)}))),o&&(o.setAttribute("width",t),o.forEachChildren((e=>{e.setAttribute("width",t)}))),a&&(a.setAttribute("width",t),a.forEachChildren((e=>{e.setAttribute("width",t)}))),s&&(s.setAttribute("width",t),s.forEachChildren((e=>{e.setAttribute("width",t)})))}if(s.updateContainer(),"column"===o)for(let i=t;i<=e;i++){const t=n.scenegraph.getColGroup(i);t?.setAttribute("chartInstance",void 0);for(let t=0;t<=n.frozenRowCount-1;t++)s.updateCellContent(i,t);for(let t=s.bodyRowStart;t<=s.bodyRowEnd;t++)s.updateCellContent(i,t);for(let t=n.rowCount-n.bottomFrozenRowCount;t<=n.rowCount-1;t++)s.updateCellContent(i,t)}else{for(let t=0;t<=n.frozenColCount-1;t++){const e=n.scenegraph.getColGroup(t);e?.setAttribute("chartInstance",void 0);for(let e=i;e<=r;e++)s.updateCellContent(t,e)}for(let t=s.bodyColStart;t<=s.bodyColEnd;t++){const e=n.scenegraph.getColGroup(t);e?.setAttribute("chartInstance",void 0);for(let e=i;e<=r;e++)s.updateCellContent(t,e)}for(let t=n.colCount-n.rightFrozenColCount;t<=n.colCount-1;t++){const e=n.scenegraph.getColGroup(t);e?.setAttribute("chartInstance",void 0);for(let e=i;e<=r;e++)s.updateCellContent(t,e)}}}(t,e,i,r,o,this.table)}updateContainerAttrWidthAndX(){const t=ME(this.cornerHeaderGroup,0),e=ME(this.rowHeaderGroup,0),i=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?ME(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth(this.table.frozenColCount??0,this.colHeaderGroup.firstChild.col-1):0):0,r=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?ME(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth(this.table.frozenColCount??0,this.bodyGroup.firstChild.col-1):0):0,o=ME(this.rightFrozenGroup.childrenCount>0?this.rightFrozenGroup:this.rightTopCornerGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&ME(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth(this.table.frozenColCount??0,this.bottomFrozenGroup.firstChild.col-1):0),ME(this.leftBottomCornerGroup,0),ME(this.rightTopCornerGroup,0),ME(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(t-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(t-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(i-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(e-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(i-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(o-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(o-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(o-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(r-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(t=!1){t?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout((()=>{this.updateContainerSync()}),0)):(this._needUpdateContainer=!0,this.updateContainerSync())}updateContainerSync(){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(t,e){const i=this.table.getCellRawRecord(t,e)?.vtableMerge,r=i?"text":this.table.isHeader(t,e)?this.table._getHeaderLayoutMap(t,e).headerType:this.table.getBodyColumnType(t,e),o=this.getCell(t,e);"image"!==r&&"video"!==r||cP(o,t,e,0,0,this.table)}createFrameBorder(){this.updateTableSize();const t=!this.isPivot&&!this.table.internalProps.transpose;hH(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,t?[!0,!0,!0,!1]:void 0),hH(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,t?[!0,!1,!0,!0]:void 0),hH(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,t?[!0,!0,!0,!1]:void 0),hH(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,t?[!0,!1,!0,!0]:void 0),this.table.theme.cornerLeftBottomCellStyle?.frameStyle&&hH(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle.frameStyle,this.leftBottomCornerGroup.role,t?[!0,!1,!0,!0]:void 0),this.table.theme.bottomFrozenStyle?.frameStyle&&hH(this.bottomFrozenGroup,this.table.theme.bottomFrozenStyle.frameStyle,this.bottomFrozenGroup.role,t?[!0,!0,!0,!1]:void 0),this.table.theme.rightFrozenStyle?.frameStyle&&hH(this.rightFrozenGroup,this.table.theme.rightFrozenStyle.frameStyle,this.rightFrozenGroup.role,void 0),this.table.theme.cornerRightTopCellStyle?.frameStyle&&hH(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle.frameStyle,this.rightTopCornerGroup.role,void 0),this.table.theme.cornerRightBottomCellStyle?.frameStyle&&hH(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle.frameStyle,this.rightBottomCornerGroup.role,void 0),hH(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;let o;if(!i){const i=this.table.getDrawRange();return e>=i.top&&e<=i.bottom&&(o=this.table.getCellAtRelativePosition(t-r,e),o.col===this.table.colCount-1)?o:{col:-1,row:-1}}return i.stage?(t<i.globalAABBBounds.x1+r?o={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-r<t&&(o={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),o&&this.table.rightFrozenColCount>0&&o.col>=this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(o.col=o.col+1,o.rightFrozen=!0),o||{col:-1,row:-1}):{col:-1,row:-1}}getResizeRowAt(t,e,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;if(i){let t;if(e<i.globalAABBBounds.y1+r?t={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-r<e&&(t={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),t&&this.table.bottomFrozenRowCount>0&&t.row>=this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(t.row=t.row+1,t.bottomFrozen=!0),t)return t}else;return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}updateRowFrozen(){this.clear||(this.resetRowFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:function(t,e){const{table:i,proxy:r,rightTopCornerGroup:o,rightFrozenGroup:n,rightBottomCornerGroup:s,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=e,c=e.table.rightFrozenColCount;if(t>c){for(let r=i.colCount-c-1;r>=i.colCount-t;r--)bE(n,e.getColGroup(r),n.firstChild),bE(o,e.getColGroup(r,!0),o.firstChild),bE(s,e.getColGroupInBottom(r),s.firstChild);let r=0;n.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,o.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,s.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width}))}else if(t<c){for(let r=i.colCount-c;r<i.colCount-t;r++){const t=e.getColGroup(r);t.setAttribute("x",l.lastChild.attribute.x+i.getColWidth(l.lastChild.col)),l.appendChild(t);const o=e.getColGroupInRightTopCorner(r);o.setAttribute("x",h.lastChild.attribute.x+i.getColWidth(h.lastChild.col)),h.appendChild(o);const n=e.getColGroupInRightBottomCorner(r);n.setAttribute("x",a.lastChild.attribute.x+i.getColWidth(a.lastChild.col)),a.appendChild(n)}let r=0;n.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,o.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width})),r=0,s.forEachChildren((t=>{t.setAttribute("x",r),r+=t.attribute.width}))}n.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),o.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),s.setAttribute("width",i.getColsWidth(i.colCount-t,i.colCount-1)),i.internalProps.rightFrozenColCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:function(t,e){const{table:i,proxy:r,bottomFrozenGroup:o,leftBottomCornerGroup:n,rightBottomCornerGroup:s}=e;o.childrenCount||(r.table.isPivotChart()||(wk(n,0,0,0,i.frozenColCount-1,0,-1,"rowHeader",i),wk(s,0,0,i.colCount-i.rightFrozenColCount,i.colCount-1,0,-1,"body",i)),wk(o,0,0,r.colStart,r.colEnd,0,-1,"body",i));const a=e.table.bottomFrozenRowCount;if(t>a){for(let r=0;r<i.frozenColCount;r++){const o=e.getColGroupInLeftBottomCorner(r);for(let n=i.rowCount-a-1;n>=i.rowCount-t;n--)bE(o,e.getCell(r,n,!0),o.firstChild);let n=0;o.forEachChildren((t=>{t.setAttribute("y",n),n+=i.getRowHeight(t.row)}))}for(let o=r.colStart;o<=r.colEnd;o++){const r=e.getColGroupInBottom(o);for(let n=i.rowCount-a-1;n>=i.rowCount-t;n--)bE(r,e.getCell(o,n,!0),r.firstChild);let n=0;r.forEachChildren((t=>{t.setAttribute("y",n),n+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let r=i.colCount-i.rightFrozenColCount;r<i.colCount;r++){const o=e.getColGroupInRightBottomCorner(r);for(let n=i.rowCount-a-1;n>=i.rowCount-t;n--)bE(o,e.getCell(r,n,!0),o.firstChild);let n=0;o.forEachChildren((t=>{t.setAttribute("y",n),n+=i.getRowHeight(t.row)}))}}else if(t<a){for(let r=0;r<i.rowHeaderLevelCount;r++){const o=e.getColGroup(r);for(let n=i.rowCount-a;n<i.rowCount-t;n++){const t=e.getCell(r,n,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const n=e.getColGroupInLeftBottomCorner(r);let s=0;n.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}for(let o=r.colStart;o<=r.colEnd;o++){const r=e.getColGroup(o);for(let n=i.rowCount-a;n<i.rowCount-t;n++){const t=e.getCell(o,n,!0);t.setAttribute("y",r.lastChild.attribute.y+i.getRowHeight(r.lastChild.row)),r.appendChild(t)}const n=e.getColGroupInBottom(o);let s=0;n.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}if(i.rightFrozenColCount>0)for(let r=i.colCount-i.rightFrozenColCount;r<i.colCount;r++){const o=e.getColGroup(r);for(let n=i.rowCount-a;n<i.rowCount-t;n++){const t=e.getCell(r,n,!0);t.setAttribute("y",o.lastChild.attribute.y+i.getRowHeight(o.lastChild.row)),o.appendChild(t)}const n=e.getColGroupInRightBottomCorner(r);let s=0;n.forEachChildren((t=>{t.setAttribute("y",s),s+=i.getRowHeight(t.row)}))}}o.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),n.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),s.setAttribute("height",i.getRowsHeight(i.rowCount-t,i.rowCount-1)),i.internalProps.bottomFrozenRowCount=t,e.updateContainer(),e.component.updateScrollBar(),e.updateNextFrame()}(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),uH(this.bodyGroup),this.rowHeaderGroup.attribute.width,cH(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),uH(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,cH(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),uH(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),uH(this.cornerHeaderGroup)),this.leftBottomCornerGroup.border&&(this.leftBottomCornerGroup.appendChild(this.leftBottomCornerGroup.border),uH(this.leftBottomCornerGroup)),this.bottomFrozenGroup.border&&(this.bottomFrozenGroup.appendChild(this.bottomFrozenGroup.border),uH(this.bottomFrozenGroup)),this.rightFrozenGroup.border&&(this.rightFrozenGroup.appendChild(this.rightFrozenGroup.border),uH(this.rightFrozenGroup)),this.rightTopCornerGroup.border&&(this.rightTopCornerGroup.appendChild(this.rightTopCornerGroup.border),uH(this.rightTopCornerGroup)),this.rightBottomCornerGroup.border&&(this.rightBottomCornerGroup.appendChild(this.rightBottomCornerGroup.border),uH(this.rightBottomCornerGroup)),function(t){if(!t.theme.frameStyle.cornerRadius)return;const e=t.theme.frameStyle.cornerRadius,{cornerHeaderGroup:i,colHeaderGroup:r,rowHeaderGroup:o,bodyGroup:n,rightTopCornerGroup:s,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:c}=t.scenegraph;i.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),n.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),c.setAttribute("cornerRadius",0);const d=BS(e);i.attribute.width>0&&i.attribute.height>0?gH(i,[d[0],0,0,0]):r.attribute.height>0?gH(r,[d[0],0,0,0]):o.attribute.width>0?gH(o,[d[0],0,0,0]):gH(n,[d[0],0,0,0]),a.attribute.width>0&&a.attribute.height>0?gH(a,[0,0,0,d[3]]):c.attribute.height>0?gH(c,[0,0,0,d[3]]):o.attribute.width>0?gH(o,[0,0,0,d[3]]):gH(n,[0,0,0,d[3]]),s.attribute.width>0&&s.attribute.height>0?gH(s,[0,d[1],0,0]):r.attribute.height>0?gH(r,[0,d[1],0,0]):h.attribute.width>0?gH(h,[0,d[1],0,0]):gH(n,[0,d[1],0,0]),l.attribute.width>0&&l.attribute.height>0?gH(l,[0,0,d[2],0]):h.attribute.width>0?gH(h,[0,0,d[2],0]):c.attribute.height>0?gH(c,[0,0,d[2],0]):gH(n,[0,0,d[2],0])}(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){const i=this.getCell(t,e).getChildByName("text",!0);if(i&&"text"===i.type){if(i.attribute.moreThanMaxCharacters)return this.table.getCellValue(t,e);if(i.cliped)return this.table.getCellValue(t,e)}else if(i&&"richtext"===i.type){const r=i;if(r.attribute.ellipsis&&r._frameCache&&r.attribute.height<r._frameCache.actualHeight)return r.attribute.textConfig.find((t=>t.text)),this.table.getCellValue(t,e)}return null}updateDrill(t,e,i,r,o){this.component.drillIcon.update(t,e,i,r,o,this)}updateCellContent(t,e,i=!1){if(!this.clear)return CP(t,e,this.table,void 0,void 0,i)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e,i=[],r=!0,o){this.table.internalProps.layoutMap.clearCellRangeMap(),this.table.internalProps.useOneRowHeightFillAll=!1;const n=cS(e.map((t=>t.row))).sort(((t,e)=>t-e)),s=cS(i.map((t=>t.row))).sort(((t,e)=>t-e)),a=this.table.getAllRowsHeight()-[...n,...s].reduce(((t,e)=>t+this.table.getRowHeight(e)),0)<=this.table.tableNoFrameHeight;if(oE(t,e,i,this.table,o),r&&this.recalculateColWidths(),"adaptive"===this.table.heightMode||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||a))this.table.scenegraph.recalculateRowHeights();else if(this.table.isAutoRowHeight(this.table.columnHeaderLevelCount))for(let t=0;t<s.length;t++){const e=s[t],i=this.table.rowHeightsMap.get(e),r=GP(e,0,this.table.colCount-1,this.table);(e>=this.proxy.rowStart&&e<=this.proxy.rowEnd||e>=this.table.rowCount-this.table.bottomFrozenRowCount&&e<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(e,r-i)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e,i=[]){LE(t,e,i,this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCornerHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=0;e<this.table.frozenRowCount;e++)CP(t,e,this.table,!1)}updateRowHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=this.table.frozenRowCount;e<this.table.rowCount;e++)CP(t,e,this.table,!1)}updateColumnHeaderCells(){for(let t=0;t<this.table.frozenRowCount;t++)for(let e=this.table.frozenColCount;e<this.table.colCount;e++)CP(e,t,this.table,!1)}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.frozenRowCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.frozenRowCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}updateDomContainer(){!function(t){const{headerDomContainer:e,bodyDomContainer:i,frozenBodyDomContainer:r,frozenHeaderDomContainer:o,rightFrozenBodyDomContainer:n,rightFrozenHeaderDomContainer:s,bottomDomContainer:a,frozenBottomDomContainer:l,rightFrozenBottomDomContainer:h}=t.internalProps;if(!(e||i||r||o||n||s||a||l||h))return;const c=t.getAllColsWidth(),d=Math.min(c,t.tableNoFrameWidth),u=t.getFrozenColsWidth(),g=t.getRightFrozenColsWidth(),p=u+g,f=Math.min(c-p,d-p),m=t.getAllRowsHeight(),b=Math.min(m,t.tableNoFrameHeight),y=t.getFrozenRowsHeight(),C=t.getBottomFrozenRowsHeight(),w=y+C,v=Math.min(m-w,b-w);t.frozenColCount>0?(e.style.left=`${t.tableX+u}px`,i.style.left=`${t.tableX+u}px`,a.style.left=`${t.tableX+u}px`):0===t.frozenColCount&&(e.style.left=`${t.tableX}px`,i.style.left=`${t.tableX}px`,a.style.left=`${t.tableX}px`),r.style.left=`${t.tableX}px`,o.style.left=`${t.tableX}px`,e.style.width=`${f}px`,e.style.height=`${y}px`,i.style.top=`${t.tableY}px`,i.style.width=`${f}px`,i.style.height=`${v}px`,i.style.top=`${t.tableY+y}px`,r.style.width=`${u}px`,r.style.height=`${v}px`,r.style.top=`${t.tableY+y}px`,o.style.width=`${u}px`,o.style.height=`${y}px`,o.style.top=`${t.tableY}px`,n.style.width=`${g}px`,n.style.height=`${v}px`,n.style.top=`${t.tableY+y}px`,n.style.left=t.tableX+d-g+"px",s.style.width=`${g}px`,s.style.height=`${y}px`,s.style.top=`${t.tableY}px`,s.style.left=t.tableX+d-g+"px",a.style.width=`${f}px`,a.style.height=`${C}px`,a.style.top=t.tableY+b-C+"px",l.style.width=`${u}px`,l.style.height=`${C}px`,l.style.top=t.tableY+b-C+"px",h.style.width=`${g}px`,h.style.height=`${C}px`,h.style.top=t.tableY+b-C+"px",h.style.left=t.tableX+d-g+"px"}(this.table)}setLoadingHierarchyState(t,e){const i=this.getCell(t,e),r=i.getChildByName("collapse",!0)||i.getChildByName("expand",!0);if(r){const i=MM()[Lx.loadingIconName];i&&iP(i,r,t,e)}}temporarilyUpdateSelectRectStyle(t){!function(t,e){const{selectedRangeComponents:i}=e;i.forEach(((e,i)=>{e.rect.setAttributes(t)})),e.updateNextFrame()}(t,this)}resetSelectRectStyle(){this.recreateAllSelectRangeComponents()}}function WE(t,e,i){const r=t.highPerformanceGetCell(e,i);if("cell"===r.role&&Wx(r.mergeStartCol)&&Wx(r.mergeStartRow)&&Wx(r.mergeEndCol)&&Wx(r.mergeEndRow)){const{colStart:e,colEnd:i,rowStart:o,rowEnd:n}=XP(r,t);for(let r=e;r<=i;r++)for(let e=o;e<=n;e++){const i=t.highPerformanceGetCell(r,e);"cell"===i.role&&i.addUpdateBoundTag()}}else r.addUpdateBoundTag()}function NE(t,e,i,r,o){const n=t.table;for(let i=0;i<n.columnHeaderLevelCount;i++)WE(t,e,i);const s=t.getColGroup(e);return s?.addUpdateBoundTag(),!0}function GE(t,e,i,r,o,n){const s=t.table;for(let i=0;i<s.columnHeaderLevelCount;i++)WE(t,e,i);const a=t.getColGroup(e);return a?.addUpdateBoundTag(),!0}function jE(t,e,i,r,o){const n=t.table;for(let e=0;e<n.colCount;e++)WE(t,e,i);return!0}function VE(t,e,i,r,o,n){const s=t.table;for(let e=0;e<s.colCount;e++)WE(t,e,i);return!0}function UE(t,e,i){const{table:r}=t,{scenegraph:o}=r,{highlightScope:n,singleStyle:s,disableHeader:a,cellPos:l,cellPosContainHeader:h}=t.hover,c=l.col,d=l.row;if(n===Rx.none||a&&(h.col!==e||h.row!==i)){const t=h.col,r=h.row;o.hideHoverIcon(t,r),o.showHoverIcon(e,i),h.col=e,h.row=i}if((a&&r.isHeader(e,i)||n===Rx.none)&&(e=-1,i=-1),c===e&&d===i)return;l.col=e,l.row=i,t.table.options.customConfig?.disableBuildInChartActive||(o.deactivateChart(c,d),o.activateChart(e,i));let u=!1;const{ranges:g,highlightScope:p}=t.select;if(-1!==c&&-1!==d&&(u=function(t,e,i,r,o,n,s){let a=!1;n===Rx.single?a=!!function(t,e,i,r,o){return WE(t,e,i),!0}(t,e,i)||a:n===Rx.row?a=!!jE(t,0,i)||a:n===Rx.column?a=!!NE(t,e)||a:n===Rx.cross&&(a=!!jE(t,0,i)||a,a=!!NE(t,e)||a);return a}(o,c,d,0,0,n),a||o.hideHoverIcon(c,d)),-1===e||-1===i)return l.col=-1,l.row=-1,void(!u||c===e&&d===i||t.table.scenegraph.updateNextFrame());n===Rx.single?u=!!function(t,e,i,r,o){return WE(t,e,i),!0}(o,e,i)||u:n===Rx.row?u=!!VE(o,0,i)||u:n===Rx.column?u=!!GE(o,e)||u:n===Rx.cross&&(u=!!VE(o,0,i)||u,u=!!GE(o,e)||u),n===Rx.none||a||o.showHoverIcon(e,i),u&&t.table.scenegraph.updateNextFrame()}function KE(t,e,i,r){let o,n=null,s=!1;if(Array.isArray(i.sortState))for(let r=0;r<i.sortState.length&&(o=i.sortState[r],o&&(n=i._getHeaderCellBySortState(o)),n&&(s=$E(t,e,n.col,n.row,i)),!s);r++);else o=i.sortState,o&&(n=i._getHeaderCellBySortState(o)),n&&(s=$E(t,e,n.col,n.row,i));const a=i.getHeaderDefine(t,e);o&&s&&a?.sort?o.order="asc"===o.order?"desc":"desc"===o.order?"normal":"asc":a?.sort?o={field:i.getHeaderField(t,e),order:"asc"}:s&&a?.showSort||(o={field:i.getHeaderField(t,e),order:"normal"}),o.event=r;if(i.fireListeners(OS.SORT_CLICK,o).includes(!1))return;let l=!1,h=i.internalProps.sortState?Array.isArray(i.internalProps.sortState)&&(l=!0)?i.internalProps.sortState:[i.internalProps.sortState]:[];if(Array.isArray(h)){const t=h.findIndex((t=>t.field===o.field));t>=0?h[t]=o:h.push(o)}h=h.filter((t=>"normal"!==t.order)),h=i.internalProps.multipleSort&&(l=!0)?h:h.splice(-1),h=l&&h.length?h:h[0],i.internalProps.sortState=h,i.stateManager.setSortState(h),a?.sort&&function(t,e,i){t=Array.isArray(t)||!t?t:[t],e.dataSource.sort((t||[]).map((t=>{const i=e.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field));return{field:t.field,order:t.order||"asc",orderFn:"function"==typeof i?.define?.sort?i?.define?.sort:lS}})))}(h,i),i.internalProps.useOneRowHeightFillAll=!1,i.internalProps.layoutMap.clearCellRangeMap(),i.scenegraph.sortCell();const c=!!i.stateManager.select.ranges?.length;i.stateManager.updateSelectPos(-1,-1),i.stateManager.endSelectCells(!0,c)}function $E(t,e,i,r,o){return o._getLayoutCellId(t,e)===o._getLayoutCellId(i,r)}const XE=xS(OS,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"}),YE=xS(OS,{VCHART_EVENT_TYPE:"vchart_event_type"});function qE(t,e,i,r,o){for(let i=t;i<=e;i++)o._clearColRangeWidthsMap(i);for(let t=i;t<=r;t++)o._clearRowRangeHeightsMap(t)}function ZE(t){if(!t)return;const e=t.role?.startsWith("icon")?t:"richtext"===t.type?t._currentHoverIcon:void 0;return e?"richtext"===t.type?{icon:e,position:{left:t.globalAABBBounds.x1+e.globalAABBBounds.x1,right:t.globalAABBBounds.x1+e.globalAABBBounds.x2,top:t.globalAABBBounds.y1+e.globalAABBBounds.y1,bottom:t.globalAABBBounds.y1+e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"richtext-icon"}:{icon:e,position:{left:e.globalAABBBounds.x1,right:e.globalAABBBounds.x2,top:e.globalAABBBounds.y1,bottom:e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"icon"}:void 0}function JE(t,e){"adaptive"===e.table.widthMode&&e.columnResize.col<e.table.colCount-1?(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.scenegraph.updateColWidth(e.columnResize.col+1,-t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col),e.table.internalProps._widthResizedColMap.add(e.columnResize.col+1)):(e.table.scenegraph.updateColWidth(e.columnResize.col,t),e.table.internalProps._widthResizedColMap.add(e.columnResize.col))}function QE(t,e,i,r,o){const n=o.table.getRecordShowIndexByCell(t,e);if(n>=0){const t=o.table.dataSource.getIndexKey(n).toString();o.checkedState.get(t)?o.checkedState.get(t)[i]=r:o.checkedState.set(t,{[i]:r})}}function tF(t,e){e.checkedState.clear(),e.headerCheckedState={},e.radioState={};let i=!1;if(e._checkboxCellTypeFields=[],e._headerCheckFuncs={},e.table.internalProps.layoutMap.headerObjects.forEach(((t,r)=>{if("checkbox"===t.headerType){const r=t.define.checked;null==r||"function"==typeof r?(i=!0,"function"==typeof r&&(e._headerCheckFuncs[t.field]=r)):e.headerCheckedState[t.field]=r,"checkbox"!==t.define.cellType&&!Ox(t.define.cellType)||t.fieldFormat||e._checkboxCellTypeFields.push(t.field)}})),1===e.table.leftRowSeriesNumberCount)e.headerCheckedState._vtable_rowSeries_number=!1,e._checkboxCellTypeFields.push("_vtable_rowSeries_number"),i=!0;else if(e.table.leftRowSeriesNumberCount>1){for(let t=0;t<e.table.leftRowSeriesNumberCount;t++)e.headerCheckedState[`_vtable_rowSeries_number_${t}`]=!1,e._checkboxCellTypeFields.push(`_vtable_rowSeries_number_${t}`);i=!0}i&&function(t,e){const i=e.table,r=i.isPivotTable()?0:i.internalProps.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,o=i.isPivotTable()?Ux(t)?t.length:0:i.internalProps.transpose?i.colCount:i.rowCount;for(let n=0;n+r<o;n++){const r=i.isPivotTable()?t[n]:i.dataSource.get(n);e._checkboxCellTypeFields.forEach((t=>{const o=r&&r[t];let s;if(Nx(o)?s=o.checked:"boolean"==typeof o&&(s=o),null==s){const i=e._headerCheckFuncs[t];if(i){const r=e.table.getCellAddrByFieldRecord(t,n);s=AS(i,{col:r.col,row:r.row,table:e.table,context:null,value:o})}}const a=i.isPivotTable()?n.toString():e.table.dataSource.getIndexKey(n).toString();e.checkedState.get(a)||e.checkedState.set(a,{}),e.checkedState.get(a)[t]=s}))}}(t,e)}function eF(t,e,i,r){const o=r.scenegraph.getCell(t,e),n=o?.getChildByName("checkbox")||o?.getChildByName("checkbox-content")?._checkboxGroup?.getChildByName("checkbox");n&&("indeterminate"===i?(n.setAttribute("indeterminate",!0),n.setAttribute("checked",void 0)):(n.setAttribute("indeterminate",void 0),n.setAttribute("checked",i)))}function iF(t,e){"adaptive"===e.table.heightMode&&e.rowResize.row<e.table.rowCount-1?(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.scenegraph.updateRowHeight(e.rowResize.row+1,-t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row+1)):(e.table.scenegraph.updateRowHeight(e.rowResize.row,t),e.table.internalProps._heightResizedRowMap.add(e.rowResize.row))}class rF{table;interactionState;interactionStateBeforeScroll;select;fillHandle;hover;hoverIcon;residentHoverIcon;columnResize;rowResize;columnMove;menu;sort;frozen;scroll;tablePosition;drill;sparkLine;_clearVerticalScrollBar;_clearHorizontalScrollBar;_frozenObserver;fastScrolling=!1;checkedState=new Map;headerCheckedState={};_checkboxCellTypeFields=[];_headerCheckFuncs={};radioState={};resetInteractionState=WS((t=>{this.updateInteractionState(t??Tx.default)}),100);constructor(t){this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=Tx.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,rowSourceSize:0,rowTargetSize:0,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new g_,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=Tx.default,this.select={highlightScope:Rx.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:Rx.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,rowSourceSize:0,rowTargetSize:0,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new g_,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){const{highlightMode:t,disableHover:e,disableHeaderHover:i}=this.table.options.hover??{highlightMode:"cell"};e?this.hover.highlightScope=Rx.none:"cross"===t?this.hover.highlightScope=Rx.cross:"row"===t?this.hover.highlightScope=Rx.row:"column"===t?this.hover.highlightScope=Rx.column:"cell"===t&&(this.hover.highlightScope=Rx.single),this.hover.singleStyle=!e,this.hover.disableHeader=i,(this.hover.highlightScope===Rx.none||i)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){const{headerSelectMode:t,disableSelect:e,disableHeaderSelect:i,highlightMode:r,highlightInRange:o}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1,highlightMode:"cell",highlightInRange:!1},this.table.options.select),n=this.table.options.select?.cornerHeaderSelectMode?this.table.options.select?.cornerHeaderSelectMode:"body"===this.table.options.select?.headerSelectMode?this.table.options.select?.headerSelectMode:"all";this.select.highlightScope=!0===e?Rx.none:"cross"===r?Rx.cross:"row"===r?Rx.row:"column"===r?Rx.column:Rx.single,this.select.singleStyle=!e,this.select.disableHeader=i,this.select.headerSelectMode=t,this.select.cornerHeaderSelectMode=n,this.select.highlightInRange=o,this.select.disableCtrlMultiSelect=!1===this.table.options.keyboardOptions?.ctrlMultiSelect}isSelected(t,e){let i=!1;return this.select.ranges.forEach((r=>{MS(r,t,e)&&(i=!0)})),i}setSortState(t){const e=this;const i=(t=!t||Array.isArray(t)?t:[t])&&t.reduce(((t,i)=>{const r=function(t){const i=[];return function t(r,o=0){r.forEach((r=>{const n=r.startInTotal?r.startInTotal+e.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount??0:o;r.columns?t(r.columns,n):i.push({...r,startIndex:n})}))}(t),i}(this.table.internalProps.columns)?.find((t=>t?.field===i?.field));return this.table.internalProps.transpose?t.push({field:i.field,order:i.order,row:r?.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount??0,col:r?.level}):t.push({field:i.field,order:i.order,col:r?.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount??0,row:r?.level}),t}),[]);this.sort=i||[]}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;t===Tx.scrolling&&(this.interactionStateBeforeScroll=this.interactionState);const e=this.interactionState;this.interactionState=t,e===Tx.scrolling&&Tx.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){UE(this,t,e)}updateSelectPos(t,e,i=!1,r=!1,o=!1,n=!0,s=!1){-1!==e&&-1!==e&&(this.select.selecting=!0),t<0&&(t=-1),e<0&&(e=-1),t>this.table.colCount-1&&(t=this.table.colCount-1),e>this.table.rowCount-1&&(e=this.table.rowCount-1),function(t,e,i,r,o,n,s=!0,a=!1){const{table:l,interactionState:h}=t,{scenegraph:c}=l,{highlightScope:d,disableHeader:u,cellPos:g,disableCtrlMultiSelect:p}=t.select;if(-1!==e&&-1!==i&&s&&l._makeVisibleCell(e,i),-1!==e&&-1!==i&&s)if(h===Tx.grabing&&t.select.ranges.length>0){const r=t.select.ranges[t.select.ranges.length-1];e>r.start.col&&e>r.end.col&&l._makeVisibleCell(e+1,i),i>r.start.row&&i>r.end.row&&l._makeVisibleCell(e,i+1),e<r.start.col&&e<r.end.col&&l._makeVisibleCell(e-1,i),i<r.start.row&&i<r.end.row&&l._makeVisibleCell(e,i-1)}else l._makeVisibleCell(e,i);if(n){t.select.ranges=[],c.deleteAllSelectBorder();let e=0,i=0;const{disableHeaderSelect:r,disableRowSeriesNumberSelect:o}=l.options.keyboardOptions?.selectAllOnCtrlA||{};r&&(e=l.rowHeaderLevelCount,i=l.columnHeaderLevelCount),(o||r&&l.transpose)&&l.options.rowSeriesNumber&&(e+=1),t.select.ranges.push({start:{col:e,row:i},end:{col:l.colCount-1,row:l.rowCount-1}});const n=t.select.ranges[t.select.ranges.length-1];c.updateCellSelectBorder(n,!1)}else if(-1===g.col||-1===g.row||-1!==e&&-1!==i)if(h!==Tx.default||l.eventManager.isDraging||l.stateManager.isResizeCol()){if((h===Tx.grabing||l.eventManager.isDraging)&&!l.stateManager.isResizeCol()){let r=!0;-1===g.col&&(g.col=e),-1===g.row&&(g.row=i),g.col=e,g.row=i;const o=t.select.ranges[t.select.ranges.length-1];if(o){if(l.internalProps.layoutMap.isSeriesNumberInBody(o.start.col,o.start.row))r=!1,o.end={col:l.colCount-1,row:i};else if(t.fillHandle.isFilling){if("top"===t.fillHandle.direction)if(i===t.fillHandle.beforeFillMinRow&&i===t.fillHandle.beforeFillMaxRow)o.start.row=o.end.row=i;else if(i<=t.fillHandle.beforeFillMinRow){if(o.start.row<o.end.row){const t=o.start.row;o.start.row=o.end.row,o.end.row=t}o.end.row=i}else i===t.fillHandle.beforeFillMaxRow&&(o.start.row>o.end.row?o.start.row=i:o.end.row=i);else if("bottom"===t.fillHandle.direction){if(i>=t.fillHandle.beforeFillMaxRow){if(o.start.row>o.end.row){const t=o.start.row;o.start.row=o.end.row,o.end.row=t}o.end.row=i}}else if("left"===t.fillHandle.direction)if(e===t.fillHandle.beforeFillMinCol&&e===t.fillHandle.beforeFillMaxCol)o.start.col=o.end.col=e;else if(e<=t.fillHandle.beforeFillMinCol){if(o.start.col<o.end.col){const t=o.start.col;o.start.col=o.end.col,o.end.col=t}o.end.col=e}else e===t.fillHandle.beforeFillMaxCol&&(o.start.col>o.end.col?o.start.col=e:o.end.col=e);else if("right"===t.fillHandle.direction&&e>=t.fillHandle.beforeFillMaxCol){if(o.start.col>o.end.col){const t=o.start.col;o.start.col=o.end.col,o.end.col=t}o.end.col=e}}else{o.end={col:e,row:i};const r=a?{start:{col:e,row:i},end:{col:e,row:i}}:l.getCellRange(e,i);o.start.col<r.end.col?o.end.col=r.end.col:o.start.col>r.start.col&&(o.end.col=r.start.col),o.start.row<r.end.row?o.end.row=r.end.row:o.start.row>r.start.row&&(o.end.row=r.start.row),"body"===t.select.headerSelectMode&&(l.isRowHeader(e,i)?(o.start.col=l.rowHeaderLevelCount+l.leftRowSeriesNumberCount,o.end.col=l.colCount-1):l.isColumnHeader(e,i)?(o.start.row=l.columnHeaderLevelCount,o.end.row=l.rowCount-1):l.internalProps.layoutMap.isSeriesNumberInBody(e,i)?(o.start.col=l.leftRowSeriesNumberCount,o.end.col=l.colCount-1):l.isCornerHeader(e,i)?(o.start.col=l.rowHeaderLevelCount+l.leftRowSeriesNumberCount,o.start.row=l.columnHeaderLevelCount,o.end.col=l.colCount-1,o.end.row=l.rowCount-1):l.isSeriesNumber(e,i)&&(o.start.col=l.leftRowSeriesNumberCount,o.start.row=l.columnHeaderLevelCount,o.end.col=l.colCount-1,o.end.row=l.rowCount-1)),a&&(o.skipBodyMerge=!0)}o&&o.start.row<=l.rowCount-1&&o.end.row<=l.rowCount-1&&o.start.col<=l.colCount-1&&o.end.col<=l.colCount-1&&c.updateCellSelectBorder(o,r)}}}else{const n=t.select.ranges[t.select.ranges.length-1];if(r&&n){if(o&&!p||(g.col=e,g.row=i),"cell"!==t.select.headerSelectMode&&l.isColumnHeader(e,i)){const r=Math.min(n.start.col,n.end.col,e),o=Math.max(n.start.col,n.end.col,e),s=Math.min(n.start.row,n.end.row,i),a=l.rowCount-1;"body"===t.select.headerSelectMode?(n.start={col:r,row:l.columnHeaderLevelCount},n.end={col:o,row:l.rowCount-1}):(n.start={col:r,row:s},n.end={col:o,row:a})}else if("cell"!==t.select.headerSelectMode&&l.isRowHeader(e,i)){const r=Math.min(n.start.col,n.end.col,e),o=l.colCount-1,s=Math.min(n.start.row,n.end.row,i),a=Math.max(n.start.row,n.end.row,i);"body"===t.select.headerSelectMode?(n.start={col:l.leftRowSeriesNumberCount+l.rowHeaderLevelCount,row:s},n.end={col:l.colCount-1,row:a}):(n.start={col:r,row:s},n.end={col:o,row:a})}else if("cell"!==t.select.headerSelectMode&&l.isSeriesNumberInBody(e,i)){const r=Math.min(n.start.col,n.end.col,e),o=l.colCount-1,s=Math.min(n.start.row,n.end.row,i),a=Math.max(n.start.row,n.end.row,i);"body"===t.select.headerSelectMode?(n.start={col:l.leftRowSeriesNumberCount,row:s},n.end={col:l.colCount-1,row:a}):(n.start={col:r,row:s},n.end={col:o,row:a})}else n.end={col:e,row:i};c.deleteLastSelectedRangeComponents(),c.updateCellSelectBorder(n)}else{let r=!0;if(-1===g.col||-1===g.row||o&&!p||(t.select.ranges=[],c.deleteAllSelectBorder()),"cell"!==t.select.headerSelectMode&&l.isColumnHeader(e,i)){const r=l.getCellRange(e,i);"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:r.start.col,row:l.columnHeaderLevelCount},end:{col:r.end.col,row:l.rowCount-1},skipBodyMerge:!0}):t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:l.rowCount-1},skipBodyMerge:!0})}else if("cell"!==t.select.headerSelectMode&&l.isRowHeader(e,i)){const r=l.getCellRange(e,i);"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:l.rowHeaderLevelCount+l.leftRowSeriesNumberCount,row:r.start.row},end:{col:l.colCount-1,row:r.end.row},skipBodyMerge:!0}):t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:l.colCount-1,row:r.end.row},skipBodyMerge:!0})}else if(l.internalProps.layoutMap.isSeriesNumberInHeader(e,i)){r=!1;const{cornerHeaderSelectMode:o}=t.select;if("body"===o)t.select.ranges.push({start:{col:l.leftRowSeriesNumberCount,row:l.columnHeaderLevelCount},end:{col:l.colCount-1,row:l.rowCount-1},skipBodyMerge:!0});else if("inline"===o){const r=a?{start:{col:e,row:i},end:{col:e,row:i}}:l.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:l.rowCount-1},skipBodyMerge:!0})}else if("cell"===o){const r=a?{start:{col:e,row:i},end:{col:e,row:i}}:l.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:r.end.row},skipBodyMerge:a||void 0})}else t.select.ranges.push({start:{col:0,row:0},end:{col:l.colCount-1,row:l.rowCount-1},skipBodyMerge:!0})}else if(l.internalProps.layoutMap.isSeriesNumberInBody(e,i))r=!1,"body"===t.select.headerSelectMode?t.select.ranges.push({start:{col:l.leftRowSeriesNumberCount,row:i},end:{col:l.colCount-1,row:i},skipBodyMerge:!0}):t.select.ranges.push({start:{col:e,row:i},end:{col:l.colCount-1,row:i},skipBodyMerge:!0});else if(l.internalProps.layoutMap.isCornerHeader(e,i)){r=!1;const{cornerHeaderSelectMode:o}=t.select;if("body"===o)t.select.ranges.push({start:{col:l.rowHeaderLevelCount+l.leftRowSeriesNumberCount,row:l.columnHeaderLevelCount},end:{col:l.colCount-1,row:l.rowCount-1},skipBodyMerge:!0});else if("cell"===o){const r=a?{start:{col:e,row:i},end:{col:e,row:i}}:l.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:r.end.row},skipBodyMerge:a||void 0})}else if("inline"===o){const r=a?{start:{col:e,row:i},end:{col:e,row:i}}:l.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:l.rowCount-1},skipBodyMerge:!0})}else t.select.ranges.push({start:{col:l.leftRowSeriesNumberCount,row:0},end:{col:l.colCount-1,row:l.rowCount-1},skipBodyMerge:!0})}else if(e>=0&&i>=0){const r=a?{start:{col:e,row:i},end:{col:e,row:i}}:l.getCellRange(e,i);t.select.ranges.push({start:{col:r.start.col,row:r.start.row},end:{col:r.end.col,row:r.end.row},skipBodyMerge:a||void 0})}g.col=e,g.row=i;const n=t.select.ranges?.[t.select.ranges.length-1];n&&n.start.row<=l.rowCount-1&&n.end.row<=l.rowCount-1&&n.start.col<=l.colCount-1&&n.end.col<=l.colCount-1&&c.updateCellSelectBorder(n,r)}}else g.col=-1,g.row=-1,t.select.ranges=[],c.deleteAllSelectBorder();c.updateNextFrame()}(this,t,e,i,r,o,n,s)}checkCellRangeInSelect(t,e){return function(t,e,i,r){for(let r=0;r<i.length;r++)if(HS(i[r],{start:t,end:e}))return!0;return!1}(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,r){if(this.residentHoverIcon?.icon&&i===this.residentHoverIcon?.icon)return;const o=ZE(i);if(o)if("richtext-icon"===o.type){const i=o.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==this.residentHoverIcon?.icon&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),i.attribute.tooltip){const r={content:i.attribute.tooltip.title,referencePosition:{rect:o.position,placement:i.attribute.tooltip.placement},style:Object.assign({},this.table.internalProps.theme?.tooltipStyle,i.tooltip?.style,i.attribute?.tooltip?.style),disappearDelay:i.attribute.tooltip.disappearDelay};this.table.internalProps.tooltipHandler.isBinded(r)||this.table.showTooltip(t,e,r)}}else{const i=o.icon;i!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==this.residentHoverIcon?.icon&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=i,this.table.scenegraph.setIconHoverStyle(i,t,e,r),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==this.residentHoverIcon?.icon&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(t=!0,e=!0){if(this.select.selecting){if(this.select.selecting=!1,0===this.select.ranges.length)return;const e=this.select.ranges[this.select.ranges.length-1];this.table.isSeriesNumber(this.select.cellPos.col,this.select.cellPos.row)||this.table.isHeader(this.select.cellPos.col,this.select.cellPos.row)||function(t,e){const i=t.start.col,r=t.end.col,o=t.start.row,n=t.end.row;let s=i,a=r,l=o,h=n;for(let t=i;t<=r;t++)for(let i=o;i<=n;i++){const r=e.getCellRange(t,i);r&&(s=Math.min(s,r.start.col),a=Math.max(a,r.end.col),l=Math.min(l,r.start.row),h=Math.max(h,r.end.row))}t.start.col=s,t.end.col=a,t.start.row=l,t.end.row=h}(e,this.table);let i=!1;for(let t=0;t<this.select.ranges.length-1;t++){const r=this.select.ranges[t];if(r&&r.start.col===e.start.col&&r.start.row===e.start.row&&r.end.col===e.end.col&&r.end.row===e.end.row){i=!0;break}}i?(this.select.ranges.pop(),rE(this.table.scenegraph),this.table.scenegraph.selectingRangeComponents.clear()):this.table.scenegraph.moveSelectingRangeComponentsToSelectedRangeComponents();const r=this.select.ranges[this.select.ranges.length-1].end.col,o=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(OS.SELECTED_CELL,{ranges:this.select.ranges,col:r,row:o})}else e&&0===this.select.ranges.length&&this.table.fireListeners(OS.SELECTED_CLEAR,{})}endResizeCol(){setTimeout((()=>{this.columnResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeColWidth(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,r){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=r,this.table.scenegraph.component.showResizeCol(t,i,r),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let r=i.columnResize.isRightFrozen?i.columnResize.x-t:t-i.columnResize.x;if(Math.abs(r)<1)return;const o=i.table.getColWidth(i.columnResize.col);let n=o;n+=r;const s=i.table.getMinColWidth(i.columnResize.col),a=i.table.getMaxColWidth(i.columnResize.col);if(n<s||n>a){if(o===s||o===a)return;r=o-s>a-o?a-o:s-o}let l=i.table.getColWidth(i.columnResize.col)+r;if(l<i.table.internalProps.limitMinWidth&&(l=i.table.internalProps.limitMinWidth,r=l-i.table.getColWidth(i.columnResize.col)),"adaptive"===i.table.widthMode&&i.columnResize.col<i.table.colCount-1){const t=i.table.getColWidth(i.columnResize.col+1),e=i.table.getMinColWidth(i.columnResize.col+1),o=i.table.getMaxColWidth(i.columnResize.col+1);let n=t;if(n-=r,n<e||n>o){if(t===e||t===o)return;r=t-e>o-t?o-t:e-t}n-r<i.table.internalProps.limitMinWidth&&(r=n-i.table.internalProps.limitMinWidth)}r=Math.ceil(r),i.columnResize.col<i.table.rowHeaderLevelCount||i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount?JE(r,i):"indicator"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;let r,o,n;if(i.indicatorsAsCol)r=i.getIndicatorKey(e.columnResize.col,e.table.columnHeaderLevelCount);else{const t=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount-1),r=t.colHeaderPaths[t.colHeaderPaths.length-1];o=r.dimensionKey,n=r.value}for(let s=e.table.rowHeaderLevelCount;s<e.table.colCount-e.table.rightFrozenColCount;s++){const a=i.getIndicatorKey(s,e.table.columnHeaderLevelCount);if(i.indicatorsAsCol&&a===r)e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s);else if(!i.indicatorsAsCol){const r=i.getCellHeaderPaths(s,e.table.columnHeaderLevelCount-1),a=r?.colHeaderPaths[r.colHeaderPaths.length-1];a&&o===a.dimensionKey&&n===a.value&&(e.table.scenegraph.updateColWidth(s,t),e.table.internalProps._widthResizedColMap.add(s))}}}(r,i):"indicatorGroup"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap,r=i.getCellHeaderPaths(e.columnResize.col,e.table.columnHeaderLevelCount),o=i.getHeadNodeByRowOrColDimensions(r.colHeaderPaths.slice(0,r.colHeaderPaths.length-1)),n=o.startInTotal+e.table.frozenColCount,s=o.startInTotal+e.table.frozenColCount+o.size-1,a=e.table.getColsWidth(n,s),l=t;for(let t=n;t<=s;t++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const r=i.getBody(t,e.table.columnHeaderLevelCount);if(r?.disableColumnResize)continue}let r=e.table.getColWidth(t)/a*l;r>0&&r<.5?r=.5:r<0&&r>=-.5&&(r=-.5),e.table.scenegraph.updateColWidth(t,r),e.table.internalProps._widthResizedColMap.add(t)}}(r,i):"all"===i.table.internalProps.columnResizeType?function(t,e){const i=e.table.internalProps.layoutMap;for(let r=e.table.frozenColCount;r<e.table.colCount-e.table.rightFrozenColCount;r++){if(!(e.table.internalProps.transpose||e.table.isPivotTable()&&!i.indicatorsAsCol)){const t=i.getBody(r,e.table.columnHeaderLevelCount);if(t?.disableColumnResize)continue}e.table.scenegraph.updateColWidth(r,t),e.table.internalProps._widthResizedColMap.add(r)}}(r,i):JE(r,i),i.columnResize.x=t,i.table.scenegraph.component.updateResizeCol(i.columnResize.col,e,i.columnResize.isRightFrozen),i.columnResize.col<i.table.frozenColCount&&!i.table.isPivotTable()&&!i.table.transpose?i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1,i.columnResize.isRightFrozen):i.table.options.frozenColCount&&i.table.scenegraph.component.setFrozenColumnShadow(i.table.frozenColCount-1),(i.columnResize.col>=i.table.colCount-i.table.rightFrozenColCount&&!i.table.isPivotTable()&&!i.table.transpose||i.table.options.rightFrozenColCount)&&i.table.scenegraph.component.setRightFrozenColumnShadow(i.table.colCount-i.table.rightFrozenColCount),i.table.scenegraph.updateNextFrame()}(t,e,this)}endResizeRow(){setTimeout((()=>{this.rowResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeRowHeight(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(t,e,i,r){this.rowResize.resizing=!0,this.rowResize.row=t,this.rowResize.y=i,this.rowResize.isBottomFrozen=r,this.table.scenegraph.component.showResizeRow(t,e,r),this.table.scenegraph.updateNextFrame()}updateResizeRow(t,e){!function(t,e,i){t=Math.ceil(t),e=Math.ceil(e);let r=i.rowResize.isBottomFrozen?i.rowResize.y-e:e-i.rowResize.y;if(Math.abs(r)<1)return;i.table.getRowHeight(i.rowResize.row);let o=i.table.getRowHeight(i.rowResize.row)+r;if(o<i.table.internalProps.limitMinHeight&&(o=i.table.internalProps.limitMinHeight,r=o-i.table.getRowHeight(i.rowResize.row)),"adaptive"===i.table.heightMode&&i.rowResize.row<i.table.rowCount-1){let t=i.table.getRowHeight(i.rowResize.row+1);t-=r,t-r<i.table.internalProps.limitMinHeight&&(r=t-i.table.internalProps.limitMinHeight)}r=Math.ceil(r),i.rowResize.row<i.table.columnHeaderLevelCount||i.rowResize.row>=i.table.rowCount-i.table.bottomFrozenRowCount?iF(r,i):"indicator"===i.table.internalProps.rowResizeType?function(t,e){const i=e.table.internalProps.layoutMap;let r,o,n;if(i.indicatorsAsCol){const t=i.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,e.rowResize.row),r=t.rowHeaderPaths?.[t.rowHeaderPaths.length-1];o=r?.dimensionKey,n=r?.value}else r=i.getIndicatorKey(e.table.rowHeaderLevelCount,e.rowResize.row);for(let s=e.table.columnHeaderLevelCount;s<e.table.rowCount-e.table.bottomFrozenRowCount;s++){const a=i.getIndicatorKey(e.table.rowHeaderLevelCount,s);if(i.indicatorsAsCol||a!==r){if(i.indicatorsAsCol){const r=i.getCellHeaderPaths(e.table.rowHeaderLevelCount-1,s),a=r?.rowHeaderPaths?.[r.rowHeaderPaths.length-1];a&&o===a.dimensionKey&&n===a.value&&(e.table.scenegraph.updateRowHeight(s,t),e.table.internalProps._heightResizedRowMap.add(s))}}else e.table.scenegraph.updateRowHeight(s,t),e.table.internalProps._heightResizedRowMap.add(s)}}(r,i):"indicatorGroup"===i.table.internalProps.rowResizeType?function(t,e){const i=e.table.internalProps.layoutMap,r=i.getCellHeaderPaths(e.table.rowHeaderLevelCount,e.rowResize.row),o=i.getHeadNodeByRowOrColDimensions(r.rowHeaderPaths.slice(0,r.rowHeaderPaths.length-1)),n=o.startInTotal+e.table.frozenRowCount,s=o.startInTotal+e.table.frozenRowCount+o.size-1,a=e.table.getRowsHeight(n,s),l=t;for(let t=n;t<=s;t++){let i=e.table.getRowHeight(t)/a*l;i>0&&i<.5?i=.5:i<0&&i>=-.5&&(i=-.51),e.table.scenegraph.updateRowHeight(t,i),e.table.internalProps._heightResizedRowMap.add(t)}}(r,i):"all"===i.table.internalProps.rowResizeType?function(t,e){for(let i=e.table.frozenRowCount;i<e.table.rowCount-e.table.bottomFrozenRowCount;i++)e.table.scenegraph.updateRowHeight(i,t),e.table.internalProps._heightResizedRowMap.add(i)}(r,i):iF(r,i),i.rowResize.y=e,i.table.scenegraph.component.updateResizeRow(i.rowResize.row,t,i.rowResize.isBottomFrozen),i.table.scenegraph.updateNextFrame()}(t,e,this)}startFillSelect(t,e){this.fillHandle.isFilling=!0,this.fillHandle.startX=t,this.fillHandle.startY=e;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(OS.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const t=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),e=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),r=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===t&&this.fillHandle.beforeFillMinRow===e&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===r||this.table.eventManager.isDraging&&this.table.fireListeners(OS.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(t,e,i,r,o){!function(t,e,i,r,o,n){if(!("canMoveHeaderPosition"in o.table.internalProps.layoutMap))return;if(o.columnMove.moving=!0,o.columnMove.colSource=t,o.columnMove.rowSource=e,o.table.isListTable()){const i=o.table.getRecordIndexByCell(t,e),r=o.table.getRecordByCell(t,e),n=o.table.getRecordHierarchyState(t,e);o.columnMove.rowSourceSize=uS(i,n,r)+1}o.columnMove.x=i-o.table.tableX,o.columnMove.y=r-o.table.tableY;const s=o.table.getCellLocation(t,e),a="columnHeader"===s?o.columnMove.x:"rowHeader"===s||o.table.internalProps.layoutMap.isSeriesNumberInBody(t,e)?o.columnMove.y:0,{backX:l,lineX:h,backY:c,lineY:d}=o.table.scenegraph.component.showMoveCol(t,e,a);o.table.fireListeners(OS.CHANGE_HEADER_POSITION_START,{col:t,row:e,x:i,y:r,backX:l,lineX:h,backY:c,lineY:d,event:n});const u=!!o.select.ranges?.length;o.table.stateManager.updateSelectPos(-1,-1),o.table.stateManager.endSelectCells(!0,u),o.table.scenegraph.updateNextFrame()}(t,e,i,r,this,o)}updateMoveCol(t,e,i,r,o){!function(t,e,i,r,o,n){if(!("canMoveHeaderPosition"in o.table.internalProps.layoutMap))return;const s=function(t,e,i){const r=i.getCellRange(t.col,t.row);if(i.isColumnHeader(t.col,t.row)){const o=i.getCellRange(e.col,r.start.row);e.row>=i.columnHeaderLevelCount&&(e.row=i.columnHeaderLevelCount-1),e.col>=t.col?e.col=o.end.col:e.col=o.start.col}else if(i.isRowHeader(t.col,t.row)){const o=i.internalProps.layoutMap,n=i.getCellRange(r.start.col,e.row);if(e.col>=i.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount&&(e.col=i.rowHeaderLevelCount+o.leftRowSeriesNumberColumnCount-1),"tree"===o.rowHierarchyType){const r=o.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths,n=o.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths;if(r.length<=n.length){const o=n[r.length-1];o&&(e.row>=t.row?e.row=o.startInTotal+o.size-1+i.columnHeaderLevelCount:e.row=o.startInTotal+i.columnHeaderLevelCount)}}else e.row>=t.row?e.row=n.end.row:e.row=n.start.row}return e}({col:o.columnMove.colSource,row:o.columnMove.rowSource},{col:t,row:e},o.table);if(o.table.internalProps.layoutMap.canMoveHeaderPosition({col:o.columnMove.colSource,row:o.columnMove.rowSource},{col:s.col,row:s.row})){if(o.columnMove.x=i-o.table.tableX,o.columnMove.y=r-o.table.tableY,o.columnMove.colTarget=s.col,o.columnMove.rowTarget=s.row,o.table.isListTable()){const t=o.table.getRecordIndexByCell(s.col,s.row),e=o.table.getRecordByCell(s.col,s.row),i=o.table.getRecordHierarchyState(s.col,s.row);o.columnMove.rowTargetSize=uS(t,i,e)+1}let a,l,h,c;o.updateCursor("grabbing");const d=o.table.getCellLocation(o.columnMove.colSource,o.columnMove.rowSource);"columnHeader"===d?(l=o.columnMove.x,a=o.table.isLeftFrozenColumn(t)?o.columnMove.colTarget>=o.columnMove.colSource?o.table.getColsWidth(0,o.columnMove.colTarget):o.table.getColsWidth(0,o.columnMove.colTarget-1):o.table.isRightFrozenColumn(t)?o.table.tableNoFrameWidth-o.table.getColsWidth(s.col+1,o.table.colCount-1):(o.columnMove.colTarget>=o.columnMove.colSource?o.table.getColsWidth(0,o.columnMove.colTarget):o.table.getColsWidth(0,o.columnMove.colTarget-1))-o.table.stateManager.scroll.horizontalBarPos):("rowHeader"===d||o.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(c=o.columnMove.y,h=o.table.isFrozenRow(e)?o.columnMove.rowTarget>=o.columnMove.rowSource?o.table.getRowsHeight(0,o.columnMove.rowTarget):o.table.getRowsHeight(0,o.columnMove.rowTarget-1):o.table.isBottomFrozenRow(e)?o.table.tableNoFrameHeight-o.table.getRowsHeight(s.row+1,o.table.rowCount-1):(o.columnMove.rowTarget>=o.columnMove.rowSource?o.table.getRowsHeight(0,o.columnMove.rowTarget):o.table.getRowsHeight(0,o.columnMove.rowTarget-1))-o.table.stateManager.scroll.verticalBarPos),o.table.scenegraph.component.updateMoveCol(l,a,c,h),o.table.fireListeners(OS.CHANGING_HEADER_POSITION,{col:t,row:e,x:i,y:r,backX:l,lineX:a,backY:c,lineY:h,event:n}),o.table.scenegraph.updateNextFrame()}else o.updateCursor("not-allowed"),o.columnMove.colTarget=o.columnMove.colSource,o.columnMove.rowTarget=o.columnMove.rowSource}(t,e,i,r,this,o)}isMoveCol(){return this.columnMove.moving}endMoveCol(){return function(t){let e=!1;if("canMoveHeaderPosition"in t.table.internalProps.layoutMap&&t.columnMove.moving&&t.columnMove.colSource>=0&&t.columnMove.rowSource>=0&&t.columnMove.colTarget>=0&&t.columnMove.rowTarget>=0&&!0!==t.table.options.customConfig?.notUpdateInColumnRowMove){const i=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),r=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),o=t.table._moveHeaderPosition({col:t.columnMove.colSource,row:t.columnMove.rowSource},{col:t.columnMove.colTarget,row:t.columnMove.rowTarget});if(!o||o.targetIndex===o.sourceIndex)return t.updateCursor(),t.columnMove.moving=!1,delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget,t.table.scenegraph.component.hideMoveCol(),t.table.scenegraph.updateNextFrame(),!1;{t.table.internalProps.useOneRowHeightFillAll=!1,t.table.internalProps.layoutMap.clearCellRangeMap();const n=t.table.getCellRange(t.columnMove.colSource,t.columnMove.rowSource),s=t.table.getCellRange(t.columnMove.colTarget,t.columnMove.rowTarget),a=Math.min(n.start.col,s.start.col,i.start.col,r.start.col),l=Math.max(n.end.col,s.end.col,i.end.col,r.end.col),h=Math.min(n.start.row,s.start.row,i.start.row,r.start.row);let c=Math.max(n.end.row,s.end.row,i.end.row,r.end.row);"row"===o.moveType&&"tree"===t.table.internalProps.layoutMap.rowHierarchyType&&(c=o.targetIndex>o.sourceIndex?c+o.targetSize-1:c+o.sourceSize-1),!t.table.transpose&&t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)&&(t.table.changeRecordOrder(o.sourceIndex,o.targetIndex),t.changeCheckboxAndRadioOrder(o.sourceIndex,o.targetIndex)),"column"===o.moveType?qE(a,l,0,-1,t.table):qE(0,-1,h,c,t.table),t.table.clearCellStyleCache(),t.table.internalProps.layoutMap.isSeriesNumberInBody(t.columnMove.colSource,t.columnMove.rowSource)?t.table.scenegraph.updateHeaderPosition(t.table.scenegraph.proxy.colStart,t.table.scenegraph.proxy.colEnd,t.table.scenegraph.proxy.rowStart,t.table.scenegraph.proxy.rowEnd,o.moveType):"column"===o.moveType?t.table.scenegraph.updateHeaderPosition(a,l,0,-1,o.moveType):t.table.scenegraph.updateHeaderPosition(0,-1,h,c,o.moveType),"adjustFrozenCount"===t.table.internalProps.frozenColDragHeaderMode&&t.table.isListTable()&&(t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&!t.table.isLeftFrozenColumn(t.columnMove.colSource)?t.table.frozenColCount+=n.end.col-n.start.col+1:t.table.isLeftFrozenColumn(t.columnMove.colSource)&&!t.table.isLeftFrozenColumn(t.columnMove.colTarget)&&(t.table.frozenColCount-=n.end.col-n.start.col+1),t.table.isRightFrozenColumn(t.columnMove.colTarget)&&!t.table.isRightFrozenColumn(t.columnMove.colSource)?t.table.rightFrozenColCount+=n.end.col-n.start.col+1:t.table.isRightFrozenColumn(t.columnMove.colSource)&&!t.table.isRightFrozenColumn(t.columnMove.colTarget)&&(t.table.rightFrozenColCount-=n.end.col-n.start.col+1)),e=!0}}return t.columnMove.moving=!1,setTimeout((()=>{delete t.columnMove.colSource,delete t.columnMove.rowSource,delete t.columnMove.colTarget,delete t.columnMove.rowTarget}),0),t.table.scenegraph.component.hideMoveCol(),t.columnResize.col<t.table.frozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?(t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1,t.columnResize.isRightFrozen),t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount)):t.columnResize.col>=t.table.colCount-t.table.rightFrozenColCount&&!t.table.isPivotTable()&&!t.table.transpose?t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount):t.table.options.frozenColCount?t.table.scenegraph.component.setFrozenColumnShadow(t.table.frozenColCount-1):t.table.options.rightFrozenColCount&&t.table.scenegraph.component.setRightFrozenColumnShadow(t.table.colCount-t.table.rightFrozenColCount),t.table.scenegraph.updateNextFrame(),!0===t.table.options.customConfig?.notUpdateInColumnRowMove||e}(this)}checkFrozen(){let t=this.table.options.frozenColCount?this.table.options.frozenColCount:this.table.isPivotTable()||this.table.isListTable()&&this.table.internalProps.transpose?(this.table.rowHeaderLevelCount??0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount:0;if(t){t=Math.min(t,this.table.colCount);const e=this.table.getContainer();if(e&&0===e.clientWidth){if(this._frozenObserver)return;return this._frozenObserver=new ResizeObserver((t=>{for(const e of t)if(e.contentRect.width>0)return this.clearFrozenObserver(),this.table.resize(),void setTimeout((()=>{this.checkFrozen()}),0)})),void this._frozenObserver.observe(e)}if(this.table.getColsWidth(0,t-1)>this.table._getMaxFrozenWidth())if(this.table.internalProps.unfreezeAllOnExceedsMaxWidth)this.table._setFrozenColCount(0),this.setFrozenCol(-1);else{const e=this.table._getComputedFrozenColCount(t);this.table._setFrozenColCount(e),this.setFrozenCol(e)}else this.table.frozenColCount!==t&&(this.table._setFrozenColCount(t),this.setFrozenCol(t))}else this.clearFrozenObserver()}clearFrozenObserver(){this._frozenObserver&&(this._frozenObserver.disconnect(),this._frozenObserver=null)}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}setFrozenRow(t){t!==this.frozen.row&&(this.frozen.row=t,this.table.scenegraph.updateRowFrozen())}checkVerticalScrollBarEnd(){const t=this.table.getAllRowsHeight(),e=this.scroll.verticalBarPos,i=this.table.tableNoFrameHeight;e+i>=t&&this.table.fireListeners(OS.SCROLL_VERTICAL_END,{scrollTop:e,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:i,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){const t=this.table.getAllColsWidth(),e=this.scroll.horizontalBarPos,i=this.table.tableNoFrameWidth;e+i>=t&&this.table.fireListeners(OS.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:e,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:i})}updateVerticalScrollBar(t){const e=this.table.getAllRowsHeight(),i=this.scroll.verticalBarPos;let r=Math.ceil(t*(e-this.table.scenegraph.height));Wx(r)&&!isNaN(r)||(r=0);const o=r-this.table.scenegraph.proxy.deltaY-i;if(this.table.fireListeners(OS.CAN_SCROLL,{event:void 0,scrollTop:r-this.table.scenegraph.proxy.deltaY,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:o}).some((t=>!1===t))){const t=this.scroll.verticalBarPos/(e-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(t)}else this.scroll.verticalBarPos=r,this.table.scenegraph.setY(-this.scroll.verticalBarPos,1===t),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(OS.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:o}),i!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(t){const e=this.table.getAllColsWidth(),i=this.scroll.horizontalBarPos;let r=Math.ceil(t*(e-this.table.scenegraph.width));Wx(r)&&!isNaN(r)||(r=0);const o=r-this.table.scenegraph.proxy.deltaX-i;if(this.table.fireListeners(OS.CAN_SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:r-this.table.scenegraph.proxy.deltaX,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:o}).some((t=>!1===t))){const t=this.scroll.horizontalBarPos/(e-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(t)}else this.scroll.horizontalBarPos=r,this.table.scenegraph.setX(-this.scroll.horizontalBarPos,1===t),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(OS.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:o}),i!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(t,e,i=!0){const r=this.table.getAllRowsHeight(),o=this.table.options.customConfig?._disableColumnAndRowSizeRound?1:0;t=Math.max(0,Math.min(t,r-this.table.scenegraph.height-o)),t=Math.ceil(t);const n=this.scroll.verticalBarPos,s=t/(r-this.table.scenegraph.height);if((n!==t||!0===this.table.options?.customConfig?.scrollEventAlwaysTrigger)&&i){let i=t;Wx(i)&&!isNaN(i)||(i=0);const o=i-n;if(this.table.fireListeners(OS.CAN_SCROLL,{event:e?.nativeEvent,scrollTop:i,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:s,dy:o}).some((t=>!1===t))){const t=this.scroll.verticalBarPos/(r-this.table.scenegraph.height);return void this.table.scenegraph.component.updateVerticalScrollBarPos(t)}}(t!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1),this.scroll.verticalBarPos=t,Wx(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-t),this.table.scenegraph.component.updateVerticalScrollBarPos(s);const a=this.scroll.verticalBarPos-n;this.table.fireListeners(OS.SCROLL,{event:e?.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:s,dy:a}),n!==t&&i&&this.checkVerticalScrollBarEnd()}setScrollLeft(t,e,i=!0){this.table.scrollLeft;const r=this.table.getAllColsWidth();this.table.getFrozenColsWidth();const o=this.table.options.customConfig?._disableColumnAndRowSizeRound?1:0;t=Math.max(0,Math.min(t,r-this.table.scenegraph.width-o)),t=Math.ceil(t);const n=this.scroll.horizontalBarPos,s=t/(r-this.table.scenegraph.width);if((n!==t||!0===this.table.options?.customConfig?.scrollEventAlwaysTrigger)&&i){let i=t;Wx(i)&&!isNaN(i)||(i=0);const o=i-n;if(this.table.fireListeners(OS.CAN_SCROLL,{event:e?.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:i,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:s,dx:o}).some((t=>!1===t))){const t=this.scroll.horizontalBarPos/(r-this.table.scenegraph.width);return void this.table.scenegraph.component.updateHorizontalScrollBarPos(t)}}t!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1),this.scroll.horizontalBarPos=t,Wx(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-t),this.table.scenegraph.component.updateHorizontalScrollBarPos(s);const a=this.scroll.horizontalBarPos-n;this.table.fireListeners(OS.SCROLL,{event:e?.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:this.table.theme.scrollStyle?.width,scrollWidth:this.table.theme.scrollStyle?.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:s,dx:a}),n!==t&&i&&this.checkHorizontalScrollBarEnd()}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{this.table.scenegraph?.component.hideVerticalScrollBar()}),1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){this.table.scenegraph.component.showHorizontalScrollBar(),this.table.scenegraph?.component.showFrozenColumnShadow(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{this.table.scenegraph?.component.hideFrozenColumnShadow(),this.table.scenegraph?.component.hideHorizontalScrollBar()}),1e3))}triggerContextMenu(t,e,i,r){this.menu.isShow&&this.menu.x===i&&this.menu.y===r?this.hideMenu():this.showContextMenu(t,e,i,r)}showContextMenu(t,e,i,r){this.table.internalProps.menu?.contextMenuItems&&("html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=r,this.table.scenegraph.component.menu.attach(i,r,t,e,eH.contextmenu)),this.table.fireListeners(OS.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,r,o){this.table.fireListeners(OS.DROPDOWN_ICON_CLICK,{col:t,row:e,event:o}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,r)}showDropDownMenu(t,e,i,r){"html"===this.table.internalProps.menu.renderMode?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,r,t,e,eH.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(OS.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const o=this.table.scenegraph.getCell(t,e);let n;o.forEachChildren((t=>t.attribute.funcType===Fx.dropDown&&(n=t,!0))),n&&(this.residentHoverIcon={col:t,row:e,icon:n},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,o),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(OS.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(OS.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:r}=t[e],o=this.table.getCellRange(i,r);if(o)for(let t=o.start.col;t<=o.end.col;t++)for(let e=o.start.row;e<=o.end.row;e++)this.table.scenegraph.updateCellContent(t,e)}}dropDownMenuIsHighlight(t,e,i){const r=this.menu.dropDownMenuHighlight;if(Array.isArray(r))for(let o=0;o<r.length;o++){const n=r[o];let{col:s,row:a}=n;const{field:l,menuKey:h}=n;if("number"!=typeof s||"number"!=typeof a)if(this.table.isPivotTable()&&(Array.isArray(l),1)){const t=this.table.internalProps.layoutMap.getPivotCellAdress(l);if(!t)continue;s=t.col,a=t.row}else{const t=this.table.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!t)continue;s=t.col,a=t.row}if(Wx(s)&&Wx(a)&&this.table.isCellRangeEqual(t,e,s,a)){let r=this.table._getHeaderLayoutMap(s??t,a??e).dropDownMenu||this.table.globalDropDownMenu;if("function"==typeof r&&(r=r({row:a,col:s,table:this.table})),r)for(let t=0;t<r.length;t++){const e=r[t];if(Nx(e)&&(e.menuKey||e.text)===(h||"")&&t===i)return!0;if(Vx(e)&&e===h&&t===i)return!0}}}return!1}triggerSort(t,e,i,r){if(this.table.isPivotTable()){const i=this.table.getPivotSortState(t,e),o=i?i.toUpperCase():"NORMAL",n="ASC"===o?"DESC":"DESC"===o?"NORMAL":"ASC";return this.table.sort(t,e,n),void this.table.fireListeners(XE.PIVOT_SORT_CLICK,{col:t,row:e,order:o||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:r})}const o=[...this.sort],n=this.table.internalProps.multipleSort||!o.length?null:this.sort[this.sort.length-1];KE(t,e,this.table,r);const s=this.table.getCellRange(t,e),a=this.sort.find((t=>t.col===s.start.col&&t.row===s.start.row)),l=this.table.internalProps.multipleSort||!n?null:n.col,h=this.table.internalProps.multipleSort||!n?null:n.row,c=o.findIndex((i=>i.col===t&&i.row===e));c>=0&&o.splice(c,1),this.table.scenegraph.updateSortIcon({col:t,row:e,iconMark:i,order:a?.order,oldSortCol:l,oldSortRow:h,oldIconMark:n?.icon}),a&&(a.icon=i),this.table.internalProps.multipleSort||o.forEach((t=>{this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:"normal",oldSortCol:t.col,oldSortRow:t.row,oldIconMark:null})})),this.table.fireListeners(XE.AFTER_SORT,{order:a?.order,field:this.table.getHeaderField(t,e),event:r})}updateSortState(t){t=Array.isArray(t)?t:[t];for(let e=0;e<t.length;e++){if(t[e].field===this.sort[e]?.field&&t[t.length-1].order===this.sort[e]?.order)return;const i=this.table.internalProps.multipleSort?null:this.sort[e]?.col||null,r=this.table.internalProps.multipleSort?null:this.sort[e]?.row||null;"asc"===this.sort[e]?.order||this.sort[e]?.order,this.setSortState(t.slice(0,e+1));const o=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t[e].field);this.sort[e].col=o.col,this.sort[e].row=o.row;let n;dS(this.table.scenegraph.getCell(this.sort[e].col,this.sort[e].row),"children",(t=>"sort"===t.attribute.funcType&&(n=t,!0))),this.table.scenegraph.updateSortIcon({col:this.sort[e].col,row:this.sort[e].row,iconMark:n,order:this.sort[e].order,oldSortCol:i,oldSortRow:r,oldIconMark:this.sort[e]?.icon})}const e=[];this.table.internalProps.layoutMap.columnTree.tree.children.forEach((i=>{t.some((t=>t.field===i.field))||e.push(i)}));for(let t=0;t<e.length;t++){const i=e[t];this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:null,oldSortCol:i.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount??0,oldSortRow:i.level,oldIconMark:null})}}triggerFreeze(t,e,i){if(!this.table.isPivotTable()&&!this.table.transpose){if(function(t,e,i){i.frozenColCount>0?t!==i.frozenColCount-1?i.setFrozenColCount(t+1):i.setFrozenColCount(0):i.setFrozenColCount(t+1)}(t,0,this.table),this.table.hasListeners(XE.FREEZE_CLICK)){const i=this.table.internalProps.layoutMap.columnObjects.slice(0,t+1);this.table.fireListeners(XE.FREEZE_CLICK,{col:t,row:e,fields:i.reduce(((t,e)=>t.concat(e.field)),[]),colCount:this.table.frozenColCount})}this.frozen.icon=i}}updateCursor(t="default"){this.table.getElement().style.cursor=t}updateDrillState(t,e,i,r,o,n){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=r,this.drill.col=o,this.drill.row=n,function(t,e,i,r,o){const n=o.getCellLocation(t,e);let s=0,a=0,l=!1;"columnHeader"===n?(s=o.getColsWidth(0,o.rowHeaderLevelCount-1)-(0===o.frozenColCount?o.scrollLeft:0),a=o.getRowsHeight(0,e-1)+o.getRowHeight(e)/2,l=!0):"rowHeader"===n&&(a=o.getRowsHeight(0,o.columnHeaderLevelCount-1),s=o.getColsWidth(0,t-1)+o.getColWidth(t)/2,l=!0),o.scenegraph.updateDrill(l,s,a,i,r)}(o,n,i,r,this.table)}updateSparklineHoverPose(t,e,i,r){-1!==this.sparkLine.col&&-1!==this.sparkLine.row&&function(t,e,i){const r=i.scenegraph.getCell(t,e).getChildByName("sparkline"),o=r?.getChildByName("highlight-line"),n=r?.getChildByName("highlight-symbol");o&&o.setAttributes({visible:!1,pickable:!1}),n&&n.setAttributes({visible:!1,pickable:!1}),i.scenegraph.updateNextFrame()}(this.sparkLine.col,this.sparkLine.row,this.table);let o=!1;-1!==t&&-1!==e&&(o=function(t,e,i,r,o){const n=o.scenegraph.getCell(t,e).getChildByName("sparkline"),s=n?.getChildByName("sparkline-line"),a=n?.getChildByName("sparkline-symbol-group");if(!s)return!1;const l=s.bandwidth,h=s.min,c=s.max,d=s.attribute.points;let u;i-=n.globalAABBBounds.x1,n.globalAABBBounds.y1;for(let t=0;t<d.length;t++){const{x:e,y:r,defined:o,rawData:g}=d[t];if(Math.abs(i-e)<l/2&&(u={point:d[t],points:d,pointsBandWidth:l,pointData:g},o)){const t=n.getChildByName("highlight-line");if(t)t.setAttributes({points:[{x:e,y:c},{x:e,y:h}],visible:!0,pickable:!0});else{const t=sh({points:[{x:e,y:c},{x:e,y:h}],lineWidth:s.hover?.strokeWidth,stroke:s.hover?.stroke});t.name="highlight-line",n.addChild(t)}const i=n.getChildByName("highlight-symbol");if(i)i.setAttributes({x:e,y:r,visible:!0,pickable:!0});else{const t=rh({x:e,y:r,stroke:a.hover.stroke,lineWidth:a.hover.strokeWidth,fill:a.hover.fill,size:2*a.hover.size,symbolType:"circle"});t.name="highlight-symbol",n.addChild(t)}break}}if(o.scenegraph.updateNextFrame(),u){const i={col:t,row:e,field:o.getHeaderField(t,e),value:o.getCellValue(t,e),dataValue:o.getCellOriginValue(t,e),cellHeaderPaths:o.internalProps.layoutMap.getCellHeaderPaths(t,e),title:o.getBodyColumnDefine(t,e).title,cellRange:o.getCellRelativeRect(t,e),sparkline:{pointData:u.pointData},scaleRatio:o.canvas.getBoundingClientRect().width/o.canvas.offsetWidth};o.fireListeners(OS.MOUSEOVER_CHART_SYMBOL,i)}return!0}(t,e,i,0,this.table)),o?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,r){return function(t,e,i,r,o){const n=o.table.getCellRange(t,e);if(n.start.col!==n.end.col||n.start.row!==n.end.row)for(let t=n.start.col;t<=n.end.col;t++)for(let e=n.start.row;e<=n.end.row;e++)QE(t,e,i,r,o);else QE(t,e,i,r,o)}(t,e,i,r,this)}setHeaderCheckedState(t,e){return function(t,e,i){i.headerCheckedState[t]=e,i.table.internalProps.enableCheckboxCascade&&i.checkedState?.forEach((i=>{i[t]=e}))}(t,e,this)}syncCheckedState(t,e,i,r){return function(t,e,i,r,o){if(o.table.isHeader(t,e)){if(Wx(o.headerCheckedState[i]))return o.headerCheckedState[i];if("function"==typeof r)return;if(Wx(r))o.headerCheckedState[i]=r;else if(o.checkedState?.size>0)return o.updateHeaderCheckedState(i,t,e);return o.headerCheckedState[i]}const n=o.table.getRecordShowIndexByCell(t,e);if(n>=0){const t=o.table.dataSource.getIndexKey(n).toString();if(Wx(o.checkedState.get(t)?.[i]))return o.checkedState.get(t)[i];if(o.checkedState.get(t))o.checkedState.get(t)[i]=r;else if(o.table.internalProps.enableCheckboxCascade&&t.includes(",")){const e=t.split(",").slice(0,-1).join(",");o.checkedState.has(e)&&!0===o.checkedState.get(e)[i]?o.checkedState.set(t,{[i]:!0}):o.checkedState.set(t,{[i]:r})}else o.checkedState.set(t,{[i]:r})}return r}(t,e,i,r,this)}initCheckedState(t){return tF(t,this)}updateHeaderCheckedState(t,e,i){return function(t,e,i,r){let o=!0,n=!0,s=!1;return e.checkedState.forEach(((a,l)=>{l=l.includes(",")?l.split(",").map((t=>Number(t))):Number(l);const h=e.table.getTableIndexByRecordIndex(l),c=e.table.transpose?e.table.getCustomMerge(h,r):e.table.getCustomMerge(i,h),d=e.table.dataSource?.get(l);c||!e.table.internalProps.enableCheckboxCascade&&d?.vtableMerge||(!0!==a?.[t]?o=!1:(n=!1,s=!0))})),o?(e.headerCheckedState[t]=!0,o):n?(e.headerCheckedState[t]=!1,!1):!!s&&(e.headerCheckedState[t]="indeterminate","indeterminate")}(t,this,e,i)}initLeftRecordsCheckState(t){return function(t,e){for(let i=e.checkedState.size;i<t.length;i++){const r=t[i];e._checkboxCellTypeFields.forEach((t=>{const o=r[t];let n;Nx(o)?n=o.checked:"boolean"==typeof o&&(n=o);const s=i.toString();e.checkedState.get(s)||e.checkedState.set(s,{}),e.checkedState.get(s)[t]=n}))}}(t,this)}setRadioState(t,e,i,r,o){!function(t,e,i,r,o,n){const s=n.table.getRecordShowIndexByCell(t,e);if(s>=0){const t=n.table.dataSource.getIndexKey(s);"column"===r?Xx(o)?(n.radioState[i]={},n.radioState[i][t]=o):n.radioState[i]=t:(n.radioState[i]||(n.radioState[i]={}),Xx(o)?n.radioState[i][t]=o:n.radioState[i][t]=!0)}}(t,e,i,r,o,this)}syncRadioState(t,e,i,r,o,n){return function(t,e,i,r,o,n,s){const a=s.table.getRecordShowIndexByCell(t,e);if(a>=0){const t=s.table.dataSource.getIndexKey(a);if("column"===r){if(!Wx(s.radioState[i])&&n)return Xx(o)?(s.radioState[i]={},s.radioState[i][t]=o):s.radioState[i]=t,!0;if(Xx(s.radioState[i])&&!Xx(o))return s.radioState[i]===t;if(Xx(s.radioState[i])&&Xx(o))return!1;if(Nx(s.radioState[i])&&!Xx(o))return!1;if(Nx(s.radioState[i])&&Xx(o))return s.radioState[i][t]===o}else if("cell"===r){if(!Wx(s.radioState[i])&&n)return s.radioState[i]={},Xx(o)?s.radioState[i][t]=o:s.radioState[i][t]=!0,!0;if(!Wx(s.radioState[i]?.[t])&&n)return Xx(o)?s.radioState[i][t]=o:s.radioState[i][t]=!0,!0;if(zx(s.radioState[i]?.[t])&&!Xx(o))return s.radioState[i][t];if(zx(s.radioState[i]?.[t])&&Xx(o))return!1;if(Xx(s.radioState[i]?.[t])&&!Xx(o))return!1;if(Xx(s.radioState[i]?.[t])&&Xx(o))return s.radioState[i][t]===o}}return n}(t,e,i,r,o,n,this)}changeCheckboxAndRadioOrder(t,e){this.checkedState.size&&function(t,e,i){const{checkedState:r,table:o}=i;let n,s;if(o.internalProps.transpose?(t=o.getRecordShowIndexByCell(t,0),e=o.getRecordShowIndexByCell(e,0)):(n=o.isPivotTable()?void 0:o.getRecordIndexByCell(0,t),s=o.isPivotTable()?void 0:o.getRecordIndexByCell(0,e)),Xx(n)&&Xx(s)){if((t=n)>(e=s)){const i=r.get(t.toString());for(let i=t;i>e;i--)r.set(i.toString(),r.get((i-1).toString()));r.set(e.toString(),i)}else if(t<e){const i=r.get(t.toString());for(let i=t;i<e;i++)r.set(i.toString(),r.get((i+1).toString()));r.set(e.toString(),i)}}else if(Ux(n)&&Ux(s))if((t=n[n.length-1])>(e=s[s.length-1])){const i=r.get(n.toString());for(let i=t;i>e;i--){const t=[...n];t[t.length-1]=i;const e=[...n];e[e.length-1]=i-1,r.set(t.toString(),r.get(e.toString()))}r.set(s.toString(),i)}else if(t<e){const i=r.get(n.toString());for(let i=t;i<e;i++){const t=[...n];t[t.length-1]=i;const e=[...n];e[e.length-1]=i+1,r.set(t.toString(),r.get(e.toString()))}r.set(s.toString(),i)}}(t,e,this),this.radioState.length&&function(t,e,i){const{radioState:r,table:o}=i;if(o.internalProps.transpose?(t=o.getRecordShowIndexByCell(t,0),e=o.getRecordShowIndexByCell(e,0)):(t=o.getRecordShowIndexByCell(0,t),e=o.getRecordShowIndexByCell(0,e)),t>e){const i=r[t];for(let i=t;i>e;i--)r[i]=r[i-1];r[e]=i}else if(t<e){const i=r[t];for(let i=t;i<e;i++)r[i]=r[i+1];r[e]=i}}(t,e,this)}setCustomSelectRanges(t){!function(t){const{customSelectedRangeComponents:e}=t.table.scenegraph;e.forEach(((t,e)=>{t.rect.delete()})),e.clear(),t.select.customSelectRanges=[]}(this),function(t,e){const{customSelectedRangeComponents:i}=e.table.scenegraph;t.forEach((t=>{const{range:e,style:r}=t,o=hh({fill:r.cellBgColor??!1,stroke:r.cellBorderColor??!1,lineWidth:r.cellBorderLineWidth??0,lineDash:r.cellBorderLineDash??[],pickable:!1});i.set(`${e.start.col}-${e.start.row}-${e.end.col}-${e.end.row}`,{rect:o,role:"body"})})),e.select.customSelectRanges=t,Yk(e.table.scenegraph),e.table.scenegraph.updateNextFrame()}(t,this)}}function oF(t){if(t.eventManager.bindSparklineHoverEvent)return;let e=!1;if(t.isPivotTable()){e=t.internalProps.layoutMap.indicatorsDefine.some((t=>"string"!=typeof t&&"sparkline"===t.cellType))}else{e=t.internalProps.layoutMap.columnObjects.some((t=>"sparkline"===t.cellType||"function"==typeof t.cellType))}e&&(t.eventManager.bindSparklineHoverEvent=!0,t.on(OS.MOUSEMOVE_CELL,(e=>{const{col:i,row:r,x:o,y:n}=e;"sparkline"!==t.getBodyColumnType(i,r)&&t.stateManager.updateSparklineHoverPose(-1,-1,0,0),t.stateManager.updateSparklineHoverPose(i,r,o,n)})),t.on(OS.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateSparklineHoverPose(-1,-1,0,0)})))}function nF(t,e,i=!0){let{deltaX:r,deltaY:o}=t;t.shiftKey&&t.deltaY&&(r=o,o=0);const[n,s]=function(t,e,i){const r=2,o=Math.abs(t/e),n=o<=1/r?0:t,s=o>r?0:e;return[Math.ceil(n*(i.horizontal??0)),Math.ceil(s*(i.vertical??0))]}(r,o,{horizontal:1,vertical:1});(n||s)&&e.interactionState!==Tx.scrolling&&e.updateInteractionState(Tx.scrolling);const a="scrolling"===e.table.options.theme?.scrollStyle?.visible;n&&(e.setScrollLeft(e.scroll.horizontalBarPos+n,t),e.showHorizontalScrollBar(a)),s&&(e.setScrollTop(e.scroll.verticalBarPos+s,t),e.showVerticalScrollBar(a)),i&&e.resetInteractionState(e.interactionStateBeforeScroll),t.nativeEvent?.cancelable&&("none"===e.table.internalProps.overscrollBehavior||Math.abs(o)>=Math.abs(r)&&0!==o&&sF(o,e)||Math.abs(o)<=Math.abs(r)&&0!==r&&aF(r,e))&&t.nativeEvent.preventDefault()}function sF(t,e){return 0!=e.table.getAllRowsHeight()-e.table.scenegraph.height&&(!function(t,e){const i=e.table.getAllRowsHeight()-e.table.scenegraph.height;return 0!==i&&t<=0&&e.scroll.verticalBarPos<1}(t,e)&&!function(t,e){const i=e.table.options.customConfig?._disableColumnAndRowSizeRound?1:0,r=e.table.getAllRowsHeight()-e.table.scenegraph.height;return 0!==r&&t>=0&&Math.abs(e.scroll.verticalBarPos-r)<1+i}(t,e))}function aF(t,e){return 0!=e.table.getAllColsWidth()-e.table.scenegraph.width&&(!function(t,e){const i=e.table.getAllColsWidth()-e.table.scenegraph.width;return 0!==i&&t<=0&&e.scroll.horizontalBarPos<1}(t,e)&&!function(t,e){const i=e.table.options.customConfig?._disableColumnAndRowSizeRound?1:0,r=e.table.getAllColsWidth()-e.table.scenegraph.width;return 0!==r&&t>=0&&Math.abs(e.scroll.horizontalBarPos-r)<1+i}(t,e))}class lF{friction;lastTime;speedX;speedY;stateManager;runingId;scrollHandle;constructor(t){this.stateManager=t}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){const t=Date.now(),e=t-this.lastTime;let i=!0;const r=Math.pow(this.friction,e/16),o=r*this.speedX,n=r*this.speedY;let s=0,a=0;Math.abs(o)>.05&&(i=!1,s=(this.speedX+o)/2*e),Math.abs(n)>.05&&(i=!1,a=(this.speedY+n)/2*e),this.scrollHandle?.(s,a),i?this.runingId=null:(this.lastTime=t,this.speedX=o,this.speedY=n,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function hF(t,e,i){if(e&&-1!==t.stateManager.columnMove?.colSource&&-1!==t.stateManager.columnMove?.rowSource&&-1!==t.stateManager.columnMove?.colTarget&&-1!==t.stateManager.columnMove?.rowTarget){if(t.hasListeners(OS.CHANGE_HEADER_POSITION)){const{colSource:e,rowSource:r,colTarget:o,rowTarget:n}=t.stateManager.columnMove,s=t.stateManager.columnMove.rowSourceSize??0,a=t.stateManager.columnMove.rowTargetSize??0;t.fireListeners(OS.CHANGE_HEADER_POSITION,{target:{col:o,row:n+a-s},source:{col:e,row:r},event:i})}}else if(!e&&t.hasListeners(OS.CHANGE_HEADER_POSITION_FAIL)){const e=t.stateManager.columnMove.rowSourceSize??0,r=t.stateManager.columnMove.rowTargetSize??0;t.fireListeners(OS.CHANGE_HEADER_POSITION_FAIL,{target:{col:t.stateManager.columnMove.colTarget,row:t.stateManager.columnMove.rowTarget+r-e},source:{col:t.stateManager.columnMove.colSource,row:t.stateManager.columnMove.rowSource},event:i})}}function cF(t){const e=t.table,i=e.stateManager;e.scenegraph.tableGroup.addEventListener("pointermove",(r=>{const o=e.eventManager.LastPointerXY?.x??r.x,n=e.eventManager.LastPointerXY?.y??r.y;e.eventManager.LastPointerXY={x:r.x,y:r.y},t.touchSetTimeout&&(clearTimeout(t.touchSetTimeout),t.touchSetTimeout=void 0);const s=FM(r);if(s.eventArgs&&e.hasListeners(OS.MOUSEMOVE_TABLE)&&e.fireListeners(OS.MOUSEMOVE_TABLE,{col:s.eventArgs.col,row:s.eventArgs.row,x:s.abstractPos.x,y:s.abstractPos.y,event:r.nativeEvent,target:s?.eventArgs?.target,mergeCellInfo:s.eventArgs?.mergeInfo}),i.interactionState===Tx.grabing&&!e.editorManager?.editingEditor)return void(Math.abs(o-r.x)+Math.abs(n-r.y)>=1&&(i.isResizeCol()||i.isResizeRow()||(i.isMoveCol()?t.dealColumnMover(s):i.isFillHandle()?t.dealFillSelect(s,!0):e.options.select?.disableDragSelect||t.dealTableSelect(s,!0))));!e.options.select?.disableDragSelect&&e.eventManager.isDraging&&i.isSelecting()&&!e.editorManager?.editingEditor&&t.dealTableSelect(s,!0);const a=r.path.find((t=>"cell"===t.role));if(e.hasListeners(OS.MOUSELEAVE_CELL)&&(-1===e.stateManager.hover.cellPos.col||-1===e.stateManager.hover.cellPos.row||a?.col===e.stateManager.hover.cellPos.col&&a?.row===e.stateManager.hover.cellPos.row||e.fireListeners(OS.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:s?.eventArgs?.target})),e.hasListeners(OS.MOUSEENTER_CELL)&&("cell"!==a?.role||!Wx(a.col)||!Wx(a.row)||a.col===e.stateManager.hover.cellPos.col&&a.row===e.stateManager.hover.cellPos.row||a.col===e.stateManager.hover.cellPosContainHeader?.col&&a.row===e.stateManager.hover.cellPosContainHeader?.row||e.fireListeners(OS.MOUSEENTER_CELL,{col:a.col,row:a.row,cellRange:e.getCellRangeRelativeRect({col:a.col,row:a.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:s?.eventArgs?.target,mergeCellInfo:s.eventArgs?.mergeInfo})),t.dealIconHover(s),t.dealTableHover(s),e.theme.columnResize.visibleOnHover&&t.checkColumnResize(s,!0),s.eventArgs&&e.hasListeners(OS.MOUSEMOVE_CELL)){let t,i;if(s.eventArgs?.target){const e=ZE(s.eventArgs?.target);e&&(t=e.icon,i=e.position)}e.fireListeners(OS.MOUSEMOVE_CELL,{col:s.eventArgs.col,row:s.eventArgs.row,x:s.abstractPos.x,y:s.abstractPos.y,event:r.nativeEvent,targetIcon:t?{name:t.name,position:i,funcType:t.attribute.funcType}:void 0,target:s?.eventArgs?.target,mergeCellInfo:s.eventArgs?.mergeInfo})}})),e.scenegraph.tableGroup.addEventListener("pointerout",(e=>{const i=FM(e),r=i?.eventArgs?.target;"table"===r?.role&&t.dealTableHover()})),e.scenegraph.tableGroup.addEventListener("pointerover",(t=>{const i=FM(t),r=i?.eventArgs?.target;if(r&&e.hasListeners(OS.MOUSEOVER_CHART_SYMBOL)&&"symbol"===r.type){const r=t.composedPath().find((t=>"cell"===t.roll));if(r){const{col:o,row:n}=r,s={col:o,row:n,field:e.getHeaderField(o,n),value:e.getCellValue(o,n),dataValue:e.getCellOriginValue(o,n),cellHeaderPaths:e.internalProps.layoutMap.getCellHeaderPaths(o,n),title:e.getBodyColumnDefine(o,n).title,cellRange:e.getCellRelativeRect(o,n),event:t.nativeEvent,sparkline:{pointData:void 0},scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:i?.eventArgs?.target};e.fireListeners(OS.MOUSEOVER_CHART_SYMBOL,s)}}})),e.scenegraph.tableGroup.addEventListener("pointerenter",(t=>{(e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.horizontalVisible||!e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.showHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.verticalVisible||!e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.showVerticalScrollBar(),e.hasListeners(OS.MOUSEENTER_TABLE)&&e.fireListeners(OS.MOUSEENTER_TABLE,{event:t.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerleave",(r=>{i.isResizeCol()||i.isResizeRow()||i.isMoveCol()||i.isSelecting()||(i.updateInteractionState(Tx.default),i.updateCursor()),(e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.horizontalVisible||!e.theme.scrollStyle.horizontalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.hideHorizontalScrollBar(),(e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.verticalVisible||!e.theme.scrollStyle.verticalVisible&&"focus"===e.theme.scrollStyle.visible)&&i.hideVerticalScrollBar(),e.hasListeners(OS.MOUSELEAVE_CELL)&&-1!==e.stateManager.hover.cellPos.col&&-1!==e.stateManager.hover.cellPos.row&&e.fireListeners(OS.MOUSELEAVE_CELL,{col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row,cellRange:e.getCellRangeRelativeRect({col:e.stateManager.hover.cellPos.col,row:e.stateManager.hover.cellPos.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:void 0}),t.dealTableHover();const o=r.target;o&&!o.isDescendantsOf(e.scenegraph.tableGroup)&&e.fireListeners(OS.MOUSELEAVE_TABLE,{event:r.nativeEvent})})),e.scenegraph.tableGroup.addEventListener("pointerdown",(r=>{if(e.hasListeners(OS.MOUSEDOWN_TABLE)&&e.fireListeners(OS.MOUSEDOWN_TABLE,{event:r.nativeEvent}),function(){try{const t=window.getSelection();if(t){if("function"==typeof t.removeAllRanges)return void t.removeAllRanges();if("function"==typeof t.empty)return void t.empty();if("function"==typeof t.collapse)return void t.collapse(document.body,0)}}catch(t){}}(),e.eventManager.isDown=!0,e.eventManager.LastBodyPointerXY={x:r.x,y:r.y},e.eventManager.LastPointerXY={x:r.x,y:r.y},0!==r.button)return;const o=FM(r);if(t.downIcon=void 0,i.interactionState!==Tx.default)return;if(e.isPivotChart()&&"chart"!==o?.eventArgs?.target.type&&e.scenegraph.updateChartState(null),o.eventArgs?.target!==i.residentHoverIcon?.icon&&i.hideMenu(),"chart"===o?.eventArgs?.target.type)return;const n=e.editorManager?.completeEdit(r.nativeEvent);RS(n,(n=>{if(!1===n)return;const s=o?.eventArgs?.target?.role?.startsWith("icon")?o.eventArgs.target:r.target.role?.startsWith("icon")?r.target:void 0;if(t.downIcon=s,s&&!1!==s.attribute.interactive)s.attribute.funcType===Fx.dragReorder&&(i.startMoveCol(o.eventArgs.col,o.eventArgs.row,o.abstractPos.x,o.abstractPos.y,o.eventArgs?.event?.nativeEvent),i.updateInteractionState(Tx.grabing));else{if(t.cellIsHeaderCheck(o))return;if("touch"===r.pointerType){if(t.touchEnd=!1,t.touchSetTimeout=setTimeout((()=>{t.isTouchdown=!1,t.isLongTouch=!0,(t.touchEnd||!t.checkColumnResize(o,!0)&&!t.checkRowResize(o,!0))&&(t.touchEnd||!t.checkColumnMover(o))?t.dealTableSelect(o)&&!t.touchEnd&&i.updateInteractionState(Tx.grabing):i.updateInteractionState(Tx.grabing)}),500),e.hasListeners(OS.MOUSEENTER_CELL)){const t=r.path.find((t=>"cell"===t.role));"cell"!==t?.role||!Wx(t.col)||!Wx(t.row)||t.col===e.stateManager.hover.cellPos.col&&t.row===e.stateManager.hover.cellPos.row||t.col===e.stateManager.hover.cellPosContainHeader?.col&&t.row===e.stateManager.hover.cellPosContainHeader?.row||e.fireListeners(OS.MOUSEENTER_CELL,{col:t.col,row:t.row,cellRange:e.getCellRangeRelativeRect({col:t.col,row:t.row}),scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,event:r.nativeEvent,target:o?.eventArgs?.target,mergeCellInfo:o.eventArgs?.mergeInfo})}t.dealTableHover(o)}else{if(!t.checkCellFillhandle(o)&&(t.checkColumnResize(o,!0)||t.checkRowResize(o,!0)))return e.scenegraph.updateChartState(null),void i.updateInteractionState(Tx.grabing);if(t.checkColumnMover(o))return void i.updateInteractionState(Tx.grabing);if(t.checkCellFillhandle(o,!0)&&t.dealFillSelect(o))return void i.updateInteractionState(Tx.grabing);t.dealTableSelect(o)&&i.updateInteractionState(Tx.grabing)}}if(e.hasListeners(OS.MOUSEDOWN_CELL)){const t=FM(r);t.eventArgs&&e.fireListeners(OS.MOUSEDOWN_CELL,{col:t.eventArgs.col,row:t.eventArgs.row,event:r.nativeEvent,target:t?.eventArgs?.target,mergeCellInfo:t.eventArgs.mergeInfo})}}))})),e.scenegraph.tableGroup.addEventListener("pointerup",(r=>{if(0===r.button){if("grabing"===i.interactionState){if(i.updateInteractionState(Tx.default),i.isResizeCol())uF(e);else if(i.isResizeRow())gF(e);else if(i.isMoveCol()){const t=e.stateManager.endMoveCol();hF(e,t,r.nativeEvent)}else if(i.isSelecting()){e.stateManager.endSelectCells(),e.stateManager.isFillHandle()&&e.stateManager.endFillSelect();const t=FM(r);if(e.eventManager.isDraging&&t.eventArgs&&e.hasListeners(OS.DRAG_SELECT_END)){const i={event:r.nativeEvent,cells:[],col:t.eventArgs.target.col,row:t.eventArgs.target.row,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:t?.eventArgs?.target,mergeCellInfo:t.eventArgs?.mergeInfo};i.cells=e.getSelectedCellInfos(),e.fireListeners(OS.DRAG_SELECT_END,i)}}}else i.interactionState===Tx.scrolling&&i.updateInteractionState(Tx.default);if(!e.eventManager.isDraging){const i=FM(r);if(!t.isTouchMove&&0===r.button&&i.eventArgs&&e.hasListeners(OS.CLICK_CELL)){const{col:t,row:o}=i.eventArgs,n=e.getCellInfo(t,o);let s,a;if(i.eventArgs?.target){const t=ZE(i.eventArgs?.target);t&&(s=t.icon,a=t.position)}const l={...n,event:r.nativeEvent,federatedEvent:r,cells:[],targetIcon:s?{name:s.name,position:a,funcType:s.attribute.funcType}:void 0,target:i?.eventArgs?.target,mergeCellInfo:i.eventArgs?.mergeInfo};e.fireListeners(OS.CLICK_CELL,l)}}if(e.hasListeners(OS.MOUSEUP_CELL)){const t=FM(r);t.eventArgs&&e.fireListeners(OS.MOUSEUP_CELL,{col:t.eventArgs.col,row:t.eventArgs.row,event:r.nativeEvent,target:t?.eventArgs?.target,mergeCellInfo:t.eventArgs?.mergeInfo})}setTimeout((()=>{t.isDown=!1,t.isTouchdown=!1,t.isTouchMove=!1,t.isDraging=!1,t.touchMovePoints=[]}),0)}})),e.scenegraph.tableGroup.addEventListener("rightdown",(t=>{const r=FM(t);if(r.eventArgs){i.triggerContextMenu(r.eventArgs.col,r.eventArgs.row,r.abstractPos.x,r.abstractPos.y);const{col:o,row:n}=r.eventArgs;if(e.hasListeners(OS.CONTEXTMENU_CELL)){const i=e.getCellInfo(o,n);let s,a;if(r.eventArgs?.target){const t=ZE(r.eventArgs?.target);t&&(s=t.icon,a=t.position)}const l={...i,event:t.nativeEvent,cells:[],targetIcon:s?{name:s.name,position:a,funcType:s.attribute.funcType}:void 0,target:r?.eventArgs?.target,mergeCellInfo:r.eventArgs?.mergeInfo};(e.options.eventOptions?.contextmenuReturnAllSelectedCells??1)&&(!function(t,e,i){for(let r=0;r<t.length;r++){const o=t[r],n=Math.min(o.start.col,o.end.col),s=Math.max(o.start.col,o.end.col),a=Math.min(o.start.row,o.end.row),l=Math.max(o.start.row,o.end.row);if(n<=e&&e<=s&&a<=i&&i<=l||s<=e&&e<=n&&l<=i&&i<=a)return!0}return!1}(e.stateManager.select.ranges,o,n)?l.cells=[[i]]:l.cells=e.getSelectedCellInfos()),e.fireListeners(OS.CONTEXTMENU_CELL,l)}}})),e.scenegraph.tableGroup.addEventListener("pointertap",(r=>{if(e.stateManager.columnResize.resizing)return;const o=FM(r);if(!e.stateManager.columnResize.resizing&&!e.stateManager.columnMove.moving&&(t.dealIconClick(r,o),o?.eventArgs&&t.touchSetTimeout&&"touch"===r.pointerType)){const e=FM(r);if(t.touchSetTimeout){clearTimeout(t.touchSetTimeout);const r=!!i.select.ranges?.length;t.dealTableSelect(e),i.endSelectCells(!0,r),t.touchSetTimeout=void 0}}})),e.scenegraph.stage.addEventListener("pointerdown",(r=>{const o=FM(r);o.eventArgs?.target&&o.eventArgs?.target===i.residentHoverIcon?.icon||i.hideMenu();const n=e.editorManager?.completeEdit(r.nativeEvent);RS(n,(n=>{if(!1===n)return;const s=r.target.role?.startsWith("icon")?r.target:void 0;if(t.downIcon=s,"touch"===r.pointerType||s||t.checkCellFillhandle(o)||i.columnResize.resizing||!t.checkColumnResize(o,!0));else{e.scenegraph.updateChartState(null),i.updateInteractionState(Tx.grabing);const{eventArgs:t}=o;if(!t?.targetCell){e.getCellAt(o.abstractPos.x-e.theme.columnResize.resizeHotSpotSize/2,o.abstractPos.y)&&e.hasListeners(OS.MOUSEDOWN_TABLE)&&e.fireListeners(OS.MOUSEDOWN_TABLE,{event:r.nativeEvent})}}}))})),e.scenegraph.stage.addEventListener("pointerup",(t=>{"grabing"===i.interactionState&&(i.updateInteractionState(Tx.default),i.isResizeCol()?uF(e):i.isResizeRow()&&gF(e))})),e.scenegraph.stage.addEventListener("pointertap",(r=>{const o=r.target;if(e.eventManager.isDraging||!o||!o.isDescendantsOf(e.scenegraph.stage)&&o.stage!==o||o.isDescendantsOf(e.scenegraph.tableGroup))e.eventManager.isDraging&&i.isSelecting()&&i.endSelectCells();else{i.updateInteractionState(Tx.default),t.dealTableHover();const r=!!i.select.ranges?.length;(e.options.select?.blankAreaClickDeselect??1)&&t.dealTableSelect(),i.endSelectCells(!0,r),i.updateCursor(),e.scenegraph.updateChartState(null)}})),e.scenegraph.stage.addEventListener("pointermove",(r=>{const o=FM(r);i.isResizeCol()||t.checkColumnResize(o)?e.stateManager.select&&t.checkCellFillhandle(o)?i.updateCursor("crosshair"):i.updateCursor("col-resize"):i.isResizeRow()||t.checkRowResize(o)?e.stateManager.select&&t.checkCellFillhandle(o)?i.updateCursor("crosshair"):i.updateCursor("row-resize"):i.isMoveCol()||i.updateCursor()})),e.scenegraph.tableGroup.addEventListener("checkbox_state_change",(t=>{const i=FM(t),{col:r,row:o}=i.eventArgs,n=e.getCellInfo(r,o),s=CA(e,r,o);if(s)for(let i=s.start.col;i<=s.end.col;i++)for(let r=s.start.row;r<=s.end.row;r++){e.scenegraph.getCell(i,r).forEachChildren((e=>{"checkbox"===e.name&&e.setAttributes({checked:t.target.attribute.checked,indeterminate:t.target.attribute.indeterminate})}))}const a={...n,event:t.nativeEvent,target:i?.eventArgs?.target,mergeCellInfo:i?.eventArgs?.mergeInfo,checked:t.detail.checked};if(e.isHeader(r,o)){if(e.stateManager.setHeaderCheckedState(n.field,t.detail.checked),e.internalProps.enableHeaderCheckboxCascade){"checkbox"===e.getCellType(r,o)&&e.scenegraph.updateCheckboxCellState(r,o,t.detail.checked)}}else if(e.stateManager.setCheckedState(r,o,n.field,t.detail.checked),e.internalProps.enableCheckboxCascade){if("checkbox"===e.getCellType(r,o)){const t=e.stateManager.headerCheckedState[n.field],i=e.stateManager.updateHeaderCheckedState(n.field,r,o);t!==i&&e.scenegraph.updateHeaderCheckboxCellState(r,o,i)}}e.fireListeners(OS.CHECKBOX_STATE_CHANGE,a),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("radio_checked",(t=>{const i=FM(t),{col:r,row:o,target:n}=i.eventArgs,s=e.getCellInfo(r,o),a=zM.exec(n.id)?.[1],l=CA(e,r,o);if(l)for(let t=l.start.col;t<=l.end.col;t++)for(let i=l.start.row;i<=l.end.row;i++){e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id===n.id&&t.setAttributes({checked:!0})}))}const h=e.getBodyColumnDefine(r,o).radioCheckType||"column";if("cell"===h)if(l)for(let t=l.start.col;t<=l.end.col;t++)for(let i=l.start.row;i<=l.end.row;i++){e.scenegraph.getCell(t,i).forEachChildren((t=>{"radio"===t.name&&t.id!==n.id&&t.setAttributes({checked:!1})}))}else{e.scenegraph.getCell(r,o).forEachChildren((t=>{"radio"===t.name&&t.id!==n.id&&t.setAttributes({checked:!1})}))}else if("column"===h){e.scenegraph.getColGroup(r).forEachChildren((t=>{t.forEachChildren((t=>{"radio"===t.name&&t.id!==n.id&&t.setAttributes({checked:!1})}))}))}const c=a?Number(a):void 0;e.stateManager.setRadioState(r,o,s.field,h,c);const d={...s,event:t.nativeEvent,target:i?.eventArgs?.target,mergeCellInfo:i?.eventArgs?.mergeInfo,radioIndexInCell:c};e.fireListeners(OS.RADIO_STATE_CHANGE,d),e.scenegraph.updateNextFrame()})),e.scenegraph.tableGroup.addEventListener("switch_state_change",(t=>{const i=FM(t),{col:r,row:o,target:n}=i.eventArgs,s=e.getCellInfo(r,o),a=CA(e,r,o);if(a)for(let i=a.start.col;i<=a.end.col;i++)for(let r=a.start.row;r<=a.end.row;r++){e.scenegraph.getCell(i,r).forEachChildren((e=>{"switch"===e.name&&e.setAttributes({checked:t.target.attribute.checked})}))}const l={...s,event:t.nativeEvent,target:i?.eventArgs?.target,mergeCellInfo:i?.eventArgs?.mergeInfo,checked:t.detail.checked};e.stateManager.setCheckedState(r,o,s.field,t.detail.checked),e.fireListeners(OS.SWITCH_STATE_CHANGE,l),e.scenegraph.updateNextFrame()})),e.scenegraph.stage.addEventListener("wheel",(t=>{t.path.find((t=>"legend"===t.name))||(e.editorManager?.completeEdit(),e.eventManager._enableTableScroll&&nF(t,i))}))}function dF(t){const e=t.table;t.gesture=new bp(e.scenegraph.tableGroup,{tap:{interval:300}}),t.gesture.on("doubletap",(t=>{!function(t,e){const i=FM(t);let r=-1,o=-1;i.eventArgs&&(r=i.eventArgs.col,o=i.eventArgs.row);const n=e.getCellValue(r,o),s=i.eventArgs?.targetCell?.globalAABBBounds;if(s&&e.internalProps.focusControl.setFocusRect(new US(s.x1+e.scrollLeft,s.y1+e.scrollTop,s.x2-s.x1,s.y2-s.y1),n),e.hasListeners(OS.DBLCLICK_CELL)){const n=e.getCellInfo(r,o);let s,a;if(i.eventArgs?.target){const t=ZE(i.eventArgs?.target);t&&(s=t.icon,a=t.position)}const l={...n,event:t.nativeEvent,federatedEvent:t,cells:[],targetIcon:s?{name:s.name,position:a,funcType:s.attribute.funcType}:void 0,target:i?.eventArgs?.target,mergeCellInfo:i?.eventArgs?.mergeInfo};e.fireListeners(OS.DBLCLICK_CELL,l)}}(t,e)}))}function uF(t){t.stateManager.endResizeCol();const e=[];for(let i=0;i<t.colCount;i++)e.push(t.getColWidth(i));t.fireListeners(OS.RESIZE_COLUMN_END,{col:t.stateManager.columnResize.col,colWidths:e})}function gF(t){t.stateManager.endResizeRow(),t.fireListeners(OS.RESIZE_ROW_END,{row:t.stateManager.rowResize.row,rowHeight:t.getRowHeight(t.stateManager.rowResize.row)})}let pF,fF=1;function mF(){return gS?fF=1:(fF=Math.ceil(window.devicePixelRatio||1),fF>1&&fF%2!=0&&(fF+=1)),fF}function bF(t){const e=t.table,i=e.stateManager,r=e.internalProps.handler;function o(t){if(e.hasListeners(OS.KEYDOWN)){const i={keyCode:t.keyCode??t.which,code:t.code,event:t,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth};e.fireListeners(OS.KEYDOWN,i)}}r.on(e.getElement(),"blur",(e=>{t.dealTableHover()})),r.on(e.getElement(),"keydown",(r=>{const n={keyCode:r.keyCode??r.which,code:r.code,event:r};if(e.fireListeners(OS.BEFORE_KEYDOWN,n),"a"===r.key&&(r.ctrlKey||r.metaKey))e.keyboardOptions?.selectAllOnCtrlA&&(r.preventDefault(),t.deelTableSelectAll());else if(i.select.cellPos.col>=0&&i.select.cellPos.row>=0&&("ArrowUp"===r.key||"ArrowDown"===r.key||"ArrowLeft"===r.key||"ArrowRight"===r.key)){if(!e.options.keyboardOptions?.moveEditCellOnArrowKeys&&e.editorManager?.editingEditor||!1===e.options.keyboardOptions?.moveSelectedCellOnArrowKeys)return;let t,o;if(r.preventDefault(),r.stopPropagation(),"ArrowUp"===r.key?r.ctrlKey||r.metaKey?(t=i.select.cellPos.col,o=0):(r.shiftKey,t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row-1))):"ArrowDown"===r.key?r.ctrlKey||r.metaKey?(t=i.select.cellPos.col,o=e.rowCount-1):(r.shiftKey,t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1))):"ArrowLeft"===r.key?r.ctrlKey||r.metaKey?(t=0,o=i.select.cellPos.row):(r.shiftKey,o=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col-1))):"ArrowRight"===r.key&&(r.ctrlKey||r.metaKey?(t=e.colCount-1,o=i.select.cellPos.row):(r.shiftKey,o=i.select.cellPos.row,t=Math.min(e.colCount-1,Math.max(0,i.select.cellPos.col+1)))),OH(e,t,o))return;e.selectCell(t,o,r.shiftKey),e.options.keyboardOptions?.moveEditCellOnArrowKeys&&e.editorManager?.editingEditor&&(e.editorManager?.completeEdit(),e.getElement().focus(),e.getEditor(t,o)&&e.editorManager?.startEditCell(t,o))}else if("Escape"===r.key)e.editorManager?.cancelEdit(),e.getElement().focus();else if("Enter"===r.key){if(e.editorManager?.editingEditor){if(o(r),e.editorManager?.completeEdit(),e.getElement().focus(),!0===e.options.keyboardOptions?.moveFocusCellOnEnter){const t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1));if(OH(e,t,o))return;e.selectCell(t,o,r.shiftKey)}return}if(!0===e.options.keyboardOptions?.moveFocusCellOnEnter){const t=i.select.cellPos.col,o=Math.min(e.rowCount-1,Math.max(0,i.select.cellPos.row+1));if(OH(e,t,o))return;e.selectCell(t,o,r.shiftKey)}else if((e.options.keyboardOptions?.editCellOnEnter??1)&&1===(e.stateManager.select.ranges?.length??0)){const t=e.stateManager.select.ranges[0].start.col,i=e.stateManager.select.ranges[0].start.row,r=e.stateManager.select.ranges[0].end.col,o=e.stateManager.select.ranges[0].end.row;t===r&&i===o&&e.getEditor(t,i)&&e.editorManager?.startEditCell(t,i)}}else if("Tab"===r.key){if((e.options.keyboardOptions?.moveFocusCellOnTab??1)&&i.select.cellPos.col>=0&&i.select.cellPos.row>=0){if(i.select.cellPos.col===e.colCount-1&&i.select.cellPos.row===e.rowCount-1)return;let t,o;if(r.preventDefault(),i.select.cellPos.col===e.colCount-1?(o=Math.min(e.rowCount-1,i.select.cellPos.row+1),t=e.rowHeaderLevelCount):(o=i.select.cellPos.row,t=i.select.cellPos.col+1),OH(e,t,o))return;e.selectCell(t,o),e.editorManager?.editingEditor&&(e.editorManager?.completeEdit(),e.getElement().focus(),e.getEditor(t,o)&&e.editorManager?.startEditCell(t,o))}}else if(!r.ctrlKey&&!r.metaKey){const t=e.options.editCellTrigger;if(("keydown"===t||Array.isArray(t)&&t.includes("keydown"))&&!e.editorManager?.editingEditor){const t=/^[a-zA-Z0-9+\-*\/%=.,\s]$/;r.key.match(t)&&(e.editorManager&&(e.editorManager.beginTriggerEditCellMode="keydown"),e.editorManager?.startEditCell(i.select.cellPos.col,i.select.cellPos.row,""))}}o(r)})),r.on(e.getElement(),"copy",(async t=>{if(e.keyboardOptions?.copySelected){const i=e.getCopyValue();if(Wx(i)){t.preventDefault();const r=await navigator.permissions.query({name:"clipboard-write"});if(navigator.clipboard?.write&&"granted"===r.state){const t=t=>{const e=["<table>"],i=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join(""),r=t.split("\r\n");return r.forEach((function(t,i){const o=t.split("\t"),n=[];0===i&&e.push("<tbody>"),o.forEach((function(t,e){const i=t?t.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,"<br>\r\n").replace(/\x20{2,}/gi,(t=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(t.length-1)} </span>`)).replace(/\t/gi,"&#9;"):" ";n.push(`<td>${i}</td>`)})),e.push("<tr>",...n,"</tr>"),i===r.length-1&&e.push("</tbody>")})),e.push("</table>"),[i,e.join("")].join("")},e=t(i);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([e],{type:"text/html"}),"text/plain":new Blob([i],{type:"text/plain"})})])}else kS?window.clipboardData.setData("Text",i):t.clipboardData.setData("text/plain",i);e.fireListeners(OS.COPY_DATA,{cellRange:e.stateManager.select.ranges,copyData:i})}}})),r.on(e.getElement(),"paste",(async t=>{if(e.keyboardOptions?.pasteValueToCell&&e.changeCellValues){if(e.editorManager?.editingEditor)return;if(e.stateManager.select.ranges?.length>0)if(navigator.clipboard?.read)navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/html")?a(e):1===e.types.length&&"text/plain"===e.types[0]&&h(e)}));else{const i=e.stateManager.select.ranges,r=Math.min(i[0].start.col,i[0].end.col),o=Math.min(i[0].start.row,i[0].end.row),n=(t.clipboardData||window.Clipboard).getData("text").split("\n"),s=[];n.forEach((function(t,e){const i=t.split("\t"),r=[];s.push(r),i.forEach((function(t,e){e===i.length-1&&(t=t.trim()),r.push(t)}))}));const a=await e.changeCellValues(r,o,s);e.hasListeners(OS.PASTED_DATA)&&e.fireListeners(OS.PASTED_DATA,{col:r,row:o,pasteData:s,changedCellResults:a})}}})),r.on(e.getElement(),"contextmenu",(t=>{!1!==e.eventOptions?.preventDefaultContextMenu?t.preventDefault():u(t)})),e.options.canvas||r.on(e.getContainer(),"resize",(t=>{e.isReleased||0===t.width&&0===t.height||((e.autoFillWidth||e.autoFillHeight)&&e.editorManager?.completeEdit(),Wx(e.options.pixelRatio)||e.setPixelRatio(mF()),t.windowSizeNotChange||e.resize())}));const n=/<tr[^>]*>([\s\S]*?)<\/tr>/g,s=/<td[^>]*>([\s\S]*?)<\/td>/g;function a(t){const i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),a=Math.min(i[r-1].start.row,i[r-1].end.row),h=Math.max(i[r-1].start.col,i[r-1].end.col),d=Math.max(i[r-1].start.row,i[r-1].end.row);let u=0,g=0,p=[];t.getType("text/html").then((t=>{t.text().then((async t=>{if(t&&/(<table)|(<TABLE)/g.test(t)){const i=Array.from(t.matchAll(n));for(const t of i){const e=t[1],i=Array.from(e.matchAll(s)).map((t=>t[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"\t").replace(/&nbsp;/g," ")));p.push(i),u=Math.max(u,i?.length??0)}g=p.length??0,p=c(p,g,u,d-a+1,h-o+1);const r=await e.changeCellValues(o,a,p,!0);e.hasListeners(OS.PASTED_DATA)&&e.fireListeners(OS.PASTED_DATA,{col:o,row:a,pasteData:p,changedCellResults:r})}else navigator.clipboard.read().then((t=>{for(const e of t)e.types.includes("text/plain")&&e.getType("text/plain").then((t=>{t.text().then(l)}))}))}))}))}async function l(t){const i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),n=Math.min(i[r-1].start.row,i[r-1].end.row),s=Math.max(i[r-1].start.col,i[r-1].end.col),a=Math.max(i[r-1].start.row,i[r-1].end.row);let l=0,h=0,d=[];t.split("\n").forEach((function(t,e){const i=t.split("\t"),r=[];d.push(r),i.forEach((function(t,e){e===i.length-1&&(t=t.trim()),r.push(t)})),l=Math.max(l,r?.length??0)})),h=d.length??0,d=c(d,h,l,a-n+1,s-o+1);const u=await e.changeCellValues(o,n,d,!0);e.hasListeners(OS.PASTED_DATA)&&e.fireListeners(OS.PASTED_DATA,{col:o,row:n,pasteData:d,changedCellResults:u})}function h(t){const i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),n=Math.min(i[r-1].start.row,i[r-1].end.row),s=Math.max(i[r-1].start.col,i[r-1].end.col),a=Math.max(i[r-1].start.row,i[r-1].end.row);let l=0,h=0;t.getType("text/plain").then((t=>{t.text().then((async t=>{const i=t.replace(/\r(?!\n)/g,"\r\n").split("\r\n");let r=[];i.length>1&&""===i[i.length-1]&&i.pop(),i.forEach((function(t,e){const i=t.split("\t"),o=[];r.push(o),i.forEach((function(t,e){t.includes("\n")&&(t=t.replace(/^"(.*)"$/,"$1").replace(/["]*/g,(t=>new Array(Math.floor(t.length/2)).fill('"').join("")))),o.push(t)})),l=Math.max(l,o?.length??0)})),h=r.length??0,r=c(r,h,l,a-n+1,s-o+1);const d=await e.changeCellValues(o,n,r,!0);e.hasListeners(OS.PASTED_DATA)&&e.fireListeners(OS.PASTED_DATA,{col:o,row:n,pasteData:r,changedCellResults:d})}))}))}function c(t,e,i,r,o){if(o>i||r>e){if(o%i==0&&r%e==0){const n=[];for(let s=0;s<r;s++){const r=[];n.push(r);for(let n=0;n<o;n++){const o=s%e,a=n%i;r.push(t[o][a])}}return n}return t}return t}const d=r=>{if(e.isReleased)return;e.eventManager.LastBodyPointerXY={x:r.x,y:r.y},e.eventManager.isDown=!0;const o=r.target;if(!e.getElement().contains(o)&&!e.internalProps.menuHandler.containElement(o)){const o=e.editorManager?.completeEdit(r);RS(o,(r=>{if(!1!==r&&e.options.select?.outsideClickDeselect){const e=!!i.select.ranges?.length;t.dealTableSelect(),i.endSelectCells(!0,e)}}))}};t.globalEventListeners.push({name:"pointerdown",env:"vglobal",callback:d}),ju.addEventListener("pointerdown",d);const u=r=>{if(e.isReleased)return;const o=r.target;if(o!==e.canvas&&(t=>{if(i.menu.isShow&&setTimeout((()=>{e.internalProps.menuHandler.pointInMenuElement(t.clientX,t.clientY)||i.menu.isShow&&i.hideMenu()}),0),i.isResizeCol())uF(e);else if(i.isResizeRow())gF(e);else if(i.isMoveCol()){const i=e.stateManager.endMoveCol();hF(e,i,t)}else if(i.isSelecting()&&e.stateManager.select?.ranges?.length){const i=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.col,r=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end.row;if(e.stateManager.endSelectCells(),e.hasListeners(OS.DRAG_SELECT_END)){const o={event:t,cells:[],col:i,row:r,scaleRatio:e.canvas.getBoundingClientRect().width/e.canvas.offsetWidth,target:void 0};o.cells=e.getSelectedCellInfos(),e.fireListeners(OS.DRAG_SELECT_END,o)}}})(r),e.eventManager.LastBodyPointerXY=null,e.eventManager.isDown=!1,e.eventManager.isDraging=!1,e.eventManager.inertiaScroll.endInertia(),"grabing"===i.interactionState&&i.isResizeCol())uF(e);else if("grabing"===i.interactionState&&i.isResizeRow())gF(e);else if(i.isMoveCol()){const t=e.stateManager.endMoveCol();hF(e,t,r)}else if(e.editorManager?.editingEditor&&!e.getElement().contains(o)){const o=e.editorManager?.completeEdit(r);RS(o,(e=>{!1!==e&&(i.updateInteractionState(Tx.default),t.dealTableHover())}))}i.updateInteractionState(Tx.default)};t.globalEventListeners.push({name:"pointerup",env:"vglobal",callback:u}),ju.addEventListener("pointerup",u);const g=r=>{if(e.eventManager.isDown&&e.eventManager.LastBodyPointerXY){const t=e.eventManager.LastBodyPointerXY?.x??r.x,i=e.eventManager.LastBodyPointerXY?.y??r.y;(Math.abs(t-r.x)>1||Math.abs(i-r.y)>1)&&(e.eventManager.isDraging=!0)}const{x:o,y:n}=e._getMouseAbstractPoint(r);i.interactionState===Tx.grabing&&(i.isResizeCol()?(t.dealColumnResize(o,n),e.hasListeners(OS.RESIZE_COLUMN)&&e.fireListeners(OS.RESIZE_COLUMN,{col:e.stateManager.columnResize.col,colWidth:e.getColWidth(e.stateManager.columnResize.col)})):i.isResizeRow()&&(t.dealRowResize(o,n),e.hasListeners(OS.RESIZE_ROW)&&e.fireListeners(OS.RESIZE_ROW,{row:e.stateManager.rowResize.row,rowHeight:e.getRowHeight(e.stateManager.rowResize.row)})));const s=e.stateManager.isSelecting();if(t._enableTableScroll&&t.isDraging&&s&&e.stateManager.select.ranges?.length>0){const t=e.getDrawRange(),i=e.getFrozenRowsHeight(),r=e.getBottomFrozenRowsHeight(),s=e.getFrozenColsWidth(),a=e.getRightFrozenColsWidth(),l=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].start;if(e.isSeriesNumber(l.col,l.row))return;const h=e.stateManager.select.ranges[e.stateManager.select.ranges.length-1].end,c=(!1===e.isFrozenRow(l.row)||!1===e.isFrozenRow(h.row))&&e.getAllRowsHeight()>e.tableNoFrameHeight,d=(!1===e.isFrozenColumn(l.col)||!1===e.isFrozenColumn(h.col))&&e.getAllColsWidth()>e.tableNoFrameWidth;if((n>t.bottom-r||n<t.top+i)&&c||(o>t.right-a||o<t.left+s)&&d){e.eventManager.scrollXSpeed=0,e.eventManager.scrollYSpeed=0;let l=!1,h=!1,u=!1,g=!1;n>t.bottom-r&&c&&e.scrollTop+e.tableNoFrameHeight<e.getAllRowsHeight()?(l=!0,e.eventManager.scrollYSpeed=-(n-t.bottom+r)/50):n<t.top+i&&c&&e.scrollTop>0&&(h=!0,e.eventManager.scrollYSpeed=-(n-t.top-i)/50),o>t.right-a&&d&&e.scrollLeft+e.tableNoFrameWidth<e.getAllColsWidth()?(u=!0,e.eventManager.scrollXSpeed=-(o-t.right+a)/50):o<t.left+s&&d&&e.scrollLeft>0&&(g=!0,e.eventManager.scrollXSpeed=-(o-t.left-s)/50),e.eventManager.inertiaScroll.startInertia(e.eventManager.scrollXSpeed,e.eventManager.scrollYSpeed,1),e.eventManager.inertiaScroll.setScrollHandle(((c,d)=>{let p,f;nF({deltaX:-c,deltaY:-d},e.stateManager,!1),l?f=e.scrollTop+t.height-r-20:h&&(f=e.scrollTop+i+20),u?p=e.scrollLeft+t.width-a-20:g&&(p=e.scrollLeft+s+20);let m=!1,b=!1;u||g||(o>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&o<e.tableNoFrameWidth||o>0&&o<e.getFrozenColsWidth()?(p=o,b=!0):p=e.scrollLeft+o),l||h||(n>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&n<e.tableNoFrameHeight||n>0&&n<e.getFrozenRowsHeight()?(f=n,m=!0):f=e.scrollTop+n),e.stateManager.updateInteractionState(Tx.grabing);const y=e.getTargetColAtConsiderRightFrozen(p,b),C=e.getTargetRowAtConsiderBottomFrozen(f,m);!e.options.select?.disableDragSelect&&Wx(y)&&Wx(C)&&e.stateManager.updateSelectPos(y.col,C.row,!1,!1,!1,!1)}))}else e.eventManager.inertiaScroll.isInertiaScrolling()?e.eventManager.inertiaScroll.endInertia():e.eventManager.scrollYSpeed=0}};t.globalEventListeners.push({name:"pointermove",env:"vglobal",callback:g}),ju.addEventListener("pointermove",g)}function yF(t){return!!t.changedTouches}function CF(t,e,i){if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"top";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom";if(t===i.rowHeaderLevelCount-1&&e>=i.rowHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left"}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"left";if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return"right";if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return"bottom"}return"bottom"}function wF(t,e,i,r,o,n,s){const a=s||"_vtable_rowSeries_number";let l=e+1;for(;Ux(r[l])&&r[l]?.length>i.length;){const e=o.columnHeaderLevelCount+l;o.stateManager.setCheckedState(n,e,a,t),eF(n,e,t,o),l++}}function vF(t,e,i,r,o,n){let s=e.length-1;if(s>0){let e=t-1;for(;s>0&&e>=0;){if(Ux(i[e])&&i[e]?.length===s||1===s&&Xx(i[e])){xF(o,r.columnHeaderLevelCount+e,i[e],r,n),s--}e--}}}function xF(t,e,i,r,o){const{checkedState:n}=r.stateManager,s=i.toString(),a=o||"_vtable_rowSeries_number";!Ux(i)||i.length;let l=!1;const h=[],c=Array.from(n.keys()).sort(((t,e)=>{const i=t.split(","),r=e.split(","),o=Math.max(i.length,r.length);for(let t=0;t<o;t++){const e=Number(i[t])??0,o=Number(r[t])??0;if(e!==o)return e-o}return 0})),d=c.map((t=>n.get(t))),u=c.filter((t=>t.startsWith(s+",")&&t!==s));if(d.forEach(((t,e)=>{const i=c[e],r=t,o=u.includes(i);l&&(o?h.push(r[a]):l=!1),i===s&&(l=!0)})),0===h.length)return;const g=h.every((t=>!!t)),p=h.every((t=>!t));g?(r.stateManager.setCheckedState(t,e,a,!0),eF(t,e,!0,r)):p?(r.stateManager.setCheckedState(t,e,a,!1),eF(t,e,!1,r)):(r.stateManager.setCheckedState(t,e,a,"indeterminate"),eF(t,e,"indeterminate",r))}function _F(t,e,i,r){const{checkedState:o}=i.stateManager,n=e.toString();!Ux(e)||e.length;let s=!1;const a=Array.from(o.keys()).sort(((t,e)=>{const i=t.split(","),r=e.split(","),o=Math.max(i.length,r.length);for(let t=0;t<o;t++){const e=Number(i[t])??0,o=Number(r[t])??0;if(e!==o)return e-o}return 0})),l=a.filter((t=>t.startsWith(n+",")&&t!==n)),h=a.map((t=>o.get(t)));h.forEach(((e,i)=>{const o=a[i],h=e,c=0!==l.length&&l.includes(o);s&&(c?h[r]=t:s=!1),o===n&&(s=!0)}))}function SF(t,e,i){const r=t.getRecordShowIndexByCell(e,i);return t.dataSource.getHierarchyState(r)}function AF(t){t.on(OS.ICON_CLICK,(e=>{const{col:i,row:r,x:o,y:n,funcType:s,icon:a,event:l}=e,{stateManager:h}=t;if(s===Fx.dropDown)h.triggerDropDownMenu(i,r,o,n,l);else if(s===Fx.sort)h.triggerSort(i,r,a,l);else if(s===Fx.frozen)h.triggerFreeze(i,r,a);else if(s===Fx.drillDown)!function(t){t.fireListeners(XE.DRILLMENU_CLICK,t.stateManager.drill)}(t);else if(s===Fx.collapse||s===Fx.expand){const e=!!h.select.ranges?.length;h.updateSelectPos(-1,-1),h.endSelectCells(!0,e),t.toggleHierarchyState(i,r)}}))}mF();class TF{table;isTouchdown;isTouchMove;touchMovePoints;touchSetTimeout;touchEnd;isLongTouch;gesture;handleTextStickBindId;LastPointerXY;LastBodyPointerXY;isDown=!1;isDraging=!1;scrollYSpeed;scrollXSpeed;downIcon;globalEventListeners=[];inertiaScroll;bindSparklineHoverEvent;_enableTableScroll=!0;constructor(t){this.table=t,this.handleTextStickBindId=[],this.inertiaScroll=new lF(t.stateManager),"node"===X_.mode||t.options.disableInteraction||(this.bindOuterEvent(),setTimeout((()=>{this.bindSelfEvent()}),0))}bindOuterEvent(){cF(this),bF(this),function(t){const e=t.table,i=e.stateManager,r=e.scenegraph;r.component.vScrollBar.addEventListener("pointerover",(t=>{i.showVerticalScrollBar()})),r.component.hScrollBar.addEventListener("pointerover",(t=>{i.showHorizontalScrollBar()})),r.component.vScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==Tx.scrolling&&i.hideVerticalScrollBar()})),r.component.hScrollBar.addEventListener("pointerout",(t=>{i.interactionState!==Tx.scrolling&&i.hideHorizontalScrollBar()})),r.component.vScrollBar.addEventListener("pointermove",(t=>{r.table.stateManager.updateCursor("default"),t.stopPropagation()})),r.component.vScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation(),r.table.hasListeners(OS.MOUSEDOWN_TABLE)&&r.table.fireListeners(OS.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),r.component.vScrollBar.addEventListener("scrollDown",(t=>{r.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},r.table.eventManager.isDown=!0,i.interactionState!==Tx.scrolling&&i.updateInteractionState(Tx.scrolling),r.table.stateManager.hideMenu(),r.table.editorManager?.completeEdit(),r.table.hasListeners(OS.MOUSEDOWN_TABLE)&&r.table.fireListeners(OS.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),r.component.vScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,r.table.eventManager.isDraging=!1,i.interactionState===Tx.scrolling&&i.updateInteractionState(Tx.default)})),r.component.vScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===Tx.scrolling&&i.updateInteractionState(Tx.default)})),r.component.vScrollBar.addEventListener("scrollUp",(t=>{r.table.eventManager.isDraging=!1})),r.component.hScrollBar.addEventListener("pointermove",(t=>{r.table.stateManager.updateCursor("default"),t.stopPropagation()})),r.component.hScrollBar.addEventListener("pointerdown",(t=>{t.stopPropagation(),r.table.hasListeners(OS.MOUSEDOWN_TABLE)&&r.table.fireListeners(OS.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),r.component.hScrollBar.addEventListener("scrollDown",(t=>{r.table.eventManager.LastBodyPointerXY={x:t.x,y:t.y},r.table.eventManager.isDown=!0,i.interactionState!==Tx.scrolling&&i.updateInteractionState(Tx.scrolling),r.table.stateManager.hideMenu(),r.table.editorManager?.completeEdit(),r.table.hasListeners(OS.MOUSEDOWN_TABLE)&&r.table.fireListeners(OS.MOUSEDOWN_TABLE,{event:t.nativeEvent})})),r.component.hScrollBar.addEventListener("pointerup",(()=>{i.fastScrolling=!1,r.table.eventManager.isDraging=!1,i.interactionState===Tx.scrolling&&i.updateInteractionState(Tx.default)})),r.component.hScrollBar.addEventListener("pointerupoutside",(()=>{i.fastScrolling=!1,i.interactionState===Tx.scrolling&&i.updateInteractionState(Tx.default)})),r.component.hScrollBar.addEventListener("scrollUp",(t=>{r.table.eventManager.isDraging=!1}));const o=rS(i.updateVerticalScrollBar,20),n=rS(i.updateHorizontalScrollBar,20);r.component.vScrollBar.addEventListener("scrollDrag",(t=>{r.table.eventManager.isDown&&(r.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==Tx.scrolling&&i.updateInteractionState(Tx.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);o(e,t)})),r.component.hScrollBar.addEventListener("scrollDrag",(t=>{r.table.eventManager.isDown&&(r.table.eventManager.isDraging=!0),i.fastScrolling=!0,i.interactionState!==Tx.scrolling&&i.updateInteractionState(Tx.scrolling);const e=t.detail.value[0]/(1-t.detail.value[1]+t.detail.value[0]);n(e)}))}(this),function(t){const e=t.table,i=e.stateManager,r=e.scenegraph;if(!1===ju.envContribution.supportsTouchEvents)return;ju.addEventListener("contextmenu",(t=>{t.stopPropagation(),t.preventDefault()}),{capture:!0}),t.touchMovePoints=[],e.scenegraph.tableGroup.addEventListener("touchstart",(i=>{if(i.target.isChildOf(r.component.vScrollBar)||i.target.isChildOf(r.component.vScrollBar))return;t.isTouchdown=!0;const o=i.nativeEvent;t.touchMovePoints.push({x:e.rotateDegree?o.changedTouches?.[0]?._canvasX??i.canvas?.x:i.page.x,y:e.rotateDegree?o.changedTouches?.[0]?._canvasY??i.canvas?.y:i.page.y,timestamp:Date.now()})}));const o=r=>{if(t.isLongTouch&&r.preventDefault(),t.isTouchdown&&yF(r))if(t.isTouchMove=!0,t.downIcon?.attribute?.funcType===Fx.dragReorder)r.preventDefault();else if(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:e.rotateDegree?r.changedTouches[0]._canvasX:r.changedTouches[0].pageX,y:e.rotateDegree?r.changedTouches[0]._canvasY:r.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll){const o=-t.touchMovePoints[t.touchMovePoints.length-1].x+t.touchMovePoints[t.touchMovePoints.length-2].x,n=-t.touchMovePoints[t.touchMovePoints.length-1].y+t.touchMovePoints[t.touchMovePoints.length-2].y;nF({deltaX:o,deltaY:n},i),r.cancelable&&("none"===e.internalProps.overscrollBehavior||Math.abs(n)>=Math.abs(o)&&0!==n&&sF(n,i)||Math.abs(n)<=Math.abs(o)&&0!==o&&aF(o,i))&&r.preventDefault()}};ju.addEventListener("touchmove",o,{passive:!1}),t.globalEventListeners.push({name:"touchmove",env:"vglobal",callback:o});const n=i=>{if(t.touchEnd=!0,t.isLongTouch=!1,t.isTouchdown&&yF(i)){if(t.downIcon?.attribute?.funcType===Fx.dragReorder)i.preventDefault();else if(t.touchMovePoints?.length&&(t.touchMovePoints.length>4&&t.touchMovePoints.shift(),t.touchMovePoints.push({x:e.rotateDegree?i.changedTouches[0]._canvasX:i.changedTouches[0].pageX,y:e.rotateDegree?i.changedTouches[0]._canvasY:i.changedTouches[0].pageY,timestamp:Date.now()}),t._enableTableScroll)){const i=t.touchMovePoints[0],r=t.touchMovePoints[t.touchMovePoints?.length-1],o=(r.x-i.x)/(r.timestamp-i.timestamp),n=(r.y-i.y)/(r.timestamp-i.timestamp);t.inertiaScroll.startInertia(o,n,.95),e.eventManager.inertiaScroll.setScrollHandle(((t,i)=>{nF({deltaX:-t,deltaY:-i},e.stateManager)}))}t.isTouchdown=!1,t.isTouchMove=!1,t.isDraging=!1,t.touchMovePoints=[]}};ju.addEventListener("touchend",n),t.globalEventListeners.push({name:"touchend",env:"vglobal",callback:n});const s=e=>{t.touchEnd=!0,t.isLongTouch=!1,t.isTouchdown&&(t.isTouchdown=!1,t.isTouchMove=!1,t.touchMovePoints=[],t.isDraging=!1)};ju.addEventListener("touchcancel",s),t.globalEventListeners.push({name:"touchcancel",env:"vglobal",callback:s})}(this),dF(this)}updateEventBinder(){setTimeout((()=>{this.table.isReleased||(Kk(this.table)&&0===this.handleTextStickBindId?.length?(this.handleTextStickBindId.push(this.table.on(OS.SCROLL,(t=>{Nk(this.table)}))),this.handleTextStickBindId.push(this.table.on(OS.RESIZE_COLUMN_END,(t=>{Nk(this.table)}))),this.handleTextStickBindId.push(this.table.on(OS.RESIZE_ROW_END,(t=>{Nk(this.table)})))):!Kk(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach((t=>{this.table.off(t)})),this.handleTextStickBindId=[]),oF(this.table))}),0)}bindSelfEvent(){var t;this.table.isReleased||(AF(this.table),(t=this.table).on(OS.DROPDOWN_MENU_CLICK,(()=>{t.stateManager.hideMenu()})),t.on(OS.SCROLL,(()=>{t.stateManager.hideMenu()})),this.updateEventBinder(),function(t){"browser"===X_.mode&&t.on(OS.CLICK_CELL,(e=>{const{col:i,row:r}=e;if("image"===e.target.type&&e.target.role&&e.target.role.startsWith("icon"))return;let o;o=t.internalProps.layoutMap.isHeader(i,r)?t.isPivotTable()?t._getHeaderLayoutMap(i,r).headerType:t.getHeaderDefine(i,r).headerType:t.getBodyColumnType(i,r);const n=t.isHeader(i,r)?t.getHeaderDefine(i,r):t.getBodyColumnDefine(i,r),s=t.getCellValue(i,r),a=t.getCellOriginValue(i,r);if("link"===o){let e=AS(n.linkJump,{col:i,row:r,table:t,value:s,dataValue:a,cellHeaderPaths:void 0});if(e=!1!==e,!e)return;const o=n.templateLink;let l,h=AS(n.linkDetect,{col:i,row:r,table:t,value:s,dataValue:a,cellHeaderPaths:void 0});if(h=!1!==h,o){const e=t.getCellOriginRecord(i,r);if(e&&e.vtableMerge)return;const n=Object.assign({__value:s,__dataValue:a},e);if(Ox(o))l=o(n,i,r,t);else{const t=/\{\s*(\S+?)\s*\}/g;l=o.replace(t,((t,e)=>n[e]))}}else if(h){if(!tA.test(s))return;l=s}else l=s;if(!l)return;const c=n.linkTarget,d=n.linkWindowFeatures;window.open(l,c,d)}else if("image"===o){const{clickToPreview:t}=n;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=new Image;i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",e.appendChild(i),document.body.appendChild(e)}else if("video"===o){const{clickToPreview:t}=n;if(!1===t)return;const e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.backgroundColor="rgba(30, 30, 30, 0.4)",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="hidden",e.style.zIndex="9999",e.addEventListener("click",(t=>{t.target===e&&document.body.removeChild(e)}));const i=document.createElement("video");i.src=s,i.style.maxWidth="80%",i.style.maxHeight="80%",i.setAttribute("preload","auto"),i.setAttribute("controls","true"),e.appendChild(i),document.body.appendChild(e)}}))}(this.table),function(t){t.on(OS.DBLCLICK_CELL,(e=>{if(e.federatedEvent){const i=FM(e.federatedEvent),r=t.scenegraph.getResizeColAt(i.abstractPos.x,i.abstractPos.y,i.eventArgs?.targetCell),o=t.options.disableDblclickAutoResizeColWidth??t.options.resize?.disableDblclickAutoResizeColWidth;if(t.eventManager.checkCellFillhandle(i))t.fireListeners(OS.DBLCLICK_FILL_HANDLE,{});else if(t._canResizeColumn(r.col,r.row)&&r.col>=0&&!o){t.scenegraph.updateAutoColWidth(r.col),t.internalProps._widthResizedColMap.add(r.col),t.scenegraph.updateChartSizeForResizeColWidth(r.col);const e=t.stateManager;e.columnResize.col<e.table.frozenColCount&&!e.table.isPivotTable()&&!e.table.transpose&&e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1,e.columnResize.isRightFrozen);const i=[];for(let e=0;e<t.colCount;e++)i.push(t.getColWidth(e));t.fireListeners(OS.RESIZE_COLUMN_END,{col:r.col,colWidths:i})}}}))}(this.table),this.table.isPivotTable()&&function(t){const e=t.internalProps.layoutMap.rowsDefine,i=t.internalProps.layoutMap.columnsDefine;for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.drillDown||i.drillUp))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.drillDown||e.drillUp))return!0}return!1}(this.table)&&function(t){t.on(OS.MOUSEENTER_CELL,(e=>{const{col:i,row:r}=e;if(-1===i||-1===r)return;const o=t.internalProps.layoutMap.getHeaderDimension(i,r);o?.drillDown||o?.drillUp?t.stateManager.updateDrillState(o.dimensionKey,o.title,o.drillDown,o.drillUp,i,r):t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})),t.on(OS.MOUSELEAVE_TABLE,(e=>{t.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}))}(this.table),oF(this.table),function(t){t.isPivotChart()&&t.scenegraph.tableGroup.addEventListener("click",(e=>{if(!t.stateManager.columnMove.moving&&!t.stateManager.columnResize.resizing)if("axis-label"===e.target.name){const i=FM(e),{col:r,row:o}=i.eventArgs,n=t.internalProps.layoutMap;let s,a;n.indicatorsAsCol?(s=n.getDimensionKeyInChartSpec(n.rowHeaderLevelCount,o),a=n.getCellHeaderPaths(n.rowHeaderLevelCount-2,o).rowHeaderPaths):(s=n.getDimensionKeyInChartSpec(r,n.columnHeaderLevelCount),a=n.getCellHeaderPaths(r,n.columnHeaderLevelCount-1).colHeaderPaths);const l=a.map((t=>({key:t.dimensionKey,value:t.value}))).filter((t=>t.key));if(l.push({key:s,value:e.target.attribute.text}),t._selectedDimensionInChart.length&&function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].key!==e[i].key||t[i].value!==e[i].value)return!1;return!0}(t._selectedDimensionInChart,l))return;t._selectedDimensionInChart=l,n.updateDataStateToChartInstance(),AE(t.scenegraph),t.scenegraph.updateNextFrame()}else t._selectedDimensionInChart?.length&&(t._selectedDimensionInChart.length=0,t.internalProps.layoutMap.updateDataStateToChartInstance(),AE(t.scenegraph),t.scenegraph.updateNextFrame())}))}(this.table),function(t){t.isPivotChart()&&(t.on(OS.MOUSEENTER_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=CF(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(OS.MOUSEENTER_AXIS,e)}}))})),t.on(OS.MOUSELEAVE_CELL,(e=>{t.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{if("axis"===i.name){const i=CF(e.col,e.row,t.internalProps.layoutMap);e.axisPosition=i,t.fireListeners(OS.MOUSELEAVE_AXIS,e)}}))})))}(this.table),function(t){t.on("checkbox_state_change",(e=>{const{col:i,row:r,checked:o,field:n}=e;if(!t.internalProps.layoutMap.isSeriesNumber(i,r)||!0!==t.internalProps.enableCheckboxCascade)return;if(t.isHeader(i,r))return;const s=t.getCellOriginRecord(i,r),a=t.dataSource.currentPagerIndexedData,l=t.getRecordShowIndexByCell(i,r);let h=a[l];if(Xx(h)&&(h=[h]),s.vtableMerge||s.children?.length)if(o)SF(t,i,r)===kx.collapse?_F(!0,h,t,n):wF(!0,l,h,a,t,i),vF(l,h,a,t,i);else{SF(t,i,r)===kx.collapse?_F(!1,h,t,n):wF(!1,l,h,a,t,i),vF(l,h,a,t,i);const e=t.stateManager.headerCheckedState._vtable_rowSeries_number,o=t.stateManager.updateHeaderCheckedState("_vtable_rowSeries_number",i,r);e!==o&&t.scenegraph.updateHeaderCheckboxCellState(i,r,o)}else vF(l,h,a,t,i)}))}(this.table),function(t){!0===t.internalProps.enableCheckboxCascade&&t.on("checkbox_state_change",(e=>{const{col:i,row:r,checked:o,field:n}=e,s=t.internalProps.columns.some((t=>t.tree));if(t.internalProps.enableCheckboxCascade,!s)return;if(t.isHeader(i,r))return;const a=t.getCellOriginRecord(i,r),l=t.dataSource.currentPagerIndexedData,h=t.getRecordShowIndexByCell(i,r);let c=l[h];if(Xx(c)&&(c=[c]),a.vtableMerge||a.children?.length)if(o)SF(t,i,r)===kx.collapse?_F(!0,c,t,n):wF(!0,h,c,l,t,i,n),vF(h,c,l,t,i,n);else{SF(t,i,r)===kx.collapse?_F(!1,c,t,n):wF(!1,h,c,l,t,i,n),vF(h,c,l,t,i,n);const e=t.stateManager.headerCheckedState._vtable_rowSeries_number,o=t.stateManager.updateHeaderCheckedState(n,i,r);e!==o&&t.scenegraph.updateHeaderCheckboxCellState(i,r,o)}else vF(h,c,l,t,i,n)}))}(this.table),function(t){!0===t.internalProps.enableHeaderCheckboxCascade&&t.on("checkbox_state_change",(e=>{const{col:i,row:r,checked:o,field:n}=e;if(t.isHeader(i,r))t.stateManager.setHeaderCheckedState(n,o),"checkbox"===t.getCellType(i,r)&&t.scenegraph.updateCheckboxCellState(i,r,o);else if(t.stateManager.setCheckedState(i,r,n,o),"checkbox"===t.getCellType(i,r)){const e=t.stateManager.headerCheckedState[n],o=t.stateManager.updateHeaderCheckedState(n,i,r);e!==o&&t.scenegraph.updateHeaderCheckboxCellState(i,r,o)}}))}(this.table),function(t){t.on(OS.CLICK_CELL,(e=>{const{col:i,row:r,target:o}=e;"button"!==o.name||o.attribute.disable||t.hasListeners(OS.BUTTON_CLICK)&&t.fireListeners(OS.BUTTON_CLICK,{col:i,row:r,event:e.event})}))}(this.table),function(t){t.on(OS.CONTEXTMENU_CELL,(e=>{const{col:i,row:r}=e,o=t.getSelectedCellRanges();let n=!1;if(o.length>0)for(let t=0;t<o.length;t++){const e=o[t],s=e.start.col,a=e.end.col,l=e.start.row,h=e.end.row;if(i>=s&&i<=a&&r>=l&&r<=h||i>=a&&i<=s&&r>=h&&r<=l||i>=s&&i<=a&&r>=h&&r<=l||i>=a&&i<=s&&r>=l&&r<=h){n=!0;break}}n||t.selectCell(i,r)}))}(this.table))}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:i}=t;if(i){if("checkbox"===i.target.name||"radio"===i.target.name||"switch"===i.target.name||"button"===i.target.name)return!1;if(this.table.isHeader(i.col,i.row)&&OH(this.table,i.col,i.row))return e||this.table.stateManager.updateSelectPos(-1,-1),!1;if(!this.table.isHeader(i.col,i.row)&&OH(this.table,i.col,i.row)){if(!e){const t=!!this.table.stateManager.select.ranges?.length;this.table.stateManager.updateSelectPos(-1,-1),t&&this.table.stateManager.endSelectCells(!0,t)}return!1}return!this.table.isPivotChart()||"axis-label"!==t?.eventArgs?.target.name&&"chart"!==t?.eventArgs?.target.type?(this.table.stateManager.updateSelectPos(i.col,i.row,i.event.shiftKey,i.event.ctrlKey||i.event.metaKey,!1,!e&&(this.table.options.select?.makeSelectCellVisible??!0)),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}dealFillSelect(t,e){const{eventArgs:i}=t;if(i){if(this.table.stateManager.select?.ranges?.length&&this.table.stateManager.isFillHandle()){let r,o;const n=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];e&&(Wx(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.startY-t.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-t.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(r=i.row,o=n.end.col):(r=n.end.row,o=i.col)),this.table.stateManager.updateSelectPos(e?o:n.end.col,e?r:n.end.row,!0,i.event.ctrlKey||i.event.metaKey,!1,!e)}else this.table.stateManager.updateSelectPos(i.col,i.row,i.event.shiftKey,i.event.ctrlKey||i.event.metaKey,!1,!e);return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0),this.table.fireListeners(OS.SELECTED_CELL,{ranges:this.table.stateManager.select.ranges,col:0,row:0})}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t;if(this.table.internalProps.enableTreeStickCell&&!i)return!1;const r=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,i?.targetCell);return this.table._canResizeColumn(r.col,r.row)&&r.col>=0?(e&&this.table.stateManager.startResizeCol(r.col,t.abstractPos.x,t.abstractPos.y,r.rightFrozen),!0):(this.table.stateManager.isResizeCol()&&this.table.stateManager.endResizeCol(),!1)}checkRowResize(t,e){const{eventArgs:i}=t;if(i){const r=this.table.scenegraph.getResizeRowAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeRow(r.col,r.row)&&r.row>=0)return e&&this.table.stateManager.startResizeRow(r.row,t.abstractPos.x,t.abstractPos.y,r.bottomFrozen),!0}return!1}cellIsHeaderCheck(t,e){const{eventArgs:i}=t,{col:r,row:o,target:n}=i;if(!this.table.isHeader(r,o))return!1;return"checkbox"===this.table.getCellType(i.col,i.row)&&"checkbox"===n.name}checkCellFillhandle(t,e){let i=!1;if(i="function"==typeof this.table.options.excelOptions?.fillHandle?this.table.options.excelOptions.fillHandle({selectRanges:this.table.stateManager.select.ranges,table:this.table}):this.table.options.excelOptions?.fillHandle,i){const{eventArgs:i}=t;if(i&&this.table.stateManager.select?.ranges?.length){const i=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),r=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),o=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),n=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row);let s;s=i<this.table.colCount-1?this.table.scenegraph.highPerformanceGetCell(i,r).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(o-1,r).globalAABBBounds;const a=Math.abs(t.abstractPos.x-s.x2);s=r<this.table.rowCount-1?this.table.scenegraph.highPerformanceGetCell(i,r).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(i,n-1).globalAABBBounds;const l=Math.abs(t.abstractPos.y-s.y2),h=18;if(this.table.stateManager.fillHandle?.isFilling||a<=h/2&&l<=h/2)return e&&this.table.stateManager.startFillSelect(t.abstractPos.x,t.abstractPos.y),!0}}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}dealRowResize(t,e){this.table.stateManager.updateResizeRow(t,e)}checkColumnMover(t){const{eventArgs:e}=t;return!(!e||!this.table._canDragHeaderPosition(e.col,e.row))&&(this.table.stateManager.startMoveCol(e.col,e.row,t.abstractPos.x,t.abstractPos.y,e?.event?.nativeEvent),!0)}dealColumnMover(t){const{eventArgs:e}=t;Wx(e.col)&&Wx(e.row)&&this.table.stateManager.updateMoveCol(e.col,e.row,t.abstractPos.x,t.abstractPos.y,e?.event?.nativeEvent)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:r,event:o,col:n,row:s}=i||{target:t.target,event:t,col:-1,row:-1},a=r;if(a.role&&a.role.startsWith("icon-"))return this.table.fireListeners(OS.ICON_CLICK,{name:a.name,x:(a.globalAABBBounds.x1+a.globalAABBBounds.x2)/2,y:a.globalAABBBounds.y2,col:n,row:s,funcType:a.attribute.funcType,icon:a,event:o}),!0;if(r instanceof vh){const t=r.pickIcon(o.global);if(t)return this.table.fireListeners(OS.ICON_CLICK,{name:t.attribute.id,x:t.globalX+t.globalAABBBounds.width()/2,y:t.globalY+t.AABBBounds.height(),col:n,row:s,funcType:t.attribute.funcType,icon:t,event:o}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach((t=>{"document"===t.env?document.removeEventListener(t.name,t.callback):"body"===t.env?document.body.removeEventListener(t.name,t.callback):"window"===t.env?window.removeEventListener(t.name,t.callback):"vglobal"===t.env&&ju.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[]}enableScroll(){this._enableTableScroll=!0}disableScroll(){this._enableTableScroll=!1}}const RF=t=>{const e=t.value;return Number(e)>80?"#20a8d8":Number(e)>50?"#4dbd74":Number(e)>20?"#ffc107":"#f86c6b"};class BF extends z_{_showBar;_barColor;_barBgColor;_barPositiveColor;_barNegativeColor;_barAxisColor;_barHeight;_barBottom;_barPadding;_showBarMark;_barMarkPositiveColor;_barMarkNegativeColor;_barMarkWidth;_barMarkPosition;_barRightToLeft;_barMarkInBar;static get DEFAULT(){return pF||(pF=new BF)}constructor(t={},e={}){super(t,e),this._showBar=t.showBar??!0,this._barColor=t.barColor??RF,this._barPositiveColor=t.barPositiveColor??"#4dbd74",this._barNegativeColor=t.barNegativeColor??"#f86c6b",this._barAxisColor=t.barAxisColor??"black",this._barBgColor=t.barBgColor,this._barHeight=t.barHeight??3,this._barHeight=t.barHeight??3,this._barBottom=t.barBottom??0,this._barPadding=t.barPadding??[0,0,0,0],this._showBarMark=t.showBarMark??!1,this._barMarkPositiveColor=t.barMarkPositiveColor??"#4dbd74",this._barMarkNegativeColor=t.barMarkNegativeColor??"#f86c6b",this._barMarkWidth=t.barMarkWidth??2,this._barMarkPosition=t.barMarkPosition??"right",this._barRightToLeft=t.barRightToLeft??!1,this._barMarkInBar=t.barMarkInBar??!0}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}get barMarkInBar(){return this._barMarkInBar}set barMarkInBar(t){this._barMarkInBar=t}clone(){return new BF(this,null)}}const MF=["type","content","style","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive","isGif"];class PF{expandIcon;collapseIcon;_table;constructor(t){this._table=t;const e=MM();this.expandIcon=e[Lx.expandIconName],this.collapseIcon=e[Lx.collapseIconName]}getIcons(t,e,i,r,o){const n=[],s=this.getHierarchyIcon(t,e);s&&n.push(s);const{icon:a}=this._table.getBodyColumnDefine(t,e);if(a){let o;if("function"==typeof a){o=a({col:t,row:e,value:i,dataValue:r,table:this._table})}else o=a;const s=MM(),l=t=>{let e;e="string"==typeof t?s[t]:t,e&&n.push(e)};Array.isArray(o)?o.forEach(((t,e)=>{l(t)})):l(o)}return o&&n.forEach(((i,r)=>{(i.content||i.src)&&(n[r]=this.getCellIconFromRecordValue(i,t,e))})),n}getStyleClass(t){switch(t){case"text":case"link":return D_;case"image":case"video":return O_;case"chart":case"sparkline":return z_;case"progressbar":return BF;case"checkbox":return j_;case"radio":return V_;case"switch":return U_;case"button":return K_}return D_}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map((t=>this.getCellIconFromRecordValue(t,e,i)));if(!ES.isObject(t)||"function"==typeof t)return this._table.getFieldData(t,e,i);const r={},o=t;return MF.forEach((t=>{if(void 0!==o[t]){const n=this._table.getFieldData(o[t],e,i);Wx(n)?r[t]=n:this._table._hasField?.(o[t],e,i)||(r[t]=o[t])}})),r}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===kx.expand?this.expandIcon:i===kx.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){return this.expandIcon.width+(this.expandIcon.marginLeft??0)+(this.expandIcon.marginRight??0)}}function HF(t,e){const i=document.createElement(t);return e&&i.classList.add(...e),i}!function(){if("node"===X_.mode)return;const t=document.createElement("style");t.id="vtable-menu-styleSheet",t.textContent="\n@keyframes vtable__menu-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__menu-element {\n\tposition: absolute;\n\tbox-sizing: border-box;\n\tborder-radius: 4px;\n\tbackground-color: #fff;\n\tpadding: 6px 0;\n\t/* pointer-events: none; */\n\tuser-select: none;\n\tcolor: #000;\n\tmax-width: 300px;\n\tz-index: 99999;\n\tborder: #CCC 0.5px solid;\n\tcursor: default;\n\twidth: max-content;\n\tbox-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);\n  max-height: 100%;\n  overflow-y: auto;\n}\n.vtable__menu-element--hidden {\n\topacity: 0;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n\tz-index: -9999;\n}\n.vtable__menu-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__menu-element--shown-animation 150ms ease-out;\n}\n.vtable__menu-element__content {\n\tfont-family: Roboto;\n\tfont-size: 12px;\n\toverflow: hidden;\n\tdisplay: inline-block;\n\t/* height: 100%; */\n\tline-height: 30px;\n}\n.vtable__menu-element__item {\n\theight: 32px;\n\tpadding: 0px 12px;\n\tcursor: pointer;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-start;\n}\n.vtable__menu-element__item:hover {\n\tbackground-color: rgba(27, 31, 35, 0.06);\n}\n.vtable__menu-element__icon{\n\t/* vertical-align: top; */\n\tdisplay: flex;\n\t/* line-height: 30px; */\n\tmargin-right: 6px;\n}\n.vtable__menu-element__no-event {\n\tpointer-events: none;\n}\n.vtable__menu-element--select {\n\tcolor: #2E68CF;\n}\n.vtable__menu-element--normal {\n\tcolor: rgba(20, 20, 20, 0.9);;\n}\n.vtable__menu-element__item-disabled {\n    color: rgba(0, 0, 0, 0.25);\n    cursor: not-allowed;\n\t  background-color: #fff;\n}\n.vtable__menu-element__item-disabled:hover {\n\t  background-color: #fff;\n}\n.vtable__menu-element__split {\n\theight: 0px;\n\tborder: 1px solid rgb(209, 213, 218);\n\tmargin: 5px 0;\n}\n.vtable__menu-element__title {\n\tcolor: rgb(149, 149, 149);\n}\n.vtable__menu-element__arrow {\n\tposition: absolute;\n\tright: 3px;\n\tfont-weight: bold;\n\tmargin-top: 1px;\n}\n.vtable__menu-element__item-text {\n\tmargin-right: 15px;\n}\n",document.head.appendChild(t)}();const kF="vtable__menu-element",EF=`${kF}__item`,FF=`${kF}__content`,LF=`${kF}--hidden`,IF=`${kF}--shown`,zF=`${kF}--normal`,OF=`${kF}--select`,DF=`${kF}__icon`,WF=`${kF}__split`,NF=`${kF}__title`,GF=`${kF}__arrow`,jF=`${kF}__no-event`,VF=`${kF}__item-text`,UF=`${kF}__item-disabled`;function KF(){return HF("div",[kF,LF])}function $F(t,e,i,r,o,n){const s=t.getCellRange(r,o);for(let r=0;r<e.length;r++){const o=e[r];let{col:n,row:a}=o;const{field:l,menuKey:h}=o;if("number"!=typeof n||"number"!=typeof a)if(t.isPivotTable()&&(Array.isArray(l),1)){const e=t.internalProps.layoutMap.getPivotCellAdress(l);if(!e)continue;n=e.col,a=e.row}else{const e=t.internalProps.layoutMap.getHeaderCellAddressByField(l);if(!e)continue;n=e.col,a=e.row}if(Wx(n)&&Wx(a)&&MS(s,n,a)&&i===h)return!0}return!1}class XF{_handler;_rootElement;_secondElement;_menuInstanceInfo;_showChildrenIndex;_mouseEnterSecondElement;constructor(t){this._handler=new GS,this._rootElement=KF(),this._secondElement=KF(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),this._rootElement?.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),this._rootElement?.addEventListener("contextmenu",(t=>{t.stopPropagation(),t.preventDefault()})),this._rootElement?.addEventListener("touchend",(e=>{if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains(UF))return;if(this._rootElement.classList.contains(LF))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r),h=t._dropDownMenuIsHighlight(i,r,o);t.fireListeners(OS.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(OS.DROPDOWN_MENU_CLEAR,null),t.fireListeners(OS.HIDE_MENU,null),e.stopPropagation()})),this._rootElement?.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains(UF))return;if(this._rootElement.classList.contains(LF))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r),h=t._dropDownMenuIsHighlight(i,r,o);t.fireListeners(OS.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(OS.DROPDOWN_MENU_CLEAR,null),t.fireListeners(OS.HIDE_MENU,null),e.stopPropagation()})),this._rootElement?.addEventListener("mousemove",(e=>{if(this._rootElement.classList.contains(LF))return;e.stopPropagation();const{hasChildren:i,dropDownIndex:r,col:o,row:n,sub:s}=e.target;if(i){this._showChildrenIndex=r;const i=this._secondElement;i?.classList.remove(LF),i?.classList.add(IF),i.innerHTML="";const s=this._menuInstanceInfo.content[r]?.children;for(let e=0;e<s.length;e++){const r=s[e],a=YF(r,!!t.stateManager.menu.dropDownMenuHighlight&&$F(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof r?r?.menuKey||r?.text:r,o,n));a.col=o,a.row=n,a.dropDownIndex=e,"string"==typeof r?(a.text=r,a.menuKey=r):"object"==typeof r&&(a.text=r.text,a.menuKey=r.menuKey||r.text),a.sub=!0,a.sub=!0,i.appendChild(a)}const a=e.target.getBoundingClientRect();this._bindSecondElement(t,o,n,a.right,a.top)}else if(i&&this._showChildrenIndex===r){const t=this._secondElement;t?.classList.remove(LF),t?.classList.add(IF)}else!s&&this._secondElement?.classList.contains(IF)&&setTimeout((()=>{if(!0!==this._mouseEnterSecondElement){this._showChildrenIndex=-1;const t=this._secondElement;t?.classList.remove(IF),t?.classList.add(LF)}}),300)})),this._secondElement?.addEventListener("wheel",(t=>{t.stopPropagation()})),this._secondElement?.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(LF)||t.stopPropagation()})),this._secondElement?.addEventListener("mouseenter",(t=>{this._mouseEnterSecondElement=!0})),this._secondElement?.addEventListener("mouseleave",(t=>{this._mouseEnterSecondElement=!1})),this._secondElement?.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),this._secondElement?.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),e.target.classList.contains(UF))return;if(this._secondElement.classList.contains(LF))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r);let h=!1;this._menuInstanceInfo.content.forEach(((e,o)=>{if("object"==typeof e&&e.children&&e.children.length)for(let o=0;o<e.children.length;o++){const s=e.children[o];if($F(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof s?s?.menuKey:s,i,r)&&n===("object"==typeof s?s?.menuKey:s))return void(h=!0)}})),t.fireListeners(OS.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(i,r):void 0,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(OS.DROPDOWN_MENU_CLEAR,null),t.fireListeners(OS.HIDE_MENU,null),e.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const o=this._rootElement,n=this._secondElement;if(this._menuInstanceInfo=r,o?.classList.remove(IF),o?.classList.add(LF),n?.classList.remove(IF),n?.classList.add(LF),this._canBindToCell(t,e,i)){if(o.innerHTML="",Array.isArray(r.content)){const n=r.content;for(let r=0;r<n?.length;r++){const s=n[r];let a=!!t.stateManager.menu.dropDownMenuHighlight&&$F(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof s?s?.menuKey||s?.text:s,e,i);if(t.stateManager.menu.dropDownMenuHighlight&&"object"==typeof s&&Array.isArray(s.children)&&s.children.length)for(let r=0;r<s.children.length;r++){const o=s.children[r];if($F(t,t.stateManager.menu.dropDownMenuHighlight,"object"==typeof o?o?.menuKey||o?.text:o,e,i)){a=!0;break}}const l=YF(s,a);l.col=e,l.row=i,l.dropDownIndex=r,"string"==typeof s?(l.text=s,l.menuKey=s):"object"==typeof s&&(l.text=s.text,l.menuKey=s.menuKey||s.text,s.children?.length&&(l.hasChildren=!0)),o.appendChild(l)}}if(this._bindToCell(t,e,i,r.position,r.referencePosition))return o?.classList.add(IF),o?.classList.remove(LF),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,t?.parentElement&&(t.classList.remove(IF),t.classList.add(LF)),e?.parentElement&&(e.classList.remove(IF),e.classList.add(LF))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.internalProps.menu.parentElement??t.getElement(),{top:n,bottom:s,left:a,right:l}=r;if(t.isFrozenCell(e,i))return!0;if(s<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||n>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=o;return!(h<n)&&!(c<a)}_bindToCell(t,e,i,r,o){const n=this._rootElement,s=t.internalProps.menu.parentElement??t.getElement(),{width:a,height:l,left:h,top:c}=s.getBoundingClientRect();if(n){n.parentElement!==s&&s.appendChild(n),n.style.left="0px";const e=.8*a;n.style.maxWidth=`${e}px`;const i=n.offsetWidth,d=n.offsetHeight;let u,g;r?(u=r.x,g=r.y):o&&(u=o.rect.right-i,g=o.rect.bottom);const p=s.getBoundingClientRect(),f=p.width/s.offsetWidth,m=p.height/s.offsetHeight;g*m+d>l&&(g=(l-d)/m),g<0&&(g/=2);let b=0,y=0;if(t.getElement()!==s){const{left:e,top:i}=t.getElement().getBoundingClientRect();b=i-c,y=e-h}return n.style.top=`${g+b}px`,u<0?u=0:u*f+i>a&&(u=(a-i)/f),n.style.left=`${u+y}px`,!0}return!1}_bindSecondElement(t,e,i,r,o){const n=this._secondElement,s=this._rootElement,a=t.internalProps.menu.parentElement??t.getElement(),{width:l,height:h,left:c,top:d}=a.getBoundingClientRect(),{x:u,y:g,width:p,height:f}=s.getBoundingClientRect();if(n){n.parentElement!==a&&a.appendChild(n),n.style.left="0px";const t=.8*l;n.style.maxWidth=`${t}px`;const e=n.clientWidth,i=n.clientHeight,s=r-c;let u=o-4-d;if(u+i>h){u=u-i+n.firstElementChild.clientHeight+4}n.style.top=`${u}px`;let g=s;return g+e>l?g=g-e-p:g+=4,n.style.left=`${g}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:n,height:s}=i.getBoundingClientRect();if(t>r-5&&t<r+n+5&&e>o-5&&e<o+s+5)return!0;const a=this._secondElement;if(a){const{x:i,y:r,width:o,height:n}=a.getBoundingClientRect();if(t>i-5&&t<i+o+5&&e>r-5&&e<r+n+5)return!0}return!1}}function YF(t,e){const i=HF("div",[EF,e?OF:zF]);if("object"==typeof t&&t.disabled&&i.classList.add(UF),"string"==typeof t){const e=HF("span",[FF,jF,VF]);e.innerHTML=t,i.appendChild(e)}else if("object"==typeof t){const r=t.type??"item";if("split"===r)return i?.classList.add(WF),i;if(t?.icon?.svg)if(tA.test(t.icon.svg)){const e=new Image;t.icon.width?e.style.width=t.icon.width.toString()+"px":e.style.width="16px",t.icon.height?e.style.height=t.icon.height.toString()+"px":e.style.height="16px",e.src=t.icon.svg,i.appendChild(e)}else{const r=HF("span",[DF,jF]);r.innerHTML=e&&t.selectedIcon&&t.selectedIcon.svg?t.selectedIcon.svg:t.icon.svg,t.icon.width&&r.children[0].setAttribute("width",t.icon.width.toString()),t.icon.height&&r.children[0].setAttribute("height",t.icon.height.toString()),i.appendChild(r)}const o=HF("span",[FF,jF,VF]);if(o.innerHTML=t.text,i.appendChild(o),"title"===r)i?.classList.add(jF,NF);else if(t?.children?.length){const t=HF("span",[FF,jF,GF]);t.innerHTML=e?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',i.appendChild(t)}}return i}let qF;const ZF={CHANGE_STYLE:"change_style"};class JF extends k_{_color;_strokeColor;_fontSize;_fontFamily;_fontWeight;_fontVariant;_fontStyle;_textOverflow;_padding;_defaultPadding=[10,16,10,16];_textStick;_textStickBaseOnAlign;_marked;_textAlign;_textBaseline;_bgColor;_borderColor;_lineHeight;_underline;_underlineColor;_underlineDash;_underlineOffset;_lineThrough;_lineThroughColor;_lineThroughDash;_linkColor;_cursor;_borderLineWidth;_borderLineDash;static get EVENT_TYPE(){return ZF}static get DEFAULT(){return qF||(qF=new JF)}constructor(t={},e={}){super(),this._color=t.color??e?.color,this._strokeColor=t?.strokeColor??e?.strokeColor,this._fontSize=t.fontSize??e?.fontSize,this._fontFamily=t.fontFamily??e?.fontFamily,this._fontWeight=t.fontWeight??e?.fontWeight,this._fontVariant=t.fontVariant??e?.fontVariant,this._fontStyle=t.fontStyle??e?.fontStyle,this._textOverflow=(t.textOverflow??e?.textOverflow)||"ellipsis",this._textStick=t.textStick??e?.textStick??!1,this._textStickBaseOnAlign=t.textStickBaseOnAlign??e?.textStickBaseOnAlign??!1,this._marked=t.marked??e?.marked??!1,this._textAlign=(t.textAlign??e?.textAlign)||"left",this._textBaseline=(t.textBaseline??e?.textBaseline)||"middle",this._bgColor=t.bgColor??e?.bgColor,this._padding=t.padding??e?.padding??this._defaultPadding,this._borderColor=t.borderColor??e?.borderColor,this._lineHeight=t.lineHeight??e?.lineHeight,this._underline=t.underline??e?.underline,this._underlineColor=t.underlineColor??e?.underlineColor,this._underlineDash=t.underlineDash??e?.underlineDash,this._underlineOffset=t.underlineOffset??e?.underlineOffset,this._lineThrough=t.lineThrough??e?.lineThrough,this._lineThroughColor=t.lineThroughColor??e?.lineThroughColor,this._lineThroughDash=t.lineThroughDash??e?.lineThroughDash,this._linkColor=t.linkColor??e?.linkColor,this._cursor=t.cursor??e?.cursor,this._borderLineWidth=t.borderLineWidth??e?.borderLineWidth,this._borderLineDash=t.borderLineDash??e?.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){return this._padding??this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new JF(this)}}let QF,tL,eL;class iL extends JF{static get DEFAULT(){return QF||(QF=new iL)}constructor(t={},e={}){super(t,e),this.textAlign=(t.textAlign??e?.textAlign)||"center"}clone(){return new iL(this)}}class rL extends JF{_autoWrapText;_lineClamp;static get DEFAULT(){return tL||(tL=new rL)}constructor(t={},e=null){super(t,e),this._autoWrapText=t?.autoWrapText??e?.autoWrapText,this._lineClamp=t?.lineClamp??e?.lineClamp}clone(){return new rL(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}class oL extends JF{_size;_spaceBetweenTextAndIcon;_defaultFill;_defaultStroke;_disableFill;_checkedFill;_checkedStroke;_disableCheckedFill;_disableCheckedStroke;_checkIconImage;_indeterminateIconImage;static get DEFAULT(){return eL||(eL=new oL)}constructor(t={},e={},i={}){super(t,e),this._size=(t?.size??e?.size??i?.size)||14,this._spaceBetweenTextAndIcon=(t?.spaceBetweenTextAndIcon??e?.spaceBetweenTextAndIcon??i?.spaceBetweenTextAndIcon)||8,this._defaultFill=t?.checkboxStyle?.defaultFill??i?.defaultFill,this._defaultStroke=t?.checkboxStyle?.defaultStroke??i?.defaultStroke,this._disableFill=t?.checkboxStyle?.disableFill??i?.disableFill,this._checkedFill=t?.checkboxStyle?.checkedFill??i?.checkedFill,this._checkedStroke=t?.checkboxStyle?.checkedStroke??i?.checkedStroke,this._disableCheckedFill=t?.checkboxStyle?.disableCheckedFill??i?.disableCheckedFill,this._disableCheckedStroke=t?.checkboxStyle?.disableCheckedStroke??i?.disableCheckedStroke,this._checkIconImage=t?.checkboxStyle?.checkIconImage??i?.checkIconImage,this._indeterminateIconImage=t?.checkboxStyle?.indeterminateIconImage??i?.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new oL(t,this)}clone(){return new oL(this)}}function nL(t,e,i,r,o,n){return t||e?t instanceof JF?t:"function"==typeof t?nL(t(i),e,i,r,o,n):(t||(t={}),o&&!Wx(t.autoWrapText)&&(t.autoWrapText=!0),r===oL?new oL(t??{},e??{},n.checkboxStyle??{}):new r(t??{},e??{})):r.DEFAULT}class sL{normalIcon;upIcon;downIcon;freezeIcon;frozenIcon;frozenCurrentIcon;dropDownAbsoluteIcon;expandIcon;collapseIcon;_table;constructor(t){this._table=t;const e=MM();this.freezeIcon=e[Lx.freezeIconName],this.frozenIcon=e[Lx.frozenIconName],this.frozenCurrentIcon=e[Lx.frozenCurrentIconName],this.normalIcon=e[Lx.normalIconName],this.upIcon=e[Lx.upwardIconName],this.downIcon=e[Lx.downwardIconName],this.dropDownAbsoluteIcon=e[Lx.dropdownIconName],this.expandIcon=e[Lx.expandIconName],this.collapseIcon=e[Lx.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:r,sort:o}=this._table.internalProps.layoutMap.getHeader(t,e);let n;if(n="function"==typeof r?r({col:t,row:e,table:this._table}):r,n){let r=this._table.getPivotSortState(t,e);r&&(r=r.toUpperCase());const o="ASC"===r?this.upIcon:"DESC"===r?this.downIcon:this.normalIcon;o&&i.push(o)}else if(o){const r=this.getSortIconForPivotTable(this._table.getPivotSortState(t,e),this._table,t,e);r&&i.push(r)}}else{const r=this._table.sortState;let o;o=void 0;const n=this._table.getCellRange(t,e);if(r)if(Array.isArray(r))for(let t=0;t<r.length;t++){const e=r[t],i=this._table._getHeaderCellBySortState(e);if(i&&MS(n,i.col,i.row)){({order:o}=e);break}}else{const t=this._table._getHeaderCellBySortState(r);t&&MS(n,t.col,t.row)&&({order:o}=r)}const s=this.getSortIcon(o,this._table,t,e);s&&i.push(s)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const r=this.getFrozenIcon(t,e);r&&i.push(r)}if(this.checkDropDownIcon(this._table,t,e)){const t=this.dropDownAbsoluteIcon;i.push(t)}const r=this.getDropDownStateIcons(this._table,t,e);r.length&&i.push(...r);const{headerIcon:o}=this._table._getHeaderLayoutMap(t,e),n=this.getHierarchyIcon(t,e);if(n&&i.push(n),o){let r;if("function"==typeof o){r=o({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table})}else r=o;const n=MM(),s=t=>{let e;e="string"==typeof t?n[t]:t,e&&i.push(e)};Array.isArray(r)?r.forEach(((t,e)=>{s(t)})):s(r)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose)return null;if(this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let r=this.freezeIcon;return this._table.options.frozenColCount-1>t?r=this.frozenIcon:this._table.options.frozenColCount-1===t&&(r=this.frozenCurrentIcon),r}getSortIcon(t,e,i,r){const o="asc"===t?this.upIcon:"desc"===t?this.downIcon:this.normalIcon,n=e.getHeaderDefine(i,r);let s;return n&&(s="function"==typeof n.showSort?n.showSort({col:i,row:r,table:this._table}):n.showSort),!n||!1===s||!Wx(s)&&!n.sort||n.columns&&n.columns.length>0?null:o}getSortIconForPivotTable(t,e,i,r){const o=e.getHeaderDefine(i,r);let n;if(o&&(n="function"==typeof o.showSort?o.showSort({col:i,row:r,table:this._table}):o.showSort),!o||!1===n||!Wx(n)&&!o.sort||o.columns&&o.columns.length>0)return null;return"ASC"===t?.toUpperCase()?this.upIcon:"DESC"===t?.toUpperCase()?this.downIcon:this.normalIcon}getDropDownStateIcons(t,e,i){const r=t.getHeaderDefine(e,i),o=t._getHeaderLayoutMap(e,i);let{dropDownMenu:n}=o;"function"==typeof n&&(n=n({row:i,col:e,table:t}));let s=t.globalDropDownMenu;"function"==typeof s&&(s=s({row:i,col:e,table:t}));const a=[];if(Array.isArray(n)&&n.length||Array.isArray(s)&&s.length&&!r?.columns?.length){const r=n||s;let o=-1,l=-1;for(let n=0;n<r.length;n++){const s=r[n];if("object"==typeof s&&s.children&&s.children.length)for(let r=0;r<s.children.length;r++){const a=s.children[r];if(t.stateManager.menu?.dropDownMenuHighlight&&$F(t,t.stateManager.menu?.dropDownMenuHighlight,"object"==typeof a?a?.menuKey:a,e,i)){o=n,l=r;break}}if(t._dropDownMenuIsHighlight(e,i,n)){o=n;break}}if(-1!==o){let t;t=-1!==l?r[o].children[l]:r[o],t.stateIcon&&(t.stateIcon.svg?a.push({type:"svg",name:t.stateIcon.src||t.stateIcon.svg,width:t.stateIcon.width||22,height:t.stateIcon.height||22,svg:t.stateIcon.svg,positionType:Ex.right,marginRight:0,funcType:Fx.dropDownState,interactive:!1}):t.stateIcon.src&&a.push({type:"image",name:t.stateIcon.src||t.stateIcon.svg,width:t.stateIcon.width||22,height:t.stateIcon.height||22,src:t.stateIcon.src,positionType:Ex.right,marginRight:0,funcType:Fx.dropDownState,interactive:!1}))}}return a}getDropDownIconRect(t,e,i){const r=this.downIcon.hover?.width??this.downIcon?.width??0,o=this.downIcon.hover?.height??this.downIcon?.height??0,n=t.right-2-r,s=t.right-2;let a;a="middle"===i?t.top+t.height/2-r/2:"top"===i?t.top+e/2:"bottom"===i?t.bottom-2*e:t.top;return{left:n,right:s,top:a,bottom:o+a,width:r,height:o}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===kx.expand)return this.expandIcon;if(i===kx.collapse)return this.collapseIcon}}getHierarchyIconWidth(){return this.expandIcon.width+(this.expandIcon.marginLeft??0)+(this.expandIcon.marginRight??0)}checkDropDownIcon(t,e,i){if(t.isPivotTable()){let r=t._getHeaderLayoutMap(e,i).dropDownMenu;if("function"==typeof r&&(r=r({row:i,col:e,table:t})),Array.isArray(r)&&r.length)return!0}else{const r=t.getHeaderDefine(e,i),o=r.dropDownMenu;let n=t.globalDropDownMenu;if("function"==typeof n&&(n=n({row:i,col:e,table:t})),Array.isArray(o)&&o.length||(!Array.isArray(r.dropDownMenu)||0!==r.dropDownMenu.length)&&Array.isArray(n)&&n.length&&!r?.columns?.length)return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return rL;case"image":case"video":return iL;case"checkbox":return oL}}setTableColumnsEditor(){const t=(e,i)=>{e?.forEach(((e,r)=>{e.editor&&(i[r].editor=e.editor),e.columns&&t(e.columns,i[r].columns)}))};t(this._table.options.columns,this._table.internalProps.columns)}}class aL extends EventTarget{_container;_table;_input;constructor(t,e){if(super(),this._table=t,"node"===X_.mode)return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const r=this._input=document.createElement("input");i.appendChild(r),r.classList.add("table-focus-control"),r.dataset.vtable="vtable",r.readOnly=!0,e.appendChild(i),this._container=i}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const r=t.top-this._table.scrollTop,o=t.left-this._table.scrollLeft;i.style.top=`${r.toFixed()}px`,i.style.left=`${o.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){this._container.parentElement?.removeChild(this._container)}}class lL{data;cumulativeSum;difference;totalSum;table;isUpdate=!1;_keys=[];_sorted=!1;constructor(t){this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){if(!Wx(e))return;const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);-1!==i&&this._keys.splice(i,1),this.totalSum-=e;const r=this.table.getRowHeight(t);this.updateDifference(t,r-e)}}put(t,e){if(Wx(e))if(this.data.has(t)){const i=this.data.get(t);if(i===e)return;this.data.set(t,e);const r=e-i;this.totalSum+=r,this.updateDifference(t,r)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0)}updateDifference(t,e){const i=this.difference.get(t)??0;this.difference.set(t,i+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,r]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,r+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,r]of this.difference)i<=t&&(e+=r);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){let e=0,i=0,r=!1;const o=this.table.rowCount>0&&this.table.bottomFrozenRowCount>0?this.table.rowCount-this.table.bottomFrozenRowCount:-1;for(let n=t;n>=0;n--){if(this.cumulativeSum.has(n)){e+=this.cumulativeSum.get(n);break}e+=this.data.get(n)??this.table.getRowHeight(n),n>=o&&-1!==o&&(i=e,r=n===o)}if(r&&this.table.containerFit?.height&&this.table.bottomFrozenRowCount){const t=this.table.tableNoFrameHeight||0;e<t&&(e=t-this.table.getBottomFrozenRowsHeight()+i)}return this.cumulativeSum.set(t,e),e}update(){this.isUpdate||(this.isUpdate=!0,setTimeout((()=>{this.dealDiffenence(),this.isUpdate=!1}),0))}dealDiffenence(){for(const[t]of this.cumulativeSum)for(const[e,i]of this.difference)if(t>=e){const e=this.cumulativeSum.get(t);this.cumulativeSum.set(t,e+i)}this.difference.clear()}insert(t,e){for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),Wx(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;for(let e=t;e<=this.getLastIndex();e++)this.cumulativeSum.delete(e);const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:r}=this;if(t>e){const o=[];for(let n=hL(r,t+i-1);n>=0;n--){const s=r[n];if(s>=t)o.push(this.get(s));else if(e<=s&&s<t)this.put(s+i,this.get(s));else if(s<e)break}for(let t=0;t<i;t++)this.put(e+t,o[i-1-t])}const{length:o}=r;if(t<e){const n=[];for(let s=hL(r,t);s<o;s++){const o=r[s];if(o>=t&&o<t+i)n.push(this.get(o));else if(t+i<=o&&o<=e)this.put(o-i,this.get(o));else if(o>e)break}for(let t=0;t<i;t++)this.put(e+t,n[t])}}exchangeOrder(t,e,i,r,o){const{_keys:n}=this;if(this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0),t>i){const r=[],s=[];for(let o=hL(n,i);o<hL(n,t)+e;o++){const i=n[o];i>=t&&i<t+e?s.push(this.get(i)):r.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,s[t]);for(let t=0;t<r.length;t++)this.put(o+e+t,r[t])}else{const s=[],a=[];for(let o=hL(n,t);o<hL(n,i)+r;o++){const i=n[o];i>=t&&i<t+e?a.push(this.get(i)):s.push(this.get(i))}for(let t=0;t<e;t++)this.put(o+t,a[t]);for(let e=0;e<s.length;e++)this.put(t+e,s[e])}}}function hL(t,e){let i=0,r=t.length-1;for(;i<=r;){const o=Math.floor((i+r)/2);if(t[o]===e)return o;t[o]>e?r=o-1:i=o+1}return r<0?0:r}class cL{dragReorderIconName;_table;constructor(t){this._table=t;const e=MM();this.dragReorderIconName=e[Lx.dragReorderIconName]}getIcons(t,e){return[this.dragReorderIconName]}}class dL{sharedVar;hasHideNode=!1;sizeIncludeParent=!1;setExpandLevel;hierarchyType;tree={id:0,dimensionKey:"",value:"",children:[],level:-1,afterSpanLevel:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0};totalLevel=0;expandedMaxLevel=0;dimensionKeys=new VS;dimensionKeysIncludeVirtual=new VS;cache=new Map;constructor(t,e,i="grid",r=void 0){this.sizeIncludeParent=null!=r,this.setExpandLevel=r,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t){this.totalLevel=0,this.expandedMaxLevel=0,this.hasHideNode=!1,this.cache.clear(),this.dimensionKeys=new VS,this.dimensionKeysIncludeVirtual=new VS,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree)}setTreeNode(t,e,i){t.startIndex=e,t.startInTotal=(i.startInTotal??0)+t.startIndex,t.hide&&(this.hasHideNode=!0),(t.dimensionKey??t.indicatorKey)&&(t.virtual||this.dimensionKeys.contain(t.indicatorKey?eA:t.dimensionKey)||this.dimensionKeys.put(t.level,t.indicatorKey?eA:t.dimensionKey),this.dimensionKeysIncludeVirtual.contain(t.indicatorKey?eA:t.dimensionKey)||this.dimensionKeysIncludeVirtual.put(t.level,t.indicatorKey?eA:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let r=t.dimensionKey&&this.sizeIncludeParent?1:0;const o=t.children||t.columns;return"grid"===this.hierarchyType||null===this.hierarchyType?o?.length>=1?o.forEach((e=>{e.level=(t.level??0)+1,"grid"===this.hierarchyType&&(e.afterSpanLevel=(t.afterSpanLevel??0)+(t.levelSpan??1)),this.totalLevel=Math.max(this.totalLevel,e.level+1),r+=this.setTreeNode(e,r,t)})):r=-1===t.level?0:1:t.hierarchyState===kx.expand&&o?.length>=1?o.forEach((e=>{e.level=(t.level??0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,e.level+1),r+=this.setTreeNode(e,r,t)})):t.hierarchyState===kx.collapse&&o?.length>=1?o.forEach((e=>{e.level=(t.level??0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.setTreeNode(e,r,t)})):!t.hierarchyState&&t.level+1<this.setExpandLevel&&(o?.length>=1||!0===o)?(o[0]?.indicatorKey&&"grid-tree"===this.hierarchyType||(t.hierarchyState=kx.expand),o?.length>=1&&o.forEach((e=>{e.level=(t.level??0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,e.level+1),r+=this.setTreeNode(e,r,t)}))):o?.length>=1||!0===o?(o[0]?.indicatorKey&&"grid-tree"===this.hierarchyType||(t.hierarchyState=kx.collapse),o?.length>=1&&o.forEach((e=>{e.level=(t.level??0)+1,this.totalLevel=Math.max(this.totalLevel,e.level+1),this.setTreeNode(e,r,t)}))):(t.hierarchyState=kx.none,r=-1===t.level?0:1),t.size=r,r}getTreePath(t,e=30){const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}findNodeById(t,e){return t.find((t=>t.id===e))}searchPath(t,e,i,r){if(!e)return;if(t<e.startIndex||t>=e.startIndex+e.size)return;if(i.push(e),!e.children||0===e.children.length||e.level>=r)return;const o=t-e.startIndex;if(this.cache.has(e.level+1)){const t=this.cache.get(e.level+1);if(o>=t.startIndex&&o<t.startIndex+t.size)return void this.searchPath(o,t,i,r)}let n=0,s=e.children.length-1;for(;n<=s;){const t=Math.floor((n+s)/2),a=e.children[t];if(o>=a.startIndex&&o<a.startIndex+a.size){this.cache.set(a.level,a);const t=[];this.cache.forEach(((e,i)=>{i>a.level&&t.push(i)})),t.forEach((t=>{this.cache.delete(t)})),this.searchPath(o,a,i,r);break}o<a.startIndex?s=t-1:n=t+1}}movePosition(t,e,i){let r,o,n;const s=(a,l)=>{if(void 0!==o&&void 0!==n)return;a.level===t&&(a.startInTotal===e&&(o=l),a.startInTotal<=i&&i<=a.startInTotal+a.size-1&&(n=l));const h=a.children||a.columns;if(h&&a.level<t){r=a;for(let t=0;t<h.length;t++)(e>=h[t].startInTotal&&e<=h[t].startInTotal+h[t].size||i>=h[t].startInTotal&&i<=h[t].startInTotal+h[t].size)&&s(h[t],t)}};s(this.tree,0);const a=r.children||r.columns,l=a.splice(o,1);l.unshift(n,0),Array.prototype.splice.apply(a,l)}getCopiedTree(){const t=i_(this.tree.children);return bL(t),t}setAllNodesState(t){this._updateNodeHierarchyState(this.tree,t)}_updateNodeHierarchyState(t,e){t.children&&t.children.length>0&&t.children[0].dimensionKey?(-1!==t.level&&(t.hierarchyState=e),t.children.forEach((t=>{this._updateNodeHierarchyState(t,e)}))):t.hierarchyState=kx.none}}function uL(t,e){e?.forEach((e=>{const i={dimensionKey:e.dimensionKey,indicatorKey:e.indicatorKey,value:e.value,hierarchyState:e.hierarchyState,children:void 0,virtual:e.virtual??!1,levelSpan:e.levelSpan??1};t.push(i),e.children&&(i.children=[],uL(i.children,e.children))}))}function gL(t,e){let i=0;return t?.forEach((t=>{e?i++:t.children&&0!==t.children.length||i++,t.children&&(i+=gL(t.children,e))})),i}function pL(t,e,i,r,o,n){const s=t.id,a=n.rowsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey))??n.columnsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey)),l=n.indicatorsDefine?.find((e=>"string"!=typeof e&&(t.indicatorKey?e.indicatorKey===t.indicatorKey:e.title===t.value&&!t.dimensionKey))),h={id:s,title:t.value??l?.title,field:t.dimensionKey,style:"function"==typeof(l??a)?.headerStyle?(l??a)?.headerStyle:Object.assign({},(l??a)?.headerStyle),headerType:l?.headerType??a?.headerType??"text",headerIcon:l?.headerIcon??a?.headerIcon,define:Object.assign({},t,l??Object.assign({},a,{sort:void 0})),fieldFormat:l?.headerFormat??a?.headerFormat,dropDownMenu:l?.dropDownMenu??a?.dropDownMenu,pivotInfo:{value:t.value,dimensionKey:t.dimensionKey,isPivotCorner:!1},width:a?.width,minWidth:a?.minWidth,maxWidth:a?.maxWidth,showSort:l?.showSort??a?.showSort,sort:l?.sort,description:a?.description};l?(l.customRender&&(t.customRender=l.customRender),Wx(n._indicators?.find((t=>t.indicatorKey===l.indicatorKey)))||n._indicators?.push({id:++n.sharedVar.seqId,indicatorKey:l.indicatorKey,field:l.indicatorKey,fieldFormat:l?.format,cellType:l?.cellType??l?.columnType??"text",chartModule:"chartModule"in l?l.chartModule:null,chartSpec:"chartSpec"in l?l.chartSpec:null,noDataRenderNothing:"noDataRenderNothing"in l&&l.noDataRenderNothing,sparklineSpec:"sparklineSpec"in l?l.sparklineSpec:null,style:l?.style,icon:l?.icon,define:Object.assign({},t,l,{dragHeader:a?.dragHeader}),width:l?.width,minWidth:l?.minWidth,maxWidth:l?.maxWidth,disableColumnResize:l?.disableColumnResize})):t.indicatorKey&&(Wx(n._indicators?.find((e=>e.indicatorKey===t.indicatorKey)))||n._indicators?.push({id:++n.sharedVar.seqId,indicatorKey:t.indicatorKey,field:t.indicatorKey,cellType:"text",define:Object.assign({},t)})),i[s]=h,n._headerObjects[s]=h;for(let t=o-1;t>=0;t--)e[t][n.colIndex]=r[t];if(e[o][n.colIndex]=s,t.levelSpan>1)for(let i=1;i<t.levelSpan;i++){if(!e[o+i]){e[o+i]=[];for(let t=0;t<n.colIndex;t++)e[o+i][t]=e[o][t]}e[o+i][n.colIndex]=s}if(t.children?.length>=1)n._addHeaders(e,o+(t.levelSpan??1),t.children??[],[...r,...Array(t.levelSpan??1).fill(s)],i);else{for(let t=o+1;t<e.length;t++)e[t][n.colIndex]=s;n.colIndex++}}function fL(t,e,i,r,o,n,s,a,l,h,c,d){const u=t.id,g=d.rowsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey))??d.columnsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey)),p=d.indicatorsDefine?.find((e=>"string"!=typeof e&&(t.indicatorKey?e.indicatorKey===t.indicatorKey:e.title===t.value&&!t.dimensionKey))),f={id:u,title:t.value??p?.title,field:t.dimensionKey,style:"function"==typeof(p??g)?.headerStyle?(p??g)?.headerStyle:Object.assign({},(p??g)?.headerStyle),headerType:p?.headerType??g?.headerType??"text",headerIcon:p?.headerIcon??g?.headerIcon,define:Object.assign(t,{linkJump:(p??g)?.linkJump,linkDetect:(p??g)?.linkDetect,templateLink:(p??g)?.templateLink,keepAspectRatio:(p??g)?.keepAspectRatio??!1,imageAutoSizing:(p??g)?.imageAutoSizing,headerCustomRender:(p??g)?.headerCustomRender,headerCustomLayout:(p??g)?.headerCustomLayout,dragHeader:g?.dragHeader,disableHeaderHover:!!(p??g)?.disableHeaderHover,disableHeaderSelect:!!(p??g)?.disableHeaderSelect,showSort:p?.showSort??g?.showSort,hide:p?.hide}),fieldFormat:p?.headerFormat??g?.headerFormat,dropDownMenu:p?.dropDownMenu??g?.dropDownMenu,pivotInfo:{value:t.value,dimensionKey:t.dimensionKey,isPivotCorner:!1},hierarchyLevel:t.level,dimensionTotalLevel:n,hierarchyState:t.hierarchyState,width:g?.width,minWidth:g?.minWidth,maxWidth:g?.maxWidth,showSort:p?.showSort??g?.showSort,sort:p?.sort,description:g?.description,parentCellId:r[r.length-1]};p?(p.customRender&&(t.customRender=p.customRender),Wx(d._indicators?.find((t=>t.indicatorKey===p.indicatorKey)))||d._indicators?.push({id:++d.sharedVar.seqId,indicatorKey:p.indicatorKey,field:p.indicatorKey,fieldFormat:p?.format,cellType:p?.cellType??p?.columnType??"text",chartModule:"chartModule"in p?p.chartModule:null,chartSpec:"chartSpec"in p?p.chartSpec:null,noDataRenderNothing:"noDataRenderNothing"in p&&p.noDataRenderNothing,sparklineSpec:"sparklineSpec"in p?p.sparklineSpec:null,style:p?.style,icon:p?.icon,define:Object.assign({},t,p,{dragHeader:g?.dragHeader}),width:p?.width,minWidth:p?.minWidth,maxWidth:p?.maxWidth,disableColumnResize:p?.disableColumnResize})):t.indicatorKey&&(Wx(d._indicators?.find((e=>e.indicatorKey===t.indicatorKey)))||d._indicators?.push({id:++d.sharedVar.seqId,indicatorKey:t.indicatorKey,field:t.indicatorKey,cellType:"text",define:Object.assign({},t)})),i[u]=f,d._headerObjects[u]=f;for(let t=o-1;t>=0;t--)e[t][d.colIndex]=r[t];e[o][d.colIndex]=u;const m=Math.min((h?c:!c)?s:s-1,t.levelSpan??1e3);if(m>0)for(let t=o+1;t<m;t++){if(!e[t]){e[t]=[];for(let i=0;i<d.colIndex;i++)e[t][i]=e[o][i]}e[t][d.colIndex]=u}if((t.hierarchyState===kx.expand&&t).children?.length>=1)d._addHeadersForGridTreeMode(e,o+(t.levelSpan??1),t.children??[],[...r,...Array(t.levelSpan??1).fill(u)],n,s,a&&t.hierarchyState===kx.expand,l,i,h);else{const a=(h?c:!c)?s:s-1;for(let t=o+1;t<a;t++)e[t]||(e[t]=[]),e[t][d.colIndex]=u;if(o<=a-1&&(h&&!1===c||!h&&!0===c)){let c=t;const g=a-o;for(;c&&!c.children?.[0].indicatorKey;)c=c.children[0];d._addHeadersForGridTreeMode(e,s-1,c.children??[],[...r,...Array(Math.max(g,t.levelSpan??1)).fill(u)],n,s,!0,l,i,h)}else d.colIndex++}}function mL(t,e,i,r,o,n,s,a,l){const h=t.id,c=a.find((e=>"string"!=typeof e&&e.dimensionKey===t.dimensionKey)),d=l.indicatorsDefine?.find((e=>"string"!=typeof e&&(t.indicatorKey?e.indicatorKey===t.indicatorKey:e.title===t.value))),u={id:h,title:t.value??d.title,field:t.dimensionKey,style:t.level+1===n||"function"==typeof(d??c)?.headerStyle?(d??c)?.headerStyle:Object.assign({},(d??c)?.headerStyle,{textAlign:"left"}),headerType:d?.headerType??c?.headerType??"text",headerIcon:d?.headerIcon??c?.headerIcon,define:Object.assign(t,{linkJump:(d??c)?.linkJump,linkDetect:(d??c)?.linkDetect,templateLink:(d??c)?.templateLink,keepAspectRatio:(d??c)?.keepAspectRatio??!1,imageAutoSizing:(d??c)?.imageAutoSizing,headerCustomRender:(d??c)?.headerCustomRender,headerCustomLayout:(d??c)?.headerCustomLayout,dragHeader:c?.dragHeader,disableHeaderHover:!!(d??c)?.disableHeaderHover,disableHeaderSelect:!!(d??c)?.disableHeaderSelect,showSort:d?.showSort??c?.showSort,hide:d?.hide}),fieldFormat:d?.headerFormat??c?.headerFormat,dropDownMenu:d?.dropDownMenu??c?.dropDownMenu,pivotInfo:{value:t.value,dimensionKey:t.dimensionKey,isPivotCorner:!1},hierarchyLevel:t.level,dimensionTotalLevel:n,hierarchyState:t.hierarchyState,width:c?.width,minWidth:c?.minWidth,maxWidth:c?.maxWidth,parentCellId:r[r.length-1]};d?(d.customRender&&(t.customRender=d.customRender),Wx(l._indicators?.find((t=>t.indicatorKey===d.indicatorKey)))||l._indicators?.push({id:++l.sharedVar.seqId,indicatorKey:d.indicatorKey,field:d.indicatorKey,fieldFormat:d?.format,cellType:d?.cellType??d?.columnType??"text",chartModule:"chartModule"in d?d.chartModule:null,chartSpec:"chartSpec"in d?d.chartSpec:null,noDataRenderNothing:"noDataRenderNothing"in d&&d.noDataRenderNothing,sparklineSpec:"sparklineSpec"in d?d.sparklineSpec:null,style:d?.style,icon:d?.icon,define:Object.assign({},t,d,{dragHeader:c?.dragHeader}),width:d?.width,minWidth:d?.minWidth,maxWidth:d?.maxWidth,disableColumnResize:d?.disableColumnResize})):t.indicatorKey&&(Wx(l._indicators?.find((e=>e.indicatorKey===t.indicatorKey)))||l._indicators?.push({id:++l.sharedVar.seqId,indicatorKey:t.indicatorKey,field:t.indicatorKey,cellType:"text",define:Object.assign({},t)})),i[h]=u,l._headerObjects[h]=u,e[o][l.colIndex]=h;for(let t=o-1;t>=0;t--)e[t][l.colIndex]=r[t];if(t.hierarchyState===kx.expand&&t.children?.length>=1)s&&l.colIndex++,l._addHeadersForTreeMode(e,o,t.children??[],[...r,h],n,s&&t.hierarchyState===kx.expand,a,i);else{s&&l.colIndex++;for(let t=o+1;t<e.length;t++)e[t][l.colIndex]=h}}function bL(t){for(let e=0;e<t.length;e++){const i=t[e];delete i.level,delete i.startIndex,delete i.id,delete i.levelSpan,delete i.size,delete i.startInTotal;const r=i.children||i.columns;r&&bL(r)}}function yL(t,e,i,r,o){for(let n=t.length-1;n>=0;n--){const s=t[n];if(e.push(s),r&&s.hide)t.splice(n,1);else if(s.indicatorKey){const r=i?.find((t=>t.indicatorKey===s.indicatorKey))?.hide;"function"==typeof r?r({dimensionPaths:e,table:o})&&t.splice(n,1):r&&t.splice(n,1)}else s.children&&s.children.length>0&&yL(s.children,e,i,r,o);e.pop()}}function CL(t,e){let i,r;e.columnTree&&(!1!==t.options.indicatorsAsCol&&!1!==t.options.supplementIndicatorNodes&&(t.internalProps.columnTree=wL(t.internalProps.columnTree,e.indicators)),i=new dL(t.internalProps.columnTree??[],t.layoutNodeId,t.options.columnHierarchyType,"grid"!==t.options.columnHierarchyType?t.options.columnExpandLevel??1:void 0)),e.rowTree&&(!1===t.options.indicatorsAsCol&&!1!==t.options.supplementIndicatorNodes&&(t.internalProps.rowTree=wL(t.internalProps.rowTree,e.indicators)),r=new dL(t.internalProps.rowTree??[],t.layoutNodeId,t.options.rowHierarchyType,"grid"!==t.options.rowHierarchyType?t.options.rowExpandLevel??1:void 0));const o=r?.dimensionKeys?.count?r.dimensionKeys.valueArr():e.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],n=i?.dimensionKeys?.count?i.dimensionKeys.valueArr():e.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],s=e.indicators?.reduce(((e,i)=>("string"==typeof i?e.push(i):(e.push(i.indicatorKey),(i.chartSpec||i.sparklineSpec)&&(t.internalProps.dataConfig?.aggregationRules?t.internalProps.dataConfig.aggregationRules.find((t=>t.indicatorKey===i.indicatorKey))||t.internalProps.dataConfig.aggregationRules.push({field:i.indicatorKey,indicatorKey:i.indicatorKey,aggregationType:Mx.NONE}):t.internalProps.dataConfig?t.internalProps.dataConfig.aggregationRules=[{field:i.indicatorKey,indicatorKey:i.indicatorKey,aggregationType:Mx.NONE}]:t.internalProps.dataConfig={aggregationRules:[{field:i.indicatorKey,indicatorKey:i.indicatorKey,aggregationType:Mx.NONE}]})),e)),[])??[];return"grid"!==e.rowHierarchyType&&(e.extensionRows?.length??0)>=1&&e.extensionRows?.forEach((t=>{const e=[];t.rows.forEach((t=>{"string"==typeof t?e.push(t):e.push(t.dimensionKey)})),o.push(...e)})),{rowKeys:o,columnKeys:n,indicatorKeys:s,columnDimensionTree:i,rowDimensionTree:r}}function wL(t,e){const i=(t,r)=>{t.forEach((t=>{t.indicatorKey||r||t.children?.length&&t.children?t.children&&Array.isArray(t.children)&&i(t.children,r||!!t.indicatorKey):t.children=e?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title??t.indicatorKey}))}))};return t?.length?i(t,!1):t=e?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title??t.indicatorKey})),t}function vL(t,e,i,r){const o=[];for(let t=0;t<e?.length;t++){const i=e[t];i?.hide&&o.push(i)}(o.length||i)&&yL(t,[],o,i,r)}function xL(t,e){const i=function(t,e){if(!t.internalProps.frozenRowCount)return null;let{scrollTop:i}=t;const r=t.internalProps.frozenRowCount;for(let o=0;o<r;o++){const r=t.getRowHeight(o),n=i+r;if(n>e)return{top:i,row:o,bottom:n,height:r};i=n}return null}(e,t);return i||(AL(t,e)??{top:-1,row:-1,bottom:-1,height:-1})}function _L(t,e){const i=function(t,e){if(!t.internalProps.frozenColCount)return null;let{scrollLeft:i}=t;const r=t.internalProps.frozenColCount;for(let o=0;o<r;o++){const r=t.getColWidth(o),n=i+r;if(n>e)return{left:i,col:o,right:n,width:r};i=n}return null}(e,t);return i||(SL(t,e)??{left:-1,col:-1,right:-1,width:1})}function SL(t,e){if(0===t)return{left:0,col:0,right:0,width:0};const i=function(t,e){if(e._colRangeWidthsMap.get("$0$"+(e.colCount-1))){let i=0,r=e.colCount-1;for(;r-i>1;){const o=Math.floor((i+r)/2);if(t<e._colRangeWidthsMap.get(`$0$${o}`))r=o;else{if(!(t>e._colRangeWidthsMap.get(`$0$${o}`)))return o;i=o}}return r}return Math.min(Math.ceil(t/e.internalProps.defaultColWidth),e.colCount-1)}(t,e),r=e.getColsWidth(0,i);return t>=r?((i,r)=>{let o=r-e.getColWidth(i);const{colCount:n}=e.internalProps;for(let r=i;r<n;r++){const i=e.getColWidth(r),n=o+i;if(Math.round(o)<=Math.round(t)&&Math.round(t)<Math.round(n))return{left:o,col:r,right:n,width:i};o=n}return null})(i,r):((i,r)=>{let o=r;for(let r=i;r>=0;r--){const i=e.getColWidth(r),n=o-i;if(Math.round(n)<=Math.round(t)&&Math.round(t)<Math.round(o))return{left:n,col:r,right:o,width:i};o=n}return null})(i,r)}function AL(t,e){if(0===t)return{top:0,row:0,bottom:0,height:0};const i=!0===e.options.customConfig?._disableColumnAndRowSizeRound?Math.floor:Math.round,r=function(t,e){let i=e.defaultRowHeight;e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))&&(i=e._rowRangeHeightsMap.get("$0$"+(e.rowCount-1))/e.rowCount);return Math.min(Math.ceil(t/i),e.rowCount-1)}(t,e),o=e.getRowsHeight(0,r);return t>=o?((r,o)=>{let n=o-e.getRowHeight(r);const{rowCount:s}=e.internalProps;for(let o=r;o<s;o++){const r=e.getRowHeight(o),s=n+r;if(i(n)<=i(t)&&i(t)<i(s))return{top:n,row:o,bottom:s,height:r};n=s}return null})(r,o):((r,o)=>{let n=o;for(let o=r;o>=0;o--){const r=e.getRowHeight(o),s=n-r;if(i(s)<=i(t)&&i(t)<i(n))return{top:s,row:o,bottom:n,height:r};n=s}return null})(r,o)}function TL(t,e,i){if(0===t)return{left:0,col:0,right:0,width:0};if(t-=i.tableX,e&&t>i.tableNoFrameWidth-i.getRightFrozenColsWidth()&&t<i.tableNoFrameWidth&&t<=i.getAllColsWidth())for(let e=0;e<i.rightFrozenColCount;e++)if(t>i.tableNoFrameWidth-i.getColsWidth(i.colCount-e-1,i.colCount-1))return{col:i.colCount-e-1,left:void 0,right:void 0,width:void 0};return SL(t,i)}function RL(t,e,i){if(0===t)return{top:0,row:0,bottom:0,height:0};if(t-=i.tableY,e&&t>i.tableNoFrameHeight-i.getBottomFrozenRowsHeight()&&t<i.tableNoFrameHeight)for(let e=0;e<i.rightFrozenColCount;e++)if(t>i.tableNoFrameHeight-i.getRowsHeight(i.rowCount-e-1,i.rowCount-1))return{row:i.rowCount-e-1,top:void 0,bottom:void 0,height:void 0};return AL(t,i)}function BL(t){return 2===t.length&&Yx(t[0])&&Yx(t[1])&&t[1]>=t[0]}function ML(t){const e=t[1]-t[0],i=t[1]*t[0]<0;let r=t[0]<=0?0-t[0]:0,o=t[1]>0?t[1]-0:0;return 0===e?t[0]<0?(r=1,o=0):t[0]>0&&(r=0,o=1):(r/=e,o/=e),{total:e,negative:r,positive:o,includeZero:i,domain:t,extendable_min:!0,extendable_max:!0}}function PL(t,e){const{positive:i,negative:r,extendable_min:o,extendable_max:n,domain:s}=t,{positive:a,negative:l,extendable_min:h,extendable_max:c,domain:d}=e;if(a>0){if(!h)return!1;let t=r/i;n&&(t=r/Math.max(i,a),s[1]=-s[0]/t),d[0]=-d[1]*t}else if(l>0){if(!c)return!1;let t=i/r;o&&(t=i/Math.max(r,r),s[0]=-s[1]/t),d[1]=-d[0]*t}return!0}function HL(t,e){const{extendable_min:i,extendable_max:r,domain:o}=t,{positive:n,negative:s,domain:a}=e;return(0!==n||0!==s)&&(!(n>0&&!r)&&(!(s>0&&!i)&&(o[0]=a[0],o[1]=a[1],!0)))}function kL(t,e){const{positive:i,negative:r,extendable_max:o,domain:n}=t,{positive:s,negative:a,extendable_min:l,domain:h}=e;if(o&&l){const t=Math.max(r,a)/Math.max(i,s);n[1]=-n[0]/t,h[0]=-h[1]*t}else if(l){const t=r/i;h[0]=-h[1]*t}else{if(!o)return!1;{const t=a/s;n[1]=-n[0]/t}}return!0}function EL(t,e){const{extendable_min:i,domain:r}=t,{extendable_max:o,domain:n}=e;return!(!i||!o)&&(r[0]=-r[1],n[1]=-n[0],!0)}function FL(t,e,i,r){return 0!==r&&t?()=>t.map((t=>{const r=(t-e.min)/(e.max-e.min),o=(i.max-i.min)*r+i.min;return Math.round(100*o)/100})):void 0}function LL(t,e,i){if(i._table.isPivotChart())if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const r=GL("top",t,e+1,t,i.columnHeaderLevelCount-1,t,e,1,i);if(!r)return;const o=pB(qM("padding",i._table._getCellStyle(t,e+1),t,e+1,i._table)),{range:n,ticks:s,axisOption:a,targetTicks:l,targetRange:h,index:c,theme:d}=r;return Xx(a?.min)&&(n.min=a.min,n.min>0&&(a.zero=!1)),Xx(a?.max)&&(n.max=a.max,n.max<0&&(a.zero=!1)),s_({range:n},a,{orient:"top",type:a?.type||"linear",label:{flush:!0},tick:{tickMode:FL(l,h,n,c)},__ticksForVTable:s,__vtableChartTheme:d,__vtablePadding:o})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){const r=i.getIndicatorKeyInChartSpec(t,e);let o=null;r?.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(o=e)}));const n=GL("bottom",t,e-1,t,e,t,e,0,i);if(!n)return;const s=pB(qM("padding",i._table._getCellStyle(t,e-1),t,e-1,i._table)),{range:a,ticks:l,axisOption:h,index:c,targetTicks:d,targetRange:u,theme:g}=n;return Xx(h?.min)&&(a.min=h.min,a.min>0&&(h.zero=!1)),Xx(h?.max)&&(a.max=h.max,a.max<0&&(h.zero=!1)),s_({title:{visible:!0,text:o?.title},range:a},h,{orient:"bottom",type:h?.type||"linear",label:{flush:!0},tick:{tickMode:FL(d,u,a,c)},__ticksForVTable:l,__vtableChartTheme:g,__vtablePadding:s})}if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){let r=i.getDimensionKeyInChartSpec(i.rowHeaderLevelCount,e);Ux(r)&&(r=r[0]);const o=(i.dataset.collectedValues[r]??[])[i.getRowKeysPath(t,e)??""]??[],{axisOption:n,theme:s,chartType:a}=IL(t+1,e,"left",i);if(!1===n?.visible)return;const l=pB(qM("padding",i._table._getCellStyle(t+1,e),t+1,e,i._table)),h=i.getRawChartSpec(t+1,e);return s_({domain:"linear"===n?.type?void 0:Array.from(o),range:"linear"===n?.type?o:void 0,title:{autoRotate:!0}},n,{orient:"left",type:n?.type??"band",__vtableChartTheme:s,inverse:WL(n,"horizontal"===(h?.direction??("scatter"===a?"vertical":"horizontal"))),__vtablePadding:l})}}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const r=i.getIndicatorKeyInChartSpec(t,e);let o=null;r?.forEach((t=>{const e=i.getIndicatorInfo(t);e&&(o=e)}));const n=GL("left",t+1,e,t,e,t,e,0,i);if(!n)return;const s=pB(qM("padding",i._table._getCellStyle(t+1,e),t+1,e,i._table)),{range:a,ticks:l,axisOption:h,index:c,targetTicks:d,targetRange:u,theme:g}=n;return Xx(h?.min)&&(a.min=h.min,a.min>0&&(h.zero=!1)),Xx(h?.max)&&(a.max=h.max,a.max<0&&(h.zero=!1)),s_({title:{visible:!0,text:o?.title,autoRotate:!0},range:a},h,{orient:"left",type:h?.type||"linear",label:{flush:!0},tick:{tickMode:FL(d,u,a,c)},__ticksForVTable:l,__vtableChartTheme:g,__vtablePadding:s})}if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount){const r=GL("right",t-1,e,i.rowHeaderLevelCount-1,e,t,e,1,i);if(!r)return;const o=pB(qM("padding",i._table._getCellStyle(t-1,e),t-1,e,i._table)),{range:n,ticks:s,axisOption:a,index:l,targetTicks:h,targetRange:c,theme:d}=r;return Xx(a?.min)&&(n.min=a.min,n.min>0&&(a.zero=!1)),Xx(a?.max)&&(n.max=a.max,n.max<0&&(a.zero=!1)),s_({range:n,title:{autoRotate:!0}},a,{orient:"right",type:a?.type||"linear",label:{flush:!0},tick:{tickMode:FL(h,c,n,l)},__ticksForVTable:s,__vtableChartTheme:d,__vtablePadding:o})}if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount){let r=i.getDimensionKeyInChartSpec(t,i.columnHeaderLevelCount);Ux(r)&&(r=r[0]);const o=i.dataset.collectedValues[r]??[],n=i.getColKeysPath(t,e),s=o?.[n??""]??[],{axisOption:a,isPercent:l,theme:h,chartType:c}=IL(t,e-1,"bottom",i);if(!1===a?.visible)return;const d=pB(qM("padding",i._table._getCellStyle(t,e-1),t,e-1,i._table));return s_({domain:"linear"===a?.type?void 0:Array.from(s),range:"linear"===a?.type?s:void 0},a,{orient:"bottom",type:a?.type??"band",__vtableChartTheme:h,__vtablePadding:d})}}}function IL(t,e,i,r){const o=r.getRawChartSpec(t,e),n=o.axes??[];if(r._table.pivotChartAxes.forEach((t=>{-1===n.findIndex((e=>t.orient===e.orient))&&n.push(t)})),o&&Ux(n)){const t=n.find((t=>t.orient===i));if(t){const{seriesIndex:e,seriesId:n}=t;let s,a;Wx(n)&&Ux(o.series)?s=(Ux(n)?n:[n]).map((t=>{const e=o.series.findIndex((e=>e.id===t));return e>=0&&(a=o.series[e]),e})):Wx(e)&&Ux(o.series)&&(s=e);const{isZeroAlign:l,isTickAlign:h}=zL(o,i,r);return{axisOption:t,isPercent:o.percent,isZeroAlign:l,isTickAlign:h,seriesIndice:s,theme:o.theme,chartType:a?.type??o.type}}}const s=r._table.pivotChartAxes.find((t=>t.orient===i)),{isZeroAlign:a,isTickAlign:l}=zL(o,i,r);return{axisOption:s,isPercent:!1,isZeroAlign:a,isTickAlign:l,theme:o.theme,chartType:o.type}}function zL(t,e,i){const r=[];let o;"left"===e||"right"===e?r.push("left","right"):"top"!==e&&"bottom"!==e||r.push("top","bottom"),o=t&&Ux(t.axes)?t.axes:i._table.pivotChartAxes;let n=!1,s=!1;if(Ux(o)){const t=[];o.forEach((e=>{r.includes(e.orient)&&t.push(e)}));for(let e=0;e<t.length;e++){const i=t[e];i.sync&&i.sync.axisId&&t.find((t=>t.id===i.sync.axisId))&&(n=n||i.sync.zeroAlign,s=s||i.sync.tickAlign)}}return{isZeroAlign:n,isTickAlign:s}}function OL(t,e,i,r,o){if(Ux(o)){const n={min:1/0,max:-1/0};for(let s=0;s<o.length;s++){const a=OL(t,e,i,r,o[s]);a&&(n.min=Math.min(n.min,a.min),n.max=Math.max(n.max,a.max))}return isFinite(n.min)&&isFinite(n.max)?n:null}let n=e?.[o];if(Ux(n)&&(n=n[0]),!n)return null;const s=t[n],a=s_({},s?.[r??""]??{min:0,max:1});return a.positiveMax&&a.positiveMax>a.max&&(a.max=a.positiveMax),a.negativeMin&&a.negativeMin<a.min&&(a.min=a.negativeMin),a.min===a.max&&(a.min>0?a.min=0:a.max=0),a}var DL;function WL(t,e){let i=t?.inverse;var r;return e&&(r=t?.orient,"bottom"!==r&&"top"!==r)&&(i=!Wx(t?.inverse)||!t?.inverse),i}function NL(t,e,i,r){if(!Ux(t.axes)||0===t.axes.length)return i&&r||!i&&!r;for(let e=0;e<t.axes.length;e++){const o=t.axes[e];if(!i&&r&&"bottom"===o.orient&&"linear"===o.type)return!0;if(i&&r&&"bottom"===o.orient&&"linear"!==o.type)return!0;if(!i&&!r&&"left"===o.orient&&"linear"!==o.type)return!0;if(i&&!r&&"left"===o.orient&&"linear"===o.type)return!0}if(Ux(e)&&e.length>0)for(let t=0;t<e.length;t++){const o=e[t];if(!i&&r&&"bottom"===o.orient&&"linear"===o.type)return!0;if(i&&r&&"bottom"===o.orient&&"linear"!==o.type)return!0;if(!i&&!r&&"left"===o.orient&&"linear"!==o.type)return!0;if(i&&!r&&"left"===o.orient&&"linear"===o.type)return!0}return i&&r||!i&&!r}function GL(t,e,i,r,o,n,s,a,l){const h=l.getIndicatorKeyInChartSpec(r,o);let c;c="top"===t||"bottom"===t?l.getColKeysPath(n,s):l.getRowKeysPath(n,s);const d=jL(e,i,a,t,h,c,l);if(!d)return;const u="bottom"===t?"top":"top"===t?"bottom":"left"===t?"right":"left",{targetRange:g,targetTicks:p}=UL(e,i,d.index,d.isZeroAlign,d.isTickAlign,d.range,h,u,c,l);if(0!==d.index&&p){const e=wA.getFunction("getAxisDomainRangeAndLabels"),{range:i,ticks:r}=e(d.range.min,d.range.max,d.axisOption,d.isZeroAlign,"bottom"===t||"top"===t?l._table.getColWidth(n)||l._table.tableNoFrameWidth:l._table.getRowHeight(s)||l._table.tableNoFrameHeight,{targetTicks:p,targetRange:g});d.range.min=i[0],d.range.max=i[1],d.ticks=r}return d.targetRange=g,d.targetTicks=p,d}function jL(t,e,i,r,o,n,s){const{axisOption:a,isPercent:l,isZeroAlign:h,isTickAlign:c,seriesIndice:d,theme:u,chartType:g}=IL(t,e,r,s),p=OL(s.dataset.collectedValues,o,h,n,d??i);if(!p)return;l&&(p.min=p.min<0?-1:0,p.max=p.max>0?1:0),(a?.zero||p.min===p.max)&&(p.min=Math.min(p.min,0),p.max=Math.max(p.max,0));const f=wA.getFunction("getAxisDomainRangeAndLabels"),{range:m,ticks:b}=f(p.min,p.max,a,h,"bottom"===r||"top"===r?s._table.getColWidth(t)||s._table.tableNoFrameWidth:s._table.getRowHeight(e)||s._table.tableNoFrameHeight);a?.nice&&(p.min=m[0],p.max=m[1]);const y=b;return Xx(a?.min)&&(p.min=a.min),Xx(a?.max)&&(p.max=a.max),{index:d??i,range:p,ticks:y,isZeroAlign:h,isTickAlign:c,axisOption:a,theme:u,chartType:g}}function VL(t,e,i,r,o,n,s,a){const{range:l,isZeroAlign:h,isTickAlign:c,axisOption:d}=jL(t,e,i,r,n,s,a),{targetRange:u,targetTicks:g}=UL(t,e,i,h,c,l,n,o,s,a);if(0!==i&&g){const i=wA.getFunction("getAxisDomainRangeAndLabels"),{range:o,ticks:n}=i(l.min,l.max,s_({},d,{nice:!0,tick:{forceTickCount:g.length}}),h,"bottom"===r||"top"===r?a._table.getColWidth(t)||a._table.tableNoFrameWidth:a._table.getRowHeight(e)||a._table.tableNoFrameHeight,{targetTicks:g,targetRange:u});l.min=o[0],l.max=o[1]}return{axisOption:d,range:l,targetTicks:g,targetRange:u}}function UL(t,e,i,r,o,n,s,a,l,h){let c,d;if(!r&&!o)return{targetTicks:c,targetRange:d};const u=jL(t,e,s.length-1-i,a,s,l,h);if(u){const{range:s,ticks:l}=u;if(d=s,r){const t=function(t,e){const i=[t.min,t.max],r=[e.min,e.max];if(!BL(i)||!BL(r))return;const o=ML(i),n=ML(r),{positive:s,negative:a,extendable_min:l,extendable_max:h,includeZero:c}=o,{positive:d,negative:u,extendable_min:g,extendable_max:p,includeZero:f}=n;if(0===s&&0===a){if(!HL(o,n))return}else if(0===d&&0===u){if(!HL(n,o))return}else if(c||f)if(c&&!f){if(!PL(o,n))return}else if(f&&!c){if(!PL(n,o))return}else{if(a===u)return;if(a>u){if(!kL(o,n))return}else if(!kL(n,o))return}else{if(0===a&&0===d){if(!EL(o,n))return}else if(0===u&&0===s&&!EL(n,o))return;if(0===a&&0===u)if(0===i[0]&&r[0]>0){if(!g)return;r[0]=0}else{if(!(0===r[0]&&i[0]>0))return;if(!l)return;i[0]=0}if(0===s&&0===d)if(0===i[1]&&r[1]>0){if(!p)return;r[1]=0}else{if(!(0===r[1]&&i[1]>0))return;if(!h)return;i[1]=0}}return{range1:i,range2:r}}(n,s);t&&(n.min=t.range1[0],n.max=t.range1[1],d.min=t.range2[0],d.max=t.range2[1])}o&&(c=r?function(t,e,i,r,o,n){const s=wA.getFunction("getAxisDomainRangeAndLabels"),{axisOption:a,isZeroAlign:l}=IL(e,i,0===r?"right":"left",n),{ticks:h}=s(t.min,t.max,a,l,"bottom"===o||"top"===o?n._table.getColWidth(e)||n._table.tableNoFrameWidth:n._table.getRowHeight(i)||n._table.tableNoFrameHeight);return h}(d,t,e,i,a,h):l)}return{targetTicks:c,targetRange:d}}!function(t){t.vertical="vertical",t.horizontal="horizontal"}(DL||(DL={}));class KL{table;customCellStyle;customCellStyleArrangement;constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleIds(t,e);if(i.length){const r=[];return i.forEach((i=>{const o=this.getCustomCellStyleOption(i);if(Ox(o?.style)){const i=o.style({col:t,row:e,table:this.table,value:this.table.getCellValue(t,e),dataValue:this.table.getCellOriginValue(t,e),cellHeaderPaths:this.table.getCellHeaderPaths(t,e)});r.push(i)}else o?.style&&r.push(o.style)})),s_({},...r)}}getCustomCellStyleIds(t,e){const i=[],r=this.table.getCellRange(t,e);for(let t=r.start.col;t<=r.end.col;t++)for(let e=r.start.row;e<=r.end.row;e++)this.customCellStyleArrangement.forEach((r=>{r.cellPosition.range?r.cellPosition.range.start.col<=t&&r.cellPosition.range.end.col>=t&&r.cellPosition.range.start.row<=e&&r.cellPosition.range.end.row>=e&&i.push(r.customStyleId):r.cellPosition.col===t&&r.cellPosition.row===e&&i.push(r.customStyleId)}));return i}getCustomCellStyleOption(t){return this.customCellStyle.find((e=>e.id===t))}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex((e=>e.id===t));-1===i?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach((e=>{const i=e.cellPosition;if(e.customStyleId===t)if(i.range)for(let t=Math.max(0,i.range.start.col);t<=Math.min(this.table.colCount-1,i.range.end.col);t++)for(let e=Math.max(0,i.range.start.row);e<=Math.min(this.table.rowCount-1,i.range.end.row);e++)this.table.scenegraph.updateCellContent(t,e);else this.table.scenegraph.updateCellContent(i.col,i.row)})),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e,i){const r=this.customCellStyleArrangement.findIndex((e=>e.cellPosition.range&&t.range?e.cellPosition.range.start.col===t.range.start.col&&e.cellPosition.range.start.row===t.range.start.row&&e.cellPosition.range.end.col===t.range.end.col&&e.cellPosition.range.end.row===t.range.end.row:e.cellPosition.col===t.col&&e.cellPosition.row===t.row));if(-1===r&&!e)return;if(-1===r&&e)this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e});else{if(this.customCellStyleArrangement[r].customStyleId===e)return;e?this.customCellStyleArrangement[r].customStyleId=e:this.customCellStyleArrangement.splice(r,1)}const o=this.getCustomCellStyleOption(e)?.style;if(o){i=!0;for(const t in o)if(-1===Bx.indexOf(t)){i=!1;break}}if(t.range)for(let e=Math.max(0,t.range.start.col);e<=Math.min(this.table.colCount-1,t.range.end.col);e++)for(let r=Math.max(0,t.range.start.row);r<=Math.min(this.table.rowCount-1,t.range.end.row);r++){const t=this.table.getCellRange(e,r);for(let e=t.start.col;e<=t.end.col;e++)for(let r=t.start.row;r<=t.end.row;r++)this.table.scenegraph.updateCellContent(e,r,i)}else this.table.scenegraph.updateCellContent(t.col,t.row,i);this.table.scenegraph.updateNextFrame()}updateCustomCell(t,e){this.customCellStyle.length=0,this.customCellStyleArrangement.length=0,t.forEach((t=>{this.registerCustomCellStyle(t.id,t.style)})),e.forEach((t=>{this.arrangeCustomCellStyle(t.cellPosition,t.customStyleId)}))}hasCustomCellStyle(t){return this.customCellStyle.some((e=>e.id===t))}}function $L(t,e){t=t.clone();for(const i in e){const r=e[i];Wx(r)&&(t[`_${i}`]=r)}return t}const XL={};function YL(t){return Math.floor(t)===t}class qL extends UC{onUpdate(t,e,i){if(this.from.x!==this.to.x){const i=t?this.to.x:this.from.x+Math.floor((this.to.x-this.from.x)*e);this.params.table.scrollLeft=i}if(this.from.y!==this.to.y){const i=t?this.to.y:this.from.y+Math.floor((this.to.y-this.from.y)*e);this.params.table.scrollTop=i}}}class ZL{table;timeline;ticker;animation;tempGraphic;constructor(t){this.table=t,this.timeline=new BC,this.ticker=new EC(this.table.scenegraph.stage),this.ticker.addTimeline(this.timeline);this.ticker.setFPS(60),this.tempGraphic=hh({})}scrollTo(t,i){const r={x:this.table.scrollLeft,y:this.table.scrollTop},{col:o,row:n}=t;let s,a,l=o,h=n;Xx(o)&&!YL(o)&&(l=Math.floor(o),s=o-l),Xx(n)&&!YL(n)&&(h=Math.floor(n),a=n-h);const c=this.table.getCellRect(l??0,h??0);let{left:d,top:u}=c;s&&(d+=s*c.width),a&&(u+=a*c.height);const g={x:Xx(o)?d-this.table.getFrozenColsWidth():this.table.scrollLeft,y:Xx(n)?u-this.table.getFrozenRowsHeight():this.table.scrollTop},p=zx(i)?i?3e3:0:i?.duration??3e3,f=zx(i)?i?"linear":"":i?.easing??"linear";new PC(e.GenAutoIncrementId(),this.timeline).bind(this.tempGraphic).play(new qL(r,g,p,f,{graphic:this.tempGraphic,table:this.table})),this.ticker.start()}clear(){this.timeline.clear(),this.ticker.stop()}}function JL(t){return Ox(t)?t:Ux(t)?(e,i)=>t.find((t=>t.range.start.col<=e&&t.range.end.col>=e&&t.range.start.row<=i&&t.range.end.row>=i)):void 0}class QL{plugins=new Map;table;constructor(t,e){this.table=t,e.plugins?.map((t=>{this.register(t),this._bindTableEventForPlugin(t)}))}register(t){this.plugins.set(t.id,t)}registerAll(t){t.forEach((t=>this.register(t)))}getPlugin(t){return this.plugins.get(t)}getPluginByName(t){return Array.from(this.plugins.values()).find((e=>e.name===t))}_bindTableEventForPlugin(t){t.runTime?.forEach((e=>{this.table.on(e,((...i)=>{t.run?.(...i,e,this.table)}))}))}updatePlugins(t){Array.from(this.plugins.values()).filter((e=>!t?.some((t=>t.id===e.id)))).forEach((t=>{this.release(),this.plugins.delete(t.id)})),this.plugins.forEach((t=>{t.update&&t.update()}));const e=t?.filter((t=>!this.plugins.has(t.id)));e?.forEach((t=>{this.register(t),this._bindTableEventForPlugin(t)}))}release(){this.plugins.forEach((t=>{t.release?.(this.table)}))}}const{toBoxArray:tI}=IS,{isTouchEvent:eI}=LS,iI=/^\$(\d+)\$(\d+)$/;!function(){if("node"===X_.mode)return;const t=document.createElement("style");t.id="vtable-style-styleSheet",t.textContent="\n.vtable .input-container {\n\tposition: absolute;\n\ttop:0px;\n}\n.vtable .table-scrollable {\n\tposition: absolute;\n\toverflow: scroll;\n}\n.vtable .table-scrollable::-webkit-scrollbar-button{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-track-piece{\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-corner {\n\tbackground-color: transparent;\n}\n.vtable .table-scrollable::-webkit-scrollbar-thumb {\n\tborder-radius      : 4px;\n\tbackground-color   : rgba(100, 100, 100, .5);\n}\n\n.vtable .table-scroll-end-point {\n\topacity: 0;\n\tposition: relative;\n}\n.vtable {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: relative;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n\n  overflow: hidden; // for react-vtable dom custom element\n}\n\n.vtable-gantt {\n\t/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */\n\t/* overflow: auto; */\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\ttext-align: left;\n  -webkit-font-smoothing:auto;\n\n  overflow: hidden; // for react-vtable dom custom element\n}\n.vtable .table-component-container {\n  pointer-events: none;\n  overflow: hidden;\n  position: absolute;\n  top: 0px;\n  left: 0px;\n}\n.vtable > canvas {\n\tposition: absolute;\n\twidth: 0;\n\theight: 0;\n}\n.vtable .table-focus-control {\n\tposition: relative !important;\n\twidth: 1px;\n\theight: 1px;\n\topacity: 0;\n\tpadding: 0;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\tpointer-events: none;\n\tmax-width: 500px;\n\tmax-height: 500px;\n\tfloat: none !important;\n}\n.vtable input.table-focus-control::-ms-clear {\n\tvisibility: hidden;\n}\n.vtable input.table-focus-control.composition {\n\topacity: 1;\n\tmax-width: none;\n\tmax-height: none;\n}\n",document.head.appendChild(t)}();class rI extends k_{internalProps;showFrozenIcon=!0;padding;globalDropDownMenu;tableNoFrameWidth;tableNoFrameHeight;tableX;tableY;_widthMode;_heightMode;_autoFillWidth;_autoFillHeight;_containerFit;_widthAdaptiveMode;_heightAdaptiveMode;customRender;canvasWidth;canvasHeight;_vDataSet;scenegraph;stateManager;eventManager;editorManager;animationManager;_pixelRatio;canvasSizeSeted;static get EVENT_TYPE(){return OS}options;version="1.19.5";pagination;id=`VTable${Date.now()}`;headerStyleCache;bodyStyleCache;bodyMergeTitleCache;bodyBottomStyleCache;container;isReleased=!1;_chartEventMap={};customCellStylePlugin;columnWidthComputeMode;reactCustomLayout;_hasAutoImageColumn;pluginManager;rotateDegree;constructor(t,e={}){if(super(),"node"===X_.mode?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),!t&&"node"!==e.mode&&!e.canvas)throw new Error("vtable's container is undefined");this.pluginManager=new QL(this,e),this.fireListeners(OS.BEFORE_INIT,{options:e,container:t}),t=e.container&&e.container instanceof HTMLElement?e.container:t,!1===e.customConfig?.imageAnonymous&&(ju.isImageAnonymous=!1);const{frozenColCount:i=0,unfreezeAllOnExceedsMaxWidth:r,frozenRowCount:o,defaultRowHeight:n=40,defaultHeaderRowHeight:s,defaultColWidth:a=80,defaultHeaderColWidth:l,widthMode:h="standard",heightMode:c="standard",autoFillWidth:d=!1,autoFillHeight:u=!1,containerFit:g={width:!1,height:!1},widthAdaptiveMode:p="only-body",heightAdaptiveMode:f="only-body",keyboardOptions:m,eventOptions:b,rowSeriesNumber:y,enableCheckboxCascade:C,enableHeaderCheckboxCascade:w,columnResizeMode:v,rowResizeMode:x="none",resize:_,dragHeaderMode:S,dragOrder:A,showFrozenIcon:T,allowFrozenColCount:R,padding:B,hover:M,menu:P,select:H,customRender:k,pixelRatio:E=fF,renderChartAsync:F,renderChartAsyncBatchCount:L,mode:I,modeParams:z,canvasWidth:O,canvasHeight:D,overscrollBehavior:W,limitMinWidth:N,limitMinHeight:G,clearDOM:j=!0}=e,{groupConfig:V,groupBy:U,groupTitleFieldFormat:K,groupTitleCustomLayout:$,enableTreeStickCell:X}=e;this.container=t,this.options=e,this._widthMode=h,this._heightMode=c,this._widthAdaptiveMode=p,this._heightAdaptiveMode=f,this._autoFillWidth=d,this._autoFillHeight=u,void 0!==g&&(this._containerFit="boolean"==typeof g?{width:g,height:g}:g&&"object"==typeof g?{width:g.width??!0,height:g.height??!0}:{width:!1,height:!1}),this.customRender=k,this.padding={top:0,right:0,left:0,bottom:0},B&&("number"==typeof B?(this.padding.top=B,this.padding.left=B,this.padding.bottom=B,this.padding.right=B):(B.top&&(this.padding.top=B.top),B.bottom&&(this.padding.bottom=B.bottom),B.left&&(this.padding.left=B.left),B.right&&(this.padding.right=B.right))),(Wx(D)||Wx(O))&&(this.canvasSizeSeted=!0),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=Xx(O)?O:void 0,this.canvasHeight=Xx(D)?D:void 0,this.columnWidthComputeMode=e.columnWidthComputeMode??"normal";const Y=this.internalProps={};void 0!==T&&(this.showFrozenIcon=T),"number"==typeof R&&R<=0&&(this.showFrozenIcon=!1),this.options.canvas?("node"!==X_.mode&&(Y.element=this.options.canvas.parentElement,Y.element.style.position="relative"),Y.focusControl=new aL(this,Y.element),Y.canvas=this.options.canvas,Y.context=Y.canvas.getContext("2d")):"node"!==X_.mode&&(Y.element=function(t,e="vtable"){const i=document.createElement("div");i.setAttribute("tabindex","0"),i.classList.add(e),i.style.outline="none",i.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const r=(i.offsetWidth||i.parentElement?.offsetWidth||1)-1,o=(i.offsetHeight||i.parentElement?.offsetHeight||1)-1;return i.style.width=r&&r-t.left-t.right+"px"||"0px",i.style.height=o&&o-t.top-t.bottom+"px"||"0px",i}(this.padding),Y.focusControl=new aL(this,Y.element),Y.canvas=document.createElement("canvas"),Y.element.appendChild(Y.canvas),Y.context=Y.canvas.getContext("2d"),e.customConfig?.createReactContainer&&function(t){const{internalProps:e}=t;e.bodyDomContainer=document.createElement("div"),e.bodyDomContainer.id="vtable-body-dom-container",e.bodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bodyDomContainer),e.headerDomContainer=document.createElement("div"),e.headerDomContainer.id="vtable-header-dom-container",e.headerDomContainer.classList.add("table-component-container"),e.element.appendChild(e.headerDomContainer),e.frozenBodyDomContainer=document.createElement("div"),e.frozenBodyDomContainer.id="vtable-frozen-body-dom-container",e.frozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBodyDomContainer),e.frozenHeaderDomContainer=document.createElement("div"),e.frozenHeaderDomContainer.id="vtable-frozen-header-dom-container",e.frozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenHeaderDomContainer),e.rightFrozenBodyDomContainer=document.createElement("div"),e.rightFrozenBodyDomContainer.id="vtable-right-frozen-body-dom-container",e.rightFrozenBodyDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBodyDomContainer),e.rightFrozenHeaderDomContainer=document.createElement("div"),e.rightFrozenHeaderDomContainer.id="vtable-right-frozen-header-dom-container",e.rightFrozenHeaderDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenHeaderDomContainer),e.frozenBottomDomContainer=document.createElement("div"),e.frozenBottomDomContainer.id="vtable-frozen-bottom-dom-container",e.frozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.frozenBottomDomContainer),e.bottomDomContainer=document.createElement("div"),e.bottomDomContainer.id="vtable-bottom-dom-container",e.bottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.bottomDomContainer),e.rightFrozenBottomDomContainer=document.createElement("div"),e.rightFrozenBottomDomContainer.id="vtable-right-frozen-bottom-dom-container",e.rightFrozenBottomDomContainer.classList.add("table-component-container"),e.element.appendChild(e.rightFrozenBottomDomContainer)}(this)),Y.handler=new GS,Xx(this.options.resizeTime)&&(Y.handler.resizeTime=this.options.resizeTime),Y.pixelRatio=E,Y.frozenColCount=i,Y.frozenRowCount=o,Y.unfreezeAllOnExceedsMaxWidth=r??!0,Y.defaultRowHeight=n,Y.defaultHeaderRowHeight=s??n,Y.defaultColWidth=a,Y.defaultHeaderColWidth=l??a,Y.keyboardOptions=m,Y.eventOptions=b,Y.rowSeriesNumber=y,Y.enableCheckboxCascade=C??y?.enableTreeCheckbox??!0,Y.enableHeaderCheckboxCascade=C||(w??!0),Y.columnResizeMode=_?.columnResizeMode??v,Y.rowResizeMode=_?.rowResizeMode??x,Y.dragHeaderMode=A?.dragHeaderMode??S??"none",Y.renderChartAsync=F,SH(L),Y.overscrollBehavior=W??"auto",Y.groupBy=V?.groupBy??U,Y.groupTitleCheckbox=V?.titleCheckbox??!!y?.enableTreeCheckbox,Y.groupTitleFieldFormat=V?.titleFieldFormat??K,Y.groupTitleCustomLayout=V?.titleCustomLayout??$,Y.enableTreeStickCell=V?.enableTreeStickCell??X,Y._rowHeightsMap=new lL(this),Y._rowRangeHeightsMap=new Map,Y._colRangeWidthsMap=new Map,Y._widthResizedColMap=new Set,Y._heightResizedRowMap=new Set,this.colWidthsMap=new VS,this.colContentWidthsMap=new VS,this.colWidthsLimit={};const q=this;if(Y.calcWidthContext={_:Y,get full(){return"node"===X_.mode?q.canvasWidth/(E??1):this._.canvas.width/(this._.context.pixelRatio??window.devicePixelRatio)}},Y.cellTextOverflows={},Y.focusedTable=!1,Y.theme=bA.of(e.theme??bA.DEFAULT),Y.theme.isPivot=this.isPivotTable(),TM(Y.theme.functionalIconsStyle),t?(j&&(t.innerHTML=""),t.appendChild(Y.element),this._updateSize()):this._updateSize(),Y.bodyHelper=new PF(this),Y.headerHelper=new sL(this),Y.rowSeriesNumberHelper=new cL(this),Y.autoWrapText=e.autoWrapText,Y.enableLineBreak=e.enableLineBreak,Y.allowFrozenColCount=e.allowFrozenColCount??0,Y.limitMaxAutoWidth=e.limitMaxAutoWidth??450,Y.limitMinWidth=null!=N?"number"==typeof N?N:N?10:0:10,Y.limitMinHeight=null!=G?"number"==typeof G?G:G?10:0:10,this.scenegraph=new DE(this),this.stateManager=new rF(this),this.eventManager=new TF(this),this.animationManager=new ZL(this),e.legends){Y.legends=[];const t=wA.getFunction("createLegend");if(Array.isArray(e.legends)){for(let i=0;i<e.legends.length;i++)Y.legends.push(t(e.legends[i],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else Y.legends.push(t(e.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(Y.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Hx.bottom},e.tooltip),"html"===Y.tooltip.renderMode){const t=wA.getComponent("tooltipHandler");t&&(Y.tooltipHandler=new t(this,Y.tooltip.confine))}if(Y.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray(e.menu?.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(e.menu?.dropDownMenuHighlight),(Array.isArray(e.menu?.defaultHeaderMenuItems)||"function"==typeof e.menu?.defaultHeaderMenuItems)&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),"html"===Y.menu.renderMode){const t=wA.getComponent("menuHandler");Y.menuHandler=new t(this)}this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyMergeTitleCache=new Map,this.bodyBottomStyleCache=new Map,Y.stick={changedCells:new Map},Y.customMergeCell=JL(e.customMergeCell);const Z=wA.getComponent("customCellStylePlugin");Z&&(this.customCellStylePlugin=new Z(this,e.customCellStyle??[],e.customCellStyleArrangement??[])),this._adjustCanvasSizeByOption()}_adjustCanvasSizeByOption(){"auto"!==this.options.canvasHeight&&"auto"!==this.options.canvasWidth||setTimeout((()=>{let t,e;if("auto"===this.options.canvasHeight){let t=0;if(this.theme.frameStyle?.innerBorder){t+=tI(this.internalProps.theme.frameStyle?.shadowBlur??[0])[1]??0}else if(this.theme.frameStyle){const e=tI(this.internalProps.theme.frameStyle?.borderLineWidth??[null]),i=tI(this.internalProps.theme.frameStyle?.shadowBlur??[0]);t+=(e[0]??0)+(i[0]??0)+((e[2]??0)+(i[2]??0))}e=Math.min(this.options.maxCanvasHeight?this.options.maxCanvasHeight-t:2e4,this.getAllRowsHeight())+t}else e=this.canvasHeight;if("auto"===this.options.canvasWidth){let e=0;if(this.theme.frameStyle?.innerBorder){e+=tI(this.internalProps.theme.frameStyle?.shadowBlur??[0])[2]??0}else if(this.theme.frameStyle){const t=tI(this.internalProps.theme.frameStyle?.borderLineWidth??[null]),i=tI(this.internalProps.theme.frameStyle?.shadowBlur??[0]);e+=(t[1]??0)+(i[1]??0)+((t[3]??0)+(i[3]??0))}t=Math.min(this.options.maxCanvasWidth?this.options.maxCanvasWidth-e:2e4,this.getAllColsWidth())+e}else t=this.canvasWidth;this.setCanvasSize(t,e)}),0)}throttleInvalidate=function(t,e){let i=null;return function(...r){i||(i=setTimeout((()=>{t.apply(this,r),i=null}),e))}}(this.render.bind(this),200);getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}setCanvasSize(t,e){this.canvasWidth=t,this.canvasHeight=e,this.options.canvasHeight=e,this.options.canvasWidth=t,this.resize()}resize(){this._updateSize(),this.internalProps.legends?.forEach((t=>{t?.resize()})),this.internalProps.title&&this.internalProps.title.resize(),this.internalProps.emptyTip&&this.internalProps.emptyTip.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){return this.internalProps.colCount??0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){return this.internalProps?.layoutMap?.frozenColCount??this.internalProps?.frozenColCount??0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const e=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=e}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const e=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=e}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){return this.internalProps?.layoutMap?.frozenRowCount??this.internalProps?.frozenRowCount??0}set frozenRowCount(t){this.internalProps.frozenRowCount=t,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}get rightFrozenColCount(){return this.internalProps?.layoutMap?.rightFrozenColCount??this.internalProps?.rightFrozenColCount??0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){return this.internalProps?.layoutMap?.bottomFrozenRowCount??this.internalProps?.bottomFrozenRowCount??0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return Xx(this.internalProps.defaultRowHeight)?this.internalProps.defaultRowHeight:40}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){return this.internalProps.keyboardOptions??null}set keyboardOptions(t){this.internalProps.keyboardOptions=t??void 0}get eventOptions(){return this.internalProps.eventOptions??null}set eventOptions(t){this.internalProps.eventOptions=t??void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(t){t!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=t)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(t){t!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=t)}_colWidthDefineToPxWidth(t){return"auto"===t?0:qB(this,t)}_getMaxFrozenWidth(){return qB(this,this.options.maxFrozenWidth??"80%")}_getComputedFrozenColCount(t){const e=this._getMaxFrozenWidth();let i=t;for(;this.getColsWidth(0,i-1)>e&&(i--,!(i<=0)););return i}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=qB(this,e.min),i.minDef=e.min),e.max&&(i.max=qB(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(function(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}(i,e),0)}get pixelRatio(){return this.internalProps.pixelRatio}setPixelRatio(t){if(t!==this.internalProps?.pixelRatio){this.internalProps.pixelRatio=t;const e=this.canvasWidth;this.internalProps.calcWidthContext={_:this.internalProps,get full(){return"node"===X_.mode?e/(t??1):this._.canvas.width/(this._.context.pixelRatio??window.devicePixelRatio)}},this.scenegraph.setPixelRatio(t)}}_updateSize(){const{padding:t}=this;let e=0,i=0;if(this.tableX=0,this.tableY=0,this.options.canvas&&this.options.viewBox)e=this.options.viewBox.x2-this.options.viewBox.x1,i=this.options.viewBox.y2-this.options.viewBox.y1,this?.scenegraph?.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(e,i));else if("browser"===X_.mode){const r=this.getElement();let o=0,n=0;const s=Wx(this.canvasWidth),a=Wx(this.canvasHeight);this.canvasSizeSeted&&(s&&(o=this.canvasWidth),a&&(n=this.canvasHeight));if((!s||!a)&&r.parentElement){const t=r.parentElement.style||window.getComputedStyle(r.parentElement);s||(o=r.parentElement.offsetWidth-(parseInt(t.paddingLeft,10)||0)-(parseInt(t.paddingRight,10)||0)),a||(n=r.parentElement.offsetHeight-parseInt(t.paddingTop||"0px",10)-parseInt(t.paddingBottom||"0px",20)),o=(o??1)-(this.options.tableSizeAntiJitter?1:0),n=(n??1)-(this.options.tableSizeAntiJitter?1:0)}r.style.width=o&&o-t.left-t.right+"px"||"0px",r.style.height=n&&n-t.top-t.bottom+"px"||"0px";const{canvas:l}=this.internalProps;e=(l.parentElement?.offsetWidth??1)-(this.options.tableSizeAntiJitter?1:0),i=(l.parentElement?.offsetHeight??1)-(this.options.tableSizeAntiJitter?1:0),this?.scenegraph?.stage?this.options?.viewBox&&!this.options?.canvas&&this.scenegraph.stage.resize(e,i):(l.style.width="",l.style.height="",l.width=e,l.height=i,l.style.width=`${e}px`,l.style.height=`${i}px`),this.options?.viewBox&&(e=this.options.viewBox.x2-this.options.viewBox.x1,i=this.options.viewBox.y2-this.options.viewBox.y1),this?.scenegraph?.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(e,i))}else"node"===X_.mode&&(e=this.canvasWidth-1,i=this.canvasHeight-1);const r=Math.floor(e-(o=this.getTheme().scrollStyle,o?.hoverOn||o?.verticalVisible&&"none"===o?.verticalVisible||!o?.verticalVisible&&"none"===o?.visible?0:o?.width??7));var o;const n=Math.floor(i-function(t){return t?.hoverOn||t?.horizontalVisible&&"none"===t?.horizontalVisible||!t?.horizontalVisible&&"none"===t?.visible?0:t?.width??7}(this.getTheme().scrollStyle));if(this.internalProps.theme?.frameStyle){const t=tI(this.internalProps.theme.frameStyle?.borderLineWidth??[null]),e=tI(this.internalProps.theme.frameStyle?.shadowBlur??[0]);this.theme.frameStyle?.innerBorder?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=r-(e[1]??0),this.tableNoFrameHeight=n-(e[2]??0)):(this.tableX=(t[3]??0)+(e[3]??0),this.tableY=(t[0]??0)+(e[0]??0),this.tableNoFrameWidth=r-((t[1]??0)+(e[1]??0))-((t[3]??0)+(e[3]??0)),this.tableNoFrameHeight=n-((t[0]??0)+(e[0]??0))-((t[2]??0)+(e[2]??0)))}this._clearColRangeWidthsMap(),this._clearRowRangeHeightsMap()}updateViewBox(t){const e=(this.options?.viewBox?.x2??0)-(this.options?.viewBox?.x1??0),i=(this.options?.viewBox?.y2??0)-(this.options?.viewBox?.y1??0),r=t.x2-t.x1,o=t.y2-t.y1;this.options.viewBox=t,e!==r||i!==o?this.resize():this.scenegraph.stage.setViewBox(this.options.viewBox,!0)}setViewBoxTransform(t,e,i,r,o,n){this.internalProps.modifiedViewBoxTransform=!0,this.scenegraph.stage.window.setViewBoxTransform(t,e,i,r,o,n)}get rowHierarchyType(){return this.dataSource.rowHierarchyType}getColsWidth(t,e){if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,(this.colCount??1/0)-1);const i=this._colRangeWidthsMap.get(`$${t}$${e}`);if(null!=i)return i;const r=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(null!=r){let i=r+this.getColWidth(e);return this.rightFrozenColCount>0&&e===this.colCount-this.rightFrozenColCount&&(i=this._getRangeSizeForContainerFit(t,e,i,"col")),t>=0&&e>=0&&!Number.isNaN(i)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(i)),Math.round(i)}let o=0;for(let i=t;i<=e;i++)o+=this.getColWidth(i);return o=this._getRangeSizeForContainerFit(t,e,o,"col"),t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(o)),Math.round(o)}getRowHeight(t){if(Wx(this.rowHeightsMap.get(t))){if(this.options.customConfig?._disableColumnAndRowSizeRound){const e=this.rowHeightsMap.get(t);let i;return i=t<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,t):t>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(t,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,t),i=Number(i.toFixed(2)),Number.isInteger(i)?Math.ceil(e):Math.floor(e)}return this.rowHeightsMap.get(t)}const e=this.getDefaultRowHeight(t);return Xx(e)?e:this.defaultRowHeight}getDefaultColumnWidth(t){return this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?this.defaultHeaderColWidth[t]??this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount]??this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(t){return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)||this.isSeriesNumberInHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?this.defaultHeaderRowHeight[t]??this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(t)?Array.isArray(this.defaultHeaderRowHeight)?this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0]??this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){this.rowHeightsMap.put(t,this.options.customConfig?._disableColumnAndRowSizeRound?e:Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}setRowHeight(t,e){this.scenegraph.setRowHeight(t,e),this.scenegraph.updateChartSizeForResizeRowHeight(t),this.internalProps._heightResizedRowMap.add(t)}getRowsHeight(t,e){if(t>e||0===this.rowCount)return 0;t=Math.max(t,0),e=Math.min(e,(this.rowCount??1/0)-1);let i=0;const r="auto"===this.options.defaultRowHeight;if("standard"!==this.heightMode||this.options.customComputeRowHeight||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||r||0!==this.internalProps._heightResizedRowMap.size){if(this.options.customConfig?._disableColumnAndRowSizeRound){const i=this.rowHeightsMap.getSumInRange(t,e);let r;return r=e<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,e):e>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(e,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,e),r=Number(r.toFixed(2)),Number.isInteger(r)?Math.ceil(i):Math.floor(i)}i=this.rowHeightsMap.getSumInRange(t,e)}else{const r=this.rowCount-this.bottomFrozenRowCount;for(let r=t;r<Math.min(e+1,this.columnHeaderLevelCount);r++)i+=this.getRowHeight(r);e>=this.columnHeaderLevelCount&&(i+=this.defaultRowHeight*(Math.min(e,r-1)-Math.max(this.columnHeaderLevelCount,t)+1));let o=0;for(let t=r;t<e+1;t++)o+=this.getRowHeight(t);i=this._getRangeSizeForContainerFit(t,e,i+o,"row")}return Math.round(i)}_getRangeSizeForContainerFit(t,e,i,r="col"){if(!isFinite(t)||!isFinite(e))return i;const o="col"===r?{totalCount:"colCount",frozenCount:"rightFrozenColCount",fitType:"width",tableSize:"tableNoFrameWidth",getSize:"getColWidth"}:{totalCount:"rowCount",frozenCount:"bottomFrozenRowCount",fitType:"height",tableSize:"tableNoFrameHeight",getSize:"getRowHeight"},n=this[o.tableSize];if(i>=n)return i;const s=this[o.totalCount]-this[o.frozenCount];if(!isFinite(this[o.totalCount])||this[o.frozenCount]<=0||s<0)return i;if(t>s||e<s||t===e||!this.containerFit?.[o.fitType])return i;const a=this[o.totalCount]-1;let l=n;if(t>0)for(let e=0;e<t;e++)if(l-=this[o.getSize](e),l<=0)return i;if(e!==a)for(let t=e+1;t<=a;t++)if(l-=this[o.getSize](t),l<=0)return i;return l}getColWidthDefined(t){const{layoutMap:e}=this.internalProps;if("autoWidth"===this.widthMode)return"auto";const{width:i}=e?.getColumnWidthDefined(t)??{};return"number"==typeof i&&i<=0?0:i||this.getDefaultColumnWidth(t)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}isAutoRowHeight(t){return"autoHeight"===this.heightMode||(!!this.options.customComputeRowHeight||(t>=0&&t<this.columnHeaderLevelCount?"auto"===this.getDefaultRowHeight(t):"auto"===this.internalProps.defaultRowHeight))}getColWidth(t){const e=this.colWidthsMap.get(t)??this.getDefaultColumnWidth(t);return"adaptive"===this.widthMode&&"number"==typeof e||this.transpose&&"number"==typeof e?this._colWidthDefineToPxWidth(e):this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}_setColWidth(t,e,i,r){this.colWidthsMap.put(t,"number"==typeof e?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),r||this.stateManager.checkFrozen()}setColWidth(t,e){this.scenegraph.setColWidth(t,e),this.scenegraph.updateChartSizeForResizeColWidth(t),this.internalProps._widthResizedColMap.add(t)}_clearColRangeWidthsMap(t){if("number"!=typeof t)this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const e=iI.exec(i);if(e){const r=Number(e[1]),o=Number(e[2]);t>=r&&t<=o&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){if(this.internalProps.rowCount<=0)return 0;return this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){if(this.internalProps.colCount<=0)return 0;return this.getColsWidth(0,this.internalProps.colCount-1)}getColsWidths(){const t=this.colCount,e=[];for(let i=0;i<t;i++)e.push(this.getColWidth(i));return e}getMaxColWidth(t){const e=this.colWidthsLimit[t];let i=(e&&e.max)??1/0;return"string"==typeof i&&(i=qB(this,i)),i}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){const e=this.colWidthsLimit[t];let i=(e&&e.min)??0;return"string"==typeof i&&(i=qB(this,i)),i}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){const i=this.isFrozenCell(t,e);let r;const o=this.getColWidth(t);let n;r=i&&i.col&&this.isRightFrozenColumn(t,e)?this.getAllColsWidth()<=this.tableNoFrameWidth?this.getColsWidth(0,t-1)||0:this.tableNoFrameWidth-(this.getColsWidth(t,this.colCount-1)??0):this.getColsWidth(0,t-1)||0;const s=this.getRowHeight(e);return n=i&&i.row&&this.isBottomFrozenRow(t,e)?this.getAllRowsHeight()<=this.tableNoFrameHeight?this.getRowsHeight(0,e-1):this.tableNoFrameHeight-(this.getRowsHeight(e,this.rowCount-1)??0):this.getRowsHeight(0,e-1),new US(Math.round(r),Math.round(n),Math.round(o),Math.round(s))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),r=this.getColsWidth(0,i.start.col-1)||0,o=this.getColsWidth(i.start.col,i.end.col),n=this.getRowsHeight(0,i.start.row-1)||0,s=this.getRowsHeight(i.start.row,i.end.row);return new US(Math.round(r),Math.round(n),Math.round(o),Math.round(s))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let r=!0,o=!0;i?.col&&i?.row?(r=!1,o=!1):i?.col?r=!1:i?.row&&(o=!1);const n=this.getCellRect(t,e);return this._toRelativeRect(n,r,o)}getCellRangeRelativeRect(t){if(t.start){const e=this.isFrozenCell(t.start.col,t.start.row);let i=!0,r=!0;return e?.col&&e?.row?(i=!1,r=!1):e?.col?i=!1:e?.row&&(r=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),i,r)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let r=!0,o=!0;return i?.col&&i?.row?(r=!1,o=!1):i?.col?r=!1:i?.row&&(o=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),r,o)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,r=Math.min(t.right,this.tableNoFrameWidth),o=t.copy();o.left=i,o.right=r;const n=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,s=Math.min(t.bottom,this.tableNoFrameHeight);return o.top=n,o.bottom=s,o}getCellsRect(t,e,i,r){let o=this.getColsWidth(0,t-1)||0,n=this.getColsWidth(t,i);const s=this.scrollLeft,a=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),l=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?n=this.tableNoFrameWidth-(this.getColsWidth(t+1,this.colCount-1)??0)-o:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?n=Math.max(n-s,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(o=Math.min(o-s,a-this.getRightFrozenColsWidth()),n=a-(this.getColsWidth(t+1,this.colCount-1)??0)-o):this.isRightFrozenColumn(t)&&(o=a-(this.getColsWidth(t,this.colCount-1)??0));let h=this.getRowsHeight(0,e-1),c=this.getRowsHeight(e,r);const d=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(r)?c=this.tableNoFrameHeight-(this.getRowsHeight(e+1,this.rowCount-1)??0)-h:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(r)?c=Math.max(c-d,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(r)?(h=Math.min(h-d,l-this.getBottomFrozenRowsHeight()),c=l-(this.getRowsHeight(e+1,this.rowCount-1)??0)-h):this.isBottomFrozenRow(e)&&(h=l-(this.getRowsHeight(e,this.rowCount-1)??0)),new US(Math.round(o),Math.round(h),Math.round(n),Math.round(c))}getCellsRectWidth(t,e,i,r){const o=this.isFrozenCell(t,e),n=this.isFrozenCell(i,r);let s=this.getColsWidth(t,i);if(o&&o.col){const e=this.scrollLeft;n&&n.col||(s-=e,s=Math.max(s,this.getColsWidth(t,this.frozenColCount-1)))}return s}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e),r=this.isFrozenColumn(t);return i||r?{row:i,col:r}:null}getRowAt(t){return xL(t,this)}getColAt(t){return _L(t,this)}getCellAt(t,e){return function(t,e,i){const r=xL(e,i),{row:o,top:n,bottom:s,height:a}=r,l=_L(t,i),{col:h,left:c,right:d,width:u}=l;return{row:o,col:h,rect:{left:c,right:d,top:n,bottom:s,width:u,height:a}}}(t,e,this)}getCellAtRelativePosition(t,e){return function(t,e,i){t-=i.tableX;let r=!1;(e-=i.tableY)>0&&e<i.getFrozenRowsHeight()&&(r=!0);let o=!1;t>0&&t<i.getFrozenColsWidth()&&(o=!0);let n=!1;e>i.tableNoFrameHeight-i.getBottomFrozenRowsHeight()&&e<i.tableNoFrameHeight&&e<=i.getAllRowsHeight()&&(n=!0);let s=!1;t>i.tableNoFrameWidth-i.getRightFrozenColsWidth()&&t<i.tableNoFrameWidth&&t<=i.getAllColsWidth()&&(s=!0);const a=TL((o||s?t:t+i.scrollLeft)+i.tableX,s,i),l=RL((r||n?e:e+i.scrollTop)+i.tableY,n,i);if(a&&l){const{row:t,top:e,bottom:i,height:r}=l,{col:o,left:n,right:s,width:h}=a;return{row:t,col:o,rect:{left:n,right:s,top:e,bottom:i,width:h,height:r}}}return{col:-1,row:-1}}(t,e,this)}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const r=this.getCellRect(t,e),o=function(t){let e=0,i=0;t.frozenColCount>0&&(e=t.getFrozenColsWidth()),t.rightFrozenColCount>0&&(i=t.getRightFrozenColsWidth());let r=0,o=0;return t.frozenRowCount>0&&(r=t.getFrozenRowsHeight()),t.bottomFrozenRowCount>0&&(o=t.getBottomFrozenRowsHeight()),new US(t.scrollLeft+e,t.scrollTop+r,t.tableNoFrameWidth-e-i,t.tableNoFrameHeight-r-o)}(this);if(o.contains(r))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+r.width>this.canvas.width||(r.left<o.left?this.scrollLeft-=o.left-r.left:o.right<r.right&&(this.scrollLeft-=o.right-r.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+r.height>this.canvas.height||(r.top<o.top?this.scrollTop-=o.top-r.top:o.bottom<r.bottom&&(this.scrollTop-=o.bottom-r.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise(((t,e)=>{setTimeout((()=>{t()}),0)}))}_toRelativeRect(t,e=!0,i=!0){const r=t.copy(),o=this.getVisibleRect();return r.offsetLeft(this.tableX-(e?o.left:0)),r.offsetTop(this.tableY-(i?o.top:0)),r.offsetLeft(this.options.viewBox?.x1??0),r.offsetTop(this.options.viewBox?.y1??0),r}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,r=this.tableNoFrameHeight;return new US(e,t,i,r)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,r=this.getTargetRowAt(i);if(!r)return 0;const o=Math.max(r.top>=i?r.row:r.row+1,t);let n=this.getRowsHeight(0,o-1),s=0;const{rowCount:a}=this;for(let t=o;t<a;t++){const i=n+this.getRowHeight(t);if(e.bottom<i)break;s++,n=i}return s}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),r=this.getFrozenColsWidth(),o=this.getBottomFrozenRowsHeight(),n=this.getRightFrozenColsWidth(),{row:s}=this.getRowAt(t+i+1),{col:a}=this.getColAt(e+r+1),l=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-o).row:this.rowCount-1,h=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-n).col:this.colCount-1;return h<0||l<0?null:{rowStart:s,colStart:a,rowEnd:l,colEnd:h}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:r}=this.getRowAt(t+e+1),o=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return o<0?null:{rowStart:r,rowEnd:o}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:r}=this.getColAt(t+e+1),o=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return o<0?null:{colStart:r,colEnd:o}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,r=this.getTargetColAt(i);if(!r)return 0;const o=Math.max(r.left>=i?r.col:r.col+1,t);let n=this.getColsWidth(0,o-1),s=0;const{colCount:a}=this;for(let t=o;t<a;t++){const i=n+this.getColWidth(t);if(e.right<i)break;s++,n=i}return s}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||"function"!=typeof t.release)throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){const t=this.internalProps;if(this.isReleased)return;t.tooltipHandler?.release?.(),t.menuHandler?.release?.(),super.release?.(),t.handler?.release?.(),this.eventManager.release(),t.focusControl?.release?.(),t.legends?.forEach((t=>{t?.release()})),t.title?.release(),t.title=null,t.emptyTip?.release(),t.emptyTip=null,t.layoutMap.release(),t.releaseList&&(t.releaseList.forEach((t=>t?.release?.())),t.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release(),t.focusControl.release();const{parentElement:e}=t.element;e&&!this.options.canvas&&e.removeChild(t.element),this.editorManager?.editingEditor?.onEnd?.(),this.isReleased=!0,this.scenegraph=null,this.internalProps=null,this.reactCustomLayout?.clearCache(),this.pluginManager.release(),AH()}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t){this.editorManager?.cancelEdit(),this.options=t,this._hasAutoImageColumn=void 0;const{frozenColCount:e=0,unfreezeAllOnExceedsMaxWidth:i,defaultRowHeight:r=40,defaultHeaderRowHeight:o,defaultColWidth:n=80,defaultHeaderColWidth:s=80,keyboardOptions:a,eventOptions:l,rowSeriesNumber:h,enableCheckboxCascade:c,enableHeaderCheckboxCascade:d,columnResizeMode:u,rowResizeMode:g="none",resize:p,dragHeaderMode:f,dragOrder:m,showFrozenIcon:b,allowFrozenColCount:y,padding:C,hover:w,menu:v,select:x,pixelRatio:_,widthMode:S,heightMode:A,autoFillWidth:T,autoFillHeight:R,containerFit:B,widthAdaptiveMode:M,heightAdaptiveMode:P,customRender:H,renderChartAsync:k,renderChartAsyncBatchCount:E,canvasWidth:F,canvasHeight:L,overscrollBehavior:I,limitMinWidth:z,limitMinHeight:O}=t,{groupConfig:D,groupBy:W,groupTitleFieldFormat:N,groupTitleCustomLayout:G,enableTreeStickCell:j}=t;_&&_!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=_),C&&("number"==typeof C?(this.padding.top=C,this.padding.left=C,this.padding.bottom=C,this.padding.right=C):(C.top&&(this.padding.top=C.top),C.bottom&&(this.padding.bottom=C.bottom),C.left&&(this.padding.left=C.left),C.right&&(this.padding.right=C.right))),this.showFrozenIcon="boolean"!=typeof b||b,"number"==typeof y&&y<=0&&(this.showFrozenIcon=!1),this.widthMode=S??"standard",this.heightMode=A??"standard",this._widthAdaptiveMode=M??"only-body",this._heightAdaptiveMode=P??"only-body",this.autoFillWidth=T??!1,this.autoFillHeight=R??!1,void 0!==B&&(this._containerFit="boolean"==typeof B?{width:B,height:B}:B&&"object"==typeof B?{width:B.width??!0,height:B.height??!0}:{width:!1,height:!1}),this.customRender=H,this.canvasWidth=Xx(F)?F:void 0,this.canvasHeight=Xx(L)?L:void 0;const V=this.internalProps;if("node"===X_.mode||t.canvas||function(t,e){t.style.margin=`${e.top}px ${e.right}px ${e.bottom}px ${e.left}px`;const i=(t.offsetWidth||t.parentElement?.offsetWidth||1)-1,r=(t.offsetHeight||t.parentElement?.offsetHeight||1)-1;t.style.width=i&&i-e.left-e.right+"px"||"0px",t.style.height=r&&r-e.top-e.bottom+"px"||"0px"}(V.element,this.padding),this.columnWidthComputeMode=t.columnWidthComputeMode??"normal",V.frozenColCount=e,V.unfreezeAllOnExceedsMaxWidth=i??!0,V.defaultRowHeight=r,V.defaultHeaderRowHeight=o??r,V.defaultColWidth=n,V.defaultHeaderColWidth=s??n,V.keyboardOptions=a,V.eventOptions=l,V.rowSeriesNumber=h,V.enableCheckboxCascade=c??h?.enableTreeCheckbox??!0,V.enableHeaderCheckboxCascade=c||(d??!0),V.columnResizeMode=p?.columnResizeMode??u,V.rowResizeMode=p?.rowResizeMode??g,V.dragHeaderMode=m?.dragHeaderMode??f??"none",V.renderChartAsync=k,SH(E),V.overscrollBehavior=I??"auto",V.cellTextOverflows={},V.groupBy=D?.groupBy??W,V.groupTitleCheckbox=D?.titleCheckbox,V.groupTitleFieldFormat=D?.titleFieldFormat??N,V.groupTitleCustomLayout=D?.titleCustomLayout??G,V.enableTreeStickCell=D?.enableTreeStickCell??j,V._rowHeightsMap=new lL(this),V._rowRangeHeightsMap=new Map,V._colRangeWidthsMap=new Map,V._widthResizedColMap=new Set,V._heightResizedRowMap=new Set,this.colWidthsMap=new VS,this.colContentWidthsMap=new VS,this.colWidthsLimit={},V.stick.changedCells.clear(),V.theme=bA.of(t.theme??bA.DEFAULT),V.theme.isPivot=this.isPivotTable(),TM(V.theme.functionalIconsStyle),this.scenegraph.updateStageBackground(),V.autoWrapText=t.autoWrapText,V.enableLineBreak=t.enableLineBreak,V.allowFrozenColCount=t.allowFrozenColCount??0,V.limitMaxAutoWidth=t.limitMaxAutoWidth??450,V.limitMinWidth=null!=z?"number"==typeof z?z:z?10:0:10,V.limitMinHeight=null!=O?"number"==typeof O?O:O?10:0:10,V.legends?.forEach((t=>{t?.release()})),V.title?.release(),V.title=null,V.emptyTip?.release(),V.emptyTip=null,V.layoutMap.release(),AH(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends){V.legends=[];const e=wA.getFunction("createLegend");if(Array.isArray(t.legends)){for(let i=0;i<t.legends.length;i++)V.legends.push(e(t.legends[i],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else V.legends.push(e(t.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(V.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Hx.bottom},t.tooltip),"html"===V.tooltip.renderMode&&!V.tooltipHandler){const t=wA.getComponent("tooltipHandler");V.tooltipHandler=new t(this,V.tooltip.confine)}if(V.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray(t.menu?.dropDownMenuHighlight)&&this.setDropDownMenuHighlight(t.menu?.dropDownMenuHighlight),(Array.isArray(t.menu?.defaultHeaderMenuItems)||"function"==typeof t.menu?.defaultHeaderMenuItems)&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),"html"===V.menu.renderMode&&!V.menuHandler){const t=wA.getComponent("menuHandler");V.menuHandler=new t(this)}this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache(),V.customMergeCell=JL(t.customMergeCell),this.customCellStylePlugin?.updateCustomCell(t.customCellStyle??[],t.customCellStyleArrangement??[]),this._adjustCanvasSizeByOption()}renderWithRecreateCells(){this.internalProps.stick.changedCells.clear();const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let t=0;for(let e=this.rowCount-this.bottomFrozenRowCount;e<=this.rowCount-1;e++)t+=this.getRowHeight(e);return t}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let t=0;for(let e=this.colCount-this.rightFrozenColCount;e<=this.colCount-1;e++)t+=this.getColWidth(e);return t}return 0}getDrawRange(){const t=this.containerFit?.width?this.tableNoFrameWidth:Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),e=this.containerFit?.height?this.tableNoFrameHeight:Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new US(this.tableX,this.tableY,t,e)}_getMouseAbstractPoint(t){let e;if(!t)return{inTable:!1,x:void 0,y:void 0};e=eI(t)?t.changedTouches[0]:t;const i=e.clientX||e.pageX+window.scrollX,r=e.clientY||e.pageY+window.scrollY,o=this.internalProps.canvas.getBoundingClientRect();let n=!0;o.right<=i&&(n=!1),o.bottom<=r&&(n=!1);const s=o.width,a=s/((90===this.rotateDegree?this.canvas.offsetHeight:this.canvas.offsetWidth)||s),l=o.height,h=l/((90===this.rotateDegree?this.canvas.offsetWidth:this.canvas.offsetHeight)||l),c=this.pluginManager.getPluginByName("Rotate Table");if(c&&90===this.rotateDegree){const t={x:i/a-(this.options.viewBox?.x1??0),y:r/h-(this.options.viewBox?.y1??0),inTable:n};return c.matrix.transformPoint(t,t),t}const d={x:(i-o.left)/a-(this.options.viewBox?.x1??0),y:(r-o.top)/h-(this.options.viewBox?.y1??0),inTable:n};if(this.internalProps.modifiedViewBoxTransform&&this.scenegraph.stage.window.getViewBoxTransform()){return this.scenegraph.stage.window.getViewBoxTransform().transformPoint(d,d),d}return d}getTheme(){return this.internalProps.theme}getTargetColAt(t){return SL(t,this)}getTargetRowAt(t){const e=AL(t,this);return e&&(e.row=Math.min(e.row,this.rowCount-1)),e}getTargetColAtConsiderRightFrozen(t,e){return TL(t,e,this)}getTargetRowAtConsiderBottomFrozen(t,e){return RL(t,e,this)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e,i,r,o,n=!1){const s=!!this.stateManager.select.ranges?.length;this.stateManager.updateSelectPos(t,e,i,r,!1,o??this.options.select?.makeSelectCellVisible??!0,n),this.stateManager.endSelectCells(!0,s)}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach(((t,e)=>{t.start.col===t.end.col&&t.start.row===t.end.row?this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1,!1,this.options.select?.makeSelectCellVisible??!0,!0):(this.stateManager.updateSelectPos(t.start.col,t.start.row,!1,e>=1,!1,this.options.select?.makeSelectCellVisible??!0,!0),this.stateManager.updateInteractionState(Tx.grabing),this.stateManager.updateSelectPos(t.end.col,t.end.row,!1,e>=1,!1,this.options.select?.makeSelectCellVisible??!0,!0)),this.stateManager.endSelectCells(!1,!1),this.stateManager.updateInteractionState(Tx.default)})),this.setScrollTop(i),this.setScrollLeft(e)}get recordsCount(){return this.records?.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),function(t,e){$B(t,(()=>{t.internalProps.dataSource&&t.internalProps.releaseList.forEach((e=>{e instanceof TA&&(e.release(),t.internalProps.releaseList.splice(t.internalProps.releaseList.indexOf(e),1))})),e?e instanceof TA?(t.internalProps.dataSource=e,t.internalProps.dataSource.supplementConfig(t.pagination,t.options.columns,t.internalProps.layoutMap.rowHierarchyType,YB(t))):t.internalProps.dataSource=new tB(e):t.internalProps.dataSource=TA.EMPTY,t.addReleaseObj(t.internalProps.dataSource),t.internalProps.records=null}))}(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(t){this.internalProps.enableLineBreak=t,this.options.enableLineBreak=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=bA.of(t??bA.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,TM(this.internalProps.theme.functionalIconsStyle)}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=bA.of(t??bA.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),TM(this.internalProps.theme.functionalIconsStyle),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return i?.define}getBodyColumnType(t,e){return qM("cellType",{cellType:this.internalProps.layoutMap.getBody(t,e)?.cellType??"text"},t,e,this)}getCellType(t,e){let i;return this.isSeriesNumberInHeader(t,e)?this.internalProps.layoutMap.getSeriesNumberHeader(t,e).cellType:(i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,qM("cellType",{cellType:i},t,e,this))}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return i?.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const r=this.getHeaderDefine(t,e);if(!r||!r.field&&!r.columns)break;i.push(r),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){if(!this.internalProps.layoutMap.isHeader(t,e))return this.getCellOriginRecord(t,e)}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find((e=>e&&e.field===t.field));if(i){return e.getHeaderCellAdressById(i.id)}}getCellRange(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(Wx(i.text)||i.customLayout||i.customRender)){return{start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0}}}return this.internalProps.layoutMap?.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(Wx(i.text)||i.customLayout||this.customRender)){if(i.style){const r=this.internalProps.bodyHelper.getStyleClass("text"),o=$_(i.style,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},r,this.options.autoWrapText,this.theme);i.style=o}return i.range={start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0},i}}}isCellRangeEqual(t,e,i,r){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,r)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){const i=this._getHeaderLayoutMap(t,e),r=i?.define,o=r?.description??i?.description;if("function"==typeof o){return o({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)})}return o}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isSeriesNumberInBody(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(t,e)}isSeriesNumberInHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){return this.internalProps.layoutMap?.isColumnHeader(t,e)}isRowHeader(t,e){return this.internalProps.layoutMap?.isRowHeader(t,e)}isCornerHeader(t,e){return this.internalProps.layoutMap?.isCornerHeader(t,e)}isFrozenColumn(t,e){return this.isLeftFrozenColumn(t,e)||this.isRightFrozenColumn(t,e)}isLeftFrozenColumn(t,e){return this.internalProps.layoutMap?.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){return this.internalProps.layoutMap?.isRightFrozenColumn(t,e)}isFrozenRow(t,e){return this.isTopFrozenRow(t,e)||this.isBottomFrozenRow(t,e)}isTopFrozenRow(t,e){return this.internalProps.layoutMap?.isFrozenRow(t,e)}isBottomFrozenRow(t,e){return this.internalProps.layoutMap?.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:i?.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){if(null===t)return!1;const r=this;if(r.internalProps.layoutMap.isHeader(e,i))return!1;const o=r.getRecordShowIndexByCell(e,i);return r.internalProps.dataSource?.hasField(o,t)}_getCellStyle(t,e){return function(t,e,i){const r=i.customCellStylePlugin?.getCustomCellStyle(t,e),{layoutMap:o}=i.internalProps;if(o.isHeader(t,e)){let n;if(!i.isPivotTable()||i.isBottomFrozenRow(e)||i.isRightFrozenColumn(t))n=`${t}-${e}`;else{const r=i.getHeaderDefine(t,e),o=i.isCornerHeader(t,e);n=r?.dimensionKey?o?`dim-cor-${r.dimensionKey}`:`dim-${r.dimensionKey}`:r?.indicatorKey?`ind-${r.indicatorKey}`:`${t}-${e}`}let s=i.headerStyleCache.get(n);if(s)return r?$L(s,r):s;const a=o.getHeader(t,e);let l;if(i.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(i.hasTwoIndicatorAxes&&e===i.columnHeaderLevelCount-1&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0}else if(e===i.rowCount-i.bottomFrozenRowCount&&t>=i.rowHeaderLevelCount&&t<i.colCount-i.rightFrozenColCount)return!0;return!1}(t,e,o)&&o.isAxisCell(t,e)){const e=o.getBody(t,i.rowHeaderLevelCount);l=e.style?.padding??i.theme.bodyStyle.padding}else if(i.isPivotChart()&&function(t,e,i){if(!i._table.isPivotChart())return!1;if(i.indicatorsAsCol){if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}else{if(t===i.rowHeaderLevelCount-1&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0;if(t===i.colCount-i.rightFrozenColCount&&e>=i.columnHeaderLevelCount&&e<i.rowCount-i.bottomFrozenRowCount)return!0}return!1}(t,e,o)&&o.isAxisCell(t,e)){const t=o.getBody(i.columnHeaderLevelCount,e);l=t.style?.padding??i.theme.bodyStyle.padding}if((!a||a.isEmpty)&&(o.isLeftBottomCorner(t,e)||o.isRightBottomCorner(t,e)||o.isCornerHeader(t,e)||o.isRightTopCorner(t,e)))return XL;const h=i.internalProps.headerHelper.getStyleClass(a?.headerType||"text");if(o.isBottomFrozenRow(t,e)&&i.theme.bottomFrozenStyle)s=nL(l?{padding:l}:{},i.theme.bottomFrozenStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},h,i.options.autoWrapText,i.theme);else if(o.isRightFrozenColumn(t,e)&&i.theme.rightFrozenStyle)s=nL(l?{padding:l}:{},i.theme.rightFrozenStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},h,i.options.autoWrapText,i.theme);else{const r=a?.style||{};l&&(r.padding=l),s=nL(r,o.isColumnHeader(t,e)||o.isBottomFrozenRow(t,e)?i.theme.headerStyle:o.isRowHeader(t,e)||o.isRightFrozenColumn(t,e)?i.theme.rowHeaderStyle:i.theme.cornerHeaderStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},h,i.options.autoWrapText,i.theme)}return i.headerStyleCache.set(n,s),r?$L(s,r):s}let n,s;i.internalProps?.dataConfig?.mappingRules&&!i.isHeader(t,e)&&i.internalProps?.dataConfig?.mappingRules?.forEach(((r,o)=>{r.bgColor&&i.internalProps.layoutMap.getIndicatorKey(t,e)===r.bgColor.indicatorKey&&(n=r.bgColor.mapping)}));const a=i.getCellType(t,e),l=i.getCellOriginRecord(t,e);let h;if(s=l?.vtableMerge?"merge-title":i.isSeriesNumberInBody(t,e)?`${t}-series-`+a:i.isListTable()&&!i.transpose||i.isPivotTable()&&i.internalProps.layoutMap.indicatorsAsCol?t+a:e+a,h=l?.vtableMerge?i.bodyMergeTitleCache.get(s):o.isBottomFrozenRow(e)?i.bodyBottomStyleCache.get(s):i.bodyStyleCache.get(s),h)return r?$L(h,r):h;const c=o.getBody(t,e),d=i.internalProps.bodyHelper.getStyleClass(i.getCellType(t,e)),u=c?.style;return h=$_(u,l?.vtableMerge&&i.theme.groupTitleStyle?i.theme.groupTitleStyle:o.isBottomFrozenRow(e)&&i.theme.bottomFrozenStyle?i.theme.bottomFrozenStyle:o.isRightFrozenColumn(t)&&i.theme.rightFrozenStyle?i.theme.rightFrozenStyle:i.theme.bodyStyle,{col:t,row:e,table:i,value:i.getCellValue(t,e),dataValue:i.getCellOriginValue(t,e),cellHeaderPaths:i.getCellHeaderPaths(t,e)},d,i.options.autoWrapText,i.theme),n&&(h=$L(h,{bgColor:n})),Ox(u)||(o.isBottomFrozenRow(e)?i.bodyBottomStyleCache.set(s,h):i.bodyStyleCache.set(s,h)),r?$L(h,r):h}(t,e,this)}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyMergeTitleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t+1,e))return!1;if("none"===this.internalProps.columnResizeMode)return!1;if("header"===this.internalProps.columnResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.columnResizeMode&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(t,e){if(!(t>=0&&e>=0))return!1;if(this.isCellRangeEqual(t,e,t,e+1))return!1;if("none"===this.internalProps.rowResizeMode)return!1;if("header"===this.internalProps.rowResizeMode){if(!this.isHeader(t,e))return!1}else if("body"===this.internalProps.rowResizeMode&&this.isHeader(t,e))return!1;return!0}_canDragHeaderPosition(t,e){if(this.isHeader(t,e)&&(this.stateManager.isSelected(t,e)||"body"===this.options.select?.headerSelectMode&&function(t,e,i){for(let r=0;r<i.length;r++)if(MS(i[r],t,e))return!0;return!1}(t,e,[this.getCellRange(this.stateManager.select.cellPos.col,this.stateManager.select.cellPos.row)])||OH(this,t,e))){if("disabled"===this.internalProps.frozenColDragHeaderMode&&this.isFrozenColumn(t))return!1;if(this.stateManager.isSelected(t,e)){const i=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(i.end.row!==this.rowCount-1)return!1}else{if(!this.isRowHeader(t,e))return!1;if(i.end.col!==this.colCount-1)return!1}}const i=this.getHeaderDefine(t,e);if(!i)return!1;if(void 0===i.dragHeader){if("all"===this.internalProps.dragHeaderMode)return!0;if("column"===this.internalProps.dragHeaderMode){if(this.isColumnHeader(t,e))return!0}else if("row"===this.internalProps.dragHeaderMode&&this.isRowHeader(t,e))return!0;return!1}return i.dragHeader}return!1}getCellIcons(t,e){let i;if(this.isHeader(t,e))i=this.internalProps.headerHelper.getIcons(t,e);else if(this.internalProps.layoutMap.isSeriesNumber(t,e)){if(!this.internalProps.groupBy||!this.getCellRawRecord(t,e)?.vtableMerge){const r=this.internalProps.layoutMap.getSeriesNumberBody(t,e)?.define?.dragOrder;r&&(i=this.internalProps.rowSeriesNumberHelper.getIcons(t,e))}const r=this.getCellValue(t,e),o=this.getCellOriginValue(t,e),n=this.internalProps.context,s=this.internalProps.bodyHelper.getIcons(t,e,r,o,n);i?.length>0?i=i.concat(s):s?.length>0&&(i=s)}else{const r=this.getCellValue(t,e),o=this.getCellOriginValue(t,e),n=this.internalProps.context;i=this.internalProps.bodyHelper.getIcons(t,e,r,o,n)}return i}showDropDownMenu(t,e,i){let r="dropdown-menu";i&&(r=Array.isArray(i.content)?"dropdown-menu":"container"),"html"===this.internalProps.menu.renderMode&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,r,i))}showTooltip(t,e,i){"html"===this.internalProps.tooltip.renderMode&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),r=ZB(i,this,t,e,qM).theme,{autoWrapText:o,lineClamp:n,textOverflow:s}=i;return{textAlign:r.text.textAlign,textBaseline:r.text.textBaseline,bgColor:zx(r.group.fill)?qM("bgColor",i,t,e,this):r.group.fill,color:zx(r.text.fill)?qM("color",i,t,e,this):r.text.fill,strokeColor:zx(r.text.stroke)?qM("strokeColor",i,t,e,this):r.text.stroke,fontFamily:r.text.fontFamily,fontSize:r.text.fontSize,fontWeight:r.text.fontWeight,fontVariant:r.text.fontVariant,fontStyle:r.text.fontStyle,lineHeight:r.text.lineHeight,autoWrapText:o??!1,lineClamp:n??"auto",textOverflow:s,borderColor:zx(r.group.stroke)?qM("borderColor",i,t,e,this):r.group.stroke,borderLineWidth:r.group.lineWidth,borderLineDash:r.group.lineDash,underline:!!r.text.underline,underlineDash:r.text.underlineDash,underlineOffset:r.text.underlineOffset,lineThrough:!!r.text.lineThrough,padding:r._vtable.padding,underlineWidth:r.text.underline,lineThroughLineWidth:r.text.lineThrough,_strokeArrayWidth:r.group.strokeArrayWidth,_strokeArrayColor:r.group.strokeArrayColor,_linkColor:qM("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,r=this.columnHeaderLevelCount,o=this.colCount-1,n=this.rowCount-1;return Array(Math.min(e??2e3,n-r+1,this.rowCount)).fill(0).map(((e,n)=>Array(Math.min(t??2e3,o-i+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+i,n+r)))))}getAllCells(t,e){const i=0,r=0,o=this.colCount-1,n=this.rowCount-1;return Array(Math.min(e??2e3,n-r+1,this.rowCount)).fill(0).map(((e,n)=>Array(Math.min(t??2e3,o-i+1,this.colCount)).fill(0).map(((t,e)=>this.getCellInfo(e+i,n+r)))))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=0,i=this.colCount-1,r=this.columnHeaderLevelCount-1;return Array(r-e+1).fill(0).map(((r,o)=>Array(i-t+1).fill(0).map(((i,r)=>this.getCellInfo(r+t,o+e)))))}getAllRowHeaderCells(){const t=0,e=this.columnHeaderLevelCount,i=this.rowHeaderLevelCount-1,r=this.rowCount-1;return Array(r-e+1).fill(0).map(((r,o)=>Array(i-t+1).fill(0).map(((i,r)=>this.getCellInfo(r+t,o+e)))))}getCopyValue(){if(this.stateManager.select?.ranges?.length>0){const t=this.stateManager.select.ranges;let e=Math.min(t[0].start.col,t[0].end.col),i=Math.max(t[0].start.col,t[0].end.col),r=Math.min(t[0].start.row,t[0].end.row),o=Math.max(t[0].start.row,t[0].end.row);t.forEach((t=>{e=Math.min(e,t.start.col,t.end.col),i=Math.max(i,t.start.col,t.end.col),r=Math.min(r,t.start.row,t.end.row),o=Math.max(o,t.start.row,t.end.row)}));const n=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.row,t.end.row),o=Math.max(t.start.row,t.end.row);r<=e&&o>=e&&(i=!0)})),i},s=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.col,t.end.col),o=Math.max(t.start.col,t.end.col);r<=e&&o>=e&&(i=!0)})),i},a=(e,i)=>{let r;return t.forEach((t=>{const o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.row,t.end.row),s=Math.min(t.start.col,t.end.col),a=Math.max(t.start.col,t.end.col);s<=e&&a>=e&&o<=i&&n>=i&&(r=t)})),r},l=(t,e,i)=>{const r=this.getCellRange(t,e);let o=r.start.col,n=r.start.row;if(i){const t=Math.min(i.start.col,i.end.col),e=Math.min(i.start.row,i.end.row);o=Math.max(t,r.start.col),n=Math.max(e,r.start.row)}if(o!==t||n!==e)return"";return this.getCellValue(t,e)};let h="";for(let t=r;t<=o;t++){if(n(t)){for(let r=e;r<=i;r++){if(s(r)){const e=a(r,t);if(e){const o=l(r,t,e);if("undefined"!=typeof Promise&&o instanceof Promise);else{const t=Wx(o)?`${o}`:"";/^\[object .*\]$/.exec(t)||(h+=t)}(r<e.end.col||r<i)&&(h+="\t")}else h+="\t"}}t<o&&(h+="\r\n")}}return this.options?.formatCopyValue&&(h=this.options.formatCopyValue(h)),h}return""}getSelectedCellInfos(){if(!this.stateManager.select?.ranges)return null;const t=this.stateManager.select.ranges;if(!t.length)return[];let e=Math.min(t[0].start.col,t[0].end.col),i=Math.max(t[0].start.col,t[0].end.col),r=Math.min(t[0].start.row,t[0].end.row),o=Math.max(t[0].start.row,t[0].end.row);t.forEach((t=>{e=Math.min(e,t.start.col,t.end.col),i=Math.max(i,t.start.col,t.end.col),r=Math.min(r,t.start.row,t.end.row),o=Math.max(o,t.start.row,t.end.row)}));const n=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.row,t.end.row),o=Math.max(t.start.row,t.end.row);r<=e&&o>=e&&(i=!0)})),i},s=e=>{let i=!1;return t.forEach((t=>{const r=Math.min(t.start.col,t.end.col),o=Math.max(t.start.col,t.end.col);r<=e&&o>=e&&(i=!0)})),i},a=(e,i)=>{let r;return t.forEach((t=>{const o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.row,t.end.row),s=Math.min(t.start.col,t.end.col),a=Math.max(t.start.col,t.end.col);s<=e&&a>=e&&o<=i&&n>=i&&(r=t)})),r},l=[];for(let t=r;t<=o;t++){if(n(t)){const r=[];for(let o=e;o<=i;o++){if(s(o)){if(a(o,t)){const e=this.getCellInfo(o,t);r.push(e)}}}l.push(r)}}return l}getSelectedCellRanges(){const t=this.stateManager.select.ranges;return t.length?i_(t):[]}measureText(t,e){return zP.measureText(t,e)}measureTextBounds(t){return DP(t)}getCustomRender(t,e){let i;if("body"!==this.getCellLocation(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerCustomRender}else{const r=this.getBodyColumnDefine(t,e);i=r?.customRender||this.customRender}return i}getCustomLayout(t,e){let i;if("body"!==this.getCellLocation(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerCustomLayout}else{const r=this.getBodyColumnDefine(t,e);i=r?.customLayout}return i}hasAutoImageColumn(){return void 0===this._hasAutoImageColumn&&(this._hasAutoImageColumn=function(t){const{columns:e,rows:i,indicators:r}=t.options;if(t.isPivotTable()){if(Ux(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!Vx(i)&&("image"===i.headerType||"video"===i.headerType||"function"==typeof i.headerType)&&i.imageAutoSizing)return!0}if(Ux(i)&&i.length>0)for(let t=0;t<i.length;t++){const e=i[t];if(!Vx(e)&&("image"===e.headerType||"video"===e.headerType||"function"==typeof e.headerType)&&e.imageAutoSizing)return!0}if(Ux(r)&&r.length>0)for(let t=0;t<r.length;t++){const e=r[t];if(!Vx(e)&&(("image"===e.cellType||"video"===e.cellType||"function"==typeof e.cellType)&&e.imageAutoSizing||("image"===e.headerType||"video"===e.headerType||"function"==typeof e.headerType)&&e.imageAutoSizing))return!0}}else if(Ux(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(("image"===i.cellType||"video"===i.cellType||"function"==typeof i.cellType)&&i.imageAutoSizing||("image"===i.headerType||"video"===i.headerType||"function"==typeof i.headerType)&&i.imageAutoSizing)return!0}return!1}(this)),this._hasAutoImageColumn}_getActiveChartInstance(){const t=this.scenegraph.getCell(this.stateManager.hover?.cellPos?.col,this.stateManager.hover?.cellPos?.row);return"chart"===t?.getChildren()?.[0]?.type?t.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){const i=this.getDrawRange(),r=this.getCellRelativeRect(t,e);if(t<this.frozenColCount&&e<this.frozenRowCount)return!0;let o,n,s,a;if(this.frozenRowCount>=1&&(o=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}})),this.frozenColCount>=1&&(n=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.frozenColCount-1,row:this.rowCount-1}})),this.bottomFrozenRowCount>=1&&(s=this.getCellRangeRelativeRect({start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}})),this.rightFrozenColCount>=1&&(a=this.getCellRangeRelativeRect({start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.rowCount-1}})),r.top>=i.top&&r.bottom<=i.bottom&&r.left>=i.left&&r.right<=i.right){if(this.isFrozenCell(t,e))return!0;if(r.top>=(o?.bottom??r.top)&&r.left>=(n?.right??r.left)&&r.bottom<=(s?.top??r.bottom)&&r.right<=(a?.left??r.right))return!0}return!1}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:t}=i;return t}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e,i){const r=this.cellIsInVisualView(t,e),{scrollTop:o,scrollLeft:n}=this;r||this.scrollToCell({col:t,row:e});const s=this.getCellRelativeRect(t,e);this.stateManager.select?.ranges?.length>0&&Jk(this.scenegraph);const{col:a,row:l}=this.stateManager.hover.cellPos;let h,c;if(this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.tableGroup.border.setAttribute("visible",!1),i?.disableBackground){const i=this.scenegraph.getCell(t,e);h=i.attribute.fill,i.setAttribute("fill","transparent")}if(i?.disableBorder){const i=this.scenegraph.getCell(t,e);c=i.attribute.stroke,i.setAttribute("stroke",!1)}this.scenegraph.renderSceneGraph();let d=0;"bottom-right"===this.theme.cellBorderClipDirection&&(d=1);const u=this.scenegraph.stage.toCanvas(!1,(new p_).set(s.left+this.tableX+1,s.top+this.tableY+1,s.right+this.tableX-d,s.bottom+this.tableY-d));if(r||(this.setScrollTop(o),this.setScrollLeft(n)),this.scenegraph.tableGroup.border.setAttribute("visible",!0),h){this.scenegraph.getCell(t,e).setAttribute("fill",h)}if(c){this.scenegraph.getCell(t,e).setAttribute("stroke",c)}return this.stateManager.select?.ranges?.length>0&&Qk(this.scenegraph),this.stateManager.updateHoverPos(a,l),this.scenegraph.updateNextFrame(),u.toDataURL()}exportCellRangeImg(t){const{scrollTop:e,scrollLeft:i}=this,r=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.col,t.end.col),s=Math.max(t.start.row,t.end.row),a=this.cellIsInVisualView(r,o),l=this.cellIsInVisualView(n,s);a&&l||this.scrollToCell({col:r,row:o});const h=this.getCellRangeRelativeRect({start:{col:r,row:o},end:{col:n,row:s}});this.stateManager.select?.ranges?.length>0&&Jk(this.scenegraph);const{col:c,row:d}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const u=this.scenegraph.stage.toCanvas(!1,(new p_).set(h.left+this.tableX+1,h.top+this.tableY+1,h.right+this.tableX,h.bottom+this.tableY)).toDataURL();return a&&l||(this.setScrollTop(e),this.setScrollLeft(i)),this.stateManager.select?.ranges?.length>0&&Qk(this.scenegraph),this.stateManager.updateHoverPos(c,d),u}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(t="image/png"){if("node"!==this.options.mode)return;this.render();const e=this.scenegraph.stage;if(e){let i=this.tableX+this.getAllColsWidth(),r=this.tableY+this.getAllRowsHeight();if(this.internalProps.legends&&this.internalProps.legends.forEach((t=>{"right"===t.orient?i=Math.max(i,t.legendComponent.globalAABBBounds.x2):"bottom"===t.orient&&(r=Math.max(r,t.legendComponent.globalAABBBounds.y2))})),this.internalProps.title&&("right"===this.internalProps.title._titleOption.orient?i=Math.max(i,this.internalProps.title.getComponentGraphic().globalAABBBounds.x2):"bottom"===this.internalProps.title._titleOption.orient&&(r=Math.max(r,this.internalProps.title.getComponentGraphic().globalAABBBounds.y2))),i>=this.canvasWidth&&r>=this.canvasHeight){e.render();return e.window.getImageBuffer(t)}return this.scenegraph.stage.toCanvas(!1,(new p_).set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,r))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount+this.leftRowSeriesNumberCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),"function"==typeof e?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter((t=>t.callback!==e)):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach((i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)}))}changeRecordOrder(t,e){}hasCustomCellStyle(t){return this.customCellStylePlugin?.hasCustomCellStyle(t)}registerCustomCellStyle(t,e){this.customCellStylePlugin?.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e,i){this.customCellStylePlugin?.arrangeCustomCellStyle(t,e,i)}isSeriesNumber(t,e){return this.internalProps.layoutMap.isSeriesNumber(t,e)}isHasSeriesNumber(){return this.internalProps.layoutMap?.leftRowSeriesNumberColumnCount>0}get leftRowSeriesNumberCount(){return this.internalProps.layoutMap?.leftRowSeriesNumberColumnCount??0}setMinMaxLimitWidth(t=!1){const e=this.internalProps;for(let i=0;i<e.layoutMap.columnWidths.length;i++){if(this.internalProps._widthResizedColMap.has(i))continue;const{width:r,minWidth:o,maxWidth:n}=e.layoutMap.columnWidths?.[i]??{};t&&r&&("string"==typeof r&&"auto"!==r||"number"==typeof r&&r>0)&&this._setColWidth(i,r),o&&("number"==typeof o&&o>0||"string"==typeof o)&&this.setMinColWidth(i,o),n&&("number"==typeof n&&n>0||"string"==typeof n)&&this.setMaxColWidth(i,n)}}setSortedIndexMap(t,e){this.dataSource?.setSortedIndexMap(t,e)}checkReactCustomLayout(){this.reactCustomLayout||(this.reactCustomLayout=new EM(this))}get bodyDomContainer(){return this.internalProps.bodyDomContainer}get headerDomContainer(){return this.internalProps.headerDomContainer}get frozenBodyDomContainer(){return this.internalProps.frozenBodyDomContainer}get frozenHeaderDomContainer(){return this.internalProps.frozenHeaderDomContainer}get rightFrozenBodyDomContainer(){return this.internalProps.rightFrozenBodyDomContainer}get rightFrozenHeaderDomContainer(){return this.internalProps.rightFrozenHeaderDomContainer}get frozenBottomDomContainer(){return this.internalProps.frozenBottomDomContainer}get bottomDomContainer(){return this.internalProps.bottomDomContainer}get rightFrozenBottomDomContainer(){return this.internalProps.rightFrozenBottomDomContainer}showMoverLine(t,e){this.scenegraph.component.showMoveCol(t,e,0),this.scenegraph.renderSceneGraph()}hideMoverLine(t,e){this.scenegraph.component.hideMoveCol(),this.scenegraph.renderSceneGraph()}disableScroll(){this.eventManager.disableScroll()}enableScroll(){this.eventManager.enableScroll()}getGroupTitleLevel(t,e){}scrollToRow(t,e){e?this.animationManager.scrollTo({row:t},e):this.scrollToCell({row:t})}scrollToCol(t,e){e?this.animationManager.scrollTo({col:t},e):this.scrollToCell({col:t})}scrollToCell(t,e){if(e)return void this.animationManager.scrollTo(t,e);const i=this.getDrawRange();if(Wx(t.col)&&t.col>=this.frozenColCount){const e=this.getFrozenColsWidth(),r=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(r-e,this.getAllColsWidth()-i.width)}if(Wx(t.row)&&t.row>=this.frozenRowCount){const e=this.getFrozenRowsHeight(),r=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(r-e,this.getAllRowsHeight()-i.height)}this.render()}checkHasColumnAutoWidth(){return function(t){if("autoWidth"===t.options.widthMode)return!0;if("auto"===t.options.defaultHeaderColWidth||Array.isArray(t.options.defaultHeaderColWidth)&&t.options.defaultHeaderColWidth.includes("auto"))return!0;const e=t.internalProps.layoutMap.columnObjects;for(let t=0;t<e.length;t++)if("auto"===e[t].width)return!0;return!1}(this)}get containerFit(){return this._containerFit}set containerFit(t){this._containerFit="boolean"==typeof t?{width:t,height:t}:t&&"object"==typeof t?{width:t.width??!0,height:t.height??!0}:{width:!1,height:!1}}}var oI=Object.freeze({__proto__:null,BaseTable:rI});const nI={},sI={};const aI={};function lI(t){if(aI[t])return aI[t]}function hI(t,e,i){const r=t[e];return t[e]=i,r}function cI(t){for(const e in t)delete t[e]}function dI(){cI(ZS),cI(BM),cI(nI),cI(aI),cI(f_)}var uI=Object.freeze({__proto__:null,aggregator:function(t,e){null!=e&&hI(f_,t,e)},chartModule:function(t,e){return null!=e?hI(nI,t,e):nI[t]},clearAll:dI,editor:function(t,e){return null!=e?hI(aI,t,e):aI[t]},icon:function(t,e){return null!=e?hI(BM,t,e):BM[t]},theme:function(t,e){return null!=e?hI(ZS,t,e):ZS[t]}});var gI=Object.freeze({__proto__:null,dateFormat:function(t,e,i,r,o){null==i&&(i=!1),null==r&&(r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==o&&(o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);const n=i?"UTC":"",s=function(t){return`0${t}`.substring(0,2)};return function(i){const a=new Date(Date.parse(i[t]));return e.replace(/%(.)/g,(function(t,e){switch(e){case"y":return a[`get${n}FullYear`]();case"m":return s(a[`get${n}Month`]()+1);case"n":return r[a[`get${n}Month`]()];case"d":return s(a[`get${n}Date`]());case"w":return o[a[`get${n}Day`]()];case"x":return a[`get${n}Day`]();case"H":return s(a[`get${n}Hours`]());case"M":return s(a[`get${n}Minutes`]());case"S":return s(a[`get${n}Seconds`]());default:return`%${e}`}}))}},numberFormat:function(t){return t=Object.assign({},{digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:""},t),function(e){if(isNaN(e)||!isFinite(e))return"";const i=function(t,e,i){const r=(t+="").split(".");let o=r[0];const n=r.length>1?i+r[1]:"";return o=function(t,e){return t.replace(/\d+/,(function(t){return t.replace(/(\d)(?=(\d{3})+$)/g,(function(t){return`${t}${e}`}))}))}(o,e),o+n}((t.scaler*e).toFixed(t.digitsAfterDecimal),t.thousandsSep,t.decimalSep);return`${t.prefix}${i}${t.suffix}`}}}),pI=Object.freeze({__proto__:null,CustomCellStylePlugin:KL,PluginManager:QL});var fI=(t,e)=>Object.prototype.toString.call(t)===`[object ${e}]`;var mI=(t,e=!1)=>e?"boolean"==typeof t:!0===t||!1===t||fI(t,"Boolean");var bI=t=>"function"==typeof t;var yI=t=>null==t;var CI=t=>null!=t;var wI=t=>"object"==typeof t&&null!==t;var vI=function(t){if(!wI(t)||!fI(t,"Object"))return!1;if(null===Object.getPrototypeOf(t))return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e};var xI=(t,e=!1)=>{const i=typeof t;return e?"string"===i:"string"===i||fI(t,"String")};var _I=t=>Array.isArray?Array.isArray(t):fI(t,"Array");var SI=function(t){return null!==t&&"function"!=typeof t&&Number.isFinite(t.length)};var AI=t=>fI(t,"Date");var TI=(t,e=!1)=>{const i=typeof t;return e?"number"===i:"number"===i||fI(t,"Number")};function RI(t,e,i){let r;if(!CI(t)||"object"!=typeof t||e&&e(t))return t;const o=_I(t),n=t.length;r=o?new Array(n):"object"==typeof t?{}:mI(t)||TI(t)||xI(t)?t:AI(t)?new Date(+t):void 0;const s=o?void 0:Object.keys(Object(t));let a=-1;if(r)for(;++a<(s||t).length;){const o=s?s[a]:a,n=t[o];i&&i.includes(o.toString())?r[o]=n:r[o]=RI(n,e,i)}return r}function BI(t,e,i=!1,r=!1){if(e){if(t===e)return;if(CI(e)&&"object"==typeof e){const o=Object(e),n=[];for(const t in o)n.push(t);let{length:s}=n,a=-1;for(;s--;){const s=n[++a];!CI(o[s])||"object"!=typeof o[s]||r&&_I(t[s])?PI(t,s,o[s]):MI(t,e,s,i,r)}}}}function MI(t,e,i,r=!1,o=!1){const n=t[i],s=e[i];let a=e[i],l=!0;if(_I(s)){if(r)a=[];else if(_I(n))a=n;else if(SI(n)){a=new Array(n.length);let t=-1;const e=n.length;for(;++t<e;)a[t]=n[t]}}else vI(s)?(a=null!=n?n:{},"function"!=typeof n&&"object"==typeof n||(a={})):l=!1;l&&BI(a,s,r,o),PI(t,i,a)}function PI(t,e,i){(void 0!==i&&!function(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}(t[e],i)||void 0===i&&!(e in t))&&(t[e]=i)}function HI(t,e,i){const r=function(t){if(!t)return[];if(Object.keys)return Object.keys(t);const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(i);return e}(e);for(let o=0;o<r.length;o++){const n=r[o];(i?null!=e[n]:null==t[n])&&(t[n]=e[n])}return t}function kI(t,e,i=!0){if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames){const r=Object.getOwnPropertyNames(e);for(let o=0;o<r.length;o++){const n=r[o];"constructor"!==n&&(i?null!=e[n]:null==t[n])&&(t[n]=e[n])}}else HI(t,e,i)}function EI(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function FI(t){return Number(t)}const LI="undefined"!=typeof console;function II(t,e,i){const r=[e].concat([].slice.call(i));LI&&console[t].apply(console,r)}var zI;!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug"}(zI||(zI={}));class OI{static getInstance(t,e){return OI._instance&&TI(t)?OI._instance.level(t):OI._instance||(OI._instance=new OI(t,e)),OI._instance}static setInstance(t){return OI._instance=t}static setInstanceLevel(t){OI._instance?OI._instance.level(t):OI._instance=new OI(t)}static clearInstance(){OI._instance=null}constructor(t=zI.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((e=>e===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach((e=>e(...t)))}canLogInfo(){return this._level>=zI.Info}canLogDebug(){return this._level>=zI.Debug}canLogError(){return this._level>=zI.Error}canLogWarn(){return this._level>=zI.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=zI.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):II(null!==(e=this._method)&&void 0!==e?e:"error","ERROR",t)),this}warn(...t){return this._level>=zI.Warn&&II(this._method||"warn","WARN",t),this}info(...t){return this._level>=zI.Info&&II(this._method||"log","INFO",t),this}debug(...t){return this._level>=zI.Debug&&II(this._method||"log","DEBUG",t),this}}OI._instance=null;const DI=1e-10,WI=1e-10;function NI(t,e,i=WI,r=DI){const o=r,n=i*Math.max(t,e);return Math.abs(t-e)<=Math.max(o,n)}function GI(t,e,i,r){return t>e&&!NI(t,e,i,r)}function jI(t,e,i,r){return t<e&&!NI(t,e,i,r)}const VI=t=>{let e=null,i=null;return(...r)=>(e&&r.every(((t,i)=>t===e[i]))||(e=r,i=t(...r)),i)};var UI=function(t,e,i){return t<e?e:t>i?i:t};function KI(t,e){let i;return t>e&&(i=t,t=e,e=i),i=>Math.max(t,Math.min(e,i))}function $I(t,e){return i=>t*(1-i)+e*i}function XI(t,e){return function(i){return Math.round(t*(1-i)+e*i)}}function YI(t,e,i){e/=100,i/=100;const r=(1-Math.abs(2*i-1))*e,o=r*(1-Math.abs(t/60%2-1)),n=i-r/2;let s=0,a=0,l=0;return 0<=t&&t<60?(s=r,a=o,l=0):60<=t&&t<120?(s=o,a=r,l=0):120<=t&&t<180?(s=0,a=r,l=o):180<=t&&t<240?(s=0,a=o,l=r):240<=t&&t<300?(s=o,a=0,l=r):300<=t&&t<360&&(s=r,a=0,l=o),s=Math.round(255*(s+n)),a=Math.round(255*(a+n)),l=Math.round(255*(l+n)),{r:s,g:a,b:l}}function qI(t,e,i){t/=255,e/=255,i/=255;const r=Math.min(t,e,i),o=Math.max(t,e,i),n=o-r;let s=0,a=0,l=0;return s=0===n?0:o===t?(e-i)/n%6:o===e?(i-t)/n+2:(t-e)/n+4,s=Math.round(60*s),s<0&&(s+=360),l=(o+r)/2,a=0===n?0:n/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l:l}}const ZI=/^#([0-9a-f]{3,8})$/,JI={transparent:4294967040},QI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function tz(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function ez(t){return TI(t)?new sz(t>>16,t>>8&255,255&t,1):_I(t)?new sz(t[0],t[1],t[2]):new sz(255,255,255)}function iz(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function rz(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const oz=(t,e)=>{const i=ZI.exec(t);if(e||i){const t=parseInt(i[1],16),e=i[1].length;return 3===e?new sz((t>>8&15)+((t>>8&15)<<4),(t>>4&15)+((t>>4&15)<<4),(15&t)+((15&t)<<4),1):6===e?ez(t):8===e?new sz(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):null}};class nz{static Brighter(t,e=1){return 1===e?t:new nz(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return 1===e?t:new nz(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof nz?t:new nz(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(CI(JI[t]))return function(t){return TI(t)?new sz(t>>>24,t>>>16&255,t>>>8&255,255&t):_I(t)?new sz(t[0],t[1],t[2],t[3]):new sz(255,255,255,1)}(JI[t]);if(CI(QI[t]))return ez(QI[t]);const e=`${t}`.trim().toLowerCase(),i=oz(e);if(void 0!==i)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const t=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new sz(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),parseFloat(t[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const t=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),i=YI(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10));return new sz(i.r,i.g,i.b,parseFloat(t[3]))}}constructor(t){const e=nz.parseColorString(t);this.color=e||new sz(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return.5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=qI(this.color.r,this.color.g,this.color.b),n=YI(yI(t)?o.h:UI(t,0,360),yI(e)?o.s:e>=0&&e<=1?100*e:e,yI(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new sz(n.r,n.g,n.b,r),this}setRGB(t,e,i){return!yI(t)&&(this.color.r=t),!yI(e)&&(this.color.g=e),!yI(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=oz(e,!0);return null!=i?i:this}setColorName(t){const e=QI[t.toLowerCase()];return void 0!==e&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new nz(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=iz(t.color.r),this.color.g=iz(t.color.g),this.color.b=iz(t.color.b),this}copyLinearToSRGB(t){return this.color.r=rz(t.color.r),this.color.g=rz(t.color.g),this.color.b=rz(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class sz{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),CI(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${tz(this.r)+tz(this.g)+tz(this.b)+(1===this.opacity?"":tz(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${1===t?"rgb(":"rgba("}${this.r},${this.g},${this.b}${1===t?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=qI(this.r,this.g,this.b);return`${1===t?"hsl(":"hsla("}${e},${i}%,${r}%${1===t?")":`,${t})`}`}toString(){return this.formatHex()}}var az=Object.freeze({__proto__:null,Color:nz,DEFAULT_COLORS:QI,RGB:sz,hexToRgb:function(t){let e="",i="",r="";const o="#"===t[0]?1:0;for(let n=o;n<t.length;n++)"#"!==t[n]&&(n<o+2?e+=t[n]:n<o+4?i+=t[n]:n<o+6&&(r+=t[n]));return[parseInt(e,16),parseInt(i,16),parseInt(r,16)]},hslToRgb:YI,interpolateRgb:function(t,e){const i=t.r,r=e.r,o=t.g,n=e.g,s=t.b,a=e.b,l=t.opacity,h=e.opacity;return t=>{const e=Math.round(i*(1-t)+r*t),c=Math.round(o*(1-t)+n*t),d=Math.round(s*(1-t)+a*t);return new sz(e,c,d,l*(1-t)+h*t)}},rgbToHex:function(t,e,i){return Number((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},rgbToHsl:qI});const lz=(t,e)=>{var i,r;if(!(null==e?void 0:e.fields))return t;if(0===t.length)return t;const o=e.fields,n=t[0],s={},a=[];for(const e in o)if(Object.prototype.hasOwnProperty.call(o,e)){const l=o[e];if(!l.type){let r=n;e in n||(r=null!==(i=t.find((t=>e in t)))&&void 0!==i?i:n),l.type="number"==typeof r[e]?"linear":"ordinal"}let h;if("number"==typeof l.sortIndex&&(h={key:e,type:l.type,index:l.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:!0===l.sortReverse},a.push(h)),(null===(r=l.domain)||void 0===r?void 0:r.length)>0)if("ordinal"===l.type){l._domainCache={},s[e]=l;const t={};l.domain.forEach(((e,i)=>{t[e]=i,l._domainCache[e]=i})),h&&(h.sortIndex=t,h.sortIndexCount=l.domain.length)}else l.domain.length>=2&&(s[e]=l)}return Object.keys(s).length>0&&(t=t.filter((t=>{for(const e in s){const i=s[e];if("ordinal"===i.type){if(!(t[e]in i._domainCache))return!1}else if(i.domain[0]>t[e]||i.domain[1]<t[e])return!1}return!0}))),a.sort(((t,e)=>t.index-e.index)),t.sort(((t,e)=>function(t,e,i){for(let r=0;r<i.length;r++){const o=i[r];let n=0;if("ordinal"===o.type?(void 0===o.sortIndex[e[o.key]]&&(o.sortIndex[e[o.key]]=o.sortIndexCount++),void 0===o.sortIndex[t[o.key]]&&(o.sortIndex[t[o.key]]=o.sortIndexCount++),n=o.sortIndex[t[o.key]]-o.sortIndex[e[o.key]]):"linear"===o.type&&(n=t[o.key]-e[o.key]),o.sortReverse&&(n=-n),0!==n)return n}return 0}(t,e,a))),t};let hz=0;function cz(t="dataset"){return hz>1e8&&(hz=0),t+"_"+hz++}class dz{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new et,i=(null==t?void 0:t.name)?t.name:cz("dataset"),this.name=i,this._logger=null!==(e=null==t?void 0:t.logger)&&void 0!==e?e:OI.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&(null===(i=this._logger)||void 0===i||i.error(`Error: dataView ${t} 之前已存在，请重新命名`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&(null===(i=this._logger)||void 0===i||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{t.some((t=>t.isRunning))||i()}),t.forEach((t=>{t.target.addListener(e,r)})),this._callMap.set(i,r)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const r=this._callMap.get(i);r&&t.forEach((t=>{t.target.removeListener(e,r)})),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.parseNewData(t.data,t.options)}))}multipleDataViewUpdateInRawData(t){t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.markRunning()})),t.forEach((t=>{var e;return null===(e=this.getDataView(t.name))||void 0===e?void 0:e.updateRawData(t.data,t.options)}))}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const uz="_data-view-diff-rank";class gz{constructor(t,e){let i;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new et,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(t={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach((e=>{this.executeTransform(e,{pushHistory:t.pushHistory,emitMessage:!1}),this.isLastTransform(e)&&this.diffLastData()})),this.isRunning=!1,!1!==t.emitMessage&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=(null==e?void 0:e.name)?e.name:cz("dataview"),this.name=i,(null==e?void 0:e.history)&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(null==e?void 0:e.fields)}parse(t,e,i=!1){var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const o=this.cloneParseData(t,e);if(null==e?void 0:e.type){const t=(null!==(r=this.dataSet.getParser(e.type))&&void 0!==r?r:this.dataSet.getParser("bytejson"))(o,e.options,this);this.rawData=o,this.parserData=t,this.history&&this.historyData.push(o,t),this.latestData=t}else this.parserData=o,this.rawData=o,this.history&&this.historyData.push(o),this.latestData=o;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t,e=!0){if(this.isRunning=!0,t&&t.type){let i=!0;if("fields"===t.type){this._fields=t.options.fields;const e=this.transformsArr.findIndex((e=>e.type===t.type));e>=0&&(i=!1,this.transformsArr[e].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const e=this.isLastTransform(t);this.executeTransform(t),e&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort(((t,e)=>{var i,r;return(null!==(i=t.level)&&void 0!==i?i:0)-(null!==(r=e.level)&&void 0!==r?r:0)}))}executeTransform(t,e={pushHistory:!0,emitMessage:!0}){const{pushHistory:i,emitMessage:r}=e,o=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&!1!==i&&this.historyData.push(o),this.latestData=o,!1!==r&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData)return;if(!this.latestData.forEach)return;if(!(null===(t=this._diffKeys)||void 0===t?void 0:t.length))return;const e=this._diffRank+1;if(0===this._diffRank)this.latestData.forEach((t=>{t[uz]=e,this._diffMap.set(this._diffKeys.reduce(((e,i)=>e+t[i]),""),t)})),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let t;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach((i=>{i[uz]=e,t=this._diffKeys.reduce(((t,e)=>t+i[e]),""),this._diffMap.get(t)?this.latestDataAUD.update.push(i):this.latestDataAUD.add.push(i),this._diffMap.set(t,i)})),this._diffMap.forEach(((t,i)=>{t[uz]<e&&(this.latestDataAUD.del.push(t),this._diffMap.delete(i))}))}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof gz||!0!==(null==e?void 0:e.clone)||(i=!0),i?RI(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:"dataview"===(null===(t=this.parseOption)||void 0===t?void 0:t.type)&&1===this.rawData.length&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t,e=!1){this._fields=t&&e?function(t,...e){let i=-1;const r=e.length;for(;++i<r;)BI(t,e[i],!0);return t}({},this._fields,t):t;const i=this.transformsArr.find((t=>"fields"===t.type));!yI(this._fields)&&yI(i)?(this.dataSet.registerTransform("fields",lz),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}function pz(t,e=["data"]){const i=t;let r;if(!CI(i)||"object"!=typeof i)return i;if(function(t){return t instanceof gz}(i)||function(t){try{return t instanceof Element}catch(e){const i=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],r=Object.keys(t);return i.every((t=>r.includes(t)))}}(i))return i;const o=_I(i),n=i.length;r=o?new Array(n):"object"==typeof i?{}:mI(i)||TI(i)||xI(i)?i:AI(i)?new Date(+i):void 0;const s=o?void 0:Object.keys(Object(i));let a=-1;if(r)for(;++a<(s||i).length;){const t=s?s[a]:a,o=i[t];(null==e?void 0:e.includes(t.toString()))?r[t]=o:r[t]=pz(o,e)}return r}function fz(t){const e={...t};return t_(t.style)||(e.textStyle=mz(t.style)),t_(t.textStyle)||s_(e.textStyle,mz(t.textStyle)),t.shape?.style&&mz(e.shape.style),t.background?.style&&mz(e.background.style),e}function mz(t){return t_(t)||t.angle&&(t.angle=c_(t.angle)),t}function bz(t={}){return t_(t.style)||(t.style=mz(t.style)),t_(t.state)||Object.keys(t.state).forEach((e=>{t_(t.state[e])||(t.state[e]=mz(t.state[e]))})),t}function yz(t){return t_(t)?null:(Object.keys(t).forEach((e=>{t_(t[e])||(t[e]=mz(t[e]))})),t)}const Cz={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},wz="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",vz=14,xz=vz,_z=4,Sz={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:_z,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:_z/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:xz,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:xz,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function Az(t){const e=s_({},t);let i,r=e.title?.angle??0;"left"!==e.orient&&"right"!==e.orient||e.title?.autoRotate&&Dx(e.title.angle)&&(r="left"===e.orient?-90:90,i=Cz[e.orient]);const o=function(t,e){if(!t||!jx(t))return t;const i={};return Object.keys(t).forEach((r=>{const o=t[r];let n=!1;e.forEach((t=>{(Vx(t)&&t===r||t instanceof RegExp&&r.match(t))&&(n=!0)})),n||(i[r]=o)})),i}(e.label,["style","formatMethod","state"]);return{orient:e.orient,select:e.select,hover:e.hover,line:(n=e.domainLine,bz(n),bz(n.startSymbol),bz(n.endSymbol),n),label:{style:mz(e.label.style),formatMethod:e.label.formatMethod?(t,i,r)=>e.label.formatMethod(i.rawValue,i):null,state:yz(e.label.state),...o},tick:{visible:e.tick.visible,length:e.tick.tickSize,inside:e.tick.inside,alignWithLabel:e.tick.alignWithLabel,style:mz(e.tick.style),state:yz(e.tick.state),dataFilter:e.tick.dataFilter},subTick:{visible:e.subTick.visible,length:e.subTick.tickSize,inside:e.subTick.inside,count:e.subTick.tickCount,style:mz(e.subTick.style),state:yz(e.subTick.state)},grid:{type:"line",visible:e.grid.visible,alternateColor:e.grid.alternateColor,alignWithLabel:e.grid.alignWithLabel,style:mz(e.grid.style)},subGrid:{type:"line",visible:e.subGrid.visible,alternateColor:e.subGrid.alternateColor,style:mz(e.subGrid.style)},title:{visible:e.title.visible,position:e.title.position,space:e.title.space,autoRotate:!1,angle:r?c_(r):null,textStyle:s_({},i,mz(e.title.style)),padding:e.title.padding,shape:{visible:e.title.shape?.visible,space:e.title.shape?.space,style:mz(e.title.shape?.style)},background:{visible:e.title.background?.visible,style:mz(e.title.background?.style)},state:{text:yz(e.title.state),shape:yz(e.title.shape?.state),background:yz(e.title.background?.state)}},panel:{visible:e.background?.visible,style:mz(e.background?.style),state:yz(e.background?.state)}};var n}const Tz="NO_AXISID_FRO_VTABLE";function Rz(t){let e=!1;for(let i=0;i<t.length;i++){const r=t[i];if(r.chartSpec&&"wordCloud"!==r.chartSpec.type&&"radar"!==r.chartSpec.type&&"gauge"!==r.chartSpec.type&&"pie"!==r.chartSpec.type&&"funnel"!==r.chartSpec.type&&"rose"!==r.chartSpec.type){e=!0;break}}return e}function Bz(t,e,i,r){let o=!1;if(r.indicatorsAsCol&&"row"===i||!r.indicatorsAsCol&&"col"===i)for(let t=0;t<r.indicatorsDefine.length;t++){const e=r.indicatorsDefine[t];if(e.chartSpec&&"pie"!==e.chartSpec.type&&"wordCloud"!==e.chartSpec.type&&"radar"!==e.chartSpec.type&&"gauge"!==e.chartSpec.type&&"funnel"!==e.chartSpec.type&&"rose"!==e.chartSpec.type){o=!0;break}}else{const i=r.getRawChartSpec(t,e);i?"pie"!==i.type&&"radar"!==i.type&&"gauge"!==i.type&&"wordCloud"!==i.type&&"funnel"!==i.type&&"rose"!==i.type&&(o=!0):o=!1}return o}function Mz(t,e,i){const r=i.getRawChartSpec(t,e);if(r?.series){const t={};return r.data?.id&&(t[r.data.id]=void 0),r?.series.forEach((e=>{if(!e.data?.fromDataId)if(e.data?.transforms)t[e.data?.id??r.data?.id??"data"]=void 0;else{const i="horizontal"===e.direction?e.xField:e.yField;t[e.data?.id??r.data?.id??"data"]=e.data?.id?i:void 0}})),t}return r.data.id}function Pz(t){let e=!1;for(let i=0;i<t.columnObjects.length;i++){if(t.columnObjects[i].chartSpec){e=!0;break}}return e}function Hz(t,e){if(t&&Ux(t.seriesId)&&t.seriesId.length>0){const i=e.filter((e=>!(e.orient!==t.orient||!e.seriesId||e.seriesId.length!==t.seriesId.length||!e.seriesId.every(((e,i)=>e===t.seriesId[i])))));if(i.length>0)return!0}return!1}class kz{seqId=0;_headerObjects;_headerObjectMap;_headerObjectsIncludeHided;_headerCellIds;_columns;_columnsIncludeHided;_columnMaxDepth=0;rowSeriesNumberColumn;leftRowSeriesNumberColumn;rightRowSeriesNumberColumn;leftRowSeriesNumberColumnCount=0;rightRowSeriesNumberColumnCount=0;columnTree;bodyRowSpanCount=1;hierarchyIndent;hierarchyTextStartAlignment;_transpose=!1;_showHeader=!0;_recordsCount=0;_table;_hasAggregation=!1;_hasAggregationOnTopCount=0;_hasAggregationOnBottomCount=0;rowHierarchyType;columnHierarchyType;columnExpandLevel;_cellRangeMap;constructor(t,e,i,r){this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this._columnMaxDepth=this._calculateMaxDepth(e),this.hierarchyIndent=r??20,this.hierarchyTextStartAlignment=t.options.hierarchyTextStartAlignment,this.columnHierarchyType=t.options.headerHierarchyType,this.columnExpandLevel=t.options.headerExpandLevel??1,this.columnTree=new dL(e,{seqId:0},this.columnHierarchyType??null,"grid-tree"===this.columnHierarchyType?this.columnExpandLevel:void 0),this._headerObjectsIncludeHided=this._addHeaders(0,e,[]),this._headerObjects=this._headerObjectsIncludeHided.filter((t=>!0!==t.define.hide)),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.rowHierarchyType=function(t){if(t._table.internalProps.groupBy)return!0;const{columns:e}=t._table.options;if(Ux(e)&&e.length>0)for(let t=0;t<e.length;t++){const i=e[t];if(!Vx(i)&&i.tree)return!0}return!1}(this)?"tree":"grid",this._hasAggregation=function(t){const e=t.columnObjects;for(let t=0;t<e.length;t++){const i=e[t];if(i?.aggregation)return!0}return!1}(this),this._hasAggregationOnBottomCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const r=e[t];r?.aggregation&&(Array.isArray(r?.aggregation)?i=Math.max(i,r.aggregation.filter((t=>!t.showOnTop)).length):r.aggregation.showOnTop||(i=Math.max(i,1)))}return i}(this),this._hasAggregationOnTopCount=function(t){const e=t.columnObjects;let i=0;for(let t=0;t<e.length;t++){const r=e[t];r?.aggregation&&(Array.isArray(r?.aggregation)?i=Math.max(i,r.aggregation.filter((t=>t.showOnTop)).length):r.aggregation.showOnTop&&(i=Math.max(i,1)))}return i}(this),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber)}handleRowSeriesNumber(t){t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map(((t,e)=>({id:this.seqId++,title:t.title,define:s_({field:"_vtable_rowSeries_number_"+e},t),cellType:t.cellType??"text",headerType:"checkbox"===t.cellType?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:t.field??"_vtable_rowSeries_number_"+e,icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}))):this.rowSeriesNumberColumn=[{id:this.seqId++,title:t.title,define:s_({field:"_vtable_rowSeries_number"},t),cellType:t.cellType??"text",headerType:t.headerType??("checkbox"===t.cellType?"checkbox":"text"),style:t.style,width:t.width,format:t.format,field:t.field??"_vtable_rowSeries_number",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isSeriesNumberInHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!0;if(e>=this.headerLevelCount)return!0}return!1}isSeriesNumber(t,e){if(Wx(t)&&Wx(e)){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount)return!0;if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount)return!0}return!1}getSeriesNumberHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(e<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[t],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount){if(this.transpose)return;if(e<this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[t];if(e>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[t]}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(e>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount)if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0;return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount)if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0;return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(t,e){return this.getColumnDefine(t,e).vtable_aggregator}getAggregatorsByCellRange(t,e,i,r){let o=[];if(!this.transpose){for(let r=t;r<=i;r++){const t=this.getColumnDefine(r,e);t.vtable_aggregator&&(o=o.concat(Array.isArray(t.vtable_aggregator)?t.vtable_aggregator:[t.vtable_aggregator]))}return o}for(let i=e;i<=r;i++){const e=this.getColumnDefine(t,i);e.vtable_aggregator&&(o=o.concat(Array.isArray(e.vtable_aggregator)?e.vtable_aggregator:[e.vtable_aggregator]))}return[]}getAggregatorOnTop(t,e){const i=this.getColumnDefine(t,e),r=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const i=o.reduce(((t,e,i)=>(e.showOnTop&&t.push(i),t)),[]),n=i.map((t=>r[t]));return this.transpose?n[t-this.rowHeaderLevelCount]:n[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?o?.showOnTop?r:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:o?.showOnTop?r:null}getAggregatorOnBottom(t,e){const i=this.getColumnDefine(t,e),r=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const i=o.reduce(((t,e,i)=>(e.showOnTop||t.push(i),t)),[]),n=i.map((t=>r[t]));return this.transpose?n[t-(this.colCount-this.hasAggregationOnBottomCount)]:n[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?o?.showOnTop?null:r:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0||o?.showOnTop?null:r}getAggregatorCellAddress(t,e,i,r){const o=[],n=this.hasAggregationOnTopCount,s=this.hasAggregationOnBottomCount;if(this.transpose)for(let i=e;i<=r;i++){if(this.getColumnDefine(t,i).vtable_aggregator){for(let t=0;t<n;t++)o.push({col:this.headerLevelCount+t,row:i});for(let t=0;t<s;t++)o.push({col:this.rowCount-s+t,row:i})}}else for(let r=t;r<=i;r++){if(this.getColumnDefine(r,e).vtable_aggregator){for(let t=0;t<n;t++)o.push({col:r,row:this.headerLevelCount+t});for(let t=0;t<s;t++)o.push({col:r,row:this.rowCount-s+t})}}return o}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1&&t>=this.leftRowSeriesNumberColumnCount&&t<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(t,e){if(Wx(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(Wx(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(Wx(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(Wx(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=0&&e<this.frozenRowCount}isLeftBottomCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.frozenRowCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(this.rowCount??0)-1}}:{start:{col:0,row:0},end:{col:(this.colCount??0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:(this.rowCount??0)-1}}:{start:{col:0,row:0},end:{col:(this.colCount??0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:(this.colCount??0)-1,row:(this.rowCount??0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:(this.colCount??0)-1,row:(this.rowCount??0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const t=this.leftRowSeriesNumberColumn.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})));return t.push(...this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))),t}return this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))}getColumnWidthDefined(t){if(t>=0){if(t<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[t];if(this.transpose){let e,i,r=0;if(t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let t;return this.columnObjects.forEach(((o,n)=>{"number"==typeof o.width?r=Math.max(o.width,r):"auto"===o.width&&(t=!0),"number"==typeof o.minWidth&&(i=Math.max(o.minWidth,i)),"number"==typeof o.maxWidth&&(e=Math.max(o.maxWidth,e))})),r=r>0?r:t?"auto":void 0,{width:r,minWidth:i,maxWidth:e}}if(this.isRowHeader(t,0)){const e=Array.isArray(this._table.defaultHeaderColWidth)?this._table.defaultHeaderColWidth[t]??this._table.defaultColWidth:this._table.defaultHeaderColWidth;return"auto"===e?{width:"auto"}:{width:e}}}return this._columns[t-this.leftRowSeriesNumberColumnCount]}}getCellId(t,e){return this.transpose?t>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?this._columns[e]?.id:this.isSeriesNumber(t,e)?e+"_series_number":this._headerCellIds[t-this.leftRowSeriesNumberColumnCount]?.[e]:this.isSeriesNumber(t,e)?this.rowSeriesNumberColumn[t].id:this.headerLevelCount<=e?this._columns[t-this.leftRowSeriesNumberColumnCount]?.id:this._headerCellIds[e]?.[t-this.leftRowSeriesNumberColumnCount]}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e)?.field;if(this.isSeriesNumberInBody(t,e))return this.getSeriesNumberBody(t,e)?.field;const i=this.getCellId(t,e);return this._headerObjectMap[i]?.field||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t-this.leftRowSeriesNumberColumnCount]&&this._columns[t-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return this.transpose?{col:e,row:r}:{col:r+this.leftRowSeriesNumberColumnCount,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((e=>e&&e.field===t));return e&&this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.isSeriesNumber(t,e)?this.getSeriesNumberBody(t,e):this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(t){if(this.transpose){for(let e=0;e<(this.rowCount??0);e++)if(t===this._columns[e].id)return{start:{col:0,row:e},end:{col:0,row:e}}}else for(let e=this.leftRowSeriesNumberColumnCount;e<(this.colCount??0);e++)if(t===this._columns[e-this.leftRowSeriesNumberColumnCount].id)return{start:{col:e,row:0},end:{col:e,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(t,e){return function(t,e,i){if(-1===t||-1===e)return{start:{col:t,row:e},end:{col:t,row:e}};if(i._cellRangeMap.has(`$${t}$${e}`))return i._cellRangeMap.get(`$${t}$${e}`);let r={start:{col:t,row:e},end:{col:t,row:e}};if(i.transpose)r=function(t,e,i){const r={start:{col:t,row:e},end:{col:t,row:e}};if(i.headerLevelCount+i.leftRowSeriesNumberColumnCount<=t||-1===t&&-1===e){if(i.headerLevelCount+i.leftRowSeriesNumberColumnCount<=t&&i.columnObjects[e]?.define?.mergeCell){const o=i._table.getCellValue(t,e);for(let n=t-1;n>=i.headerLevelCount+i.leftRowSeriesNumberColumnCount;n--){const s=i._table.getCellValue(n,e);if("boolean"==typeof i.columnObjects[e].define.mergeCell){if(o!==s)break}else if(!i.columnObjects[e].define.mergeCell(o,s,{source:{col:t,row:e},target:{col:n,row:e},table:i._table}))break;r.start.col=n}for(let n=t+1;n<(i.colCount??0);n++){const s=i._table.getCellValue(n,e);if("boolean"==typeof i.columnObjects[e].define.mergeCell){if(o!==s)break}else if(!i.columnObjects[e].define.mergeCell(o,s,{source:{col:t,row:e},target:{col:n,row:e},table:i._table}))break;r.end.col=n}}return r}const o=i.getCellId(t,e);for(let n=e-1;n>=0&&o===i.getCellId(t,n);n--)r.start.row=n;for(let n=e+1;n<(i.rowCount??0)&&o===i.getCellId(t,n);n++)r.end.row=n;for(let n=t-1;n>=0&&o===i.getCellId(n,e);n--)r.start.col=n;for(let n=t+1;n<i.headerLevelCount+i.leftRowSeriesNumberColumnCount&&o===i.getCellId(n,e);n++)r.end.col=n;return r}(t,e,i);else if(i.headerLevelCount<=e){if(i.headerLevelCount<=e&&i.columnObjects[t-i.leftRowSeriesNumberColumnCount]?.define?.mergeCell){const o=i._table.getCellValue(t,e);for(let n=e-1;n>=i.headerLevelCount;n--){const s=i._table.getCellValue(t,n);if("boolean"==typeof i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell){if(o!==s)break}else if(!i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell(o,s,{source:{col:t,row:e},target:{col:t,row:n},table:i._table}))break;r.start.row=n}for(let n=e+1;n<i.rowCount;n++){const s=i._table.getCellValue(t,n);if("boolean"==typeof i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell){if(o!==s)break}else if(!i.columnObjects[t-i.leftRowSeriesNumberColumnCount].define.mergeCell(o,s,{source:{col:t,row:e},target:{col:t,row:n},table:i._table}))break;r.end.row=n}}!function(t,e,i,r){if("tree"!==r.rowHierarchyType)return;const o=r._table.getCellRawRecord(t,e);r._table.internalProps.groupTitleCheckbox&&r._table.internalProps.rowSeriesNumber?o?.vtableMerge&&t>=r.leftRowSeriesNumberColumnCount&&(i.start.col=r.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount,i.end.col=r.colCount-1,i.start.row=i.end.row=e):o?.vtableMerge&&(i.start.col=r.rowHeaderLevelCount,i.end.col=r.colCount-1,i.start.row=i.end.row=e)}(t,e,r,i)}else{const o=i.getCellId(t,e);for(let n=t-1;n>=0&&o===i.getCellId(n,e);n--)r.start.col=n;for(let n=t+1;n<(i.colCount??0)&&o===i.getCellId(n,e);n++)r.end.col=n;for(let n=e-1;n>=0&&o===i.getCellId(t,n);n--)r.start.row=n;for(let n=e+1;n<i.headerLevelCount&&o===i.getCellId(t,n);n++)r.end.row=n}return i._cellRangeMap.set(`$${t}$${e}`,r),r}(t,e,this)}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),n=this.getCellRange(i,r);return o.start.col===n.start.col&&o.end.col===n.end.col&&o.start.row===n.start.row&&o.end.row===n.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_calculateMaxDepth(t,e=0){let i=e;return t.forEach((t=>{if(t.columns&&t.columns.length>0){const r=this._calculateMaxDepth(t.columns,e+1);r>i&&(i=r)}})),i}_addHeaders(t,e,i,r,o){const n=[],s=this._newRow(t,r);return e.forEach((e=>{const a=this._columns.length,l=this.seqId++,h={id:l,title:e.title??e.caption,headerIcon:e.headerIcon,field:e.field,style:e.headerStyle,headerType:e.headerType??"text",dropDownMenu:e.dropDownMenu,define:e,hierarchyState:e.hierarchyState,columnWidthComputeMode:e.columnWidthComputeMode};n[l]=h;let c=t;if(e.levelSpan){c=Math.min(t+e.levelSpan-1,this._columnMaxDepth-1);for(let e=t;e<=c;e++)this._headerCellIds[e]||(this._headerCellIds[e]=[]),void 0===this._headerCellIds[e][a]&&(this._headerCellIds[e][a]=l)}if(o)for(let t=c-1;t>=0;t--)this._headerCellIds[t]&&void 0===this._headerCellIds[t][a]&&void 0!==i[c-o]&&(this._headerCellIds[t][a]=i[c-o]);else for(let t=c-1;t>=0;t--)this._headerCellIds[t]&&void 0===this._headerCellIds[t][a]&&void 0!==i[t]&&(this._headerCellIds[t][a]=i[t]);r?this._headerCellIds[t-1]&&void 0!==this._headerCellIds[t-1][a]&&(s[a]=this._headerCellIds[t-1][a]):s[a]=l;const d=!e.hierarchyState||e.hierarchyState===kx.expand;if(e.columns&&d){const t=e.columns.every((t=>t.hide));!t&&this._addHeaders(c+1,e.columns,[...i,l],e.hideColumnsSubHeader||r,e.levelSpan).forEach((t=>n.push(t)))}else{const i={id:this.seqId++,field:e.field,fieldFormat:e.fieldFormat,width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth,icon:e.icon,cellType:e.cellType??e.columnType??"text",chartModule:"chartModule"in e?e.chartModule:null,chartSpec:"chartSpec"in e?e.chartSpec:null,sparklineSpec:"sparklineSpec"in e?e.sparklineSpec:iA,style:e.style,define:e,columnWidthComputeMode:e.columnWidthComputeMode,disableColumnResize:e?.disableColumnResize,aggregation:e.aggregation,isChildNode:t>=1};if(this._columnsIncludeHided.push(i),!0!==e.hide){this._columns.push(i);for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][a]=l}}})),n}_newRow(t,e=!1){if(this._headerCellIds[t]){const e=this._headerCellIds[t-1];if(e.length>this._headerCellIds[t].length)for(let i=this._headerCellIds[t].length;i<e.length;i++)this._headerCellIds[t][i]=e[i];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const r=this._headerCellIds[t-1];for(let t=0;t<r.length;t++)i[t]=r[t];return i}getCellHeaderPaths(t,e){if(this.isSeriesNumber(t,e))return;let i=[],r=[];return this.transpose?r=[{field:this._columns[e].field}]:i=[{field:this._columns[t-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(0!==e){if(this.isColumnHeader(t,e))return this.getCellId(t,e-1);if(this.isRowHeader(t,e)){if(this.isSeriesNumberInBody(t-1,e))return;return this.getCellId(t-1,e)}}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)){const i=this.getRecordShowIndexByCell(0,t.row),r=this.getRecordShowIndexByCell(0,e.row);return this._table.dataSource.canChangeOrder(i,r)}if(this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode&&this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode?(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(t.col=t.col+this.leftRowSeriesNumberColumnCount,e.col=e.col+this.leftRowSeriesNumberColumnCount)),t.col<0||t.row<0||e.col<0||e.row<0)return!1;if("disabled"===this._table.internalProps.frozenColDragHeaderMode&&this._table.isFrozenColumn(e.col))return!1;const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){return this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row)}if(this.isRowHeader(t.col,t.row)){return this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row)}return!1}moveHeaderPosition(t,e){if((!this._table.options.dragOrder?.validateDragOrderOnEnd||this._table.options.dragOrder?.validateDragOrderOnEnd(t,e))&&this.canMoveHeaderPosition(t,e)){let i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const r=i.end.col-i.start.col+1;let o;const n=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?n.end.col-r+1:n.start.col,o===i.start.col)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);e.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.row,i.start.col-this.leftRowSeriesNumberColumnCount,o-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:n.end.col-n.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)||this.isSeriesNumberInBody(t.col,t.row)&&this.transpose){this.isSeriesNumberInBody(t.col,t.row)&&(i=this.getCellRange(t.col+this.leftRowSeriesNumberColumnCount,t.row));const r=i.end.row-i.start.row+1;let o;const n=this.getCellRange(i.start.col,e.row);if(o=e.row>=t.row?n.end.row-r+1:n.start.row,o===i.start.row)return null;for(let t=0;t<this._headerCellIds.length;t++){const e=this._headerCellIds[t].splice(i.start.row,r);e.unshift(o,0),Array.prototype.splice.apply(this._headerCellIds[t],e)}const s=this._columns.splice(i.start.row,r);return s.unshift(o,0),Array.prototype.splice.apply(this._columns,s),this.columnTree.movePosition(i.start.col-this.leftRowSeriesNumberColumnCount,i.start.row,o+(e.row>t.row?i.end.row-i.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:i.start.row,targetIndex:o,sourceSize:r,targetSize:n.end.row-n.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(t.col,t.row))return{sourceIndex:t.row,targetIndex:e.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(t){const e=t.add.map((t=>({col:0,row:this._table.columnHeaderLevelCount+t}))),i=t.remove.map((t=>({col:0,row:this._table.columnHeaderLevelCount+t})));return{addCellPositions:e,removeCellPositions:i}}setChartInstance(t,e,i){const r=this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount];"function"!=typeof r.chartSpec&&(r.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return Pz(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e),r=i?.chartSpec;return"function"!=typeof r}isNoChartDataRenderNothing(t,e){const i=this.getBody(t,e);return(i?.define).noDataRenderNothing}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),r=i?.chartSpec;if("function"==typeof r){return r({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table})}return r}getChartDataId(t,e){return Mz(t,e,this)}release(){const t=this._table._getActiveChartInstance();t?.release(),this.columnObjects.forEach((t=>{t.chartInstance?.release()}))}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const r=this._table.internalProps.layoutMap.getHeader(t,e);r.title=i,r.define.title=i}getColumnByField(t){const e=this.columnObjects?.reduce(((e,i,r)=>(i.field===t&&e.push({col:r,columnDefine:i}),e)),[]);return e}getColumnByKey(t){let e;const i=this.columnObjects?.find(((i,r)=>i.define?.key===t&&(e=r+this.leftRowSeriesNumberColumnCount,!0)));return{columnDefine:i,col:e}}getColumnDefine(t,e){if(t>=0)return t<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[t].define:this.transpose?this._columns[e].define:this._columns[t-this.leftRowSeriesNumberColumnCount].define}}class Ez{table;editingEditor;isValidatingValue=!1;editCell;listenersId=[];beginTriggerEditCellMode;constructor(t){this.table=t,this.bindEvent()}bindEvent(){const t=this.table,e=t.on(OS.DBLCLICK_CELL,(e=>{const{editCellTrigger:i="doubleclick"}=t.options;if(!i.includes("doubleclick"))return;const{col:r,row:o}=e,n=FM(e.federatedEvent),s=t.scenegraph.getResizeColAt(n.abstractPos.x,n.abstractPos.y,n.eventArgs?.targetCell);t._canResizeColumn(s.col,s.row)&&s.col>=0||e.target?.attribute?.funcType||(this.beginTriggerEditCellMode="doubleclick",this.startEditCell(r,o))})),i=t.on(OS.CLICK_CELL,(e=>{const{editCellTrigger:i="doubleclick"}=t.options;if("click"===i||Array.isArray(i)&&i.includes("click")){if(e.target?.attribute?.funcType)return;this.beginTriggerEditCellMode="click";const{col:t,row:i}=e;this.startEditCell(t,i)}}));this.listenersId.push(e,i)}startEditCell(t,e,i){if(this.editingEditor)return;const r=this.table.getEditor(t,e);if(r){if(this.table.internalProps.layoutMap?.isAggregation?.(t,e)){const t=this.table.isPivotTable?.(),e=!!t&&this.table.internalProps?.dataConfig?.updateAggregationOnEditCell;if(!t||t&&e)return}const o=this.table.getCellRawRecord(t,e);if(o?.vtableMerge)return;this.editingEditor||(this.editCell={col:t,row:e}),this.table._makeVisibleCell(t,e),this.editingEditor=r;const n=Wx(i)?i:this.table.getCellOriginValue(t,e),s=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),a={rect:{left:s.left,top:s.top,width:s.width,height:s.height}};t===this.table.colCount-1?a.rect.width=s.width-1:a.rect.width=s.width+1,e===this.table.rowCount-1?a.rect.height=s.height-1:a.rect.height=s.height+1,r.beginEditing,r.beginEditing?.(this.table.getElement(),a,n),r.bindSuccessCallback,r.bindSuccessCallback?.((()=>{this.completeEdit()})),r.onStart?.({value:n,endEdit:()=>{this.completeEdit()},referencePosition:a,container:this.table.getElement(),col:t,row:e,table:this.table})}}completeEdit(t){if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;const e=t?.target,{editingEditor:i}=this;if(e)if(i.targetIsOnEditor){if(i.targetIsOnEditor(e))return!1}else if(!i.isEditorElement||i.isEditorElement(e))return!1;if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;const t=this.editingEditor.getValue(),e=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),i=this.editingEditor.validateValue?.(t,e,this.editCell,this.table);return TS(i)?(this.isValidatingValue=!0,new Promise(((t,r)=>{i.then((i=>{Fz(i,this,e,t)})).catch((t=>{this.isValidatingValue=!1,r(t)}))}))):Fz(i,this,e)}return this.doExit(),!0}doExit(){const t=this.editingEditor.getValue?.(),e=this.table.getCellRange(this.editCell.col,this.editCell.row),i=[];for(let r=e.start.row;r<=e.end.row;r++){const r=[];for(let i=e.start.col;i<=e.end.col;i++)r.push(t);i.push(r)}this.table.changeCellValues(e.start.col,e.start.row,i),this.editingEditor.exit,this.editingEditor.exit?.(),this.editingEditor.onEnd?.(),this.editingEditor=null,this.isValidatingValue=!1,this.beginTriggerEditCellMode=null}cancelEdit(){this.editingEditor&&(this.editingEditor.exit?.(),this.editingEditor.onEnd?.(),this.editingEditor=null)}release(){this.listenersId.forEach((t=>{this.table.off(t)}))}}function Fz(t,e,i,r){return e.isValidatingValue=!1,"validate-exit"===t?(e.doExit(),r?.(!0),!0):"invalidate-exit"===t?(e.editingEditor.setValue(i),e.doExit(),r?.(!0),!0):"validate-not-exit"===t||"invalidate-not-exit"===t?(r?.(!1),!1):!0===t?(e.doExit(),r?.(!0),!0):(r?.(!1),!1)}function Lz(t){if(Vx(t))return{groupByRules:[t]};if(Ux(t)){return{groupByRules:t.map((t=>Vx(t)?t:t.key))}}return{}}function Iz(t,e,i,r){if("group"===r)return r;if("sort"===r&&!i.internalProps.groupBy)return r;let o="normal";if(i.internalProps.groupBy)o="group";else if(!i.isHeader(t,e)&&i.dataSource.lastOrderField){i.getBodyField(t,e)===i.dataSource.lastOrderField&&(o="sort")}return o}function zz(t){let e=t.sortState;e=!e||Array.isArray(e)?e:[e],e&&(e=e.map((e=>(e.orderFn=t._getSortFuncFromHeaderOption(void 0,e.field)??lS,e))),t.dataSource.sort(e))}function Oz(t,e,i){const{checkedState:r}=t.stateManager;if(r)if("tree"===t.dataSource.rowHierarchyType){let t;t=Xx(e)?[e]:e;const o=t.length,n=[];r.forEach(((e,r)=>{const s=r.split(",");if(s.length>=t.length)for(let a=0;a<s.length;a++){const l=t[a]??-1,h=Number(s[a]);if(!(l===h&&a<s.length-1)){if(l===h&&a===s.length-1||-1===l){n.push({originKey:r,value:e});break}if(l<h&&a===o-1){s[a]=(h-i).toString(),n.push({originKey:r,targetKey:s.toString(),value:e});break}break}}})),n.sort(((t,e)=>{const i=t.originKey.split(","),r=e.originKey.split(","),o=i.length,n=r.length,s=Math.min(o,n);for(let t=0;t<s;t++){const e=Number(i[t]),o=Number(r[t]);if(e!==o)return e-o}return o-n})),n.forEach((({originKey:t,targetKey:e,value:i})=>{r.delete(t),e&&r.set(e,i)}))}else{for(let t=r.size-1;t>=e;t--){const e=r.get(t.toString());r.delete(t.toString()),r.set((t-i).toString(),e)}}}function Dz(t,e,i){const{checkedState:r}=t.stateManager;if(r)if("tree"===t.dataSource.rowHierarchyType){let t;t=Xx(e)?[e]:e;const o=t.length,n=[];r.forEach(((e,r)=>{const s=r.split(",");if(s.length>=t.length)for(let a=0;a<s.length;a++){const l=t[a]??-1,h=Number(s[a]);if(l===h&&(a===s.length-1||a===o-1)){s[a]=(h+i).toString(),n.push({originKey:r,targetKey:s.toString(),value:e});break}if(!(l===h&&a<s.length-1)){if(l<h&&a===o-1){s[a]=(h+i).toString(),n.push({originKey:r,targetKey:s.toString(),value:e});break}break}}})),n.sort(((t,e)=>{const i=t.originKey.split(","),r=e.originKey.split(","),o=i.length,n=r.length,s=Math.min(o,n);for(let t=0;t<s;t++){const e=Number(i[t]),o=Number(r[t]);if(e!==o)return-e+o}return-o+n})),n.forEach((({originKey:t,targetKey:e,value:i})=>{r.delete(t),e&&r.set(e,i)}))}else{for(let t=r.size-1;t>=e;t--){const e=r.get(t.toString());r.delete(t.toString()),r.set((t+i).toString(),e)}}}class Wz extends rI{showHeader=!0;listTreeStickCellPlugin;constructor(t,e){super(t,e),e=this.options;const i=this.internalProps;if(i.frozenColDragHeaderMode=e.dragOrder?.frozenColDragHeaderMode??e.frozenColDragHeaderMode,this.pagination=e.pagination,i.sortState=e.sortState,i.multipleSort=!!e.multipleSort,i.dataConfig=this.internalProps.groupBy?Lz(this.internalProps.groupBy):{},i.columns=e.columns?pz(e.columns,["children"]):e.header?pz(e.header,["children"]):[],tM(this),i.enableTreeNodeMerge=e.enableTreeNodeMerge??Wx(this.internalProps.groupBy)??!1,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=e.showHeader??!0,this.internalProps.columnWidthConfig=e.columnWidthConfig,this.transpose=e.transpose??!1,"node"!==X_.mode&&(this.editorManager=new Ez(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:i.sortState}):this.setRecords([]),e.title){const t=wA.getComponent("title");i.title=new t(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}if(this.internalProps.enableTreeStickCell){const t=wA.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new t(this)}setTimeout((()=>{this.fireListeners(OS.INITIALIZED,null)}),0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){return this.dataSource?.records}get recordsCount(){return this.dataSource.records.length}updateColumns(t,e){this.scenegraph.clearCells();const i={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=pz(t,["children"]),tM(this),e?.clearColWidthCache&&this.internalProps._widthResizedColMap.clear(),this.options.columns=t,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),this.dataSource.updateColumns?.(this.internalProps.columns),this.records&&eM(this.internalProps.columns)&&this.dataSource.processRecords(this.dataSource.dataSourceObj?.records??this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(i.col,i.row),this.renderAsync(),this.eventManager.updateEventBinder()}_recreateSceneForStateChange(){this.scenegraph.clearCells();const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this._hasAutoImageColumn=void 0,this.refreshHeader(),this.records&&eM(this.internalProps.columns)&&this.dataSource.processRecords(this.dataSource.dataSourceObj?.records??this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.renderAsync(),this.eventManager.updateEventBinder()}addColumn(t){const e=this.options.columns;e.push(t),this.updateColumns(e)}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,tM(this),this.options.header=t,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){return this.internalProps.transpose??!1}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e,i){if(-1===t||-1===e)return null;if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}const r=this;if(r.internalProps.layoutMap.isSeriesNumber(t,e)){if(r.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:i}=r.internalProps.layoutMap.getSeriesNumberHeader(t,e);return i}let i;if(this.internalProps.groupBy){const o=r.getCellRawRecord(t,e);if(o?.vtableMerge)return"";r.internalProps.layoutMap.isAggregation(t,e)||(i=this.dataSource.getGroupSeriesNumber(e-this.columnHeaderLevelCount))}else{const o=r.getBodyColumnDefine(t,e),n=r.getFieldData(o.field,t,e);i="string"==typeof n?n:n?.text?n.text??"":e-this.columnHeaderLevelCount+1}const{format:o}=r.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof o?o(t,e,this,i):i}if(r.internalProps.layoutMap.isHeader(t,e)){const{title:i}=r.internalProps.layoutMap.getHeader(t,e);return"function"==typeof i?i():i}if(r.internalProps.layoutMap.isAggregation(t,e)){if(r.internalProps.layoutMap.isTopAggregation(t,e)){const i=r.internalProps.layoutMap.getAggregatorOnTop(t,e);return i?.formatValue?i.formatValue(t,e,this):""}if(r.internalProps.layoutMap.isBottomAggregation(t,e)){const i=r.internalProps.layoutMap.getAggregatorOnBottom(t,e);return i?.formatValue?i.formatValue(t,e,this):""}}const{field:o,fieldFormat:n}=r.internalProps.layoutMap.getBody(t,e);return r.getFieldData(n||o,t,e)}getCellOriginValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(t,e)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getSeriesNumberHeader(t,e);return r}const{format:r}=i.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof r?r(t,e,this):e-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const r=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return r?.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const r=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return r?.value()}}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(r,t,e)}getCellRawValue(t,e){if(-1===t||-1===e)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(r,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,r=i.getRecordShowIndexByCell(t,e);return this.dataSource.getRecordIndexPaths(r)}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find((e=>e.field===t));if(!e)return-1;const i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.get(r)}getCellRawRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.getRaw(r)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const i=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount),r=this.internalProps.layoutMap.isSeriesNumber(t,e);if(i?.disableColumnResize)return!1;if(r&&!0===this.internalProps.rowSeriesNumber.disableColumnResize)return!1}return i}updateOption(t){const e=this.internalProps;if(super.updateOption(t),e.frozenColDragHeaderMode=t.dragOrder?.frozenColDragHeaderMode??t.frozenColDragHeaderMode,this.pagination=t.pagination,e.sortState=t.sortState,e.dataConfig=this.internalProps.groupBy?Lz(this.internalProps.groupBy):{},this.showHeader=t.showHeader??!0,e.columns=t.columns?pz(t.columns,["children"]):t.header?pz(t.header,["children"]):[],tM(this),e.enableTreeNodeMerge=t.enableTreeNodeMerge??Wx(this.internalProps.groupBy)??!1,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=t.transpose??!1,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=t.columnWidthConfig,e.releaseList)for(let t=e.releaseList.length-1;t>=0;t--){const i=e.releaseList[t];i instanceof TA?i.updateColumns(this.internalProps.columns):(i?.release?.(),e.releaseList.splice(t,1))}if(t.dataSource&&this.dataSource!==t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:t.sortState}):(this.refreshRowColCount(),this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title){const i=wA.getComponent("title");e.title=new i(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}return this.pluginManager.updatePlugins(t.plugins),new Promise((t=>{setTimeout(t,0)}))}updatePagination(t){this.pagination&&("number"==typeof t.currentPage&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){const t=this,e=t.internalProps,i=t.transpose,r=t.showHeader;(e.layoutMap=new kz(this,e.columns??[],r,t.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){const t=this,{layoutMap:e}=t.internalProps;if(!e)return;const i=t.internalProps.dataSource?.length??0;e.recordsCount=i+(i>0||this.options.showAggregationWhenEmpty?e.hasAggregationOnTopCount+e.hasAggregationOnBottomCount:0),t.transpose?(t.rowCount=e.rowCount??0,t.colCount=e.colCount??0,this.internalProps.frozenColCount=Math.max((e.headerLevelCount??0)+e.leftRowSeriesNumberColumnCount,this.options.frozenColCount??0),this.internalProps.frozenRowCount=this.options.frozenRowCount??0,t.bottomFrozenRowCount!==(this.options.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=this.options.bottomFrozenRowCount??0),t.rightFrozenColCount!==(this.options.rightFrozenColCount??0)&&(t.rightFrozenColCount=this.options.rightFrozenColCount??0)):(t.colCount=e.colCount??0,t.rowCount=e.recordsCount*e.bodyRowSpanCount+e.headerLevelCount,this.internalProps.frozenColCount=this.options.frozenColCount??0,t.frozenRowCount=Math.max(e.headerLevelCount,this.options.frozenRowCount??0),t.bottomFrozenRowCount!==(this.options.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=this.options.bottomFrozenRowCount??0),t.rightFrozenColCount!==(this.options.rightFrozenColCount??0)&&(t.rightFrozenColCount=this.options.rightFrozenColCount??0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(t,e,i){if(null===t)return null;const r=this;if(r.internalProps.layoutMap.isHeader(e,i))return null;const o=r.getRecordShowIndexByCell(r.transpose?e-r.internalProps.layoutMap.leftRowSeriesNumberColumnCount:e,i);return r.internalProps.dataSource.getField(o,t,e,i,this)}getRawFieldData(t,e,i){if(null===t)return null;const r=this;if(r.internalProps.layoutMap.isHeader(e,i))return null;const o=r.getRecordShowIndexByCell(e,i);return r.internalProps.dataSource.getRawField(o,t,e,i,this)}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),r=this.getCellRange(e.col,e.row),o=this.internalProps.layoutMap.moveHeaderPosition(t,e);return o?("column"===o.moveType?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex),o):null}changeRecordOrder(t,e){this.transpose?(t=this.getRecordShowIndexByCell(t,0),e=this.getRecordShowIndexByCell(e,0)):(t=this.getRecordShowIndexByCell(0,t),e=this.getRecordShowIndexByCell(0,e)),this.dataSource.changeOrder(t,e)}getCellAddress(t,e){let i;for(let e=0;e<this.internalProps.records.length;e++){const r=this.internalProps.records[e];if("function"==typeof t)t(r)&&(i=e);else{let o=!0;for(const e in t)if(r[e]!==t[e]){o=!1;break}o&&(i=e)}if(Wx(i))break}const r=this.getCellRangeByField(e,i);if(r)return{row:r.start.row,col:r.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,r=i.columnObjects.find((e=>e.field===t));if(r){const t=i.getBodyLayoutRangeById(r.id);let o;return Wx(e)&&(o=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:t.start.row,col:Wx(o)?o+t.start.col:void 0},end:{row:t.end.row,col:Wx(o)?o+t.end.col:void 0}}:{start:{col:t.start.col,row:Wx(o)?o+t.start.row:void 0},end:{col:t.end.col,row:Wx(o)?o+t.end.row:void 0}}}return null}getHierarchyState(t,e){if(this.isHeader(t,e))return this._getHeaderLayoutMap(t,e)?.hierarchyState;if(!this.internalProps.groupBy||Ux(this.internalProps.groupBy)&&0===this.internalProps.groupBy.length){if(!this.getBodyColumnDefine(t,e).tree)return kx.none}const i=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(i)}getRecordHierarchyState(t,e){let i;return this.transpose?this.getRecordShowIndexByCell(t,0):i=this.getRecordShowIndexByCell(0,e),this.dataSource.getHierarchyState(i)}toggleHierarchyState(t,e,i=!0){this.stateManager.updateHoverIcon(t,e,void 0,void 0);const r=this.getHierarchyState(t,e);if(this.isHeader(t,e)){const i=this.internalProps.layoutMap.getHeader(t,e),{hierarchyState:o,define:n}=i;if(![kx.collapse,kx.expand].includes(o)||!n)return;const s=n.columns;if(Array.isArray(s)&&s.length>0){const t=o===kx.expand?kx.collapse:kx.expand;i.hierarchyState=t,i.define.hierarchyState=t,this.updateColumns(this.internalProps.columns)}this.fireListeners(OS.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:r,originData:i,cellLocation:this.getCellLocation(t,e)})}else if(r===kx.expand)this._refreshHierarchyState(t,e,i),this.fireListeners(OS.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:kx.collapse});else if(r===kx.collapse){const r=this.getCellOriginRecord(t,e);Array.isArray(r.children)&&this._refreshHierarchyState(t,e,i),this.fireListeners(OS.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:kx.expand,originData:r})}}setLoadingHierarchyState(t,e){this.scenegraph.setLoadingHierarchyState(t,e)}_refreshHierarchyState(t,e,i=!0){let r=!1,o=!1;const n=this.internalProps.layoutMap.checkHasChart();n&&(this.autoFillWidth&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(o=this.getAllRowsHeight()<=this.tableNoFrameHeight));const s=this.getRecordShowIndexByCell(t,e),a=this.dataSource.toggleHierarchyState(s,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),l=this.internalProps.layoutMap.toggleHierarchyState(a);this.refreshRowColCount();for(let t=this.rowCount-this.bottomFrozenRowCount;t<this.rowCount;t++){const e=GP(t,0,this.colCount-1,this);this._setRowHeight(t,e)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;const{updateCells:h,addCells:c,removeCells:d}=function(t,e,i,r){const o=[{col:e,row:i}],n=[],s=[],{addCellPositions:a,removeCellPositions:l}=t,h=r.scenegraph.proxy,{rowStart:c,rowLimit:d}=h;let{rowEnd:u}=h,g=1/0;for(let t=0;t<a.length;t++){const{row:i}=a[t];u-c+1===d?i>=c&&i<=u&&(g=Math.min(g,i)):(n.push({col:e,row:i}),u++)}const p=Math.min(c+d,r.rowCount-1-r.bottomFrozenRowCount),f=p<c+d;for(let t=0;t<l.length;t++){const{row:i}=l[l.length-t-1];i<c||i>u||(i>p||f?(s.push({col:e,row:i}),g--):g=Math.min(g,i))}if(g!==1/0)for(let t=g;t<=u;t++)o.push({col:e,row:t});return r.scenegraph.proxy.refreshRowCount(),{updateCells:o,addCells:n,removeCells:s}}(l,t,e,this);this.reactCustomLayout?.clearCache(),this.scenegraph.updateRow(d,c,h,i,!0),this.reactCustomLayout?.updateAllCustomCell(),n&&(this.autoFillWidth&&!r&&(r=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!o&&(o=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||r||"adaptive"===this.heightMode||o)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){return(this.options.columns??this.options.header)?.some(((t,e)=>t.tree))}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if((i&&i===o.fieldKey||!i&&o.field===e)&&o.sort&&"function"==typeof o.sort)return o.sort;if(o.columns){const t=this._getSortFuncFromHeaderOption(o.columns,e,i);if(t)return t}}}updateSortState(t,e=!0){if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let e=0;e<this.internalProps.sortState.length;e++)t=this.internalProps.sortState?.[e],t&&(t.order="normal");else this.internalProps.sortState.order="normal",t=this.internalProps.sortState;(t=Array.isArray(t)?t:[t]).some((t=>t.field))&&e&&this.internalProps.layoutMap.headerObjects.some((t=>!1!==t.define.sort))&&(this.dataSource.sort(t.map((t=>{const e=this._getSortFuncFromHeaderOption(this.internalProps.columns,t.field);return this.internalProps.layoutMap.headerObjects.find((e=>e&&e.field===t.field)),{field:t.field,order:t.order,orderFn:e??lS}}))),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),t.length&&this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(t),zz(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph()}getCheckboxState(t){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),Wx(t)){let e=Array.from(this.stateManager.checkedState.keys()).sort(((t,e)=>{const i=t.split(","),r=e.split(","),o=Math.max(i.length,r.length);for(let t=0;t<o;t++){const e=Number(i[t])??0,o=Number(r[t])??0;if(e!==o)return e-o}return 0})).map((t=>this.stateManager.checkedState.get(t)));return this.options.groupBy&&(e=function(t){const e=[],i=t.dataSource,r=i.dataConfig.groupByRules.length+1;return i.currentIndexedData.forEach(((o,n)=>{if(Ux(o)&&o.length===r){const r=i.getOriginRecordIndexForGroup(o);e[r]=t.stateManager.checkedState.get(o.toString())}})),e}(this)),Array.from(e,(e=>e&&e[t]))}return new Array(...this.stateManager.checkedState.values())}getCellCheckboxState(t,e){const i=this.getBodyColumnDefine(t,e),r=i?.field,o=this.getCellType(t,e);if(Wx(r)&&("checkbox"===o||"switch"===o)){const i=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)).toString();return this.stateManager.checkedState.get(i)?.[r]}}getRadioState(t){return Wx(t)?this.stateManager.radioState[t]:this.stateManager.radioState}getCellRadioState(t,e){return function(t,e,i){const r=i.getBodyColumnDefine(t,e),o=r?.field,n=i.getCellType(t,e);if(Wx(o)&&"radio"===n){const r=i.dataSource.getIndexKey(i.getRecordShowIndexByCell(t,e)),n=i.stateManager.radioState?.[o];if(Xx(n)){if(n===r)return!0}else if(Nx(n)){const t=n[r];if(Xx(t))return t}}return!1}(t,e,this)}setCellCheckboxState(t,e,i){!function(t,e,i,r){const o=r.scenegraph.getCell(t,e),n=o?.getChildByName("checkbox")||o?.getChildByName("checkbox-content")?._checkboxGroup?.getChildByName("checkbox");if(!n){const o=r.getHeaderField(t,e);if(r.isHeader(t,e))r.stateManager.setHeaderCheckedState(o,i),"checkbox"===r.getCellType(t,e)&&r.scenegraph.updateCheckboxCellState(t,e,i);else if(r.stateManager.setCheckedState(t,e,o,i),"checkbox"===r.getCellType(t,e)){const i=r.stateManager.headerCheckedState[o],n=r.stateManager.updateHeaderCheckedState(o,t,e);i!==n&&r.scenegraph.updateHeaderCheckboxCellState(t,e,n)}return}const{checked:s,indeterminate:a}=n.attribute;a?(i||n._handlePointerUp(),n._handlePointerUp()):s?i||n._handlePointerUp():i&&n._handlePointerUp()}(t,e,i,this)}setCellRadioState(t,e,i){!function(t,e,i,r){const o=r.scenegraph.getCell(t,e);if(o)if(Xx(i)){const t=o.getChildAt(i);t?._handlePointerUp()}else{const t=o.getChildByName("radio");t?._handlePointerUp()}}(t,e,i,this)}getSwitchState(t){return this.getCheckboxState(t)}getCellSwitchState(t,e){return this.getCellCheckboxState(t,e)}setCellSwitchState(t,e,i){this.setCellCheckboxState(t,e,i)}setRecords(t,e){let i;AH(),this.internalProps.dataSource?.release(),this.internalProps.releaseList=this.internalProps.releaseList?.filter((t=>!t.dataSourceObj)),this.internalProps.dataSource=null,Array.isArray(e)||e?.order?i=e:e?i=e.sortState:null===e&&(i=null),"undefined"!=typeof window&&window.performance.now();const r={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),void 0!==i&&(null===i||!Array.isArray(i)&&Wx(i.field)||Array.isArray(i))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(i)?i:[i]:i,this.stateManager.setSortState(this.sortState)),t){if(XB(this,t),this.sortState){const t=Array.isArray(this.sortState)?this.sortState:[this.sortState];t.some((t=>t.order&&t.field&&"normal"!==t.order))&&this.internalProps.layoutMap.headerObjectsIncludeHided.some((t=>!1!==t.define.sort))&&this.dataSource.sort(t.map((t=>{const e=this._getSortFuncFromHeaderOption(void 0,t.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find((e=>e&&e.field===t.field)),{field:t.field,order:t.order||"asc",orderFn:e??lS}})))}this.refreshRowColCount()}else XB(this,t);if(this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(r.col,r.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}this.render(),Wx(r.col)&&Wx(r.row)&&r.col>=0&&r.row>=0&&setTimeout((()=>{this.internalProps?.tooltipHandler.showTooltip(r.col,r.row)}),0)}setRecordChildren(t,e,i,r=!0){const o=this.getCellOriginRecord(e,i);o.children=t;const n=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(o,n),this._refreshHierarchyState(e,i,r)}startEditCell(t,e,i){if(Wx(t)&&Wx(e))this.eventManager.isDraging=!1,this.selectCell(t,e),this.editorManager.startEditCell(t,e,i);else if(this.stateManager.select?.cellPos){const{col:t,row:e}=this.stateManager.select.cellPos;Wx(t)&&Wx(e)&&this.editorManager.startEditCell(t,e,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){const i=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?i?.headerEditor??this.options.headerEditor:i?.editor??this.options.editor;if("function"==typeof r){r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return"string"==typeof r?lI(r):r}isHasEditorDefine(t,e){const i=this.getBodyColumnDefine(t,e);let r=this.isHeader(t,e)?i?.headerEditor??this.options.headerEditor:i?.editor??this.options.editor;if("function"==typeof r){r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return Wx(r)}changeCellValue(t,e,i,r=!1,o=!0){return function(t,e,i,r,o,n){if(r&&n.isHasEditorDefine(t,e)||!1===r){const r=n.getRecordShowIndexByCell(t,e),{field:s}=n.internalProps.layoutMap.getBody(t,e),a=n.getCellRawValue(t,e),l=n.getCellOriginValue(t,e);n.isHeader(t,e)?n.internalProps.layoutMap.updateColumnTitle(t,e,i):n.dataSource.changeFieldValue(i,r,s,t,e,n);const h=n.getCellRange(t,e),c=n.internalProps.layoutMap.getAggregatorsByCell(t,e);if(c){if(Array.isArray(c))for(let t=0;t<c?.length;t++)c[t].recalculate();else c.recalculate();const t=n.internalProps.layoutMap.getAggregatorCellAddress(h.start.col,h.start.row,h.end.col,h.end.row);for(let e=0;e<t.length;e++){const i=n.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)n.scenegraph.updateCellContent(t,e)}}for(let t=h.start.col;t<=h.end.col;t++)for(let e=h.start.row;e<=h.end.row;e++)n.scenegraph.updateCellContent(t,e);if("adaptive"===n.widthMode||n.autoFillWidth&&n.getAllColsWidth()<=n.tableNoFrameWidth)0===n.internalProps._widthResizedColMap.size&&n.scenegraph.recalculateColWidths();else if(!n.internalProps._widthResizedColMap.has(t)){const e=n.getColWidth(t),i=hk(t,0,n.rowCount-1,n,!1);i!==e&&n.scenegraph.updateColWidth(t,i-e)}if("adaptive"===n.heightMode||n.autoFillHeight&&n.getAllRowsHeight()<=n.tableNoFrameHeight)0===n.internalProps._heightResizedRowMap.size&&n.scenegraph.recalculateRowHeights();else if(n.isAutoRowHeight(e)&&!n.internalProps._heightResizedRowMap.has(e)){const t=n.getRowHeight(e),i=GP(e,0,n.colCount-1,n);n.scenegraph.updateRowHeight(e,i-t)}const d=n.getCellOriginValue(t,e);l!==d&&o&&n.fireListeners(OS.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:a,currentValue:l,changedValue:d}),n.scenegraph.updateNextFrame()}}(t,e,i,r,o,this)}changeCellValues(t,e,i,r=!1,o=!0){return async function(t,e,i,r,o,n){const s=[];let a=t,l=e;const h=[],c=[];let d;for(let r=0;r<i.length&&!(e+r>n.rowCount-1);r++){const o=i[r],s=[],a=[];h.push(s),c.push(a);for(let i=0;i<o.length&&!(t+i>n.colCount-1);i++){d=Iz(t+i,e+r,n,d);const o=n.getCellRawValue(t+i,e+r);s.push(o);const l=n.getCellOriginValue(t+i,e+r);a.push(l)}}for(let d=0;d<i.length&&!(e+d>n.rowCount-1);d++){s[d]=[],l=e+d;const u=i[d];let g=t;for(let i=0;i<u.length&&!(t+i>n.colCount-1);i++){g=t+i;let a=!1;if(!1===r)a=!0;else if(n.isHasEditorDefine(t+i,e+d)){const r=n.getEditor(t+i,e+d),o=c[d][i],s=u[i],l=r?.validateValue?.(s,o,{col:t+i,row:e+d},n)??!0;if(TS(l)){const t=await l;a=!0===t||"validate-exit"===t||"validate-not-exit"===t}else a=!0===l||"validate-exit"===l||"validate-not-exit"===l}if(a){s[d][i]=!0;const r=u[i],a=n.getRecordShowIndexByCell(t+i,e+d),{field:l}=n.internalProps.layoutMap.getBody(t+i,e+d),g=h[d][i],p=c[d][i];n.isHeader(t+i,e+d)?n.internalProps.layoutMap.updateColumnTitle(t+i,e+d,r):n.dataSource.changeFieldValue(r,a,l,t+i,e+d,n);const f=n.getCellOriginValue(t+i,e+d);p!==f&&o&&n.fireListeners(OS.CHANGE_CELL_VALUE,{col:t+i,row:e+d,rawValue:g,currentValue:p,changedValue:f})}else s[d][i]=!1}a=Math.max(a,g)}const u=n.getCellRange(t,e),g=n.getCellRange(a,l),p=n.internalProps.layoutMap.getAggregatorsByCellRange(u.start.col,u.start.row,g.end.col,g.end.row);if(p){for(let t=0;t<p?.length;t++)p[t].recalculate();if("normal"===d){const t=n.internalProps.layoutMap.getAggregatorCellAddress(u.start.col,u.start.row,g.end.col,g.end.row);for(let e=0;e<t.length;e++){const i=n.getCellRange(t[e].col,t[e].row);for(let t=i.start.col;t<=i.end.col;t++)for(let e=i.start.row;e<=i.end.row;e++)n.scenegraph.updateCellContent(t,e)}}}if("group"===d&&n.dataSource.updateRecordsForGroup([],[]),"sort"===d||"group"===d)return n.dataSource.sortedIndexMap.clear(),zz(n),n.refreshRowColCount(),n.internalProps.layoutMap.clearCellRangeMap(),n.scenegraph.clearCells(),n.scenegraph.createSceneGraph(),s;for(let t=u.start.col;t<=g.end.col;t++)for(let e=u.start.row;e<=g.end.row;e++)n.scenegraph.updateCellContent(t,e);if("adaptive"===n.widthMode||n.autoFillWidth&&n.getAllColsWidth()<=n.tableNoFrameWidth)0===n.internalProps._widthResizedColMap.size&&n.scenegraph.recalculateColWidths();else for(let e=t;e<=g.end.col;e++)if(!n.internalProps._widthResizedColMap.has(e)){const t=n.getColWidth(e),i=hk(e,0,n.rowCount-1,n,!1);i!==t&&n.scenegraph.updateColWidth(e,i-t)}if("adaptive"===n.heightMode||n.autoFillHeight&&n.getAllRowsHeight()<=n.tableNoFrameHeight)n.scenegraph.recalculateRowHeights();else if(n.isAutoRowHeight(e)){const t=[],i=[];for(let r=e;r<=g.end.row;r++)if(n.rowHeightsMap.get(r)){const e=n.getRowHeight(r),o=GP(r,0,n.colCount-1,n);t.push(r),i.push(o-e)}n.scenegraph.updateRowsHeight(t,i)}return n.scenegraph.updateNextFrame(),s}(t,e,i,r,o,this)}addRecord(t,e){!function(t,e,i){if(i.internalProps.groupBy)i.dataSource.addRecordsForGroup?.([t],e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&zz(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)i.dataSource.addRecordsForTree?.([t],e),Dz(i,e,1),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&zz(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.addRecordForSorted(t),i.stateManager.checkedState.clear(),zz(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{(void 0===e||e>i.dataSource.sourceLength)&&(e=i.dataSource.sourceLength);const r=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount;i.dataSource.addRecord(t,e),Dz(i,e,1);const o=i.rowCount;if(i.refreshRowColCount(),0===i.scenegraph.proxy.totalActualBodyRowCount)return i.scenegraph.clearCells(),void i.scenegraph.createSceneGraph();const n=i.transpose?i.colCount:i.rowCount;if(i.pagination){const{perPageCount:t,currentPage:s}=i.pagination,a=t*(s||0)+t;if(e<a)if(e<a-t)i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const s=e-(a-t)+r;if(o-r===i.pagination.perPageCount){const t=[];for(let e=s;e<n;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}else{const t=[];for(let e=s;e<Math.min(n,s+1);e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],t,[]):i.scenegraph.updateRow([],t,[])}}}else{const t=[];for(let o=e+r;o<e+r+1;o++)i.transpose?t.push({col:o,row:0}):t.push({col:0,row:o});const o=i.internalProps.layoutMap.hasAggregationOnTopCount,n=i.internalProps.layoutMap.hasAggregationOnBottomCount;for(let t=r;t<r+o;t++)i.transpose;for(let t=(i.transpose?i.colCount:i.rowCount)-n;t<(i.transpose?i.colCount:i.rowCount);t++)i.transpose;i.transpose?i.scenegraph.updateCol([],t,[]):i.scenegraph.updateRow([],t,[])}}}(t,e,this),this.internalProps.emptyTip?.resetVisible()}addRecords(t,e){!function(t,e,i){if(i.internalProps.groupBy)i.dataSource.addRecordsForGroup?.(t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&zz(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)i.dataSource.addRecordsForTree?.(t,e),Dz(i,e,t.length),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&zz(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.addRecordsForSorted(t),zz(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{void 0===e||e>i.dataSource.sourceLength?e=i.dataSource.sourceLength:e<0&&(e=0);const r=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount;i.dataSource.addRecords(t,e),Dz(i,e,t.length);const o=i.transpose?i.colCount:i.rowCount;if(i.refreshRowColCount(),0===i.scenegraph.proxy.totalActualBodyRowCount)return i.scenegraph.clearCells(),void i.scenegraph.createSceneGraph();const n=i.transpose?i.colCount:i.rowCount;if(i.pagination){const{perPageCount:s,currentPage:a}=i.pagination,l=s*(a||0)+s;if(e<l)if(e<l-s)i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const a=e-(l-s)+r;if(o-r===i.pagination.perPageCount){const t=[];for(let e=a;e<n;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}else{const e=[];for(let r=a;r<Math.min(n,a+(Array.isArray(t)?t.length:1));r++)i.transpose?e.push({col:r,row:0}):e.push({col:0,row:r});i.transpose?i.scenegraph.updateCol([],e,[]):i.scenegraph.updateRow([],e,[])}}}else{const o=[];for(let n=e+r;n<e+r+(Array.isArray(t)?t.length:1);n++)i.transpose?o.push({col:n,row:0}):o.push({col:0,row:n});const n=i.internalProps.layoutMap.hasAggregationOnTopCount,s=i.internalProps.layoutMap.hasAggregationOnBottomCount,a=[];for(let t=r;t<r+n;t++)i.transpose?a.push({col:t,row:0}):a.push({col:0,row:t});for(let t=(i.transpose?i.colCount:i.rowCount)-s;t<(i.transpose?i.colCount:i.rowCount);t++)i.transpose?a.push({col:t,row:0}):a.push({col:0,row:t});i.transpose?i.scenegraph.updateCol([],o,a):i.scenegraph.updateRow([],o,a)}}}(t,e,this),this.internalProps.emptyTip?.resetVisible()}deleteRecords(t){!function(t,e){if(t?.length>0)if(e.internalProps.groupBy)e.dataSource.deleteRecordsForGroup?.(t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&zz(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if("tree"===e.dataSource.rowHierarchyType){const i=e.dataSource.deleteRecordsForTree?.(t);if(0===i.length)return;for(let t=0;t<i.length;t++)Oz(e,i[t],1);e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&zz(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph()}else if(e.sortState)e.dataSource.deleteRecordsForSorted(t),zz(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const i=e.dataSource.deleteRecords(t);if(0===i.length)return;const r=e.transpose?e.colCount:e.rowCount;e.refreshRowColCount();const o=e.transpose?e.colCount:e.rowCount,n=i.sort(((t,e)=>t-e)),s=n[0];if(e.pagination){const{perPageCount:t,currentPage:i}=e.pagination,n=t*(i||0)+t;if(s<n)if(s<n-t)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const i=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,a=e.internalProps.layoutMap.hasAggregationOnTopCount,l=[],h=[];for(let i=s-(n-t)+(e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount)+a;i<o;i++)e.transpose?l.push({col:i,row:0}):l.push({col:0,row:i});for(let t=i;t<i+a;t++)e.transpose?l.push({col:t,row:0}):l.push({col:0,row:t});if(o<r)for(let t=o;t<r;t++)e.transpose?h.push({col:t,row:0}):h.push({col:0,row:t});e.reactCustomLayout?.clearCache(),e.transpose?e.scenegraph.updateCol(h,[],l):e.scenegraph.updateRow(h,[],l),e.reactCustomLayout?.updateAllCustomCell()}}else{const t=[],i=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,r=e.internalProps.layoutMap.hasAggregationOnTopCount,o=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let o=0;o<n.length;o++){const s=n[o]+i+r;e.transpose?t.push({col:s,row:0}):t.push({col:0,row:s})}const s=[];for(let t=i;t<i+r;t++)e.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});for(let t=(e.transpose?e.colCount:e.rowCount)-o;t<(e.transpose?e.colCount:e.rowCount);t++)e.transpose?s.push({col:t,row:0}):s.push({col:0,row:t});e.reactCustomLayout?.clearCache(),e.transpose?e.scenegraph.updateCol(t,[],s):e.scenegraph.updateRow(t,[],s),e.reactCustomLayout?.updateAllCustomCell()}}}(t,this),this.internalProps.emptyTip?.resetVisible()}updateRecords(t,e){!function(t,e,i){if(e?.length>0)if(i.internalProps.groupBy)i.dataSource.updateRecordsForGroup?.(t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&zz(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if("tree"===i.dataSource.rowHierarchyType)i.dataSource.updateRecordsForTree?.(t,e),i.refreshRowColCount(),i.internalProps.layoutMap.clearCellRangeMap(),i.sortState&&zz(i),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else if(i.sortState)i.dataSource.updateRecordsForSorted(t,e),zz(i),i.refreshRowColCount(),i.scenegraph.clearCells(),i.scenegraph.createSceneGraph();else{const r=i.dataSource.updateRecords(t,e);if(0===r.length)return;const o=r.map((t=>i.getBodyRowIndexByRecordIndex(t))),n=o.sort(((t,e)=>t-e));if(i.pagination){const{perPageCount:t,currentPage:e}=i.pagination,r=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,o=i.internalProps.layoutMap.hasAggregationOnTopCount,s=t*(e||0)+t,a=[];for(let e=0;e<n.length;e++){const r=n[e];if(r<s&&r>=s-t){const e=r-(s-t)+(i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount)+o;a.push(e)}}if(a.length>=1){const t=[];for(let e=0;e<a.length;e++){const r=a[e];i.transpose?t.push({col:r,row:0}):t.push({col:0,row:r})}for(let e=r;e<r+o;e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}}else{const t=[],e=i.transpose?i.rowHeaderLevelCount:i.columnHeaderLevelCount,r=i.internalProps.layoutMap.hasAggregationOnTopCount,o=i.internalProps.layoutMap.hasAggregationOnBottomCount;for(let o=0;o<n.length;o++){const s=n[o]+e+r;i.transpose?t.push({col:s,row:0}):t.push({col:0,row:s})}for(let o=e;o<e+r;o++)i.transpose?t.push({col:o,row:0}):t.push({col:0,row:o});for(let e=(i.transpose?i.colCount:i.rowCount)-o;e<(i.transpose?i.colCount:i.rowCount);e++)i.transpose?t.push({col:e,row:0}):t.push({col:0,row:e});i.transpose?i.scenegraph.updateCol([],[],t):i.scenegraph.updateRow([],[],t)}}}(t,e,this)}_hasCustomRenderOrLayout(){const{headerObjects:t}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let e=0;e<t.length;e++){const i=t[e];if(i?.define?.customLayout||i?.define?.headerCustomLayout||i?.define?.customRender||i?.define?.headerCustomRender)return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let t=0;t<e.length;t++){const r=e[t].columnDefine.aggregator;if(delete e[t].columnDefine,r){const o={col:e[t].col,aggregateValue:null};if(o.aggregateValue=[],Array.isArray(r))for(let t=0;t<r.length;t++)o.aggregateValue.push({aggregationType:r[t].type,value:r[t].value()});else o.aggregateValue.push({aggregationType:r.type,value:r.value()});i.push(o)}}return i}isAggregation(t,e){return this.internalProps.layoutMap.isAggregation(t,e)}getGroupTitleLevel(t,e){if(!this.internalProps.groupBy)return;const i=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)),r=this.dataSource.getGroupLength()??0;let o=Ux(i)?i.length-1:0;return r>0&&o===r&&(o=void 0),o}getBodyRowIndexByRecordIndex(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),this.dataSource.getTableIndex(t)}_parseColumnWidthConfig(t){for(let e=0;e<t?.length;e++){const i=t[e],r=i.key,o=i.width,n=this.internalProps.layoutMap.getColumnByKey(r);if(n.columnDefine){const{col:t}=n;this.internalProps._widthResizedColMap.has(t)||(this._setColWidth(t,o),this.internalProps._widthResizedColMap.add(t))}}}release(){this.editorManager.release(),super.release()}expandAllTreeNode(){if(!this._hasHierarchyTreeHeader())return;let t=!1;this.dataSource&&"function"==typeof this.dataSource.expandAllNodes&&(this.dataSource.expandAllNodes(),t=!0),t&&(this._recreateSceneForStateChange(),this.fireListeners(OS.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:kx.expand,originData:{children:this.records}}))}collapseAllTreeNode(){if(!this._hasHierarchyTreeHeader())return;let t=!1;this.dataSource&&"function"==typeof this.dataSource.collapseAllNodes&&(this.dataSource.collapseAllNodes(),t=!0),t&&(this._recreateSceneForStateChange(),this.fireListeners(OS.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:kx.collapse,originData:{children:this.records}}))}}function Nz(t){return"bottom"===t||"top"===t}var Gz;function jz(t){return t}!function(t){t.Identity="identity",t.Linear="linear",t.Log="log",t.Pow="pow",t.Sqrt="sqrt",t.Symlog="symlog",t.Time="time",t.Quantile="quantile",t.Quantize="quantize",t.Threshold="threshold",t.Ordinal="ordinal",t.Point="point",t.Band="band"}(Gz||(Gz={})),Object.values(Gz).forEach((t=>{}));const Vz=t=>-Math.log(-t),Uz=t=>-Math.exp(-t),Kz=t=>isFinite(t)?Math.pow(10,t):t<0?0:t,$z=t=>10===t?Kz:t===Math.E?Math.exp:e=>Math.pow(t,e),Xz=t=>t===Math.E?Math.log:10===t?Math.log10:2===t?Math.log2:(t=Math.log(t),e=>Math.log(e)/t),Yz=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),qz=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t;function Zz(t,e){if(t=Number(t),e=Number(e),e-=t)return i=>(i-t)/e;const i=Number.isNaN(e)?NaN:.5;return()=>i}function Jz(t,e,i){const r=t[0],o=t[1],n=e[0],s=e[1];let a,l;return o<r?(a=Zz(o,r),l=i(s,n)):(a=Zz(r,o),l=i(n,s)),t=>l(a(t))}function Qz(t,e,i){let r;return r=1===t?t+2*i:t-e+2*i,t?r>0?r:1:0}function tO(t,e){const i=(t[1]-t[0])/(e[1]-e[0]),r=t[0]-i*e[0];return[r,i+r]}function eO(t,e,i){const r=Math.min(t.length,e.length)-1,o=new Array(r),n=new Array(r);let s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)o[s]=Zz(t[s],t[s+1]),n[s]=i(e[s],e[s+1]);return function(e){const i=function(t,e,i=0,r){for(yI(r)&&(r=t.length);i<r;){const o=i+r>>>1;EI(t[o],e)>0?r=o:i=o+1}return i}(t,e,1,r)-1;return n[i](o[i](e))}}const iO=(t,e=!1)=>{const i=Math.floor(Math.log10(t)),r=t/Math.pow(10,i);let o;return o=e?r<1.5?1:r<3?2:r<7?5:10:r<=1?1:r<=2?2:r<=5?5:10,o*Math.pow(10,i)};class rO{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)&&2===t.length?(this._wholeRange=tO(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(2===t.length&&t.every((t=>t>=0&&t<=1))&&(this._wholeRange=null,0===t[0]&&1===t[1]?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return yI(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!yI(this._rangeFactorEnd)&&1!==this._rangeFactorEnd?(this._rangeFactorStart=t,this._rangeFactorEnd=null!==(i=this._rangeFactorEnd)&&void 0!==i?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return yI(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,0!==t||!yI(this._rangeFactorStart)&&0!==this._rangeFactorStart?(this._rangeFactorEnd=t,this._rangeFactorStart=null!==(i=this._rangeFactorStart)&&void 0!==i?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),n=o[0],s=o[o.length-1],a=Math.min(n,s),l=Math.max(n,s),h=UI(null!==(t=this._fishEyeOptions.focus)&&void 0!==t?t:0,a,l),c=yI(r)?(l-a)*i:r;let d=Math.exp(e);d=d/(d-1)*c;const u=e/c;this._fishEyeTransform=t=>{const e=Math.abs(t-h);if(e>=c)return t;if(e<=1e-6)return h;const i=d*(1-Math.exp(-e*u))/e*.75+.25;return h+(t-h)*i}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return null!==(i=null==this?void 0:this[t])&&void 0!==i?i:e}}const oO=Symbol("implicit");class nO extends rO{specified(t){var e;return t?(this._specified=Object.assign(null!==(e=this._specified)&&void 0!==e?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=Gz.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=oO}clone(){const t=(new nO).domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let r=this._index.get(e);if(!r){if(this._unknown!==oO)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const o=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(o):o}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const t=`${e}`;this._index.has(t)||this._index.set(t,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&null!==(e=this._index.get(`${t}`))&&void 0!==e?e:-1}}function sO(t,e,i,r){const o=[];let n=t;for(;n<=e;)o.push(n),n+=i;return r&&o.reverse(),o}function aO(t,e,i,r){let o,n;if(e=Math.floor(+e),t=Math.floor(+t),!(i=Math.floor(+i)))return[];if(t===e)return[t];if(o=e<t){const i=t;t=e,e=i}let s=KI(1,e-t+1)(i);if(n=Math.floor((e-t+1)/s),!r)for(;Math.ceil((e-t+1)/n)>i&&s>1;)s-=1,n=Math.floor((e-t)/s);return sO(t,e,n,o)}class lO extends nO{constructor(t){super(),this.type=Gz.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),r=super.domain().length,o=i[1]<i[0];let n=i[Number(o)-0];const s=i[1-Number(o)],a=Qz(r,this._paddingInner,this._paddingOuter);return this._step=(s-n)/Math.max(1,a||1),this._round&&(this._step=Math.floor(this._step)),n+=(s-n-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(n=Math.round(n),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:o,start:o?n+this._step*(r-1):n,count:r},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(void 0!==i)return i;let r=this._index.get(e);if(!r){if(this._unknown!==oO)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const{count:o,start:n,reverse:s}=this._bandRangeState,a=n+(r-1)%o*(s?-1:1)*this._step;return this._fishEyeTransform?this._fishEyeTransform(a):a}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let e;if(CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)&&2===t.length){const i=tO(t,[this._rangeFactorStart,this._rangeFactorEnd]);e=Math.abs(i[1]-i[0])}else e=Math.abs(t[1]-t[0]);const i=function(t,e,i,r,o){const n=Qz(t,i,r);let s=e/Math.max(1,n||1);o&&(s=Math.floor(s));let a=s*(1-i);return o&&(a=Math.round(a)),a}(super.domain().length,e,this._paddingInner,this._paddingOuter,this._round);i<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):i>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=i,this._isFixed=!1)}if(this.isBandwidthFixed()){const s=(i=super.domain().length,r=this._bandwidth,o=this._paddingInner,n=this._paddingOuter,1===o&&(o=0),Qz(i,o,n)*(r/(1-o))*Math.sign(t[1]-t[0])),a=Math.min((t[1]-t[0])/s,1);if(CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)){if(s>0){const e=t[0]-s*this._rangeFactorStart,i=e+s;this._wholeRange=[e,i]}else{const e=t[1]+s*(1-this._rangeFactorEnd),i=e-s;this._wholeRange=[i,e]}const i=this._rangeFactorStart+a<=1,r=this._rangeFactorEnd-a>=0;"rangeFactorStart"===e&&i?this._rangeFactorEnd=this._rangeFactorStart+a:"rangeFactorEnd"===e&&r?this._rangeFactorStart=this._rangeFactorEnd-a:t[0]<=t[1]?i?this._rangeFactorEnd=this._rangeFactorStart+a:r?this._rangeFactorStart=this._rangeFactorEnd-a:(this._rangeFactorStart=0,this._rangeFactorEnd=a):r?this._rangeFactorStart=this._rangeFactorEnd-a:i?this._rangeFactorEnd=this._rangeFactorStart+a:(this._rangeFactorStart=1-a,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=a,this._wholeRange=[t[0],t[0]+s];return this._wholeRange}var i,r,o,n;return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),r=this._getInvertIndex(t[1]);return e.slice(Math.min(i,r),Math.max(i,r)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[FI(t[0]),FI(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[FI(t[0]),FI(t[1])],this._round=!0,this.rescale(e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return-1===t?e:aO(0,e.length-1,t,!1).map((t=>e[t]))}tickData(t=10){return this.ticks(t).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])})))}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return aO(0,e.length-1,t,!0).filter((t=>t<e.length)).map((t=>e[t]))}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let r;if(i=KI(1,(e=Math.floor(+e))-(t=Math.floor(+t))+1)(Math.floor(+i)),r=e<t){const i=t;t=e,e=i}return sO(t,e,i,r)}(0,e.length-1,t).map((t=>e[t]))}_getInvertIndex(t){let e=0;const i=this.step()/2,r=this.bandwidth()/2,o=this._domain.length,n=this.range(),s=n[0]>n[n.length-1];for(e=0;e<o;e++){const n=this.scale(this._domain[e])+r;if(0===e&&(!s&&!GI(t,n+i)||s&&!jI(t,n-i)))break;if(e===o-1)break;if(!jI(t,n-i)&&!GI(t,n+i))break}return e>=0&&e<=o-1?e:o-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return void 0!==t?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return void 0!==t?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return void 0!==t?(this._round=t,this.rescale(e)):this._round}align(t,e){return void 0!==t?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return yI(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return yI(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?("auto"===t?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth="auto"===t?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth="auto"===t?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&TI(this._userBandwidth)}clone(){var t,e,i;return new lO(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth(null!==(t=this._userBandwidth)&&void 0!==t?t:"auto",!0).maxBandwidth(null!==(e=this._maxBandwidth)&&void 0!==e?e:"auto",!0).minBandwidth(null!==(i=this._maxBandwidth)&&void 0!==i?i:"auto")}}const{interpolateRgb:hO}=az;function cO(t,e){const i=typeof e;let r;if(yI(e)||"boolean"===i)return()=>e;if("number"===i)return $I(t,e);if("string"===i){if(r=nz.parseColorString(e)){const e=hO(nz.parseColorString(t),r);return t=>e(t).formatRgb()}return $I(Number(t),Number(e))}return e instanceof sz?hO(t,e):e instanceof nz?hO(t.color,e.color):e instanceof Date?function(t,e){const i=t.valueOf(),r=e.valueOf(),o=new Date;return t=>(o.setTime(i*(1-t)+r*t),o)}(t,e):$I(Number(t),Number(e))}class dO extends rO{constructor(t=jz,e=jz){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=jz,this._piecewise=Jz,this._interpolate=cO}calculateVisibleDomain(t){var e;return CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)&&2===t.length?[this.invert(t[0]),this.invert(t[1])]:null!==(e=this._niceDomain)&&void 0!==e?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this.transformer),$I)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return(null!==(i=this._niceDomain)&&void 0!==i?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,FI);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=XI,this.rescale(e)}rescale(t){var e;if(t)return this;const i=null!==(e=this._niceDomain)&&void 0!==e?e:this._domain,r=i.length,o=this._range.length;let n=Math.min(r,o);if(r&&r<o&&this._forceAlign){const t=o-r+1,e=i[r-1],s=r>=2?(e-i[r-2])/t:0;for(let o=1;o<=t;o++)i[r-2+o]=e-s*(t-o);n=o}return this._autoClamp&&(this._clamp=KI(i[0],i[n-1])),this._piecewise=n>2?eO:Jz,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:jz),this.rescale(i)):this._clamp!==jz}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(null!=e?e:[]).map(((t,e)=>({index:e,tick:t,value:(this.scale(t)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return yI(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return yI(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const uO=Math.sqrt(50),gO=Math.sqrt(10),pO=Math.sqrt(2),fO=[1,2,5,10],mO=(t,e,i)=>{let r=1,o=t;const n=Math.floor((e-1)/2),s=Math.abs(t);return t>=0&&t<=Number.MIN_VALUE?o=0:t<0&&t>=-Number.MIN_VALUE?o=-(e-1):!i&&s<1?r=wO(s).step:(i||s>1)&&(o=Math.floor(t)-n*r),r>0?(t>0?o=Math.max(o,0):t<0&&(o=Math.min(o,-(e-1)*r)),function(t,e,i){CI(e)||(e=t,t=0),CI(i)||(i=1);let r=-1;const o=0|Math.max(0,Math.ceil((e-t)/i)),n=new Array(o);for(;++r<o;)n[r]=t+r*i;return n}(0,e).map((t=>o+t*r))):t>0?yO(0,-(e-1)/r,r):yO((e-1)/r,0,r)},bO=VI(((t,e,i,r)=>{let o,n,s,a,l=-1;if(i=+i,(t=+t)==(e=+e))return[t];if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return[t];if((o=e<t)&&(n=t,t=e,e=n),a=vO(t,e,i).step,!isFinite(a))return[];if(a>0){let i=Math.round(t/a),r=Math.round(e/a);for(i*a<t&&++i,r*a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)*a}else if(a<0&&(null==r?void 0:r.noDecimals)){a=1;const i=Math.ceil(t),r=Math.floor(e);if(!(i<=r))return[];for(s=new Array(n=r-i+1);++l<n;)s[l]=i+l}else{a=-a;let i=Math.round(t*a),r=Math.round(e*a);for(i/a<t&&++i,r/a>e&&--r,s=new Array(n=r-i+1);++l<n;)s[l]=(i+l)/a}return o&&s.reverse(),s})),yO=(t,e,i)=>{let r,o,n=-1;if(i>0){let s=Math.floor(t/i),a=Math.ceil(e/i);for((s+1)*i<t&&++s,(a-1)*i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)*i}else{i=-i;let s=Math.floor(t*i),a=Math.ceil(e*i);for((s+1)/i<t&&++s,(a-1)/i>e&&--a,o=new Array(r=a-s+1);++n<r;)o[n]=(s+n)/i}return o},CO=VI(((t,e,i,r)=>{let o,n,s;if(i=+i,(t=+t)==(e=+e))return mO(t,i,null==r?void 0:r.noDecimals);if(Math.abs(t-e)<=Number.MIN_VALUE&&i>0)return mO(t,i,null==r?void 0:r.noDecimals);(o=e<t)&&(s=t,t=e,e=s);const a=vO(t,e,i);let l=a.step;if(!isFinite(l))return[];if(l>0){let r=1;const{power:o,gap:s}=a,h=10===s?2*10**o:1*10**o;for(;r<=5&&(n=yO(t,e,l),n.length>i+1)&&i>2;)l+=h,r+=1;i>2&&n.length<i-1&&(n=((t,e,i)=>{let r;const o=t[0],n=t[t.length-1],s=e-t.length;if(n<=0){const e=[];for(r=s;r>=1;r--)e.push(o-r*i);return e.concat(t)}if(o>=0){for(r=1;r<=s;r++)t.push(n+r*i);return t}let a=[];const l=[];for(r=1;r<=s;r++)r%2==0?a=[o-Math.floor(r/2)*i].concat(a):l.push(n+Math.ceil(r/2)*i);return a.concat(t).concat(l)})(n,i,l))}else(null==r?void 0:r.noDecimals)&&l<0&&(l=1),n=yO(t,e,l);return o&&n.reverse(),n})),wO=t=>{const e=Math.floor(Math.log(t)/Math.LN10),i=t/10**e;let r=fO[0];return i>=uO?r=fO[3]:i>=gO?r=fO[2]:i>=pO&&(r=fO[1]),e>=0?{step:r*10**e,gap:r,power:e}:{step:-(10**-e)/r,gap:r,power:e}};function vO(t,e,i){const r=(e-t)/Math.max(0,i);return wO(r)}function xO(t,e,i){let r;if(i=+i,(t=+t)==(e=+e)&&i>0)return[t];if(i<=0||0===(r=function(t,e,i){return(e-t)/Math.max(1,i-1)}(t,e,i))||!isFinite(r))return[];const o=new Array(i);for(let e=0;e<i;e++)o[e]=t+e*r;return o}function _O(t,e=10){let i,r,o=0,n=t.length-1,s=t[o],a=t[n],l=10;for(a<s&&(r=s,s=a,a=r,r=o,o=n,n=r);l-- >0;){if(r=vO(s,a,e).step,r===i)return t[o]=s,t[n]=a,t;if(r>0)s=Math.floor(s/r)*r,a=Math.ceil(a/r)*r;else{if(!(r<0))break;s=Math.ceil(s*r)/r,a=Math.floor(a*r)/r}i=r}}function SO(t,e){const i=TI(e.forceMin),r=TI(e.forceMax);let o=null;const n=[];let s=null;const a=i&&r?t=>t>=e.forceMin&&t<=e.forceMax:i?t=>t>=e.forceMin:r?t=>t<=e.forceMax:null;return i?n[0]=e.forceMin:TI(e.min)&&e.min<=Math.min(t[0],t[t.length-1])&&(n[0]=e.min),r?n[1]=e.forceMax:TI(e.max)&&e.max>=Math.max(t[0],t[t.length-1])&&(n[1]=e.max),TI(n[0])&&TI(n[1])?(s=t.slice(),s[0]=n[0],s[s.length-1]=n[1]):o=TI(n[0])||TI(n[1])?TI(n[0])?"max":"min":"all",{niceType:o,niceDomain:s,niceMinMax:n,domainValidator:a}}const AO=(t,e,i)=>Math.abs(e-t)<1?+i.toFixed(1):Math.round(+i),TO=VI(((t,e,i,r,o,n,s)=>{let a=t,l=e;const h=l<a;h&&([a,l]=[l,a]);let c,d,u=o(a),g=o(l),p=[];if(!(r%1)&&g-u<i){if(u=Math.floor(u),g=Math.ceil(g),a>0){for(;u<=g;++u)for(c=1;c<r;++c)if(d=u<0?c/n(-u):c*n(u),!(d<a)){if(d>l)break;p.push(d)}}else for(;u<=g;++u)for(c=r-1;c>=1;--c)if(d=u>0?c/n(-u):c*n(u),!(d<a)){if(d>l)break;p.push(d)}2*p.length<i&&(p=CO(a,l,i))}else p=CO(u,g,Math.min(g-u,i)).map(n);return p=p.filter((t=>0!==t)),(null==s?void 0:s.noDecimals)&&(p=Array.from(new Set(p.map((t=>Math.floor(t)))))),h?p.reverse():p})),RO=VI(((t,e,i,r,o,n)=>{const s=[],a={},l=o(t),h=o(e);let c=[];if(Number.isInteger(r))c=CO(l,h,i);else{const t=(h-l)/(i-1);for(let e=0;e<i;e++)c.push(l+e*t)}return c.forEach((i=>{const o=n(i),l=Number.isInteger(r)?AO(t,e,o):AO(t,e,iO(o)),h=AO(t,e,((t,e)=>{let i,r;return e[0]<e[1]?(i=e[0],r=e[1]):(i=e[1],r=e[0]),Math.min(Math.max(t,i),r)})(l,[t,e]));!a[h]&&!isNaN(h)&&c.length>1&&(a[h]=1,s.push(h))})),s})),BO=VI(((t,e,i,r,o)=>xO(r(t),r(e),i).map((t=>iO(o(t))))));class MO extends dO{constructor(){super(...arguments),this.type=Gz.Linear}clone(){return(new MO).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return bO(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(bI(null==e?void 0:e.customTicks))return e.customTicks(this,t);if(CI(this._rangeFactorStart)&&CI(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&2===this._range.length||!this._niceType)return this.d3Ticks(t,e);const r=null!==(i=this._niceDomain)&&void 0!==i?i:this._domain,o=this._domain,n=r[0],s=r[r.length-1];let a=CO(o[0],o[o.length-1],t,e);if(!a.length)return a;if(this._domainValidator)a=a.filter(this._domainValidator);else if((a[0]!==n||a[a.length-1]!==s)&&this._niceType){const t=r.slice();if("all"===this._niceType?(t[0]=a[0],t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()):"min"===this._niceType&&a[0]!==n?(t[0]=a[0],this._niceDomain=t,this.rescale()):"max"===this._niceType&&a[a.length-1]!==s&&(t[t.length-1]=a[a.length-1],this._niceDomain=t,this.rescale()),"all"!==this._niceType){const e=Math.min(t[0],t[t.length-1]),i=Math.max(t[0],t[t.length-1]);a=a.filter((t=>t>=e&&t<=i))}}return a}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return xO(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return function(t,e,i){let r,o,n=-1;if(i=+i,(o=(e=+e)<(t=+t))&&(r=t,t=e,e=r),!isFinite(i)||e-t<=i)return[t];const s=Math.floor((e-t)/i+1),a=new Array(s);for(;++n<s;)a[n]=t+n*i;return o&&a.reverse(),a}(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const o=this._domain;let n=[];if(e){const t=SO(o,e);if(n=t.niceMinMax,this._domainValidator=t.domainValidator,this._niceType=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const e=_O(o.slice(),t);"min"===this._niceType?e[e.length-1]=null!==(i=n[1])&&void 0!==i?i:e[e.length-1]:"max"===this._niceType&&(e[0]=null!==(r=n[0])&&void 0!==r?r:e[0]),this._niceDomain=e,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=_O(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=_O(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class PO{nice(t=10,e){var i,r,o,n;const s=this._domain;let a=[],l=null;if(e){const t=SO(s,e);if(a=t.niceMinMax,this._domainValidator=t.domainValidator,l=t.niceType,t.niceDomain)return this._niceDomain=t.niceDomain,this.rescale(),this}else l="all";if(l){const t=((t,e)=>{const i=t.slice();let r=0,o=i.length-1,n=i[r],s=i[o];return s<n&&([r,o]=[o,r],[n,s]=[s,n]),i[r]=e.floor(n),i[o]=e.ceil(s),i})(s.slice(),null!==(r=null===(i=this.getNiceConfig)||void 0===i?void 0:i.call(this))&&void 0!==r?r:{floor:t=>Math.floor(t),ceil:t=>Math.ceil(t)});return"min"===l?t[t.length-1]=null!==(o=a[1])&&void 0!==o?o:t[t.length-1]:"max"===l&&(t[0]=null!==(n=a[0])&&void 0!==n?n:t[0]),this._niceDomain=t,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function HO(t){return e=>-t(-e)}function kO(t=Number.EPSILON){return e=>Math.max(e,t)}class EO extends dO{constructor(){super(Xz(10),$z(10)),this.type=Gz.Log,this._limit=kO(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return(new EO).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=Xz(this._base),r=$z(this._base);return(null!==(e=this._niceDomain)&&void 0!==e?e:this._domain)[0]<0?(this._logs=HO(i),this._pows=HO(r),this._limit=function(t=Number.EPSILON){return e=>Math.min(e,-t)}(),this.transformer=Vz,this.untransformer=Uz):(this._logs=i,this._pows=r,this._limit=kO(),this.transformer=this._logs,this.untransformer=r),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise((null!==(e=this._niceDomain)&&void 0!==e?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return jz}d3Ticks(t=10,e){const i=this.domain(),r=this._limit(i[0]),o=this._limit(i[i.length-1]);return TO(r,o,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return RO(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return BO(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return BO(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}kI(EO,PO);class FO extends MO{constructor(){super(Yz(1),qz(1)),this.type=Gz.Symlog,this._const=1}clone(){return(new FO).domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=Yz(t),this.untransformer=qz(t),this.rescale(e)):this._const}d3Ticks(t=10,e){const i=this.domain(),r=i[0],o=i[i.length-1];return TO(r,o,t,this._const,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return RO(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return BO(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return BO(e[0],e[e.length-1],t,this.transformer,this.untransformer)}}kI(FO,PO);class LO{_scale;_scales;bandPadding;paddingInner;paddingOuter;constructor(){this._scale=new lO,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(1===this._scales.length||1===t.length)e=this.valueToPosition(t[0]);else{const r=Math.min(t.length,this._scales.length);for(let i=0;i<r;i++)e+=this._scales[i].scale(t[i]);i=this._scales[r-1]}return{position:e,bandScale:i}}calcScales(t,e){const{bandPadding:i,paddingInner:r,paddingOuter:o}=this,n=Ux(i),s=Ux(r),a=Ux(o);for(let l=0;l<this._scales.length;l++){const h=n?i[l]:i,c=s?r[l]:r,d=a?o[l]:o;this._scales[l].paddingInner(c??h??t,!0).paddingOuter(d??h??e)}}dataToPosition(t,e={}){if(0===t.length||0===this._scales.length)return 0;const{position:i,bandScale:r}=this.getPosition(t);return i+r.bandwidth()*(e.bandPosition??.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}const IO=Math.sqrt(50),zO=Math.sqrt(10),OO=Math.sqrt(2);class DO{_extend={};_scale;_scales;nice;zero;domain;expand;forceTickCount;tickCount;niceType;type;constructor(t){this.type=t??"linear",this._scale="log"===t?new EO:"symlog"===t?new FO:new MO,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,r,o,n){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=r,"log"===this.type?this._scale.base(o??10):"symlog"===this.type&&this._scale.constant(n??10)}transformScaleDomain(){"symlog"===this.type||"log"===this.type||this.setScaleNice()}setScaleNice(){"log"===this.type?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){Dx(this.domain?.min)&&Dx(this.domain?.max)?this.nice&&this._scale.nice():Wx(this.domain?.min)&&Dx(this.domain?.max)?this.nice&&this._scale.niceMax():Dx(this.domain?.min)&&Wx(this.domain?.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){let t=this.forceTickCount??this.tickCount??10;"accurateFirst"===this.niceType&&(t=Math.max(10,t)),Dx(this.domain?.min)&&Dx(this.domain?.max)?this.nice&&this._scale.nice(t):Wx(this.domain?.min)&&Dx(this.domain?.max)?this.nice&&this._scale.niceMax(t):Dx(this.domain?.min)&&Wx(this.domain?.max)?this.nice&&this._scale.niceMin(t):this.nice&&this._scale.nice(t)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach((t=>{const{min:i,max:r}=t;e[0]=void 0===e[0]?i:Math.min(e[0],i),e[1]=void 0===e[1]?r:Math.max(e[1],r)})),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];Wx(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),Wx(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if(Wx(t[0])||Wx(t[1])||"linear"!==this.type)return t;if(Math.abs(((t,e)=>{var i;if(0===t.length)return;let r=t[0];for(let o=1;o<t.length;o++){const n=t[o];(null!==(i=null==e?void 0:e(n,r))&&void 0!==i?i:n-r)<0&&(r=n)}return r})(t)-((t,e)=>{var i;if(0===t.length)return;let r=t[0];for(let o=1;o<t.length;o++){const n=t[o];(null!==(i=null==e?void 0:e(n,r))&&void 0!==i?i:n-r)>0&&(r=n)}return r})(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let i=e/5;const r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);i=(o>=IO?10:o>=zO?5:o>=OO?2:1)*Math.pow(10,r),t[0]=0,t[1]=10*i}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){if(this.nice){let t=this.forceTickCount??this.tickCount??10;"accurateFirst"===this.niceType&&(t=Math.max(10,t)),Dx(this.domain?.min)&&Dx(this.domain?.max)?this._scale.nice(t):Wx(this.domain?.min)&&Dx(this.domain?.max)?this._scale.niceMax(t):Dx(this.domain?.min)&&Wx(this.domain?.max)?this._scale.niceMin(t):this._scale.nice(t)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(void 0===e)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,r=t[0]-t[i]>0,o=r?i:0,n=r?0:i;for(const i in this._extend)e=this._extend[i],e>t[n]&&(t[n]=e),e<t[o]&&(t[o]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;Wx(e)&&(t[0]=e),Wx(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function WO(t,e){const{width:i,height:r}=e.getLayoutRect(),o=Nz(e.orient),n=!0===e.option.inverse,s=t[0],a=function(t){if(Kx(t))return t[t.length-1]}(t);if(o)if(n){const t=i,e=0,r=s.AABBBounds.x2,o=a.AABBBounds.x1;r>t&&s.setAttributes({x:t,textAlign:"right"}),o<e&&a.setAttributes({x:e,textAlign:"left"})}else{const t=0,e=i,r=s.AABBBounds.x1,o=a.AABBBounds.x2;r<t&&s.setAttributes({x:t,textAlign:"left"}),o>e&&a.setAttributes({x:e,textAlign:"right"})}else if(n){const t=s.AABBBounds.y1,e=a.AABBBounds.y2,i=0,o=r;t<i&&s.setAttributes({y:i,textBaseline:"top"}),e>o&&a.setAttributes({y:o,textBaseline:"bottom"})}else{const t=r,e=0,i=s.AABBBounds.y2,o=a.AABBBounds.y1;i>t&&s.setAttributes({y:t,textBaseline:"bottom"}),o<e&&a.setAttributes({y:e,textBaseline:"top"})}}function NO(t,e){const i=e.option;t_(t)||i?.label?.flush&&WO(t,e)}const GO=t=>t;class jO{width;height;x=0;y=0;table;option;orient;visible;type;inverse;data;tickData;scale;component;padding;constructor(t,e,i,r,o){if(this.padding=r,this.table=o,this.orient=t.orient??"left",this.type=t.type??"band",this.option=s_({},function(t){return t?.colorScheme?.default?.palette?s_({},Sz,{tick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:t.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:t.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:t.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):Sz}(t.__vtableChartTheme),function(t,e){let i;"left"===t?i=e.axisStyle.leftAxisStyle:"right"===t?i=e.axisStyle.rightAxisStyle:"top"===t?i=e.axisStyle.topAxisStyle:"bottom"===t&&(i=e.axisStyle.bottomAxisStyle);return s_({},e.axisStyle.defaultAxisStyle,i)}(this.orient,o.theme),function(t,e,i){if(!i)return{};const r=i.axis;let o,n;"linear"===e||"log"===e||"symlog"===e?o=i.axisLinear:"band"===e&&(o=i.axisBand);"top"===t||"bottom"===t?n=i.axisX:"left"!==t&&"right"!==t||(n=i.axisY);return s_({},r,o,n)}(this.orient,this.type,t.__vtableChartTheme),t),"left"===this.orient||"right"===this.orient){const t=0,o=0;this.width=e,this.height=i-r[0]-r[2]-o,this.y=r[0]+t}else if("top"===this.orient||"bottom"===this.orient){const t=0,o=0;this.width=e-r[1]-r[3]-o,this.height=i,this.x=r[3]+t}this.visible=t.visible??!0,this.inverse="inverse"in t&&!!t.inverse,"band"===t.type&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;"band"===this.type||"point"===this.type?(this.scale=new LO,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):"linear"!==this.type&&"time"!==this.type&&"log"!==this.type&&"symlog"!==this.type||(this.scale=new DO(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){var t,e,i;this.table._vDataSet||(this.table._vDataSet=new dz),function(t,e,i){t.getParser(e)||t.registerParser(e,i)}(this.table._vDataSet,"scale",GO),t=this.table._vDataSet,e="ticks",i=qv,t.getTransform(e)||t.registerTransform(e,i);const r=this.option.label||{},o=this.option.tick||{},n=new gz(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:!1!==this.option.sampling,tickCount:o.tickCount,forceTickCount:o.forceTickCount,tickStep:o.tickStep,tickMode:o.tickMode,noDecimals:o.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:r.style,labelFormatter:r.formatMethod,labelGap:r.minGap,labelLastVisible:r.lastVisible,labelFlush:r.flush}},!1);this.tickData=n,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=Az(this.option),e=this.getUpdateAttribute();e.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component=new gv(s_({disableTriggerEvent:this.table.options.disableInteraction},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.component.originAxis=this}resize(t,e){this.width=t-("top"===this.orient||"bottom"===this.orient?this.padding[1]+this.padding[3]:0),this.height=e-("left"===this.orient||"right"===this.orient?this.padding[2]+this.padding[0]:0),this.updateScaleRange(),this.computeData();const i=Az(this.option),r=this.getUpdateAttribute();r.verticalFactor="top"===this.orient||"right"===this.orient?-1:1,this.component.setAttributes(s_({},i,r)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.overlap()}overlap(){!function(t,e){const i=t.find((t=>"axis-label-container-layer-0"===t.name),!0),r=t.find((t=>"axis-label-container-layer-1"===t.name),!0);NO(i?i.getChildren():[],e),NO(r?r.getChildren():[],e)}(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:t,height:e}=this.getLayoutRect(),i=Nz(this.orient),r="left"===(o=this.orient)||"right"===o;var o;let n={x:0,y:0},s=0;i?(n={x:t,y:0},s=t):r&&(n={x:0,y:e},s=e);const a="top"===this.orient||"bottom"===this.orient?e:t;return{start:{x:0,y:0},end:n,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(s),verticalLimitSize:a,verticalMinSize:a}}getLabelItems(t){return[this.tickData.latestData.map((e=>({id:e.value,label:e.value,value:0===t?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value}))).filter((t=>t.value>=0&&t.value<=1))]}updateScaleRange(){const t=this.option.innerOffset?.right??0,e=this.option.innerOffset?.left??0,i=this.option.innerOffset?.top??0,r=this.option.innerOffset?.bottom??0,{width:o,height:n}=this.getLayoutRect(),s=this.option.inverse||!1;let a=[0,0];Nz(this.orient)?Yx(o)&&(a=s?[o-t,e]:[e,o-t]):Yx(n)&&(a=s?[i,n-r]:[n-r,i]),this.scale.updateRange(a)}setLayoutStartPosition(t){let{x:e,y:i}=t;return Yx(e)&&(e+=Number("left"===this.orient)*this.getLayoutRect().width),Yx(i)&&(i+=Number("top"===this.orient)*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){if(this.option.title.visible&&Dx(this.option.title.style?.maxLineWidth)){let e=this.option.title.style?.angle||0;if(this.option.title?.autoRotate&&Dx(this.option.title.angle)&&(e="left"===this.option.orient?-90:90),t){const t=this.getLayoutRect().width,i=Math.abs(Math.cos(c_(e)));return i<1e-6?1/0:t/i}const i=this.getLayoutRect().height,r=Math.abs(Math.sin(c_(e)));return r<1e-6?1/0:i/r}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function VO(t,e){const i=s_({},Sz,t);let r=0;!1!==i.tick.visible&&(r=i.tick.width??4);let o=0;if(i.label.visible){if("band"===i.type){i.domain.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??vz,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??wz}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,$O(Math.min(r,s),n,a).width)}))}else{let r;if(t.sync?.tickAlign&&Ox(t.tick?.tickMode))r=t.tick.tickMode();else if(Ux(t.__ticksForVTable))r=t.__ticksForVTable;else{const t=i.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,o=Math.abs(t.max)>1?Math.round(t.max):t.max;r=[KO(e),KO(o)]}r.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??vz,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??wz}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,$O(Math.min(r,s),n,a).width)}))}o+=i.label.space??4}let n=0;if(i.title.visible&&Vx(i.title.text)){const{width:r,height:o}=e.measureText(i.title.text,{fontSize:i.title?.style?.fontSize??vz,fontWeight:i.title?.style?.fontWeight??"normal",fontFamily:i.title?.style?.fontFamily??wz}),s=i.label?.style?.maxLineWidth||1/0,a=$O(Math.min(r,s),o,i.title?.style?.angle);n="left"!==t.orient&&"right"!==t.orient||!i.title.autoRotate?a.width:a.height,n+=i.title.space??4}return Math.ceil(r+o+n+1)}function UO(t,e){const i=s_({},Sz,t);let r=0;!1!==i.tick.visible&&(r=i.tick.width??4);let o=0;if(i.label.visible){if("band"===i.type){i.domain.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??vz,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??wz}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,$O(Math.min(r,s),n,a).height)}))}else{let r;if(t.sync?.tickAlign&&Ox(t.tick?.tickMode))r=t.tick.tickMode();else if(Ux(t.__ticksForVTable))r=t.__ticksForVTable;else{const t=i.range,e=Math.abs(t.min)>1?Math.round(t.min):t.min,o=Math.abs(t.max)>1?Math.round(t.max):t.max;r=[KO(e),KO(o)]}r.forEach((t=>{i.label.formatMethod&&(t=i.label.formatMethod(t));const{width:r,height:n}=e.measureText(t,{fontSize:i.label?.style?.fontSize??vz,fontWeight:i.label?.style?.fontWeight??"normal",fontFamily:i.label?.style?.fontFamily??wz}),s=i.label?.style?.maxLineWidth||1/0,a=(i.label?.style?.angle??0)+("vertical"===i.label?.style?.direction?90:0);o=Math.max(o,$O(Math.min(r,s),n,a).height)}))}o+=i.label.space??4}let n=0;if(i.title.visible&&i.title.text){const{width:r,height:o}=e.measureText(i.title.text,{fontSize:i.title?.style?.fontSize??vz,fontWeight:i.title?.style?.fontWeight??"normal",fontFamily:i.title?.style?.fontFamily??wz}),s=i.label?.style?.maxLineWidth||1/0,a=$O(Math.min(r,s),o,i.title?.style?.angle);n="bottom"!==t.orient&&"top"!==t.orient||!i.title.autoRotate?a.height:a.width,n+=i.title.space??4}return r+o+n+1}function KO(t){return"number"!=typeof t&&(t=Number(t)),Number(t.toPrecision(1)).toString()}function $O(t,e,i=0){const r=i*Math.PI/180,o=-t/2,n=-e/2,s=t/2,a=-e/2,l=t/2,h=e/2,c=-t/2,d=e/2,u={x:o*Math.cos(r)-n*Math.sin(r),y:o*Math.sin(r)+n*Math.cos(r)},g={x:s*Math.cos(r)-a*Math.sin(r),y:s*Math.sin(r)+a*Math.cos(r)},p={x:l*Math.cos(r)-h*Math.sin(r),y:l*Math.sin(r)+h*Math.cos(r)},f={x:c*Math.cos(r)-d*Math.sin(r),y:c*Math.sin(r)+d*Math.cos(r)},m=Math.min(u.x,g.x,p.x,f.x),b=Math.max(u.x,g.x,p.x,f.x),y=Math.min(u.y,g.y,p.y,f.y);return{width:b-m,height:Math.max(u.y,g.y,p.y,f.y)-y}}class XO{table;_emptyTipOption={spaceBetweenTextAndIcon:20,text:"no data",textStyle:{fontSize:14,color:"#000"},icon:{image:'<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>',width:100,height:100}};isReleased=!1;_emptyTipComponent;_cacheAttrs;constructor(t,e){this.table=e,this._emptyTipOption=Object.assign(this._emptyTipOption,!0===t?{}:t),Wx(this._emptyTipOption.displayMode)||(this.table.isListTable()?this._emptyTipOption.displayMode="basedOnTable":this._emptyTipOption.displayMode="basedOnContainer"),this._emptyTipComponent=this._createOrUpdateEmptyTipComponent(this._getEmptyTipAttrs())}_createOrUpdateEmptyTipComponent(t){if(this._emptyTipComponent)h_(t,this._cacheAttrs)||this._emptyTipComponent.setAttributes(t);else{const e=new xx(t);e.name="emptyTip",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._emptyTipComponent=e,this.bindEvents()}return this._emptyTipComponent}bindEvents(){this._emptyTipComponent.on("click",(t=>{const e=new p_;this._emptyTipComponent.forEachChildren((t=>{e.union(t.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_click",t)})),this._emptyTipComponent.on("dblclick",(t=>{const e=new p_;this._emptyTipComponent.forEachChildren((t=>{e.union(t.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_dblclick",t)}))}resize(){if(!this._emptyTipComponent)return;const{leftHeaderWidth:t,topHeaderHeight:e,width:i,height:r}=this.getWidthAndHeight();this._emptyTipComponent.setAttributes({spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+t,y:this.table.tableY+e,width:i,height:r,text:{text:this._emptyTipOption.text,...this._emptyTipOption.textStyle,fill:this._emptyTipOption.textStyle?.color},icon:{...this._emptyTipOption.icon}})}release(){this._emptyTipComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent),this._emptyTipComponent=null,this.isReleased=!0}resetVisible(){(this.table.recordsCount&&0!==this.table.recordsCount||this.table.internalProps.layoutMap.rowCount!==this.table.internalProps.layoutMap.columnHeaderLevelCount)&&this.table.internalProps.layoutMap.colCount!==this.table.internalProps.layoutMap.rowHeaderLevelCount?this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent):this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)||this.table.scenegraph.stage.defaultLayer.appendChild(this._emptyTipComponent)}getWidthAndHeight(){const t=this.table.transpose||!1===this.table.options.indicatorsAsCol?this.table.getFrozenColsWidth():0,e=!this.table.transpose||this.table.options.indicatorsAsCol?this.table.getFrozenRowsHeight():0;return{leftHeaderWidth:t,topHeaderHeight:e,width:("basedOnContainer"!==this._emptyTipOption.displayMode&&this.table.columnHeaderLevelCount>0&&this.table.colCount>this.table.rowHeaderLevelCount?this.table.getDrawRange().width:this.table.tableNoFrameWidth)-t-this.table.getTheme().scrollStyle.width,height:("basedOnContainer"!==this._emptyTipOption.displayMode&&this.table.rowHeaderLevelCount>0&&this.table.rowCount>this.table.columnHeaderLevelCount?this.table.getDrawRange().height:this.table.tableNoFrameHeight)-e-this.table.getTheme().scrollStyle.width}}_getEmptyTipAttrs(){const{leftHeaderWidth:t,topHeaderHeight:e,width:i,height:r}=this.getWidthAndHeight();return{spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+t,y:this.table.tableY+e,width:i,height:r,text:{text:this._emptyTipOption.text,...this._emptyTipOption.textStyle,fill:this._emptyTipOption.textStyle?.color},icon:{...this._emptyTipOption.icon}}}}const YO={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};class qO{table;option;orient;visible;position;selectedData;legendComponent;constructor(t,e){this.table=e,this.option=i_(t),this.orient=t.orient??"left",this.visible=t.visible??!0,this.position=t.position??"middle",this.selectedData=t.defaultSelected??null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new dx(s_({},t,{defaultSelected:this.selectedData,disableTriggerEvent:this.table.options.disableInteraction}));e.name="legend",this.legendComponent=e,!1===this.visible&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&!1!==this.visible&&(this.legendComponent.setAttributes({maxWidth:this.table.tableNoFrameWidth,maxHeight:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){if(!this.legendComponent||!1===this.visible)return;let e=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,i=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(e<=0||i<=0)return;const r=this.table.tableNoFrameWidth,o=this.table.tableNoFrameHeight,n=pB(t.padding??this.option.padding??10);let s=0,a=0;"left"===this.orient?(s=n[3],a=0,e+=n[1]+n[3]):"top"===this.orient?(s=0,a=n[0],i+=n[0]+n[2]):"right"===this.orient?(s=r-e-n[1],a=0,e+=n[1]+n[3]):"bottom"===this.orient&&(s=0,a=o-i-n[2],i+=n[0]+n[2]);const l="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",h=this.position;let c=0,d=0;"horizontal"===l?c="middle"===h?(r-e)/2:"end"===h?r-e-n[1]:n[3]:d="middle"===h?(o-i)/2:"end"===h?o-i-n[2]:n[0],this.legendComponent.setAttributes({dx:c,dy:d,x:s,y:a}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e),this.table.tableX+=Math.ceil(e)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i),this.table.tableY+=Math.ceil(i)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i))}getLegendAttributes(t){const e="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",i=function(t,e){const{title:i={},item:r={},pager:o={},background:n={},type:s,id:a,visible:l,orient:h,position:c,data:d,filter:u,regionId:g,regionIndex:p,seriesIndex:f,seriesId:m,padding:b,...y}=s_({},YO,t),C=y;return i.visible&&(C.title=fz(i)),t_(r.focusIconStyle)||mz(r.focusIconStyle),bz(r.shape),bz(r.label),bz(r.value),bz(r.background),KB(r.maxWidth)&&(r.maxWidth=Number(r.maxWidth.substring(0,r.maxWidth.length-1))*e.width/100),KB(r.width)&&(r.width=Number(r.width.substring(0,r.width.length-1))*e.width/100),KB(r.height)&&(r.height=Number(r.height.substring(0,r.height.length-1))*e.width/100),C.item=r,t_(o.textStyle)||mz(o.textStyle),bz(o.handler),C.pager=o,n.visible&&!t_(n.style)&&(s_(C,n.style),Wx(n.padding)&&(C.padding=n.padding)),C}(this.option,t),r=pB(i.padding??this.option.padding??10);return{layout:e,items:this.getLegendItems(),maxWidth:t.width-r[1]-r[3],maxHeight:t.height-r[0]-r[2],...i}}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(ox.legendItemClick,(t=>{const e=e_(t,"detail.currentSelected");this.table.fireListeners(OS.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(ox.legendItemHover,(t=>{const e=e_(t,"detail");this.table.fireListeners(OS.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(ox.legendItemUnHover,(t=>{const e=e_(t,"detail");this.table.fireListeners(OS.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener("legendItemAttributeUpdate",(t=>{this.table.scenegraph.updateNextFrame()})))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}const ZO={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},JO={horizontal:{...ZO,rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}},vertical:{...ZO,rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}}},QO={horizontal:{sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}},...ZO},vertical:{sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}},...ZO}};function tD(t,e){const{title:i={},handler:r={},rail:o={},track:n={},startText:s,endText:a,handlerText:l,sizeBackground:h,background:c={},type:d,id:u,visible:g,orient:p,position:f,data:m,defaultSelected:b,field:y,filter:C,regionId:w,regionIndex:v,seriesIndex:x,seriesId:_,padding:S,...A}=s_({},("color"===t.type?JO:QO)["bottom"===t.orient||"top"===t.orient?"horizontal":"vertical"],t),T=A;return i.visible&&(T.title=fz(i)),T.showHandler=!1!==r.visible,t_(r.style)||(T.handlerStyle=mz(r.style)),Wx(o.width)&&(T.railWidth=o.width),Wx(o.height)&&(T.railHeight=o.height),t_(o.style)||(T.railStyle=mz(o.style)),t_(n.style)||(T.trackStyle=mz(n.style)),T.startText=bz(s),T.endText=bz(a),T.handlerText=bz(l),t_(h)||(T.sizeBackground=mz(h)),c.visible&&!t_(c.style)&&(s_(T,c.style),Wx(c.padding)&&(T.padding=c.padding)),T}class eD{table;option;orient;visible;position;selectedData;legendComponent;constructor(t,e){this.table=e,this.option=i_(t),this.orient=t.orient??"left",this.visible=t.visible??!0,this.position=t.position??"middle",this.selectedData=t.defaultSelected??null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e="color"===this.option.type?new mx(s_({},t,{slidable:!0})):new yx(s_({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,!1===this.visible&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&!1!==this.visible&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){if(!this.legendComponent||!1===this.visible)return;let e=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,i=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(e<=0||i<=0)return;const r=this.table.tableNoFrameWidth,o=this.table.tableNoFrameHeight,n=pB(t.padding??this.option.padding??10);let s=0,a=0;"left"===this.orient?(s=n[3],a=0,e+=n[1]+n[3]):"top"===this.orient?(s=0,a=n[0],i+=n[0]+n[2]):"right"===this.orient?(s=r-e-n[1],a=0,e+=n[1]+n[3]):"bottom"===this.orient&&(s=0,a=o-i-n[2],i+=n[0]+n[2]);const l="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",h=this.position;let c=0,d=0;"horizontal"===l?c="middle"===h?(r-e)/2:"end"===h?r-e-n[1]:n[3]:d="middle"===h?(o-i)/2:"end"===h?o-i-n[2]:n[0],this.legendComponent.setAttributes({dx:c,dy:d,x:s,y:a}),"left"===this.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e),this.table.tableX+=Math.ceil(e)):"top"===this.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i),this.table.tableY+=Math.ceil(i)):"right"===this.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e):"bottom"===this.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i))}getLegendAttributes(t){const e="bottom"===this.orient||"top"===this.orient?"horizontal":"vertical",i="horizontal"===e?"bottom":this.orient;return{...tD(this.option),layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,["color"===this.option.type?"colors":"sizeRange"]:"color"===this.option.type?this.option.colors:this.option.sizeRange}}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",(t=>{const e=e_(t,"detail.value");this.table.fireListeners(OS.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function iD(t,e){return"color"===t.type||"size"===t.type?new eD(t,e):new qO(t,e)}class rD{_table;_menuElement;constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}getRootElement(){return this._getMenuElement().rootElement}}const oD="vtable__menu-element",nD=`${oD}--hidden`,sD=`${oD}--shown`;class aD{_handler;_rootElement;_menuInstanceInfo;constructor(t){this._handler=new GS,this._rootElement=HF("div",[oD,nD]),this._rootElement.addEventListener("wheel",(t=>{t.stopPropagation()})),this._rootElement?.addEventListener("mousedown",(t=>{t.stopPropagation(),t.preventDefault()})),this._rootElement?.addEventListener("click",(e=>{if(e.stopPropagation(),e.preventDefault(),this._rootElement.classList.contains(nD))return;const{col:i,row:r,dropDownIndex:o,menuKey:n,text:s,hasChildren:a}=e.target;if("number"!=typeof o||a)return void e.stopPropagation();const l=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(i,r):t.getHeaderField(i,r),h=t._dropDownMenuIsHighlight(i,r,o);t.fireListeners(OS.DROPDOWN_MENU_CLICK,{col:i,row:r,field:l,menuKey:n,text:s,highlight:h,cellLocation:t.getCellLocation(i,r),event:e}),t.fireListeners(OS.DROPDOWN_MENU_CLEAR,null),t.fireListeners(OS.HIDE_MENU,null),e.stopPropagation()})),this._rootElement?.addEventListener("mousemove",(t=>{this._rootElement.classList.contains(nD)||t.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const o=this._rootElement;if(this._menuInstanceInfo=r,o?.classList.remove(sD),o?.classList.add(nD),this._canBindToCell(t,e,i)){o.innerHTML="",o.appendChild(r.content);if(this._bindCell(t,e,i,r.position,r.referencePosition))return o?.classList.add(sD),o?.classList.remove(nD),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,t?.parentElement&&(t.classList.remove(sD),t.classList.add(nD))}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.internalProps.menu.parentElement??t.getElement(),{top:n,bottom:s,left:a,right:l}=r;if(t.isFrozenCell(e,i))return!0;if(s<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||n>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=o;return!(h<n)&&!(c<a)}_bindCell(t,e,i,r,o){const n=this._rootElement,s=t.internalProps.menu.parentElement??t.getElement(),{width:a,height:l,left:h,top:c}=s.getBoundingClientRect();if(n){n.parentElement!==s&&s.appendChild(n),n.style.left="0px";const e=.8*a;n.style.maxWidth=`${e}px`;const i=n.clientWidth,d=n.clientHeight;let u,g;r&&(u=r.x,g=r.y),o&&(u=o.rect.right-i,g=o.rect.bottom),g+d>l&&(g=l-d,u+=i-2),g<0&&(g/=2);let p=0,f=0;if(t.getElement()!==s){const{left:e,top:i}=t.getElement().getBoundingClientRect();p=i-c,f=e-h}return n.style.top=`${g+p}px`,u<0?u=0:u+i>a&&(u=a-i),n.style.left=`${u+f}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:n,height:s}=i.getBoundingClientRect();return t>r-5&&t<r+n+5&&e>o-5&&e<o+s+5}}class lD extends rD{createMenuElementInternal(){return new XF(this._table)}}let hD=class extends rD{createMenuElementInternal(){return new aD(this._table)}};const cD={"dropdown-menu":function(t){return new lD(t)},"context-menu":function(t){return new lD(t)},container:t=>new hD(t)};class dD{_table;_menuInstances;_attachInfo;constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,r){const o=this._attachInfo,n=this._getMenuInstanceInfo(t,e,i,r);if(!o||n&&o.instance===n.instance||(o.instance?.unbindMenuElement(),this._attachInfo=null),!n)return;const{instance:s,info:a}=n;if(s&&s.bindMenuElement(t,e,a)){const i=this._table.getCellRange(t,e);this._attachInfo={range:i,instance:s}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e?.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&MS(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:r}=i;return r.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(OS.DROPDOWN_ICON_CLICK,(t=>{this._attachInfo&&this._isBindToCell(t.col,t.row)?this._unbindFromCell():this._bindToCell(t.col,t.row,"dropdown-menu")})),t.on(OS.DROPDOWN_MENU_CLEAR,(t=>{this._unbindFromCell()})),t.on(OS.CONTEXTMENU_CELL,(e=>{if("html"===t.internalProps.menu?.renderMode){const i=t._getMouseAbstractPoint(e.event);let r=null;i.inTable&&"function"==typeof t.internalProps.menu?.contextMenuItems?r=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col,t):i.inTable&&Array.isArray(t.internalProps.menu?.contextMenuItems)&&(r=t.internalProps.menu?.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:r,position:{x:i.x,y:i.y}})}}))}_getMenuInstanceInfo(t,e,i,r){const o=this._table,n=this._menuInstances,s=function(t,e,i,r,o){const{lineHeight:n,textBaseline:s,textStick:a}=t._getCellStyle(e,i);let l=t.getCellRangeRelativeRect(t.getCellRange(e,i));a&&(l=t.getVisibleCellRangeRelativeRect({col:e,row:i}));let{left:h,right:c,bottom:d,top:u,width:g,height:p}=l;if(t.isHeader(e,i)&&({left:h,right:c,bottom:d,top:u,width:g,height:p}=t.internalProps.headerHelper.getDropDownIconRect(l,n,s||"middle")),o?.content)return{type:r,position:o.position,referencePosition:o.referencePosition??{rect:{left:h,right:c,top:u,bottom:d,width:g,height:p}},content:o.content};if("dropdown-menu"===r){let o=t.globalDropDownMenu;const n=t._getHeaderLayoutMap(e,i);o=n.dropDownMenu??o;const s=n.pivotInfo;return"function"==typeof o&&(o=o({row:i,col:e,table:t})),{type:r,referencePosition:{rect:{left:h,right:c,top:u,bottom:d,width:g,height:p}},content:o,pivotInfo:s}}return null}(o,t,e,i,r);if(!s)return null;return{instance:n&&n[i]||n&&(n[i]=cD[i](o)),type:i,info:s}}containElement(t){for(const e in this._menuInstances){const i=this._menuInstances[e].getRootElement()?.contains(t);if(i)return!0}return!1}}class uD{table;_titleOption;isReleased=!1;_titleComponent;_cacheAttrs;constructor(t,e){this.table=e,this._titleOption=s_({orient:"top"},t),!1!==t.visible&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)h_(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new Cx(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){if(!this._titleComponent)return;const t=pB(this._titleOption.padding??10),e=this._titleOption.width??("adaptive"===this.table.widthMode?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width))-t[1]-t[3],i=this._titleOption.height??("adaptive"===this.table.heightMode?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height))-t[0]-t[2];this._titleComponent.setAttributes({x:this._titleOption.x??"right"===this._titleOption.orient?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:this._titleOption.y??"bottom"===this._titleOption.orient?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?e:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?i:this._titleOption.height,textStyle:{width:e,...this._titleOption.textStyle},subtextStyle:{width:e,...this._titleOption.subtextStyle}}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){const e=isFinite(this._titleComponent?.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,i=isFinite(this._titleComponent?.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;"left"===this._titleOption.orient?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e),this.table.tableX+=Math.ceil(e)):"top"===this._titleOption.orient?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i),this.table.tableY+=Math.ceil(i)):"right"===this._titleOption.orient?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(e):"bottom"===this._titleOption.orient&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(i)),this._cacheAttrs=t,"right"!==this._titleOption.orient&&"bottom"!==this._titleOption.orient||this._titleComponent.setAttributes({x:this._titleOption.x??"right"===this._titleOption.orient?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:this._titleOption.y??"bottom"===this._titleOption.orient?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){const t=this._titleOption.text||this._titleOption.subtext?10:0,e=pB(this._titleOption.padding??t),i=this._titleOption.width??Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-e[1]-e[3],r=this._titleOption.height??Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-e[0]-e[2];return{text:this._titleOption.text??"",subtext:this._titleOption.subtext??"",x:this._titleOption.x??"right"===this._titleOption.orient?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:this._titleOption.y??"bottom"===this._titleOption.orient?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:"top"===this._titleOption.orient||"bottom"===this._titleOption.orient?i:this._titleOption.width,height:"left"===this._titleOption.orient||"right"===this._titleOption.orient?r:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:this._titleOption.align??"left",verticalAlign:this._titleOption.verticalAlign??"top",textStyle:{width:i,...this._titleOption.textStyle},subtextStyle:{width:i,...this._titleOption.subtextStyle},dx:this._titleOption.dx??0,dy:this._titleOption.dy??0}}getComponentGraphic(){return this._titleComponent}}class gD{_table;_tooltipElement;constructor(t){this._table=t}release(){this.unbindTooltipElement(),this._tooltipElement&&this._tooltipElement.release?.(),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,r){return this._getTooltipElement().bindToCell(this._table,t,e,i,r)}moveTooltipElement(t,e,i,r){this._getTooltipElement().move(this._table,t,e,i,r)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,r,o){this._getTooltipElement()._locate(this._table,t,e,i,r,o)}}!function(){if("node"===X_.mode)return;const t=document.createElement("style");t.id="vtable-tooltip-styleSheet",t.textContent="\n@keyframes vtable__bubble-tooltip-element--shown-animation {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n.vtable__bubble-tooltip-element {\n\tposition: absolute;\n\t\n\t// pointer-events: none;\n\t//user-select: none;\n\tmax-width: 300px;\n\tz-index: 99999;\n\n\tbackground: #FFFFFF;\n    border: 1px solid #E6E8ED;\n    box-sizing: border-box;\n    border-radius: 4px;\n    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);\n    color: #141414;\n    font-size: 13px;\n}\n.vtable__bubble-tooltip-element--hidden {\n\topacity: 0;\n  pointer-events: none;\n\tuser-select: none;\n\t/* transform: translate(-50%, -50%); */\n\ttransition: opacity 75ms linear;\n}\n.vtable__bubble-tooltip-element--shown {\n\topacity: 1;\n\t/* transform: translate(-50%, -50%); */\n\tanimation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;\n}\n.vtable__bubble-tooltip-element__content {\n\t/* font-size: .75rem; */\n\tpadding: 6px 8px;\n\tmin-height: 1em;\n\tline-height: 1.5;\n\twidth: 100%;\n\tdisplay: block;\n\twhite-space: pre-wrap;\n\tmargin: 0;\n\tbox-sizing: border-box;\n\toverflow: auto;\n\tword-wrap: break-word;\n\tposition: relative;\n\tbackground-color: #FFF;\n\tz-index: 2;\n\tborder-radius: 4px;\n}\n/*  WebKit Microsoft Edge（新版）： */\n.vtable__bubble-tooltip-element__content::-webkit-scrollbar {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n/*  Opera Firefox  */\n.vtable__bubble-tooltip-element__content > scrollbar-track {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n/* Internet Explorer 11 和 Microsoft Edge（旧版） */\n.vtable__bubble-tooltip-element__content > scrollbar {\n  width: 0;\n  height: 0;\n  background-color: transparent;\n}\n.vtable__bubble-tooltip-element__triangle {\n\t/* font-size: .75rem; */\n\tposition: absolute;\n\twidth: 10px;\n\theight: 10px;\n\tdisplay: block;\n\ttransform: rotate(45deg);\n    transform-origin: 50% 50% 0;\n\tz-index: 1;\n\tbackground-color: #FFF;\n\tborder: 1px solid #E6E8ED;\n}\n",document.head.appendChild(t)}();const pD="vtable__bubble-tooltip-element",fD=`${pD}__content`,mD=`${pD}__triangle`,bD=`${pD}--hidden`,yD=`${pD}--shown`;class CD{_handler;_rootElement;_messageElement;_triangleElement;_disappearDelay;_disappearDelayId;constructor(){this._handler=new GS;const t=this._rootElement=HF("div",[pD,bD]),e=HF("div",[fD]),i=HF("span",[mD]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${fD}`)||void 0,this._triangleElement=t.querySelector(`.${mD}`)||void 0,t.addEventListener("mousemove",(()=>{this._disappearDelayId&&clearTimeout(this._disappearDelayId)})),t.addEventListener("mouseleave",(()=>{this._disappearDelay=void 0,this.unbindFromCell()})),e.addEventListener("wheel",(t=>{t.stopPropagation()})),e.addEventListener("copy",(t=>{const i=function(t){const e=window.getSelection();if(e.rangeCount){const i=e.getRangeAt(0);return i.endOffset>i.startOffset&&t.contains(i.commonAncestorContainer)}return!1}(e);i&&t.stopPropagation()}))}bindToCell(t,e,i,r,o){this._disappearDelay=r?.disappearDelay,this._disappearDelayId&&clearTimeout(this._disappearDelayId);const n=this._rootElement,s=this._messageElement,a=this._triangleElement;if(n?.classList.remove(yD),n?.classList.add(bD),this._canBindToCell(t,e,i)){s.setAttribute("style",""),a.setAttribute("style",""),r?.className&&n.classList.add(r.className),r?.style?.bgColor&&(s.style.backgroundColor=r?.style?.bgColor),r?.style?.bgColor&&(a.style.backgroundColor=r?.style?.bgColor),a.style.display=!0===r?.style?.arrowMark?"block":"none",r?.style?.fontSize&&(s.style.fontSize=(r?.style?.fontSize??12)+"px"),r?.style?.fontFamily&&(s.style.fontFamily=r?.style?.fontFamily),r?.style?.color&&(s.style.color=r?.style?.color),r?.style?.padding&&(s.style.padding=`${r?.style?.padding.join("px ")}px`),r?.style?.maxHeight&&(s.style.maxHeight=`${r?.style?.maxHeight}px`),r?.style?.maxWidth&&(s.style.maxWidth=`${r?.style?.maxWidth}px`),s&&(s.textContent=r?.content);if(this._bindToCell(t,e,i,r?.position,r?.referencePosition,o,r?.style?.arrowMark))return n?.classList.add(yD),n?.classList.remove(bD),!0}else this.unbindFromCell();return!1}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler?.release?.(),delete this._rootElement,delete this._messageElement}move(t,e,i,r,o){const n=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,r?.position,r?.referencePosition,o),n?.classList.add(yD),n?.classList.remove(bD)):this.unbindFromCell()}unbindFromCell(){if(this._disappearDelay)this._disappearDelayId=setTimeout((()=>{const t=this._rootElement;t?.parentElement&&(t.classList.remove(yD),t.classList.add(bD))}),this._disappearDelay??0);else{const t=this._rootElement;t?.parentElement&&(t.classList.remove(yD),t.classList.add(bD))}}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{bottom:n,left:s,right:a,top:l}=r;if(t.isFrozenCell(e,i))return!0;if(n<t.getFrozenRowsHeight()||a<t.getFrozenColsWidth()||s>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||l>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:h,offsetWidth:c}=o;return!(l>h)&&!(s>c)}_bindToCell(t,e,i,r,o,n,s){const a=this._rootElement,l=t.getCellRangeRelativeRect({col:e,row:i}),h=t.internalProps.tooltip.parentElement,c=t.internalProps.element.offsetWidth,{width:d}=l;if(a){let l,u;a.parentElement!==h&&h.appendChild(a),a.style.left="0px";const g=Math.min(.8*c,4*d);a.style.maxWidth=`${g}px`;const p=a.clientWidth,f=a.clientHeight;if(!r&&!o)return!1;{const a=this.getComputedPosition(t,e,i,r,o,n,s);u=a.x,l=a.y}a.style.left=`${u}px`,a.style.top=`${l}px`,aS()&&(a.style.fontSize="11px");const{x1:m,x2:b,y1:y,y2:C}=t.stateManager.menu.bounds,w=u,v=w+p,x=l,_=w+f;return!(t.stateManager.menu.isShow&&m<v&&b>w&&C>x&&y<_)}return!1}getComputedPosition(t,e,i,r,o,n,s){const a=this._rootElement,l=t.getCellRangeRelativeRect({col:e,row:i}),{x:h,y:c}=t.internalProps.tooltip.parentElement.getBoundingClientRect(),{width:d,height:u,x:g,y:p}=t.internalProps.element.getBoundingClientRect(),{width:f}=l;let m,b;const y=Math.min(.8*d,4*f);a.style.maxWidth=`${y}px`;const C=a.clientWidth,w=a.clientHeight,v=s?6:0;if(r)b=r.x,m=r.y+v,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(o){let t=o.placement??Hx.bottom;const e=o.rect.left+o.rect.width/2,i=o.rect.top+o.rect.height/2,r=o.rect.top,s=o.rect.bottom,a=o.rect.left,l=o.rect.right;let h=0;const c=()=>{h++,h>=4||(this.removeStyleFromTriangle(),t===Hx.top?(b=e-C/2,m=r-w-v,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",n&&m<0&&(t=Hx.right,c())):t===Hx.bottom?(b=e-C/2,m=s+v,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",n&&m+w>u&&(t=Hx.left,c())):t===Hx.left?(m=i-w/2,b=a-C-v,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",n&&b<0&&(t=Hx.top,c())):t===Hx.right&&(m=i-w/2,b=l+v,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",n&&b+C>d&&(t=Hx.bottom,c())))};c()}return n&&(b<0?b=0:b+a.offsetWidth>d&&(b=d-a.offsetWidth)),{x:b+g-h,y:m+p-c}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,r,o,n){const s=this.getComputedPosition(t,e,i,r,o,n),a=s.x,l=s.y;this._rootElement.style.left=`${a}px`,this._rootElement.style.top=`${l}px`}}class wD extends gD{createTooltipElementInternal(){return new CD}}const vD={"bubble-tooltip":function(t){return new wD(t)}};class xD{_table;_tooltipInstances;_attachInfo;confine;constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){const t=this._tooltipInstances;for(const e in t)t[e]?.release?.();delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){const r=this._attachInfo,o=this._getTooltipInstanceInfo(t,e);if(!r||o&&r.instance===o||(r.instance?.unbindTooltipElement(),this._attachInfo=null),!o)return;if(o&&o.bindTooltipElement(t,e,i,this.confine)){const r=this._table.getCellRange(t,e);this._attachInfo={range:r,instance:o,tooltipOptions:i}}}_move(t,e,i){const r=this._attachInfo;if(!r||!MS(r.range,t,e))return;const{instance:o}=r;o?.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,r){const o=this._attachInfo;if(!o||!MS(o.range,t,e))return;const{instance:n}=o;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=r,n?.locateTooltipElement(t,e,i,r,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e?.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&MS(i.range,t,e)}_bindTableEvent(t){t.on(OS.MOUSEENTER_CELL,(e=>{if(aS())return;const{x1:i,x2:r,y1:o,y2:n}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&"number"==typeof e.x&&"number"==typeof e.y&&e.x>i&&e.x<r&&e.y>o&&e.y<n)return;const{col:s,row:a}=e;this.showTooltip(s,a)})),t.on(OS.MOUSEMOVE_CELL,(e=>{if(!aS()){if(this._attachInfo?.tooltipOptions?.referencePosition){const i=this._attachInfo.tooltipOptions.referencePosition,{event:r}=e,{left:o,right:n,top:s,bottom:a}=i.rect,l=t._getMouseAbstractPoint(r);l.inTable&&l.x>=o-5&&l.x<=n+5&&l.y>=s-5&&l.y<=a+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}})),t.on(OS.MOUSELEAVE_CELL,(t=>{this._unbindFromCell()})),t.on(OS.SELECTED_CELL,(t=>{this._isBindCell(t.col,t.row)&&this._unbindFromCell()})),t.on(OS.MOUSELEAVE_TABLE,(t=>{this._unbindFromCell()})),t.on(OS.SCROLL,(t=>{this._unbindFromCell()}))}showTooltip(t,e){let i;const r=this._table,o=r.getHeaderDescription(t,e);if(o){const n=r.getCellRangeRelativeRect({col:t,row:e});i={content:o,referencePosition:{placement:r.internalProps.tooltip.position,rect:n},disappearDelay:r.internalProps.tooltip.overflowTextTooltipDisappearDelay??0,style:r.theme.tooltipStyle}}else if(Ox(r.internalProps.tooltip?.isShowOverflowTextTooltip)?r.internalProps.tooltip.isShowOverflowTextTooltip(t,e,r):r.internalProps.tooltip.isShowOverflowTextTooltip){const n=r.getCellOverflowText(t,e),s=r.getCellRangeRelativeRect({col:t,row:e});n&&(i={content:o?`${o}\n  ${n}`:n,referencePosition:{placement:r.internalProps.tooltip.position,rect:s},disappearDelay:r.internalProps.tooltip.overflowTextTooltipDisappearDelay??0,style:r.theme.tooltipStyle})}i?this._bindToCell(t,e,i):this._unbindFromCell()}_getTooltipInstanceInfo(t,e){const i=this._table,r=this._tooltipInstances,o="bubble-tooltip";return r&&r[o]||r&&(r[o]=vD[o](i))}isBinded(t){return JSON.stringify(t)===JSON.stringify(this._attachInfo?.tooltipOptions)}}const _D=()=>{wA.registerComponent("axis",jO),wA.registerFunction("computeAxisComponentWidth",VO),wA.registerFunction("computeAxisComponentHeight",UO),wA.registerFunction("getAxisConfigInPivotChart",LL)},SD=()=>{wA.registerComponent("emptyTip",XO)},AD=()=>{wA.registerFunction("createLegend",iD)},TD=()=>{wA.registerComponent("menuHandler",dD)},RD=()=>{wA.registerComponent("title",uD)},BD=()=>{wA.registerComponent("tooltipHandler",xD)},MD=()=>{LC.registerBuiltInAnimate("increaseCount",YC),LC.registerBuiltInAnimate("fromTo",av),LC.registerBuiltInAnimate("scaleIn",zw),LC.registerBuiltInAnimate("scaleOut",Ow),LC.registerBuiltInAnimate("growHeightIn",cw),LC.registerBuiltInAnimate("growHeightOut",dw),LC.registerBuiltInAnimate("growWidthIn",Rw),LC.registerBuiltInAnimate("growWidthOut",Bw),LC.registerBuiltInAnimate("growCenterIn",aw),LC.registerBuiltInAnimate("growCenterOut",lw),LC.registerBuiltInAnimate("clipIn",QC),LC.registerBuiltInAnimate("clipOut",tw),LC.registerBuiltInAnimate("fadeIn",ew),LC.registerBuiltInAnimate("fadeOut",iw),LC.registerBuiltInAnimate("growPointsIn",pw),LC.registerBuiltInAnimate("growPointsOut",fw),LC.registerBuiltInAnimate("growPointsXIn",bw),LC.registerBuiltInAnimate("growPointsXOut",yw),LC.registerBuiltInAnimate("growPointsYIn",ww),LC.registerBuiltInAnimate("growPointsYOut",vw),LC.registerBuiltInAnimate("growAngleIn",nw),LC.registerBuiltInAnimate("growAngleOut",sw),LC.registerBuiltInAnimate("growRadiusIn",Sw),LC.registerBuiltInAnimate("growRadiusOut",Aw),LC.registerBuiltInAnimate("moveIn",ev),LC.registerBuiltInAnimate("moveOut",iv),LC.registerBuiltInAnimate("rotateIn",ov),LC.registerBuiltInAnimate("rotateOut",nv),LC.registerBuiltInAnimate("update",Qw),LC.registerBuiltInAnimate("state",Dw),LC.registerBuiltInAnimate("labelItemAppear",Mw),LC.registerBuiltInAnimate("labelItemDisappear",Pw),LC.registerBuiltInAnimate("poptipAppear",Hw),LC.registerBuiltInAnimate("poptipDisappear",kw),LC.registerBuiltInAnimate("inputText",qC),LC.registerBuiltInAnimate("inputRichText",Ew),LC.registerBuiltInAnimate("outputRichText",Fw),LC.registerBuiltInAnimate("slideRichText",Lw),LC.registerBuiltInAnimate("slideOutRichText",Iw),LC.registerBuiltInAnimate("slideIn",Ww),LC.registerBuiltInAnimate("growIn",Nw),LC.registerBuiltInAnimate("spinIn",Gw),LC.registerBuiltInAnimate("moveScaleIn",Uw),LC.registerBuiltInAnimate("moveRotateIn",Kw),LC.registerBuiltInAnimate("strokeIn",jw),LC.registerBuiltInAnimate("slideOut",$w),LC.registerBuiltInAnimate("growOut",Xw),LC.registerBuiltInAnimate("spinOut",Yw),LC.registerBuiltInAnimate("moveScaleOut",qw),LC.registerBuiltInAnimate("moveRotateOut",Zw),LC.registerBuiltInAnimate("strokeOut",Vw),LC.registerBuiltInAnimate("pulse",Jw),LC.registerBuiltInAnimate("MotionPath",sv),LC.registerBuiltInAnimate("streamLight",lv),It(el,jC),It(el,VC)};class PD{table;titleRows=[];showedTitleRows=[];rowNow=-1;skipStartRow=-1;skipEndRow=-1;constructor(t){this.table=t,this.table.on("scroll",(t=>{"vertical"===t.scrollDirection&&this.updateGroupTitle()})),this.table.on("tree_hierarchy_state_change",(t=>{this.updateGroupTitle()})),this.table.on("resize_column",(t=>{this.updateGroupTitle()}))}updateGroupTitle(){0===this.table.scrollTop?(this.titleRows=[],this.showedTitleRows=[]):-1!==this.skipStartRow&&-1!==this.skipEndRow&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;const t=this.table.getRecordIndexByCell(0,this.rowNow),e=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(t,e)}getTitleRowsByRecordIndex(t,e){Ux(t)||(t=[t]),Ux(e)||(e=[e]);for(let e=0;e<t.length;e++){const i=t.slice(0,e+1);this.table.dataSource.getRaw(i)}const i=[],r=e.length===t.length+1;let o=t.slice(0,r?t.length:t.length-1);const n=this.table.dataSource.currentIndexedData;for(let e=this.rowNow-this.table.columnHeaderLevelCount;e>=0;e--){const r=n[e];if(Ux(r)&&o.length===r.length){let t=!0;for(let e=0;e<r.length;e++)if(r[e]!==o[e]){t=!1;break}t&&(i.push(e+this.table.columnHeaderLevelCount),o=o.slice(0,o.length-1))}else if(r===t[0]){i.push(e+this.table.columnHeaderLevelCount);break}}this.titleRows=i.reverse()}updateScenegraph(){const{table:t}=this,{shadowGroup:e,shadowGroupFrozen:i}=function(t){const e=t.scenegraph.colHeaderGroup,i=t.scenegraph.cornerHeaderGroup;if(!e.border){const i=hh({x:0,y:0,width:0,height:0,cursor:"pointer"});e.add(i),e.border=i,i.attachShadow(i.shadowRoot),i.name="border-rect",i.addEventListener("click",(e=>{const i=t.listTreeStickCellPlugin.titleRows,{shadowTarget:r}=e.pickParams,o=LM(r),{col:n,row:s}=o;ED(s-i.indexOf(s),t)}))}if(!i.border){const e=hh({x:0,y:0,width:0,height:0,cursor:"pointer"});i.add(e),i.border=e,e.attachShadow(e.shadowRoot),e.name="border-rect",e.addEventListener("click",(e=>{const i=t.listTreeStickCellPlugin.titleRows,{shadowTarget:r}=e.pickParams,o=LM(r),{col:n,row:s}=o;ED(s-i.indexOf(s),t)}))}const r=e.border.shadowRoot,o=i.border.shadowRoot;return r.removeAllChild(),o.removeAllChild(),{shadowGroup:r,shadowGroupFrozen:o}}(t);this.showedTitleRows.length=0;let r=0;for(let o=0;o<t.colCount;o++){let n;o<t.frozenColCount?(n=new $M({x:t.getColsWidth(0,o-1),y:t.getFrozenRowsHeight()}),i.add(n)):(n=new $M({x:t.getColsWidth(t.frozenColCount,o-1),y:t.getFrozenRowsHeight()}),e.add(n)),n.col=o;for(let e=0;e<this.titleRows.length;e++){const i=this.titleRows[e];if(HD(i,this.rowNow,t.scenegraph.proxy.screenTopRow,this.titleRows)){0===o&&r++;continue}0===o&&this.showedTitleRows.push(i);const s=t.scenegraph.getCell(o,i);if("cell"===s.role){const t=kD(s);t.setAttributes({y:40*e}),n.add(t)}else{const r=CP(o,i,t,!0,!0);r.setAttributes({y:40*e}),n.add(r)}}}r>0&&-1===this.skipStartRow&&-1===this.skipEndRow&&(this.skipStartRow=t.scenegraph.proxy.screenTopRow-1,this.skipEndRow=t.scenegraph.proxy.screenTopRow+1)}}function HD(t,e,i,r){if(t===e&&t!==i+r.length-1)return!0;return t===i+r.indexOf(t)+1&&t<e}function kD(t){const e=t.clone();if(e.role=t.role,e.col=t.col,e.row=t.row,e.mergeStartCol=t.mergeStartCol,e.mergeStartRow=t.mergeStartRow,e.mergeEndCol=t.mergeEndCol,e.mergeEndRow=t.mergeEndRow,e.contentWidth=t.contentWidth,e.contentHeight=t.contentHeight,"cell"===e.role){const t=hh({x:0,y:0,width:e.attribute.width,height:e.attribute.height});e.add(t)}if("group"===t.type){const i=e;t.forEachChildren((t=>{const e=kD(t);i.add(e)}))}return e}function ED(t,e){const i=e.getDrawRange();if(Wx(t)&&t>=e.frozenRowCount){const r=e.getFrozenRowsHeight(),o=e.getRowsHeight(0,t-1);e.scrollTop=Math.min(o-r,e.getAllRowsHeight()-i.height)-1}e.scenegraph.updateNextFrame()}function FD(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y){const C=xS(sI,nI)[c],w=ZM("padding",p._getCellStyle(o,n),o,n,p);if(Wx(w)&&(l=w),!t){const l=JM(o,n,f,p);b&&(t=p.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:s,height:a,lineWidth:f?.group?.lineWidth??void 0,fill:f?.group?.fill??void 0,stroke:f?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:f?.group?.strokeArrayColor??void 0,cursor:f?.group?.cursor??void 0,lineDash:f?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),t&&"cell"===t.role||((t=new $M({x:i,y:r,width:s,height:a,lineWidth:f?.group?.lineWidth??void 0,fill:f?.group?.fill??void 0,stroke:f?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:f?.group?.strokeArrayColor??void 0,cursor:f?.group?.cursor??void 0,lineDash:f?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}if(t.AABBBounds.width(),y&&Array.isArray(p.getCellValue(o,n))||!y){const e=new yH(m,{stroke:!1,x:l[3],y:l[0],canvas:p.canvas??p.scenegraph.stage.window.getContext().canvas,mode:p.options.mode,modeParams:p.options.modeParams,spec:p.options.specTransformInCell?p.options.specTransformInCell(d,o,n):d,ClassType:C,width:s-l[3]-l[1],height:a-l[2]-l[0],chartInstance:u,dataId:g,data:p.getCellValue(o,n)||[],cellPadding:l,dpr:p.internalProps.pixelRatio,axes:p.isPivotChart()?p.internalProps.layoutMap.getChartAxes(o,n):[],tableChartOption:p.options.chartOption,col:o,row:n});t.appendChild(e),p.internalProps.layoutMap.setChartInstance(o,n,e.chartInstance)}return t}class LD extends $M{_leftGroup;_rightGroup;_checkboxGroup;_autoWidth=!1;_autoHeight=!1;_cellWidth;_originCellWidth;_cellHeight;_align;_baseline;constructor(t){super(t),this._leftGroup=new $M({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new $M({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._checkboxGroup=new $M({pickable:!1,fill:!1,stroke:!1}),this._checkboxGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._checkboxGroup)}addLeftOccupyingIcon(t){t.setAttribute("x",this._leftGroup.width+(t.attribute.marginLeft??0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth((t.attribute.marginLeft??0)+(t.attribute.marginRight??0)+t.attribute.width)}addRightOccupyingIcon(t){t.setAttribute("x",this._rightGroup.width+(t.attribute.marginLeft??0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth((t.attribute.marginLeft??0)+(t.attribute.marginRight??0)+t.attribute.width)}addCheckbox(t){this._checkboxGroup.appendChild(t)}setCheckboxContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const i=this._checkboxGroup.width;this._cellWidth=t+e+i,this.setAttribute("width",this._cellWidth)}else{const i=this._cellWidth-t-e;this.updateCenterLayout(i);const r=this._checkboxGroup.width;this._cellWidth=t+e+r,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._checkboxGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._checkboxGroup.forEachChildren((t=>{t instanceof wx&&(e-=t.AABBBounds.width())}));const i=this._checkboxGroup.getChildByName("checkbox-content");i instanceof wx&&i.setAttribute("width",e);let r=0;this._checkboxGroup.forEachChildren((t=>{t.setAttribute("x",r),r+=t.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._checkboxGroup.setAttribute("x",4),"left"===this._align||"start"===this._align?this.setAttribute("dx",0):"center"===this._align?this.setAttribute("dx",-this.attribute.width/2):"right"!==this._align&&"end"!==this._align||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){"top"===this._baseline?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._checkboxGroup.setAttribute("y",0)):"middle"===this._baseline?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._checkboxGroup.setAttribute("y",this._cellHeight/2-this._checkboxGroup.height/2)):"bottom"===this._baseline&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._checkboxGroup.setAttribute("y",this._cellHeight-this._checkboxGroup.height))}}function ID(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y){if(!t){const s=JM(o,n,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:a,height:l,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new $M({x:i,y:r,width:a,height:l,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}let C;if(u){let t=o,e=n;m&&(t=m.start.col,e=m.start.row),C=g.getCellIcons(t,e)}let w=0,v=0,x=0,_=0,S=[];if(Array.isArray(C)&&0!==C.length){const{leftIconWidth:e,rightIconWidth:i,contentLeftIcons:r,contentRightIcons:o,absoluteLeftIconWidth:n,absoluteRightIconWidth:s}=sP(C,t,m,g);w=e+i,v=e,x=i,S=r,_=s,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-s-h[1])})),t.forEachChildren((t=>{"middle"===d?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const A=function(t,e,i,r,o,n,s,a,l,h){const c=l._getCellStyle(t,e),d=qM("size",c,t,e,l),u=qM("spaceBetweenTextAndIcon",c,t,e,l),g=qM("defaultFill",c,t,e,l),p=qM("defaultStroke",c,t,e,l),f=qM("disableFill",c,t,e,l),m=qM("checkedFill",c,t,e,l),b=qM("checkedStroke",c,t,e,l),y=qM("disableCheckedFill",c,t,e,l),C=qM("disableCheckedStroke",c,t,e,l),w=qM("checkIconImage",c,t,e,l),v=qM("indeterminateIconImage",c,t,e,l),x=l.getCellValue(t,e),_=l.getCellOriginValue(t,e);let S,A,T=x??"";Nx(x)?(S=x.checked,A=x.disable,T=x.text??""):"boolean"==typeof x&&(S=x,T="");if(l.internalProps.layoutMap.isSeriesNumber(t,e)){const i=l.getFieldData(a.field,t,e);i&&("string"==typeof i||("object"==typeof i?(S=i.checked,A=i.disable):"boolean"==typeof i&&(S=i)))}S=l.stateManager.syncCheckedState(t,e,a.field,S);const R=tP(t,e,l),B=l._getCellStyle(t,e),M=B.autoWrapText??l.internalProps.autoWrapText,{lineClamp:P}=B,{checked:H,disable:k}=a;if(null==S||"function"==typeof S){const i=AS(H,{col:t,row:e,table:l,context:null,value:x,dataValue:_});S=l.stateManager.syncCheckedState(t,e,a.field,i)}const E=AS(k,{col:t,row:e,table:l,context:null,value:x,dataValue:_}),F="auto"===i,L=l.isAutoRowHeight(e),I={text:1===T.length?T[0]:T,maxLineWidth:F?1/0:r-(n[1]+n[3]+R)-d-u,textAlign:"left",textBaseline:"top",autoWrapText:M,lineClamp:P,wordBreak:"break-word",heightLimit:L?-1:o-Math.floor(n[0]+n[2]),pickable:!1,dx:h?0:R,whiteSpace:1!==T.length||M?"normal":"no-wrap"},z=s.text?Object.assign({},s.text,I):I,O={x:0,y:0,text:z,icon:{width:Math.floor(d/1.4),height:Math.floor(d/1.4)},box:{width:d,height:d},dx:h?R:0,spaceBetweenTextAndIcon:u,disabled:A??E??!1};"indeterminate"===S?(O.checked=void 0,O.indeterminate=!0):(O.checked=S,O.indeterminate=void 0);g&&(O.box.fill=g),p&&(O.box.stroke=p),f&&(O.box.disableFill=f),m&&(O.box.checkedFill=m),b&&(O.box.checkedStroke=b),y&&(O.box.disableCheckedFill=y),C&&(O.box.disableCheckedStroke=C),w&&(O.icon.checkIconImage=w),v&&(O.icon.indeterminateIconImage=v);const D=new wx(O);return D.name="checkbox",D}(o,n,s-w,a,l,h,p,f,g,y);if(1!==S.length||S[0].name!==Lx.expandIconName&&S[0].name!==Lx.collapseIconName)A&&t.appendChild(A),A.render();else{const e=new LD({x:0,y:0,fill:!1,stroke:!1,pickable:!1});e.name="checkbox-content",e.setCheckboxContentOption({autoWidth:!1,autoHeight:!1,cellWidth:a-(h[1]+h[3]),cellHeight:l-h[0]-h[2],align:c,baseline:d});const i={addedHierarchyOffset:0};S.forEach((r=>{const o=iP(r,void 0,t.col,t.row,m,g,i);o.role="icon-content-left",o.name=r.name,e.addLeftOccupyingIcon(o)})),A&&e.addCheckbox(A),t.appendChild(e),e.layout(),e.AABBBounds.width(),e.AABBBounds.height();const r=a-(h[1]+h[3]),o=l-(h[0]+h[2]);t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+r-x+h[3]):"icon-absolute-right"===t.role?t.setAttribute("x",t.attribute.x+r-_+h[3]+h[1]):"content"!==t.name&&"checkbox-content"!==t.name||("center"===c&&"richtext"!==t.type?t.setAttribute("x",h[3]+v+(r-v-x)/2):"right"===c&&"richtext"!==t.type?t.setAttribute("x",h[3]+r-x):t.setAttribute("x",h[3]+v))})),t.forEachChildren((t=>{t.name!==DM&&("middle"===d?t?._checkboxGroup&&t._leftGroup.setAttribute("y",h[0]+(o-t._checkboxGroup.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",h[0]+o-t.AABBBounds.height()):t.setAttribute("y",h[0]))}))}return a-=h[1]+h[3]+w,l-=h[0]+h[2],"center"===c?A.setAttribute("x",h[3]+v+(a-A.AABBBounds.width())/2):"right"===c?A.setAttribute("x",h[3]+v+a-A.AABBBounds.width()):A.setAttribute("x",h[3]+v),"middle"===d?A.setAttribute("y",h[0]+(l-A.AABBBounds.height())/2):"bottom"===d?A.setAttribute("y",h[0]+l-A.AABBBounds.height()):A.setAttribute("y",h[0]),t}function zD(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f){if(!t){const s=JM(o,n,g,u);(t=new $M({x:i,y:r,width:a,height:l,lineWidth:g?.group?.lineWidth??void 0,fill:g?.group?.fill??void 0,stroke:g?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:g?.group?.strokeArrayColor??void 0,cursor:g?.group?.cursor??void 0,lineDash:g?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t)}const{width:m,height:b}=function(t,e,i,r,o,n,s,a,l,h,c){const d=c._getCellStyle(t,e);let u=qM("size",d,t,e,c),g=qM("innerRadius",d,t,e,c),p=qM("outerRadius",d,t,e,c);const f=qM("spaceBetweenTextAndIcon",d,t,e,c),m=qM("spaceBetweenRadio",d,t,e,c),b=qM("defaultFill",d,t,e,c),y=qM("defaultStroke",d,t,e,c),C=qM("disableFill",d,t,e,c),w=qM("checkedFill",d,t,e,c),v=qM("checkedStroke",d,t,e,c),x=qM("disableCheckedFill",d,t,e,c),_=qM("disableCheckedStroke",d,t,e,c);Xx(p)?u=2*p:p=Math.round(u/2);(!Xx(g)||g<0)&&(g=Math.round(p/7*3));const S=c.getCellValue(t,e),A=c.getCellOriginValue(t,e),T=tP(t,e,c),R=c._getCellStyle(t,e),B=R.autoWrapText??c.internalProps.autoWrapText,{lineClamp:M}=R,P="auto"===i,H=c.isAutoRowHeight(e),k={maxLineWidth:P?1/0:r-(n[1]+n[3]+T)-u-f,textAlign:"left",textBaseline:"top",autoWrapText:B,lineClamp:M,wordBreak:"break-word",heightLimit:H?-1:o-Math.floor(n[0]+n[2]),pickable:!1,dx:T},E=s.text?Object.assign({},s.text,k):k,F={x:0,y:0,text:E,circle:{innerRadius:g,outerRadius:p},spaceBetweenTextAndIcon:f};b&&(F.circle.fill=b),y&&(F.circle.stroke=y),C&&(F.circle.disableFill=C),w&&(F.circle.checkedFill=w),v&&(F.circle.checkedStroke=v),x&&(F.circle.disableCheckedFill=x),_&&(F.circle.disableCheckedStroke=_);let L=0,I=0;const z=a.radioDirectionInCell??"vertical";if(Ux(S))S.forEach(((i,r)=>{const o=OD(i,A,r,t,e,a,B,F,c);o&&l.appendChild(o),o.id=`radio-${h?.start.col??t}-${h?.start.row??e}-${r}`,o.render();const n=o.AABBBounds;"vertical"===z?(o.setAttribute("y",I),I+=n.height()+(r!==S.length-1?m:0),L=Math.max(L,n.width())):"horizontal"===z&&(o.setAttribute("x",L),L+=n.width()+(r!==S.length-1?m:0),I=Math.max(I,n.height()))}));else{const i=OD(S,A,void 0,t,e,a,B,F,c);i&&l.appendChild(i),i.id=`radio-${h?.start.col??t}-${h?.start.row??e}`,i.render();const r=i.AABBBounds;L=r.width(),I=r.height()}return{width:L,height:I}}(o,n,s,a,l,h,g,p,t,f,u);return a-=h[1]+h[3],l-=h[0]+h[2],t.forEachChildren((t=>{"center"===c?t.setAttribute("x",h[3]+t.attribute.x+(a-m)/2):"right"===c?t.setAttribute("x",h[3]+t.attribute.x+a-m):t.setAttribute("x",h[3]+t.attribute.x),"middle"===d?t.setAttribute("y",h[0]+t.attribute.y+(l-b)/2):"bottom"===d?t.setAttribute("y",h[0]+t.attribute.y+l-b):t.setAttribute("y",h[0]+t.attribute.y)})),t}function OD(t,e,i,r,o,n,s,a,l){const h=function(t,e,i,r,o,n,s){const a=n.radioCheckType??"column";let l,h;Nx(t)?l=t.checked:"boolean"==typeof t&&(l=t);l=s.stateManager.syncRadioState(r,o,n.field,a,i,l),(null==l||"function"==typeof l)&&(h=AS(n.checked,{col:r,row:o,table:s,context:null,value:t,dataValue:e}),l=s.stateManager.syncRadioState(r,o,n.field,a,i,h));return l??h??!1}(t,e,i,r,o,n,l),c=function(t,e,i,r,o,n){let s;Nx(t)&&(s=t.disable);const a=AS(o.disable,{col:i,row:r,table:n,context:null,value:t,dataValue:e});return s??a??!1}(t,e,r,o,n,l),d=Nx(t)?t.text:zx(t)?"":t??"",u=s_({},a,{checked:h,disabled:c,text:{text:1===d.length?d[0]:d,whiteSpace:1!==d.length||s?"normal":"no-wrap"},boundsPadding:0}),g=new vx(u);return g.name="radio",g}function DD(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b){if(!t){const s=JM(o,n,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:a,height:l,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new $M({x:i,y:r,width:a,height:l,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}let y;if(u){let t=o,e=n;m&&(t=m.start.col,e=m.start.row),y=g.getCellIcons(t,e)}let C=0,w=0;if(Array.isArray(y)&&0!==y.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:r,absoluteRightIconWidth:o}=sP(y,t,m,g);C=e+i,w=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-o-h[1])})),t.forEachChildren((t=>{"middle"===d?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const v=function(t,e,i,r,o,n,s,a,l){const h=l._getCellStyle(t,e),c=qM("spaceBetweenTextAndCircle",h,t,e,l),d=qM("circleRadius",h,t,e,l),u=qM("boxWidth",h,t,e,l),g=qM("boxHeight",h,t,e,l),p=qM("checkedFill",h,t,e,l),f=qM("uncheckedFill",h,t,e,l),m=qM("disableCheckedFill",h,t,e,l),b=qM("disableUncheckedFill",h,t,e,l),y=qM("circleFill",h,t,e,l),C=l.getCellValue(t,e),w=l.getCellOriginValue(t,e);let v,x,_=C??"";Nx(C)?(v=C.checked,x=C.disable,_=C.text??""):"boolean"==typeof C&&(v=C,_="");v=l.stateManager.syncCheckedState(t,e,a.field,v);const S=tP(t,e,l),A=l._getCellStyle(t,e),T=A.autoWrapText??l.internalProps.autoWrapText,{lineClamp:R}=A,{checked:B,disable:M,uncheckedText:P,checkedText:H}=a;if(null==v||"function"==typeof v){const i=AS(B,{col:t,row:e,table:l,context:null,value:C,dataValue:w});v=l.stateManager.syncCheckedState(t,e,a.field,i)}const k=AS(M,{col:t,row:e,table:l,context:null,value:C,dataValue:w}),E=AS(H,{col:t,row:e,table:l,context:null,value:C,dataValue:w}),F=AS(P,{col:t,row:e,table:l,context:null,value:C,dataValue:w}),L="auto"===i,I=l.isAutoRowHeight(e),z={text:1===_.length?_[0]:_,maxLineWidth:L?1/0:r-(n[1]+n[3]+S)-2*d-c,textAlign:"left",textBaseline:"top",autoWrapText:T,lineClamp:R,wordBreak:"break-word",heightLimit:I?-1:o-Math.floor(n[0]+n[2]),pickable:!1,dx:S,whiteSpace:1!==_.length||T?"normal":"no-wrap",checkedText:E,uncheckedText:F},O=s.text?Object.assign({},s.text,z):z,D={x:0,y:0,text:O,circle:{radius:d},box:{width:u,height:g},spaceBetweenTextAndCircle:c,disabled:x??k??!1};D.checked=v,f&&(D.box.uncheckedFill=f),b&&(D.box.disableUncheckedFill=b),p&&(D.box.checkedFill=p),m&&(D.box.disableCheckedFill=m),y&&(D.circle.fill=y);const W=new _x(D);return W.name="switch",W}(o,n,s-C,a,l,h,p,f,g);return v&&t.appendChild(v),v.render(),a-=h[1]+h[3]+C,l-=h[0]+h[2],"center"===c?v.setAttribute("x",h[3]+w+(a-v.AABBBounds.width())/2):"right"===c?v.setAttribute("x",h[3]+w+a-v.AABBBounds.width()):v.setAttribute("x",h[3]+w),"middle"===d?v.setAttribute("y",h[0]+(l-v.AABBBounds.height())/2):"bottom"===d?v.setAttribute("y",h[0]+l-v.AABBBounds.height()):v.setAttribute("y",h[0]),t}const WD=new class extends lO{constructor(t){super(!1),this.type=Gz.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},ND=new MO;function GD(t,e,i,r,o,n,s,a,l,h,c,d){if(!t){const l=JM(o,n,c,h);d&&(t=h.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:s,height:a,lineWidth:c?.group?.lineWidth??void 0,fill:c?.group?.fill??void 0,stroke:c?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:c?.group?.strokeArrayColor??void 0,cursor:c?.group?.cursor??void 0,lineDash:c?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:c.group.cornerRadius}),t&&"cell"===t.role||((t=new $M({x:i,y:r,width:s,height:a,lineWidth:c?.group?.lineWidth??void 0,fill:c?.group?.fill??void 0,stroke:c?.group?.stroke??void 0,strokeArrayWidth:l,strokeArrayColor:c?.group?.strokeArrayColor??void 0,cursor:c?.group?.cursor??void 0,lineDash:c?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:c.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}const u=function(t,e,i,r,o,n){let s,a;const l=n.internalProps.layoutMap.getBody(t,e).sparklineSpec,h=n.getCellValue(t,e);if(!Array.isArray(h))return;const c=o[3],d=o[0];i-=o[1]+o[3],r-=o[0]+o[2];const u=0,g=r;if("function"==typeof l){const o={col:t,row:e,dataValue:n.getCellOriginValue(t,e)||"",value:n.getCellValue(t,e)||"",rect:n.getCellRangeRelativeRect(n.getCellRange(t,e)),table:n};s=l(o),a=jD(s,c,d,i,r)}else s=l,a=jD(l,c,d,i,r);const p=[],f=[];let m,b;if("object"==typeof s.xField)WD.domain(s.xField.domain),m=s.xField.field;else if("string"==typeof s.xField){const t=h.map((t=>t[s.xField]));WD.domain(t),m=s.xField}else Array.isArray(h)&&(WD.domain(Array.from({length:h.length},((t,e)=>e))),m=s.xField);if(WD.range([0,i]),"object"==typeof s.yField)ND.domain(s.yField.domain),b=s.yField.field;else if("string"==typeof s.yField){const t=VD(h,s.yField);ND.domain([Math.min(...t),Math.max(...t)]),b=s.yField}else if(Array.isArray(h)){const t=VD(h);ND.domain([Math.min(...t),Math.max(...t)]),b=s.yField}if(ND.range([0,r]),"object"==typeof s.xField&&Array.isArray(s.xField.domain)){const t=h.map((t=>t[s.xField.field])),e=s.xField.domain;for(let i=0;i<e.length;i++){let r=!1;for(let o=0;o<t.length;o++)if(e[i]===t[o]){const t=h[o];if(!Wx(t[m])||!Wx(t[b]))break;p.push({x:u+WD.scale(t[m]),y:g-ND.scale(t[b]),defined:Wx(t[b])}),f.push(t),r=!0;break}r||(p.push({x:u+WD.scale(e[i]),y:0,defined:!1}),f.push({[m]:e[i],[b]:null}))}}else for(let t=0;t<h.length;t++){const e=h[t];p.push({x:u+WD.scale(m?e[m]:t),y:g-ND.scale(b?e[b]:e),defined:Wx(b?e[b]:e),rawData:e}),f.push(e)}const y=a.getChildByName("sparkline-line");y&&y.setAttribute("points",p);y.bandwidth=WD.step(),y.min=ND.range()[0],y.max=ND.range()[1];const C=a.getChildByName("sparkline-symbol-group");if(C){const t="isolatedPoint"===s.pointShowRule;if("all"===s.pointShowRule)for(let t=0;t<p.length;t++){const{x:e,y:i,defined:r}=p[t];if(r){const t=rh({x:e,y:i});C.appendChild(t)}}else if(t)for(let t=0;t<p.length;t++){const{x:e,y:i,defined:r}=p[t];if(r&&(!p[t-1]||!p[t-1].defined)&&(!p[t+1]||!p[t+1].defined)){const t=rh({x:e,y:i});C.appendChild(t)}}}return a}(o,n,s,a,l,h);return u&&t.appendChild(u),t}function jD(t,e,i,r,o){let n;n="function"==typeof t?t(null):t;const s=new $M({x:e,y:i,width:r,height:o,stroke:!1,fill:!1});if(s.name="sparkline","line"===n.type){const t=sh({x:0,y:0,curveType:n.smooth?"monotoneX":"linear",stroke:n.line?.style?.stroke??"blue",lineWidth:n.line?.style?.strokeWidth??2});t.name="sparkline-line",s.addChild(t),n.crosshair&&(t.hover=n.crosshair?.style??{stroke:"#000",interpolate:"linear"});const e=new $M({x:0,y:0,width:r,height:o,stroke:!1,fill:!1});e.name="sparkline-symbol-group",e.setTheme({symbol:{stroke:n.point?.style?.stroke??"#000",lineWidth:n.point?.style?.strokeWidth??1,fill:n.point?.style?.fill??"#000",size:2*(n.point?.style?.size??3),symbolType:"circle"}}),s.addChild(e),e.hover=n.point?.hover??!1}return s}function VD(t,e){const i=[];for(let r=0;r<t.length;r++){const o=t[r];Wx(e)&&Wx(o[e])?i.push(o[e]):!Wx(e)&&Wx(o)&&i.push(o)}return i}const UD=MM();function KD(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m){const b=ZM("padding",g._getCellStyle(r,o),r,o,g);g.options.customConfig?.imageMargin?h=pB(g.options.customConfig?.imageMargin):Wx(b)&&(h=b),p?.text?.textAlign&&(c=p?.text?.textAlign),p?.text?.textBaseline&&(d=p?.text?.textBaseline);const y=JM(r,o,p,g);let C,w;if(m&&(C=g.scenegraph.highPerformanceGetCell(r,o,!0),C&&"cell"===C.role&&C.setAttributes({x:e,y:i,width:n,height:s,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:y,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),C&&"cell"===C.role||(C=new $M({x:e,y:i,width:n,height:s,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:y,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),C.role="cell",C.col=r,C.row=o,t?.addCellGroup(C)),u){let t=r,e=o;f&&(t=f.start.col,e=f.start.row),w=g.getCellIcons(t,e)}let v=0,x=0;if(Array.isArray(w)&&0!==w.length){const{leftIconWidth:t,rightIconWidth:e,absoluteLeftIconWidth:i,absoluteRightIconWidth:r}=sP(w,C,f,g);v=t,x=e,C.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+n-e-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+n-r-h[1])})),C.forEachChildren((t=>{"middle"===d?t.setAttribute("y",(s-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",s-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])})),C._cellLeftIconWidth=v,C._cellRightIconWidth=x}const _=g.getCellValue(r,o),S=document.createElement("video");S.addEventListener("loadeddata",(()=>{l&&hP(r,o,S.videoWidth,S.videoHeight,g.scenegraph,h,C);const{width:t,height:e,isMerge:i}=dP(C,g);if(a){const{width:i,height:r}=XM(S.videoWidth,S.videoHeight,t-h[1]-h[3],e-h[0]-h[2]),o=YM(0,0,t,e,i,r,c,d,h);A.setAttributes({width:i,height:r,x:o.x,y:o.y,dx:0})}else A.setAttributes({x:h[3],y:h[0],width:t-h[1]-h[3],height:e-h[2]-h[0],dy:0});i&&uP(C.mergeStartCol,C.mergeEndCol,C.mergeStartRow,C.mergeEndRow,g);const{width:n,height:s}=dP(C,g),u=Math.floor(Math.min(n-h[1]-h[3],s-h[2]-h[0])/2),p=0+(n>A.attribute.width?A.attribute.x-0+A.attribute.width/2:n/2),f=0+(s>A.attribute.height?A.attribute.y-0+A.attribute.height/2:s/2),m=C.getChildByName("image",!0),{dx:b,dy:y}=m.attribute,w=new PM({x:p-u/2,y:f-u/2,width:u,height:u,image:UD.play.svg,cursor:UD.play.cursor,dx:b,dy:y});w.name="play-icon",C.appendChild(w),g.scenegraph.updateNextFrame()})),S.onerror=()=>{A.image=UD.damage_pic.svg},S.src=_,S.setAttribute("preload","auto");const A=fh({x:h[3],y:h[0],width:n-h[1]-h[3],height:s-h[2]-h[0],image:S,cursor:"pointer"});return A.name="image",A.keepAspectRatio=a,A.textAlign=c,A.textBaseline=d,C.appendChild(A),C}function $D(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b,y){const C=t._getCellStyle(n,s),w=ZM("padding",C,n,s,t);Wx(w)&&(c=w),m?.text?.textAlign&&(d=m?.text?.textAlign),m?.text?.textBaseline&&(u=m?.text?.textBaseline);const v=t.isAutoRowHeight(s),x="auto"===a,_=C.autoWrapText??t.internalProps.autoWrapText,S=C.lineClamp,A=JM(n,s,m,t);let T;if(y&&(T=t.scenegraph.getCell(n,s,!0),T&&"cell"===T.role&&T.setAttributes({x:r,y:o,width:l,height:h,lineWidth:m?.group?.lineWidth??void 0,fill:m?.group?.fill??void 0,stroke:m?.group?.stroke??void 0,strokeArrayWidth:A??void 0,strokeArrayColor:m?.group?.strokeArrayColor??void 0,cursor:m?.group?.cursor??void 0,lineDash:m?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius})),T&&"cell"===T.role||(T=new $M({x:r,y:o,width:l,height:h,lineWidth:m?.group?.lineWidth??void 0,fill:m?.group?.fill??void 0,stroke:m?.group?.stroke??void 0,strokeArrayWidth:A??void 0,strokeArrayColor:m?.group?.strokeArrayColor??void 0,cursor:m?.group?.cursor??void 0,lineDash:m?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius}),T.role="cell",T.col=n,T.row=s,i?.addCellGroup(T)),p&&T.appendChild(p),f){const i=e;let r;if(g){let e=n,i=s;b&&(e=b.start.col,i=b.start.row),r=t.getCellIcons(e,i)}!function(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p){let f,m=0,b=0,y=0;if(Array.isArray(e)&&0!==e.length){const{inlineFrontIcons:C,inlineEndIcons:w,contentLeftIcons:v,contentRightIcons:x,leftIconWidth:_,rightIconWidth:S,absoluteRightIconWidth:A}=sP(e,t,p,u);let T;if(m=_,b=S,y=A,0===C.length&&0===w.length){let e=0;Xx(u.theme._contentOffset)&&("left"===c?e=u.theme._contentOffset:"right"===c&&(e=-u.theme._contentOffset));const d=p?tP(p.start.col,p.start.row,u):tP(t.col,t.row,u),{text:f,moreThanMaxCharacters:y}=eP(i,u),C={text:1===f.length?f[0]:f,moreThanMaxCharacters:y,maxLineWidth:o?1/0:l-(r[1]+r[3])-m-b-d,textBaseline:"top",heightLimit:!1===u.options.customConfig?.limitContentHeight||n&&!u.options.customConfig?.multilinesForXTable?-1:h-Math.floor(r[0]+r[2]),pickable:!1,autoWrapText:s,lineClamp:a,wordBreak:"break-word",whiteSpace:!1===u.options.customConfig?.limitContentHeight||1!==f.length||s?"normal":"no-wrap",dx:("left"===c?v.length?0:d:0)+e,keepCenterInLine:!0},w=new ql(g.text?Object.assign({},g.text,C):C);w.name="text",T=w}else{const e=Object.assign({text:i?.toString()},t.parent?.theme?.userTheme?.text||{});g.text&&Object.assign(e,g.text),e.textBaseline="middle";const a=[...C.map((t=>rP(t))),e,...w.map((t=>rP(t)))];a[0].textAlign=c;const u=new vh({width:o?0:l-(r[1]+r[3])-m-b,height:n&&s?0:Math.ceil(h-(r[0]+r[2])),textConfig:a,verticalDirection:n&&s?"top":d,ellipsis:e.ellipsis});u.name="text",T=u,u.bindIconEvent(),!p||p.start.col===p.end.col&&p.start.row===p.end.row||(u.onBeforeAttributeUpdate=aP)}if(0!==v.length||0!==x.length){const e=new QM({x:0,y:0,fill:!1,stroke:!1,pickable:!1});e.name="content",e.setCellContentOption({autoWidth:o,autoHeight:n,cellWidth:l-(r[1]+r[3])-m-b,cellHeight:h-(r[0]+r[2]),align:c,baseline:d});const i={addedHierarchyOffset:0};v.forEach((r=>{const o=iP(r,void 0,t.col,t.row,p,u,i);o.role="icon-content-left",o.name=r.name,e.addLeftOccupyingIcon(o)})),x.forEach((r=>{const o=iP(r,void 0,t.col,t.row,p,u,i);o.role="icon-content-right",o.name=r.name,e.addRightOccupyingIcon(o)})),e.addContent(T),t.appendChild(e),e.layout(),f=e.AABBBounds.width(),e.AABBBounds.height()}else t.firstChild?t.insertBefore(T,t.firstChild):t.appendChild(T),f=T.AABBBounds.width(),T.AABBBounds.height()}else if(Wx(i)){const{text:e,moreThanMaxCharacters:m}=eP(i,u),b=p?tP(p.start.col,p.start.row,u):tP(t.col,t.row,u);let y=0;Xx(u.theme._contentOffset)&&("left"===c?y=u.theme._contentOffset:"right"===c&&(y=-u.theme._contentOffset));const C={text:1===e.length?e[0]:e,moreThanMaxCharacters:m,maxLineWidth:o?1/0:l-(r[1]+r[3]+b),textBaseline:"top",autoWrapText:s,lineClamp:a,wordBreak:"break-word",heightLimit:!1===u.options.customConfig?.limitContentHeight||n&&!u.options.customConfig?.multilinesForXTable?-1:h-Math.floor(r[0]+r[2]),pickable:!1,dx:("left"===c?b:0)+y,whiteSpace:!1===u.options.customConfig?.limitContentHeight||1!==e.length||s?"normal":"no-wrap",keepCenterInLine:!0},w=new ql(g.text?Object.assign({},g.text,C):C);w.name="text",w.textBaseline=d,t.appendChild(w),f=w.AABBBounds.width(),w.AABBBounds.height()}const C=o?m+f+b:l-(r[1]+r[3]),w=h-(r[0]+r[2]);t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+r[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+C-b+r[3]):"icon-absolute-right"===t.role?t.setAttribute("x",t.attribute.x+C-y+r[3]+r[1]):"content"!==t.name&&"text"!==t.name||("center"===c&&"richtext"!==t.type?t.setAttribute("x",r[3]+m+(C-m-b)/2):"right"===c&&"richtext"!==t.type?t.setAttribute("x",r[3]+C-b):t.setAttribute("x",r[3]+m))})),t.forEachChildren((t=>{t.name!==DM&&("middle"===d?t.setAttribute("y",r[0]+(w-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",r[0]+w-t.AABBBounds.height()):t.setAttribute("y",r[0]))})),t.setAttributes({width:C+r[1]+r[3],height:w+r[0]+r[2]})}(T,r,i,c,x,v,_,"number"==typeof S?S:void 0,T.attribute.width,T.attribute.height,d,u,t,m,b),m?._vtable?.marked&&function(t,e,i){if("boolean"==typeof t){const t=Bh({x:e.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});t.name="mark",e.appendChild(t)}else{const{bgColor:i="#3073F2",shape:r="sector",position:o="right-top",size:n=10,offset:s=0}=t;let a,l,h,c,d,u;if("sector"===r)"right-top"===o?(a=e.attribute.width-s,l=s,h=Math.PI/2,c=Math.PI):"left-top"===o?(a=s,l=s,h=0,c=Math.PI/2):"right-bottom"===o?(a=e.attribute.width-s,l=e.attribute.height-s,h=Math.PI,c=Math.PI/2*3):"left-bottom"===o&&(a=s,l=e.attribute.height-s,h=Math.PI/2*3,c=2*Math.PI),d=i,u=Bh({x:a,y:l,startAngle:h,endAngle:c,outerRadius:n,fill:d,pickable:!1});else if("triangle"===r){let t,r,h,c;"right-top"===o?(a=e.attribute.width-s,l=s,t=a-n,r=l,h=a,c=l+n):"left-top"===o?(a=s,l=s,t=a+n,r=l,h=a,c=l+n):"right-bottom"===o?(a=e.attribute.width-s,l=e.attribute.height-s,t=a-n,r=l,h=a,c=l-n):"left-bottom"===o&&(a=s,l=e.attribute.height-s,t=a+n,r=l,h=a,c=l-n),d=i,u=Hh({points:[{x:a,y:l},{x:t,y:r},{x:h,y:c}],fill:d,pickable:!1})}else"rect"===r&&("right-top"===o?(a=e.attribute.width-n-s,l=s):"left-top"===o?(a=s,l=s):"right-bottom"===o?(a=e.attribute.width-n-s,l=e.attribute.height-n-s):"left-bottom"===o&&(a=s,l=e.attribute.height-n-s),d=i,u=hh({x:a,y:l,width:n,height:n,fill:d,pickable:!1}));u.name="mark",e.appendChild(u)}}(m?._vtable?.marked,T)}return p&&T.setAttributes({width:Math.max(T.attribute.width,p.attribute.width??0),height:Math.max(T.attribute.height,p.attribute.height??0)}),T}function XD(t,e,i,r,o,n,s,a,l,h){if(t.dependField){const e=AS(t.dependField,{col:n,row:s,table:l,value:r,dataValue:o,cellHeaderPaths:void 0});o=l.getCellOriginRecord(n,s)?.[e]??o}const c=AS(t.barType,{col:n,row:s,table:l,value:r,dataValue:o,cellHeaderPaths:void 0})??"default",d=AS(t.min,{col:n,row:s,table:l,value:r,dataValue:o,cellHeaderPaths:void 0})??0,u=AS(t.max,{col:n,row:s,table:l,value:r,dataValue:o,cellHeaderPaths:void 0})??d+100;let g=0;g=h?l.getRowsHeight(h.start.row,h.end.row):l.getRowHeight(s);let p=i,f=g,m=0;Xx(l.theme._contentOffset)&&(m=l.theme._contentOffset);const b=new $M({x:-m,y:-m,width:p,height:f});b.name="progress-bar";const{showBar:y,barColor:C,barBgColor:w,barPositiveColor:v,barNegativeColor:x,barAxisColor:_,barRightToLeft:S,showBarMark:A,barMarkPositiveColor:T,barMarkNegativeColor:R,barMarkWidth:B,barMarkPosition:M,barMarkInBar:P}=e;let{barHeight:H,barBottom:k,barPadding:E}=e;1===E.length?E=[E[0],E[0],E[0],E[0]]:2===E.length?E=[E[0],E[1],E[0],E[1]]:3===E.length&&(E=[E[0],E[1],E[2],E[1]]),E=E.map(((t,e)=>{if("string"==typeof t&&FS.endsWith(t,"%")){const r=Number(t.substr(0,t.length-1));return 0===e||2===e?g*r/100:i*r/100}return Number(t)}));const F=pB(qM("borderLineWidth",e,n,s,l)),L=Math.max(E[0],Math.ceil(F[0]/2));let I=Math.max(E[1],Math.floor(F[1]/2));const z=Math.max(E[2],Math.floor(F[2]/2));let O=Math.max(E[3],Math.ceil(F[3]/2));A&&B>0&&"right"===M&&!1===P&&(I+=B,O+=B),p-=I+O,f-=z+L,s===l.rowCount-1&&[0,"0"].includes(k)&&(f-=1);const D=L,W=O,N=p;"string"==typeof H&&FS.endsWith(H,"%")?(H=Number(H.substr(0,H.length-1)),H=f*H/100):H=Number(H),"string"==typeof k&&FS.endsWith(k,"%")?(k=Number(k.substr(0,k.length-1)),k=f*k/100):k=Number(k);if(AS(y,{col:n,row:s,table:l,context:null,value:r,dataValue:o})){let t=`${o}`;FS.endsWith(t,"%")&&(t=t.substr(0,t.length-1));const e=Number(t);if(isNaN(e))return b;if("default"===(c??"default")){const t=e<d?0:e>u?1:(e-d)/(u-d),i=p,a=D+f-H-k;let h=Math.min(i*t,i);const c=S?W+N-h:W;n!==l.colCount-1||1!==t||S||(h-=1);const g=AS(w,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:t});if(g){const t=hh({x:c,y:a,width:i,height:H,fill:g});b.addChild(t)}const m=hh({x:c,y:a,width:h,height:H,fill:AS(C,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:t})||"#20a8d8"});b.addChild(m)}else if("negative"===c){const t=d<0?-d:0,i=u>0?u:0,a=t/(t+i),h=1-a,c=e>0?e/i:0,m=e<0?-e/t:0,y=p,C=D+f-H-k,E=W,F=AS(w,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:c});if(F){const t=hh({x:E,y:C,width:y,height:H,fill:F});b.addChild(t)}const L=S?h*y:a*y,I=Math.min(y*a*m,y),z=S?{left:E+L,top:C,width:I,height:H}:{left:E+L-I,top:C,width:I,height:H},O=AS(x,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:m})||"#20a8d8",N=hh({x:z.left,y:z.top,width:z.width,height:z.height,fill:O});b.addChild(N);let G=Math.min(y*h*c,y);n!==l.colCount-1||1!==c||S||(G-=1);const j=S?{left:E+L-G,top:C,width:G,height:H}:{left:E+L,top:C,width:G,height:H},V=AS(v,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:c})||"#20a8d8",U=hh({x:j.left,y:j.top,width:j.width,height:j.height,fill:V});b.addChild(U);const K=S?z.left:j.left,$=sh({x:0,y:0,stroke:AS(_,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:c}),lineWidth:1,lineDash:[2,2],points:[{x:K,y:0},{x:K,y:g}]});if(b.addChild($),A&&(c||m)){const t=B,e=[];let i;if(c>0)if(i=AS(T,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:c})||"#20a8d8","right"===M){const t=S?j.left+B/2:j.left+j.width+(P?-B/2:B/2);e.push({x:t,y:j.top}),e.push({x:t,y:j.top+j.height})}else"bottom"===M&&(e.push({x:j.left,y:j.top+j.height-B/2}),e.push({x:j.left+j.width,y:j.top+j.height-B/2}));else if(m>0)if(i=AS(R,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:m})||"#20a8d8","right"===M){const t=S?z.left+z.width-B/2:z.left+B/2;e.push({x:t,y:z.top}),e.push({x:t,y:z.top+z.height})}else"bottom"===M&&(e.push({x:z.left,y:z.top+z.height-B/2}),e.push({x:z.left+z.width,y:z.top+z.height-B/2}));const a=sh({x:0,y:0,stroke:i,lineWidth:t,points:e});b.addChild(a)}}else if("negative_no_axis"===c){const t=d<0?-d:0,i=u>0?u:0,a=Math.max(t,i),h=0===a?0:Math.abs(e)/a,c=p;let g=Math.min(c*h,c);n!==l.colCount-1||1!==h||S||(g-=1);const m=D+f-H-k,y=S?W+N-g:W,C=AS(w,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:h});if(C){const t=hh({x:y,y:m,width:c,height:H,fill:C});b.addChild(t)}const _={left:y,top:m,width:g,height:H};let P;P=e>=0?AS(v,{col:n,row:s,table:l,context:null,value:r,percentile:h,dataValue:o})||"#20a8d8":AS(x,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:h})||"#20a8d8";const E=hh({x:_.left,y:_.top,width:_.width,height:_.height,fill:P});if(b.addChild(E),A&&e){const t=B,i=[];let a;if(a=e>=0?AS(T,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:h})||"#20a8d8":AS(R,{col:n,row:s,table:l,context:null,value:r,dataValue:o,percentile:h})||"#20a8d8","right"===M){const t=S?_.left+B/2:_.left+_.width-B/2;i.push({x:t,y:_.top}),i.push({x:t,y:_.top+_.height})}else"bottom"===M&&(i.push({x:_.left,y:_.top+_.height-B/2}),i.push({x:_.left+_.width,y:_.top+_.height-B/2}));const c=sh({x:0,y:0,stroke:a,lineWidth:t,points:i});b.addChild(c)}}}return b}function YD(t,e,i,r,o,n){if(i?.zero&&(t=Math.min(t,0),e=Math.max(e,0)),i?.expand){const r=t,o=e;Wx(i.expand.min)&&(t=r-(o-r)*i.expand.min),Wx(i.expand.max)&&(e=o+(o-r)*i.expand.max)}let s,a;if(Xx(i?.min)&&(t=i.min),Xx(i?.max)&&(e=i.max),"log"===i?.type?(s=new EO,s.base(i?.base??10)):"symlog"===i?.type?(s=new FO,s.constant(i?.constant??10)):s=new MO,s.domain([t,e],!!i?.nice),n)!function(t,e){t.niceMax(e.targetTicks.length)}(s,n);else if(i?.nice){let t=i.tick?.forceTickCount??i.tick?.tickCount??10;Ox(t)&&(t=t({axisLength:o,labelStyle:i?.label?.style??{fontSize:xz}})),"accurateFirst"===i.niceType&&(t=Math.max(10,t)),Dx(i.min)&&Dx(i.max)?s.nice(t):Wx(i.min)&&Dx(i.max)?s.niceMax(t):Dx(i.min)&&Wx(i.max)&&s.niceMin(t)}return delete s._niceType,a=n?.targetTicks?.length??i?.tick?.forceTickCount?s.forceTicks(n?.targetTicks?.length??i?.tick?.forceTickCount):s.ticks(Xx(i?.tick?.tickCount)?i.tick.tickCount:5,{noDecimals:i?.tick?.noDecimals}),{range:s.domain(),ticks:a}}function qD(t,e,i,r,o,n,s,a,l,h,c,d,u,g,p,f,m,b){if(!t){const s=JM(o,n,p,g);b&&(t=g.scenegraph.highPerformanceGetCell(o,n,!0))&&"cell"===t.role&&t.setAttributes({x:i,y:r,width:a,height:l,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),t&&"cell"===t.role||((t=new $M({x:i,y:r,width:a,height:l,lineWidth:p?.group?.lineWidth??void 0,fill:p?.group?.fill??void 0,stroke:p?.group?.stroke??void 0,strokeArrayWidth:s,strokeArrayColor:p?.group?.strokeArrayColor??void 0,cursor:p?.group?.cursor??void 0,lineDash:p?.group?.lineDash??void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",t.col=o,t.row=n,e?.addCellGroup(t))}let y;if(u){let t=o,e=n;m&&(t=m.start.col,e=m.start.row),y=g.getCellIcons(t,e)}let C=0,w=0;if(Array.isArray(y)&&0!==y.length){const{leftIconWidth:e,rightIconWidth:i,absoluteLeftIconWidth:r,absoluteRightIconWidth:o}=sP(y,t,m,g);C=e+i,w=e,t.forEachChildren((t=>{"icon-left"===t.role?t.setAttribute("x",t.attribute.x+h[3]):"icon-right"===t.role?t.setAttribute("x",t.attribute.x+a-i-h[1]):"icon-absolute-right"===t.role&&t.setAttribute("x",t.attribute.x+a-o-h[1])})),t.forEachChildren((t=>{"middle"===d?t.setAttribute("y",(l-t.AABBBounds.height())/2):"bottom"===d?t.setAttribute("y",l-t.AABBBounds.height()-h[2]):t.setAttribute("y",h[0])}))}const v=function(t,e,i,r,o,n,s,a,l){const h=l._getCellStyle(t,e),c=qM("buttonColor",h,t,e,l),d=qM("buttonBorderColor",h,t,e,l),u=qM("buttonLineWidth",h,t,e,l),g=qM("buttonBorderRadius",h,t,e,l),p=qM("buttonHoverColor",h,t,e,l),f=qM("buttonHoverBorderColor",h,t,e,l),m=qM("buttonPadding",h,t,e,l),b=qM("buttonTextHoverColor",h,t,e,l),y=qM("buttonDisableColor",h,t,e,l),C=qM("buttonDisableBorderColor",h,t,e,l),w=qM("buttonTextDisableColor",h,t,e,l),v=l.getCellValue(t,e),x=l.getCellOriginValue(t,e),_=tP(t,e,l),S=l._getCellStyle(t,e),A=S.autoWrapText??l.internalProps.autoWrapText,{lineClamp:T}=S,R="auto"===i,B=l.isAutoRowHeight(e),{disable:M,text:P}=a,H=AS(M,{col:t,row:e,table:l,context:null,value:v,dataValue:x}),k=AS(P,{col:t,row:e,table:l,context:null,value:v,dataValue:x}),E=k??v??"",F={maxLineWidth:R?1/0:r-(n[1]+n[3]+_),textAlign:"left",textBaseline:"top",autoWrapText:A,lineClamp:T,wordBreak:"break-word",heightLimit:B?-1:o-Math.floor(n[0]+n[2]),pickable:!1,dx:_,whiteSpace:1!==E.length||A?"normal":"no-wrap"},L=s.text?Object.assign({},s.text,F):F,I={x:0,y:0,cursor:H?"not-allowed":"pointer",disable:H,childrenPickable:!1,text:1===E.length?E[0]:E,textStyle:L,padding:m,panel:{visible:!0,fill:H?y:c,stroke:H?C:d,lineWidth:u,cornerRadius:g},state:{text:{hover:{}},panel:{hover:{fill:p,stroke:f}}}};w&&(I.state.text.fill=w),b&&(I.state.text.hover.fill=b);const z=new My(I);z.name="button",H||(z.addEventListener("mouseenter",(()=>{z.addState("hover",!0,!1),z.stage.renderNextFrame()})),z.addEventListener("mouseleave",(()=>{z.removeState("hover",!1),z.stage.renderNextFrame()})));return z}(o,n,s-C,a,l,h,p,f,g);return v&&t.appendChild(v),a-=h[1]+h[3]+C,l-=h[0]+h[2],"center"===c?v.setAttribute("x",h[3]+w+(a-v.AABBBounds.width())/2):"right"===c?v.setAttribute("x",h[3]+w+a-v.AABBBounds.width()):v.setAttribute("x",h[3]+w),"middle"===d?v.setAttribute("y",h[0]+(l-v.AABBBounds.height())/2):"bottom"===d?v.setAttribute("y",h[0]+l-v.AABBBounds.height()):v.setAttribute("y",h[0]),t}const ZD=()=>{wA.registerFunction("createChartCellGroup",FD),wA.registerFunction("getAxisDomainRangeAndLabels",YD)},JD=()=>{wA.registerFunction("createCheckboxCellGroup",ID)},QD=()=>{wA.registerFunction("createImageCellGroup",lP)},tW=()=>{wA.registerFunction("createProgressBarCell",XD)},eW=()=>{wA.registerFunction("createRadioCellGroup",zD)},iW=()=>{wA.registerFunction("createSwitchCellGroup",DD)},rW=()=>{wA.registerFunction("createButtonCellGroup",qD)},oW=()=>{wA.registerFunction("createSparkLineCellGroup",GD)},nW=()=>{wA.registerFunction("createTextCellGroup",$D)},sW=()=>{wA.registerFunction("createVideoCellGroup",KD)};_D(),SD(),AD(),TD(),RD(),BD(),wA.registerComponent("listTreeStickCellPlugin",PD),wA.registerComponent("customCellStylePlugin",KL),MD(),ZD(),JD(),QD(),tW(),eW(),iW(),rW(),oW(),nW(),sW();nW();const aW={startInTotal:0,afterSpanLevel:0};class lW{sharedVar;colIndex=0;_showHeader=!0;rowDimensionTree;columnDimensionTree;rowTree;columnTree;cornerHeaderObjs;columnHeaderObjs=[];rowHeaderObjs=[];_cornerHeaderCellFullPathIds=[];_columnHeaderCellFullPathIds=[];_rowHeaderCellFullPathIds=[];_rowHeaderCellFullPathIds_FULL=[];_cornerHeaderCellIds=[];_columnHeaderCellIds=[];_rowHeaderCellIds=[];_rowHeaderCellIds_FULL=[];_columnWidths=[];_columnHeaderLevelCount;_rowHeaderLevelCount;rowsDefine;columnsDefine;indicatorsDefine;columnPaths=[];_headerObjects=[];_headerObjectMap={};_indicators=[];indicatorTitle;indicatorsAsCol=!0;hideIndicatorName=!1;_showRowHeader=!0;_showColumnHeader=!0;_rowHeaderTitle;_columnHeaderTitle;cornerSetting;_indicatorShowType="column";rowHierarchyType;columnHierarchyType;rowExpandLevel;columnExpandLevel;rowHierarchyIndent;rowHierarchyTextStartAlignment=!1;rowDimensionKeys=[];colDimensionKeys=[];indicatorKeys=[];indicatorDimensionKey=eA;_largeCellRangeCache;_CellHeaderPathMap;_table;extensionRows;_rowHeaderExtensionTree={};_extensionRowDimensionKeys=[];fullRowDimensionKeys=[];dataset;pagination;currentPageStartIndex;currentPageEndIndex;hasTwoIndicatorAxes;_chartItemSpanSize;_chartPaddingInner;_chartPaddingOuter;_chartItemBandSize;_chartPadding;rowSeriesNumberColumn;leftRowSeriesNumberColumn;leftRowSeriesNumberColumnCount=0;rightRowSeriesNumberColumn;rightRowSeriesNumberColumnCount=0;_useGetBodyCache=!1;_getBodyCache=new Map;_useHeaderPathCache=!1;_colHeaderPathCache=new Map;_rowHeaderPathCache=new Map;constructor(t,e,i,r){this.sharedVar=t.layoutNodeId,this._table=t,"tree"===t.options.rowHierarchyType&&(this.extensionRows=t.options.extensionRows),this.dataset=e,this._largeCellRangeCache=[],this._CellHeaderPathMap=new Map,this.rowTree=t.internalProps.rowTree,this.columnTree=t.internalProps.columnTree,this.rowsDefine=t.internalProps.rows??[],this.columnsDefine=t.internalProps.columns??[],this.indicatorsDefine=t.internalProps.indicators??[],this.indicatorTitle=t.options.indicatorTitle,this.indicatorsAsCol=t.options.indicatorsAsCol??!0,this.hideIndicatorName=t.options.hideIndicatorName??!1,this.showRowHeader=t.options.showRowHeader??!0,this.showColumnHeader=t.options.showColumnHeader??!0,this.rowHeaderTitle=t.options.rowHeaderTitle,this.columnHeaderTitle=t.options.columnHeaderTitle,this.rowHierarchyType=t.options.rowHierarchyType??"grid",this.columnHierarchyType=t.options.columnHierarchyType??"grid",this.rowExpandLevel=t.options.rowExpandLevel??1,this.columnExpandLevel=t.options.columnExpandLevel??1,this.rowHierarchyIndent=t.options.rowHierarchyIndent??20,this.rowHierarchyTextStartAlignment=t.options.rowHierarchyTextStartAlignment,this.cornerSetting=Object.assign({titleOnDimension:"column",forceShowHeader:!1},t.options.corner),this._table.options?.customConfig?.enablePivotPathCache&&(this._useHeaderPathCache=!0,this._colHeaderPathCache.clear(),this._rowHeaderPathCache.clear()),e&&(this.rowTree=e.rowHeaderTree,this.columnTree=e.colHeaderTree),this.indicatorsDefine?.forEach((t=>{"string"==typeof t?this.indicatorKeys.push(t):this.indicatorKeys.push(t.indicatorKey)})),this.columnDimensionTree=i,this.rowDimensionTree=r,this.colDimensionKeys=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.rowDimensionKeys=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),this.resetRowHeaderLevelCount(),this._table.isPivotChart()&&(this.hasTwoIndicatorAxes=this.indicatorsDefine.some((t=>{if(t.chartSpec&&t.chartSpec.series&&t.chartSpec.series.length>1){const e=t.chartSpec.axes??this._table.pivotChartAxes??[];if(!e.length||e.every((t=>t.orient!==(this.indicatorsAsCol?"top":"right")||!1!==t.visible)))return!0}return!1}))),this.resetColumnHeaderLevelCount(),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this._rowHeaderCellFullPathIds_FULL=iS(this._rowHeaderCellFullPathIds_FULL),"tree"===t.options.rowHierarchyType&&this.extensionRows?.length>=1&&(this.generateExtensionRowTree(),this.extensionRows.forEach((t=>{const e=[];t.rows.forEach((t=>{"string"==typeof t?e.push(t):e.push(t.dimensionKey)})),this._extensionRowDimensionKeys.push(e),this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(e)}))),this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);let o,n=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr();!this.dataset||this._table.isPivotChart()||0!==(this.dataset.records?.length??0)||this.dataset.customColTree||(n=this.columnsDefine.map((t=>"string"==typeof t?t:t.dimensionKey)),this.indicatorsAsCol&&n.push(this.indicatorDimensionKey)),n=this.columnHeaderTitle?[""].concat(n):n;let s=[];if("tree"===this.rowHierarchyType&&this.extensionRows?.length>=1){const t=[];t.push(this.rowDimensionKeys[0]),this._extensionRowDimensionKeys.forEach((e=>{t.push(e[0])})),s=this.extensionRows.reduce(((t,e)=>t.concat(e.rows)),[]),o=this.rowHeaderTitle?[""].concat(t):t}else o=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),!this.dataset||this._table.isPivotChart()||0!==(this.dataset.records?.length??0)||this.dataset.customRowTree||(o=this.rowsDefine.map((t=>"string"==typeof t?t:t.dimensionKey)),this.indicatorsAsCol||o.push(this.indicatorDimensionKey)),o=this.rowHeaderTitle?[""].concat(o):o;this.cornerHeaderObjs=this._addCornerHeaders(n,o,this.columnsDefine.concat(...this.rowsDefine,...s)),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this.indicatorsAsCol&&!this.hideIndicatorName?this._indicatorShowType="column":this.indicatorsAsCol||this.hideIndicatorName?this._indicatorShowType="none":this._indicatorShowType="row",this.generateCellIdsConsiderHideHeader(),this.setPagination(t.options.pagination),this._table.isPivotChart()&&(this._chartItemSpanSize=0,this._chartItemBandSize=0,this._indicators.find((t=>{t?.style?.padding&&(this._chartPadding=t.style.padding),t.chartSpec?.barWidth&&"number"==typeof t.chartSpec.barWidth&&(this._chartItemSpanSize=t.chartSpec?.barWidth);const e=t.chartSpec?.axes?.find((t=>"band"===t.type));return e?.bandSize&&(this._chartItemBandSize=e?.bandSize,this._chartPaddingInner=(Ux(e.paddingInner)?e.paddingInner[0]:e.paddingInner)??0,this._chartPaddingOuter=(Ux(e.paddingOuter)?e.paddingOuter[0]:e.paddingOuter)??0),this._chartItemSpanSize>0||(t.chartSpec.series?.find((t=>(t.barWidth&&"number"==typeof t.barWidth&&(this._chartItemSpanSize=t.barWidth),this._chartItemSpanSize>0))),!1)}))),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber),this.setColumnWidths()}handleRowSeriesNumber(t){t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map((t=>({id:"",title:t.title,define:t,cellType:t.cellType??"text",headerType:t.cellType&&"radio"!==t.cellType?t.cellType:"text",width:t.width,style:t.style,format:t.format,field:t.field,icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}))):this.rowSeriesNumberColumn=[{id:"",title:t.title,define:t,cellType:t.cellType??"text",headerType:t.cellType&&"radio"!==t.cellType?t.cellType:"text",style:t.style,width:t.width,format:t.format,field:"",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((t=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}_generateColHeaderIds(){if(this.columnDimensionTree.tree.children?.length>=1)if("grid-tree"===this.columnHierarchyType){const t=0;this._addHeadersForGridTreeMode(this._columnHeaderCellFullPathIds,t,this.columnDimensionTree.tree.children,[],this.columnDimensionTree.totalLevel,this._getColumnHeaderTreeExpandedMaxLevelCount(),!0,this.columnsDefine,this.columnHeaderObjs,!1)}else{let t=0;if(this.dataset&&!this._table.isPivotChart()&&0===(this.dataset.records?.length??0)&&!this.dataset.customColTree&&!this.dataset.customRowTree&&this.indicatorsAsCol&&this._getColumnHeaderTreeExpandedMaxLevelCount()<this.columnHeaderLevelCount){t=this.columnHeaderLevelCount-this._getColumnHeaderTreeExpandedMaxLevelCount();for(let e=0;e<t;e++)this._columnHeaderCellFullPathIds.unshift([])}this._addHeaders(this._columnHeaderCellFullPathIds,t,this.columnDimensionTree.tree.children,[],this.columnHeaderObjs)}if(this.columnHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const t=++this.sharedVar.seqId,e=Array(this.colCount-this.rowHeaderLevelCount-this.rightFrozenColCount).fill(t);this._columnHeaderCellFullPathIds.unshift(e);const i={id:t,title:"string"==typeof this.columnHeaderTitle.title?this.columnHeaderTitle.title:this.columnsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.columnHeaderTitle?.headerType??"text",style:this.columnHeaderTitle?.headerStyle,define:{id:t,disableHeaderHover:!!this.columnHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle?.disableHeaderSelect}};this.columnHeaderObjs.push(i),this._headerObjects[t]=i}}_generateRowHeaderIds(){if(this.rowDimensionTree.tree.children?.length>=1)if("tree"===this.rowHierarchyType)this._addHeadersForTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs);else if("grid-tree"===this.rowHierarchyType){const t=0;this._addHeadersForGridTreeMode(this._rowHeaderCellFullPathIds_FULL,t,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,this._getRowHeaderTreeExpandedMaxLevelCount(),!0,this.rowsDefine,this.rowHeaderObjs,!0)}else{let t=0;if(this.dataset&&!this._table.isPivotChart()&&0===(this.dataset.records?.length??0)&&!this.dataset.customColTree&&!this.dataset.customRowTree&&!this.indicatorsAsCol&&this._getRowHeaderTreeExpandedMaxLevelCount()<this.rowHeaderLevelCount){t=this.rowHeaderLevelCount-this._getRowHeaderTreeExpandedMaxLevelCount();for(let e=0;e<t;e++)this._rowHeaderCellFullPathIds_FULL.unshift([])}this._addHeaders(this._rowHeaderCellFullPathIds_FULL,t,this.rowDimensionTree.tree.children,[],this.rowHeaderObjs)}if(this.rowHeaderTitle){this.sharedVar.seqId=Math.max(this.sharedVar.seqId,this._headerObjects.length);const t=++this.sharedVar.seqId,e=Array(this._rowHeaderCellFullPathIds_FULL[0]?.length??this.rowDimensionTree.tree.size).fill(t);this._rowHeaderCellFullPathIds_FULL.unshift(e);const i={id:t,title:"string"==typeof this.rowHeaderTitle.title?this.rowHeaderTitle.title:this.rowsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.rowHeaderTitle?.headerType??"text",style:this.rowHeaderTitle?.headerStyle,define:{id:t,disableHeaderHover:!!this.rowHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.rowHeaderTitle?.disableHeaderSelect}};this.rowHeaderObjs.push(i),this._headerObjects[t]=i}}_getRowHeaderTreeExpandedMaxLevelCount(){return"tree"===this.rowHierarchyType?1:"grid-tree"===this.rowHierarchyType?"row"===this.cornerSetting.titleOnDimension?this.rowDimensionTree.totalLevel:this.indicatorsAsCol?this.rowDimensionTree.expandedMaxLevel:this.rowDimensionTree.expandedMaxLevel+1:this.rowDimensionTree.totalLevel}_getColumnHeaderTreeExpandedMaxLevelCount(){return"grid-tree"===this.columnHierarchyType?"column"===this.cornerSetting.titleOnDimension?this.columnDimensionTree.totalLevel:!1===this.indicatorsAsCol?this.columnDimensionTree.expandedMaxLevel:this.columnDimensionTree.expandedMaxLevel+1:this.columnDimensionTree.totalLevel}_addHeaders(t,e,i,r,o){const n=this;t[e]||function(e){const i=t[e]=[];if(0===n.colIndex)return i;const r=t[e-1];for(let t=0;t<r?.length;t++)i[t]=r[t]}(e);for(let n=0;n<i.length;n++){pL(i[n],t,o,r,e,this)}}_addHeadersForTreeMode(t,e,i,r,o,n,s,a){const l=this;t[e]||function(e){const i=t[e]=[];if(0===l.colIndex)return i;const r=t[e-1];for(let t=0;t<r?.length;t++)i[t]=r[t]}(e);for(let l=0;l<i.length;l++){mL(i[l],t,a,r,e,o,n,s,this)}}_addHeadersForGridTreeMode(t,e,i,r,o,n,s,a,l,h){const c=this;t[e]||function(e){const i=t[e]=[];if(0===c.colIndex)return i;const r=t[e-1];for(let t=0;t<r?.length;t++)i[t]=r[t]}(e);for(let c=0;c<i.length;c++){fL(i[c],t,l,r,e,o,n,s,a,h,this.indicatorsAsCol,this)}}_addCornerHeaders(t,e,i){this._cornerHeaderCellFullPathIds=[];const r=[],o="grid-tree"===this.columnHierarchyType&&this._getColumnHeaderTreeExpandedMaxLevelCount()||this.columnHeaderLevelCount,n="grid-tree"===this.rowHierarchyType&&this._getRowHeaderTreeExpandedMaxLevelCount()||this.rowHeaderLevelCount;if(0===o||0===n)return r;if("all"===this.cornerSetting.titleOnDimension)if(this.indicatorsAsCol){if(t)for(let e=0;e<o;e++){const o=t[e],s=++this.sharedVar.seqId,a=i.find((t=>"string"!=typeof t&&t.dimensionKey===o)),l={id:s,title:o===this.indicatorDimensionKey?this.indicatorTitle:a?a.title:"axis"===o?"":o,field:o,style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",showSort:a?.showSortInCorner,sort:a?.sort,define:{showSort:a?.showSortInCorner,sort:a?.sort,dimensionKey:o,id:s,value:o,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:a?.cornerDropDownMenu,headerIcon:a?.cornerHeaderIcon,pivotInfo:{value:a?.title??"",dimensionKey:o,isPivotCorner:!0},description:a?.cornerDescription};r[s]=l,this._headerObjects[s]=l,this._cornerHeaderCellFullPathIds[e]||(this._cornerHeaderCellFullPathIds[e]=[]);for(let t=0;t<n;t++)this._cornerHeaderCellFullPathIds[e][t]=s}if(e)for(let t=0;t<n;t++){const o=e[t],n=++this.sharedVar.seqId,s=i.find((t=>"string"!=typeof t&&t.dimensionKey===o)),a={id:n,title:o===this.indicatorDimensionKey?this.indicatorTitle:s?s.title:"axis"===o?"":o,field:o,style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",showSort:s?.showSortInCorner,sort:s?.sort,define:{showSort:s?.showSortInCorner,sort:s?.sort,dimensionKey:o,id:n,value:o,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:s?.cornerDropDownMenu,headerIcon:s?.cornerHeaderIcon,pivotInfo:{value:s?.title??"",dimensionKey:o,isPivotCorner:!0},description:s?.cornerDescription};r[n]=a,this._headerObjects[n]=a,this._cornerHeaderCellFullPathIds[this._cornerHeaderCellFullPathIds.length-1]||(this._cornerHeaderCellFullPathIds[this._cornerHeaderCellFullPathIds.length-1]=[]),this._cornerHeaderCellFullPathIds[this._cornerHeaderCellFullPathIds.length-1][t]=n}}else{if(e)for(let t=0;t<n;t++){const n=e[t],s=++this.sharedVar.seqId,a=i.find((t=>"string"!=typeof t&&t.dimensionKey===n)),l={id:s,title:n===this.indicatorDimensionKey?this.indicatorTitle:a?a.title:"axis"===n?"":n,field:n,style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",showSort:a?.showSortInCorner,sort:a?.sort,define:{showSort:a?.showSortInCorner,sort:a?.sort,dimensionKey:n,id:s,value:n,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:a?.cornerDropDownMenu,headerIcon:a?.cornerHeaderIcon,pivotInfo:{value:a?.title??"",dimensionKey:n,isPivotCorner:!0},description:a?.cornerDescription};r[s]=l,this._headerObjects[s]=l;for(let e=0;e<o;e++)this._cornerHeaderCellFullPathIds[e]||(this._cornerHeaderCellFullPathIds[e]=[]),this._cornerHeaderCellFullPathIds[e][t]=s}if(t)for(let e=0;e<o;e++){const o=t[e],n=++this.sharedVar.seqId,s=i.find((t=>"string"!=typeof t&&t.dimensionKey===o)),a={id:n,title:o===this.indicatorDimensionKey?this.indicatorTitle:s?s.title:"axis"===o?"":o,field:o,style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",showSort:s?.showSortInCorner,sort:s?.sort,define:{showSort:s?.showSortInCorner,sort:s?.sort,dimensionKey:o,id:n,value:o,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:s?.cornerDropDownMenu,headerIcon:s?.cornerHeaderIcon,pivotInfo:{value:s?.title??"",dimensionKey:o,isPivotCorner:!0},description:s?.cornerDescription};r[n]=a,this._headerObjects[n]=a,this._cornerHeaderCellFullPathIds[e][this._cornerHeaderCellFullPathIds[e].length-1]=n}}else if("row"===this.cornerSetting.titleOnDimension||"column"===this.cornerSetting.titleOnDimension){const o="row"===this.cornerSetting?.titleOnDimension?e:t;o&&o.forEach(((t,e)=>{const o=++this.sharedVar.seqId,n=i.find((e=>"string"!=typeof e&&e.dimensionKey===t)),s={id:o,title:t===this.indicatorDimensionKey?this.indicatorTitle:n?n.title:"axis"===t?"":t,field:t,style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",showSort:n?.showSortInCorner,sort:n?.sort,define:{showSort:n?.showSortInCorner,sort:n?.sort,dimensionKey:t,id:o,value:t,headerCustomRender:this.cornerSetting.customRender,headerCustomLayout:this.cornerSetting.customLayout,headerEditor:this.cornerSetting.headerEditor,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect},dropDownMenu:n?.cornerDropDownMenu,headerIcon:n?.cornerHeaderIcon,pivotInfo:{value:n?.title??"",dimensionKey:t,isPivotCorner:!0},description:n?.cornerDescription};if(r[o]=s,this._headerObjects[o]=s,"column"===this.cornerSetting.titleOnDimension){this._cornerHeaderCellFullPathIds[e]||(this._cornerHeaderCellFullPathIds[e]=[]);for(let t=0;t<this.rowHeaderLevelCount;t++)this._cornerHeaderCellFullPathIds[e][t]=o}else if("row"===this.cornerSetting.titleOnDimension)for(let t=0;t<this.columnHeaderLevelCount;t++)this._cornerHeaderCellFullPathIds[t]||(this._cornerHeaderCellFullPathIds[t]=[]),this._cornerHeaderCellFullPathIds[t][e]=o}))}else{const t=++this.sharedVar.seqId,e={id:t,title:"",field:"维度名称",style:this.cornerSetting.headerStyle,headerType:this.cornerSetting.headerType??"text",define:{dimensionKey:"维度名称",id:t,headerCustomRender:this.cornerSetting.customRender,headerCustomLayout:this.cornerSetting.customLayout,disableHeaderHover:!!this.cornerSetting.disableHeaderHover,disableHeaderSelect:!!this.cornerSetting.disableHeaderSelect}};r[t]=e,this._headerObjects[t]=e;for(let e=0;e<this.columnHeaderLevelCount;e++)for(let i=0;i<this.rowHeaderLevelCount;i++)this._cornerHeaderCellFullPathIds[e]||(this._cornerHeaderCellFullPathIds[e]=[]),this._cornerHeaderCellFullPathIds[e][i]=t}return r}generateExtensionRowTree(){this.extensionRows.forEach(((t,e)=>{const i=this._rowHeaderCellFullPathIds_FULL;this._rowHeaderCellFullPathIds_FULL=[],i.forEach(((e,i)=>{const r=e[e.length-1];let o,n;if(this.colIndex=0,"function"==typeof t.rowTree){const i=this.findFullCellIds(e);o=t.rowTree(i.map((t=>({dimensionKey:this._headerObjects[t].field,value:this._headerObjects[t].title}))))}else o=i_(t.rowTree);this._rowHeaderExtensionTree[r]?(this._rowHeaderExtensionTree[r].reset(this._rowHeaderExtensionTree[r].tree.children),n=this._rowHeaderExtensionTree[r]):(n=new dL(o??[],this.sharedVar,this.rowHierarchyType,void 0),this._rowHeaderExtensionTree[r]=n);const s=[];this._addHeadersForTreeMode(s,0,n.tree.children,[],n.totalLevel,!0,t.rows,this.rowHeaderObjs);for(let t=0;t<s[0].length;t++)this._rowHeaderCellFullPathIds_FULL.push(e.concat(s[0][t]))}))}))}setColumnWidths(){const t=new Array(this.colCount).fill(void 0);if(this.leftRowSeriesNumberColumnCount&&(t[0]=this.leftRowSeriesNumberColumn[0]),this.showHeader&&this.showRowHeader)if(this.rowHeaderTitle&&(t[0+this.leftRowSeriesNumberColumnCount]={}),"tree"===this.rowHierarchyType){const e=this.rowDimensionKeys[0];if(e){const i=this.rowsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===e));i&&(t[0+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:i.width,minWidth:i.minWidth,maxWidth:i.maxWidth})}this._extensionRowDimensionKeys?.forEach(((e,i)=>{const r=e[0];if(r){const e=this.extensionRows[i].rows?.find((t=>"string"!=typeof t&&t.dimensionKey===r));e&&(t[i+1+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth})}}))}else{(this.rowDimensionTree.totalLevel>0?this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr():this.rowsDefine.map((t=>"string"==typeof t?t:t.dimensionKey))).forEach(((e,i)=>{const r=this.rowsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===e));r&&(t[i+(this.rowHeaderTitle?1:0)+this.leftRowSeriesNumberColumnCount]={width:r.width,minWidth:r.minWidth,maxWidth:r.maxWidth})}))}if(this.indicatorsAsCol)for(let e=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;e<this.colCount;e++){const i=this.getBody(e,this.columnHeaderLevelCount);t[e]={width:i?.width,minWidth:i?.minWidth,maxWidth:i?.maxWidth}}else{let e,i,r,o=0;this._indicators?.forEach(((t,n)=>{"number"==typeof t.width?o=Math.max(t.width,o):"auto"===t.width&&(r=!0),"number"==typeof t.minWidth&&(i=Math.max(t.minWidth,i??0)),"number"==typeof t.maxWidth&&(e=Math.min(t.maxWidth,e??Number.MAX_VALUE))})),o=o>0?o:r?"auto":void 0,t.fill({width:o,minWidth:i,maxWidth:e},this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount,this.colCount-this.rightFrozenColCount)}this._columnWidths=t}get columnWidths(){return this._columnWidths}getColumnWidthDefined(t){return this._columnWidths[t]}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}get showColumnHeader(){return this._showColumnHeader}set showColumnHeader(t){this._showColumnHeader=t}get showRowHeader(){return this._showRowHeader}set showRowHeader(t){this._showRowHeader=t}get columnHeaderTitle(){return this._columnHeaderTitle}set columnHeaderTitle(t){this._columnHeaderTitle=t}get rowHeaderTitle(){return this._rowHeaderTitle}set rowHeaderTitle(t){this._rowHeaderTitle=t}getHeaderFieldKey(t,e){}getCellLocation(t,e){return this.isCornerHeader(t,e)?"cornerHeader":this.isColumnHeader(t,e)?"columnHeader":this.isRowHeader(t,e)?"rowHeader":"body"}isHeader(t,e){return t>=this.leftRowSeriesNumberColumnCount&&t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount||(e>=0&&e<this.columnHeaderLevelCount||(t>=this.colCount-this.rightHeaderColCount||e>=this.rowCount-this.bottomHeaderRowCount))}isCornerHeader(t,e){return t>=0&&t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&e>=0&&e<this.columnHeaderLevelCount}isColumnHeader(t,e){return t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&e>=0&&e<this.columnHeaderLevelCount}isRowHeader(t,e){return t>=this.leftRowSeriesNumberColumnCount&&t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount&&e>=this.columnHeaderLevelCount}isFrozen(t,e){return this.isFrozenColumn(t)||this.isRightFrozenColumn(t)||this.isBottomFrozenRow(e)||this.isFrozenRow(e)||this.isSeriesNumberInBody(t,e)||this.isSeriesNumberInHeader(t,e)}isFrozenColumn(t,e){if(Wx(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(Wx(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(Wx(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(Wx(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=0&&e<this.frozenRowCount}isLeftBottomCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.frozenRowCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}getColumnHeaderRange(){return{start:{col:this.rowHeaderLevelCount,row:0},end:{col:this.colCount-1,row:this.columnHeaderLevelCount-1}}}getRowHeaderRange(){return{start:{col:0,row:this.columnHeaderLevelCount},end:{col:this.rowHeaderLevelCount-1,row:this.rowCount-1}}}getCornerHeaderRange(){return{start:{col:0,row:0},end:{col:this.rowHeaderLevelCount-1,row:this.columnHeaderLevelCount-1}}}getBodyRange(){return{start:{col:this.rowHeaderLevelCount,row:this.columnHeaderLevelCount},end:{col:this.colCount-1,row:this.rowCount-1}}}resetCellIds(){}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get headerLevelCount(){return this.columnHeaderLevelCount}resetColumnHeaderLevelCount(){if(this.showHeader&&this.showColumnHeader){if(this._table.isPivotChart()&&this.indicatorsAsCol&&!this.dataset?.colKeys?.length&&0===this.columnDimensionTree?.tree?.level&&!this.hasTwoIndicatorAxes)return void(this.columnHeaderLevelCount=0);let t=this._getColumnHeaderTreeExpandedMaxLevelCount();return this.indicatorsAsCol&&this.hideIndicatorName&&this.colDimensionKeys[this.colDimensionKeys.length-1]===this.indicatorDimensionKey&&t--,0===t&&this.dataset&&!this.dataset.customColTree?.length?"row"!==this.cornerSetting.titleOnDimension&&"all"!==this.cornerSetting.titleOnDimension||!this.cornerSetting.forceShowHeader?this._table.isPivotChart()||0!==(this.dataset.records?.length??0)||"column"!==this.cornerSetting.titleOnDimension&&"all"!==this.cornerSetting.titleOnDimension||(t=this.columnsDefine.length??0):t=1:!this.dataset||this._table.isPivotChart()||0!==(this.dataset.records?.length??0)||this.dataset.customColTree||"column"!==this.cornerSetting.titleOnDimension&&"all"!==this.cornerSetting.titleOnDimension||(t=this.columnsDefine.length??0,!this.hideIndicatorName&&this.indicatorsAsCol&&t++),this.columnHeaderTitle&&(t+=1),this._table.isPivotChart()&&this.indicatorsAsCol&&!this.hasTwoIndicatorAxes&&Rz(this.indicatorsDefine)&&(t-=1),void(this.columnHeaderLevelCount=t)}this.columnHeaderLevelCount=this.indicatorsAsCol?this.hideIndicatorName?0:1:0}resetRowHeaderLevelCount(){if(this.showHeader&&this.showRowHeader){if("tree"===this.rowHierarchyType){const t=this.extensionRows?.length??0;return this.rowHeaderTitle?void(this.rowHeaderLevelCount=1+(this.rowDimensionTree.totalLevel?1:0)+t):void(this.rowHeaderLevelCount=(this.rowDimensionTree.totalLevel?1:0)+t)}const t=this._getRowHeaderTreeExpandedMaxLevelCount();let e=t;return 0===e&&this.dataset&&!this.dataset.customRowTree?.length?"column"!==this.cornerSetting.titleOnDimension&&"all"!==this.cornerSetting.titleOnDimension||!this.cornerSetting.forceShowHeader?this._table.isPivotChart()||0!==(this.dataset.records?.length??0)||"row"!==this.cornerSetting.titleOnDimension&&"all"!==this.cornerSetting.titleOnDimension||(e=this.rowsDefine.length??0):e=1:!this.dataset||this._table.isPivotChart()||0!==(this.dataset.records?.length??0)||this.dataset.customRowTree||"row"!==this.cornerSetting.titleOnDimension&&"all"!==this.cornerSetting.titleOnDimension||(e=this.rowsDefine.length,this.hideIndicatorName||this.indicatorsAsCol||e++),!this.indicatorsAsCol&&this.hideIndicatorName&&this.rowDimensionKeys[this.rowDimensionKeys.length-1]===this.indicatorDimensionKey&&(e=t-1),this.rowHeaderTitle&&(e+=1),void(this.rowHeaderLevelCount=e)}this.rowHeaderLevelCount=this.indicatorsAsCol||this.hideIndicatorName?0:1}get columnHeaderLevelCount(){return this._columnHeaderLevelCount}set columnHeaderLevelCount(t){this._columnHeaderLevelCount=t}get rowHeaderLevelCount(){return this._rowHeaderLevelCount}set rowHeaderLevelCount(t){this._rowHeaderLevelCount=t}get colCount(){let t;return t=this._getColumnHeaderTreeExpandedMaxLevelCount()>0||this._table.isPivotChart()||this.dataset.records?.length>0||this.dataset.records&&!Array.isArray(this.dataset.records)?(this._columnHeaderCellIds[0]?.length??this.columnDimensionTree.tree.size)||(this._indicators?.length>0?1:0):0,t+this.rowHeaderLevelCount+this.rightHeaderColCount+this.leftRowSeriesNumberColumnCount}get rowCount(){return((this._table.records||this.dataset.records)&&(!Array.isArray(this._table.records)||this._table.records.length>0)&&this._indicators?.length>0&&!this._rowHeaderCellIds?.length?1:this._rowHeaderCellIds?.length??0)+this.columnHeaderLevelCount+this.bottomHeaderRowCount}get bodyRowSpanCount(){return this.rowDimensionTree.tree.size}get bottomFrozenRowCount(){if(!this._table.isPivotChart())return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0;if(this.indicatorKeys.length>=1&&Rz(this.indicatorsDefine)){const t=this._table.pivotChartAxes.find((t=>"bottom"===t.orient));return!1===t?.visible?0:(this.indicatorsAsCol,1)}return 0}get rightFrozenColCount(){if(!this._table.isPivotChart())return this._table.internalProps.rightFrozenColCount?this.colCount-this.rowHeaderLevelCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:this.colCount-this.rowHeaderLevelCount:0;const t=this._table.pivotChartAxes.find((t=>"right"===t.orient));return!1===t?.visible||this.indicatorsAsCol?0:this.hasTwoIndicatorAxes?1:0}get bodyRowCount(){return this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount}get headerObjects(){return this._headerObjects}get columnObjects(){return this._indicators}getCellId(t,e){if(e>=0&&t>=0){if(this.isSeriesNumber(t,e))return"";if(this.isCornerHeader(t,e))return this._cornerHeaderCellIds[e]?.[t-this.leftRowSeriesNumberColumnCount];if(this.isColumnHeader(t,e))return this._columnHeaderCellIds[e]?.[t-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount];if(this.isRowHeader(t,e))return this._rowHeaderCellIds[e-this.columnHeaderLevelCount]?.[t-this.leftRowSeriesNumberColumnCount];if(this.isRightFrozenColumn(t,e))return this._rowHeaderCellIds[e-this.columnHeaderLevelCount]?.[this.rowHeaderLevelCount-1];if(this.isBottomFrozenRow(t,e))return this._columnHeaderCellIds[this.columnHeaderLevelCount-1]?.[t-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount]}}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]??{id:void 0,field:"",headerType:"text",define:void 0}}getHeaderField(t,e){const i=this.getCellId(t,e);return this._headerObjectMap[i]?.field||this.getBody(t,e)?.field}getHeaderCellAdressById(t){for(let e=0;e<this._columnHeaderCellIds.length;e++){const i=this._columnHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r+this._table.frozenColCount,row:e}}for(let e=0;e<this._rowHeaderCellIds.length;e++){const i=this._rowHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r,row:e+this._table.frozenRowCount}}for(let e=0;e<this._cornerHeaderCellIds.length;e++){const i=this._cornerHeaderCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return{col:r,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((e=>e&&e.field===t));return e&&this.getHeaderCellAdressById(e.id)}getBody(t,e){const i=this.getBodyWidthCache(t,e);if(i)return i;if(this.isSeriesNumber(t,e)){const i=this.getSeriesNumberBody(t,e);return this.setBodyWidthCache(t,e,i),i}const r=this.getCellHeaderPaths(t,e);if(this.indicatorsAsCol){const i=r.colHeaderPaths?.find((t=>t.indicatorKey))?.indicatorKey,o=Wx(i)?this._indicators?.find((t=>t.indicatorKey===i))??this._indicators[0]??{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0}:{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0};return this.setBodyWidthCache(t,e,o),o}const o=r.rowHeaderPaths?.find((t=>t.indicatorKey))?.indicatorKey,n=Wx(o)?this._indicators?.find((t=>t.indicatorKey===o))??this._indicators[0]??{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0}:{id:"",field:void 0,indicatorKey:void 0,cellType:"text",define:void 0};return this.setBodyWidthCache(t,e,n),n}getCellRange(t,e){const i={start:{col:t,row:e},end:{col:t,row:e}};if(!this.isHeader(t,e)||-1===t||-1===e)return i;if(this.isRightFrozenColumn(t,e)||this.isBottomFrozenRow(t,e))return i;if(this._table.isPivotChart()){if(this.isLeftBottomCorner(t,e))return{start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.frozenColCount-1,row:this.rowCount-1}};if(this.isRightTopCorner(t,e))return{start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}};if(this.isRightBottomCorner(t,e))return{start:{col:this.colCount-this.rightFrozenColCount,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}}}for(let i=0;i<this._largeCellRangeCache.length;i++){const r=this._largeCellRangeCache[i];if(t>=r.start.col&&t<=r.end.col&&e>=r.start.row&&e<=r.end.row)return r}if(this.isHeader(t,e)&&-1!==t&&-1!==e){const r=this.getCellId(t,e);for(let o=t-1;o>=0&&r===this.getCellId(o,e);o--)i.start.col=o;for(let o=t+1;o<(this.colCount??0)&&r===this.getCellId(o,e);o++)i.end.col=o;for(let o=e-1;o>=0&&r===this.getCellId(t,o);o--)i.start.row=o;for(let o=e+1;o<(this.rowCount??0)&&!(r!==this.getCellId(t,o)||this.isSeriesNumberInHeader(t,e)&&o>=this.columnHeaderLevelCount);o++)i.end.row=o}return(i.end.col-i.start.col>100||i.end.row-i.start.row>100)&&this._largeCellRangeCache.push(i),i}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),n=this.getCellRange(i,r);return o.start.col===n.start.col&&o.end.col===n.end.col&&o.start.row===n.start.row&&o.end.row===n.end.row}getBodyIndexByRow(t){return t<this.columnHeaderLevelCount||t>=this.rowCount-this.bottomHeaderRowCount?-1:t-this.columnHeaderLevelCount}get bottomHeaderRowCount(){return this._table.isPivotChart()?this.bottomFrozenRowCount:0}get rightHeaderColCount(){return this._table.isPivotChart()?this.rightFrozenColCount:0}getBodyIndexByCol(t){return t<this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount||t>=this.colCount-this.rightHeaderColCount?-1:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount}getRecordStartRowByRecordIndex(t){return this.columnHeaderLevelCount+t}getRecordShowIndexByCell(t,e){}getCellHeaderPathsWithTreeNode(t,e){for(let i=0;i<this._largeCellRangeCache.length;i++){const r=this._largeCellRangeCache[i];if(t>=r.start.col&&t<=r.end.col&&e>=r.start.row&&e<=r.end.row)break}let i=this.getColHeaderPathCache(t,e),r=this.getRowHeaderPathCache(t,e);const o=this.getBodyIndexByCol(t),n=this.getBodyIndexByRow(e)+this.currentPageStartIndex;if(!i&&e>=0&&o>=0){if(i=[],"grid-tree"===this.columnHierarchyType){const t=[];this._columnHeaderCellFullPathIds.map((e=>{t.push(e[o])}));const e=this.getTreePathByCellIds(t);i.push(...e)}else i=this.columnDimensionTree.getTreePath(o,this.showHeader&&this.showColumnHeader?e-(this.columnHeaderTitle?1:0):this.columnDimensionTree.totalLevel);this.setColHeaderPathCache(t,e,i)}if(!r&&t>=0&&n>=0){if(r=[],"tree"===this.rowHierarchyType){const t=this._rowHeaderCellFullPathIds[n];let e=this.rowDimensionTree,i=0;for(;e&&t;){const o=[];let n=t[i];for(o.push(n);;){const t=this._headerObjectMap[n];if(!t?.parentCellId)break;o.unshift(t.parentCellId),n=t.parentCellId}const s=this.getTreePathByCellIds(o);r.push(...s),e=this._rowHeaderExtensionTree[t[i]],i++}}else if("grid-tree"===this.rowHierarchyType){const t=this._rowHeaderCellFullPathIds[n],e=this.getTreePathByCellIds(t);r.push(...e)}else r=this.rowDimensionTree.getTreePath(n,this.showHeader&&this.showRowHeader?t-(this.rowHeaderTitle?1:0)-this.leftRowSeriesNumberColumnCount:this.rowDimensionTree.totalLevel);this.setRowHeaderPathCache(t,e,r)}return{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(t,e)}}getTreePathByCellIds(t){const e=[];for(let i=0;i<t.length;i++){const r=t[i];if(i>0&&r===t[i-1])continue;const o=this._headerObjects[r];o?.define&&e.push(o.define)}return e}getCellHeaderPaths(t,e){const i=this.getCellHeaderPathsWithTreeNode(t,e),r={colHeaderPaths:[],rowHeaderPaths:[],cellLocation:i.cellLocation};return i.colHeaderPaths?.forEach((t=>{const e={};e.dimensionKey=t.dimensionKey,e.indicatorKey=t.indicatorKey,e.value=t.value??this.getIndicatorInfoByIndicatorKey(t.indicatorKey)?.title??"",e.virtual=t.virtual,e.role=t.role,r.colHeaderPaths.push(e)})),i.rowHeaderPaths?.forEach((t=>{if("axis"!==t.dimensionKey){const e={};e.dimensionKey=t.dimensionKey,e.indicatorKey=t.indicatorKey,e.value=t.value??this.getIndicatorInfoByIndicatorKey(t.indicatorKey)?.title??"",e.virtual=t.virtual,e.role=t.role,r.rowHeaderPaths.push(e)}})),r}getIndicatorInfoByIndicatorKey(t){const e=this.indicatorsDefine?.find((e=>"string"!=typeof e&&(!!t&&e.indicatorKey===t)));return e}findFullCellIds(t){const e=[];for(let i=0;i<t.length;i++){let r=t[i];for(e.push(r);;){const t=this._headerObjectMap[r];if(!t?.parentCellId)break;e.unshift(t.parentCellId),r=t.parentCellId}}return e}getHeaderDimension(t,e){if(this.isHeader(t,e)){const i=this.getHeader(t,e);return this.rowsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===i.field))??this.columnsDefine?.find((t=>"string"!=typeof t&&t.dimensionKey===i.field))}}isColumnIndicatorHeader(t,e){return"column"===this._indicatorShowType&&e===this.columnHeaderLevelCount-1&&t>=this.rowHeaderLevelCount}isRowIndicatorHeader(t,e){return"row"===this._indicatorShowType&&t===this.rowHeaderLevelCount-1&&e>=this.columnHeaderLevelCount}isIndicatorHeader(t,e){return this.isColumnIndicatorHeader(t,e)||this.isRowIndicatorHeader(t,e)}_rebuildRowLayout(){if(this.rowDimensionTree.reset(this.rowDimensionTree.tree.children),this.resetRowHeaderLevelCount(),this._rowHeaderCellFullPathIds_FULL=[],this.rowDimensionKeys=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.fullRowDimensionKeys=[...this.rowDimensionKeys],"tree"===this.rowHierarchyType?this._addHeadersForTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs):"grid-tree"===this.rowHierarchyType&&(this._addHeadersForGridTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,this._getRowHeaderTreeExpandedMaxLevelCount(),!0,this.rowsDefine,this.rowHeaderObjs,!0),this.cornerHeaderObjs=this._addCornerHeaders(this.colDimensionKeys,this.rowDimensionKeys,this.columnsDefine.concat(...this.rowsDefine))),this.rowHeaderTitle){const t=++this.sharedVar.seqId,e=Array(this.rowCount-this.columnHeaderLevelCount).fill(t);this._rowHeaderCellFullPathIds_FULL.unshift(e);const i={id:t,title:"string"==typeof this.rowHeaderTitle.title?this.rowHeaderTitle.title:this.rowsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.rowHeaderTitle?.headerType??"text",style:this.rowHeaderTitle?.headerStyle,define:{field:"",headerType:"text",cellType:"text",disableHeaderHover:!!this.rowHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.rowHeaderTitle?.disableHeaderSelect}};this.rowHeaderObjs.push(i),this._headerObjects[t]=i}this._rowHeaderCellFullPathIds_FULL=iS(this._rowHeaderCellFullPathIds_FULL),"tree"===this.rowHierarchyType&&this.extensionRows?.length>=1&&this.generateExtensionRowTree(),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,this.generateCellIdsConsiderHideHeader(),this.setPagination(this.pagination),"grid-tree"===this.rowHierarchyType&&this.setColumnWidths()}_rebuildColumnLayout(){if(this.columnDimensionTree.reset(this.columnDimensionTree.tree.children),this.resetColumnHeaderLevelCount(),this._columnHeaderCellFullPathIds=[],this.colDimensionKeys=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr(),"grid-tree"===this.columnHierarchyType&&(this._addHeadersForGridTreeMode(this._columnHeaderCellFullPathIds,0,this.columnDimensionTree.tree.children,[],this.columnDimensionTree.totalLevel,this._getColumnHeaderTreeExpandedMaxLevelCount(),!0,this.columnsDefine,this.columnHeaderObjs,!1),this.cornerHeaderObjs=this._addCornerHeaders(this.colDimensionKeys,this.rowDimensionKeys,this.columnsDefine.concat(...this.rowsDefine))),this.columnHeaderTitle){const t=++this.sharedVar.seqId,e=Array(this.colCount-this.rowHeaderLevelCount-this.rightFrozenColCount).fill(t);this._columnHeaderCellFullPathIds.unshift(e);const i={id:t,title:"string"==typeof this.columnHeaderTitle.title?this.columnHeaderTitle.title:this.columnsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.columnHeaderTitle?.headerType??"text",style:this.columnHeaderTitle?.headerStyle,define:{id:t,disableHeaderHover:!!this.columnHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle?.disableHeaderSelect}};this.columnHeaderObjs.push(i),this._headerObjects[t]=i}this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,this.generateCellIdsConsiderHideHeader(),"grid-tree"===this.columnHierarchyType&&this.setColumnWidths()}toggleHierarchyState(t,e){this.colIndex=0;const i=(this.indicatorsAsCol?this.rowHeaderLevelCount-1:this.rowHeaderLevelCount-2)-this.leftRowSeriesNumberColumnCount,r=this._rowHeaderCellFullPathIds_FULL.slice(0),o=r.map(((e,i)=>({col:t,row:i+this.columnHeaderLevelCount}))),n=this.getHeader(t,e);if(n.define.hierarchyState=n.define.hierarchyState===kx.collapse?kx.expand:kx.collapse,this.rowDimensionTree.reset(this.rowDimensionTree.tree.children),this.resetRowHeaderLevelCount(),this._rowHeaderCellFullPathIds_FULL=[],this.rowDimensionKeys=this.rowDimensionTree.dimensionKeysIncludeVirtual.valueArr(),this.fullRowDimensionKeys=[],this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(this.rowDimensionKeys),"tree"===this.rowHierarchyType)this.extensionRows?.length>0&&this.extensionRows.forEach((t=>{const e=t.rows?.map((t=>"string"==typeof t?t:t.dimensionKey))||[];this.fullRowDimensionKeys=this.fullRowDimensionKeys.concat(e)})),this._addHeadersForTreeMode(this._rowHeaderCellFullPathIds_FULL,0,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,!0,this.rowsDefine,this.rowHeaderObjs);else if("grid-tree"===this.rowHierarchyType){const t=0;this._addHeadersForGridTreeMode(this._rowHeaderCellFullPathIds_FULL,t,this.rowDimensionTree.tree.children,[],this.rowDimensionTree.totalLevel,this._getRowHeaderTreeExpandedMaxLevelCount(),!0,this.rowsDefine,this.rowHeaderObjs,!0),this.cornerHeaderObjs=this._addCornerHeaders(this.colDimensionKeys,this.rowDimensionKeys,this.columnsDefine.concat(...this.rowsDefine))}if(this.rowHeaderTitle){const t=++this.sharedVar.seqId,e=Array(this.rowCount-this.columnHeaderLevelCount).fill(t);this._rowHeaderCellFullPathIds_FULL.unshift(e);const i={id:t,title:"string"==typeof this.rowHeaderTitle.title?this.rowHeaderTitle.title:this.rowsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.rowHeaderTitle?.headerType??"text",style:this.rowHeaderTitle?.headerStyle,define:{field:"",headerType:"text",cellType:"text",disableHeaderHover:!!this.rowHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.rowHeaderTitle?.disableHeaderSelect}};this.rowHeaderObjs.push(i),this._headerObjects[t]=i}let s;if(this._rowHeaderCellFullPathIds_FULL=iS(this._rowHeaderCellFullPathIds_FULL),"tree"===this.rowHierarchyType&&this.extensionRows?.length>=1&&this.generateExtensionRowTree(),this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,"tree"===this.rowHierarchyType)s=function(t,e,i,r,o,n){const s=n.columnHeaderLevelCount,a=[],l=[];for(let t=0;t<i.length;t++)r.includes(i[t])||l.push(o[t]);for(let e=0;e<r.length;e++)if(!i.includes(r[e])){const i={col:t,row:s+e};a.push(i)}let h=n.getParentCellId(t,e),c=n.getRowHeaderCellAddressByCellId(h);const d=[];for(c&&d.push(c);h;)h=n.getParentCellId(c.col,c.row),h&&(c=n.getRowHeaderCellAddressByCellId(h),d.push(c));return d.some((i=>i.col===t&&i.row===e))||d.push({col:t,row:e}),{addCellPositionsRowDirection:a,removeCellPositionsRowDirection:l,updateCellPositionsRowDirection:d}}(t,e,r.map((e=>e[t-this.leftRowSeriesNumberColumnCount])),this._rowHeaderCellFullPathIds_FULL.map((e=>e[t-this.leftRowSeriesNumberColumnCount])),o,this);else{const n=(this.indicatorsAsCol?this.rowHeaderLevelCount-1:this.rowHeaderLevelCount-2)-this.leftRowSeriesNumberColumnCount;s=function(t,e,i,r,o,n){const s=n.columnHeaderLevelCount,a=[],l=[];for(let t=0;t<i.length;t++)r.includes(i[t])||l.push(o[t]);for(let e=0;e<r.length;e++)if(!i.includes(r[e])){const i={col:t,row:s+e};a.push(i)}let h=n.getParentCellId(t,e),c=n.getRowHeaderCellAddressByCellId(h);const d=[];for(c&&d.push(c);h;)h=n.getParentCellId(c.col,c.row),h&&(c=n.getRowHeaderCellAddressByCellId(h),d.push(c));const u=[],g=[];if("grid-tree"===n.rowHierarchyType&&"column"===n.cornerSetting.titleOnDimension&&n.rowHeaderLevelCount!==n._cornerHeaderCellIds[0].length)if(n.rowHeaderLevelCount>n._cornerHeaderCellIds[0].length)for(let t=n._cornerHeaderCellIds[0].length;t<n.rowHeaderLevelCount;t++)u.push({col:t,row:e});else for(let t=n.rowHeaderLevelCount;t<n._cornerHeaderCellIds[0].length;t++)g.push({col:t,row:e});return{addCellPositionsRowDirection:a,removeCellPositionsRowDirection:l,updateCellPositionsRowDirection:d,addCellPositionsColumnDirection:u,removeCellPositionsColumnDirection:g}}(t,e,r.map((t=>t[i])),this._rowHeaderCellFullPathIds_FULL.map((t=>t[n])),o,this)}return this.generateCellIdsConsiderHideHeader(),this.setPagination(this.pagination),"grid-tree"===this.rowHierarchyType&&this.setColumnWidths(),s}toggleHierarchyStateForColumnTree(t,e){this.colIndex=0;const i=this.indicatorsAsCol?this.columnHeaderLevelCount-2:this.columnHeaderLevelCount-1,r=this._columnHeaderCellFullPathIds.slice(0),o=r[this.columnHeaderLevelCount-1].map(((t,i)=>({col:i+this.rowHeaderLevelCount,row:e}))),n=this.getHeader(t,e);if(n.define.hierarchyState=n.define.hierarchyState===kx.collapse?kx.expand:kx.collapse,this.columnDimensionTree.reset(this.columnDimensionTree.tree.children),this.resetColumnHeaderLevelCount(),this._columnHeaderCellFullPathIds=[],this.colDimensionKeys=this.columnDimensionTree.dimensionKeysIncludeVirtual.valueArr(),"grid-tree"===this.columnHierarchyType){const t=0;this._addHeadersForGridTreeMode(this._columnHeaderCellFullPathIds,t,this.columnDimensionTree.tree.children,[],this.columnDimensionTree.totalLevel,this._getColumnHeaderTreeExpandedMaxLevelCount(),!0,this.columnsDefine,this.columnHeaderObjs,!1),this.cornerHeaderObjs=this._addCornerHeaders(this.colDimensionKeys,this.rowDimensionKeys,this.columnsDefine.concat(...this.rowsDefine))}if(this.columnHeaderTitle){const t=++this.sharedVar.seqId,e=Array(this.colCount-this.rowHeaderLevelCount-this.rightFrozenColCount).fill(t);this._columnHeaderCellFullPathIds.unshift(e);const i={id:t,title:"string"==typeof this.columnHeaderTitle.title?this.columnHeaderTitle.title:this.columnsDefine.reduce(((t,e)=>"string"==typeof e?t:t+(t?`/${e.title}`:`${e.title}`)),""),field:void 0,headerType:this.columnHeaderTitle?.headerType??"text",style:this.columnHeaderTitle?.headerStyle,define:{id:t,disableHeaderHover:!!this.columnHeaderTitle?.disableHeaderHover,disableHeaderSelect:!!this.columnHeaderTitle?.disableHeaderSelect}};this.columnHeaderObjs.push(i),this._headerObjects[t]=i}this.colIndex=0,this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0;const s=this.indicatorsAsCol?this.columnHeaderLevelCount-2:this.columnHeaderLevelCount-1,a=function(t,e,i,r,o,n){const s=n.rowHeaderLevelCount,a=[],l=[];for(let t=0;t<i.length;t++)r.includes(i[t])||l.push(o[t]);for(let t=0;t<r.length;t++)if(!i.includes(r[t])){const i={col:s+t,row:e};a.push(i)}let h=n.getParentCellId(t,e),c=n.getRowHeaderCellAddressByCellId(h);const d=[];for(c&&d.push(c);c&&h;)h=n.getParentCellId(c.col,c.row),h&&(c=n.getRowHeaderCellAddressByCellId(h),d.push(c));const u=[],g=[];if("grid-tree"===n.columnHierarchyType&&"row"===n.cornerSetting.titleOnDimension&&n.columnHeaderLevelCount!==n._cornerHeaderCellIds.length)if(n.columnHeaderLevelCount>n._cornerHeaderCellIds.length)for(let e=n._cornerHeaderCellIds.length;e<n.columnHeaderLevelCount;e++)u.push({col:t,row:e});else for(let e=n.columnHeaderLevelCount;e<n._cornerHeaderCellIds.length;e++)g.push({col:t,row:e});return{addCellPositionsColumnDirection:a,removeCellPositionsColumnDirection:l,updateCellPositionsColumnDirection:d,addCellPositionsRowDirection:u,removeCellPositionsRowDirection:g}}(t,e,r[i],this._columnHeaderCellFullPathIds[s],o,this);return this.generateCellIdsConsiderHideHeader(),"grid-tree"===this.columnHierarchyType&&this.setColumnWidths(),a}isHeaderForColWidth(t,e){return this.isHeader(t,e)}getHeaderForColWidth(t,e){return this.getHeader(t,e)}getPivotCellAdress(t){if(!Array.isArray(t))return;let e,i,r=this.rowTree,o=this.columnTree;for(let n=0;n<t.length;n++){const s=t[n];if((s.isPivotCorner||!Wx(s.value))&&n===t.length-1){if("row"===this?.cornerSetting?.titleOnDimension){let t=0;return"grid"===this.rowHierarchyType&&(t=this.rowDimensionKeys.indexOf(s.dimensionKey)),-1===t?void 0:{col:(this.rowHeaderTitle?t+1:t)+this.leftRowSeriesNumberColumnCount,row:0}}const t=this.colDimensionKeys.indexOf(s.dimensionKey);return-1===t?void 0:{col:0+this.leftRowSeriesNumberColumnCount,row:this.columnHeaderTitle?t+1:t}}let a=!1;for(let t=0;t<o.length;t++){const e=o[t];if((Wx(s.dimensionKey)&&e.dimensionKey===s.dimensionKey||Wx(s.indicatorKey)&&e.indicatorKey===s.indicatorKey)&&e.value===s.value){o=e.children,i=e,a=!0;break}}if(!a)for(let t=0;t<r.length;t++){const i=r[t];if((Wx(s.dimensionKey)&&i.dimensionKey===s.dimensionKey||Wx(s.indicatorKey)&&i.indicatorKey===s.indicatorKey)&&i.value===s.value){r=i.children,e=i;break}}}let n=0,s=0;if(e){s=this.columnHeaderLevelCount;const{startInTotal:t,afterSpanLevel:i}=e;return s+=t,n="grid"===this.rowHierarchyType?(this.rowHeaderTitle?i+1:i)+this.leftRowSeriesNumberColumnCount:0+this.leftRowSeriesNumberColumnCount,{col:n,row:s}}if(i){n=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;const{startInTotal:t,afterSpanLevel:e}=i;return n+=t,s=this.columnHeaderTitle?e+1:e,{col:n,row:s}}}getPivotDimensionInfo(t,e){const{colHeaderPaths:i,rowHeaderPaths:r}=this.getCellHeaderPaths(t,e),o=[];return i.length?i.forEach(((t,e)=>{o.push({dimensionKey:t.dimensionKey,value:t.value,isPivotCorner:!1,indicatorKey:t.indicatorKey})})):r.length?r.forEach(((t,e)=>{o.push({dimensionKey:t.dimensionKey,value:t.value,isPivotCorner:!1,indicatorKey:t.indicatorKey})})):this.isCornerHeader(t,e)&&("row"===this?.cornerSetting?.titleOnDimension?o.push({dimensionKey:this.rowDimensionKeys[(this.rowHeaderTitle?t-1:t)-this.leftRowSeriesNumberColumnCount],isPivotCorner:!0}):o.push({dimensionKey:this.colDimensionKeys[this.columnHeaderTitle?e-1:e],isPivotCorner:!0})),o}getIndicatorKey(t,e){return this.getBody(t,e)?.indicatorKey}getParentCellId(t,e){if(0!==e)return this.isColumnHeader(t,e)?this.getCellId(t,e-1):this.isRowHeader(t,e)?this.getCellId(t-1,e):void 0}getRowHeaderCellAddressByCellId(t){let e,i;if(this._rowHeaderCellIds.find(((r,o)=>!!r.find(((i,r)=>i===t&&(e=r,!0)))&&(i=o,!0))),Wx(e)&&Wx(i))return{col:e,row:i+this.columnHeaderLevelCount}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(this.isCornerHeader(e.col,e.row))return!1;if(t.col<0||t.row<0||e.col<0||e.row<0)return!1;this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1);const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){return this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row)}if(this.isRowHeader(t.col,t.row)){if("tree"!==this.rowHierarchyType){return this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row)}{const i=i_(this.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths),r=i_(this.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths);if(i.pop(),r.pop(),i.length<=r.length){if(i.length===r.length)return!i.find(((t,e)=>t.dimensionKey!==r[e].dimensionKey||t.value!==r[e].value));if(i.length>0)for(let t=0;t<i.length;t++)if(i[t].startInTotal!==r[t].startInTotal)return!1;return!0}}}return!1}moveHeaderPosition(t,e){if((!this._table.options.dragOrder?.validateDragOrderOnEnd||this._table.options.dragOrder?.validateDragOrderOnEnd(t,e))&&this.canMoveHeaderPosition(t,e)&&!this.isCellRangeEqual(t.col,t.row,e.col,e.row)){const i=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const r=i.end.col-i.start.col+1;let o;const n=this.getCellRange(e.col,i.start.row);if(o=e.col>=t.col?n.end.col-r+1:n.start.col,o===i.start.col)return null;for(let t=0;t<this._columnHeaderCellFullPathIds.length;t++){const e=this._columnHeaderCellFullPathIds[t].splice(i.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,r);e.unshift(o-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columnHeaderCellFullPathIds[t],e)}const s=this._columnWidths.splice(i.start.col-this.leftRowSeriesNumberColumnCount,r);return s.unshift(o-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columnWidths,s),this.columnDimensionTree.movePosition(this.getCellHeaderPathsWithTreeNode(t.col,t.row).colHeaderPaths.length-1,i.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount,n.start.col-this.rowHeaderLevelCount-this.leftRowSeriesNumberColumnCount),this.columnDimensionTree.reset(this.columnDimensionTree.tree.children),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.col,targetIndex:o,sourceSize:r,targetSize:n.end.col-n.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)){let r;const o=this.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths,n=this.getCellHeaderPathsWithTreeNode(e.col,e.row).rowHeaderPaths,s=o[o.length-1],a=n[o.length-1],l=s.size;if(r=e.row>=t.row?a.startInTotal+a.size-l:a.startInTotal,r===i.start.row-this.columnHeaderLevelCount)return null;const h=this._rowHeaderCellIds.splice(i.start.row-this.columnHeaderLevelCount,l);h.unshift(r-this.currentPageStartIndex,0),Array.prototype.splice.apply(this._rowHeaderCellIds,h);const c=this._rowHeaderCellFullPathIds.splice(i.start.row-this.columnHeaderLevelCount,l);c.unshift(r-this.currentPageStartIndex,0),Array.prototype.splice.apply(this._rowHeaderCellFullPathIds,c);const d=this._rowHeaderCellIds_FULL.splice(i.start.row-this.columnHeaderLevelCount+this.currentPageStartIndex,l);d.unshift(r,0),Array.prototype.splice.apply(this._rowHeaderCellIds_FULL,d);const u=this._rowHeaderCellFullPathIds_FULL.splice(i.start.row-this.columnHeaderLevelCount+this.currentPageStartIndex,l);return u.unshift(r,0),Array.prototype.splice.apply(this._rowHeaderCellFullPathIds_FULL,u),this.rowDimensionTree.movePosition(o.length-1,i.start.row-this.columnHeaderLevelCount,r+(e.row>t.row?s.size-1:0)),this.rowDimensionTree.reset(this.rowDimensionTree.tree.children),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,{sourceIndex:i.start.row,targetIndex:r+this.columnHeaderLevelCount,sourceSize:l,targetSize:a.size,moveType:"row"}}}return null}getCellAdressByHeaderPath(t){let e,i,r=!1,o=!1;if(Array.isArray(t)){if(t.length>this.rowDimensionKeys.length+this.colDimensionKeys.length)return;e=t.filter((t=>this.colDimensionKeys.indexOf(t.dimensionKey)>=0||this.colDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&t.indicatorKey)),i=t.filter((t=>this.rowDimensionKeys.indexOf(t.dimensionKey)>=0||this.rowDimensionKeys.indexOf(this.indicatorDimensionKey)>=0&&t.indicatorKey))}else e=t.colHeaderPaths,i=t.rowHeaderPaths,"body"===t?.cellLocation&&this._table.isPivotTable()&&(o=!0);if(!Array.isArray(e)&&!Array.isArray(i))return;if(e?.sort(((t,e)=>this.colDimensionKeys.indexOf(t.dimensionKey??this.indicatorDimensionKey)-this.colDimensionKeys.indexOf(e.dimensionKey??this.indicatorDimensionKey))),i?.sort(((t,e)=>this.fullRowDimensionKeys.indexOf(t.dimensionKey??this.indicatorDimensionKey)-this.fullRowDimensionKeys.indexOf(e.dimensionKey??this.indicatorDimensionKey))),e?.forEach((t=>{t.isPivotCorner&&(r=!0)})),i?.forEach((t=>{t.isPivotCorner&&(r=!0)})),r)if("all"===this.cornerSetting.titleOnDimension&&this.indicatorsAsCol&&0===e.length){for(let t=0;t<this.rowDimensionKeys.length;t++)if(i[0]?.dimensionKey===this.rowDimensionKeys[t])return{col:t+this.leftRowSeriesNumberColumnCount,row:this.columnHeaderLevelCount-1}}else if("all"!==this.cornerSetting.titleOnDimension||this.indicatorsAsCol||0!==i.length){if("row"===this.cornerSetting.titleOnDimension||"all"===this.cornerSetting.titleOnDimension&&!this.indicatorsAsCol){for(let t=0;t<this.rowDimensionKeys.length;t++)if(i[0]?.dimensionKey===this.rowDimensionKeys[t])return{col:t+this.leftRowSeriesNumberColumnCount,row:0}}else for(let t=0;t<this.colDimensionKeys.length;t++)if(e[0]?.dimensionKey===this.colDimensionKeys[t])return{col:0,row:t}}else for(let t=0;t<this.colDimensionKeys.length;t++)if(e[0]?.dimensionKey===this.colDimensionKeys[t])return{col:this.rowHeaderLevelCount-1,row:t};let n,s,a,l,h=!1,c=!1;e?.length>=1&&i?.length>=1&&(h=!0,c=!0),e.length>=this._getColumnHeaderTreeExpandedMaxLevelCount()&&(h=!0),i.length>=this._getRowHeaderTreeExpandedMaxLevelCount()&&(c=!0);let d,u,g=this.rowTree,p=this.columnTree;if(e)for(let t=0;t<e.length;t++){const i=e[t];for(let t=0;t<p.length;t++){const e=p[t];if(!Wx(i.indicatorKey)&&e.dimensionKey===i.dimensionKey&&e.value===i.value||Wx(i.indicatorKey)&&e.indicatorKey===i.indicatorKey&&(Wx(e.value)&&Wx(i.value)&&i.value===e.value||!Wx(e.value)||!Wx(i.value))){p=e.children,h&&!p?.length?u=e:h||(u=e);break}}}if(i?.length>=1)if("tree"===this.rowHierarchyType){const t=i[i.length-1],e=this.headerObjects.filter((e=>(e?.field===t.dimensionKey||e?.field===t.indicatorKey)&&e?.title===t.value)).map((t=>t.id)),r=this._rowHeaderCellIds.filter((t=>e.indexOf(t[t.length-1])>=0)).find((t=>{const e=this.findFullCellIds(t);return e.length===i.length&&e.every((t=>{const e=this._headerObjectMap[t];return i.find((t=>t.dimensionKey===e.field&&t.value===e.title))}))}));s=this._rowHeaderCellIds.indexOf(r)+this.columnHeaderLevelCount}else for(let t=0;t<i.length;t++){const e=i[t];for(let t=0;t<g.length;t++){const i=g[t];if(!Wx(e.indicatorKey)&&i.dimensionKey===e.dimensionKey&&i.value===e.value||Wx(e.indicatorKey)&&i.indicatorKey===e.indicatorKey&&(!Wx(e.value)||i.value===e.value)){g=i.children,(!c||g?.length&&!g.some((t=>"axis"===t.dimensionKey)))&&c||(d=i);break}}}if(o||!h||!c||(d||Wx(s))&&u){if(d||o){s=this.columnHeaderLevelCount;const{startInTotal:t,afterSpanLevel:e}=d??aW;s+=t??0,a="grid"===this.rowHierarchyType?(this.rowHeaderTitle?e+1:e)+this.leftRowSeriesNumberColumnCount:0}if(u||o){n=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount;const{startInTotal:t,afterSpanLevel:e}=u??aW;n+=t??0,l=this.columnHeaderTitle?e+1:e}return Wx(n)||Wx(s)?{col:n??a,row:s??l}:void 0}}setChartInstance(t,e,i){const r=this.getCellHeaderPaths(t,e);let o;if(this.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=this._indicators?.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=this._indicators?.find((e=>e.indicatorKey===t))}"function"!=typeof o?.chartSpec&&o&&(o.chartInstance=i)}getChartInstance(t,e){const i=this.getCellHeaderPaths(t,e);let r;if(this.indicatorsAsCol){const t=i.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;r=this._indicators?.find((e=>e.indicatorKey===t))}else{const t=i.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;r=this._indicators?.find((e=>e.indicatorKey===t))}return r?.chartInstance}checkHasChart(){return Pz(this)}getDimension(t,e){return"column"===e?this.columnsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t)):"row"===e?this.rowsDefine?.find((e=>"string"!=typeof e&&e.dimensionKey===t)):void 0}getAxisConfigInPivotChart(t,e){if((this.isFrozenColumn(t,e)||this.isRightFrozenColumn(t,e))&&Bz(t,e,"row",this)||(this.isFrozenRow(t,e)||this.isBottomFrozenRow(t,e))&&Bz(t,e,"col",this)){const i=wA.getFunction("getAxisConfigInPivotChart")(t,e,this);if(!1===i?.visible)return;return i}}isEmpty(t,e){return!!this._table.isPivotChart()&&(!!this.isLeftBottomCorner(t,e)||(!!this.isRightBottomCorner(t,e)||!!this.isRightTopCorner(t,e)))}isAxisCell(t,e){if(!this._table.isPivotChart())return!1;if(this.indicatorKeys.length>=1&&Rz(this.indicatorsDefine)){if(this.isBottomFrozenRow(t,e)&&Bz(t,e,"col",this)||this.isRightFrozenColumn(t,e)&&Bz(t,e,"row",this))return!0;if(this.isRowHeader(t,e)&&t===this.rowHeaderLevelCount-1&&Bz(t,e,"row",this))return!0;if(this.hasTwoIndicatorAxes&&this.indicatorsAsCol&&e===this.columnHeaderLevelCount-1&&Bz(t,e,"col",this))return!0}return!1}getChartAxes(t,e){if(function(t,e,i){let r=!0;const o=i.getRawChartSpec(t,e);return o&&"pie"!==o.type&&"radar"!==o.type&&"gauge"!==o.type&&"wordCloud"!==o.type&&"funnel"!==o.type&&"rose"!==o.type||(r=!1),r}(t,e,this)||this.isAxisCell(t,e))return function(t,e,i){const r=[];if(i.indicatorsAsCol){const o=i.getIndicatorKeyInChartSpec(t,e),n=i.getColKeysPath(t,e);o.forEach(((s,a)=>{const{range:l,targetTicks:h,targetRange:c,axisOption:d}=VL(t,e,a,0===a?"bottom":"top",0===a?"top":"bottom",o,n,i);Xx(d?.min)&&(l.min=d.min),Xx(d?.max)&&(l.max=d.max),Hz(d,r)||r.push(s_({range:l,label:{style:{fontSize:vz}}},d,{type:d?.type||"linear",orient:0===a?"bottom":"top",label:{visible:!1,flush:!0},title:{visible:!1},domainLine:{visible:!1},seriesIndex:d?.seriesId?void 0:a,tick:{tickMode:FL(h,c,l,a)},sync:{axisId:Tz}}))}));let s=i.getDimensionKeyInChartSpec(i.rowHeaderLevelCount,e);Ux(s)&&(s=s[0]);const a=(i.dataset.cacheCollectedValues[s]||i.dataset.collectedValues[s]||[])[i.getRowKeysPath(t,e)??""],{axisOption:l,isPercent:h,chartType:c}=IL(t,e,"left",i);r.push(s_({domain:"linear"!==l?.type||Array.isArray(a)?Array.from(a??[]):void 0,range:"linear"!==l?.type||Array.isArray(a)?void 0:a,label:{style:{fontSize:vz}}},l,{type:l?.type??"band",orient:"left",label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}else{const o=i.getIndicatorKeyInChartSpec(t,e),n=i.getRowKeysPath(t,e);o.forEach(((s,a)=>{const{range:l,targetTicks:h,targetRange:c,axisOption:d}=VL(t,e,a,0===a?"left":"right",0===a?"right":"left",o,n,i);Xx(d?.min)&&(l.min=d.min),Xx(d?.max)&&(l.max=d.max),Hz(d,r)||r.push(s_({range:l,label:{style:{fontSize:vz}}},d,{type:d?.type||"linear",orient:0===a?"left":"right",label:{visible:!1,flush:!0},title:{visible:!1},domainLine:{visible:!1},seriesIndex:d?.seriesId?void 0:a,tick:{tickMode:FL(h,c,l,a)},sync:{axisId:Tz}}))}));let s=i.getDimensionKeyInChartSpec(t,i.columnHeaderLevelCount);Ux(s)&&(s=s[0]);const a=i.dataset.cacheCollectedValues[s]||i.dataset.collectedValues[s]||[],l=i.getColKeysPath(t,e),h=a?.[l??""]??[],{axisOption:c,isPercent:d,chartType:u}=IL(t,e,"bottom",i);r.push(s_({domain:"linear"!==c?.type||Array.isArray(h)?Array.from(h??[]):void 0,range:"linear"!==c?.type||Array.isArray(h)?void 0:h,label:{style:{fontSize:vz}}},c,{type:c?.type??"band",orient:"bottom",visible:!0,label:{visible:!1},domainLine:{visible:!1},tick:{visible:!1},subTick:{visible:!1},title:{visible:!1}}))}return r}(t,e,this)}getRawChartSpec(t,e){return function(t,e,i){const r=i.getCellHeaderPaths(t,e);let o;if(i.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}const n=o?.chartSpec;if("function"==typeof n)return n({col:t,row:e,dataValue:i._table.getCellOriginValue(t,e)||"",value:i._table.getCellValue(t,e)||"",rect:i._table.getCellRangeRelativeRect(i._table.getCellRange(t,e)),table:i._table});return n}(t,e,this)}getChartSpec(t,e){return function(t,e,i){let r=i.getRawChartSpec(t,e);return r?i._table.isPivotChart()?(r=pz(r),r.sortDataByAxis=!0,Ux(r.series)&&r.series.forEach((t=>{t.sortDataByAxis=!0})),"gauge"!==r.type&&"rose"!==r.type&&"radar"!==r.type&&(r.axes=i.getChartAxes(t,e)),r.padding=0,r.dataZoom=[],r):r:null}(t,e,this)}isShareChartSpec(t,e){return function(t,e,i){const r=i.getCellHeaderPaths(t,e);let o;if(i.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}const n=o?.chartSpec;return"function"!=typeof n}(t,e,this)}getChartDataId(t,e){return Mz(t,e,this)}isNoChartDataRenderNothing(t,e){return function(t,e,i){const r=i.getCellHeaderPaths(t,e);let o;if(i.indicatorsAsCol){const t=r.colHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}else{const t=r.rowHeaderPaths.find((t=>t.indicatorKey))?.indicatorKey;o=i.columnObjects.find((e=>e.indicatorKey===t))}const n=o?.noDataRenderNothing;return n}(t,e,this)}setPagination(t){if(this.clearCellRangeMap(),this._table.internalProps.useOneRowHeightFillAll=!1,this.pagination=t,"grid"===this.rowHierarchyType&&Wx(this.pagination?.perPageCount)&&Wx(this.pagination?.currentPage)){!1===this.indicatorsAsCol&&(this.pagination.perPageCount=Math.ceil(this.pagination.perPageCount/this.indicatorKeys.length)*this.indicatorKeys.length);const{perPageCount:t,currentPage:e}=this.pagination;this.currentPageStartIndex=t*(e||0),this.currentPageEndIndex=this.currentPageStartIndex+t,this._rowHeaderCellIds=this._rowHeaderCellIds_FULL?.slice(this.currentPageStartIndex,this.currentPageEndIndex),this._rowHeaderCellFullPathIds=this._rowHeaderCellFullPathIds_FULL?.slice(this.currentPageStartIndex,this.currentPageEndIndex)}else this.currentPageStartIndex=0,this.currentPageEndIndex=this._rowHeaderCellIds_FULL.length,this._rowHeaderCellIds=this._rowHeaderCellIds_FULL?.slice(this.currentPageStartIndex,this.currentPageEndIndex),this._rowHeaderCellFullPathIds=this._rowHeaderCellFullPathIds_FULL?.slice(this.currentPageStartIndex,this.currentPageEndIndex);this.pagination&&(this.pagination.totalCount=this._rowHeaderCellIds_FULL?.length)}release(){const t=this._table._getActiveChartInstance();t?.release(),this._indicators?.forEach((t=>{t.chartInstance?.release()}))}getHeadNode(t,e){let i;const r=this.getCellHeaderPaths(t,e);return r.rowHeaderPaths&&(r.rowHeaderPaths?.length??0)>0?i=r.rowHeaderPaths?.slice(0,r.rowHeaderPaths.length):r.colHeaderPaths&&r.colHeaderPaths.length>0&&(i=r.colHeaderPaths.slice(0,r.colHeaderPaths.length)),this.getHeadNodeByRowOrColDimensions(i,t,e)}getHeadNodeByRowOrColDimensions(t,e,i){if(!Array.isArray(t))return;let r,o,n=this.rowTree,s=this.columnTree;if(Wx(i)&&Wx(e)&&"tree"===this.rowHierarchyType&&this.extensionRows&&e>=1+this.leftRowSeriesNumberColumnCount){const t=this.getCellId(e-1,i);n=this._rowHeaderExtensionTree[t].tree.children}for(let e=0;e<t.length;e++){const i=t[e];if((i.isPivotCorner||!Wx(i.value))&&e===t.length-1)return;let a=!1;for(let t=0;t<s.length;t++){const e=s[t];if(Wx(i.dimensionKey)&&e.dimensionKey===i.dimensionKey&&e.value===i.value||Wx(i.indicatorKey)&&e.indicatorKey===i.indicatorKey&&(e.value===i.value||!Wx(i.value)||!Wx(e.value))){s=e.children,o=e,a=!0;break}}if(!a)for(let t=0;t<(n?.length??0);t++){const e=n[t];if(Wx(i.dimensionKey)&&e.dimensionKey===i.dimensionKey&&e.value===i.value||Wx(i.indicatorKey)&&e.indicatorKey===i.indicatorKey&&(e.value===i.value||!Wx(i.value)||!Wx(e.value))){n=e.children,r=e;break}}}return r||(o||void 0)}clearCellRangeMap(){this._largeCellRangeCache.length=0,this._CellHeaderPathMap=new Map}getDimensionKeyInChartSpec(t,e){let i;if(!1===this.indicatorsAsCol)for(let t=0;t<this.indicatorsDefine.length;t++){const e=this.indicatorsDefine[t].chartSpec;if(e&&(i=e.xField??e?.series?.[0]?.xField,i))return i}else for(let t=0;t<this.indicatorsDefine.length;t++){const e=this.indicatorsDefine[t].chartSpec;if(e&&(i=e.yField??e?.series?.[0]?.yField,i))return i}return null}_generateChartState(){return{vtable_selected:{filter:t=>{if(this._table._selectedDataItemsInChart.length>=1){return!!this._table._selectedDataItemsInChart.find((e=>{for(const i in e)if("object"!=typeof e[i]&&e[i]!==t[i])return!1;return!0}))}if(this._table._selectedDimensionInChart?.length){return!!this._table._selectedDimensionInChart.every((e=>"object"==typeof e.value||t[e.key]===e.value))}return!1}},vtable_selected_reverse:{filter:t=>{if(this._table._selectedDataItemsInChart.length>=1){return!this._table._selectedDataItemsInChart.find((e=>{for(const i in e)if("object"!=typeof e[i]&&e[i]!==t[i])return!1;return!0}))}if(this._table._selectedDimensionInChart?.length){return!this._table._selectedDimensionInChart.every((e=>"object"==typeof e.value||t[e.key]===e.value))}return!1}}}}updateDataStateToChartInstance(t){if(!1!==t?.getSpec().select?.enable){t||(t=this._table._getActiveChartInstance());const e=this._generateChartState();this._indicators.forEach((t=>{const i=t.chartInstance;!1!==t.chartSpec.select?.enable&&i.updateState(e)})),t?.updateState(e)}}updateDataStateToActiveChartInstance(t){if(!1!==t?.getSpec().select?.enable){t||(t=this._table._getActiveChartInstance());const e=this._generateChartState();t?.updateState(e)}}getIndicatorKeyInChartSpec(t,e){const i=this.getRawChartSpec(t,e),r=[];if(i){if(i.series||i.xField||i.yField)return!1===this.indicatorsAsCol?i.series?i.series.forEach((t=>{const e=t.yField;r.push(e)})):r.push(i.yField):i.series?i.series.forEach((t=>{const e=t.xField;r.push(e)})):r.push(i.xField),r;if(i.valueField&&r.push(i.valueField),r.length>=1)return r}return null}getOptimunHeightForChart(t){const e=this.getCellHeaderPaths(this.rowHeaderLevelCount,t).rowHeaderPaths;let i,r;for(const t in this.dataset.collectValuesBy)if("yField"===this.dataset.collectValuesBy[t].type&&!this.dataset.collectValuesBy[t].range){i=this.dataset.collectedValues[t]?.[e.map((t=>t.value)).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)r=hW(i?.length??0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const t=this._chartItemSpanSize||25;r=(i?.length??0)*(t+t/3)}const o=pB(this._chartPadding??this._table.theme.bodyStyle.padding??0);return r+o[0]+o[2]}getOptimunWidthForChart(t){const e=this.getCellHeaderPaths(t,this.columnHeaderLevelCount).colHeaderPaths;let i,r;for(const t in this.dataset.collectValuesBy)if("xField"===this.dataset.collectValuesBy[t].type&&!this.dataset.collectValuesBy[t].range){i=this.dataset.collectedValues[t]?.[e.map((t=>t.value)).join(this.dataset.stringJoinChar)];break}if(this._chartItemBandSize)r=hW(i?.length??0,this._chartItemBandSize,this._chartPaddingInner,this._chartPaddingOuter);else{const t=this._chartItemSpanSize||25;r=(i?.length??0)*(t+t/3)}const o=pB(this._chartPadding??this._table.theme.bodyStyle.padding??0);return r+o[1]+o[3]}get leftAxesCount(){if(!this._table.isPivotChart())return 0;const t=this._table.pivotChartAxes.find((t=>"left"===t.orient));return!1===t?.visible?0:(this.indicatorsAsCol,1)}get topAxesCount(){if(!this._table.isPivotChart())return 0;const t=this._table.pivotChartAxes.find((t=>"top"===t.orient));return!1===t?.visible?0:this.indicatorsAsCol&&this.hasTwoIndicatorAxes?1:0}get rightAxesCount(){return this.rightFrozenColCount}get bottomAxesCount(){return this.bottomFrozenRowCount}getColKeysPath(t,e){const i=this.getCellHeaderPaths(t,e),r=[];return i.colHeaderPaths.length&&i.colHeaderPaths.forEach((t=>{t.dimensionKey&&r.push(t.value)})),r?.join(this.dataset.stringJoinChar)}getRowKeysPath(t,e){const i=this.getCellHeaderPaths(t,e),r=[];return i.rowHeaderPaths.length&&i.rowHeaderPaths.forEach((t=>{t.dimensionKey&&r.push(t.value)})),r?.join(this.dataset.stringJoinChar)}getIndicatorInfo(t,e=""){const i=this.indicatorsDefine?.find((i=>"string"!=typeof i&&(t?i.indicatorKey===t:!!e&&i.title===e)));return i}getLayoutColumnTree(){const t=[];return uL(t,this.columnDimensionTree.tree.children),t}getLayoutRowTree(){const t=[];return uL(t,this.rowDimensionTree.tree.children),t}getLayoutColumnTreeCount(){return gL(this.columnDimensionTree.tree.children,"tree"===this.rowHierarchyType)}getLayoutRowTreeCount(){let t=gL(this.rowDimensionTree.tree.children,"tree"===this.rowHierarchyType);return this.extensionRows?.forEach((e=>{if("function"!=typeof e.rowTree){const i=gL(e.rowTree,!0);t*=i}})),t}resetHeaderTree(){this.colIndex=0,this._rowHeaderCellFullPathIds_FULL=[],this._columnHeaderCellFullPathIds=[],this._columnHeaderCellIds=[];const t=this.dataset;this.rowTree=t.rowHeaderTree,this.columnTree=t.colHeaderTree;const e=this.rowDimensionTree.tree.children;this.rowTree?.forEach(((t,i)=>{const r=e.find((e=>e.dimensionKey===t.dimensionKey&&e.value===t.value));r&&this._table._syncHierarchyState(r,t)})),this.columnDimensionTree=new dL(this.columnTree??[],this.sharedVar,this.columnHierarchyType,"grid"!==this.columnHierarchyType?this.columnExpandLevel:void 0),this.rowDimensionTree=new dL(this.rowTree??[],this.sharedVar,this.rowHierarchyType,"grid"!==this.rowHierarchyType?this.rowExpandLevel:void 0),this.resetColumnHeaderLevelCount(),this._generateColHeaderIds(),this.colIndex=0,this._generateRowHeaderIds(),this._rowHeaderCellFullPathIds_FULL=iS(this._rowHeaderCellFullPathIds_FULL),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{}),this._CellHeaderPathMap=new Map,this._largeCellRangeCache.length=0,this.generateCellIdsConsiderHideHeader(),this.setPagination(this.pagination)}isSeriesNumberInHeader(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount||this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount}isSeriesNumberInBody(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&e>=this.headerLevelCount||this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e>=this.headerLevelCount}isSeriesNumber(t,e){if(Wx(t)&&Wx(e)){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount)return!0;if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount)return!0}return!1}getSeriesNumberHeader(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&e<this.headerLevelCount?Object.assign({},this.leftRowSeriesNumberColumn[t],{style:Object.assign({},this._table.internalProps.theme.cornerHeaderStyle,this._table.internalProps.rowSeriesNumber.headerStyle)}):this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount&&e<this.headerLevelCount?this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}getSeriesNumberBody(t,e){return this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&e>=this.headerLevelCount?this.leftRowSeriesNumberColumn[t]:this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e>=this.headerLevelCount?this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]:void 0}changeTreeNodeTitle(t,e,i){this.getHeadNode(t,e).value=i;const r=this.getCellId(t,e);this._headerObjectMap[r].title=i}changeCornerTitle(t,e,i){if(this.isCornerHeader(t,e)){const r=this.getCellId(t,e);this._headerObjectMap[r].title=i}}generateCellIdsConsiderHideHeader(){if(this._columnHeaderCellIds=this._columnHeaderCellFullPathIds.slice(),!this.showColumnHeader)if(this.indicatorsAsCol&&!this.hideIndicatorName){const t=this.colDimensionKeys.indexOf(eA),e=this._columnHeaderCellIds.splice(t,1);this._columnHeaderCellIds.splice(0,this._columnHeaderCellIds.length),this._columnHeaderCellIds.push(e[0])}else this._columnHeaderCellIds.splice(0,this._columnHeaderCellIds.length);if(this._rowHeaderCellIds_FULL=this._rowHeaderCellFullPathIds_FULL.slice(),!this.showRowHeader)if(this.indicatorsAsCol||this.hideIndicatorName)this._rowHeaderCellIds_FULL.forEach(((t,e)=>{const i=t.slice();i.splice(0,i.length),this._rowHeaderCellIds_FULL[e]=i}));else{const t=this.rowDimensionKeys.indexOf(eA);this._rowHeaderCellIds_FULL.forEach(((e,i)=>{const r=e.slice(),o=r.splice(t,1);r.splice(0,r.length),r.push(o[0]),this._rowHeaderCellIds_FULL[i]=r}))}if(this._rowHeaderCellIds=this._rowHeaderCellIds_FULL.slice(),this._cornerHeaderCellIds=this._cornerHeaderCellFullPathIds.slice(),0===this.rowHeaderLevelCount||0===this.columnHeaderLevelCount)this._cornerHeaderCellIds=[];else if("row"!==this.cornerSetting.titleOnDimension||this.showRowHeader){if("column"===this.cornerSetting.titleOnDimension&&!this.showColumnHeader)if(this.indicatorsAsCol&&!this.hideIndicatorName){const t=this.colDimensionKeys.indexOf(eA),e=this._cornerHeaderCellIds.splice(t,1);this._cornerHeaderCellIds.splice(0,this._cornerHeaderCellIds.length),this._cornerHeaderCellIds.push(e[0])}else this._cornerHeaderCellIds.splice(0,this._cornerHeaderCellIds.length)}else if(this.indicatorsAsCol||this.hideIndicatorName)this._cornerHeaderCellIds.forEach(((t,e)=>{const i=t.slice();i.splice(0,i.length),this._cornerHeaderCellIds[e]=i}));else{const t=this.rowDimensionKeys.indexOf(eA);this._cornerHeaderCellIds.forEach(((e,i)=>{const r=e.slice(),o=r.splice(t,1);r.splice(0,r.length),r.push(o[0]),this._cornerHeaderCellIds[i]=r}))}if("grid-tree"===this.rowHierarchyType&&"column"===this.cornerSetting.titleOnDimension)this._cornerHeaderCellIds[0].length<this._rowHeaderCellIds[0].length?this._cornerHeaderCellIds.forEach(((t,e)=>{const i=t.length;t.length=this._rowHeaderCellIds[0].length,t.fill(t[0],i)})):this._cornerHeaderCellIds[0].length>this._rowHeaderCellIds[0].length&&this._cornerHeaderCellIds.forEach(((t,e)=>{t.length=this._rowHeaderCellIds[0].length}));else if("grid-tree"===this.columnHierarchyType&&"row"===this.cornerSetting.titleOnDimension)if(this._cornerHeaderCellIds?.length<this._columnHeaderCellIds?.length){const t=this._cornerHeaderCellIds.length;this._cornerHeaderCellIds.length=this._columnHeaderCellIds.length,this._cornerHeaderCellIds.fill(this._cornerHeaderCellIds[0],t)}else this._cornerHeaderCellIds?.length>this._columnHeaderCellIds?.length&&(this._cornerHeaderCellIds.length=this._columnHeaderCellIds.length)}enableUseGetBodyCache(){this._useGetBodyCache=!0,this._getBodyCache.clear()}disableUseGetBodyCache(){this._useGetBodyCache=!1,this._getBodyCache.clear()}enableUseHeaderPathCache(){this._table.options?.customConfig?.enablePivotPathCache?this._useHeaderPathCache=!0:(this._useHeaderPathCache=!0,this._colHeaderPathCache.clear(),this._rowHeaderPathCache.clear())}disableUseHeaderPathCache(){this._table.options?.customConfig?.enablePivotPathCache?this._useHeaderPathCache=!0:(this._useHeaderPathCache=!1,this._colHeaderPathCache.clear(),this._rowHeaderPathCache.clear())}getBodyWidthCache(t,e){if(this._useGetBodyCache&&!this.isHeader(t,e)&&!this.isSeriesNumber(t,e))return this.indicatorsAsCol&&this._getBodyCache.has(t)?this._getBodyCache.get(t):!this.indicatorsAsCol&&this._getBodyCache.has(e)?this._getBodyCache.get(e):void 0}setBodyWidthCache(t,e,i){!this._useGetBodyCache||this.isHeader(t,e)||this.isSeriesNumber(t,e)||(this.indicatorsAsCol?this._getBodyCache.set(t,i):this._getBodyCache.set(e,i))}getColHeaderPathCache(t,e){if(this._useHeaderPathCache&&!this.isHeader(t,e)&&!this.isSeriesNumber(t,e)&&this._colHeaderPathCache.has(t))return this._colHeaderPathCache.get(t)}setColHeaderPathCache(t,e,i){!this._useHeaderPathCache||this.isHeader(t,e)||this.isSeriesNumber(t,e)||this._colHeaderPathCache.set(t,i)}getRowHeaderPathCache(t,e){if(this._useHeaderPathCache&&!this.isHeader(t,e)&&!this.isSeriesNumber(t,e)&&this._rowHeaderPathCache.has(e))return this._rowHeaderPathCache.get(e)}setRowHeaderPathCache(t,e,i){!this._useHeaderPathCache||this.isHeader(t,e)||this.isSeriesNumber(t,e)||this._rowHeaderPathCache.set(e,i)}clearHeaderPathCache(){this._colHeaderPathCache.clear(),this._rowHeaderPathCache.clear()}isAggregation(t,e){if(this.isHeader(t,e))return!1;const i=this.getCellHeaderPaths(t,e);for(const t of i.colHeaderPaths)if("sub-total"===t.role||"grand-total"===t.role)return!0;for(const t of i.rowHeaderPaths)if("sub-total"===t.role||"grand-total"===t.role)return!0;return!1}expandAllForRowDimensionTree(){this.rowDimensionTree&&(this.rowDimensionTree.setAllNodesState(kx.expand),this._rebuildRowLayout())}collapseAllForRowDimensionTree(){this.rowDimensionTree&&(this.rowDimensionTree.setAllNodesState(kx.collapse),this._rebuildRowLayout())}expandAllForColumnDimensionTree(){this.columnDimensionTree&&(this.columnDimensionTree.setAllNodesState(kx.expand),this._rebuildColumnLayout())}collapseAllForColumnDimensionTree(){this.columnDimensionTree&&(this.columnDimensionTree.setAllNodesState(kx.collapse),this._rebuildColumnLayout())}}function hW(t,e,i,r){1===i&&(i=0);const o=function(t,e,i){let r;r=1===t?t+2*i:t-e+2*i;return t?r>0?r:1:0}(t,i,r),n=e/(1-i);return Math.ceil(o*n)}class cW{dataConfig;records;tree={};beforeChangedTree={};colFlatKeys={};rowFlatKeys={};stringJoinChar=String.fromCharCode(0);rowsIsTotal=[];colsIsTotal=[];colGrandTotalLabel;colSubTotalLabel;rowGrandTotalLabel;rowSubTotalLabel;constructor(t,e){this.dataConfig=t,e&&(this.records=e,"undefined"!=typeof window&&window.performance.now(),this.setRecords(e),"undefined"!=typeof window&&window.performance.now())}changeDataConfig(t){this.dataConfig=t}setRecords(t){this.processRecords()}processRecords(){for(let t=0,e=this.records.length;t<e;t++){const e=this.records[t];this.processRecord(e)}}processRecord(t){const e=[],i=[];for(let e=0,r=this.dataConfig.rows.length;e<r;e++){const r=this.dataConfig.rows[e];void 0!==t[r]&&r!==this.dataConfig.indicatorDimensionKey&&i.push(t[r])}for(let i=0,r=this.dataConfig.columns.length;i<r;i++){const r=this.dataConfig.columns[i];void 0!==t[r]&&r!==this.dataConfig.indicatorDimensionKey&&e.push(t[r])}this.dataConfig.indicators?.forEach((r=>{const o=t[r];void 0!==o&&(this.dataConfig.indicatorsAsCol?e.push(r):i.push(r));const n=i.join(this.stringJoinChar),s=e.join(this.stringJoinChar);0!==i.length&&(this.rowFlatKeys[n]||(this.rowFlatKeys[n]=1)),0!==e.length&&(this.colFlatKeys[s]||(this.colFlatKeys[s]=1)),0===e.length&&0===i.length||(this.tree[n]||(this.tree[n]={}),void 0!==o&&(this.tree[n][s]={value:o,record:t},this.dataConfig.indicatorsAsCol?e.pop():i.pop()))}))}getTreeNode(t=[],e=[],i,r=!0){let o,n;if("string"==typeof t)o=t;else{let e=!1;t.map(((r,o)=>{r===i&&(t.splice(o,1),e=!0)})),e&&t.push(i),o=t.join(this.stringJoinChar)}if("string"==typeof e)n=e;else{let t=!1;e.map(((r,o)=>{r===i&&(e.splice(o,1),t=!0)})),t&&e.push(i),n=e.join(this.stringJoinChar)}return r?this.tree?.[o]?.[n]??void 0:Wx(this.beforeChangedTree[o]?.[n])?{value:this.beforeChangedTree[o][n].value,record:this.beforeChangedTree[o][n].record}:void 0}changeTreeNodeValue(t=[],e=[],i,r){let o,n;if("string"==typeof t)o=t;else{let e=!1;t.map(((r,o)=>{r===i&&(t.splice(o,1),e=!0)})),e&&t.push(i),o=t.join(this.stringJoinChar)}if("string"==typeof e)n=e;else{let t=!1;e.map(((r,o)=>{r===i&&(e.splice(o,1),t=!0)})),t&&e.push(i),n=e.join(this.stringJoinChar)}const s=this.tree[o]?.[n]?.value,a=Object.assign({},this.tree[o]?.[n]?.record);this.tree[o]?.[n]?.record?(this.tree[o][n].record[i]=r,this.tree[o][n].value=r):(this.tree[o]||(this.tree[o]={}),this.tree[o][n]={record:this._buildRecord(t,e,i,r),value:r}),this.beforeChangedTree[o]?.[n]||(this.beforeChangedTree[o]={},this.beforeChangedTree[o][n]={record:void 0,value:void 0},this.beforeChangedTree[o][n].record=a,this.beforeChangedTree[o][n].value=s)}_buildRecord(t=[],e=[],i,r){const o={},n=this.dataConfig.rows,s=this.dataConfig.columns;return n.forEach(((e,i)=>{e!==this.dataConfig.indicatorDimensionKey&&(o[e]=t[i])})),s.forEach(((t,i)=>{t!==this.dataConfig.indicatorDimensionKey&&(o[t]=e[i])})),o[i]=r,this.records.push(o),o}addRecords(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];this.processRecord(i)}this.records.push(t)}changeRecordFieldValue(t,e,i){let r=!1;for(let e=0;e<this.dataConfig.indicators.length;e++)this.dataConfig.indicators[e]===t&&(r=!0);if(!r){for(let r=0,o=this.records.length;r<o;r++){const o=this.records[r];o[t]===e&&(o[t]=i)}this.rowFlatKeys={},this.colFlatKeys={},this.tree={},this.processRecords()}}}function dW(t,e){let i="";for(let r=0;r<t.length;r++)i+=t[r],r!==t.length-1&&(i+=e);return i}class uW{dataConfig;records;filteredRecords;tree={};changedTree={};colFlatKeys={};rowFlatKeys={};colKeys=[];rowKeys=[];colKeys_normal=[];rowKeys_normal=[];rowOrder="key_a_to_z";colOrder="key_a_to_z";sorted=!1;sortRules;filterRules;aggregationRules;derivedFieldRules;mappingRules;calculatedFieldRules;calculatedFiledKeys;calculatedFieldDependIndicatorKeys;totals;indicatorStatistics=[];stringJoinChar=String.fromCharCode(0);rowsIsTotal=[];colsIsTotal=[];colGrandTotalLabel;colSubTotalLabel;rowGrandTotalLabel;rowSubTotalLabel;needSplitPositiveAndNegative;collectValuesBy;collectedValues={};cacheCollectedValues={};rows;rowsHasValue;columns;columnsHasValue;indicatorKeys;indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;customRowTree;customColTree;customRowTreeDimensionPaths;customColTreeDimensionPaths;colHeaderTree;rowHeaderTree;rowHierarchyType;columnHierarchyType;indicators;indicatorsAsCol;totalRecordsTree={};hasExtensionRowTree;parseCustomTreeToMatchRecords;constructor(t,e,i,r,o,n,s,a,l,h,c,d,u,g){this.registerAggregators(),this.dataConfig=t,this.filterRules=this.dataConfig?.filterRules,this.rowHierarchyType=a??"grid",this.columnHierarchyType=l??"grid",this.sortRules=this.dataConfig?.sortRules,this.aggregationRules=this.dataConfig?.aggregationRules,this.derivedFieldRules=this.dataConfig?.derivedFieldRules,this.mappingRules=this.dataConfig?.mappingRules,this.calculatedFieldRules=this.dataConfig?.calculatedFieldRules,this.calculatedFiledKeys=this.calculatedFieldRules?.map((t=>t.key))??[],this.calculatedFieldDependIndicatorKeys=this.calculatedFieldRules?.reduce(((t,e)=>{for(let i=0;i<e.dependIndicatorKeys.length;i++)-1===t.indexOf(e.dependIndicatorKeys[i])&&t.push(e.dependIndicatorKeys[i]);return t}),[])??[],this.totals=this.dataConfig?.totals,this.rows=e,this.columns=i,this.indicatorKeys=r,this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys=[...r];for(let t=0;t<this.calculatedFieldDependIndicatorKeys.length;t++)-1===this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys.indexOf(this.calculatedFieldDependIndicatorKeys[t])&&this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys.push(this.calculatedFieldDependIndicatorKeys[t]);if(this.indicatorsAsCol=n,this.indicators=o,this.customColTree=h,this.customRowTree=c,this.hasExtensionRowTree=u,this.parseCustomTreeToMatchRecords=g,this.parseCustomTreeToMatchRecords&&(this.customColTreeDimensionPaths=this.customTreeToDimensionPathArr(this.customColTree,"col"),this.hasExtensionRowTree||(this.customRowTreeDimensionPaths=this.customTreeToDimensionPathArr(this.customRowTree,"row"))),this.colGrandTotalLabel=this.totals?.column?.grandTotalLabel??"总计",this.colSubTotalLabel=this.totals?.column?.subTotalLabel??"小计",this.rowGrandTotalLabel=this.totals?.row?.grandTotalLabel??"总计",this.rowSubTotalLabel=this.totals?.row?.subTotalLabel??"小计",this.collectValuesBy=this.dataConfig?.collectValuesBy,this.needSplitPositiveAndNegative=d??!1,this.rowsIsTotal=new Array(this.rows?.length??0).fill(!1),this.colsIsTotal=new Array(this.columns?.length??0).fill(!1),this.totals?.row&&!1!==this.totals.row.showSubTotals&&this.totals.row.subTotalsDimensions)for(let t=0,e=this.totals?.row?.subTotalsDimensions?.length??0;t<e;t++){const e=this.totals.row.subTotalsDimensions[t],i=this.rows.indexOf(e);this.rowsIsTotal[i]=!0}if(this.totals?.column&&!1!==this.totals.column.showSubTotals&&this.totals.column.subTotalsDimensions)for(let t=0,e=this.totals?.column?.subTotalsDimensions?.length??0;t<e;t++){const e=this.totals.column.subTotalsDimensions[t],i=this.columns.indexOf(e);this.colsIsTotal[i]=!0}this.setRecords(s)}setRecords(t){this.records=t,this.collectedValues={},this.cacheCollectedValues={},this.totalRecordsTree={},this.tree={},this.colFlatKeys={},this.rowFlatKeys={},this.colKeys=[],this.rowKeys=[],this.rowsHasValue=[],this.columnsHasValue=[],this.sorted=!1,t&&(this.records=t,"undefined"!=typeof window&&window.performance.now(),this.processRecords(),this.processCollectedValuesWithSumBy(),this.generateCollectedValuesSortRule(),this.processCollectedValuesWithSortBy(),"undefined"!=typeof window&&window.performance.now(),"undefined"!=typeof window&&window.performance.now(),this.totalStatistics(),"undefined"!=typeof window&&window.performance.now(),this.rowKeys_normal=this.rowKeys.slice(),this.colKeys_normal=this.colKeys.slice(),"undefined"!=typeof window&&window.performance.now(),this.sortKeys(),"undefined"!=typeof window&&window.performance.now(),"undefined"!=typeof window&&window.performance.now(),this.customRowTree?this.rowHeaderTree=this.customRowTree:"tree"===this.rowHierarchyType?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows.filter(((t,e)=>this.rowsHasValue[e])),this.indicatorsAsCol?void 0:this.indicators,this.totals?.row?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel,this.totals?.row?.showGrandTotalsOnTop??!1):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows.filter(((t,e)=>this.rowsHasValue[e])),this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,this.totals?.row?.showGrandTotals||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel,this.rowSubTotalLabel,this.totals?.row?.showGrandTotalsOnTop??!1,this.totals?.row?.showSubTotalsOnTop??!1),this.customColTree?this.colHeaderTree=this.customColTree:this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns.filter(((t,e)=>this.columnsHasValue[e])),this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,this.totals?.column?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length,this.colGrandTotalLabel,this.colSubTotalLabel,this.totals?.column?.showGrandTotalsOnLeft??!1,this.totals?.column?.showSubTotalsOnLeft??!1),"undefined"!=typeof window&&window.performance.now(),this.dataConfig?.isPivotChart&&this.cacheDeminsionCollectedValues())}registerAggregator(t,e){f_[t]=e}registerAggregators(){this.registerAggregator(Mx.RECORD,b_),this.registerAggregator(Mx.SUM,v_),this.registerAggregator(Mx.COUNT,x_),this.registerAggregator(Mx.MAX,S_),this.registerAggregator(Mx.MIN,A_),this.registerAggregator(Mx.AVG,__),this.registerAggregator(Mx.NONE,y_),this.registerAggregator(Mx.RECALCULATE,w_),this.registerAggregator(Mx.CUSTOM,C_)}processCollectedValuesWithSumBy(){for(const t in this.collectedValues)if(this.collectValuesBy?.[t]?.sumBy)for(const e in this.collectedValues[t]){let i;"sum"===this.collectValuesBy[t]?.extendRange?(i=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>t+e.value()),0),i+=Math.round(i/20)):(i=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.value()>t?e.value():t),Number.MIN_SAFE_INTEGER),"max"===this.collectValuesBy[t]?.extendRange?i+=Math.round(i/20):"number"==typeof this.collectValuesBy[t]?.extendRange&&(i=Math.max(i,this.collectValuesBy[t]?.extendRange)));const r=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.value()<t?e.value():t),Number.MAX_SAFE_INTEGER);let o,n;this.needSplitPositiveAndNegative&&(o=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.positiveValue()>t?e.positiveValue():t),Number.MIN_SAFE_INTEGER),n=Object.values(this.collectedValues[t][e]).reduce(((t,e)=>e.negativeValue()<t?e.negativeValue():t),Number.MAX_SAFE_INTEGER)),this.collectedValues[t][e]={},this.collectedValues[t][e].max=i,this.collectedValues[t][e].min=r,this.needSplitPositiveAndNegative&&(this.collectedValues[t][e].positiveMax=o,this.collectedValues[t][e].negativeMin=n)}}processCollectedValuesWithSortBy(){const t=this;for(const e in this.collectedValues)if(this.collectValuesBy?.[e]?.sortBy)for(const i in this.collectedValues[e])this.collectedValues[e][i]=this.collectedValues[e][i].sort(((i,r)=>(t.collectValuesBy[e].sortBy?.indexOf(i)??-1)-(t.collectValuesBy[e].sortBy?.indexOf(r)??-1)))}generateCollectedValuesSortRule(){for(const t in this.collectedValues)if(this.collectValuesBy&&this.collectValuesBy[t]&&!this.collectValuesBy[t].sortBy){let e=[];for(const i in this.collectedValues[t])Array.isArray(this.collectedValues[t][i])&&(e.push(...this.collectedValues[t][i]),e=Array.from(new Set(e)));e.length>0&&(this.collectValuesBy[t].sortBy=e)}}processRecords(){let t=!1;if((this.filterRules?.length??0)>=1&&(t=!0),Array.isArray(this.records)){this.filteredRecords||(this.filteredRecords=[]);for(let e=0,i=this.records.length;e<i;e++){const i=this.records[e];t&&!this.filterRecord(i)||(this.filteredRecords.push(i),this.processRecord(i))}}else{this.filteredRecords||(this.filteredRecords={});for(const e in this.records)for(let i=0,r=this.records[e].length;i<r;i++){const r=this.records[e][i];t&&!this.filterRecord(r)||(this.filteredRecords[e]||(this.filteredRecords[e]=[]),this.filteredRecords[e].push(r),this.processRecord(r,e))}}this.rowFlatKeys={},this.colFlatKeys={}}filterRecord(t){let e=!0;if(this.filterRules)for(let i=0;i<this.filterRules.length;i++){const r=this.filterRules[i];if(r.filterKey){const i=t[r.filterKey];if(-1===r.filteredValues?.indexOf(i)){e=!1;break}}else if(!r.filterFunc?.(t)){e=!1;break}}return e}processRecord(t,e){this.derivedFieldRules?.forEach(((e,i)=>{e.fieldName&&e.derivedFunc&&(t[e.fieldName]=e.derivedFunc(t))}));for(const e in this.collectValuesBy)if(Wx(t[e])){this.collectedValues[e]||(this.collectedValues[e]={});const i=this.collectValuesBy[e].by.map((e=>t[e])).join(this.stringJoinChar);if(this.collectedValues[e][i]||(this.collectValuesBy[e].sumBy?this.collectedValues[e][i]={}:this.collectValuesBy[e].range?this.collectedValues[e][i]={min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER}:this.collectedValues[e][i]=[]),this.collectValuesBy[e].sumBy){const r=this.collectValuesBy[e].sumBy?.map((e=>t[e])).join(this.stringJoinChar);this.collectedValues[e][i][r]||(this.collectedValues[e][i][r]=new f_[Mx.SUM]({key:e,field:e,isRecord:void 0,needSplitPositiveAndNegative:this.needSplitPositiveAndNegative})),this.collectedValues[e][i][r].push(t)}else if(this.collectValuesBy[e].range){const r=this.collectedValues[e][i],o=Math.max(t[e],r.max),n=Math.min(t[e],r.min);isNaN(o)||(r.max=o,r.min=n)}else{const r=this.collectedValues[e][i];-1===r.indexOf(t[e])&&r.push(t[e])}}let i=!1;const r=[],o=[];if(!this.parseCustomTreeToMatchRecords||this.dataConfig?.isPivotChart||!this.customRowTree?.length||e||this.hasExtensionRowTree){const r=[];o.push({rowKey:r,indicatorKey:e});for(let e=0,o=this.rows.length;e<o;e++){const o=this.rows[e];if(o in t)this.rowsHasValue[e]=!0,r.push(t[o]);else if(o!==eA){if(this.dataConfig?.totals?.row?.showGrandTotals&&0===e&&!this.rows.find((e=>e in t))){r.push(this.rowGrandTotalLabel),i=!0;break}if(this.dataConfig?.totals?.row?.subTotalsDimensions&&this.dataConfig?.totals?.row?.subTotalsDimensions.indexOf(this.rows[e-1])>=0){"tree"!==this.rowHierarchyType&&r.push(this.rowSubTotalLabel),i=!0;break}}}}else{const e=this.getFieldMatchRowDimensionPaths(t);if(e.length>0)for(let t=0,i=e.length;t<i;t++){const i=e[t],r=[];let n;for(let t=0,e=i.length;t<e;t++)Wx(i[t].indicatorKey)?n=i[t].indicatorKey:r.push(i[t].value);o.push({rowKey:r,indicatorKey:n})}}if(!this.parseCustomTreeToMatchRecords||this.dataConfig?.isPivotChart||!this.customColTree?.length||e||this.hasExtensionRowTree){const o=[];r.push({colKey:o,indicatorKey:e});for(let e=0,r=this.columns.length;e<r;e++){const r=this.columns[e];if(r in t)this.columnsHasValue[e]=!0,o.push(t[r]);else if(r!==eA){if(this.dataConfig?.totals?.column?.showGrandTotals&&0===e&&!this.columns.find((e=>e in t))){o.push(this.colGrandTotalLabel),i=!0;break}if(this.dataConfig?.totals?.column?.subTotalsDimensions&&this.dataConfig?.totals?.column?.subTotalsDimensions.indexOf(this.columns[e-1])>=0){o.push(this.colSubTotalLabel),i=!0;break}}}}else{const e=this.getFieldMatchColDimensionPaths(t);if(e.length>0)for(let t=0,i=e.length;t<i;t++){const i=e[t],o=[];let n;for(let t=0,e=i.length;t<e;t++)Wx(i[t].indicatorKey)?n=i[t].indicatorKey:o.push(i[t].value);r.push({colKey:o,indicatorKey:n})}}for(let n=0;n<o.length;n++){const s=o[n].rowKey;let a;this.indicatorsAsCol||(a=o[n].indicatorKey);for(let o=0;o<r.length;o++){const n=r[o].colKey;this.indicatorsAsCol&&(a=r[o].indicatorKey);const l=s.join(this.stringJoinChar),h=n.join(this.stringJoinChar);if(i){this.totalRecordsTree[l]||(this.totalRecordsTree[l]={}),this.totalRecordsTree[l][h]||(this.totalRecordsTree[l][h]=[]);const e=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let i=0;i<e.length;i++)if(this.calculatedFiledKeys.indexOf(e[i])>=0){const r=this.calculatedFieldRules?.find((t=>t.key===e[i]));this.totalRecordsTree[l]?.[h]?.[i]||(this.totalRecordsTree[l][h][i]=new f_[Mx.RECALCULATE]({key:e[i],field:e[i],isRecord:!0,formatFun:this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===e[i]))?.format,calculateFun:r?.calculateFun,dependAggregators:this.totalRecordsTree[l][h],dependIndicatorKeys:r?.dependIndicatorKeys})),e[i]in t&&this.totalRecordsTree[l]?.[h]?.[i].push(t)}else{const r=this.getAggregatorRule(e[i]);this.totalRecordsTree[l]?.[h]?.[i]||(this.totalRecordsTree[l][h][i]=new f_[r?.aggregationType??Mx.SUM]({key:e[i],field:r?.field??e[i],aggregationFun:r?.aggregationFun,formatFun:r?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===e[i]))?.format})),e[i]in t&&this.totalRecordsTree[l]?.[h]?.[i].push(t)}return}0!==s.length&&(this.rowFlatKeys[l]||(this.rowKeys.push(s),this.rowFlatKeys[l]=1)),0!==n.length&&(this.colFlatKeys[h]||(this.colKeys.push(n),this.colFlatKeys[h]=1)),this.tree[l]||(this.tree[l]={}),this.tree[l]?.[h]||(this.tree[l][h]=[]);const c=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let i=0;i<c.length;i++)if(this.calculatedFiledKeys.indexOf(c[i])>=0){const e=this.calculatedFieldRules?.find((t=>t.key===c[i]));this.tree[l]?.[h]?.[i]||(this.tree[l][h][i]=new f_[Mx.RECALCULATE]({key:c[i],field:c[i],isRecord:!0,formatFun:this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===c[i]))?.format,calculateFun:e?.calculateFun,dependAggregators:this.tree[l][h],dependIndicatorKeys:e?.dependIndicatorKeys})),this.tree[l]?.[h]?.[i].push(t)}else{const r=this.getAggregatorRule(c[i]);let o=!1;if(a)e===a?c[i]===a&&(o=!0):c[i]===a&&c[i]in t&&(o=!0);else if(r?.field)if("string"==typeof r?.field)r?.field in t&&(o=!0);else{const e=r?.field.find((e=>e in t));e&&(o=!0)}else c[i]in t&&(o=!0);!this.tree[l]?.[h]?.[i]&&o&&(this.tree[l][h][i]=new f_[r?.aggregationType??Mx.SUM]({key:c[i],field:r?.field??c[i],aggregationFun:r?.aggregationFun,formatFun:r?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===c[i]))?.format})),o&&this.tree[l]?.[h]?.[i].push(t)}if(this.mappingRules)for(let e=0;e<this.indicatorKeys.length;e++){if(!this.indicatorStatistics[e]){const t=this.getAggregatorRule(this.indicatorKeys[e]);this.indicatorStatistics[e]={max:new f_[Mx.MAX]({key:this.indicatorKeys[e],field:this.indicatorKeys[e]}),min:new f_[Mx.MIN]({key:this.indicatorKeys[e],field:this.indicatorKeys[e]}),total:new f_[t?.aggregationType??Mx.SUM]({key:this.indicatorKeys[e],field:t?.field??this.indicatorKeys[e],aggregationFun:t?.aggregationFun,formatFun:t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===this.indicatorKeys[e]))?.format})}}this.indicatorStatistics[e].max.push(this.tree[l]?.[h]?.[e].value()),this.indicatorStatistics[e].min.push(this.tree[l]?.[h]?.[e].value()),this.indicatorStatistics[e].total.push(t)}}}}updateSortRules(t){this.sorted=!1,this.sortRules=t,this.sortKeys(),this.customRowTree||("tree"===this.rowHierarchyType?this.rowHeaderTree=this.ArrToTree1(this.rowKeys,this.rows.filter(((t,e)=>this.rowsHasValue[e])),this.indicatorsAsCol?void 0:this.indicators,this.totals?.row?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel,this.totals?.row?.showGrandTotalsOnTop??!1):this.rowHeaderTree=this.ArrToTree(this.rowKeys,this.rows.filter(((t,e)=>this.rowsHasValue[e])),this.indicatorsAsCol?void 0:this.indicators,this.rowsIsTotal,this.totals?.row?.showGrandTotals||this.indicatorsAsCol&&0===this.rows.length,this.rowGrandTotalLabel,this.rowSubTotalLabel,this.totals?.row?.showGrandTotalsOnTop??!1,this.totals?.row?.showSubTotalsOnTop??!1)),this.customColTree||(this.colHeaderTree=this.ArrToTree(this.colKeys,this.columns.filter(((t,e)=>this.columnsHasValue[e])),this.indicatorsAsCol?this.indicators:void 0,this.colsIsTotal,this.totals?.column?.showGrandTotals||!this.indicatorsAsCol&&0===this.columns.length,this.colGrandTotalLabel,this.colSubTotalLabel,this.totals?.column?.showGrandTotalsOnLeft??!1,this.totals?.column?.showSubTotalsOnLeft??!1))}updateFilterRules(t,e=!1){if(this.filterRules=t,this.filteredRecords=void 0,e)this.tree={};else for(const t in this.tree)for(const e in this.tree[t])for(let i=0;i<this.tree[t][e].length;i++)this.tree[t][e][i]?.reset();this.collectedValues={},this.processRecords(),this.processCollectedValuesWithSumBy(),this.processCollectedValuesWithSortBy(),this.totalStatistics(),this.dataConfig?.isPivotChart&&this.cacheDeminsionCollectedValues()}getAggregatorRule(t){return this.aggregationRules?.find(((e,i)=>t===e.indicatorKey))}getAggregator(t=[],e=[],i,r=!0,o){const n=this.indicatorKeys.indexOf(i);let s,a;"string"==typeof t?s=t:(o&&"row"!==o.position||t.map(((e,r)=>{e!==i||Wx(o?.index)&&r!==o.index||t.splice(r,1)})),t.length<this.rows.length&&"grid-tree"===this.rowHierarchyType&&(t[0]===this.rowGrandTotalLabel||this.totals?.row?.subTotalsDimensions&&this.totals?.row?.subTotalsDimensions?.length>=1&&t[t.length-1]!==this.rowSubTotalLabel&&t.push(this.rowSubTotalLabel)),s=dW(t,this.stringJoinChar)),"string"==typeof e?a=e:(o&&"col"!==o.position||e.map(((t,r)=>{t!==i||Wx(o?.index)&&r!==o.index||e.splice(r,1)})),e.length<this.columns.length&&"grid-tree"===this.columnHierarchyType&&(e[0]===this.colGrandTotalLabel||this.totals?.column?.subTotalsDimensions&&this.totals?.column?.subTotalsDimensions?.length>=1&&e[e.length-1]!==this.colSubTotalLabel&&e.push(this.colSubTotalLabel)),a=dW(e,this.stringJoinChar));const l=this.tree[s]?.[a]?.[n];if(r&&Wx(this.changedTree[s]?.[a]?.[n])){const t=this.changedTree[s][a][n];return l?{value:()=>t,formatValue:l.formatValue,formatFun:l.formatFun,records:l.records,recalculate(){},push(){},deleteRecord(){},updateRecord(){},clearCacheValue(){},reset(){}}:{records:[],value:()=>t,push(){},deleteRecord(){},updateRecord(){},recalculate(){},formatValue:()=>t,clearCacheValue(){},reset(){}}}return l||{records:[],push(){},deleteRecord(){},updateRecord(){},recalculate(){},value:()=>null,clearCacheValue(){},reset(){}}}sortKeys(){if(this.colKeys=this.colKeys_normal.slice(),this.rowKeys=this.rowKeys_normal.slice(),!this.sorted){this.sorted=!0,this.rowKeys.sort(this.arrSort(this.rows,!0));const t=this.arrSort(this.columns,!1);this.colKeys.sort(t)}}arrSort(t,e){let i;const r=this,o=function(o){const n=[];for(let o=0,s=t.length;o<s;o++)if(i=t[o],r.sortRules)for(let t=0,s=r.sortRules.length;t<s;t++)r.sortRules[t].sortField===i&&n.push({field:i,fieldIndex:o,sortRule:r.sortRules[t],func:r.getSort(r.sortRules[t],e)});return n}.call(this);return function(i,n){let s,a;for(let l=0;l<o.length;l++){if(a=o[l],a.sortRule?.sortByIndicator){let o=i,l=n;a.fieldIndex<t.length-1&&(o=i.slice(0,a.fieldIndex+1),"grid"===r.rowHierarchyType&&e?o.push(r.rowSubTotalLabel):e||o.push(r.colSubTotalLabel),l=n.slice(0,a.fieldIndex+1),"grid"===r.rowHierarchyType&&e?l.push(r.rowSubTotalLabel):e||l.push(r.colSubTotalLabel)),s=a.func(o,l,a.sortRule?.sortType)}else s=a.func?.(i[a.fieldIndex],n[a.fieldIndex],a.sortRule?.sortType);if(0!==s)return s}return 0}}getSort(t,e){const i=this;return t.sortByIndicator?(r,o,n)=>{const s=function(e,r){return"grid"===i.rowHierarchyType&&e.length<i.rows.length&&e[e.length-1]!==i.rowSubTotalLabel&&e[e.length-1]!==i.rowGrandTotalLabel&&e.push(i.rowSubTotalLabel),r.length<i.columns.length&&r[r.length-1]!==i.colSubTotalLabel&&r[r.length-1]!==i.colGrandTotalLabel&&r.push(i.colSubTotalLabel),i.getAggregator(e,r,t.sortByIndicator).value()};return e?t.sortFunc?t.sortFunc(s(r,t.query),s(o,t.query),r,o,n):R_(s(r,t.query),s(o,t.query),n):t.sortFunc?t.sortFunc(s(t.query,r),s(t.query,o),r,o,n):R_(s(t.query,r),s(t.query,o),n)}:t.sortBy?B_(t.sortBy):t.sortFunc?t.sortFunc:t.sortType?T_:R_}totalStatistics(){const t=this,e=(e,i)=>{if(this.totalRecordsTree?.[e]?.[i])return this.tree[e]||(this.tree[e]={}),void(this.tree[e][i]=this.totalRecordsTree?.[e]?.[i]);const r=i.split(this.stringJoinChar);if(t.totals?.column?.subTotalsDimensions&&t.totals?.column?.subTotalsDimensions?.length>0&&!1!==t.totals.column.showSubTotals)for(let o=0,n=t.totals?.column?.subTotalsDimensions?.length;o<n;o++){const n=t.totals.column.subTotalsDimensions[o],s=t.columns.indexOf(n);if(s>=0){const o=r.slice(0,s+1);o.push(t.colSubTotalLabel);const n=o.join(this.stringJoinChar);if(this.totalRecordsTree?.[e]?.[n])return void(this.tree[e][n]=this.totalRecordsTree?.[e]?.[n]);this.tree[e][n]||(this.tree[e][n]=[]);const a=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let r=0;r<a.length;r++)if(this.calculatedFiledKeys.indexOf(a[r])>=0){const o=this.calculatedFieldRules?.find((t=>t.key===a[r]));this.tree[e]?.[n]?.[r]||(this.tree[e][n][r]=new f_[Mx.RECALCULATE]({key:a[r],field:a[r],isRecord:!0,formatFun:this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===a[r]))?.format,calculateFun:o?.calculateFun,dependAggregators:this.tree[e][n],dependIndicatorKeys:o?.dependIndicatorKeys})),n!==i&&this.tree[e][n][r].push(t.tree[e]?.[i]?.[r])}else{if(!this.tree[e][n][r]){const t=this.getAggregatorRule(a[r]);this.tree[e][n][r]=new f_[t?.aggregationType??Mx.SUM]({key:a[r],field:t?.field??a[r],aggregationFun:t?.aggregationFun,formatFun:t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===a[r]))?.format})}n!==i&&this.tree[e][n][r].push(t.tree[e]?.[i]?.[r])}}}if(t.totals?.column?.showGrandTotals||0===this.rows.length){const r=t.colGrandTotalLabel;if(this.totalRecordsTree?.[e]?.[r])return void(this.tree[e][r]=this.totalRecordsTree?.[e]?.[r]);this.tree[e][r]||(this.tree[e][r]=[]);const o=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let n=0;n<o.length;n++)if(this.calculatedFiledKeys.indexOf(o[n])>=0){const s=this.calculatedFieldRules?.find((t=>t.key===o[n]));this.tree[e]?.[r]?.[n]||(this.tree[e][r][n]=new f_[Mx.RECALCULATE]({key:o[n],field:o[n],isRecord:!0,formatFun:this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===o[n]))?.format,calculateFun:s?.calculateFun,dependAggregators:this.tree[e][r],dependIndicatorKeys:s?.dependIndicatorKeys})),r!==i&&this.tree[e][r][n].push(t.tree[e]?.[i]?.[n])}else{if(!this.tree[e][r][n]){const t=this.getAggregatorRule(o[n]);this.tree[e][r][n]=new f_[t?.aggregationType??Mx.SUM]({key:o[n],field:t?.field??o[n],formatFun:t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===o[n]))?.format})}r!==i&&this.tree[e][r][n].push(t.tree[e]?.[i]?.[n])}}};if(t?.totals?.column?.subTotalsDimensions&&t?.totals?.column?.subTotalsDimensions?.length>=1||t?.totals?.row?.subTotalsDimensions&&t?.totals?.row?.subTotalsDimensions?.length>=1||t?.totals?.column?.showGrandTotals||t?.totals?.row?.showGrandTotals){const i=[];Object.keys(t.tree).forEach((r=>{const o=r.split(this.stringJoinChar);Object.keys(t.tree[r]).forEach((n=>{if(t.totals?.row?.subTotalsDimensions&&t.totals?.row?.subTotalsDimensions?.length>0&&!1!==t.totals.row.showSubTotals)for(let e=0,s=t.totals?.row?.subTotalsDimensions?.length;e<s;e++){const s=t.totals.row.subTotalsDimensions[e],a=t.rows.indexOf(s);if(a>=0&&a<t.rows.length-1){const e=o.slice(0,a+1);"tree"!==this.rowHierarchyType&&e.push(t.rowSubTotalLabel);const s=e.join(this.stringJoinChar);this.tree[s]||(this.tree[s]={},i.push(s)),this.tree[s][n]||(this.tree[s][n]=[]);const l=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let e=0;e<l.length;e++){if(!this.tree[s][n][e])if(this.calculatedFiledKeys.indexOf(l[e])>=0){const t=this.calculatedFieldRules?.find((t=>t.key===l[e]));this.tree[s][n][e]=new f_[Mx.RECALCULATE]({key:l[e],field:l[e],isRecord:!0,formatFun:this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===l[e]))?.format,calculateFun:t?.calculateFun,dependAggregators:this.tree[s][n],dependIndicatorKeys:t?.dependIndicatorKeys})}else{const t=this.getAggregatorRule(l[e]);this.tree[s][n][e]=new f_[t?.aggregationType??Mx.SUM]({key:l[e],field:t?.field??l[e],formatFun:t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===l[e]))?.format})}s!==r&&this.tree[s][n][e].push(t.tree[r]?.[n]?.[e])}}}if(t.totals?.row?.showGrandTotals||0===this.columns.length){const e=t.rowGrandTotalLabel;this.tree[e]||(this.tree[e]={},i.push(e)),this.tree[e][n]||(this.tree[e][n]=[]);const o=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys;for(let i=0;i<o.length;i++){if(!this.tree[e][n][i])if(this.calculatedFiledKeys.indexOf(o[i])>=0){const t=this.calculatedFieldRules?.find((t=>t.key===o[i]));this.tree[e][n][i]=new f_[Mx.RECALCULATE]({key:o[i],field:o[i],isRecord:!0,formatFun:this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===o[i]))?.format,calculateFun:t?.calculateFun,dependAggregators:this.tree[e][n],dependIndicatorKeys:t?.dependIndicatorKeys})}else{const t=this.getAggregatorRule(o[i]);this.tree[e][n][i]=new f_[t?.aggregationType??Mx.SUM]({key:o[i],field:t?.field??o[i],formatFun:t?.formatFun??this.indicators?.find((t=>"string"!=typeof t&&t.indicatorKey===o[i]))?.format})}e!==r&&this.tree[e][n][i].push(t.tree[r]?.[n]?.[i])}}e(r,n)}))})),i.forEach((i=>{Object.keys(t.tree[i]).forEach((t=>{e(i,t)}))}))}for(const i in t.totalRecordsTree)for(const r in t.totalRecordsTree[i])e(i,r)}ArrToTree1(t,e,i,r,o,n){const s=[],a=this.stringJoinChar,l=new Map;function h(t,r){const o=[];let h;t.forEach(((c,d)=>{o.push(c);const u=o.join(a);let g=l.get(u);g||(g={value:c,dimensionKey:e[d],children:d===t.length-1&&(i?.length??0)>=1?i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title})):[]},l.set(u,g),h?h.children.push(g):n&&r?s.unshift(g):s.push(g)),h=g}))}return t.forEach((t=>h(t,!1))),r&&h([o],r),s}ArrToTree(t,e,i,r,o,n,s,a,l){let h=[];const c=this.stringJoinChar,d=new Map;if(t?.length?t.forEach((t=>function(t){const o=[];let n;t.forEach(((a,u)=>{o.push(a);const g=o.join(c);let p=d.get(g);if(!p){if(p={value:a,dimensionKey:e[u],children:u===t.length-1&&(i?.length??0)>=1?i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title})):[]},r[u]){let t=p.children??[];const o={value:s,dimensionKey:e[u+1],levelSpan:r.length-u-1,children:(i?.length??0)>=1?i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title})):[],role:"sub-total"};t.push(o),t=o.children??[]}d.set(g,p),n?r[u-1]&&!l?n.children.splice(n.children.length-1,0,p):n.children.push(p):h.push(p)}n=p}))}(t))):i&&(h=i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title??t.indicatorKey}))),o&&t?.length){const t={value:n,dimensionKey:e[0],levelSpan:r.length,children:i?.map((t=>"string"==typeof t?{indicatorKey:t,value:t}:{indicatorKey:t.indicatorKey,value:t.title}))??[],role:"grand-total"};a?h.unshift(t):h.push(t)}return h}cacheDeminsionCollectedValues(){for(const t in this.collectValuesBy)"xField"!==this.collectValuesBy[t].type&&"yField"!==this.collectValuesBy[t].type||(this.dataConfig.dimensionSortArray?this.cacheCollectedValues[t]=gW(this.collectedValues[t],this.dataConfig.dimensionSortArray):this.cacheCollectedValues[t]=this.collectedValues[t])}changeTreeNodeValue(t=[],e=[],i,r){const o=this.indicatorKeys.indexOf(i);let n,s;n="string"==typeof t?t:t.join(this.stringJoinChar),s="string"==typeof e?e:e.join(this.stringJoinChar),"string"==typeof r&&(isNaN(parseFloat(r))||(r=parseFloat(r))),this.changedTree[n]?.[s]?this.changedTree[n][s][o]=r:this.changedTree[n]?(this.changedTree[n][s]=[],this.changedTree[n][s][o]=r):(this.changedTree[n]={},this.changedTree[n][s]=[],this.changedTree[n][s][o]=r);const a=this.tree[n]?.[s]?.[o];if(1===a?.records.length&&(a.records[0][this.indicatorKeys[o]]=r),this.dataConfig?.updateAggregationOnEditCell)if(a)a.changedValue=r,this.recalculateTotals(t,e,i);else{const o=new v_({key:i,field:i,isRecord:!0});o.changedValue=r,this.recalculateTotals(t,e,i,o)}}recalculateTotals(t=[],e=[],i,r){if(!this.totals||0===Object.keys(this.tree).length||!(this.totals.row?.showGrandTotals||this.totals.row?.subTotalsDimensions&&this.totals.row.subTotalsDimensions.length>0&&!1!==this.totals.row.showSubTotals)&&!(this.totals.column?.showGrandTotals||this.totals.column?.subTotalsDimensions&&this.totals.column.subTotalsDimensions.length>0&&!1!==this.totals.column.showSubTotals))return;const o=Array.isArray(t)?t.join(this.stringJoinChar):t,n=Array.isArray(e)?e.join(this.stringJoinChar):e,s=this.indicatorKeysIncludeCalculatedFieldDependIndicatorKeys.indexOf(i),a=new Set,l=new Set,h=o.split(this.stringJoinChar),c=n.split(this.stringJoinChar),d=(t,e,i)=>{!t||e===o&&i===n||(a.add(t),e!==o&&i!==n||l.add(t))};if(this.totals?.row?.subTotalsDimensions&&!1!==this.totals.row.showSubTotals)for(let t=0;t<this.totals.row.subTotalsDimensions.length;t++){const e=this.totals.row.subTotalsDimensions[t],i=this.rows.indexOf(e);if(i>=0&&i<h.length){const t=h.slice(0,i+1);"tree"!==this.rowHierarchyType&&t.push(this.rowSubTotalLabel);const e=t.join(this.stringJoinChar);if(this.tree[e]?.[n]?.[s]&&d(this.tree[e][n][s],e,n),this.totals?.column?.subTotalsDimensions&&!1!==this.totals.column.showSubTotals)for(let t=0;t<this.totals.column.subTotalsDimensions.length;t++){const i=this.totals.column.subTotalsDimensions[t],r=this.columns.indexOf(i);if(r>=0&&r<c.length){const t=c.slice(0,r+1);t.push(this.colSubTotalLabel);const i=t.join(this.stringJoinChar);this.tree[e]?.[i]?.[s]&&d(this.tree[e][i][s],e,i)}}this.totals?.column?.showGrandTotals&&this.tree[e]?.[this.colGrandTotalLabel]?.[s]&&d(this.tree[e][this.colGrandTotalLabel][s],e,this.colGrandTotalLabel)}}if(this.totals?.row?.showGrandTotals){if(this.tree[this.rowGrandTotalLabel]?.[n]?.[s]){if(d(this.tree[this.rowGrandTotalLabel][n][s],this.rowGrandTotalLabel,n),this.totals?.column?.subTotalsDimensions&&!1!==this.totals.column.showSubTotals)for(let t=0;t<this.totals.column.subTotalsDimensions.length;t++){const e=this.totals.column.subTotalsDimensions[t],i=this.columns.indexOf(e);if(i>=0&&i<c.length){const t=c.slice(0,i+1);t.push(this.colSubTotalLabel);const e=t.join(this.stringJoinChar);this.tree[this.rowGrandTotalLabel]?.[e]?.[s]&&d(this.tree[this.rowGrandTotalLabel][e][s],this.rowGrandTotalLabel,e)}}this.totals?.column?.showGrandTotals&&this.tree[this.rowGrandTotalLabel]?.[this.colGrandTotalLabel]?.[s]&&d(this.tree[this.rowGrandTotalLabel][this.colGrandTotalLabel][s],this.rowGrandTotalLabel,this.colGrandTotalLabel)}if(this.totals?.column?.subTotalsDimensions&&!1!==this.totals.column.showSubTotals)for(let t=0;t<this.totals.column.subTotalsDimensions.length;t++){const e=this.totals.column.subTotalsDimensions[t],i=this.columns.indexOf(e);if(i>=0&&i<c.length){const t=c.slice(0,i+1);t.push(this.colSubTotalLabel);const e=t.join(this.stringJoinChar);this.tree[o]?.[e]?.[s]&&d(this.tree[o][e][s],o,e)}}this.totals?.column?.showGrandTotals&&this.tree[o]?.[this.colGrandTotalLabel]?.[s]&&d(this.tree[o][this.colGrandTotalLabel][s],o,this.colGrandTotalLabel),a.forEach((t=>{r&&l.has(t)&&t.push(r),t.recalculate()}))}}changeRecordFieldValue(t,e,i){let r=!1;for(let e=0;e<this.indicatorKeys.length;e++)this.indicatorKeys[e]===t&&(r=!0);if(!r){if(Array.isArray(this.records))for(let r=0,o=this.records.length;r<o;r++){const o=this.records[r];o[t]===e&&(o[t]=i)}else for(const r in this.records)for(let o=0,n=this.records[r].length;o<n;o++){const n=this.records[r][o];n[t]===e&&(n[t]=i)}this.rowFlatKeys={},this.colFlatKeys={},this.tree={},this.processRecords()}}_rowTreeHasChanged(){this.hasExtensionRowTree||(this.customRowTreeDimensionPaths=this.customTreeToDimensionPathArr(this.customRowTree,"row"))}changeDataConfig(t){this.rows=t.rows,this.columns=t.columns}addRecords(t){for(let e=0,i=t.length;e<i;e++){const i=t[e];this.processRecord(i)}Array.isArray(this.records)&&this.records.push(t)}customTreeToDimensionPathArr(t,e){const i=[],r=this;function o(t,n){t.virtual||(n[n.length-1]?.childKeys&&t.dimensionKey&&-1===n[n.length-1].childKeys.indexOf(t.dimensionKey)&&t.dimensionKey!==n[n.length-1].dimensionKey&&n[n.length-1].childKeys.push(t.dimensionKey),n.push({dimensionKey:Wx(t.indicatorKey)?void 0:t.dimensionKey,value:t.value,indicatorKey:t.indicatorKey,virtual:t.virtual})),t.children?.length>0?("tree"===r.rowHierarchyType&&"row"===e&&(n[n.length-1].childKeys=[],i.push([...n])),t.children?.forEach((t=>o(t,[...n])))):i.push(n)}return t?.forEach((t=>o(t,[]))),i}getFieldMatchColDimensionPaths(t){const e=[];for(let i=0;i<(this.customColTreeDimensionPaths?.length??0);i++){const r=this.customColTreeDimensionPaths[i];let o=!0;for(let e=0;e<r.length;e++){const i=r[e];if(i.dimensionKey&&t[i.dimensionKey]!==i.value||i.indicatorKey&&void 0===t[i.indicatorKey]){o=!1;break}}o&&e.push(r)}return e}getFieldMatchRowDimensionPaths(t){const e=[];for(let i=0;i<(this.customRowTreeDimensionPaths?.length??0);i++){const r=this.customRowTreeDimensionPaths[i];let o=!0;for(let e=0;e<r.length;e++){const i=r[e];if(i.dimensionKey&&t[i.dimensionKey]!==i.value||i.indicatorKey&&void 0===t[i.indicatorKey]){o=!1;break}if(i.childKeys&&e===r.length-1&&i.childKeys.length>0&&i.childKeys.find((e=>Wx(t[e])))){o=!1;break}}o&&(this.indicatorsAsCol||"tree"!==this.rowHierarchyType||r.find((t=>t.indicatorKey))||(o=!1)),o&&e.push(r)}return e}}function gW(t,e){return t.sort(((t,i)=>{const r=e.indexOf(t),o=e.indexOf(i);return r<o?-1:r>o?1:0}))}class pW extends rI{layoutNodeId={seqId:0};pivotSortState;dataset;flatDataToObjects;constructor(t,e){if(super(t,e),e=this.options){e.rowHierarchyType||(e.rowHierarchyType="grid"),e.columnHierarchyType||(e.columnHierarchyType="grid"),e.layout&&Object.assign(e,e.layout),this.internalProps.columns=i_(e.columns),this.internalProps.rows=i_(e.rows),this.internalProps.indicators=pz(e.indicators),e.indicators?.forEach(((t,e)=>{"object"==typeof t&&t?.editor&&(this.internalProps.indicators[e].editor=t.editor)})),this.internalProps.columnTree=!e.indicatorsAsCol||e.columns?.length||e.columnTree?i_(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||e.rows?.length||e.rowTree?i_(e.rowTree):[],this.internalProps.records=e.records,this.pagination=e.pagination,this.internalProps.columnResizeType=e.resize?.columnResizeType??e.columnResizeType??"column",this.internalProps.rowResizeType=e.resize?.rowResizeType??e.rowResizeType??"row",this.internalProps.dataConfig=i_(e.dataConfig),this.internalProps.columnWidthConfig=e.columnWidthConfig,this.internalProps.columnWidthConfigForRowHeader=e.columnWidthConfigForRowHeader;const t=this.internalProps.records;if(this.internalProps.recordsIsTwoDimensionalArray=!1,t?.[0]?.constructor===Array&&(this.internalProps.recordsIsTwoDimensionalArray=!0),!1===e.customConfig?.enableDataAnalysis){const e=new dL(this.internalProps.columnTree??[],this.layoutNodeId,this.options.columnHierarchyType,"grid"!==this.options.columnHierarchyType?this.options.columnExpandLevel??1:void 0),i=new dL(this.internalProps.rowTree??[],this.layoutNodeId,this.options.rowHierarchyType,"grid"!==this.options.rowHierarchyType?this.options.rowExpandLevel??1:void 0);this.internalProps.layoutMap=new lW(this,null,e,i),!1===this.internalProps.recordsIsTwoDimensionalArray&&(this.flatDataToObjects=new cW({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey},t))}else{const t=CL(this,e),{rowKeys:i,columnKeys:r,indicatorKeys:o}=t;let{columnDimensionTree:n,rowDimensionTree:s}=t;this.dataset=new uW(this.internalProps.dataConfig,i,r,o,this.internalProps.indicators,e.indicatorsAsCol??!0,e.records,e.rowHierarchyType,e.columnHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree,!1,!!e.extensionRows,!!e.parseCustomTreeToMatchRecords),e.columnTree?n.hasHideNode&&(vL(n.tree.children,e.indicators,!0,this),n.reset(n.tree.children)):(!1!==e.indicatorsAsCol&&(this.dataset.colHeaderTree=wL(this.dataset.colHeaderTree,e.indicators)),!1!==e.indicatorsAsCol&&e.indicators&&this.dataset.colHeaderTree&&vL(this.dataset.colHeaderTree,e.indicators,!1,this),n=new dL(this.dataset.colHeaderTree??[],this.layoutNodeId,this.options.columnHierarchyType,"grid"!==this.options.columnHierarchyType?this.options.columnExpandLevel??1:void 0)),e.rowTree?s.hasHideNode&&(vL(s.tree.children,e.indicators,!0,this),s.reset(s.tree.children)):(!1===e.indicatorsAsCol&&(this.dataset.rowHeaderTree=wL(this.dataset.rowHeaderTree,e.indicators)),!1===e.indicatorsAsCol&&this.dataset.rowHeaderTree&&e.indicators&&vL(this.dataset.rowHeaderTree,e.indicators,!1,this),s=new dL(this.dataset.rowHeaderTree??[],this.layoutNodeId,this.options.rowHierarchyType,"grid"!==this.options.rowHierarchyType?this.options.rowExpandLevel??1:void 0)),this.internalProps.layoutMap=new lW(this,this.dataset,n,s)}if(this._changePivotSortStateBySortRules(),(e.pivotSortState?.length??0)>0&&(this.pivotSortState=[],this.pivotSortState=e.pivotSortState),"node"!==X_.mode&&(this.editorManager=new Ez(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.stateManager.initCheckedState(t),this.scenegraph.createSceneGraph(),e.title){const t=wA.getComponent("title");this.internalProps.title=new t(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}setTimeout((()=>{this.fireListeners(OS.INITIALIZED,null)}),0)}}static get EVENT_TYPE(){return XE}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!1}get recordsCount(){return this.records?.length}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i){if(this.internalProps.layoutMap.isSeriesNumber(t,e)&&!0===this.internalProps.rowSeriesNumber.disableColumnResize)return!1;if(!this.internalProps.layoutMap.indicatorsAsCol){const e=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(e?.disableColumnResize)return!1}}return i}updateOption(t){const e=this.internalProps;if(super.updateOption(t),t.rowHierarchyType||(t.rowHierarchyType="grid"),t.columnHierarchyType||(t.columnHierarchyType="grid"),this.layoutNodeId={seqId:0},this.internalProps.columns=i_(t.columns),this.internalProps.rows=i_(t.rows),this.internalProps.indicators=t.indicators?.length?pz(t.indicators):[],t.indicators?.forEach(((t,e)=>{"object"==typeof t&&t?.editor&&(this.internalProps.indicators[e].editor=t.editor)})),this.internalProps.columnTree=!t.indicatorsAsCol||t.columns?.length||t.columnTree?i_(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||t.rows?.length||t.rowTree?i_(t.rowTree):[],t.records&&(this.internalProps.records=t.records),this.stateManager.initCheckedState(this.internalProps.records),this.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1),this.pagination=t.pagination,e.columnResizeType=t.resize?.columnResizeType??t.columnResizeType??"column",e.rowResizeType=t.resize?.rowResizeType??t.rowResizeType??"row",e.dataConfig=i_(t.dataConfig),this.internalProps.columnWidthConfig=t.columnWidthConfig,this.internalProps.columnWidthConfigForRowHeader=t.columnWidthConfigForRowHeader,"grid"!==t?.rowHierarchyType&&"grid"!==this.internalProps.layoutMap.rowHierarchyType&&this.internalProps.layoutMap.rowExpandLevel===t?.rowExpandLevel){const t=this.internalProps.layoutMap.rowDimensionTree.tree.children;this.internalProps.rowTree?.forEach(((e,i)=>{const r=t.find((t=>t.dimensionKey===e.dimensionKey&&t.value===e.value));r&&this._syncHierarchyState(r,e)}))}const i=this.internalProps.records;if(this.internalProps.recordsIsTwoDimensionalArray=!1,i?.[0]?.constructor===Array&&(this.internalProps.recordsIsTwoDimensionalArray=!0),!1===t.customConfig?.enableDataAnalysis){let r,o;t.columnTree&&(r=new dL(this.internalProps.columnTree??[],this.layoutNodeId,this.options.columnHierarchyType,"grid"!==this.options.columnHierarchyType?this.options.columnExpandLevel??1:void 0)),t.rowTree&&(o=new dL(this.internalProps.rowTree??[],this.layoutNodeId,this.options.rowHierarchyType,"grid"!==this.options.rowHierarchyType?this.options.rowExpandLevel??1:void 0)),e.layoutMap.clearHeaderPathCache(),e.layoutMap=new lW(this,null,r,o),!1===this.internalProps.recordsIsTwoDimensionalArray&&(this.flatDataToObjects=new cW({rows:e.layoutMap.fullRowDimensionKeys,columns:e.layoutMap.colDimensionKeys,indicators:e.layoutMap.indicatorKeys,indicatorsAsCol:e.layoutMap.indicatorsAsCol,indicatorDimensionKey:e.layoutMap.indicatorDimensionKey},i))}else{const r=CL(this,t),{rowKeys:o,columnKeys:n,indicatorKeys:s}=r;let{columnDimensionTree:a,rowDimensionTree:l}=r;this.dataset=new uW(e.dataConfig,o,n,s,this.internalProps.indicators,t.indicatorsAsCol??!0,i,t.rowHierarchyType,t.columnHierarchyType,this.internalProps.columnTree,this.internalProps.rowTree,!1,!!t.extensionRows,!!t.parseCustomTreeToMatchRecords),t.columnTree?a.hasHideNode&&(vL(a.tree.children,t.indicators,!0,this),a.reset(a.tree.children)):(!1!==t.indicatorsAsCol&&(this.dataset.colHeaderTree=wL(this.dataset.colHeaderTree,t.indicators)),!1!==t.indicatorsAsCol&&t.indicators&&this.dataset.colHeaderTree&&vL(this.dataset.colHeaderTree,t.indicators,!1,this),a=new dL(this.dataset.colHeaderTree??[],this.layoutNodeId,this.options.columnHierarchyType,"grid"!==this.options.columnHierarchyType?this.options.columnExpandLevel??1:void 0)),t.rowTree?l.hasHideNode&&(vL(l.tree.children,t.indicators,!0,this),l.reset(l.tree.children)):(!1===t.indicatorsAsCol&&(this.dataset.rowHeaderTree=wL(this.dataset.rowHeaderTree,t.indicators)),!1===t.indicatorsAsCol&&this.dataset.rowHeaderTree&&t.indicators&&vL(this.dataset.rowHeaderTree,t.indicators,!1,this),l=new dL(this.dataset.rowHeaderTree??[],this.layoutNodeId,this.options.rowHierarchyType,"grid"!==this.options.rowHierarchyType?this.options.rowExpandLevel??1:void 0)),e.layoutMap=new lW(this,this.dataset,a,l)}if(this._changePivotSortStateBySortRules(),(t.pivotSortState?.length??0)>0&&(this.pivotSortState=[],this.pivotSortState=t.pivotSortState),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.releaseList&&(e.releaseList.forEach((t=>t?.release?.())),e.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),t.title){const e=wA.getComponent("title");this.internalProps.title=new e(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}return new Promise((t=>{setTimeout(t,0)}))}updatePagination(t){this.internalProps.layoutMap.clearHeaderPathCache(),t?(this.pagination||(this.pagination={currentPage:0,perPageCount:0}),"number"==typeof t.currentPage&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(this.pagination),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()):this.pagination&&(this.pagination=void 0,this.scenegraph.clearCells(),this.internalProps.layoutMap.setPagination(void 0),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render())}refreshHeader(){this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){const t=this,{layoutMap:e}=t.internalProps;e&&(t.colCount=e.colCount??0,t.rowCount=e.rowCount??0,this.internalProps.frozenColCount=this.options.frozenColCount?this.options.frozenColCount:(e.rowHeaderLevelCount??0)+e.leftRowSeriesNumberColumnCount,t.frozenRowCount=Math.max(e.headerLevelCount,this.options.frozenRowCount??0),t.bottomFrozenRowCount!==(this.options.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=this.options.bottomFrozenRowCount??0),t.rightFrozenColCount!==(this.options.rightFrozenColCount??0)&&(t.rightFrozenColCount=this.options.rightFrozenColCount??0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount),this.stateManager.setFrozenRow(this.frozenRowCount))}_getSortFuncFromHeaderOption(t,e,i){}get rowHierarchyType(){return this.internalProps.layoutMap.rowHierarchyType}get columnHierarchyType(){return this.internalProps.layoutMap.columnHierarchyType}_syncHierarchyState(t,e){t.value===e.value&&t.dimensionKey===e.dimensionKey&&(e.hierarchyState=e.hierarchyState??(e?.children?t.hierarchyState:void 0),e?.children?.forEach(((e,i)=>{if(t?.children?.[i]&&e){const i=t.children.find((t=>t.dimensionKey===e.dimensionKey&&t.value===e.value));i&&this._syncHierarchyState(i,e)}})))}getRecordShowIndexByCell(t,e){}getTableIndexByRecordIndex(t){}getTableIndexByField(t){}getCellAddrByFieldRecord(t,e){}getBodyIndexByRow(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByRow(t)}getBodyIndexByCol(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByCol(t)}getFieldData(t,e,i){if(!this.internalProps.layoutMap.isHeader(e,i)){if(this.internalProps.recordsIsTwoDimensionalArray){const t=this.getBodyIndexByRow(i),r=this.getBodyIndexByCol(e);return this.records[t]?.[r]}if(this.dataset){const r=this.internalProps.layoutMap.getCellHeaderPaths(e,i);if(r){let o;const n=r.colHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(o={position:"col",index:e}),t.indicatorKey??t.value))),s=r.rowHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(o={position:"row",index:e}),t.indicatorKey??t.value))),a=this.dataset.getAggregator(s,n,this.internalProps.layoutMap.getIndicatorKey(e,i),!0,o);if(a.records&&a.records.length>=1)return a.records[0][t]}}else if(this.flatDataToObjects){const r=this.internalProps.layoutMap.getCellHeaderPaths(e,i),o=r.colHeaderPaths.map((t=>t.indicatorKey??t.value)),n=r.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),s=this.flatDataToObjects.getTreeNode(n,o,this.internalProps.layoutMap.getBody(e,i).indicatorKey,!1);if(s?.record)return s?.record[t]}}}getCellValue(t,e,i){if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}if(this.internalProps.layoutMap.isSeriesNumber(t,e)){if(this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:i}=this.internalProps.layoutMap.getSeriesNumberHeader(t,e);return i}const{format:i}=this.internalProps.layoutMap.getSeriesNumberBody(t,e);return"function"==typeof i?i(t,e,this):e-this.columnHeaderLevelCount+1}if(this.internalProps.layoutMap.isHeader(t,e)){const{title:i,fieldFormat:r}=this.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r(i,t,e,this):i}if(this.internalProps.recordsIsTwoDimensionalArray){const{fieldFormat:i}=this.internalProps.layoutMap.getBody(t,e),r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t),n=this.records[r]?.[o];if("function"==typeof i){return i(n,t,e,this)}return n}if(this.dataset){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e);let r;const o=i.colHeaderPaths?.filter((t=>!t.virtual))?.map(((t,e)=>(t.indicatorKey&&(r={position:"col",index:e}),t.indicatorKey??t.value))),n=i.rowHeaderPaths?.filter((t=>!t.virtual))?.map(((t,e)=>(t.indicatorKey&&(r={position:"row",index:e}),t.indicatorKey??t.value))),s=this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!0,r),{fieldFormat:a}=this.internalProps.layoutMap.getBody(t,e);return s.formatValue?s.formatValue(t,e,this):"function"==typeof a?a(s?.value(),t,e,this):s?.value()??""}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey),{fieldFormat:s}=this.internalProps.layoutMap.getBody(t,e);return"function"==typeof s?s(n?.value,t,e,this):n?.value??""}}getCellOriginValue(t,e){const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(this.internalProps.recordsIsTwoDimensionalArray){const i=this.getBodyIndexByRow(e),r=this.getBodyIndexByCol(t),o=this.records[i]?.[r];return o}if(this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value))),s=this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!0,i);return s.value?s.value():void 0}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey);return n?.value}}getCellRawValue(t,e){const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(this.internalProps.recordsIsTwoDimensionalArray){const i=this.getBodyIndexByRow(e),r=this.getBodyIndexByCol(t),o=this.records[i]?.[r];return o}if(this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value))),s=this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!1,i);return s.value?s.value():void 0}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey,!1);return n?.value}}getCellOriginRecord(t,e){if(!this.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.recordsIsTwoDimensionalArray){const i=this.getBodyIndexByRow(e),r=this.getBodyIndexByCol(t),o=this.records[i]?.[r];return o}if(this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value)));return this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!0,i).records}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey);return n?.record}}}getCellRawRecord(t,e){if(!this.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.recordsIsTwoDimensionalArray){const i=this.getBodyIndexByRow(e),r=this.getBodyIndexByCol(t),o=this.records[i]?.[r];return o}if(this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths?.filter((t=>!t.virtual)).map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value)));return this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!1,i).records}if(this.flatDataToObjects){const i=this.internalProps.layoutMap.getCellHeaderPaths(t,e),r=i.colHeaderPaths.map((t=>t.indicatorKey??t.value)),o=i.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),n=this.flatDataToObjects.getTreeNode(o,r,this.internalProps.layoutMap.getBody(t,e).indicatorKey,!1);return n?.record}}}updateSortRules(t,e,i){this.internalProps.dataConfig?this.internalProps.dataConfig.sortRules=t:this.internalProps.dataConfig={sortRules:t},this.dataset.updateSortRules(t),this._changePivotSortStateBySortRules();const{layoutMap:r}=this.internalProps;r.resetHeaderTree(),this.scenegraph.clearCells(),Xx(e)&&Xx(i)?(this.isRowHeader(e,i)?(this.setMinMaxLimitWidth(!0),this.internalProps._widthResizedColMap.clear()):this.isCornerHeader(e,i)?"column"===r.cornerSetting.titleOnDimension?(this.setMinMaxLimitWidth(!0),this.internalProps._widthResizedColMap.clear()):"row"===r.cornerSetting.titleOnDimension&&this.internalProps._heightResizedRowMap.clear():this.isColumnHeader(e,i)&&this.internalProps._heightResizedRowMap.clear(),this.refreshRowColCount()):this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.createSceneGraph(!0),this.render()}_changePivotSortStateBySortRules(){this.pivotSortState=[];const t=this.internalProps.dataConfig?.sortRules??[];for(let e=0;e<t.length;e++){const i=t[e],r=[];if(i.sortByIndicator&&i.sortField===(this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1])){for(let t=0;t<i.query.length;t++)r.push({dimensionKey:this.dataset.indicatorsAsCol?this.dataset.columns[t]:this.dataset.rows[t],value:i.query[t]});r.push({indicatorKey:i.sortByIndicator,value:this.internalProps.layoutMap.getIndicatorInfo(i.sortByIndicator)?.title??i.sortByIndicator})}else r.push({dimensionKey:i.sortField,isPivotCorner:!0,value:i.sortField});const o=i.sortType?i.sortType.toUpperCase():"ASC";this.pivotSortState.push({dimensions:r,order:Px[o]})}}_parseColumnWidthConfig(t){for(let e=0;e<t?.length;e++){const i=t[e],r=i.dimensions,o=i.width,n=this.getCellAddressByHeaderPaths(r);if(n&&n.col>=this.rowHeaderLevelCount){const t=this.getCellHeaderPaths(n.col,this.columnHeaderLevelCount);if(t.colHeaderPaths.length===r.length){let e=!0;for(let i=0;i<r.length;i++){const o=r[i];if(t.colHeaderPaths.findIndex(((t,e)=>t.indicatorKey===o.indicatorKey||t.dimensionKey===o.dimensionKey&&t.value===o.value))<0){e=!1;break}}e&&!this.internalProps._widthResizedColMap.has(n.col)&&(this._setColWidth(n.col,o),this.internalProps._widthResizedColMap.add(n.col))}}else n&&n.col<this.rowHeaderLevelCount&&(this.internalProps._widthResizedColMap.has(n.col)||(this._setColWidth(n.col,o),this.internalProps._widthResizedColMap.add(n.col)))}}_parseColumnWidthConfigForRowHeader(t){for(let e=0;e<t?.length;e++){const i=t[e],r=i.dimensions,o=i.width,n=this.getCellAddressByHeaderPaths(r);n&&n.col<this.rowHeaderLevelCount&&(this.internalProps._widthResizedColMap.has(n.col)||(this._setColWidth(n.col,o),this.internalProps._widthResizedColMap.add(n.col)))}}updatePivotSortState(t){this.pivotSortState=t}sort(t,e,i){let r;if(this.isCornerHeader(t,e)){const i=this.getHeaderDefine(t,e);r=[];const o={isPivotCorner:!0,dimensionKey:i.value,value:i.value};r.push(o)}else r=this.isColumnHeader(t,e)?this.getCellHeaderPaths(t,e).colHeaderPaths:this.getCellHeaderPaths(t,e).rowHeaderPaths;const o=r[r.length-1].indicatorKey,n=this.getHeaderDefine(t,e);if(n.sort){if(this.dataset.sortRules){const t={};for(let e=this.dataset.sortRules.length-1;e>=0;e--){const i=this.dataset.sortRules[e];(n.dimensionKey&&i.sortField===n.dimensionKey||o&&i.sortField===(this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1]))&&(t[i.sortField]=i,this.dataset.sortRules.splice(e,1))}if(o){const e=this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1];this.dataset.sortRules.push({sortField:e,sortType:Px[i],sortByIndicator:o,query:r.reduce(((t,e)=>(e.dimensionKey&&t.push(e.value),t)),[]),sortFunc:t[e]?.sortFunc})}else this.dataset.sortRules.push(Object.assign(t[n.dimensionKey]??{},{sortField:n.dimensionKey,sortType:Px[i]}))}else this.dataset.sortRules=o?[{sortField:this.dataset.indicatorsAsCol?this.dataset.rows[this.dataset.rows.length-1]:this.dataset.columns[this.dataset.columns.length-1],sortType:Px[i],sortByIndicator:o,query:r.reduce(((t,e)=>(e.dimensionKey&&t.push(e.value),t)),[])}]:[{sortField:n.dimensionKey,sortType:Px[i]}];this.updateSortRules(this.dataset.sortRules,t,e)}}getPivotSortState(t,e){if(!this.pivotSortState)return;const i=this.getCellRange(t,e);for(let t=0;t<this.pivotSortState.length;t++){const e=this.pivotSortState[t],r=e.dimensions,o=this.getCellAddressByHeaderPaths(r),n=e.order;if(o&&MS(i,o.col,o.row))return n}}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),r=this.getCellRange(e.col,e.row),o=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(o){if("column"===o.moveType){if(this.internalProps.recordsIsTwoDimensionalArray)for(let t=0;t<this.internalProps.records.length;t++){const e=this.internalProps.records[t].splice(o.sourceIndex-this.rowHeaderLevelCount,o.sourceSize);e.unshift(o.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[t],e)}this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.setMinMaxLimitWidth()}else if("row"===o.moveType){if(this.internalProps.recordsIsTwoDimensionalArray){const t=this.internalProps.records.splice(o.sourceIndex-this.columnHeaderLevelCount,o.sourceSize);t.unshift(o.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,t)}o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex)}return o}return null}toggleHierarchyState(t,e,i=!0){this.internalProps.layoutMap.clearHeaderPathCache();const r=this.getHierarchyState(t,e);if(r===kx.expand)this._refreshHierarchyState(t,e,i),this.fireListeners(XE.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:kx.collapse});else if(r===kx.collapse){const r=this.internalProps.layoutMap.getHeadNode(t,e);Array.isArray(r.children)&&this._refreshHierarchyState(t,e,i),this.fireListeners(XE.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:kx.expand,originData:r})}}_refreshHierarchyState(t,e,i=!0,r){this.frozenColCount,this.frozenRowCount;const o=this.getBodyVisibleRowRange().rowStart;this.internalProps._oldRowCount=this.rowCount,this.internalProps._oldColCount=this.colCount;let n=!1,s=!1;this.stateManager.updateHoverIcon(t,e,void 0,void 0);const a=this.internalProps.layoutMap.checkHasChart();a&&(this.autoFillWidth&&(n=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight));const l=this.internalProps.layoutMap.isRowHeader(t,e)?this.internalProps.layoutMap.toggleHierarchyState(t,e):this.internalProps.layoutMap.toggleHierarchyStateForColumnTree(t,e);r&&r(),this.refreshRowColCount(),this.frozenColCount,this.frozenRowCount,this.clearCellStyleCache(),"tree"===this.rowHierarchyType&&this.scenegraph.updateHierarchyIcon(t,e),this.reactCustomLayout?.clearCache(),"grid-tree"!==this.rowHierarchyType&&"grid-tree"!==this.columnHierarchyType?this.scenegraph.updateRow(l.removeCellPositionsRowDirection,l.addCellPositionsRowDirection,l.updateCellPositionsRowDirection,i):(this.internalProps.stick.changedCells.clear(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.scrollToRow(o)),this.reactCustomLayout?.updateAllCustomCell(),a&&(this.autoFillWidth&&!n&&(n=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!s&&(s=this.getAllRowsHeight()<=this.tableNoFrameHeight),("adaptive"===this.widthMode||n||"adaptive"===this.heightMode||s)&&this.scenegraph.updateChartSizeForResizeColWidth(-1)),this.internalProps._oldRowCount=void 0,this.internalProps._oldColCount=void 0}getHeaderCellAddressByPath(t){return this.internalProps.layoutMap.getPivotCellAdress(t)}getCellAddressByHeaderPaths(t){return this.internalProps.layoutMap.getCellAdressByHeaderPath(t)}getHeaderPathByXY(t){let e;e=t?this.getCellAt(t.x+this.getFrozenColsWidth()+this.scrollLeft+1,t.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1);return this.internalProps.layoutMap.getCellHeaderPaths(e.col,e.row)}getHierarchyState(t,e){return this._getHeaderLayoutMap(t,e)?.hierarchyState}getLayoutColumnTree(){return this.internalProps.layoutMap.getLayoutColumnTree()}getLayoutColumnTreeCount(){return this.internalProps.layoutMap.getLayoutColumnTreeCount()}getLayoutRowTree(){return this.internalProps.layoutMap.getLayoutRowTree()}getLayoutRowTreeCount(){return this.internalProps.layoutMap.getLayoutRowTreeCount()}getCellHeaderTreeNodes(t,e){return this.internalProps.layoutMap.getCellHeaderPathsWithTreeNode(t,e)}getMenuInfo(t,e,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(t,e);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),isPivotCorner:this.isCornerHeader(t,e),event:void 0}}setRecords(t){AH();const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=t,this.internalProps.recordsIsTwoDimensionalArray=!1,t?.[0]?.constructor===Array&&(this.internalProps.recordsIsTwoDimensionalArray=!0);const i=this.options,r=this.internalProps;if(!1===this.options.customConfig?.enableDataAnalysis)!1===this.internalProps.recordsIsTwoDimensionalArray&&(this.flatDataToObjects=new cW({rows:r.layoutMap.fullRowDimensionKeys,columns:r.layoutMap.colDimensionKeys,indicators:r.layoutMap.indicatorKeys,indicatorsAsCol:r.layoutMap.indicatorsAsCol,indicatorDimensionKey:r.layoutMap.indicatorDimensionKey},t));else{let e,o;this.dataset.setRecords(t),i.columnTree?e=r.layoutMap.columnDimensionTree:(!1!==i.indicatorsAsCol&&i.indicators&&this.dataset.colHeaderTree&&vL(this.dataset.colHeaderTree,i.indicators,!1,this),e=new dL(this.dataset.colHeaderTree??[],this.layoutNodeId,this.options.columnHierarchyType,"grid"!==this.options.columnHierarchyType?this.options.columnExpandLevel??1:void 0)),i.rowTree?o=r.layoutMap.rowDimensionTree:(!1===i.indicatorsAsCol&&this.dataset.rowHeaderTree&&i.indicators&&vL(this.dataset.rowHeaderTree,i.indicators,!1,this),o=new dL(this.dataset.rowHeaderTree??[],this.layoutNodeId,this.options.rowHierarchyType,"grid"!==this.options.rowHierarchyType?this.options.rowExpandLevel??1:void 0)),r.layoutMap=new lW(this,this.dataset,e,o),this.pivotSortState=[],i.pivotSortState&&(this.pivotSortState=i.pivotSortState)}if(this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder(),this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}}startEditCell(t,e,i){if(Wx(t)&&Wx(e))this.eventManager.isDraging=!1,this.selectCell(t,e),this.editorManager.startEditCell(t,e,i);else if(this.stateManager.select?.cellPos){const{col:t,row:e}=this.stateManager.select.cellPos;Wx(t)&&Wx(e)&&this.editorManager.startEditCell(t,e,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){let i;if(this.isCornerHeader(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerEditor??this.options.headerEditor}else if(this.isHeader(t,e)){const r=this.getHeaderDefine(t,e);i=r?.headerEditor??this.options.headerEditor}else{const r=this.getBodyColumnDefine(t,e);i=r?.editor??this.options.editor}if("function"==typeof i){i=i({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return"string"==typeof i?lI(i):i}isHasEditorDefine(t,e){const i=this.getBodyColumnDefine(t,e);let r=i?.editor??this.options.editor;if("function"==typeof r){r=r({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})}return Wx(r)}changeCellValue(t,e,i,r=!1){if(r&&this.isHasEditorDefine(t,e)||!1===r){let r=i;const o=this.getCellOriginValue(t,e),n=this.getCellRawValue(t,e);"number"==typeof n&&hS(i)&&(r=parseFloat(i)),this._changeCellValueToDataSet(t,e,o,r);const s=this.getCellRange(t,e);for(let t=s.start.col;t<=s.end.col;t++)for(let e=s.start.row;e<=s.end.row;e++)this.scenegraph.updateCellContent(t,e);if(this.options.dataConfig?.updateAggregationOnEditCell)for(let t=0;t<this.colCount;t++)for(let e=0;e<this.rowCount;e++)this.internalProps.layoutMap.isAggregation(t,e)&&this.scenegraph.updateCellContent(t,e);if("adaptive"===this.widthMode||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)0===this.internalProps._widthResizedColMap.size&&this.scenegraph.recalculateColWidths();else if(!this.internalProps._widthResizedColMap.has(t)){const e=this.getColWidth(t),i=hk(t,0,this.rowCount-1,this,!1);i!==e&&this.scenegraph.updateColWidth(t,i-e)}if("adaptive"===this.heightMode||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)0===this.internalProps._heightResizedRowMap.size&&this.scenegraph.recalculateRowHeights();else if(this.isAutoRowHeight(e)&&!this.internalProps._heightResizedRowMap.has(e)){const t=this.getRowHeight(e),i=GP(e,0,this.colCount-1,this);this.scenegraph.updateRowHeight(e,i-t)}o!==r&&this.fireListeners(OS.CHANGE_CELL_VALUE,{col:t,row:e,rawValue:n,currentValue:o,changedValue:r}),this.scenegraph.updateNextFrame()}}changeCellValues(t,e,i,r=!1){let o=t,n=e;const s=[],a=[];for(let r=0;r<i.length&&!(e+r>this.rowCount-1);r++){const o=i[r],n=[],l=[];s.push(n),a.push(l);for(let i=0;i<o.length&&!(t+i>this.colCount-1);i++){const o=this.getCellRawValue(t+i,e+r);n.push(o);const s=this.getCellOriginValue(t+i,e+r);l.push(s)}}for(let l=0;l<i.length&&!(e+l>this.rowCount-1);l++){n=e+l;const h=i[l];let c=t;for(let i=0;i<h.length&&!(t+i>this.colCount-1);i++)if(c=t+i,r&&this.isHasEditorDefine(t+i,e+l)||!1===r){const r=h[i];let o=r;const n=a[l][i],c=s[l][i];"number"==typeof c&&hS(r)&&(o=parseFloat(r)),this._changeCellValueToDataSet(t+i,e+l,n,o);const d=this.getCellOriginValue(t+i,e+l);d!==n&&this.fireListeners(OS.CHANGE_CELL_VALUE,{col:t+i,row:e+l,rawValue:c,currentValue:n,changedValue:d})}o=Math.max(o,c)}const l=this.getCellRange(t,e),h=this.getCellRange(o,n);for(let t=l.start.col;t<=h.end.col;t++)for(let e=l.start.row;e<=h.end.row;e++)this.scenegraph.updateCellContent(t,e);if(this.options.dataConfig?.updateAggregationOnEditCell)for(let t=0;t<this.colCount;t++)for(let e=0;e<this.rowCount;e++)this.internalProps.layoutMap.isAggregation(t,e)&&this.scenegraph.updateCellContent(t,e);if("adaptive"===this.widthMode||this.autoFillWidth&&this.getAllColsWidth()<=this.tableNoFrameWidth)0===this.internalProps._widthResizedColMap.size&&this.scenegraph.recalculateColWidths();else for(let e=t;e<=h.end.col;e++)if(!this.internalProps._widthResizedColMap.has(e)){const t=this.getColWidth(e),i=hk(e,0,this.rowCount-1,this,!1);i!==t&&this.scenegraph.updateColWidth(e,i-t)}if("adaptive"===this.heightMode||this.autoFillHeight&&this.getAllRowsHeight()<=this.tableNoFrameHeight)this.scenegraph.recalculateRowHeights();else if(this.isAutoRowHeight(e)){const t=[],i=[];for(let r=e;r<=h.end.row;r++)if(this.rowHeightsMap.get(r)){const e=this.getRowHeight(r),o=GP(r,0,this.colCount-1,this);t.push(r),i.push(o-e)}this.scenegraph.updateRowsHeight(t,i)}this.scenegraph.updateNextFrame()}_changeCellValueToDataSet(t,e,i,r){if(this.internalProps.recordsIsTwoDimensionalArray){const i=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t);this.records[i][o]=r}else if(this.dataset){const o=this.internalProps.layoutMap.getCellHeaderPaths(t,e);if(this.isCornerHeader(t,e))this.internalProps.layoutMap.changeCornerTitle(t,e,r);else if(this.isHeader(t,e))this.internalProps.layoutMap.changeTreeNodeTitle(t,e,r),!this.isCornerHeader(t,e)&&this.dataset.changeRecordFieldValue(o.colHeaderPaths?.length?o.colHeaderPaths[o.colHeaderPaths.length-1].indicatorKey??o.colHeaderPaths[o.colHeaderPaths.length-1].dimensionKey:o.rowHeaderPaths[o.rowHeaderPaths.length-1].indicatorKey??o.rowHeaderPaths[o.rowHeaderPaths.length-1].dimensionKey,i,r);else{const i=o.colHeaderPaths?.filter((t=>!t.virtual)).map((t=>t.indicatorKey??t.value)),n=o.rowHeaderPaths?.filter((t=>!t.virtual)).map((t=>t.indicatorKey??t.value));this.dataset.changeTreeNodeValue(this.internalProps.layoutMap.indicatorsAsCol?n:n.slice(0,-1),this.internalProps.layoutMap.indicatorsAsCol?i.slice(0,-1):i,this.internalProps.layoutMap.getIndicatorKey(t,e),r)}}else if(this.flatDataToObjects){const o=this.internalProps.layoutMap.getCellHeaderPaths(t,e);if(this.isHeader(t,e))this.internalProps.layoutMap.changeTreeNodeTitle(t,e,r),!this.isCornerHeader(t,e)&&this.flatDataToObjects.changeRecordFieldValue(o.colHeaderPaths?.length?o.colHeaderPaths[o.colHeaderPaths.length-1].indicatorKey??o.colHeaderPaths[o.colHeaderPaths.length-1].dimensionKey:o.rowHeaderPaths[o.rowHeaderPaths.length-1].indicatorKey??o.rowHeaderPaths[o.rowHeaderPaths.length-1].dimensionKey,i,r);else{const i=o.colHeaderPaths.map((t=>t.indicatorKey??t.value)),n=o.rowHeaderPaths.map((t=>t.indicatorKey??t.value));this.flatDataToObjects.changeTreeNodeValue(n,i,this.internalProps.layoutMap.getBody(t,e).indicatorKey,r)}}}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:t,rowsDefine:e,indicatorsDefine:i}=this.internalProps.layoutMap;for(let e=0;e<t.length;e++){const i=t[e];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.customLayout||e.headerCustomLayout||e.customRender||e.headerCustomRender))return!0}return!1}changeRecordOrder(t,e){}setTreeNodeChildren(t,e,i,r){if(this.flatDataToObjects){this.internalProps.layoutMap.getHeadNode(i,r).children=t,this._refreshHierarchyState(i,r,!0,(()=>{this.flatDataToObjects.changeDataConfig({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys,indicators:this.internalProps.layoutMap.indicatorKeys,indicatorsAsCol:this.internalProps.layoutMap.indicatorsAsCol,indicatorDimensionKey:this.internalProps.layoutMap.indicatorDimensionKey}),this.flatDataToObjects.addRecords(e)}))}else{this.internalProps.layoutMap.getHeadNode(i,r).children=t,this._refreshHierarchyState(i,r,!0,(()=>{this.dataset._rowTreeHasChanged(),this.dataset.changeDataConfig({rows:this.internalProps.layoutMap.fullRowDimensionKeys,columns:this.internalProps.layoutMap.colDimensionKeys}),this.dataset.addRecords(e)}))}}updateFilterRules(t){this.internalProps.dataConfig.filterRules=t,this.dataset.updateFilterRules(t),this.renderWithRecreateCells()}getFilteredRecords(){return this.dataset?.filterRules}getCellPivotRole(t,e){const i=this.getCellHeaderPaths(t,e),{cellLocation:r,colHeaderPaths:o,rowHeaderPaths:n}=i;let s=o.length?"normal":void 0,a=n.length?"normal":void 0;return o.forEach((t=>{"sub-total"===t.role?s="sub-total":"grand-total"===t.role&&(s="grand-total")})),n.forEach((t=>{"sub-total"===t.role?a="sub-total":"grand-total"===t.role&&(a="grand-total")})),{colRole:s,rowRole:a,cellLocation:r}}setLoadingHierarchyState(t,e){this.scenegraph.setLoadingHierarchyState(t,e)}expandAllForRowTree(){"tree"!==this.rowHierarchyType&&"grid-tree"!==this.rowHierarchyType||this.internalProps.layoutMap.rowDimensionTree&&(this.internalProps.layoutMap.clearHeaderPathCache(),this.internalProps.layoutMap.expandAllForRowDimensionTree(),this.renderWithRecreateCells(),this.fireListeners(XE.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:kx.expand,changeAll:!0}))}collapseAllForRowTree(){"tree"!==this.rowHierarchyType&&"grid-tree"!==this.rowHierarchyType||this.internalProps.layoutMap.rowDimensionTree&&(this.internalProps.layoutMap.clearHeaderPathCache(),this.internalProps.layoutMap.collapseAllForRowDimensionTree(),this.renderWithRecreateCells(),this.fireListeners(XE.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:kx.collapse,changeAll:!0}))}expandAllForColumnTree(){"grid-tree"===this.columnHierarchyType&&this.internalProps.layoutMap.columnDimensionTree&&(this.internalProps.layoutMap.clearHeaderPathCache(),this.internalProps.layoutMap.expandAllForColumnDimensionTree(),this.renderWithRecreateCells(),this.fireListeners(XE.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:kx.expand,changeAll:!0}))}collapseAllForColumnTree(){"grid-tree"===this.columnHierarchyType&&this.internalProps.layoutMap.columnDimensionTree&&(this.internalProps.layoutMap.clearHeaderPathCache(),this.internalProps.layoutMap.collapseAllForColumnDimensionTree(),this.renderWithRecreateCells(),this.fireListeners(XE.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:kx.collapse,changeAll:!0}))}release(){this.internalProps.layoutMap.clearHeaderPathCache(),this.editorManager.release(),super.release()}}_D(),SD(),AD(),TD(),RD(),BD(),MD(),JD(),QD(),tW(),eW(),oW(),nW(),sW();nW();_D(),SD(),AD(),TD(),RD(),BD(),MD(),ZD(),JD(),QD(),tW(),eW(),oW(),nW(),sW();class fW extends rl{constructor(t){t.direction&&(t.flexDirection=t.direction),!t.justifyContent||"start"!==t.justifyContent&&"end"!==t.justifyContent||(t.justifyContent="flex-"+t.justifyContent),!t.alignItems||"start"!==t.alignItems&&"end"!==t.alignItems||(t.alignItems="flex-"+t.alignItems),!t.alignContent||"start"!==t.alignContent&&"end"!==t.alignContent||(t.alignContent="flex-"+t.alignContent),t.display="flex",t.flexDirection||(t.flexDirection="row"),t.clip=!0,t.fill=t?.background?.fill,t.stroke=t?.background?.stroke,t.lineWidth=t?.background?.lineWidth,t.cornerRadius=t?.background?.cornerRadius;const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}}var mW=Object.freeze({__proto__:null,Arc:class extends Rh{constructor(t){const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},CheckBox:wx,Circle:class extends Kl{constructor(t){const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},Container:fW,Group:class extends rl{constructor(t){const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},GroupElement:class extends fW{constructor(t){t.flexWrap="nowrap",super(t)}},Icon:class extends ph{svg;iconName;cache;constructor(t){let e;if(Vx(t.iconName)){e=MM()[t.iconName],e&&(t.width=t.width??e.width,t.height=t.height??e.height,t.svg=e.svg,t.cursor=e.cursor)}t.svg&&(t.image=t.svg);const i=Ux(t.boundsPadding),r=[t.marginTop??(i?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(i?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(i?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(i?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=r,super(t),this.cache=e}},Image:class extends ph{constructor(t){t.src&&(t.image=t.src),"circle"===t.shape&&(t.cornerRadius=t.width/2);const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},Line:nh,Radio:vx,Rect:class extends lh{constructor(t){const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}},Tag:class extends My{constructor(t){const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,super(t)}getSize(t){this.AABBBounds.width()}},Text:class extends ql{constructor(t){t.textBaseline||(t.textBaseline="top");const e=Ux(t.boundsPadding),i=[t.marginTop??(e?t.boundsPadding[0]:t.boundsPadding)??0,t.marginRight??(e?t.boundsPadding[1]:t.boundsPadding)??0,t.marginBottom??(e?t.boundsPadding[2]??t.boundsPadding[0]:t.boundsPadding)??0,t.marginLeft??(e?t.boundsPadding[3]??t.boundsPadding[1]:t.boundsPadding)??0];t.boundsPadding=i,t.fill=t.fill??"#000",super(t)}getSize(t){this.AABBBounds.width()}},percentCalc:function(t,e=0){return{percent:t,delta:e}}});function bW(t){const e={seqId:0},i={isPivotChart:!0};let r,o,n,s;t.columnTree&&(!1!==t.indicatorsAsCol&&(n=wL(t.columnTree,t.indicators)),r=new dL(t.columnTree??[],e)),t.rowTree&&(!1===t.indicatorsAsCol&&(s=wL(t.rowTree,t.indicators)),o=new dL(t.rowTree??[],e));const a=o.dimensionKeys?.count?o.dimensionKeys.valueArr():t.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],l=r.dimensionKeys?.count?r.dimensionKeys.valueArr():t.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],h=t.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];i.collectValuesBy=function(t,e,i){const r={};for(let o=0,n=t.indicators?.length;o<n;o++)if("string"!=typeof t.indicators[o]&&t.indicators[o].chartSpec)if(!1===t.indicatorsAsCol){const n=t.indicators[o];if(r[n.indicatorKey]={by:i,range:!0,sumBy:!1!==n.chartSpec?.stack&&e.concat(n.chartSpec?.xField)},n.chartSpec.series)n.chartSpec.series.forEach((t=>{const o="string"==typeof t.xField?t.xField:t.xField[0];r[o]={by:e,type:"horizontal"!==t.direction?"xField":void 0,range:"horizontal"===t.direction,sortBy:"horizontal"!==t.direction?t?.data?.fields?.[o]?.domain??n.chartSpec?.data?.fields?.[o]?.domain:void 0};const s=t.yField;r[s]={by:i,range:"horizontal"!==t.direction,sumBy:!1!==t.stack&&e.concat(t?.xField),sortBy:"horizontal"===t.direction?t?.data?.fields?.[s]?.domain??n.chartSpec?.data?.fields?.[s]?.domain:void 0}}));else{const s="string"==typeof n.chartSpec.xField?n.chartSpec.xField:n.chartSpec.xField[0];r[s]={by:e,type:"horizontal"!==n.chartSpec.direction?"xField":void 0,range:"horizontal"===n.chartSpec.direction,sortBy:"horizontal"!==n.chartSpec.direction?n.chartSpec?.data?.fields?.[s]?.domain:void 0};const a=n.chartSpec.yField;r[a]={by:i,range:"horizontal"!==t.indicators[o].chartSpec.direction,sumBy:!1!==n.chartSpec.stack&&e.concat(n.chartSpec?.xField),sortBy:"horizontal"===n.chartSpec.direction?n.chartSpec?.data?.fields?.[a]?.domain:void 0}}}else{const n=t.indicators[o];if(r[n.indicatorKey]={by:e,range:!0,sumBy:!1!==n.chartSpec?.stack&&i.concat(n.chartSpec?.yField)},n.chartSpec.series)n.chartSpec.series.forEach((t=>{const o="string"==typeof t.yField?t.yField:t.yField[0];r[o]={by:i,type:"horizontal"===t.direction?"yField":void 0,range:"horizontal"!==t.direction,sortBy:"horizontal"===t.direction?t?.data?.fields?.[o]?.domain??n.chartSpec?.data?.fields?.[o]?.domain:void 0};const s=t.xField;r[s]={by:e,range:"horizontal"===t.direction,sumBy:!1!==t.stack&&i.concat(t?.yField),sortBy:"horizontal"!==t.direction?t?.data?.fields?.[s]?.domain??n.chartSpec?.data?.fields?.[s]?.domain:void 0}}));else{const s="string"==typeof n.chartSpec.yField?n.chartSpec.yField:n.chartSpec.yField[0];r[s]={by:i,type:"horizontal"===n.chartSpec.direction?"yField":void 0,range:"horizontal"!==n.chartSpec.direction,sortBy:"horizontal"===n.chartSpec.direction?n.chartSpec?.data?.fields?.[s]?.domain:void 0};const a=n.chartSpec.xField;r[a]={by:e,range:"horizontal"===t.indicators[o].chartSpec.direction,sumBy:!1!==n.chartSpec.stack&&i.concat(n.chartSpec?.yField),sortBy:"horizontal"!==n.chartSpec.direction?n.chartSpec?.data?.fields?.[a]?.domain:void 0}}}return r}(t,l,a),i.aggregationRules=function(t){const e=[];return t.indicators?.forEach((i=>{if("string"==typeof i)e.push({indicatorKey:i,field:i,aggregationType:Mx.RECORD});else if(i.chartSpec?.series){const r=[];i.chartSpec?.series.forEach((e=>{const i=!1===t.indicatorsAsCol?e.yField:e.xField;-1===r.indexOf(i)&&r.push(i)})),e.push({indicatorKey:i.indicatorKey,field:r,aggregationType:Mx.RECORD})}else{const r=!1===t.indicatorsAsCol?i.chartSpec.yField:i.chartSpec.xField;e.push({indicatorKey:i.indicatorKey,field:r??i.indicatorKey,aggregationType:Mx.RECORD})}})),e}(t);return{dataset:new uW(i,a,l,h,t.indicators,t.indicatorsAsCol??!0,t.records,void 0,void 0,n||t.columnTree,s||t.rowTree,!0),columnDimensionTree:r,rowDimensionTree:o,layoutNodeId:e}}function yW(t,e,i,r,o,n){if(Ux(t))for(let l=0;l<t.length;l++)if(n?n(t[l],e):(s=t[l],a=e,JSON.stringify(s)===JSON.stringify(a)))return o.getCellHeaderPaths(i,r);var s,a}Ax();t.CustomLayout=mW,t.DataStatistics=gI,t.EventTarget=k_,t.Icon=PM,t.ListTable=class extends Wz{},t.ListTableSimple=class extends Wz{},t.PIVOT_CHART_EVENT_TYPE=YE,t.PIVOT_TABLE_EVENT_TYPE=XE,t.PivotChart=class extends rI{layoutNodeId={seqId:0};pivotSortState;dataset;_selectedDataItemsInChart=[];_selectedDimensionInChart=[];_chartEventMap={};_axes;constructor(t,e){let i,r;super(t,e),(e=this.options).layout&&Object.assign(e,e.layout),this.internalProps.columns=i_(e.columns),this.internalProps.rows=i_(e.rows),this.internalProps.indicators=pz(e.indicators),this.internalProps.columnTree=!e.indicatorsAsCol||e.columns?.length||e.columnTree?i_(e.columnTree):[],this.internalProps.rowTree=e.indicatorsAsCol||e.rows?.length||e.rowTree?i_(e.rowTree):[],this.internalProps.records=e.records,this.setCustomStateNameToSpec(),this.internalProps.columnResizeType=e.resize?.columnResizeType??e.columnResizeType??"column",this.internalProps.rowResizeType=e.resize?.rowResizeType??e.rowResizeType??"row",this.internalProps.dataConfig={isPivotChart:!0},this._axes=Ux(e.axes)?e.axes:[],e.columnTree&&(!1!==e.indicatorsAsCol&&(this.internalProps.columnTree=wL(this.internalProps.columnTree,e.indicators)),i=new dL(this.internalProps.columnTree??[],this.layoutNodeId)),e.rowTree&&(!1===e.indicatorsAsCol&&(this.internalProps.rowTree=wL(this.internalProps.rowTree,e.indicators)),r=new dL(this.internalProps.rowTree??[],this.layoutNodeId));const o=r?.dimensionKeys?.count?r.dimensionKeys.valueArr():e.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],n=i?.dimensionKeys?.count?i.dimensionKeys.valueArr():e.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],s=e.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];if(this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(n,o),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new uW(this.internalProps.dataConfig,o,n,s,this.internalProps.indicators,e.indicatorsAsCol??!0,e.records,void 0,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),this.options.indicatorsAsCol&&Rz(this.internalProps.indicators)){const t=e=>{e.forEach((e=>{e.children?.length?t(e.children):e.children=[{dimensionKey:"axis",value:""}]}))};this.dataset.rowHeaderTree?.length?t(this.dataset.rowHeaderTree):this.dataset.rowHeaderTree=[{dimensionKey:"axis",value:""}]}if(e.columnTree||!1!==e.indicatorsAsCol&&(this.dataset.colHeaderTree=wL(this.dataset.colHeaderTree,e.indicators)),e.rowTree||!1===e.indicatorsAsCol&&(this.dataset.rowHeaderTree=wL(this.dataset.rowHeaderTree,e.indicators)),i=new dL(this.dataset.colHeaderTree??[],this.layoutNodeId),r=new dL(this.dataset.rowHeaderTree??[],this.layoutNodeId),this.internalProps.layoutMap=new lW(this,this.dataset,i,r),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.createSceneGraph(),e.title){const t=wA.getComponent("title");this.internalProps.title=new t(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}setTimeout((()=>{this.fireListeners(OS.INITIALIZED,null)}),0)}static get EVENT_TYPE(){return YE}get pivotChartAxes(){return this._axes}get recordsCount(){return this.records?.length}isListTable(){return!1}isPivotTable(){return!0}isPivotChart(){return!0}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.internalProps.layoutMap.indicatorsAsCol){const e=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount);if(e?.disableColumnResize)return!1}return i}updateOption(t){const e=this.internalProps;let i,r;super.updateOption(t),this.layoutNodeId={seqId:0},this.internalProps.columns=i_(t.columns),this.internalProps.rows=i_(t.rows),this.internalProps.indicators=t.indicators?.length?pz(t.indicators):[],this.internalProps.columnTree=!t.indicatorsAsCol||t.columns?.length||t.columnTree?i_(t.columnTree):[],this.internalProps.rowTree=t.indicatorsAsCol||t.rows?.length||t.rowTree?i_(t.rowTree):[],t.records&&(this.internalProps.records=t.records),this.setCustomStateNameToSpec(),this._selectedDataItemsInChart=[],e.columnResizeType=t.resize?.columnResizeType??t.columnResizeType??"column",e.rowResizeType=t.resize?.rowResizeType??t.rowResizeType??"row",e.dataConfig={isPivotChart:!0},this._axes=Ux(t.axes)?t.axes:[],t.columnTree&&(!1!==t.indicatorsAsCol&&(this.internalProps.columnTree=wL(this.internalProps.columnTree,t.indicators)),i=new dL(this.internalProps.columnTree??[],this.layoutNodeId)),t.rowTree&&(!1===t.indicatorsAsCol&&(this.internalProps.rowTree=wL(this.internalProps.rowTree,t.indicators)),r=new dL(this.internalProps.rowTree??[],this.layoutNodeId));const o=r?.dimensionKeys?.count?r.dimensionKeys.valueArr():t.rows?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],n=i?.dimensionKeys?.count?i.dimensionKeys.valueArr():t.columns?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.dimensionKey),t)),[])??[],s=t.indicators?.reduce(((t,e)=>("string"==typeof e?t.push(e):t.push(e.indicatorKey),t)),[])??[];if(this.internalProps.dataConfig.collectValuesBy=this._generateCollectValuesConfig(n,o),this.internalProps.dataConfig.aggregationRules=this._generateAggregationRules(),this.internalProps.dataConfig.dimensionSortArray=this._getDimensionSortArray(),this.dataset=new uW(this.internalProps.dataConfig,o,n,s,this.internalProps.indicators,t.indicatorsAsCol??!0,t.records??this.internalProps.records,void 0,void 0,this.internalProps.columnTree,this.internalProps.rowTree,!0),this.options.indicatorsAsCol&&Rz(this.internalProps.indicators)){const t=e=>{e.forEach((e=>{e.children?.length?t(e.children):e.children=[{dimensionKey:"axis",value:""}]}))};this.dataset.rowHeaderTree?.length?t(this.dataset.rowHeaderTree):this.dataset.rowHeaderTree=[{dimensionKey:"axis",value:""}]}if(t.columnTree||!1!==t.indicatorsAsCol&&(this.dataset.colHeaderTree=wL(this.dataset.colHeaderTree,t.indicators)),t.rowTree||!1===t.indicatorsAsCol&&(this.dataset.rowHeaderTree=wL(this.dataset.rowHeaderTree,t.indicators)),i=new dL(this.dataset.colHeaderTree??[],this.layoutNodeId),r=new dL(this.dataset.rowHeaderTree??[],this.layoutNodeId),e.layoutMap=new lW(this,this.dataset,i,r),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.releaseList&&(e.releaseList.forEach((t=>t?.release?.())),e.releaseList=null),this.scenegraph.clearCells(),this.scenegraph.createSceneGraph(),t.title){const e=wA.getComponent("title");this.internalProps.title=new e(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)this.internalProps.emptyTip?.resetVisible();else{const t=wA.getComponent("emptyTip");this.internalProps.emptyTip=new t(this.options.emptyTip,this),this.internalProps.emptyTip?.resetVisible()}return new Promise((t=>{setTimeout(t,0)}))}updatePagination(){}refreshHeader(){this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){const t=this,{layoutMap:e}=t.internalProps;e&&(t.colCount=e.colCount??0,t.rowCount=e.rowCount??0,t.internalProps.frozenColCount=e.rowHeaderLevelCount??0,t.frozenRowCount=Math.max(e.headerLevelCount,this.options.frozenRowCount??0),t.bottomFrozenRowCount!==(e?.bottomFrozenRowCount??0)&&(t.bottomFrozenRowCount=e?.bottomFrozenRowCount??0),t.rightFrozenColCount!==(e?.rightFrozenColCount??0)&&(t.rightFrozenColCount=e?.rightFrozenColCount??0),this.stateManager.setFrozenCol(this.internalProps.frozenColCount))}_getSortFuncFromHeaderOption(t,e,i){}syncHierarchyState(t,e){t.value===e.value&&t.dimensionKey===e.dimensionKey&&(e.hierarchyState=e.hierarchyState??(e?.children?t.hierarchyState:void 0),e?.children?.forEach(((e,i)=>{t?.children?.[i]&&e&&this.syncHierarchyState(t.children[i],e)})))}getRecordShowIndexByCell(t,e){}getTableIndexByRecordIndex(t){}getTableIndexByField(t){}getCellAddrByFieldRecord(t,e){}getBodyIndexByRow(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByRow(t)}getBodyIndexByCol(t){const{layoutMap:e}=this.internalProps;return e.getBodyIndexByCol(t)}getCellValue(t,e,i){if(!i){const i=this.getCustomMergeValue(t,e);if(i)return i}if(this.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.layoutMap.isBottomFrozenRow(t,e)||this.internalProps.layoutMap.isRightFrozenColumn(t,e)){const i=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(t,e);let r;return i?.forEach((t=>{const e=this.internalProps.layoutMap.getIndicatorInfo(t);e&&(r=e)})),r?.title??r?.indicatorKey??""}const{title:i,fieldFormat:r}=this.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r(i,t,e,this):i}if(this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths.map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths.map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value))),s=this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!0,i);return s.value?s.value():void 0}const{fieldFormat:r}=this.internalProps.layoutMap.getBody(t,e),o=this.getBodyIndexByRow(e),n=this.getBodyIndexByCol(t),s=this.records[o]?.[n];if("function"==typeof r){return r(s,t,e,this)}return s}getCellOriginValue(t,e){const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){if(this.internalProps.layoutMap.isBottomFrozenRow(t,e)||this.internalProps.layoutMap.isRightFrozenColumn(t,e)){const i=this.internalProps.layoutMap.getIndicatorKeyInChartSpec(t,e);let r;return i?.forEach((t=>{const e=this.internalProps.layoutMap.getIndicatorInfo(t);e&&(r=e)})),r?.title??r?.indicatorKey??""}const{title:r}=i.internalProps.layoutMap.getHeader(t,e);return"function"==typeof r?r():r}if(this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths.map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths.map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value))),s=this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!0,i);return s.value?s.value():void 0}const r=this.getBodyIndexByRow(e),o=this.getBodyIndexByCol(t),n=this.records[r]?.[o];return n}getCellRawValue(t,e){return this.getCellOriginValue(t,e)}getCellOriginRecord(t,e){if(!this.internalProps.layoutMap.isHeader(t,e)&&this.dataset){let i;const r=this.internalProps.layoutMap.getCellHeaderPaths(t,e),o=r.colHeaderPaths.map(((t,e)=>(t.indicatorKey&&(i={position:"col",index:e}),t.indicatorKey??t.value))),n=r.rowHeaderPaths.map(((t,e)=>(t.indicatorKey&&(i={position:"row",index:e}),t.indicatorKey??t.value)));return this.dataset.getAggregator(n,o,this.internalProps.layoutMap.getIndicatorKey(t,e),!0,i).records}}getCellRawRecord(t,e){return this.getCellOriginRecord(t,e)}getPivotSortState(t,e){if(!this.pivotSortState)return;const i=this.getCellRange(t,e);for(let t=0;t<this.pivotSortState.length;t++){const{col:e,row:r,order:o}=this.pivotSortState[t];if(MS(i,e,r))return o}}_moveHeaderPosition(t,e){const i=this.internalProps.layoutMap.moveHeaderPosition(t,e);if(i){if("column"===i.moveType){if(this.options.records?.[0]?.constructor===Array)for(let t=0;t<this.internalProps.records.length;t++){const e=this.internalProps.records[t].splice(i.sourceIndex-this.rowHeaderLevelCount,i.sourceSize);e.unshift(i.targetIndex-this.rowHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records[t],e)}this.colWidthsMap.adjustOrder(i.sourceIndex,i.targetIndex,i.sourceSize),this.setMinMaxLimitWidth()}else if("row"===i.moveType){if(this.options.records?.[0]?.constructor===Array){const t=this.internalProps.records.splice(i.sourceIndex-this.columnHeaderLevelCount,i.sourceSize);t.unshift(i.targetIndex-this.columnHeaderLevelCount,0),Array.prototype.splice.apply(this.internalProps.records,t)}this.rowHeightsMap.adjustOrder(i.sourceIndex,i.targetIndex,i.sourceSize)}return i}return null}toggleHierarchyState(t,e,i=!0){}getHeaderCellAddressByPath(t){return this.internalProps.layoutMap.getPivotCellAdress(t)}getCellAddressByHeaderPaths(t){return this.internalProps.layoutMap.getCellAdressByHeaderPath(t)}getHeaderPathByXY(t){let e;e=t?this.getCellAt(t.x+this.getFrozenColsWidth()+this.scrollLeft+1,t.y+this.getFrozenRowsHeight()+this.scrollTop+1):this.getCellAt(this.getFrozenColsWidth()+this.scrollLeft+1,this.getFrozenRowsHeight()+this.scrollTop+1);return this.internalProps.layoutMap.getCellHeaderPaths(e.col,e.row)}getHierarchyState(t,e){return this._getHeaderLayoutMap(t,e)?.hierarchyState}getMenuInfo(t,e,i){const r=this.internalProps.layoutMap.getPivotDimensionInfo(t,e);return{dimensionKey:r[r.length-1].dimensionKey,value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),isPivotCorner:this.isCornerHeader(t,e),event:void 0}}_generateCollectValuesConfig(t,e){t=t.filter((t=>t!==eA)),e=e.filter((t=>t!==eA));const i=this.internalProps.indicators,r={};for(let o=0,n=i?.length;o<n;o++)if("string"!=typeof i[o]&&i[o].chartSpec){if("pie"===i[o].chartSpec?.type||"rose"===i[o].chartSpec?.type||"radar"===i[o].chartSpec?.type||"gauge"===i[o].chartSpec?.type||"wordCloud"===i[o].chartSpec?.type)continue;const n=i[o],s=n.chartSpec;if(!1===this.options.indicatorsAsCol)if(!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0),r[n.indicatorKey]={by:e,range:!0,sumBy:s?.stack&&t.concat(s?.xField)},s.series)s.series.forEach((i=>{const o="string"==typeof i.xField?i.xField:i.xField[0];r[o]={by:t,type:"horizontal"!==i.direction?"xField":void 0,range:NL(i,this._axes,"horizontal"===i.direction,!0),sortBy:"horizontal"!==i.direction?i?.data?.fields?.[o]?.domain??s?.data?.fields?.[o]?.domain:void 0};const n=i.yField;!1!==i.stack&&("bar"===i.type||"area"===i.type)&&(i.stack=!0),r[n]={by:e,range:NL(i,this._axes,"horizontal"===i.direction,!1),sumBy:i.stack&&t.concat(i?.xField),sortBy:"horizontal"===i.direction?i?.data?.fields?.[n]?.domain??s?.data?.fields?.[n]?.domain:void 0,extendRange:QB(s.markLine)}}));else{const i="string"==typeof s.xField?s.xField:s.xField[0];r[i]={by:t,type:"horizontal"!==s.direction?"xField":void 0,range:NL(s,this._axes,"horizontal"===s.direction,!0),sortBy:"horizontal"!==s.direction?s?.data?.fields?.[i]?.domain:void 0},!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0);const o=s.yField;r[o]={by:e,range:"horizontal"!==s.direction,sumBy:s.stack&&t.concat(s?.xField),sortBy:"horizontal"===s.direction?s?.data?.fields?.[o]?.domain:void 0,extendRange:QB(s.markLine)}}else{const n=i[o];if(!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0),r[n.indicatorKey]={by:t,range:!0,sumBy:s?.stack&&e.concat(s?.yField)},s.series)s.series.forEach((i=>{const o="string"==typeof i.yField?i.yField:i.yField[0];r[o]={by:e,type:"horizontal"===i.direction?"yField":void 0,range:NL(i,this._axes,"horizontal"===i.direction,!1),sortBy:"horizontal"===i.direction?i?.data?.fields?.[o]?.domain??s?.data?.fields?.[o]?.domain:void 0};const n=i.xField;!1!==i.stack&&("bar"===i.type||"area"===i.type)&&(i.stack=!0),r[n]={by:t,range:NL(i,this._axes,"horizontal"===i.direction,!0),sumBy:i.stack&&e.concat(i?.yField),sortBy:"horizontal"!==i.direction?i?.data?.fields?.[n]?.domain??s?.data?.fields?.[n]?.domain:void 0,extendRange:QB(s.markLine)}}));else{const i="string"==typeof s.yField?s.yField:s.yField[0];r[i]={by:e,type:"horizontal"===s.direction?"yField":void 0,range:NL(s,this._axes,"horizontal"===s.direction,!1),sortBy:"horizontal"===s.direction?s?.data?.fields?.[i]?.domain:void 0},!1!==s?.stack&&("bar"===s?.type||"area"===s?.type)&&(s.stack=!0);const o=s.xField;r[o]={by:t,range:NL(s,this._axes,"horizontal"===s.direction,!0),sumBy:s.stack&&e.concat(s?.yField),sortBy:"horizontal"!==s.direction?s?.data?.fields?.[o]?.domain:void 0,extendRange:QB(s.markLine)}}}}return r}_generateAggregationRules(){const t=[];return this.internalProps.indicators?.forEach((e=>{if("string"==typeof e)t.push({indicatorKey:e,field:e,aggregationType:Mx.RECORD});else if(e.chartSpec?.series){const i=[];e.chartSpec?.series.forEach((t=>{const e=!1===this.options.indicatorsAsCol?t.yField:t.xField;-1===i.indexOf(e)&&i.push(e)})),t.push({indicatorKey:e.indicatorKey,field:i,aggregationType:Mx.RECORD})}else{const i=!1===this.options.indicatorsAsCol?e.chartSpec.yField:e.chartSpec.xField;t.push({indicatorKey:e.indicatorKey,field:i??e.indicatorKey,aggregationType:Mx.RECORD})}})),t}setCustomStateNameToSpec(){const t=t=>{t.bar?.state?.selected&&(t.bar.state.vtable_selected=t.bar.state.selected,t.bar.state.vtable_selected_reverse=t.bar.state.selected_reverse,delete t.bar.state.selected,delete t.bar.state.selected_reverse),t.point?.state?.selected&&(t.point.state.vtable_selected=t.point.state.selected,t.point.state.vtable_selected_reverse=t.point.state.selected_reverse,delete t.point.state.selected,delete t.point.state.selected_reverse),t.line?.state?.selected&&(t.line.state.vtable_selected=t.line.state.selected,t.line.state.vtable_selected_reverse=t.line.state.selected_reverse,delete t.line.state.selected,delete t.line.state.selected_reverse),t.area?.state?.selected&&(t.area.state.vtable_selected=t.area.state.selected,t.area.state.vtable_selected_reverse=t.area.state.selected_reverse,delete t.area.state.selected,delete t.area.state.selected_reverse),t.pie?.state?.selected&&(t.pie.state.vtable_selected=t.pie.state.selected,t.pie.state.vtable_selected_reverse=t.pie.state.selected_reverse,delete t.pie.state.selected,delete t.pie.state.selected_reverse)};this.internalProps.indicators?.forEach((e=>{if(e.chartSpec){const i=e.chartSpec;i.series?i.series.forEach((e=>{t(e)})):t(i)}}))}updateFilterRules(t){this.internalProps.dataConfig.filterRules=t,this.dataset.updateFilterRules(t),AE(this.scenegraph),function(t){const e=t.table;for(let i=t.proxy.colStart;i<=t.proxy.colEnd;i++){const r=t.getColGroup(i);r?.getChildren()?.forEach((t=>{const i=t.col,r=t.row;t.children.forEach((t=>{if("chart"===t.type){t.updateData(e.getCellValue(i,r));const o=t.attribute.spec,n=o.type;if("gauge"!==n&&"rose"!==n&&"radar"!==n){const n=e.internalProps.layoutMap.getChartAxes(i,r);t.setAttribute("axes",n),o.axes=n}t.setAttribute("spec",o)}}))}))}TE(t.rowHeaderGroup,t.table),TE(t.colHeaderGroup,t.table),TE(t.rightFrozenGroup,t.table),TE(t.bottomFrozenGroup,t.table)}(this.scenegraph),this.render()}clearChartCacheImage(t,e){Xx(t)&&Xx(e)?function(t,e,i){i.getCell(t,e).children.forEach((t=>{"chart"===t.type&&(t.cacheCanvas=null,t.addUpdateBoundTag())}))}(t,e,this.scenegraph):AE(this.scenegraph)}getLegendSelected(){const t=[];return this.internalProps.legends?.forEach((e=>{const i=e.legendComponent._getSelectedLegends().map((t=>t.label));t.push(...i)})),t}setLegendSelected(t){this.internalProps.legends?.forEach((e=>{e.legendComponent.setSelected(t)}))}getChartDatumPosition(t,e){const{chartInstance:i,bounds:r}=this.getChartInstance(e);if(i){const e=i.convertDatumToPosition(t);return e?{x:Math.round(e.x+r.x1),y:Math.round(e.y+r.y1)}:null}return null}getCellAddressByRecord(t){const e=[],i=[],r={},o=[];this.dataset.dataConfig.aggregationRules.forEach((t=>{if("string"==typeof t.field)r[t.field]=t.indicatorKey,o.push(t.field);else for(let e=0;e<t.field.length;e++)r[t.field[e]]=t.indicatorKey,o.push(t.field[e])}));for(const n in t)this.dataset.rows.indexOf(n)>=0&&e.push({dimensionKey:n,value:t[n]}),this.dataset.columns.indexOf(n)>=0&&i.push({dimensionKey:n,value:t[n]}),o.indexOf(n)>=0&&(this.dataset.indicatorsAsCol?i.push({indicatorKey:r[n]}):e.push({indicatorKey:r[n]}));return this.getCellAddressByHeaderPaths({rowHeaderPaths:e,colHeaderPaths:i,cellLocation:"body"})}getChartInstance(t){const e=this.getCellAddressByHeaderPaths(t);if(e){const t=this.getCellRelativeRect(e.col,e.row),i=this.scenegraph.getCell(e.col,e.row);let r;const o=i?.getChildren()?.[0];if(o.attribute.chartInstance){r=o.attribute.chartInstance;const{dataId:t,data:e,axes:i,spec:n}=o.attribute,s=o.getViewBox();i?.forEach(((t,e)=>{"linear"===t.type?r.updateModelSpecSync({type:"axes",index:e},{min:t.range?.min??0,max:t.range?.max??0,tick:{tickMode:t.tick?.tickMode}},!0):"band"===t.type&&r.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0)})),r.updateViewBox({x1:0,x2:s.x2-s.x1,y1:0,y2:s.y2-s.y1},!1,!1);const a=r.getStage(),l=o.globalTransMatrix.clone(),h=o.stage.window.getViewBoxTransform();if(l.multiply(h.a,h.b,h.c,h.d,h.e,h.f),a.window.setViewBoxTransform&&a.window.setViewBoxTransform(l.a,l.b,l.c,l.d,l.e,l.f),"string"==typeof t)r.updateDataSync(t,e??[]);else{const i=[];for(const o in t){const s=t[o],a=n.series.find((t=>t?.data?.id===o));i.push({id:o,values:s?e?.filter((t=>t.hasOwnProperty(s)))??[]:e??[],fields:a?.data?.fields}),r.updateFullDataSync||r.updateDataSync(o,s?e?.filter((t=>t.hasOwnProperty(s)))??[]:e??[])}r.updateFullDataSync?.(i)}this.render()}return{chartInstance:r,bounds:t.bounds}}return{}}activateChartInstance(t){const e=this.getCellAddressByHeaderPaths(t);if(e){const t=e.col,i=e.row,r=this.scenegraph.getCell(t,i),o=r?.getChildren()?.[0],n=this.scenegraph.activateChart(t,i),{dataId:s,data:a,axes:l,spec:h}=o.attribute,c=o.getViewBox();l?.forEach(((t,e)=>{"linear"===t.type?n.updateModelSpecSync({type:"axes",index:e},{min:t.range?.min??0,max:t.range?.max??0,tick:{tickMode:t.tick?.tickMode}},!0):"band"===t.type&&n.updateModelSpec({type:"axes",index:e},{domain:t.domain.slice(0)},!0)})),n.updateViewBox({x1:0,x2:c.x2-c.x1,y1:0,y2:c.y2-c.y1},!1,!1);const d=n.getStage();d.needRender=!0;const u=o.globalTransMatrix.clone(),g=o.stage.window.getViewBoxTransform().clone();if(g.multiply(u.a,u.b,u.c,u.d,u.e,u.f),d.window.setViewBoxTransform(g.a,g.b,g.c,g.d,g.e,g.f),"string"==typeof s)n.updateDataSync(s,a??[]);else{const t=[];for(const e in s){const i=s[e],r=h.series.find((t=>t?.data?.id===e));t.push({id:e,values:i?a?.filter((t=>t.hasOwnProperty(i)))??[]:a??[],fields:r?.data?.fields}),n.updateFullDataSync||n.updateDataSync(e,i?a?.filter((t=>t.hasOwnProperty(i)))??[]:a??[])}n.updateFullDataSync?.(t)}return n}}replaceChartCacheImage(t,e){const i=this.getCellAddressByHeaderPaths(t);if(i){const t=this.scenegraph.getCell(i.col,i.row),r=t?.getChildren()?.[0];MH(e.getStage(),r)}}_getDimensionSortArray(){if(this.options?.axes?.length){const t=this.options.indicatorsAsCol?"left":"bottom",e=this.options.axes.find((e=>e.orient===t));if(e&&Ux(e.domain))return e.domain}}setRecords(t){this.internalProps.layoutMap.release(),AH();const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.options.records=this.internalProps.records=t;const i=this.options,r=this.internalProps;let o,n;this.dataset.setRecords(t),o=i.columnTree?r.layoutMap.columnDimensionTree:new dL(this.dataset.colHeaderTree??[],this.layoutNodeId),n=i.rowTree?r.layoutMap.rowDimensionTree:new dL(this.dataset.rowHeaderTree??[],this.layoutNodeId),r.layoutMap=new lW(this,this.dataset,o,n),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.eventManager.updateEventBinder()}_hasCustomRenderOrLayout(){if(this.options.customRender)return!0;const{columnsDefine:t,rowsDefine:e,indicatorsDefine:i}=this.internalProps.layoutMap;for(let e=0;e<t.length;e++){const i=t[e];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<e.length;t++){const i=e[t];if("string"!=typeof i&&(i.headerCustomLayout||i.headerCustomRender))return!0}for(let t=0;t<i.length;t++){const e=i[t];if("string"!=typeof e&&(e.customLayout||e.headerCustomLayout||e.customRender||e.headerCustomRender))return!0}return!1}changeRecordOrder(t,e){}getLayoutColumnTree(){return this.internalProps.layoutMap.getLayoutColumnTree()}getLayoutColumnTreeCount(){return this.internalProps.layoutMap.getLayoutColumnTreeCount()}getLayoutRowTree(){return this.internalProps.layoutMap.getLayoutRowTree()}getLayoutRowTreeCount(){return this.internalProps.layoutMap.getLayoutRowTreeCount()}getCellHeaderTreeNodes(t,e){return this.internalProps.layoutMap.getCellHeaderPathsWithTreeNode(t,e)}},t.PivotTable=class extends pW{},t.PivotTableSimple=class extends pW{},t.TABLE_EVENT_TYPE=OS,t.TYPES=M_,t.VArc=function(t){return Fh.arc(t?t.attribute:{})},t.VArea=function(t){return Fh.area(t?t.attribute:{})},t.VCheckBox=function(t){return new wx(t?t.attribute:{})},t.VCircle=function(t){return Fh.circle(t?t.attribute:{})},t.VGlyph=function(t){return Fh.glyph(t?t.attribute:{})},t.VGroup=function(t){return Fh.group(t?t.attribute:{})},t.VImage=function(t){return Fh.image(t?t.attribute:{})},t.VLine=function(t){return Fh.line(t?t.attribute:{})},t.VPath=function(t){return Fh.path(t?t.attribute:{})},t.VPolygon=function(t){return Fh.polygon(t?t.attribute:{})},t.VRadio=function(t){return new vx(t?t.attribute:{})},t.VRect=function(t){return Fh.rect(t?t.attribute:{})},t.VSymbol=function(t){return Fh.symbol(t?t.attribute:{})},t.VTag=function(t){return new My(t?t.attribute:{})},t.VText=function(t){return Fh.text(t?t.attribute:{})},t.clearGlobal=function(){dI()},t.core=oI,t.data=rB,t.getDataCellPath=function(t,e,i){const r=bW(t);let o=r.columnDimensionTree,n=r.rowDimensionTree,s=!1,a=!1;t.columnTree&&t.indicatorsAsCol&&!o.dimensionKeys.contain(eA)&&(s=!0),t.rowTree&&(t.indicatorsAsCol||n.dimensionKeys.contain(eA)||(a=!0));const{dataset:l,layoutNodeId:h}=r,c={options:t,layoutNodeId:h,internalProps:t,isPivotChart:()=>!0,pivotChartAxes:[],_selectedDataItemsInChart:[],_getActiveChartInstance:()=>({updateState:()=>{}})};t.columnTree&&!s||(o=new dL(l.colHeaderTree??[],h)),t.rowTree&&!a||(n=new dL(l.rowHeaderTree??[],h));const d=new lW(c,l,o,n);for(let t=0;t<d.colCount;t++)for(let r=0;r<d.rowCount;r++){if(d.isHeader(t,r))continue;const o=d.getCellHeaderPaths(t,r),n=o.colHeaderPaths.map((t=>t.indicatorKey??t.value)),s=o.rowHeaderPaths.map((t=>t.indicatorKey??t.value)),a=l.getAggregator(d.indicatorsAsCol?s:s.slice(0,-1),d.indicatorsAsCol?n.slice(0,-1):n,d.getIndicatorKey(t,r)),h=yW(a.value?a.value():void 0,e,t,r,d,i);if(h)return h}},t.getIcons=function(){return MM()},t.getTargetCell=LM,t.graphicUtil=Vu,t.jsx=function(t,e,...i){const r=e||{},{key:o,name:n,id:s,attribute:a,stateProxy:l,animation:h,timeline:c}=r,d=gp(r,["key","name","id","attribute","stateProxy","animation","timeline"]);let u=t;dt(t)&&(u=Fh[t]);const g=[];i.length&&pp(1===i.length?i[0]:i,g);const p="Group"===u.name?new u(a):u(e);if(function(t,e,i){let r,o=!1;switch(t.type){case"richtext":case"rich/image":break;case"rich/text":r=t.attribute||{},e[0]&&(r.text=e[0]);break;default:o=!0}o?(e.forEach((e=>{e&&t.add(e)})),Object.keys(i).forEach((e=>{const r=up[e];r&&t.on(r,i[e])}))):"richtext"===t.type&&(t.attribute.textConfig=e.map((t=>t.attribute)).filter((t=>t)))}(p,g,d),l&&(p.stateProxy=l),n&&(p.name=n),ut(h)){const t=p.animate();c&&t.setTimeline(c),h.forEach((e=>{t[e[0]](...e.slice(1))}))}return p},t.plugins=pI,t.register=uI,t.registerAnimation=MD,t.registerAxis=_D,t.registerButtonCell=rW,t.registerChartCell=ZD,t.registerCheckboxCell=JD,t.registerEmptyTip=SD,t.registerImageCell=QD,t.registerLegend=AD,t.registerMenu=TD,t.registerProgressBarCell=tW,t.registerRadioCell=eW,t.registerSparkLineCell=oW,t.registerSwitchCell=iW,t.registerTextCell=nW,t.registerTitle=RD,t.registerTooltip=BD,t.registerVideoCell=sW,t.renderChart=TH,t.restoreMeasureText=function(){HP="canvas",so.load(EP)},t.setCustomAlphabetCharSet=function(t){PP=t,FP.clear()},t.textMeasure=zP,t.themes=yA,t.toBoxArray=BS,t.updateCell=CP,t.version="1.19.5"}));
